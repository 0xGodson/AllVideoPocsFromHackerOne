{"id":703759,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MDM3NTk=","url":"https://hackerone.com/reports/703759","title":"SSO through odnoklassniki uses http rather than https","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2019-09-29T12:46:28.768Z","submitted_at":"2019-09-29T12:46:28.768Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"matthijsmelissen","url":"/matthijsmelissen","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1926,"url":"https://hackerone.com/badoo","handle":"badoo","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/926/2d5179ec8d7d7c36af59a55d318dace33c3aa109_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/926/2d5179ec8d7d7c36af59a55d318dace33c3aa109_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Badoo","twitter_handle":"Badoo","website":"https://badoo.com","about":"Meet new people"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-12-21T12:12:34.824Z","bug_reporter_agreed_on_going_public_at":"2019-11-21T12:12:33.895Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"SUMMARY\nWhen using single-sign on through odnoklassniki, the user is sent to an http (non-https) URL, allowing an attacker (under some conditions) to log in to the victim's Badoo account by stealing odnoklassniki credentials, as well as to execute a CSRF-attack on the log-in form.\n\nRECOMMENDATION\nLet https://badoo.com/ok/authorize.phtml?rt=060285\u0026js_use_scheme=https redirect to https://www.odnoklassniki.ru rather than the http version.\n\nSTEPS TO REPRODUCE\n1) The victim navigates to https://badoo.com/nl/signin/ and selects 'odnoklassniki'\n2) The victim is forwarded to http://www.odnoklassniki.ru/oauth/authorize?response_type=code\u0026display=popup\u0026client_id=126351872\u0026scope=VALUABLE_ACCESS%3BGET_EMAIL\u0026state=\u003cstate\u003e\u0026redirect_uri=https%3A%2F%2Fbadoo.com%2Fexternal%2Fredirector.phtml\n\nImpact 1:\n3) The attacker intercepts the http traffic and presents the victim a fake odnoklassniki log-in page\n4) The attacker intercepts the odnoklassniki credentials entered by the victim\n5) The attacker uses the intercepted odnoklassniki credentials to log in to the victim's Badoo account\n\nImpact 2:\n3) The attacker intercepts the URL at http://www.odnoklassniki.ru/ to which the victim is forwarded (which notably includes the state variable, which is connected to the victim's session)\n4) The attacker browses to this URL and enters its own odnoklassniki credentials\n5) The attacker intercepts the URL returning to https://badoo.com/external/redirector.phtml (including its parameters) and invites the victim to visit this URL\n6) The attacker is now logged in to Badoo on the victim's device\n\n## Impact\n\nImpact 1:\nThe attacker can log in to the victim's Badoo account by stealing odnoklassniki credentials, under the following conditions:\n\n* The attacker can modify traffic between the user and badoo.com (e.g. the user is connected to a rogue access point)\n* The victim is willing to enter his odnoklassniki credentials on a http version of the site\n\nImpact 2:\nThe attacker can execute a CSRF attack on the log-in form (i.e. the attacker log himself in to badoo.com on the victim's browser), under the following conditions:\n\n* The attacker can intercept traffic between the user and badoo.com (e.g. the attacker is connected to the same unprotected wifi network)\n* The attacker succeeds in causing the victim to browse to a URL provided by the attacker.","vulnerability_information_html":"\u003cp\u003eSUMMARY\u003cbr\u003e\nWhen using single-sign on through odnoklassniki, the user is sent to an http (non-https) URL, allowing an attacker (under some conditions) to log in to the victim\u0026#39;s Badoo account by stealing odnoklassniki credentials, as well as to execute a CSRF-attack on the log-in form.\u003c/p\u003e\n\n\u003cp\u003eRECOMMENDATION\u003cbr\u003e\nLet \u003ca title=\"https://badoo.com/ok/authorize.phtml?rt=060285\u0026amp;js_use_scheme=https\" href=\"/redirect?url=https%3A%2F%2Fbadoo.com%2Fok%2Fauthorize.phtml%3Frt%3D060285%26js_use_scheme%3Dhttps\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://badoo.com/ok/authorize.phtml?rt=060285\u0026amp;js_use_scheme=https\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e redirect to \u003ca title=\"https://www.odnoklassniki.ru\" href=\"/redirect?url=https%3A%2F%2Fwww.odnoklassniki.ru\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.odnoklassniki.ru\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e rather than the http version.\u003c/p\u003e\n\n\u003cp\u003eSTEPS TO REPRODUCE\u003cbr\u003e\n1) The victim navigates to \u003ca title=\"https://badoo.com/nl/signin/\" href=\"/redirect?url=https%3A%2F%2Fbadoo.com%2Fnl%2Fsignin%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://badoo.com/nl/signin/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and selects \u0026#39;odnoklassniki\u0026#39;\u003cbr\u003e\n2) The victim is forwarded to \u003ca title=\"http://www.odnoklassniki.ru/oauth/authorize?response_type=code\u0026amp;display=popup\u0026amp;client_id=126351872\u0026amp;scope=VALUABLE_ACCESS%3BGET_EMAIL\u0026amp;state=\" href=\"/redirect?url=http%3A%2F%2Fwww.odnoklassniki.ru%2Foauth%2Fauthorize%3Fresponse_type%3Dcode%26display%3Dpopup%26client_id%3D126351872%26scope%3DVALUABLE_ACCESS%253BGET_EMAIL%26state%3D\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.odnoklassniki.ru/oauth/authorize?response_type=code\u0026amp;display=popup\u0026amp;client_id=126351872\u0026amp;scope=VALUABLE_ACCESS%3BGET_EMAIL\u0026amp;state=\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026lt;state\u0026gt;\u0026amp;redirect_uri=https%3A%2F%2Fbadoo.com%2Fexternal%2Fredirector.phtml\u003c/p\u003e\n\n\u003cp\u003eImpact 1:\u003cbr\u003e\n3) The attacker intercepts the http traffic and presents the victim a fake odnoklassniki log-in page\u003cbr\u003e\n4) The attacker intercepts the odnoklassniki credentials entered by the victim\u003cbr\u003e\n5) The attacker uses the intercepted odnoklassniki credentials to log in to the victim\u0026#39;s Badoo account\u003c/p\u003e\n\n\u003cp\u003eImpact 2:\u003cbr\u003e\n3) The attacker intercepts the URL at \u003ca title=\"http://www.odnoklassniki.ru/\" href=\"/redirect?url=http%3A%2F%2Fwww.odnoklassniki.ru%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.odnoklassniki.ru/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to which the victim is forwarded (which notably includes the state variable, which is connected to the victim\u0026#39;s session)\u003cbr\u003e\n4) The attacker browses to this URL and enters its own odnoklassniki credentials\u003cbr\u003e\n5) The attacker intercepts the URL returning to \u003ca title=\"https://badoo.com/external/redirector.phtml\" href=\"/redirect?url=https%3A%2F%2Fbadoo.com%2Fexternal%2Fredirector.phtml\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://badoo.com/external/redirector.phtml\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (including its parameters) and invites the victim to visit this URL\u003cbr\u003e\n6) The attacker is now logged in to Badoo on the victim\u0026#39;s device\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eImpact 1:\u003cbr\u003e\nThe attacker can log in to the victim\u0026#39;s Badoo account by stealing odnoklassniki credentials, under the following conditions:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe attacker can modify traffic between the user and badoo.com (e.g. the user is connected to a rogue access point)\u003c/li\u003e\n\u003cli\u003eThe victim is willing to enter his odnoklassniki credentials on a http version of the site\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eImpact 2:\u003cbr\u003e\nThe attacker can execute a CSRF attack on the log-in form (i.e. the attacker log himself in to badoo.com on the victim\u0026#39;s browser), under the following conditions:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe attacker can intercept traffic between the user and badoo.com (e.g. the attacker is connected to the same unprotected wifi network)\u003c/li\u003e\n\u003cli\u003eThe attacker succeeds in causing the victim to browse to a URL provided by the attacker.\u003c/li\u003e\n\u003c/ul\u003e\n","bounty_amount":"150.0","formatted_bounty":"$150","weakness":{"id":34,"name":"Cleartext Transmission of Sensitive Information"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-12-21T12:12:34.116Z","allow_singular_disclosure_after":-32293647.04206429,"singular_disclosure_allowed":true,"vote_count":12,"voters":["sameerphad72","ms-13","realtess","snork","cryptographer","0x08","klau5","clockskew","streamer","jmtddsl","and 2 more..."],"severity":{"rating":"low","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":5951241,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hello @matthijsmelissen.\nThank you for your report.\nRegarding impact #1 - phishing is out of scope as well as lack of HSTS on third-party services is not eligible for a monetary reward. \nCould you provide a PoC of second scenario?\nThank you!  \n","markdown_message":"\u003cp\u003eHello \u003ca href=\"/matthijsmelissen\"\u003e@matthijsmelissen\u003c/a\u003e.\u003cbr\u003e\nThank you for your report.\u003cbr\u003e\nRegarding impact #1 - phishing is out of scope as well as lack of HSTS on third-party services is not eligible for a monetary reward. \u003cbr\u003e\nCould you provide a PoC of second scenario?\u003cbr\u003e\nThank you!  \u003c/p\u003e\n","automated_response":false,"created_at":"2019-10-03T13:30:00.413Z","updated_at":"2019-10-03T13:30:00.413Z","actor":{"username":"iyakovlev","cleared":false,"url":"/iyakovlev","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/745/0021196ae41e34df146de08f7438520dcebfded9_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"badoo","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6176799,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Scenario #1: note that this attack is not a phishing attack. With phishing, the victim navigates to an untrusted URL, for example badooooo.com instead of badoo.com, and enters his details there. In the scenario I propose, the victim never navigates to an untrusted URL, and even at the time the victim enters his details, the address bar shows still http://www.odnoklassniki.ru.\n\nA HSTS header would make this scenario indeed harder to exploit, but that's not the issue I'm reporting. Even with a HSTS header present, it would still be good practice to link to the http rather than https version of odnoklassniki, as the user might not have visited odnoklassniki within the HSTS max age in the current browser. Note that we're not talking here about a user himself typing in a http URL, but the user being redirected to http from a https site, which the user is less likely to notice.\n\nScenario #2: As PoC, I uploaded the following video. This video demonstrates the attack in which an attacker with name 'Matthijs' manages to log himself in to the victim's browser.\n\nhttps://vimeo.com/369943740 with password aji3mai5dlufn3a\n\nThis video is best understood in combination with the textual description 'steps to reproduce' above.","markdown_message":"\u003cp\u003eScenario #1: note that this attack is not a phishing attack. With phishing, the victim navigates to an untrusted URL, for example badooooo.com instead of badoo.com, and enters his details there. In the scenario I propose, the victim never navigates to an untrusted URL, and even at the time the victim enters his details, the address bar shows still \u003ca title=\"http://www.odnoklassniki.ru\" href=\"/redirect?url=http%3A%2F%2Fwww.odnoklassniki.ru\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.odnoklassniki.ru\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eA HSTS header would make this scenario indeed harder to exploit, but that\u0026#39;s not the issue I\u0026#39;m reporting. Even with a HSTS header present, it would still be good practice to link to the http rather than https version of odnoklassniki, as the user might not have visited odnoklassniki within the HSTS max age in the current browser. Note that we\u0026#39;re not talking here about a user himself typing in a http URL, but the user being redirected to http from a https site, which the user is less likely to notice.\u003c/p\u003e\n\n\u003cp\u003eScenario #2: As PoC, I uploaded the following video. This video demonstrates the attack in which an attacker with name \u0026#39;Matthijs\u0026#39; manages to log himself in to the victim\u0026#39;s browser.\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://vimeo.com/369943740\" href=\"/redirect?url=https%3A%2F%2Fvimeo.com%2F369943740\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://vimeo.com/369943740\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e with password aji3mai5dlufn3a\u003c/p\u003e\n\n\u003cp\u003eThis video is best understood in combination with the textual description \u0026#39;steps to reproduce\u0026#39; above.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-10-30T22:01:26.418Z","updated_at":"2019-10-30T22:01:26.418Z","actor":{"username":"matthijsmelissen","cleared":false,"url":"/matthijsmelissen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"badoo","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6245428,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Please let me know if I can provide anymore information!","markdown_message":"\u003cp\u003ePlease let me know if I can provide anymore information!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-07T20:24:45.342Z","updated_at":"2019-11-07T20:24:45.342Z","actor":{"username":"matthijsmelissen","cleared":false,"url":"/matthijsmelissen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"badoo","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6345070,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hey.\nThank you for the report. We are on this and I'll be back with updates later.\nCheers.","markdown_message":"\u003cp\u003eHey.\u003cbr\u003e\nThank you for the report. We are on this and I\u0026#39;ll be back with updates later.\u003cbr\u003e\nCheers.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-19T11:22:02.857Z","updated_at":"2019-11-19T11:22:02.857Z","actor":{"username":"uyga","cleared":false,"url":"/uyga","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/780/942fbff2730b14a4cb3450a1c78b108cf3abbe91_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"badoo","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6367521,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hey.\nThis one should be fixed. Could you confirm this, please?\nThank you!","markdown_message":"\u003cp\u003eHey.\u003cbr\u003e\nThis one should be fixed. Could you confirm this, please?\u003cbr\u003e\nThank you!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-21T10:55:48.891Z","updated_at":"2019-11-21T10:55:48.891Z","actor":{"url":"/badoo","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/926/2d5179ec8d7d7c36af59a55d318dace33c3aa109_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Badoo"}},"bounty_amount":"150.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"badoo","collaborator":{"username":"matthijsmelissen","url":"/matthijsmelissen"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6367522,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-21T10:55:56.949Z","updated_at":"2019-11-21T10:55:56.949Z","actor":{"username":"uyga","cleared":false,"url":"/uyga","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/780/942fbff2730b14a4cb3450a1c78b108cf3abbe91_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"matthijsmelissen","url":"/matthijsmelissen"},"genius_execution_id":null,"team_handle":"badoo","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6367816,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, I can confirm the issue is now resolved. Thanks for addressing this, and thank you for the bounty!","markdown_message":"\u003cp\u003eHi, I can confirm the issue is now resolved. Thanks for addressing this, and thank you for the bounty!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-21T12:03:22.659Z","updated_at":"2019-11-21T12:03:22.659Z","actor":{"username":"matthijsmelissen","cleared":false,"url":"/matthijsmelissen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"badoo","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6367850,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-21T12:12:33.923Z","updated_at":"2019-11-21T12:12:33.923Z","first_to_agree":true,"actor":{"username":"matthijsmelissen","cleared":false,"url":"/matthijsmelissen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"badoo","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6603410,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-21T12:12:34.847Z","updated_at":"2019-12-21T12:12:34.847Z","actor":{"url":"/badoo","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/926/2d5179ec8d7d7c36af59a55d318dace33c3aa109_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Badoo"}},"genius_execution_id":null,"team_handle":"badoo","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}