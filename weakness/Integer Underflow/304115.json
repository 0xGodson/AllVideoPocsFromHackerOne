{"id":304115,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDQxMTU=","url":"https://hackerone.com/reports/304115","title":"Integer Underflow @ ossl_cipher_pkcs5_keyivgen ","state":"Closed","substate":"informative","severity_rating":"none","readable_substate":"Informative","created_at":"2018-01-11T20:55:21.152Z","submitted_at":"2018-01-11T20:55:21.152Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"finb","url":"/finb","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/116/607/e94dc1d2039dc6ca53eb72d1ef6991346ac4de29_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":7724,"url":"https://hackerone.com/ruby","handle":"ruby","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Ruby","twitter_handle":"","website":"https://www.ruby-lang.org","about":"A Programmer's Best Friend"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-02-23T07:18:57.620Z","bug_reporter_agreed_on_going_public_at":"2018-01-12T13:38:42.880Z","team_member_agreed_on_going_public_at":"2018-02-23T07:18:57.553Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Integer Underflow @ ossl_cipher_pkcs5_keyivgen \nfile : ext/openssl/ossl_cipher.c\naffected parameter: iterations\n\nINFO\nGenerates and sets the key/IV based on a password.\ncall-seq:\n```\ncipher.pkcs5_keyivgen(pass, salt = nil, iterations = 2048, digest = \"MD5\") -\u003e nil\n```\n\n\nANALYSIS\niter(int) in ossl_cipher_pkcs5_keyivgen  which holds iterations value is not validated before use.\ntherefore passed on to openssl library function EVP_BytesToKey which loops over\niter(iterations) using count\n```\nfor (i = 1; i \u003c (unsigned int)count; i++) {\n  if (!EVP_DigestInit_ex(c, md, NULL))\n  [code redacted]\n]\n```\nif count aka iterations is negative this loop runs forever and therefore causing \nruby to hang and eat up memory since allocation are performed during \nthis loop and \"i\" can never be greater than count\n\nPOC\n```\nrequire 'digest'\nrequire 'openssl'\nrequire 'base64'\n\ndata = 'abc'\nkey = '1234567887654321'\niv = key[0..7]\ncipher = OpenSSL::Cipher::Cipher.new('DES-EDE3-CBC') # or any other algorithm?\n\ncipher.encrypt\ncipher.pkcs5_keyivgen(key, iv, -1)\noutput = cipher.update(data)\noutput \u003c\u003c cipher.final\n```\n\nCONFIGURATIONS\n./ruby -v\nruby 2.6.0dev (2018-01-11 trunk 61764) [x86_64-linux]\n\nopenssl version\nOpenSSL 1.0.1t  3 May 2016\n\n## Impact\n\nThis result in a DDOS Attack","vulnerability_information_html":"\u003cp\u003eInteger Underflow @ ossl_cipher_pkcs5_keyivgen \u003cbr\u003e\nfile : ext/openssl/ossl_cipher.c\u003cbr\u003e\naffected parameter: iterations\u003c/p\u003e\n\n\u003cp\u003eINFO\u003cbr\u003e\nGenerates and sets the key/IV based on a password.\u003cbr\u003e\ncall-seq:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ecipher.pkcs5_keyivgen(pass, salt = nil, iterations = 2048, digest = \u0026quot;MD5\u0026quot;) -\u0026gt; nil\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eANALYSIS\u003cbr\u003e\niter(int) in ossl_cipher_pkcs5_keyivgen  which holds iterations value is not validated before use.\u003cbr\u003e\ntherefore passed on to openssl library function EVP_BytesToKey which loops over\u003cbr\u003e\niter(iterations) using count\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003efor (i = 1; i \u0026lt; (unsigned int)count; i++) {\n  if (!EVP_DigestInit_ex(c, md, NULL))\n  [code redacted]\n]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eif count aka iterations is negative this loop runs forever and therefore causing \u003cbr\u003e\nruby to hang and eat up memory since allocation are performed during \u003cbr\u003e\nthis loop and \u0026quot;i\u0026quot; can never be greater than count\u003c/p\u003e\n\n\u003cp\u003ePOC\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003erequire \u0026#39;digest\u0026#39;\nrequire \u0026#39;openssl\u0026#39;\nrequire \u0026#39;base64\u0026#39;\n\ndata = \u0026#39;abc\u0026#39;\nkey = \u0026#39;1234567887654321\u0026#39;\niv = key[0..7]\ncipher = OpenSSL::Cipher::Cipher.new(\u0026#39;DES-EDE3-CBC\u0026#39;) # or any other algorithm?\n\ncipher.encrypt\ncipher.pkcs5_keyivgen(key, iv, -1)\noutput = cipher.update(data)\noutput \u0026lt;\u0026lt; cipher.final\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eCONFIGURATIONS\u003cbr\u003e\n./ruby -v\u003cbr\u003e\nruby 2.6.0dev (2018-01-11 trunk 61764) [x86_64-linux]\u003c/p\u003e\n\n\u003cp\u003eopenssl version\u003cbr\u003e\nOpenSSL 1.0.1t  3 May 2016\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThis result in a DDOS Attack\u003c/p\u003e\n","weakness":{"id":16,"name":"Integer Underflow"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":0,"voters":[],"severity":{"rating":"none","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2279432,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e if count aka iterations is negative this loop runs forever and therefore causing \nruby to hang and eat up memory since allocation are performed during \nthis loop and \"i\" can never be greater than count\n\nCorrection: technically the loop does not run forever since [the variable \"i\" is declared as an \"unsigned int\"](https://github.com/openssl/openssl/blob/a41a6120cdcb7e883481bc1bed55e7157c9255c4/crypto/evp/evp_key.c#L82). Also, the memory consumption is not proportional to the iteration count.\n\nWhile it is certainly a bug that OpenSSL::Cipher#pkcs5_keyivgen accepts a non-positive number as the iteration count, this is not considered a security issue. Applications passing user input as the iteration count are vulnerable to DoS attack without this bug, by accepting a large number.","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003eif count aka iterations is negative this loop runs forever and therefore causing \u003cbr\u003e\nruby to hang and eat up memory since allocation are performed during \u003cbr\u003e\nthis loop and \u0026quot;i\u0026quot; can never be greater than count\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eCorrection: technically the loop does not run forever since \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fopenssl%2Fopenssl%2Fblob%2Fa41a6120cdcb7e883481bc1bed55e7157c9255c4%2Fcrypto%2Fevp%2Fevp_key.c%23L82\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ethe variable \u0026quot;i\u0026quot; is declared as an \u0026quot;unsigned int\u0026quot;\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Also, the memory consumption is not proportional to the iteration count.\u003c/p\u003e\n\n\u003cp\u003eWhile it is certainly a bug that OpenSSL::Cipher#pkcs5_keyivgen accepts a non-positive number as the iteration count, this is not considered a security issue. Applications passing user input as the iteration count are vulnerable to DoS attack without this bug, by accepting a large number.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-12T02:26:54.105Z","updated_at":"2018-01-12T02:26:54.105Z","actor":{"username":"rhe","cleared":false,"url":"/rhe","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/970/b790d7ee54de6cc2bcc9c54c34b70cd0dfd54fc4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2279869,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-12T10:35:04.007Z","updated_at":"2018-01-12T10:35:04.007Z","additional_data":{"old_severity":"Medium","new_severity":"None","old_severity_id":107297,"new_severity_id":107420},"actor":{"username":"rhe","cleared":false,"url":"/rhe","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/970/b790d7ee54de6cc2bcc9c54c34b70cd0dfd54fc4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2279870,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Patch: https://github.com/ruby/openssl/pull/184","markdown_message":"\u003cp\u003ePatch: \u003ca title=\"https://github.com/ruby/openssl/pull/184\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fruby%2Fopenssl%2Fpull%2F184\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/ruby/openssl/pull/184\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-12T10:35:13.908Z","updated_at":"2018-01-12T10:35:13.908Z","actor":{"username":"rhe","cleared":false,"url":"/rhe","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/970/b790d7ee54de6cc2bcc9c54c34b70cd0dfd54fc4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2280112,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem \nThanks for the quick feedback.\n\nThanks","markdown_message":"\u003cp\u003eNo problem \u003cbr\u003e\nThanks for the quick feedback.\u003c/p\u003e\n\n\u003cp\u003eThanks\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-12T13:37:40.982Z","updated_at":"2018-01-12T13:37:40.982Z","actor":{"username":"finb","cleared":false,"url":"/finb","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/607/e94dc1d2039dc6ca53eb72d1ef6991346ac4de29_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2280116,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-12T13:38:42.914Z","updated_at":"2018-01-12T13:38:42.914Z","first_to_agree":true,"actor":{"username":"finb","cleared":false,"url":"/finb","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/607/e94dc1d2039dc6ca53eb72d1ef6991346ac4de29_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2424146,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-23T07:18:57.583Z","updated_at":"2018-02-23T07:18:57.583Z","actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2424147,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-23T07:18:57.642Z","updated_at":"2018-02-23T07:18:57.642Z","actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}