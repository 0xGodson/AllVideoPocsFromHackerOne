{"id":773313,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83NzMzMTM=","url":"https://hackerone.com/reports/773313","title":"Port and service scanning on localhost due to improper URL validation.","state":"Closed","substate":"not-applicable","severity_rating":"medium","readable_substate":"N/A","created_at":"2020-01-13T09:25:45.926Z","submitted_at":"2020-01-13T09:25:45.926Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"vshmuk","url":"/vshmuk","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":35663,"url":"https://hackerone.com/curl","handle":"curl","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"curl","twitter_handle":"","website":"https://curl.se","about":"cURL is a computer software project providing a library and command-line tool for transferring data using various protocols."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-01-15T07:38:19.186Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-01-13T22:42:24.961Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nGenerally web masters and developers protect user-accessible CURL from requesting forbidden domains so that the attacker is not able to access internal resources. It is usually done using regular expressions.\nMostly addresses like 127.x.x.x, 192.168.x.x and \"integer\" notation of IP addresses (like 2130706433 = 127.0.0.1) are filtered out before executing curl using wrapper scripts.\nBut the ' * ' symbol is valid for CURL, allowing to request localhost's internal web resources and to scan ports. Unfortunately, since http0.9 is turned off by default now, it's harder to easily scan ports (without accessing stderr by the attacker). But if FTP protocol is not disabled, port scanning can still be achieved using time-based attack: active refusal of a closed port takes much less time than connecting by FTP to any other open port.\nAs far as i see, ' * ' and 'localhost' are not synonyms, and ' * ' string should be filtered out not on the webmaster's side but from inside of CURL.\n\n## Steps To Reproduce:\n```\n$ ./src/curl -V\ncurl 7.69.0-DEV (x86_64-pc-linux-gnu) libcurl/7.69.0-DEV OpenSSL/1.1.1d\n\n$ ./src/curl -v \"*\"\n*   Trying ::1:80...\n* TCP_NODELAY set\n* connect to ::1 port 80 failed: Connection refused\n*   Trying 127.0.0.1:80...\n* TCP_NODELAY set\n* connect to 127.0.0.1 port 80 failed: Connection refused\n* Failed to connect to * port 80: Connection refused\n* Closing connection 0\ncurl: (7) Failed to connect to * port 80: Connection refused\n\n$ ./src/curl -v \"*:8888\"\n*   Trying ::1:8888...\n* TCP_NODELAY set\n* connect to ::1 port 8888 failed: Connection refused\n*   Trying 127.0.0.1:8888...\n* TCP_NODELAY set\n* Connected to * (127.0.0.1) port 8888 (#0)\n\u003e GET / HTTP/1.1\n\u003e Host: *:8888\n\u003e User-Agent: curl/7.69.0-DEV\n\u003e Accept: */*\n\u003e \n\u003cskip\u003e\nHello world!\n* Closing connection 0\n\n$ ./src/curl -v \"ftp://*:8888\"\n*   Trying ::1:8888...\n* TCP_NODELAY set\n* connect to ::1 port 8888 failed: Connection refused\n*   Trying 127.0.0.1:8888...\n* TCP_NODELAY set\n* Connected to * (127.0.0.1) port 8888 (#0)\n^C\n\n./src/curl -v \"ftp://*:80\"\n*   Trying ::1:80...\n* TCP_NODELAY set\n* connect to ::1 port 80 failed: Connection refused\n*   Trying 127.0.0.1:80...\n* TCP_NODELAY set\n* connect to 127.0.0.1 port 80 failed: Connection refused\n* Failed to connect to * port 80: Connection refused\n* Closing connection 0\ncurl: (7) Failed to connect to * port 80: Connection refused\n```\n\n## Supporting Material/References:\n\nAccording to https://tools.ietf.org/html/rfc1034, wildcards are special symbols in DNS and should not be used as domain names..\n\n## Impact\n\nThe vulnerability allows attacker to at least access internal web resources restricted to localhost, or at most to scan locally opened ports and expose services running on the machine.","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003eGenerally web masters and developers protect user-accessible CURL from requesting forbidden domains so that the attacker is not able to access internal resources. It is usually done using regular expressions.\u003cbr\u003e\nMostly addresses like 127.x.x.x, 192.168.x.x and \u0026quot;integer\u0026quot; notation of IP addresses (like 2130706433 = 127.0.0.1) are filtered out before executing curl using wrapper scripts.\u003cbr\u003e\nBut the \u0026#39; * \u0026#39; symbol is valid for CURL, allowing to request localhost\u0026#39;s internal web resources and to scan ports. Unfortunately, since http0.9 is turned off by default now, it\u0026#39;s harder to easily scan ports (without accessing stderr by the attacker). But if FTP protocol is not disabled, port scanning can still be achieved using time-based attack: active refusal of a closed port takes much less time than connecting by FTP to any other open port.\u003cbr\u003e\nAs far as i see, \u0026#39; * \u0026#39; and \u0026#39;localhost\u0026#39; are not synonyms, and \u0026#39; * \u0026#39; string should be filtered out not on the webmaster\u0026#39;s side but from inside of CURL.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ ./src/curl -V\ncurl 7.69.0-DEV (x86_64-pc-linux-gnu) libcurl/7.69.0-DEV OpenSSL/1.1.1d\n\n$ ./src/curl -v \u0026quot;*\u0026quot;\n*   Trying ::1:80...\n* TCP_NODELAY set\n* connect to ::1 port 80 failed: Connection refused\n*   Trying 127.0.0.1:80...\n* TCP_NODELAY set\n* connect to 127.0.0.1 port 80 failed: Connection refused\n* Failed to connect to * port 80: Connection refused\n* Closing connection 0\ncurl: (7) Failed to connect to * port 80: Connection refused\n\n$ ./src/curl -v \u0026quot;*:8888\u0026quot;\n*   Trying ::1:8888...\n* TCP_NODELAY set\n* connect to ::1 port 8888 failed: Connection refused\n*   Trying 127.0.0.1:8888...\n* TCP_NODELAY set\n* Connected to * (127.0.0.1) port 8888 (#0)\n\u0026gt; GET / HTTP/1.1\n\u0026gt; Host: *:8888\n\u0026gt; User-Agent: curl/7.69.0-DEV\n\u0026gt; Accept: */*\n\u0026gt; \n\u0026lt;skip\u0026gt;\nHello world!\n* Closing connection 0\n\n$ ./src/curl -v \u0026quot;ftp://*:8888\u0026quot;\n*   Trying ::1:8888...\n* TCP_NODELAY set\n* connect to ::1 port 8888 failed: Connection refused\n*   Trying 127.0.0.1:8888...\n* TCP_NODELAY set\n* Connected to * (127.0.0.1) port 8888 (#0)\n^C\n\n./src/curl -v \u0026quot;ftp://*:80\u0026quot;\n*   Trying ::1:80...\n* TCP_NODELAY set\n* connect to ::1 port 80 failed: Connection refused\n*   Trying 127.0.0.1:80...\n* TCP_NODELAY set\n* connect to 127.0.0.1 port 80 failed: Connection refused\n* Failed to connect to * port 80: Connection refused\n* Closing connection 0\ncurl: (7) Failed to connect to * port 80: Connection refused\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cp\u003eAccording to \u003ca title=\"https://tools.ietf.org/html/rfc1034\" href=\"/redirect?url=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc1034\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://tools.ietf.org/html/rfc1034\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, wildcards are special symbols in DNS and should not be used as domain names..\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThe vulnerability allows attacker to at least access internal web resources restricted to localhost, or at most to scan locally opened ports and expose services running on the machine.\u003c/p\u003e\n","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":0,"voters":[],"severity":{"rating":"medium","score":6.3,"author_type":"User","metrics":{"attack_vector":"adjacent","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"low"}},"structured_scope":{"databaseId":18844,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/curl/curl","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":6754199,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your report. I don't think this is a security problem.\n\n## URL\n\nAccording to [RFC 3986 section 3.2.2](https://tools.ietf.org/html/rfc3986#section-3.2.2) the asterisk (`*`) is a valid component of the 'host' in a URL so thus curl is rightfully accepting it as far as I can see.\n\nWhat '*' resolves to is then a question to `getaddrinfo` or other suitable name resolve function, and in the getaddrinfo case it seems it resolves to 127.0.0.1. I haven't seen that documented though.\n\nJust because it gets accepted by curl and gets resolved doesn't mean that it is ever sent over DNS (regarding your comment on RFC 1034).\n\n## Filtering IP ranges\n\nAssuming that you can filter out local IP accesses by blacklisting certain host names or URLs is already a futile method and **will not work**. If you accept a URL or host name given by a user, that *might* resolve to 127.0.0.1 and you cannot know until you've resolved the host name in the same way curl does.  You need to block private IP ranges at another layer. I.e `coolsite.example.com` can just as well resolve to 127.0.0.1 as well.","markdown_message":"\u003cp\u003eThanks for your report. I don\u0026#39;t think this is a security problem.\u003c/p\u003e\n\n\u003ch2 id=\"url\"\u003eURL\u003c/h2\u003e\n\n\u003cp\u003eAccording to \u003ca href=\"/redirect?url=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc3986%23section-3.2.2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eRFC 3986 section 3.2.2\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e the asterisk (\u003ccode\u003e*\u003c/code\u003e) is a valid component of the \u0026#39;host\u0026#39; in a URL so thus curl is rightfully accepting it as far as I can see.\u003c/p\u003e\n\n\u003cp\u003eWhat \u0026#39;*\u0026#39; resolves to is then a question to \u003ccode\u003egetaddrinfo\u003c/code\u003e or other suitable name resolve function, and in the getaddrinfo case it seems it resolves to 127.0.0.1. I haven\u0026#39;t seen that documented though.\u003c/p\u003e\n\n\u003cp\u003eJust because it gets accepted by curl and gets resolved doesn\u0026#39;t mean that it is ever sent over DNS (regarding your comment on RFC 1034).\u003c/p\u003e\n\n\u003ch2 id=\"filtering-ip-ranges\"\u003eFiltering IP ranges\u003c/h2\u003e\n\n\u003cp\u003eAssuming that you can filter out local IP accesses by blacklisting certain host names or URLs is already a futile method and \u003cstrong\u003ewill not work\u003c/strong\u003e. If you accept a URL or host name given by a user, that \u003cem\u003emight\u003c/em\u003e resolve to 127.0.0.1 and you cannot know until you\u0026#39;ve resolved the host name in the same way curl does.  You need to block private IP ranges at another layer. I.e \u003ccode\u003ecoolsite.example.com\u003c/code\u003e can just as well resolve to 127.0.0.1 as well.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T11:09:56.752Z","updated_at":"2020-01-13T11:09:56.752Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/459/380/963f64725677dda4f5113219588e7d0c1ab9abaa_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6754649,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"glibc treats a single asterisk deliberately as a NULL host:\n\nhttps://sourceware.org/git/?p=glibc.git;a=blob;f=sysdeps/posix/getaddrinfo.c;h=2e50dbc98fc24fd3f610fcab3d732acd52cd3b00;hb=0a8262a1b269f8f1602933248e69dfb041aab7a2#l2168","markdown_message":"\u003cp\u003eglibc treats a single asterisk deliberately as a NULL host:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://sourceware.org/git/?p=glibc.git%3Ba=blob%3Bf=sysdeps/posix/getaddrinfo.c%3Bh=2e50dbc98fc24fd3f610fcab3d732acd52cd3b00%3Bhb=0a8262a1b269f8f1602933248e69dfb041aab7a2#l2168\" href=\"/redirect?url=https%3A%2F%2Fsourceware.org%2Fgit%2F%3Fp%3Dglibc.git%253Ba%3Dblob%253Bf%3Dsysdeps%2Fposix%2Fgetaddrinfo.c%253Bh%3D2e50dbc98fc24fd3f610fcab3d732acd52cd3b00%253Bhb%3D0a8262a1b269f8f1602933248e69dfb041aab7a2%23l2168\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://sourceware.org/git/?p=glibc.git%3Ba=blob%3Bf=sysdeps/posix/getaddrinfo.c%3Bh=2e50dbc98fc24fd3f610fcab3d732acd52cd3b00%3Bhb=0a8262a1b269f8f1602933248e69dfb041aab7a2#l2168\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T11:29:50.549Z","updated_at":"2020-01-13T11:29:50.549Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/459/380/963f64725677dda4f5113219588e7d0c1ab9abaa_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6754843,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, it seems that '*' resolves to 127.0.0.1 in getaddrinfo(). It's weird. So, if it's not a bug in curl, then sorry for wasting your time","markdown_message":"\u003cp\u003eYes, it seems that \u0026#39;*\u0026#39; resolves to 127.0.0.1 in getaddrinfo(). It\u0026#39;s weird. So, if it\u0026#39;s not a bug in curl, then sorry for wasting your time\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T11:46:50.382Z","updated_at":"2020-01-13T11:46:50.382Z","actor":{"username":"vshmuk","cleared":false,"url":"/vshmuk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6754971,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Regarding getaddrinfo.\nStrange, but Python's socket.getaddrinfo() returns 127.0.0.1, but a C-compiled syscall returns NULL, as you mentioned","markdown_message":"\u003cp\u003eRegarding getaddrinfo.\u003cbr\u003e\nStrange, but Python\u0026#39;s socket.getaddrinfo() returns 127.0.0.1, but a C-compiled syscall returns NULL, as you mentioned\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T11:55:20.718Z","updated_at":"2020-01-13T11:55:20.718Z","actor":{"username":"vshmuk","cleared":false,"url":"/vshmuk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6755184,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"More interesting, in PHP it's not resolved at all:\n\n```\n\u003c?php\necho (gethostbyname(\"example.com\").\"\\n\");\necho (gethostbyname(\"127.0.0.1\").\"\\n\");\necho (gethostbyname(\"2130706433\").\"\\n\");\necho (gethostbyname(\"*\").\"\\n\");\n?\u003e\n```\nreturns\n```\n93.184.216.34\n127.0.0.1\n127.0.0.1\n*\n```\n\nUPD: Perl's gethostbyname returns the same as above","markdown_message":"\u003cp\u003eMore interesting, in PHP it\u0026#39;s not resolved at all:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003egethostbyname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;example.com\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003egethostbyname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;127.0.0.1\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003egethostbyname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;2130706433\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003egethostbyname\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;*\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ereturns\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e93.184.216.34\n127.0.0.1\n127.0.0.1\n*\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eUPD: Perl\u0026#39;s gethostbyname returns the same as above\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T12:01:40.288Z","updated_at":"2020-01-13T12:05:26.164Z","actor":{"username":"vshmuk","cleared":false,"url":"/vshmuk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6755879,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The \"*\" thing is a glibc specific treatment it seems so other libcs won't behave the same and neither will curl if you build with c-ares. Still, the main point remains that you cannot block local IP range access by blacklisting host names used in the URL.\n\nThis is not a security problem.","markdown_message":"\u003cp\u003eThe \u0026quot;*\u0026quot; thing is a glibc specific treatment it seems so other libcs won\u0026#39;t behave the same and neither will curl if you build with c-ares. Still, the main point remains that you cannot block local IP range access by blacklisting host names used in the URL.\u003c/p\u003e\n\n\u003cp\u003eThis is not a security problem.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T13:37:15.791Z","updated_at":"2020-01-13T13:39:50.050Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/459/380/963f64725677dda4f5113219588e7d0c1ab9abaa_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6756003,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e  Still, the main point remains that you cannot block local IP range access by blacklisting.\n\nI'm not arguing with that. The blacklisting was just an example.\n\nBut anyway, so what is the correct way of protection for a developer except direct blacklisting \" * \"?\n\nAnd also, i'm a little bit confused why the asterisk is resolved to 127.0.0.1 if you've just proved that glibc returns NULL and no other software returns 127.0.0.1? Where is \"127.0.0.1\" string taken from?","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003eStill, the main point remains that you cannot block local IP range access by blacklisting.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI\u0026#39;m not arguing with that. The blacklisting was just an example.\u003c/p\u003e\n\n\u003cp\u003eBut anyway, so what is the correct way of protection for a developer except direct blacklisting \u0026quot; * \u0026quot;?\u003c/p\u003e\n\n\u003cp\u003eAnd also, i\u0026#39;m a little bit confused why the asterisk is resolved to 127.0.0.1 if you\u0026#39;ve just proved that glibc returns NULL and no other software returns 127.0.0.1? Where is \u0026quot;127.0.0.1\u0026quot; string taken from?\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T13:40:47.426Z","updated_at":"2020-01-13T13:43:18.146Z","actor":{"username":"vshmuk","cleared":false,"url":"/vshmuk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6756085,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"glibc does *not* return NULL on `*` if the service argument is set. That's exactly what curl does and as you've seen, that makes it do a localhost resolve (it doesn't actually return \"127.0.0.1\", it seems it returns the address of localhost so on my machine curl \"*\" connects to ::1).\n\nIf you want to block your program from accessing local IP ranges, you *need* to inspect and block the IP address that curl resolves the give host name to. The [libcurl security](https://curl.haxx.se/libcurl/security.html#Local) man page describes in this in the \"Local resources\" section and suggests using CURLOPT_OPENSOCKETFUNCTION for that.\n\nBut this is not a security problem and not a discussion forum. If you have libcurl questions, take them to the curl-library list. For curl tool questions, use the curl-users list.","markdown_message":"\u003cp\u003eglibc does \u003cem\u003enot\u003c/em\u003e return NULL on \u003ccode\u003e*\u003c/code\u003e if the service argument is set. That\u0026#39;s exactly what curl does and as you\u0026#39;ve seen, that makes it do a localhost resolve (it doesn\u0026#39;t actually return \u0026quot;127.0.0.1\u0026quot;, it seems it returns the address of localhost so on my machine curl \u0026quot;*\u0026quot; connects to ::1).\u003c/p\u003e\n\n\u003cp\u003eIf you want to block your program from accessing local IP ranges, you \u003cem\u003eneed\u003c/em\u003e to inspect and block the IP address that curl resolves the give host name to. The \u003ca href=\"/redirect?url=https%3A%2F%2Fcurl.haxx.se%2Flibcurl%2Fsecurity.html%23Local\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003elibcurl security\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e man page describes in this in the \u0026quot;Local resources\u0026quot; section and suggests using CURLOPT_OPENSOCKETFUNCTION for that.\u003c/p\u003e\n\n\u003cp\u003eBut this is not a security problem and not a discussion forum. If you have libcurl questions, take them to the curl-library list. For curl tool questions, use the curl-users list.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T13:50:24.996Z","updated_at":"2020-01-13T13:51:37.518Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/459/380/963f64725677dda4f5113219588e7d0c1ab9abaa_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6756100,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e glibc does not return NULL on \" * \" if the service argument is set.\n\n\nIn my case i see the following:\n```\n2168   if (name != NULL \u0026\u0026 name[0] == '*' \u0026\u0026 name[1] == 0)\n2169     name = NULL;\n```\n(from https://sourceware.org/git/?p=glibc.git;a=blob;f=sysdeps/posix/getaddrinfo.c;h=f813d85aa39d80a9f23f95368854213ebd60b46b;hb=HEAD)\nI've also tried setting and resetting service argument, and behavior was the same\n\n\u003e so on my machine curl \"*\" connects to ::1\n\nYes, it first tries to connect to ::1 as well\n","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003eglibc does not return NULL on \u0026quot; * \u0026quot; if the service argument is set.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eIn my case i see the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e2168   if (name != NULL \u0026amp;\u0026amp; name[0] == \u0026#39;*\u0026#39; \u0026amp;\u0026amp; name[1] == 0)\n2169     name = NULL;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e(from \u003ca title=\"https://sourceware.org/git/?p=glibc.git%3Ba=blob%3Bf=sysdeps/posix/getaddrinfo.c%3Bh=f813d85aa39d80a9f23f95368854213ebd60b46b%3Bhb=HEAD\" href=\"/redirect?url=https%3A%2F%2Fsourceware.org%2Fgit%2F%3Fp%3Dglibc.git%253Ba%3Dblob%253Bf%3Dsysdeps%2Fposix%2Fgetaddrinfo.c%253Bh%3Df813d85aa39d80a9f23f95368854213ebd60b46b%253Bhb%3DHEAD\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://sourceware.org/git/?p=glibc.git%3Ba=blob%3Bf=sysdeps/posix/getaddrinfo.c%3Bh=f813d85aa39d80a9f23f95368854213ebd60b46b%3Bhb=HEAD\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e)\u003cbr\u003e\nI\u0026#39;ve also tried setting and resetting service argument, and behavior was the same\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eso on my machine curl \u0026quot;*\u0026quot; connects to ::1\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eYes, it first tries to connect to ::1 as well\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T13:54:06.760Z","updated_at":"2020-01-13T13:55:11.004Z","actor":{"username":"vshmuk","cleared":false,"url":"/vshmuk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6756106,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"...","markdown_message":"\u003cp\u003e...\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T13:55:36.001Z","updated_at":"2020-01-13T13:55:36.001Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/459/380/963f64725677dda4f5113219588e7d0c1ab9abaa_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6756197,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, CURLOPT_OPENSOCKETFUNCTION saves in this situation. However, the nature of the conversion to localhost is still unclear to me. \nBut it goes outside of scope of our discussion, you are right.\n\n\u003e glibc does not return NULL on \" * \" if the service argument is set\n\nOops, it does NOT. There is no return. Shame on me! \nI am sorry","markdown_message":"\u003cp\u003eYes, CURLOPT_OPENSOCKETFUNCTION saves in this situation. However, the nature of the conversion to localhost is still unclear to me. \u003cbr\u003e\nBut it goes outside of scope of our discussion, you are right.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eglibc does not return NULL on \u0026quot; * \u0026quot; if the service argument is set\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eOops, it does NOT. There is no return. Shame on me! \u003cbr\u003e\nI am sorry\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T14:06:34.310Z","updated_at":"2020-01-13T14:10:23.417Z","actor":{"username":"vshmuk","cleared":false,"url":"/vshmuk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6756233,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"Thanks for your spent time","markdown_message":"\u003cp\u003eThanks for your spent time\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-13T14:10:50.214Z","updated_at":"2020-01-13T14:10:50.214Z","actor":{"username":"vshmuk","cleared":false,"url":"/vshmuk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6761207,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-13T22:42:24.980Z","updated_at":"2020-01-13T22:42:24.980Z","first_to_agree":true,"actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/459/380/963f64725677dda4f5113219588e7d0c1ab9abaa_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6771596,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@vshmuk, are you ok with us disclosing this report? That way it can be seen by external persons and serve as input and further outside discussions.","markdown_message":"\u003cp\u003e\u003ca href=\"/vshmuk\"\u003e@vshmuk\u003c/a\u003e, are you ok with us disclosing this report? That way it can be seen by external persons and serve as input and further outside discussions.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-14T21:47:12.598Z","updated_at":"2020-01-14T21:47:12.598Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/459/380/963f64725677dda4f5113219588e7d0c1ab9abaa_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6771703,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi!\nI think it's okay","markdown_message":"\u003cp\u003eHi!\u003cbr\u003e\nI think it\u0026#39;s okay\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-14T22:05:08.558Z","updated_at":"2020-01-14T22:05:08.558Z","actor":{"username":"vshmuk","cleared":false,"url":"/vshmuk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6774086,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-15T07:38:19.123Z","updated_at":"2020-01-15T07:38:19.123Z","actor":{"username":"bagder","cleared":false,"url":"/bagder","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/459/380/963f64725677dda4f5113219588e7d0c1ab9abaa_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"curl","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}