{"id":194790,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTQ3OTA=","url":"https://hackerone.com/reports/194790","title":"IDOR - Downloading all attachements if having access to a shared link","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-12-30T10:26:13.274Z","submitted_at":"2016-12-30T10:26:13.274Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"inhibitor181","url":"/inhibitor181","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-09-28T07:20:24.658Z","bug_reporter_agreed_on_going_public_at":"2017-08-29T07:20:17.382Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello, I have found that one can download all attachements if finds/has access to a public link (in this POC a shared task link). This is a big issue as one can download all the attachements of registered users, while the attacker is not actually logged in the application ! Also, I have found another link that leaks attachement names.\n\nBecause of the severity, I have attached a POC video.\n\nVideo description : at first, I will get a public task share link. With that link, I will have access to 2 tasks, only 1 witch has an attachement. By using burp calls, I will leak the names of other attachements. After this, I will try to view my attachement and download it. As you can see in the video, just changing the id form the link, allows me to download other restricted files !","vulnerability_information_html":"\u003cp\u003eHello, I have found that one can download all attachements if finds/has access to a public link (in this POC a shared task link). This is a big issue as one can download all the attachements of registered users, while the attacker is not actually logged in the application ! Also, I have found another link that leaks attachement names.\u003c/p\u003e\n\n\u003cp\u003eBecause of the severity, I have attached a POC video.\u003c/p\u003e\n\n\u003cp\u003eVideo description : at first, I will get a public task share link. With that link, I will have access to 2 tasks, only 1 witch has an attachement. By using burp calls, I will leak the names of other attachements. After this, I will try to view my attachement and download it. As you can see in the video, just changing the id form the link, allows me to download other restricted files !\u003c/p\u003e\n","bounty_amount":"888.0","formatted_bounty":"$888","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-09-28T07:20:17.435Z","allow_singular_disclosure_after":-102634246.19176304,"singular_disclosure_allowed":true,"vote_count":24,"voters":["jensec","mashoud1122","bl4de","bogdantcaciuc","vijay_kumar","mpz","eveeez","r3y","realtess","luckydivino","and 14 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1392099,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Good find, just a question regarding the actual \"download\" - can you specify which file you're actually downloading in this case? I understand the \"secret\" file is ID 101 but you're entering \"22\", which seems to be a different file - is it possible that file \"22\" is indeed accessible to the guest on purpose?","markdown_message":"\u003cp\u003eGood find, just a question regarding the actual \u0026quot;download\u0026quot; - can you specify which file you\u0026#39;re actually downloading in this case? I understand the \u0026quot;secret\u0026quot; file is ID 101 but you\u0026#39;re entering \u0026quot;22\u0026quot;, which seems to be a different file - is it possible that file \u0026quot;22\u0026quot; is indeed accessible to the guest on purpose?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-30T11:27:57.396Z","updated_at":"2016-12-30T11:27:57.396Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1392157,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mheiland . Somehing really bad is happening here. I finally managed to find something after almost 2 hours of trying to replicate this with controlled input. This is a cross account vulnerability. For info, the account that shared the task is : user2@sandbox-1\n\n1.  The POC that leaks only the attachement names is cross accounts ! The file damndaniel.exe is an attachement for a task that belongs to user1@sandbox-1\n2. The download vulnerability works __cross accounts__ regardless whether they are shared or not ! Example I found :\nThe id 2 contains the file \"Capture.PNG\" that actually is a file from another account, user1@sandbox-1. This file is located in My files / Music / Capture.PNG. __This folder is not shared__, it does not appear in the shared folder. The contents of this image are identical with the one downloaded by calling that download link with id 2.\n\nAlso, I have seen the image with ID 145 somewhere else but I cannot find it again unfortunatelly. I know this because I tought : \"Wow, someone actually put this very nice image with the mountains in the sandbox account\"\n\nThe ids also range from 2 to 145, witch is a very big gap that cannot contain only the files from one sandbox account. Not all work, but still many do.\n\nI will try to find something more, but this weekend I won't be at home. Is this enough for now for you ?\n","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mheiland\"\u003e@mheiland\u003c/a\u003e . Somehing really bad is happening here. I finally managed to find something after almost 2 hours of trying to replicate this with controlled input. This is a cross account vulnerability. For info, the account that shared the task is : user2@sandbox-1\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e The POC that leaks only the attachement names is cross accounts ! The file damndaniel.exe is an attachement for a task that belongs to user1@sandbox-1\u003c/li\u003e\n\u003cli\u003eThe download vulnerability works \u003cstrong\u003ecross accounts\u003c/strong\u003e regardless whether they are shared or not ! Example I found :\nThe id 2 contains the file \u0026quot;Capture.PNG\u0026quot; that actually is a file from another account, \u003ca title=\"user1@sandbox-1\" href=\"mailto:user1@sandbox-1\" rel=\"nofollow noopener noreferrer\"\u003euser1@sandbox-1\u003c/a\u003e. This file is located in My files / Music / Capture.PNG. \u003cstrong\u003eThis folder is not shared\u003c/strong\u003e, it does not appear in the shared folder. The contents of this image are identical with the one downloaded by calling that download link with id 2.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAlso, I have seen the image with ID 145 somewhere else but I cannot find it again unfortunatelly. I know this because I tought : \u0026quot;Wow, someone actually put this very nice image with the mountains in the sandbox account\u0026quot;\u003c/p\u003e\n\n\u003cp\u003eThe ids also range from 2 to 145, witch is a very big gap that cannot contain only the files from one sandbox account. Not all work, but still many do.\u003c/p\u003e\n\n\u003cp\u003eI will try to find something more, but this weekend I won\u0026#39;t be at home. Is this enough for now for you ?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-30T12:57:00.317Z","updated_at":"2016-12-30T12:57:00.317Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1392179,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Additions :\n- The file damdaniel.exe, witch belongs to user1 is a task item and is available for download with id 34 -\u003e so again, cross accounts download\n- Not that many files see, to bo accesible (about 30-40% between the ids 2-145) so that means that there is a special case there. Can the files perhaps be orphaned or moved internally to another folder so the folder validation is skipped ?","markdown_message":"\u003cp\u003eAdditions :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe file damdaniel.exe, witch belongs to user1 is a task item and is available for download with id 34 -\u0026gt; so again, cross accounts download\u003c/li\u003e\n\u003cli\u003eNot that many files see, to bo accesible (about 30-40% between the ids 2-145) so that means that there is a special case there. Can the files perhaps be orphaned or moved internally to another folder so the folder validation is skipped ?\u003c/li\u003e\n\u003c/ul\u003e\n","automated_response":false,"created_at":"2016-12-30T13:21:27.658Z","updated_at":"2016-12-30T13:21:27.658Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1392198,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@mheiland Last addition, this is the weirdest. I have finally found the image with id 145. It is the profile image for user user5@sandbox-1.open-xchange.com ... It has the same name and the same content.\n\nIt really seems that validations are not working as intended in regard to folders and users.","markdown_message":"\u003cp\u003e\u003ca href=\"/mheiland\"\u003e@mheiland\u003c/a\u003e Last addition, this is the weirdest. I have finally found the image with id 145. It is the profile image for user \u003ca title=\"user5@sandbox-1.open-xchange.com\" href=\"mailto:user5@sandbox-1.open-xchange.com\" rel=\"nofollow noopener noreferrer\"\u003euser5@sandbox-1.open-xchange.com\u003c/a\u003e ... It has the same name and the same content.\u003c/p\u003e\n\n\u003cp\u003eIt really seems that validations are not working as intended in regard to folders and users.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-30T13:57:25.049Z","updated_at":"2016-12-30T13:57:25.049Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1392216,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for the additional information, i think this is sufficient for now. Enjoy your weekend!\n\nWe're already looking in the validation methods for the \"attachments\" API, apparently permissions are checked based on the folder-id but not the object-id in this particular case. Profile pictures are attachments like all other and those IDs are incremented per context and used for other objects as well, therefor you're seeing a \"gap\" for since not every ID is used for an attachment.","markdown_message":"\u003cp\u003eThanks for the additional information, i think this is sufficient for now. Enjoy your weekend!\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;re already looking in the validation methods for the \u0026quot;attachments\u0026quot; API, apparently permissions are checked based on the folder-id but not the object-id in this particular case. Profile pictures are attachments like all other and those IDs are incremented per context and used for other objects as well, therefor you\u0026#39;re seeing a \u0026quot;gap\u0026quot; for since not every ID is used for an attachment.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-30T14:20:04.375Z","updated_at":"2016-12-30T14:20:04.375Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1398540,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-01-04T13:29:19.257Z","updated_at":"2017-01-04T13:29:19.257Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"inhibitor181","url":"/inhibitor181"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1398541,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-01-04T13:29:27.463Z","updated_at":"2017-01-04T13:29:27.463Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"888.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"inhibitor181","url":"/inhibitor181"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1404004,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@mheiland Hello, thanks for the bounty! I would like to test if this is fixed but the sandbox is not working anymore (503 error code). Will it come back next week or ?","markdown_message":"\u003cp\u003e\u003ca href=\"/mheiland\"\u003e@mheiland\u003c/a\u003e Hello, thanks for the bounty! I would like to test if this is fixed but the sandbox is not working anymore (503 error code). Will it come back next week or ?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-06T12:25:36.410Z","updated_at":"2017-01-06T12:25:36.410Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1404037,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Please note that we're tracking and resolving this defect outside of hackerone. I put it to resolved to award reputation, not to signal that the problem is already solved and deployed. The machine is a bit unstable currently since we're running a development version. It should be back in a few minutes.","markdown_message":"\u003cp\u003ePlease note that we\u0026#39;re tracking and resolving this defect outside of hackerone. I put it to resolved to award reputation, not to signal that the problem is already solved and deployed. The machine is a bit unstable currently since we\u0026#39;re running a development version. It should be back in a few minutes.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-06T12:52:20.824Z","updated_at":"2017-01-06T12:52:20.824Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1962207,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-29T07:20:17.407Z","updated_at":"2017-08-29T07:20:17.407Z","first_to_agree":true,"actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2029278,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-28T07:20:24.677Z","updated_at":"2017-09-28T07:20:24.677Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Open-Xchange"}},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}