{"id":204984,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDQ5ODQ=","url":"https://hackerone.com/reports/204984","title":"IDOR - Accessing other user's attachements via PUT /appsuite/api/files?action=saveAs","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-02-09T14:43:54.385Z","submitted_at":"2017-02-09T14:43:54.385Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"inhibitor181","url":"/inhibitor181","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-09-28T07:19:38.119Z","bug_reporter_agreed_on_going_public_at":"2017-08-29T07:19:29.181Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello, I have found a request in witch a user is able to copy other user's pattachements in his own folders and after that, he is able to download them or he is able to email them to another address or able to view them in browser.\n\nPOC\n-----------------\n```\nPUT /appsuite/api/files?action=saveAs\u0026attached=2\u0026attachment=1\u0026folder=41\u0026module=1\u0026session=4991e492365e4904bd8399333bc233de HTTP/1.1\nHost: sandbox.open-xchange.com\n//*headers, cookies*//\n\n{\"folder_id\":\"54\",\"description\":\"Description\"}\n```\nResponse\n```\nHTTP/1.1 200 OK\nServer: nginx\n//**//\n\n{\"data\":\"54/51\",\"timestamp\":1486649907803}\n```\n\nIn order for this to work you have to just pass in the GET parameter a folder id in where YOU have access for writing (it doesn't matter witch folder id is, you just need to be able to write in it!) and then change the attachement id. This will create a copy of the given attachement ID in the folder given in the JSON input (in the POC case 54). The server wil respond with the new folderID + file id.\n\nThen you can go to you files and see the copy of the targeted id.\n\nI have also attached 2 POC videos.\n\nIn the first you can see the attack. In the first seconds you can see that the `folder` parameter from the GET request is just being used for writing validation, it doesn't really happen anything with it, there is no validation whether the attachement is in the inputted folder or not. Then I will copy all the attachement across all the accounts (for example XXE and exif are in user2's account, and you can see I am logged in with user3).\n\nLater in the video I have clicked the wrong links (while in incognito mode I cannot open files in new tabs because I am logged out), but in the second one you can see the download is working. Also sending the file per email or opening in browser works. That is why I have uploaded video 2.\n\n","vulnerability_information_html":"\u003cp\u003eHello, I have found a request in witch a user is able to copy other user\u0026#39;s pattachements in his own folders and after that, he is able to download them or he is able to email them to another address or able to view them in browser.\u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePOC\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePUT /appsuite/api/files?action=saveAs\u0026amp;attached=2\u0026amp;attachment=1\u0026amp;folder=41\u0026amp;module=1\u0026amp;session=4991e492365e4904bd8399333bc233de HTTP/1.1\nHost: sandbox.open-xchange.com\n//*headers, cookies*//\n\n{\u0026quot;folder_id\u0026quot;:\u0026quot;54\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;Description\u0026quot;}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eResponse\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK\nServer: nginx\n//**//\n\n{\u0026quot;data\u0026quot;:\u0026quot;54/51\u0026quot;,\u0026quot;timestamp\u0026quot;:1486649907803}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn order for this to work you have to just pass in the GET parameter a folder id in where YOU have access for writing (it doesn\u0026#39;t matter witch folder id is, you just need to be able to write in it!) and then change the attachement id. This will create a copy of the given attachement ID in the folder given in the JSON input (in the POC case 54). The server wil respond with the new folderID + file id.\u003c/p\u003e\n\n\u003cp\u003eThen you can go to you files and see the copy of the targeted id.\u003c/p\u003e\n\n\u003cp\u003eI have also attached 2 POC videos.\u003c/p\u003e\n\n\u003cp\u003eIn the first you can see the attack. In the first seconds you can see that the \u003ccode\u003efolder\u003c/code\u003e parameter from the GET request is just being used for writing validation, it doesn\u0026#39;t really happen anything with it, there is no validation whether the attachement is in the inputted folder or not. Then I will copy all the attachement across all the accounts (for example XXE and exif are in user2\u0026#39;s account, and you can see I am logged in with user3).\u003c/p\u003e\n\n\u003cp\u003eLater in the video I have clicked the wrong links (while in incognito mode I cannot open files in new tabs because I am logged out), but in the second one you can see the download is working. Also sending the file per email or opening in browser works. That is why I have uploaded video 2.\u003c/p\u003e\n","bounty_amount":"888.0","formatted_bounty":"$888","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-09-28T07:19:29.212Z","allow_singular_disclosure_after":-102634520.44296043,"singular_disclosure_allowed":true,"vote_count":18,"voters":["jensec","mashoud1122","bl4de","vijay_kumar","eveeez","r3y","realtess","mr_r3boot","t-4-y-m","silv3rpoision","and 8 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1476699,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Thanks for the report, can you please specify where the attachments exist prior to copying them? Are they stored to another users Drive folder, or Mail...? ","markdown_message":"\u003cp\u003eThanks for the report, can you please specify where the attachments exist prior to copying them? Are they stored to another users Drive folder, or Mail...? \u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-10T09:53:34.385Z","updated_at":"2017-02-10T09:53:34.385Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1476738,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @mheiland . \n\nFor the actual testing I used the XXE file. It is located in user2 / calendar / appointments -\u003e as attachement.\nI have also made a new test now : Made with user1 a new task, uploaded a file in it ( sess_leak.html), then I have used with user3 a new request using the same POC with attachementId = 8 :\n\n```\nPUT /appsuite/api/files?action=saveAs\u0026attached=2\u0026attachment=8\u0026folder=41\u0026module=1\u0026session=ea1f84b1caf4403c9632778710b2cceb\u0026timezone=utc HTTP/1.1\n/**/\n\n{\"folder_id\":\"54\",\"description\":\"Description\"}\n```\n\nThe file from user1 was copied in user3 / My files.\n\nSo, this seems to affect calendar/task attachements, regardless in witch module they are or witch user has them. Doesn't seem to affect mail attachements or uploaded files. Or I haven't played with those parameters enough :)\n\n","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mheiland\"\u003e@mheiland\u003c/a\u003e . \u003c/p\u003e\n\n\u003cp\u003eFor the actual testing I used the XXE file. It is located in user2 / calendar / appointments -\u0026gt; as attachement.\u003cbr\u003e\nI have also made a new test now : Made with user1 a new task, uploaded a file in it ( sess_leak.html), then I have used with user3 a new request using the same POC with attachementId = 8 :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePUT /appsuite/api/files?action=saveAs\u0026amp;attached=2\u0026amp;attachment=8\u0026amp;folder=41\u0026amp;module=1\u0026amp;session=ea1f84b1caf4403c9632778710b2cceb\u0026amp;timezone=utc HTTP/1.1\n/**/\n\n{\u0026quot;folder_id\u0026quot;:\u0026quot;54\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;Description\u0026quot;}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe file from user1 was copied in user3 / My files.\u003c/p\u003e\n\n\u003cp\u003eSo, this seems to affect calendar/task attachements, regardless in witch module they are or witch user has them. Doesn\u0026#39;t seem to affect mail attachements or uploaded files. Or I haven\u0026#39;t played with those parameters enough :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-10T10:18:16.360Z","updated_at":"2017-02-10T10:18:16.360Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1476746,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"OK thanks for that information.","markdown_message":"\u003cp\u003eOK thanks for that information.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-10T10:24:24.052Z","updated_at":"2017-02-10T10:24:24.052Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1513171,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mheiland . Any update here ? I ask this because normally the reports are marked as unresolved and programmed for a fix in future in max 1 week and this was a pretty biggie issue.\n\nIf you haven't forgot about this and it didn't slip through the cracks I won't bother you with any more update requests in the future.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mheiland\"\u003e@mheiland\u003c/a\u003e . Any update here ? I ask this because normally the reports are marked as unresolved and programmed for a fix in future in max 1 week and this was a pretty biggie issue.\u003c/p\u003e\n\n\u003cp\u003eIf you haven\u0026#39;t forgot about this and it didn\u0026#39;t slip through the cracks I won\u0026#39;t bother you with any more update requests in the future.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-01T12:01:38.031Z","updated_at":"2017-03-01T12:01:38.031Z","actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1521533,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, we did not forget about this and actually have a fix ready. It's just not released yet. Also i was on vacation :)","markdown_message":"\u003cp\u003eHi, we did not forget about this and actually have a fix ready. It\u0026#39;s just not released yet. Also i was on vacation :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-06T11:22:18.899Z","updated_at":"2017-03-06T11:22:18.899Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1521849,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-06T14:16:41.855Z","updated_at":"2017-03-06T14:16:41.855Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"888.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"inhibitor181","url":"/inhibitor181"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1521852,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-06T14:16:53.609Z","updated_at":"2017-03-06T14:16:53.609Z","actor":{"username":"mheiland","cleared":false,"url":"/mheiland","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/425JKsXEnCYsDU1VA48SXXZV/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"inhibitor181","url":"/inhibitor181"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1962203,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-29T07:19:29.197Z","updated_at":"2017-08-29T07:19:29.197Z","first_to_agree":true,"actor":{"username":"inhibitor181","cleared":true,"url":"/inhibitor181","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/iK9ytFYT28QM6G5xrCaphqnv/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2029274,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-28T07:19:38.168Z","updated_at":"2017-09-28T07:19:38.168Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Open-Xchange"}},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}