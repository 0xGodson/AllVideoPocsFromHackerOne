{"id":629892,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82Mjk4OTI=","url":"https://hackerone.com/reports/629892","title":"Lack of CSRF header validation at https://g-mail.grammarly.com/profile","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-06-26T08:34:39.923Z","submitted_at":"2019-06-26T08:34:39.923Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"orlserg","url":"/orlserg","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/344/557/e52419d580024b46dfc518300c1293bb341bc0e8_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22746,"url":"https://hackerone.com/grammarly","handle":"grammarly","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/022/746/a2bf7f90c683af5214fcc74c1df6804286ee97ce_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/746/a2bf7f90c683af5214fcc74c1df6804286ee97ce_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Grammarly","twitter_handle":"","website":"https://www.grammarly.com","about":"Grammarly makes sure everything you type is clear, effective, and mistake-free."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-10-31T03:57:12.157Z","bug_reporter_agreed_on_going_public_at":"2019-10-31T03:57:12.058Z","team_member_agreed_on_going_public_at":"2019-10-30T13:21:44.481Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello!\n\n## Description\nI found that setting up a CORS in some places will check the protocol, but it allows using http scheme. In addition, any subdomain is considered trusted. If the origin is *http://www.grammarly.com*, then the server will respond: *Access-Control-Allow-Origin: http://www.grammarly.com*. That can lead to leakage of user data and unauthorized actions on behalf of the user.\n{F517015}\n\nIn fact, this means that an attacker can use the MITM attack (Wi-Fi, local networks, etc.) to substitute client requests, thus replacing the origin. \n\n####*Important note: I very carefully read the program policy and focus on the fact that MITM attack is not made on the existent grammarly sites.*\n\n## How it works\n{F517002}\n\nIf an attacker can perform a mitm attack on a user, he can replace the requested content of any unencrypted request and produce a 302 redirect of the user to http: //evil.grammarly.com. Since the request is not unencrypted, the attacker can also replace the response and implement javascript that performs a requests to vulnerable endpoints. Thus, the vulnerable enpoint will think that the request came from the origin of the trust it trusts and will execute the request.\n\nUsing a header to send a CSRF token protects against such attacks. But I found a place where verification of the transferred token is not performed.\n\nThis vulnerability was perfectly described by James Kettle on OWASP AppSec EU 2017. You can watch the description of the vulnerability on the link to his presentation. https://youtu.be/wgkj4ZgxI4c?t=1139\n\n## Vulnerable enpoints\n\n1) The malicious javascript will look like:\n\n```javascript\nvar xhttp = new XMLHttpRequest();\nxhttp.onreadystatechange = function() {\n   if (this.readyState == 4 \u0026\u0026 this.status == 200) {\n       document.getElementById(\"response-node\").innerHTML = this.responseText;\n   }\n};\nxhttp.open(\"GET\", \"https://g-mail.grammarly.com/profile\", true);\nxhttp.withCredentials = true;\nxhttp.send();\n```\nThe response will contain the user's email address and subscription settings:\n```\n{\"id\":749327815,\"email\":\"email@yandex.ru\",\"preferenceFields\":[{\"name\":\"Weekly Progress Reports\",\"description\":\"Get a weekly report with statistics and insights on how you are writing with Grammarly.\",\"order\":49,\"value\":true},{\"name\":\"Product Updates\",\"description\":\"Important info on new features and products. We may also ask for your feedback on occasion.\",\"order\":50,\"value\":true},{\"name\":\"Grammarly Offers\",\"description\":\"These emails may include special upgrade offers, limited-time events, or coupons. \",\"order\":50,\"value\":true},{\"name\":\"The Grammarly Blog\",\"description\":\"A weekly newsletter that includes fun tips on all things writing.\",\"order\":50,\"value\":true},{\"name\":\"Grammarly Business\",\"description\":\"Updates and information on our products for multi-person teams.\",\"order\":55,\"value\":true}],\"unsubscribe\":false}\n``` \n\n2) The malicious javascript will look like:\n\n```javascript\nvar xhttp = new XMLHttpRequest();\nvar data = new FormData();\ndata.append(\"email\", \"████████\");\ndata.append(\"unsubscribe\", \"false\");\n(...)\nxhttp.open(\"POST\", \"https://g-mail.grammarly.com/profile\", true);\nxhttp.withCredentials = true;\nxhttp.send(data);\n```\nThe request will change the subscription settings. It looks like CSRF.\n\nNow I'm trying to find more places to increase the impact.\n\n## Impact\n\nCORS misconfiguration lead to leakage of user data and unauthorized actions on behalf of the user.","vulnerability_information_html":"\u003cp\u003eHello!\u003c/p\u003e\n\n\u003ch2 id=\"description\"\u003eDescription\u003c/h2\u003e\n\n\u003cp\u003eI found that setting up a CORS in some places will check the protocol, but it allows using http scheme. In addition, any subdomain is considered trusted. If the origin is \u003cem\u003e\u003ca title=\"http://www.grammarly.com\" href=\"/redirect?url=http%3A%2F%2Fwww.grammarly.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.grammarly.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/em\u003e, then the server will respond: \u003cem\u003eAccess-Control-Allow-Origin: \u003ca title=\"http://www.grammarly.com\" href=\"/redirect?url=http%3A%2F%2Fwww.grammarly.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.grammarly.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/em\u003e. That can lead to leakage of user data and unauthorized actions on behalf of the user.\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"burp.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/015/406cdd11968ad8a0378c32ecdaceba07880db2c2/burp.png?response-content-disposition=attachment%3B%20filename%3D%22burp.png%22%3B%20filename%2A%3DUTF-8%27%27burp.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQYENXQUKC%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T063114Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHXwr%2Bz%2B7j54GXjIZDeFjE7V4KhtcLVpveDKyRp%2FgHMpAiEA%2FzBLaI4tlPUnNvgzY0X8n68OkDDLSfCBmjTZSd2A%2BM8qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDOLyu53NKIhzdiDnLyqRA1YiznmwUquOZL6cfEwHlrCEbfV1uip5mxrCKpzmpc9DKyYejzEqNMg8%2Fo1XQZiQbQ9Mn8QGMjtqUBvpzsRmfLsdw4KO6Yix26%2Foq9H6jcEfUIX3EyFaY0ofGk42HT5lnakJ%2FUAtv5lyqirA3laDcoq6u60WpxBZh0jLi92Ajs9kGkzDbgWJPXMK2%2FlVglZWa%2BjQNhDftrEqJh4ZV%2FIwfbcJ6s89eju9B4Xkun1IUiVjrUtA5LTMlkDAEwqtGdl3pucepUSB2hZBvbqUfgiT65T%2BpLDNg0LFqEXPPPqqyrYG3%2BqTXIZxR1FfbdXOQjx1UoPwboCHOwSOpOKGaPs6TEM2o6Sg2U%2BGvuy3dMdtNBCfH4SIfBdeUa84eWUftCR4OwBiC0F1Cl6iPIZXa92zkJSAVTz9swPvr%2BghYLYGIjX%2F8jqVGlADsLB1sl%2BqlNRFkwYrvTDOWwnYmDuvQmmhpAQ6Mg%2Fp05v07WKHRsbG%2BAUzVJ3M02i0HIdWCGKjqKXgGZi%2FLBrHUEV9bzaVWmpeFEE3MObUqv8FOusBMEus3670kEKa62xVKQkID%2Fav5Xylzf384wPv9i4fBKmwghqKR67wSDPkErUtnTlN6wJNos0uBd5jibop6zjPh%2BDMaeI%2Bt4z0CbNpMS83WKn2xS%2FvSK0QFyg217PkDWCKklNPmbumtDteHdU2qRRX%2BQwVoTBmoRFgs97OyKXEz2rc7ZIcHuDnAibsNVPNZEuX9m%2B04KKBBkwdIr0sY3zEiVHvTVxPYBSsKfBPuZwzi6W3T3aq%2BF9l860FnFBaV964%2BlbASqZkuTd4cEZ8C2GJad6RyY164GfHgpKnmQ6aYbLhiDTz0xF3adlmhg%3D%3D\u0026amp;X-Amz-Signature=297ffdba89218eba87b3511603b6530a4c363864f737fcb3efb126b807c158fa\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/015/406cdd11968ad8a0378c32ecdaceba07880db2c2/burp.png?response-content-disposition=attachment%3B%20filename%3D%22burp.png%22%3B%20filename%2A%3DUTF-8%27%27burp.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQYENXQUKC%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T063114Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHXwr%2Bz%2B7j54GXjIZDeFjE7V4KhtcLVpveDKyRp%2FgHMpAiEA%2FzBLaI4tlPUnNvgzY0X8n68OkDDLSfCBmjTZSd2A%2BM8qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDOLyu53NKIhzdiDnLyqRA1YiznmwUquOZL6cfEwHlrCEbfV1uip5mxrCKpzmpc9DKyYejzEqNMg8%2Fo1XQZiQbQ9Mn8QGMjtqUBvpzsRmfLsdw4KO6Yix26%2Foq9H6jcEfUIX3EyFaY0ofGk42HT5lnakJ%2FUAtv5lyqirA3laDcoq6u60WpxBZh0jLi92Ajs9kGkzDbgWJPXMK2%2FlVglZWa%2BjQNhDftrEqJh4ZV%2FIwfbcJ6s89eju9B4Xkun1IUiVjrUtA5LTMlkDAEwqtGdl3pucepUSB2hZBvbqUfgiT65T%2BpLDNg0LFqEXPPPqqyrYG3%2BqTXIZxR1FfbdXOQjx1UoPwboCHOwSOpOKGaPs6TEM2o6Sg2U%2BGvuy3dMdtNBCfH4SIfBdeUa84eWUftCR4OwBiC0F1Cl6iPIZXa92zkJSAVTz9swPvr%2BghYLYGIjX%2F8jqVGlADsLB1sl%2BqlNRFkwYrvTDOWwnYmDuvQmmhpAQ6Mg%2Fp05v07WKHRsbG%2BAUzVJ3M02i0HIdWCGKjqKXgGZi%2FLBrHUEV9bzaVWmpeFEE3MObUqv8FOusBMEus3670kEKa62xVKQkID%2Fav5Xylzf384wPv9i4fBKmwghqKR67wSDPkErUtnTlN6wJNos0uBd5jibop6zjPh%2BDMaeI%2Bt4z0CbNpMS83WKn2xS%2FvSK0QFyg217PkDWCKklNPmbumtDteHdU2qRRX%2BQwVoTBmoRFgs97OyKXEz2rc7ZIcHuDnAibsNVPNZEuX9m%2B04KKBBkwdIr0sY3zEiVHvTVxPYBSsKfBPuZwzi6W3T3aq%2BF9l860FnFBaV964%2BlbASqZkuTd4cEZ8C2GJad6RyY164GfHgpKnmQ6aYbLhiDTz0xF3adlmhg%3D%3D\u0026amp;X-Amz-Signature=297ffdba89218eba87b3511603b6530a4c363864f737fcb3efb126b807c158fa\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIn fact, this means that an attacker can use the MITM attack (Wi-Fi, local networks, etc.) to substitute client requests, thus replacing the origin. \u003c/p\u003e\n\n\u003ch4 id=\"important-note-i-very-carefully-read-the-program-policy-and-focus-on-the-fact-that-mitm-attack-is-not-made-on-the-existent-grammarly-sites\"\u003e\u003cem\u003eImportant note: I very carefully read the program policy and focus on the fact that MITM attack is not made on the existent grammarly sites.\u003c/em\u003e\u003c/h4\u003e\n\n\u003ch2 id=\"how-it-works\"\u003eHow it works\u003c/h2\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"CORS.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/002/5314045f608f7d9a3c59bd50991770fae7e3a678/CORS.png?response-content-disposition=attachment%3B%20filename%3D%22CORS.png%22%3B%20filename%2A%3DUTF-8%27%27CORS.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQYENXQUKC%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T063114Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHXwr%2Bz%2B7j54GXjIZDeFjE7V4KhtcLVpveDKyRp%2FgHMpAiEA%2FzBLaI4tlPUnNvgzY0X8n68OkDDLSfCBmjTZSd2A%2BM8qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDOLyu53NKIhzdiDnLyqRA1YiznmwUquOZL6cfEwHlrCEbfV1uip5mxrCKpzmpc9DKyYejzEqNMg8%2Fo1XQZiQbQ9Mn8QGMjtqUBvpzsRmfLsdw4KO6Yix26%2Foq9H6jcEfUIX3EyFaY0ofGk42HT5lnakJ%2FUAtv5lyqirA3laDcoq6u60WpxBZh0jLi92Ajs9kGkzDbgWJPXMK2%2FlVglZWa%2BjQNhDftrEqJh4ZV%2FIwfbcJ6s89eju9B4Xkun1IUiVjrUtA5LTMlkDAEwqtGdl3pucepUSB2hZBvbqUfgiT65T%2BpLDNg0LFqEXPPPqqyrYG3%2BqTXIZxR1FfbdXOQjx1UoPwboCHOwSOpOKGaPs6TEM2o6Sg2U%2BGvuy3dMdtNBCfH4SIfBdeUa84eWUftCR4OwBiC0F1Cl6iPIZXa92zkJSAVTz9swPvr%2BghYLYGIjX%2F8jqVGlADsLB1sl%2BqlNRFkwYrvTDOWwnYmDuvQmmhpAQ6Mg%2Fp05v07WKHRsbG%2BAUzVJ3M02i0HIdWCGKjqKXgGZi%2FLBrHUEV9bzaVWmpeFEE3MObUqv8FOusBMEus3670kEKa62xVKQkID%2Fav5Xylzf384wPv9i4fBKmwghqKR67wSDPkErUtnTlN6wJNos0uBd5jibop6zjPh%2BDMaeI%2Bt4z0CbNpMS83WKn2xS%2FvSK0QFyg217PkDWCKklNPmbumtDteHdU2qRRX%2BQwVoTBmoRFgs97OyKXEz2rc7ZIcHuDnAibsNVPNZEuX9m%2B04KKBBkwdIr0sY3zEiVHvTVxPYBSsKfBPuZwzi6W3T3aq%2BF9l860FnFBaV964%2BlbASqZkuTd4cEZ8C2GJad6RyY164GfHgpKnmQ6aYbLhiDTz0xF3adlmhg%3D%3D\u0026amp;X-Amz-Signature=1b167e587a8e9c4f82ecc9c073a9ddb4621f73a05766909bfb772c00a21fd22f\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/002/5314045f608f7d9a3c59bd50991770fae7e3a678/CORS.png?response-content-disposition=attachment%3B%20filename%3D%22CORS.png%22%3B%20filename%2A%3DUTF-8%27%27CORS.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQYENXQUKC%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T063114Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHXwr%2Bz%2B7j54GXjIZDeFjE7V4KhtcLVpveDKyRp%2FgHMpAiEA%2FzBLaI4tlPUnNvgzY0X8n68OkDDLSfCBmjTZSd2A%2BM8qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDOLyu53NKIhzdiDnLyqRA1YiznmwUquOZL6cfEwHlrCEbfV1uip5mxrCKpzmpc9DKyYejzEqNMg8%2Fo1XQZiQbQ9Mn8QGMjtqUBvpzsRmfLsdw4KO6Yix26%2Foq9H6jcEfUIX3EyFaY0ofGk42HT5lnakJ%2FUAtv5lyqirA3laDcoq6u60WpxBZh0jLi92Ajs9kGkzDbgWJPXMK2%2FlVglZWa%2BjQNhDftrEqJh4ZV%2FIwfbcJ6s89eju9B4Xkun1IUiVjrUtA5LTMlkDAEwqtGdl3pucepUSB2hZBvbqUfgiT65T%2BpLDNg0LFqEXPPPqqyrYG3%2BqTXIZxR1FfbdXOQjx1UoPwboCHOwSOpOKGaPs6TEM2o6Sg2U%2BGvuy3dMdtNBCfH4SIfBdeUa84eWUftCR4OwBiC0F1Cl6iPIZXa92zkJSAVTz9swPvr%2BghYLYGIjX%2F8jqVGlADsLB1sl%2BqlNRFkwYrvTDOWwnYmDuvQmmhpAQ6Mg%2Fp05v07WKHRsbG%2BAUzVJ3M02i0HIdWCGKjqKXgGZi%2FLBrHUEV9bzaVWmpeFEE3MObUqv8FOusBMEus3670kEKa62xVKQkID%2Fav5Xylzf384wPv9i4fBKmwghqKR67wSDPkErUtnTlN6wJNos0uBd5jibop6zjPh%2BDMaeI%2Bt4z0CbNpMS83WKn2xS%2FvSK0QFyg217PkDWCKklNPmbumtDteHdU2qRRX%2BQwVoTBmoRFgs97OyKXEz2rc7ZIcHuDnAibsNVPNZEuX9m%2B04KKBBkwdIr0sY3zEiVHvTVxPYBSsKfBPuZwzi6W3T3aq%2BF9l860FnFBaV964%2BlbASqZkuTd4cEZ8C2GJad6RyY164GfHgpKnmQ6aYbLhiDTz0xF3adlmhg%3D%3D\u0026amp;X-Amz-Signature=1b167e587a8e9c4f82ecc9c073a9ddb4621f73a05766909bfb772c00a21fd22f\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIf an attacker can perform a mitm attack on a user, he can replace the requested content of any unencrypted request and produce a 302 redirect of the user to http: //evil.grammarly.com. Since the request is not unencrypted, the attacker can also replace the response and implement javascript that performs a requests to vulnerable endpoints. Thus, the vulnerable enpoint will think that the request came from the origin of the trust it trusts and will execute the request.\u003c/p\u003e\n\n\u003cp\u003eUsing a header to send a CSRF token protects against such attacks. But I found a place where verification of the transferred token is not performed.\u003c/p\u003e\n\n\u003cp\u003eThis vulnerability was perfectly described by James Kettle on OWASP AppSec EU 2017. You can watch the description of the vulnerability on the link to his presentation. \u003ca title=\"https://youtu.be/wgkj4ZgxI4c?t=1139\" href=\"/redirect?url=https%3A%2F%2Fyoutu.be%2Fwgkj4ZgxI4c%3Ft%3D1139\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://youtu.be/wgkj4ZgxI4c?t=1139\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"vulnerable-enpoints\"\u003eVulnerable enpoints\u003c/h2\u003e\n\n\u003cp\u003e1) The malicious javascript will look like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003exhttp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eXMLHttpRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nx\"\u003exhttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonreadystatechange\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereadyState\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n       \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eresponse-node\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003einnerHTML\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponseText\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"nx\"\u003exhttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eGET\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps://g-mail.grammarly.com/profile\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003exhttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewithCredentials\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nx\"\u003exhttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe response will contain the user\u0026#39;s email address and subscription settings:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e{\u0026quot;id\u0026quot;:749327815,\u0026quot;email\u0026quot;:\u0026quot;email@yandex.ru\u0026quot;,\u0026quot;preferenceFields\u0026quot;:[{\u0026quot;name\u0026quot;:\u0026quot;Weekly Progress Reports\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;Get a weekly report with statistics and insights on how you are writing with Grammarly.\u0026quot;,\u0026quot;order\u0026quot;:49,\u0026quot;value\u0026quot;:true},{\u0026quot;name\u0026quot;:\u0026quot;Product Updates\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;Important info on new features and products. We may also ask for your feedback on occasion.\u0026quot;,\u0026quot;order\u0026quot;:50,\u0026quot;value\u0026quot;:true},{\u0026quot;name\u0026quot;:\u0026quot;Grammarly Offers\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;These emails may include special upgrade offers, limited-time events, or coupons. \u0026quot;,\u0026quot;order\u0026quot;:50,\u0026quot;value\u0026quot;:true},{\u0026quot;name\u0026quot;:\u0026quot;The Grammarly Blog\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;A weekly newsletter that includes fun tips on all things writing.\u0026quot;,\u0026quot;order\u0026quot;:50,\u0026quot;value\u0026quot;:true},{\u0026quot;name\u0026quot;:\u0026quot;Grammarly Business\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;Updates and information on our products for multi-person teams.\u0026quot;,\u0026quot;order\u0026quot;:55,\u0026quot;value\u0026quot;:true}],\u0026quot;unsubscribe\u0026quot;:false}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e2) The malicious javascript will look like:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003exhttp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eXMLHttpRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eFormData\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eemail\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e████████\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003efalse\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e(...)\u003c/span\u003e\n\u003cspan class=\"nx\"\u003exhttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ePOST\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps://g-mail.grammarly.com/profile\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003exhttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewithCredentials\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nx\"\u003exhttp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe request will change the subscription settings. It looks like CSRF.\u003c/p\u003e\n\n\u003cp\u003eNow I\u0026#39;m trying to find more places to increase the impact.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eCORS misconfiguration lead to leakage of user data and unauthorized actions on behalf of the user.\u003c/p\u003e\n","bounty_amount":"750.0","formatted_bounty":"$750","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":517002,"file_name":"CORS.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/002/5314045f608f7d9a3c59bd50991770fae7e3a678/CORS.png?response-content-disposition=attachment%3B%20filename%3D%22CORS.png%22%3B%20filename%2A%3DUTF-8%27%27CORS.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYENXQUKC%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T063114Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHXwr%2Bz%2B7j54GXjIZDeFjE7V4KhtcLVpveDKyRp%2FgHMpAiEA%2FzBLaI4tlPUnNvgzY0X8n68OkDDLSfCBmjTZSd2A%2BM8qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDOLyu53NKIhzdiDnLyqRA1YiznmwUquOZL6cfEwHlrCEbfV1uip5mxrCKpzmpc9DKyYejzEqNMg8%2Fo1XQZiQbQ9Mn8QGMjtqUBvpzsRmfLsdw4KO6Yix26%2Foq9H6jcEfUIX3EyFaY0ofGk42HT5lnakJ%2FUAtv5lyqirA3laDcoq6u60WpxBZh0jLi92Ajs9kGkzDbgWJPXMK2%2FlVglZWa%2BjQNhDftrEqJh4ZV%2FIwfbcJ6s89eju9B4Xkun1IUiVjrUtA5LTMlkDAEwqtGdl3pucepUSB2hZBvbqUfgiT65T%2BpLDNg0LFqEXPPPqqyrYG3%2BqTXIZxR1FfbdXOQjx1UoPwboCHOwSOpOKGaPs6TEM2o6Sg2U%2BGvuy3dMdtNBCfH4SIfBdeUa84eWUftCR4OwBiC0F1Cl6iPIZXa92zkJSAVTz9swPvr%2BghYLYGIjX%2F8jqVGlADsLB1sl%2BqlNRFkwYrvTDOWwnYmDuvQmmhpAQ6Mg%2Fp05v07WKHRsbG%2BAUzVJ3M02i0HIdWCGKjqKXgGZi%2FLBrHUEV9bzaVWmpeFEE3MObUqv8FOusBMEus3670kEKa62xVKQkID%2Fav5Xylzf384wPv9i4fBKmwghqKR67wSDPkErUtnTlN6wJNos0uBd5jibop6zjPh%2BDMaeI%2Bt4z0CbNpMS83WKn2xS%2FvSK0QFyg217PkDWCKklNPmbumtDteHdU2qRRX%2BQwVoTBmoRFgs97OyKXEz2rc7ZIcHuDnAibsNVPNZEuX9m%2B04KKBBkwdIr0sY3zEiVHvTVxPYBSsKfBPuZwzi6W3T3aq%2BF9l860FnFBaV964%2BlbASqZkuTd4cEZ8C2GJad6RyY164GfHgpKnmQ6aYbLhiDTz0xF3adlmhg%3D%3D\u0026X-Amz-Signature=1b167e587a8e9c4f82ecc9c073a9ddb4621f73a05766909bfb772c00a21fd22f","file_size":145999,"type":"image/png"},{"id":517015,"file_name":"burp.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/015/406cdd11968ad8a0378c32ecdaceba07880db2c2/burp.png?response-content-disposition=attachment%3B%20filename%3D%22burp.png%22%3B%20filename%2A%3DUTF-8%27%27burp.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYENXQUKC%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T063114Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHXwr%2Bz%2B7j54GXjIZDeFjE7V4KhtcLVpveDKyRp%2FgHMpAiEA%2FzBLaI4tlPUnNvgzY0X8n68OkDDLSfCBmjTZSd2A%2BM8qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDOLyu53NKIhzdiDnLyqRA1YiznmwUquOZL6cfEwHlrCEbfV1uip5mxrCKpzmpc9DKyYejzEqNMg8%2Fo1XQZiQbQ9Mn8QGMjtqUBvpzsRmfLsdw4KO6Yix26%2Foq9H6jcEfUIX3EyFaY0ofGk42HT5lnakJ%2FUAtv5lyqirA3laDcoq6u60WpxBZh0jLi92Ajs9kGkzDbgWJPXMK2%2FlVglZWa%2BjQNhDftrEqJh4ZV%2FIwfbcJ6s89eju9B4Xkun1IUiVjrUtA5LTMlkDAEwqtGdl3pucepUSB2hZBvbqUfgiT65T%2BpLDNg0LFqEXPPPqqyrYG3%2BqTXIZxR1FfbdXOQjx1UoPwboCHOwSOpOKGaPs6TEM2o6Sg2U%2BGvuy3dMdtNBCfH4SIfBdeUa84eWUftCR4OwBiC0F1Cl6iPIZXa92zkJSAVTz9swPvr%2BghYLYGIjX%2F8jqVGlADsLB1sl%2BqlNRFkwYrvTDOWwnYmDuvQmmhpAQ6Mg%2Fp05v07WKHRsbG%2BAUzVJ3M02i0HIdWCGKjqKXgGZi%2FLBrHUEV9bzaVWmpeFEE3MObUqv8FOusBMEus3670kEKa62xVKQkID%2Fav5Xylzf384wPv9i4fBKmwghqKR67wSDPkErUtnTlN6wJNos0uBd5jibop6zjPh%2BDMaeI%2Bt4z0CbNpMS83WKn2xS%2FvSK0QFyg217PkDWCKklNPmbumtDteHdU2qRRX%2BQwVoTBmoRFgs97OyKXEz2rc7ZIcHuDnAibsNVPNZEuX9m%2B04KKBBkwdIr0sY3zEiVHvTVxPYBSsKfBPuZwzi6W3T3aq%2BF9l860FnFBaV964%2BlbASqZkuTd4cEZ8C2GJad6RyY164GfHgpKnmQ6aYbLhiDTz0xF3adlmhg%3D%3D\u0026X-Amz-Signature=297ffdba89218eba87b3511603b6530a4c363864f737fcb3efb126b807c158fa","file_size":61532,"type":"image/png"}],"allow_singular_disclosure_at":"2019-11-29T13:21:44.583Z","allow_singular_disclosure_after":-34189769.53660044,"singular_disclosure_allowed":true,"vote_count":127,"voters":["megaknight","computersarehard","gabicosta","spam404","base_64","mik317","sameerphad72","metnew","dhakal_ananda","orlserg","and 117 more..."],"severity":{"rating":"medium","score":4.2,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":1366,"asset_type":"URL","asset_identifier":"www.grammarly.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":5200654,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @orlserg,\n\nThank you for your submission. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\n\nKind regards,\n@druth ","markdown_message":"\u003cp\u003eHi \u003ca href=\"/orlserg\"\u003e@orlserg\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for your submission. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\u003c/p\u003e\n\n\u003cp\u003eKind regards,\u003cbr\u003e\n\u003ca href=\"/druth\"\u003e@druth\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-26T16:16:12.904Z","updated_at":"2019-06-26T16:16:12.904Z","actor":{"username":"druth","cleared":false,"url":"/druth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/344/813/24cad2ef0871d9ca525966e6abbba3be8c97f4f7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5200669,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Hi @orlserg,\n\nThanks for the report. Unfortunately this was submitted previously by another tester, but we appreciate your work and look forward to additional reports from you.\n\nGood Luck!\n@druth ","markdown_message":"\u003cp\u003eHi \u003ca href=\"/orlserg\"\u003e@orlserg\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks for the report. Unfortunately this was submitted previously by another tester, but we appreciate your work and look forward to additional reports from you.\u003c/p\u003e\n\n\u003cp\u003eGood Luck!\u003cbr\u003e\n\u003ca href=\"/druth\"\u003e@druth\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-26T16:19:46.351Z","updated_at":"2019-06-26T16:19:46.351Z","original_report_id":461530,"actor":{"username":"druth","cleared":false,"url":"/druth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/344/813/24cad2ef0871d9ca525966e6abbba3be8c97f4f7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5201079,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-26T17:48:16.785Z","updated_at":"2019-06-26T17:48:16.785Z","actor":{"username":"vladimir_suslenko","cleared":false,"url":"/vladimir_suslenko","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5201207,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-26T18:13:12.611Z","updated_at":"2019-06-26T18:13:12.611Z","additional_data":{"old_severity":"Low","new_severity":"Medium (4.7)","old_severity_id":444530,"new_severity_id":444893},"actor":{"username":"vladimir_suslenko","cleared":false,"url":"/vladimir_suslenko","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5201352,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-26T18:41:27.218Z","updated_at":"2019-06-26T18:41:27.218Z","additional_data":{"old_severity":"Medium (4.7)","new_severity":"Medium (4.2)","old_severity_id":444893,"new_severity_id":444913},"actor":{"username":"vladimir_suslenko","cleared":false,"url":"/vladimir_suslenko","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5201359,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-26T18:43:07.571Z","updated_at":"2019-06-26T18:43:07.571Z","additional_data":{"old_title":"CORS misconfiguration leads to client data leakage","new_title":"Lack of CSRF header validation at https://g-mail.grammarly.com/profile"},"actor":{"username":"vladimir_suslenko","cleared":false,"url":"/vladimir_suslenko","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5201382,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-26T18:46:13.462Z","updated_at":"2019-06-26T18:46:13.462Z","actor":{"username":"vladimir_suslenko","cleared":false,"url":"/vladimir_suslenko","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5201550,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @orlserg,\n\nThanks for the report. It appears to be valid.\n\n1. We're ok with this CORS configuration. It's not a bug by itself.\n2. All Grammarly endpoints require a CSRF header being set. CSRF token is a `Secure` cookie, so it's impossible to retrieve it on insecure (`http://`) pages.\n3. It appears that `g-mail.grammarly.com/profile` doesn't require CSRF header being set.\n4. The endpoint authenticates users via `profileToken` cookies (`Secure`, `HTTPonly`), which is set when the user visits \"Email Preferences\" page from the email newsletter.\n5. However, `profileToken` cookie has a short lifespan - 1 week. That means, the victim should have visited \"Email Preferences\" page in the last 7 days to make this attack successful.\n\nWe estimate this vulnerability as `CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:L/A:N` (4.2):\n- Attack Complexity -\u003e High (MITM + user should have `profileToken` cookie)\n- User Interaction -\u003e Required\n- C/I/A -\u003e Low/Low/None\n- Scope -\u003e Unchanged\n\nFeel free to reply if you have any questions.\n\nThanks again and happy hunting!","markdown_message":"\u003cp\u003eHey \u003ca href=\"/orlserg\"\u003e@orlserg\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks for the report. It appears to be valid.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eWe\u0026#39;re ok with this CORS configuration. It\u0026#39;s not a bug by itself.\u003c/li\u003e\n\u003cli\u003eAll Grammarly endpoints require a CSRF header being set. CSRF token is a \u003ccode\u003eSecure\u003c/code\u003e cookie, so it\u0026#39;s impossible to retrieve it on insecure (\u003ccode\u003ehttp://\u003c/code\u003e) pages.\u003c/li\u003e\n\u003cli\u003eIt appears that \u003ccode\u003eg-mail.grammarly.com/profile\u003c/code\u003e doesn\u0026#39;t require CSRF header being set.\u003c/li\u003e\n\u003cli\u003eThe endpoint authenticates users via \u003ccode\u003eprofileToken\u003c/code\u003e cookies (\u003ccode\u003eSecure\u003c/code\u003e, \u003ccode\u003eHTTPonly\u003c/code\u003e), which is set when the user visits \u0026quot;Email Preferences\u0026quot; page from the email newsletter.\u003c/li\u003e\n\u003cli\u003eHowever, \u003ccode\u003eprofileToken\u003c/code\u003e cookie has a short lifespan - 1 week. That means, the victim should have visited \u0026quot;Email Preferences\u0026quot; page in the last 7 days to make this attack successful.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eWe estimate this vulnerability as \u003ccode\u003eCVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:L/A:N\u003c/code\u003e (4.2):\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAttack Complexity -\u0026gt; High (MITM + user should have \u003ccode\u003eprofileToken\u003c/code\u003e cookie)\u003c/li\u003e\n\u003cli\u003eUser Interaction -\u0026gt; Required\u003c/li\u003e\n\u003cli\u003eC/I/A -\u0026gt; Low/Low/None\u003c/li\u003e\n\u003cli\u003eScope -\u0026gt; Unchanged\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eFeel free to reply if you have any questions.\u003c/p\u003e\n\n\u003cp\u003eThanks again and happy hunting!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-26T19:16:04.852Z","updated_at":"2019-06-26T19:16:04.852Z","actor":{"username":"vladimir_suslenko","cleared":false,"url":"/vladimir_suslenko","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5203173,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello, @vladimir_suslenko,\n\nYes, I agree in themselves on some points. \n\n1.  It's not a bug by itself. I completely agree. But this is the case if you use the CSRF token in the header.\n2. Not all, as we can see :)\n3. Yes. The header is set here but not checked on the server side.\n4. Yes.\n5. Ok.\n\nBut it seems that you have not fully understood the principle of attack. Sorry for some confusion in my report. Perhaps I did not fully explain the essence of the problem. Because it is somewhat larger than the usual СSRF. Using this method of attack, you can not only perform unauthorized actions on behalf of the user, but also receive user data through crossorigin ajax requests (bacause of CORS).\n\n1. Even if the CSRF token is not set in the header, it is impossible to perform a normal CSRF attack, since endpoint accepts only the application/json type requests. I report a way to attack through flash: https://hackerone.com/reports/437768, but it was closed as a duplicate. The report contained information about the attack on g-mail.grammarly.com/profile. I'm not sure, but I think that this attack method can work now. But I did not rely on this method of attack, as he was already known to the security team.\n\n2. Another type of attack with type application/json is javascript. So here I am talking exactly about it.\n\n## How it works\nWith the help of javascript, you can set the Content-Type: application/json header necessary for the attack. But how to execute json request to the server? Here comes the CORS. The CORS allows you to perform ajax requests from any (in your case) subdomain and allows the use of http protocol. In addition, the *Access-Control-Allow-Credentials: true* header that is present in the server response allows the use of authorization cookies (profileToken in your case) to perform cross-origin requests.\n\nThus, the presence of headers:\n```\nAccess-Control-Allow-Origin: http://evil.grammarly.com (evil - reflected from Origin header)\nAccess-Control-Allow-Credentials: true\n```\nsays that the request from http://evil.grammarly.com will be trusted and will be able to use cookies to run on the server. \n\nBut there are several different types of incorrect settings of the cors, when the origin from which the request is executed is controlled by an attacker. For example:\n* https://hackerone.com/reports/426165\n* https://hackerone.com/reports/470298\n* https://hackerone.com/reports/235200\n\nBasically this is the wrong setting of the origin itself. You have this setting done correctly. But using the http protocol for cross-origin of requests creates the ability to conduct MITM attacks in order to spoof the origin.\n\n**So MITM attack is needed not to obtain an authorization cookie, but to replace the origin.** For more details, you can watch the video:  https://youtu.be/wgkj4ZgxI4c?t=1139\n\n## List of steps to steal data\n1. MITM attack and spoofing content and origin of http://evil.grammarly.com.\n2. Spoofed content of http://evil.grammarly.com contain javascript, which makes cross-orign GET request to  https://g-mail.grammarly.com/profile (for example).\n3. The attacker steals user data.\n\n## List of steps to perform actions on behalf of the user\n1. MITM attack and spoofing content and origin of http://evil.grammarly.com.\n2. Spoofed content of http://evil.grammarly.com contain javascript, which makes cross-orign POST request to  https://g-mail.grammarly.com/profile (for example).\n3. The attacker performs the change settings.\n\nFeel free to ask any questions.","markdown_message":"\u003cp\u003eHello, \u003ca href=\"/vladimir_suslenko\"\u003e@vladimir_suslenko\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eYes, I agree in themselves on some points. \u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e It\u0026#39;s not a bug by itself. I completely agree. But this is the case if you use the CSRF token in the header.\u003c/li\u003e\n\u003cli\u003eNot all, as we can see :)\u003c/li\u003e\n\u003cli\u003eYes. The header is set here but not checked on the server side.\u003c/li\u003e\n\u003cli\u003eYes.\u003c/li\u003e\n\u003cli\u003eOk.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eBut it seems that you have not fully understood the principle of attack. Sorry for some confusion in my report. Perhaps I did not fully explain the essence of the problem. Because it is somewhat larger than the usual СSRF. Using this method of attack, you can not only perform unauthorized actions on behalf of the user, but also receive user data through crossorigin ajax requests (bacause of CORS).\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eEven if the CSRF token is not set in the header, it is impossible to perform a normal CSRF attack, since endpoint accepts only the application/json type requests. I report a way to attack through flash: \u003ca title=\"https://hackerone.com/reports/437768\" href=\"https://hackerone.com/reports/437768\"\u003ehttps://hackerone.com/reports/437768\u003c/a\u003e, but it was closed as a duplicate. The report contained information about the attack on g-mail.grammarly.com/profile. I\u0026#39;m not sure, but I think that this attack method can work now. But I did not rely on this method of attack, as he was already known to the security team.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eAnother type of attack with type application/json is javascript. So here I am talking exactly about it.\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"how-it-works\"\u003eHow it works\u003c/h2\u003e\n\n\u003cp\u003eWith the help of javascript, you can set the Content-Type: application/json header necessary for the attack. But how to execute json request to the server? Here comes the CORS. The CORS allows you to perform ajax requests from any (in your case) subdomain and allows the use of http protocol. In addition, the \u003cem\u003eAccess-Control-Allow-Credentials: true\u003c/em\u003e header that is present in the server response allows the use of authorization cookies (profileToken in your case) to perform cross-origin requests.\u003c/p\u003e\n\n\u003cp\u003eThus, the presence of headers:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eAccess-Control-Allow-Origin: http://evil.grammarly.com (evil - reflected from Origin header)\nAccess-Control-Allow-Credentials: true\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003esays that the request from \u003ca title=\"http://evil.grammarly.com\" href=\"/redirect?url=http%3A%2F%2Fevil.grammarly.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://evil.grammarly.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e will be trusted and will be able to use cookies to run on the server. \u003c/p\u003e\n\n\u003cp\u003eBut there are several different types of incorrect settings of the cors, when the origin from which the request is executed is controlled by an attacker. For example:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca title=\"https://hackerone.com/reports/426165\" href=\"https://hackerone.com/reports/426165\"\u003ehttps://hackerone.com/reports/426165\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca title=\"https://hackerone.com/reports/470298\" href=\"https://hackerone.com/reports/470298\"\u003ehttps://hackerone.com/reports/470298\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca title=\"https://hackerone.com/reports/235200\" href=\"https://hackerone.com/reports/235200\"\u003ehttps://hackerone.com/reports/235200\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eBasically this is the wrong setting of the origin itself. You have this setting done correctly. But using the http protocol for cross-origin of requests creates the ability to conduct MITM attacks in order to spoof the origin.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSo MITM attack is needed not to obtain an authorization cookie, but to replace the origin.\u003c/strong\u003e For more details, you can watch the video:  \u003ca title=\"https://youtu.be/wgkj4ZgxI4c?t=1139\" href=\"/redirect?url=https%3A%2F%2Fyoutu.be%2Fwgkj4ZgxI4c%3Ft%3D1139\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://youtu.be/wgkj4ZgxI4c?t=1139\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"list-of-steps-to-steal-data\"\u003eList of steps to steal data\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eMITM attack and spoofing content and origin of \u003ca title=\"http://evil.grammarly.com\" href=\"/redirect?url=http%3A%2F%2Fevil.grammarly.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://evil.grammarly.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eSpoofed content of \u003ca title=\"http://evil.grammarly.com\" href=\"/redirect?url=http%3A%2F%2Fevil.grammarly.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://evil.grammarly.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e contain javascript, which makes cross-orign GET request to  \u003ca title=\"https://g-mail.grammarly.com/profile\" href=\"/redirect?url=https%3A%2F%2Fg-mail.grammarly.com%2Fprofile\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://g-mail.grammarly.com/profile\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (for example).\u003c/li\u003e\n\u003cli\u003eThe attacker steals user data.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"list-of-steps-to-perform-actions-on-behalf-of-the-user\"\u003eList of steps to perform actions on behalf of the user\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eMITM attack and spoofing content and origin of \u003ca title=\"http://evil.grammarly.com\" href=\"/redirect?url=http%3A%2F%2Fevil.grammarly.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://evil.grammarly.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eSpoofed content of \u003ca title=\"http://evil.grammarly.com\" href=\"/redirect?url=http%3A%2F%2Fevil.grammarly.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://evil.grammarly.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e contain javascript, which makes cross-orign POST request to  \u003ca title=\"https://g-mail.grammarly.com/profile\" href=\"/redirect?url=https%3A%2F%2Fg-mail.grammarly.com%2Fprofile\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://g-mail.grammarly.com/profile\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (for example).\u003c/li\u003e\n\u003cli\u003eThe attacker performs the change settings.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eFeel free to ask any questions.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-27T04:40:48.530Z","updated_at":"2019-06-27T04:40:48.530Z","actor":{"username":"orlserg","cleared":false,"url":"/orlserg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/344/557/e52419d580024b46dfc518300c1293bb341bc0e8_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5207867,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-27T16:26:56.508Z","updated_at":"2019-06-27T16:26:56.508Z","actor":{"username":"andriy_derevyanko","cleared":false,"url":"/andriy_derevyanko","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/232/429/8d025f5ca823ddfa62ce186084ff79b3e72542ed_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5207871,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-27T16:27:36.124Z","updated_at":"2019-06-27T16:27:36.124Z","actor":{"url":"/grammarly","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/746/a2bf7f90c683af5214fcc74c1df6804286ee97ce_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Grammarly"}},"bounty_amount":"750.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"grammarly","collaborator":{"username":"orlserg","url":"/orlserg"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5208761,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for reward, guys.\n\nI also took the time to test my guesses about CSRF using a flash. More info in my report https://hackerone.com/reports/437768. Although the problem was known and noted as fixed, I can now confirm that it is still working for https://g-mail.grammarly.com/profile.\n\nI added a video confirmation for clarity.","markdown_message":"\u003cp\u003eThanks for reward, guys.\u003c/p\u003e\n\n\u003cp\u003eI also took the time to test my guesses about CSRF using a flash. More info in my report \u003ca title=\"https://hackerone.com/reports/437768\" href=\"https://hackerone.com/reports/437768\"\u003ehttps://hackerone.com/reports/437768\u003c/a\u003e. Although the problem was known and noted as fixed, I can now confirm that it is still working for \u003ca title=\"https://g-mail.grammarly.com/profile\" href=\"/redirect?url=https%3A%2F%2Fg-mail.grammarly.com%2Fprofile\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://g-mail.grammarly.com/profile\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eI added a video confirmation for clarity.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-27T18:45:54.449Z","updated_at":"2019-06-27T18:45:54.449Z","actor":{"username":"orlserg","cleared":false,"url":"/orlserg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/344/557/e52419d580024b46dfc518300c1293bb341bc0e8_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":517981,"filename":"Grammarly-CSRF-2019-06-28_01.08.45.mkv","type":"video/x-matroska","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/517/981/f00a8f64c8df9117105bd1fc80f89c765f691627/Grammarly-CSRF-2019-06-28_01.08.45.mkv?response-content-disposition=attachment%3B%20filename%3D%22Grammarly-CSRF-2019-06-28_01.08.45.mkv%22%3B%20filename%2A%3DUTF-8%27%27Grammarly-CSRF-2019-06-28_01.08.45.mkv\u0026response-content-type=video%2Fx-matroska\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYENXQUKC%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T063114Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHXwr%2Bz%2B7j54GXjIZDeFjE7V4KhtcLVpveDKyRp%2FgHMpAiEA%2FzBLaI4tlPUnNvgzY0X8n68OkDDLSfCBmjTZSd2A%2BM8qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDOLyu53NKIhzdiDnLyqRA1YiznmwUquOZL6cfEwHlrCEbfV1uip5mxrCKpzmpc9DKyYejzEqNMg8%2Fo1XQZiQbQ9Mn8QGMjtqUBvpzsRmfLsdw4KO6Yix26%2Foq9H6jcEfUIX3EyFaY0ofGk42HT5lnakJ%2FUAtv5lyqirA3laDcoq6u60WpxBZh0jLi92Ajs9kGkzDbgWJPXMK2%2FlVglZWa%2BjQNhDftrEqJh4ZV%2FIwfbcJ6s89eju9B4Xkun1IUiVjrUtA5LTMlkDAEwqtGdl3pucepUSB2hZBvbqUfgiT65T%2BpLDNg0LFqEXPPPqqyrYG3%2BqTXIZxR1FfbdXOQjx1UoPwboCHOwSOpOKGaPs6TEM2o6Sg2U%2BGvuy3dMdtNBCfH4SIfBdeUa84eWUftCR4OwBiC0F1Cl6iPIZXa92zkJSAVTz9swPvr%2BghYLYGIjX%2F8jqVGlADsLB1sl%2BqlNRFkwYrvTDOWwnYmDuvQmmhpAQ6Mg%2Fp05v07WKHRsbG%2BAUzVJ3M02i0HIdWCGKjqKXgGZi%2FLBrHUEV9bzaVWmpeFEE3MObUqv8FOusBMEus3670kEKa62xVKQkID%2Fav5Xylzf384wPv9i4fBKmwghqKR67wSDPkErUtnTlN6wJNos0uBd5jibop6zjPh%2BDMaeI%2Bt4z0CbNpMS83WKn2xS%2FvSK0QFyg217PkDWCKklNPmbumtDteHdU2qRRX%2BQwVoTBmoRFgs97OyKXEz2rc7ZIcHuDnAibsNVPNZEuX9m%2B04KKBBkwdIr0sY3zEiVHvTVxPYBSsKfBPuZwzi6W3T3aq%2BF9l860FnFBaV964%2BlbASqZkuTd4cEZ8C2GJad6RyY164GfHgpKnmQ6aYbLhiDTz0xF3adlmhg%3D%3D\u0026X-Amz-Signature=18449fe67a7ddb02865a5b52218f4d8793a8c03c89183986fad8d8aa1a0aa16b"}],"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5211189,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello security team!\n\nI additionally found some more endpoints that do not check CSRF token and trust the http protocol in CORS:\n* \n```http\nPOST /api/v1/token/create HTTP/1.1\nHost: subscription.grammarly.com\nConnection: close\nContent-Length: 0\nOrigin: http://account.grammarly.com\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36\nAccept: */*\nReferer: https://account.grammarly.com/subscription\nAccept-Encoding: gzip, deflate\nAccept-Language: ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7\nCookie: { cookies }\n```\n\n*  \n```http\nGET /api/v1/token/request/s7kKzj0zE02N02rgbxYg HTTP/1.1\nHost: subscription.grammarly.com\nConnection: close\nOrigin: http://account.grammarly.com\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36\nAccept: */*\nReferer: https://account.grammarly.com/subscription\nAccept-Encoding: gzip, deflate\nAccept-Language: ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7\nCookie: { cookies }\n```\nThese are chained queries to generate some variables to get data for payment. \n```\n{\"version\":2,\"authorizationFingerprint\":\"3395f621a8c2f85f2154d14e1974707cf9fcfee053f33896404b43302e99a154|created_at=2019-06-27T04:49:55.153164041+0000\\u0026merchant_id=68r2vzdxyjwst8d7\\u0026public_key=929973qrr27jqj8y\",\"configUrl\":\"https://api.braintreegateway.com:443/merchants/68r2vzdxyjwst8d7/client_api/v1/configuration\",\"graphQL\":{\"url\":\"https://payments.braintree-api.com/graphql\",\"date\":\"2018-05-08\"},\"challenges\":[\"cvv\",\"postal_code\"],\"environment\":\"production\",\"clientApiUrl\":\"https://api.braintreegateway.com:443/merchants/68r2vzdxyjwst8d7/client_api\",\"assetsUrl\":\"https://assets.braintreegateway.com\",\"authUrl\":\"https://auth.venmo.com\",\"analytics\":{\"url\":\"https://client-analytics.braintreegateway.com/68r2vzdxyjwst8d7\"},\"threeDSecureEnabled\":false,\"paypalEnabled\":true,\"paypal\":{\"displayName\":\"Grammarly.com\",\"clientId\":\"ASD3CyT-TxnfUa4Bkj3qak64pqtBaB1Zmbuu5TIvMAE3CZjkiTaRcoW3nF62UeAg5pIUzWqXHqcdXjMR\",\"privacyUrl\":\"https://www.grammarly.com/privacy-policy\",\"userAgreementUrl\":\"https://www.grammarly.com/terms\",\"baseUrl\":\"https://assets.braintreegateway.com\",\"assetsUrl\":\"https://checkout.paypal.com\",\"directBaseUrl\":null,\"allowHttp\":false,\"environmentNoNetwork\":false,\"environment\":\"live\",\"unvettedMerchant\":false,\"braintreeClientId\":\"ARKrYRDh3AGXDzW7sO_3bSkq-U1C7HG_uWNC-z57LjYSDNUOSaOtIa9q6VpW\",\"billingAgreementsEnabled\":true,\"merchantAccountId\":\"grammarly\",\"currencyIsoCode\":\"USD\"},\"merchantId\":\"68r2vzdxyjwst8d7\",\"venmo\":\"off\",\"braintree_api\":{\"url\":\"https://payments.braintree-api.com\",\"access_token\":\"production_gwjrwx_hnx7tr_66rjsf_74sgts_dw4\"}}\n```\nIt seems that the theft of the data does not pose any security risk. But anyway, this is another example of CORS misconfiguration and without checking the CSRF token.\n\nI hope this will help you.","markdown_message":"\u003cp\u003eHello security team!\u003c/p\u003e\n\n\u003cp\u003eI additionally found some more endpoints that do not check CSRF token and trust the http protocol in CORS:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight http\"\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003ePOST\u003c/span\u003e \u003cspan class=\"nn\"\u003e/api/v1/token/create\u003c/span\u003e \u003cspan class=\"k\"\u003eHTTP\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e1.1\u003c/span\u003e\n\u003cspan class=\"na\"\u003eHost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esubscription.grammarly.com\u003c/span\u003e\n\u003cspan class=\"na\"\u003eConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eclose\u003c/span\u003e\n\u003cspan class=\"na\"\u003eContent-Length\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003cspan class=\"na\"\u003eOrigin\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://account.grammarly.com\u003c/span\u003e\n\u003cspan class=\"na\"\u003eUser-Agent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eMozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36\u003c/span\u003e\n\u003cspan class=\"na\"\u003eAccept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e*/*\u003c/span\u003e\n\u003cspan class=\"na\"\u003eReferer\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://account.grammarly.com/subscription\u003c/span\u003e\n\u003cspan class=\"na\"\u003eAccept-Encoding\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egzip, deflate\u003c/span\u003e\n\u003cspan class=\"na\"\u003eAccept-Language\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7\u003c/span\u003e\n\u003cspan class=\"na\"\u003eCookie\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e{ cookies }\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight http\"\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003eGET\u003c/span\u003e \u003cspan class=\"nn\"\u003e/api/v1/token/request/s7kKzj0zE02N02rgbxYg\u003c/span\u003e \u003cspan class=\"k\"\u003eHTTP\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e1.1\u003c/span\u003e\n\u003cspan class=\"na\"\u003eHost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esubscription.grammarly.com\u003c/span\u003e\n\u003cspan class=\"na\"\u003eConnection\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eclose\u003c/span\u003e\n\u003cspan class=\"na\"\u003eOrigin\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttp://account.grammarly.com\u003c/span\u003e\n\u003cspan class=\"na\"\u003eUser-Agent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eMozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36\u003c/span\u003e\n\u003cspan class=\"na\"\u003eAccept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e*/*\u003c/span\u003e\n\u003cspan class=\"na\"\u003eReferer\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://account.grammarly.com/subscription\u003c/span\u003e\n\u003cspan class=\"na\"\u003eAccept-Encoding\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003egzip, deflate\u003c/span\u003e\n\u003cspan class=\"na\"\u003eAccept-Language\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7\u003c/span\u003e\n\u003cspan class=\"na\"\u003eCookie\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e{ cookies }\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThese are chained queries to generate some variables to get data for payment. \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e{\u0026quot;version\u0026quot;:2,\u0026quot;authorizationFingerprint\u0026quot;:\u0026quot;3395f621a8c2f85f2154d14e1974707cf9fcfee053f33896404b43302e99a154|created_at=2019-06-27T04:49:55.153164041+0000\\u0026merchant_id=68r2vzdxyjwst8d7\\u0026public_key=929973qrr27jqj8y\u0026quot;,\u0026quot;configUrl\u0026quot;:\u0026quot;https://api.braintreegateway.com:443/merchants/68r2vzdxyjwst8d7/client_api/v1/configuration\u0026quot;,\u0026quot;graphQL\u0026quot;:{\u0026quot;url\u0026quot;:\u0026quot;https://payments.braintree-api.com/graphql\u0026quot;,\u0026quot;date\u0026quot;:\u0026quot;2018-05-08\u0026quot;},\u0026quot;challenges\u0026quot;:[\u0026quot;cvv\u0026quot;,\u0026quot;postal_code\u0026quot;],\u0026quot;environment\u0026quot;:\u0026quot;production\u0026quot;,\u0026quot;clientApiUrl\u0026quot;:\u0026quot;https://api.braintreegateway.com:443/merchants/68r2vzdxyjwst8d7/client_api\u0026quot;,\u0026quot;assetsUrl\u0026quot;:\u0026quot;https://assets.braintreegateway.com\u0026quot;,\u0026quot;authUrl\u0026quot;:\u0026quot;https://auth.venmo.com\u0026quot;,\u0026quot;analytics\u0026quot;:{\u0026quot;url\u0026quot;:\u0026quot;https://client-analytics.braintreegateway.com/68r2vzdxyjwst8d7\u0026quot;},\u0026quot;threeDSecureEnabled\u0026quot;:false,\u0026quot;paypalEnabled\u0026quot;:true,\u0026quot;paypal\u0026quot;:{\u0026quot;displayName\u0026quot;:\u0026quot;Grammarly.com\u0026quot;,\u0026quot;clientId\u0026quot;:\u0026quot;ASD3CyT-TxnfUa4Bkj3qak64pqtBaB1Zmbuu5TIvMAE3CZjkiTaRcoW3nF62UeAg5pIUzWqXHqcdXjMR\u0026quot;,\u0026quot;privacyUrl\u0026quot;:\u0026quot;https://www.grammarly.com/privacy-policy\u0026quot;,\u0026quot;userAgreementUrl\u0026quot;:\u0026quot;https://www.grammarly.com/terms\u0026quot;,\u0026quot;baseUrl\u0026quot;:\u0026quot;https://assets.braintreegateway.com\u0026quot;,\u0026quot;assetsUrl\u0026quot;:\u0026quot;https://checkout.paypal.com\u0026quot;,\u0026quot;directBaseUrl\u0026quot;:null,\u0026quot;allowHttp\u0026quot;:false,\u0026quot;environmentNoNetwork\u0026quot;:false,\u0026quot;environment\u0026quot;:\u0026quot;live\u0026quot;,\u0026quot;unvettedMerchant\u0026quot;:false,\u0026quot;braintreeClientId\u0026quot;:\u0026quot;ARKrYRDh3AGXDzW7sO_3bSkq-U1C7HG_uWNC-z57LjYSDNUOSaOtIa9q6VpW\u0026quot;,\u0026quot;billingAgreementsEnabled\u0026quot;:true,\u0026quot;merchantAccountId\u0026quot;:\u0026quot;grammarly\u0026quot;,\u0026quot;currencyIsoCode\u0026quot;:\u0026quot;USD\u0026quot;},\u0026quot;merchantId\u0026quot;:\u0026quot;68r2vzdxyjwst8d7\u0026quot;,\u0026quot;venmo\u0026quot;:\u0026quot;off\u0026quot;,\u0026quot;braintree_api\u0026quot;:{\u0026quot;url\u0026quot;:\u0026quot;https://payments.braintree-api.com\u0026quot;,\u0026quot;access_token\u0026quot;:\u0026quot;production_gwjrwx_hnx7tr_66rjsf_74sgts_dw4\u0026quot;}}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt seems that the theft of the data does not pose any security risk. But anyway, this is another example of CORS misconfiguration and without checking the CSRF token.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eI hope this will help you.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-28T04:40:27.719Z","updated_at":"2019-06-28T04:40:27.719Z","actor":{"username":"orlserg","cleared":false,"url":"/orlserg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/344/557/e52419d580024b46dfc518300c1293bb341bc0e8_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5673907,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @orlserg,\n\nThis should be fixed now. Can you try to repro the PoC again?\n\nThanks for the report!","markdown_message":"\u003cp\u003eHey \u003ca href=\"/orlserg\"\u003e@orlserg\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThis should be fixed now. Can you try to repro the PoC again?\u003c/p\u003e\n\n\u003cp\u003eThanks for the report!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-27T12:43:08.842Z","updated_at":"2019-08-27T12:43:08.842Z","actor":{"username":"vladimir_suslenko","cleared":false,"url":"/vladimir_suslenko","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"orlserg","url":"/orlserg"},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5699830,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Looks good now. Good job.","markdown_message":"\u003cp\u003eLooks good now. Good job.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-30T17:20:33.534Z","updated_at":"2019-08-30T17:20:33.534Z","actor":{"username":"orlserg","cleared":false,"url":"/orlserg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/344/557/e52419d580024b46dfc518300c1293bb341bc0e8_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6173235,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hey @orlserg, it is a great report, let's disclose it!","markdown_message":"\u003cp\u003eHey \u003ca href=\"/orlserg\"\u003e@orlserg\u003c/a\u003e, it is a great report, let\u0026#39;s disclose it!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-10-30T13:21:44.506Z","updated_at":"2019-10-30T13:21:44.506Z","first_to_agree":true,"actor":{"username":"vladimir_suslenko","cleared":false,"url":"/vladimir_suslenko","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6178743,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-31T03:57:12.093Z","updated_at":"2019-10-31T03:57:12.093Z","actor":{"username":"orlserg","cleared":false,"url":"/orlserg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/344/557/e52419d580024b46dfc518300c1293bb341bc0e8_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6178744,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-31T03:57:12.188Z","updated_at":"2019-10-31T03:57:12.188Z","actor":{"username":"orlserg","cleared":false,"url":"/orlserg","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/344/557/e52419d580024b46dfc518300c1293bb341bc0e8_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"grammarly","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}