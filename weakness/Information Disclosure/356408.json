{"id":356408,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNTY0MDg=","url":"https://hackerone.com/reports/356408","title":"The \"Download Raw Diff\" URL is viewable by everyone","state":"Closed","substate":"informative","severity_rating":"low","readable_substate":"Informative","created_at":"2018-05-23T16:16:05.959Z","submitted_at":"2018-05-23T16:16:05.959Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"xiaoyinl","url":"/xiaoyinl","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/018/322/771e7ba50572621c57e02f8eed8f23fc362c4e52_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":18,"url":"https://hackerone.com/phabricator","handle":"phabricator","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Phabricator","twitter_handle":"phabricator","website":"http://phacility.com/phabricator/","about":"Phabricator is a collection of open source web applications that help software companies build better software."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-05-23T16:23:47.160Z","bug_reporter_agreed_on_going_public_at":"2018-05-23T16:23:18.383Z","team_member_agreed_on_going_public_at":"2018-05-23T16:23:47.097Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"mongoose\n\nThis is similar to #213942, but less severe. Here is what you said in #213942:\n\u003e The change makes us write files with narrow permissions (instead of broad permissions), write temporary files (instead of permanent files) and [...]\n\nIf I understand your comment correctly, suppose that an Administrator creates a diff and revision and sets its visibility to \"Administrators\", it means that non-admin users cannot view the raw diff via a URL generated by Phabricator, even if the URL is generated randomly, is it correct?\n\nBut here is what I find with repro steps:\n1. Log in an Phabricator account. Then go to http://phab.local/differential/diff/create\n2. Enter any raw diff. Change the \"Visible to\" to \"Administrators\". Click \"Create Diff\".\n3. Leave \"Attach To\" as \"Create a new Revision...\". Click \"Continue\".\n4. In the \"Create Revision\" page, change  the \"Visible to\" to \"Administrators\" and \"Editable By\" to \"Administrators\". Click \"Create New Revision\".\n5. In the \"Differential\" page, click \"Download Raw Diff\" on the right. After the page is fully loaded, copy the URL.\n6. Open a new Private browser window (so that you are logged off). Visit the copied URL. You can see the raw diff, even if you are not logged in any account.\n\nAlthough you are using a temporary files for the raw diff file, it's clear that there's no permission set to this file, because anyone with the URL can view it.\n\n## Impact\n\nI can think of two attack scenarios:\n1. Let's say that every developer in my team is in the same discussion group. I post a Raw Diff URL to the group. I think I am safe to do so because Phabricator should block non-admin from viewing it. But in reality, everyone, including less trusted members, has access to the restricted raw diff file. Note that there's no warning telling me not to share the URL.\n\n2. Suppose there's a directory listing vulnerability on my server, an attacker can use that vulnerability together with this issue to read all raw diff files in the temp folders.\n\nmongoose\n\nSincerely,\nXiaoyin","vulnerability_information_html":"\u003cp\u003emongoose\u003c/p\u003e\n\n\u003cp\u003eThis is similar to \u003ca href=\"/reports/213942\"\u003e#213942\u003c/a\u003e, but less severe. Here is what you said in \u003ca href=\"/reports/213942\"\u003e#213942\u003c/a\u003e:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe change makes us write files with narrow permissions (instead of broad permissions), write temporary files (instead of permanent files) and [...]\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eIf I understand your comment correctly, suppose that an Administrator creates a diff and revision and sets its visibility to \u0026quot;Administrators\u0026quot;, it means that non-admin users cannot view the raw diff via a URL generated by Phabricator, even if the URL is generated randomly, is it correct?\u003c/p\u003e\n\n\u003cp\u003eBut here is what I find with repro steps:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eLog in an Phabricator account. Then go to \u003ca title=\"http://phab.local/differential/diff/create\" href=\"/redirect?url=http%3A%2F%2Fphab.local%2Fdifferential%2Fdiff%2Fcreate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://phab.local/differential/diff/create\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eEnter any raw diff. Change the \u0026quot;Visible to\u0026quot; to \u0026quot;Administrators\u0026quot;. Click \u0026quot;Create Diff\u0026quot;.\u003c/li\u003e\n\u003cli\u003eLeave \u0026quot;Attach To\u0026quot; as \u0026quot;Create a new Revision...\u0026quot;. Click \u0026quot;Continue\u0026quot;.\u003c/li\u003e\n\u003cli\u003eIn the \u0026quot;Create Revision\u0026quot; page, change  the \u0026quot;Visible to\u0026quot; to \u0026quot;Administrators\u0026quot; and \u0026quot;Editable By\u0026quot; to \u0026quot;Administrators\u0026quot;. Click \u0026quot;Create New Revision\u0026quot;.\u003c/li\u003e\n\u003cli\u003eIn the \u0026quot;Differential\u0026quot; page, click \u0026quot;Download Raw Diff\u0026quot; on the right. After the page is fully loaded, copy the URL.\u003c/li\u003e\n\u003cli\u003eOpen a new Private browser window (so that you are logged off). Visit the copied URL. You can see the raw diff, even if you are not logged in any account.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAlthough you are using a temporary files for the raw diff file, it\u0026#39;s clear that there\u0026#39;s no permission set to this file, because anyone with the URL can view it.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eI can think of two attack scenarios:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eLet\u0026#39;s say that every developer in my team is in the same discussion group. I post a Raw Diff URL to the group. I think I am safe to do so because Phabricator should block non-admin from viewing it. But in reality, everyone, including less trusted members, has access to the restricted raw diff file. Note that there\u0026#39;s no warning telling me not to share the URL.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eSuppose there\u0026#39;s a directory listing vulnerability on my server, an attacker can use that vulnerability together with this issue to read all raw diff files in the temp folders.\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003emongoose\u003c/p\u003e\n\n\u003cp\u003eSincerely,\u003cbr\u003e\nXiaoyin\u003c/p\u003e\n","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":300774,"file_name":"raw_diff_accessible_to_everyone.jpg","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/300/774/37f33cd323189f391872ffcc638bc5cf7ff24089/raw_diff_accessible_to_everyone.jpg?response-content-disposition=attachment%3B%20filename%3D%22raw_diff_accessible_to_everyone.jpg%22%3B%20filename%2A%3DUTF-8%27%27raw_diff_accessible_to_everyone.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T054203Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=26775a3221e8252420f82f520c2f838015388a90a9bc748a552814bd7130839e","file_size":79264,"type":"image/jpeg"}],"allow_singular_disclosure_at":null,"vote_count":1,"voters":["testinghacker0x01"],"severity":{"rating":"low","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2787112,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"This is working as designed. See \u003chttps://secure.phabricator.com/T10262\u003e for discussion.","markdown_message":"\u003cp\u003eThis is working as designed. See \u003ca title=\"https://secure.phabricator.com/T10262\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2FT10262\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/T10262\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e for discussion.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-05-23T16:19:20.690Z","updated_at":"2018-05-23T16:19:20.690Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2787156,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks for the quick reply! Can we disclose this so that others won't file duplicates?","markdown_message":"\u003cp\u003eThanks for the quick reply! Can we disclose this so that others won\u0026#39;t file duplicates?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-05-23T16:23:18.430Z","updated_at":"2018-05-23T16:23:18.430Z","first_to_agree":true,"actor":{"username":"xiaoyinl","cleared":true,"url":"/xiaoyinl","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/018/322/771e7ba50572621c57e02f8eed8f23fc362c4e52_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2787159,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Yep, definitely.","markdown_message":"\u003cp\u003eYep, definitely.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-05-23T16:23:47.118Z","updated_at":"2018-05-23T16:23:47.118Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2787160,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-23T16:23:47.180Z","updated_at":"2018-05-23T16:23:47.180Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}