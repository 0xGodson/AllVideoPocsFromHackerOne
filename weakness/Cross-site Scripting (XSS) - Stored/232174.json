{"id":232174,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMzIxNzQ=","url":"https://hackerone.com/reports/232174","title":"XSS on $shop$.myshopify.com/admin/ and partners.shopify.com via whitelist bypass in SVG icon for sales channel applications","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-05-26T09:12:00.386Z","submitted_at":"2017-05-26T09:12:00.386Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bored-engineer","url":"/bored-engineer","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/328/c56b0e4e98b2bb24781c0cbec9ab8cd23be36b5f_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-06-27T23:49:28.072Z","bug_reporter_agreed_on_going_public_at":"2017-06-27T23:49:28.007Z","team_member_agreed_on_going_public_at":"2017-06-27T23:00:42.926Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Description\nShopify allows developers to create a special type of application called a \"[Sales Channel](https://help.shopify.com/api/sdks/sales-channel-sdk)\". Developers are allowed to upload a 16x16 SVG \"Navigation Icon\" for their app provided the SVG follows the [design guidelines](https://help.shopify.com/api/sdks/sales-channel-sdk/design-guidelines/checklist#navigation-icon) which limits the allowed elements and attributes. For some reason when the SVG contains an XML entity this whitelist is no longer enforced allowing the developer to include malicious attributes such as `onload`. By uploading a malicious SVG a developer can obtain XSS on both partners.shopify.com, as well as any the admin panel of any shop which has authorized the sales channel. \n\n# Proof of Concept\nThis is relatively easy to reproduce, first create a new application within the [Partners dashboard](https://partners.shopify.com) then navigate to \"Extensions\" -\u003e \"Sales channel\" to convert the application. After saving those changes a new field within the \"App info\" section titled \"Navigation icon\". Upload the following SVG:\n```xml\n\u003c?xml version=\"1.0\" encoding=\"ISO-8859-1\"?\u003e\n\u003c!DOCTYPE svg [\n    \u003c!ENTITY elem \"\"\u003e\n]\u003e\n\u003csvg onload=\"alert(document.domain);\" height=\"16\" width=\"16\"\u003e\n  \u0026elem;\n\u003c/svg\u003e\n```\nAfter saving changes the XSS payload will fire on [partners.shopify.com](https://partners.shopify.com). To fire the payload on `$shop$.myshopify.com/admin/` you'll need to authorize the application on your shop:\nI've created an example malicious application associated with my partner account `shopify-whitehat-2+hackerone@bored.engineer` to help demonstrate the issue, you can authorize it by opening the following URL on `$your-shop$.myshopify.com`:\n```\n/admin/oauth/authorize?client_id=672a937d5eb24e10c756ea256c73bb8c\u0026scope=read_products\u0026redirect_uri=https://attackerdoma.in/93ba4bef-cff1-43b1-922d-0631bd387e2e.html\u0026state=nonce\n```\nImmediately after authorizing the application (and all future admin panel loads) an alert should appear on the /admin window containing document.domain.\n\n# Exploitability\nThis seems like a really odd issue, so it may good to see if there are other places this icon could surface (ex. the app store or internal admin panels) to full understand the impact. For the known exploitable use-case via OAuth authorization you do need to convince an administrator to authorize your malicious application, however the exploit does not require any specific permissions to trigger so an admin may be more willing to authorize the application. Once the administrator has loaded the application it will immediately fire without additional user-interaction. \n\n# Remediation\nThe application should not allow XML entities in uploaded SVGs (or at least fix the parsing so it handles them correctly).","vulnerability_information_html":"\u003ch1 id=\"description\"\u003eDescription\u003c/h1\u003e\n\n\u003cp\u003eShopify allows developers to create a special type of application called a \u0026quot;\u003ca href=\"/redirect?url=https%3A%2F%2Fhelp.shopify.com%2Fapi%2Fsdks%2Fsales-channel-sdk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eSales Channel\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026quot;. Developers are allowed to upload a 16x16 SVG \u0026quot;Navigation Icon\u0026quot; for their app provided the SVG follows the \u003ca href=\"/redirect?url=https%3A%2F%2Fhelp.shopify.com%2Fapi%2Fsdks%2Fsales-channel-sdk%2Fdesign-guidelines%2Fchecklist%23navigation-icon\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003edesign guidelines\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e which limits the allowed elements and attributes. For some reason when the SVG contains an XML entity this whitelist is no longer enforced allowing the developer to include malicious attributes such as \u003ccode\u003eonload\u003c/code\u003e. By uploading a malicious SVG a developer can obtain XSS on both partners.shopify.com, as well as any the admin panel of any shop which has authorized the sales channel. \u003c/p\u003e\n\n\u003ch1 id=\"proof-of-concept\"\u003eProof of Concept\u003c/h1\u003e\n\n\u003cp\u003eThis is relatively easy to reproduce, first create a new application within the \u003ca href=\"/redirect?url=https%3A%2F%2Fpartners.shopify.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ePartners dashboard\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e then navigate to \u0026quot;Extensions\u0026quot; -\u0026gt; \u0026quot;Sales channel\u0026quot; to convert the application. After saving those changes a new field within the \u0026quot;App info\u0026quot; section titled \u0026quot;Navigation icon\u0026quot;. Upload the following SVG:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;ISO-8859-1\u0026quot;?\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE svg [\n    \u0026lt;!ENTITY elem \u0026quot;\u0026quot;\u0026gt;\u003c/span\u003e\n]\u0026gt;\n\u003cspan class=\"nt\"\u003e\u0026lt;svg\u003c/span\u003e \u003cspan class=\"na\"\u003eonload=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;alert(document.domain);\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eheight=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;16\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;16\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"ni\"\u003e\u0026amp;elem;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/svg\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter saving changes the XSS payload will fire on \u003ca href=\"/redirect?url=https%3A%2F%2Fpartners.shopify.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003epartners.shopify.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. To fire the payload on \u003ccode\u003e$shop$.myshopify.com/admin/\u003c/code\u003e you\u0026#39;ll need to authorize the application on your shop:\u003cbr\u003e\nI\u0026#39;ve created an example malicious application associated with my partner account \u003ccode\u003eshopify-whitehat-2+hackerone@bored.engineer\u003c/code\u003e to help demonstrate the issue, you can authorize it by opening the following URL on \u003ccode\u003e$your-shop$.myshopify.com\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e/admin/oauth/authorize?client_id=672a937d5eb24e10c756ea256c73bb8c\u0026amp;scope=read_products\u0026amp;redirect_uri=https://attackerdoma.in/93ba4bef-cff1-43b1-922d-0631bd387e2e.html\u0026amp;state=nonce\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eImmediately after authorizing the application (and all future admin panel loads) an alert should appear on the /admin window containing document.domain.\u003c/p\u003e\n\n\u003ch1 id=\"exploitability\"\u003eExploitability\u003c/h1\u003e\n\n\u003cp\u003eThis seems like a really odd issue, so it may good to see if there are other places this icon could surface (ex. the app store or internal admin panels) to full understand the impact. For the known exploitable use-case via OAuth authorization you do need to convince an administrator to authorize your malicious application, however the exploit does not require any specific permissions to trigger so an admin may be more willing to authorize the application. Once the administrator has loaded the application it will immediately fire without additional user-interaction. \u003c/p\u003e\n\n\u003ch1 id=\"remediation\"\u003eRemediation\u003c/h1\u003e\n\n\u003cp\u003eThe application should not allow XML entities in uploaded SVGs (or at least fix the parsing so it handles them correctly).\u003c/p\u003e\n","bounty_amount":"5000.0","formatted_bounty":"$5,000","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":78,"voters":["zhchbin","sp1d3rs","rijalrojan","cdl","hunter","r0x33d","bl4de","ramsexy","bogdantcaciuc","spam404","and 68 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":422,"asset_type":"URL","asset_identifier":"partners.shopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1703464,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for another great report! Our engineering team is investigating the issue.","markdown_message":"\u003cp\u003eThanks for another great report! Our engineering team is investigating the issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-26T13:59:14.305Z","updated_at":"2017-05-26T13:59:14.305Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1784531,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report.\n\nIt turned out that a recent change to the SVG sanitization code introduced a bug that caused it to fail open when an XML parsing error occurred, which is why it was possible to bypass the sanitizer by adding an XML entity. We corrected the bug, and verified that it had not been exploited by any other users.\n\nBesides being rendered in partners.shopify.com and the Shopify admin panel, uploaded SVG files also appeared in an internal admin panel, which increased the impact of this bug. This functionality was not required, so it has been removed.\n\nOur next round of bounty decisions will take place later this week, so we'll be in touch with you again soon.","markdown_message":"\u003cp\u003eThanks again for your report.\u003c/p\u003e\n\n\u003cp\u003eIt turned out that a recent change to the SVG sanitization code introduced a bug that caused it to fail open when an XML parsing error occurred, which is why it was possible to bypass the sanitizer by adding an XML entity. We corrected the bug, and verified that it had not been exploited by any other users.\u003c/p\u003e\n\n\u003cp\u003eBesides being rendered in partners.shopify.com and the Shopify admin panel, uploaded SVG files also appeared in an internal admin panel, which increased the impact of this bug. This functionality was not required, so it has been removed.\u003c/p\u003e\n\n\u003cp\u003eOur next round of bounty decisions will take place later this week, so we\u0026#39;ll be in touch with you again soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-27T14:41:39.289Z","updated_at":"2017-06-27T14:41:39.289Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bored-engineer","url":"/bored-engineer"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1786191,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks again for this report. We're awarding 10x our minimum for this issue based on a couple of factors. First this XSS affected all important areas of Shopify: the partners dashboard, the admin area and our internal area accessible to employees only. Second we verified that the issue could have been used to exfiltrate merchant data if a successful attack was performed against a shopify employee. Third the complexity of the attack is low and we believe the probability of success is high.","markdown_message":"\u003cp\u003eThanks again for this report. We\u0026#39;re awarding 10x our minimum for this issue based on a couple of factors. First this XSS affected all important areas of Shopify: the partners dashboard, the admin area and our internal area accessible to employees only. Second we verified that the issue could have been used to exfiltrate merchant data if a successful attack was performed against a shopify employee. Third the complexity of the attack is low and we believe the probability of success is high.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-27T23:00:18.255Z","updated_at":"2017-06-27T23:00:18.255Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1786192,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-06-27T23:00:31.943Z","updated_at":"2017-06-27T23:00:31.943Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"5000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"bored-engineer","url":"/bored-engineer"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1786193,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-06-27T23:00:42.950Z","updated_at":"2017-06-27T23:00:42.950Z","first_to_agree":true,"actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1786275,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks!","markdown_message":"\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-27T23:49:28.036Z","updated_at":"2017-06-27T23:49:28.036Z","actor":{"username":"bored-engineer","cleared":false,"url":"/bored-engineer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/328/c56b0e4e98b2bb24781c0cbec9ab8cd23be36b5f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1786276,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-06-27T23:49:28.092Z","updated_at":"2017-06-27T23:49:28.092Z","actor":{"username":"bored-engineer","cleared":false,"url":"/bored-engineer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/328/c56b0e4e98b2bb24781c0cbec9ab8cd23be36b5f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2890080,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-15T19:05:26.703Z","updated_at":"2018-06-15T19:05:26.703Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"partners.shopify.com","genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2890082,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-15T19:05:43.960Z","updated_at":"2018-06-15T19:05:43.960Z","additional_data":{"added_weaknesses":[{"id":62,"name":"Cross-site Scripting (XSS) - Stored"}],"removed_weaknesses":[{"id":63,"name":"Cross-site Scripting (XSS) - DOM"}]},"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}