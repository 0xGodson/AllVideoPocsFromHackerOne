{"id":309531,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDk1MzE=","url":"https://hackerone.com/reports/309531","title":"Stored XSS in Snapmatic + R★Editor comments","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-01-26T11:36:03.600Z","submitted_at":"2018-01-26T11:36:03.600Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"europa","url":"/europa","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2143,"url":"https://hackerone.com/rockstargames","handle":"rockstargames","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Rockstar Games","twitter_handle":"RockstarGames","website":"http://www.rockstargames.com/","about":"Publishers of such popular games as Grand Theft Auto, Max Payne, Red Dead Redemption, L.A. Noire, Bully \u0026 more."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-04-19T22:14:18.783Z","bug_reporter_agreed_on_going_public_at":"2018-04-08T13:42:19.897Z","team_member_agreed_on_going_public_at":"2018-04-19T22:14:18.550Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-05-08T13:42:20.082Z","allow_singular_disclosure_after":-83432933.37129758,"singular_disclosure_allowed":true,"vote_count":107,"voters":["nrockhouse","jokebookservice1","flamezzz","manoelt","irvinlim","knight9","sp1d3rs","airblender","kapytein","europa","and 97 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":430,"asset_type":"URL","asset_identifier":"socialclub.rockstargames.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2321999,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-26T20:48:17.468Z","updated_at":"2018-01-26T20:48:17.468Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2322002,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-26T20:48:37.378Z","updated_at":"2018-01-26T20:48:37.378Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2323538,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-27T09:49:14.248Z","updated_at":"2018-01-27T09:52:26.436Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2388599,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-16T02:24:20.583Z","updated_at":"2018-02-16T02:24:20.583Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2388600,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-16T02:24:34.313Z","updated_at":"2018-02-16T02:24:34.313Z","actor":{"url":"/rockstargames","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Rockstar Games"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"rockstargames","collaborator":{"username":"europa","url":"/europa"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2390074,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-16T09:30:15.773Z","updated_at":"2018-02-16T09:30:15.773Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2453328,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-03T18:18:30.732Z","updated_at":"2018-03-03T18:26:45.125Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2505855,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-19T11:17:50.778Z","updated_at":"2018-03-19T11:17:50.778Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2506460,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-19T15:29:03.247Z","updated_at":"2018-03-19T15:29:03.247Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"europa","url":"/europa"},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2578400,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-08T13:42:19.986Z","updated_at":"2018-04-08T13:42:19.986Z","first_to_agree":true,"actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2581257,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-09T14:05:09.320Z","updated_at":"2018-04-09T14:05:09.320Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2581267,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-09T14:09:56.148Z","updated_at":"2018-04-09T14:09:56.148Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2582748,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-09T17:55:49.054Z","updated_at":"2018-04-09T17:55:49.054Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2638185,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-19T15:25:44.316Z","updated_at":"2018-04-19T15:25:44.316Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2638217,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-19T15:38:26.222Z","updated_at":"2018-04-19T15:38:26.222Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2639503,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-19T22:14:18.644Z","updated_at":"2018-04-19T22:14:18.644Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2639504,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-19T22:14:18.826Z","updated_at":"2018-04-19T22:14:18.826Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":7165,"category":"team","content":"**Summary provided by the Researcher, @europa .**\n___________________________________________________________________________________________________________________________\nI requested the disclosure of what I hope is the final report regarding stored cross-site-scripting vulnerabilities on the Rockstar Games SocialClub, to also allow me to summarize the research that went into the other 5 reports. \nHave fun!\n\n### Report #1\nThe 6-months adventure into researching and bypassing the SocialClub WAF begun with a simple discovery at first: while the WAF was removing anything enclosed in `\u003c.*`, some **control characters** (`\\b \\f \\n \\r \\t`) weren't being taken into account when injecting a `\u003c`, allowing an adversary to create a malicious payload in the simple form of `\u003c\\t`.\n\nA fix was deployed to **remove anything following a** `\u003c`.\n\n### Report #2\nTwo weeks after the fix, I ended up discovering what would soon become a “head-scratching” mystery: injecting a **single** `%` in the payload would bypass the filter entirely and force the back-end to somehow produce an unescaped `\u003c` along with the escaped one.\n\nThe original payload was complex and confusing, and it led me to the wrong conclusion that [over-consumption flaws](https://hackerone.com/redirect?signature=e9fdfe4ae08f06fd697d9820b6472cbc3aceb3a2\u0026url=https%3A%2F%2Fwebsec.github.io%2Funicode-security-guide%2Fcharacter-transformations%2F%23overconsumption) were to blame, but as analysis proceeded, it was finally discovered that the culprit was the **simple, single** `%`.\n\nThe final payload `\u003c%\u0026lt;script/src=//...?` produced an output of `\u0026lt;%\u003cscript/src=\"//...\" \u003c=\"\" p=\"\"\u003e` from the back-end.\n\nA fix was deployed and the WAF rules were made more strict, defeating all attempts with a 302 redirect to an error page.\n\n### Report #3\nTwo months after the last fix, I discovered how the WAF wouldn't account for [Full-Width](https://hackerone.com/redirect?signature=94c9f9639fb2c55281d3c1e2820f40ecadc45807\u0026url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2BFF00) and [Small-Forms](https://hackerone.com/redirect?signature=e823898824394a9c0700e14806b23d9982e8d57a\u0026url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2BFE50) variants which, chained with the `%` confusion from the second report would again trick the back-end into producing a valid output: indeed, giving **`U+FF1C`** or **`U+FE64`** as the input would pass the WAF and the back-end would transform both into `\u003c`. This is called a [best-fit match flaw](https://hackerone.com/redirect?signature=bc75d2374467e877b490cd0801b7c340ad395857\u0026url=https%3A%2F%2Fwebsec.github.io%2Funicode-security-guide%2Fcharacter-transformations%2F%23best-fit) and it usually happens on Windows-powered technology stacks, where one of the processing layers fails to properly account for missing characters in destination codepages.\n\nThe payload `\\uFE64%\\uFF1Cscript/src=//...?`, evaded the WAF and produced `\u0026lt;%\u003cscript/src=\"//...?\" class=\"badLink\"` in the HTML page.\n\nA first fix was deployed preventing both script injections and DOM events manipulation, both of which I was able to bypass after a few days using a combination of **control chars, percentages, breaks, and exotic function invokation**. The payload `\\uFF1C%\\uFE64input/autofocus onfocus\\b='[1].find(alert)'` successfully bypassed the new filters and popped an alert before the report was closed as resolved, allowing the team to look for a better solution in time. A second, stronger fix was deployed and the WAF rules were made even stricter prohibiting any combination of direct or indirect forms of `\u003c` and `%` in suspicious contextes, plus any shape or form of `onXXX` DOM events.\n\n### Report #4\nThe new WAF rules prevented any kind of injection: no useful HTML elements, no DOM events. Anything went straight to /dev/null. After spending a few weeks in trial \u0026 error tests, I remembered how the payload from **report #3** would have a `badLink class` added to it, as the back-end detected a suspicious URI in the comment and would ~~strike it out~~ and prevent it from becoming clickable.\n\nAfter weeks of tests, in a few hours I was able to chain **_eight_ different techniques** to go through the WAF, the back-end filter, and the client-side Javascript filter:\n\n1. using `\u003c\u003e` to separate “trigger words” in order to turn them “invisible” to the WAF (ie: `\u0026\u003c\u003elt;`). The _back-end_ would remove it for me.\n2. using `\\u0025` instead of `%` which would now trigger the WAF\n3. using the unaccounted for `MATH` [MathML](https://hackerone.com/redirect?signature=f00315bb1ba003cb663832891ce2f04a5e1709e2\u0026url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FMathML%2FElement%2Fmath) element\n4. using control characters (`\\n \\t \\b \\r \\f` from **report #1**) to break element names to trick the _back-end_ (not the WAF) into reassembling them in output (ie: `\u003cm\\bath` instead of `\u003cmath`)\n5. using the `xml:base` attribute instead of the usual `href` to specify a Javascript URI\n6. injecting quotes to mess up the output from the back-end\n7. using an innocuos `href=#` to make everything following the payload clickable\n8. using a **fake URL** enclosed in `[]` to exploit a flaw in the rendering engine in the back-end that would cause it to move the payload outside of the \"badUrl\" element and place it where we could use it\n\nThe final payload was `\u0026\u003c\u003elt;%\u0026\u003c\u003elt;m\\bath xml:base=\\\"j\u003c\u003eavascript:alert(document.domain)//\\\" href=#\\\"[bad.url.pls]` which produced `\u0026lt%\u003cmath xml:base=\"javascript:alert(document.domain)//\" href=\"#\" x=\"\" class=\"badLink\"\u003e[bad.url.pls]`\n\nAs a bonus note, this led to the discovery of a particular payload that would render a newsfeed comment **un-repliable and un-deletable**. Both flaws were fixed with better rules, and by preventing the back-end from stripping “*conveniently-placed*” tags and control characters.\n\n### Report #5\nSomewhat less-related to the SocialClub per sé, this was a variation on **report #3** where it was discovered that Snapmatic and R★ Editor comments would go a different validation flow than any other entry, and the [best-fit matchings](https://hackerone.com/redirect?signature=bc75d2374467e877b490cd0801b7c340ad395857\u0026url=https%3A%2F%2Fwebsec.github.io%2Funicode-security-guide%2Fcharacter-transformations%2F%23best-fit) would once again act up but on a different codepage this time, when using **Left-Angle brackets** `U+3008 \"〈\"` from the [Cjk Symbols and Punctuation block](https://hackerone.com/redirect?signature=73b9a54dadbf0c72c2d6cba07cdf52f97d13da52\u0026url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2B3000), and **Left-pointing Angle brackets** `U+2329 \"〈\"` from the [Miscellaneus Technical block](https://hackerone.com/redirect?signature=12de40484af21138b7e46413f2fa9bc6eaff769e\u0026url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2B2300).\n\nWhile the Snapmatic/R★ Editor back-end would block `U+FF1C` and `U+FE64`, the other two would go through and get \"matched\" to `\u003c` somewhere in the web technology stack. My last payload was `〈script/src=//...?` and it was promptly fixed in both its variations.\n\n### Conclusions\nThe Rockstar Games team is amazing. My first duplicate report was with them back in September and if it wasn't for @jmarshall reacting so politely to my unjustified noobish irk to a duplicate I would've probably dropped bug bounties altogether.\n\nIt's been great to be involved all these months into researching new things and approaches—failing for weeks at a time allowed me to learn new techniques and extremely peculiar quirks I now feel ready to share with the community. I still go back and try new ideas as of today, so far without success. Which is great.\n\nAd maiora!","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003cstrong\u003eSummary provided by the Researcher, \u003ca href=\"/europa\"\u003e@europa\u003c/a\u003e .\u003c/strong\u003e\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eI requested the disclosure of what I hope is the final report regarding stored cross-site-scripting vulnerabilities on the Rockstar Games SocialClub, to also allow me to summarize the research that went into the other 5 reports. \u003cbr\u003e\nHave fun!\u003c/p\u003e\n\n\u003ch3 id=\"report-1\"\u003eReport #1\u003c/h3\u003e\n\n\u003cp\u003eThe 6-months adventure into researching and bypassing the SocialClub WAF begun with a simple discovery at first: while the WAF was removing anything enclosed in \u003ccode\u003e\u0026lt;.*\u003c/code\u003e, some \u003cstrong\u003econtrol characters\u003c/strong\u003e (\u003ccode\u003e\\b \\f \\n \\r \\t\u003c/code\u003e) weren\u0026#39;t being taken into account when injecting a \u003ccode\u003e\u0026lt;\u003c/code\u003e, allowing an adversary to create a malicious payload in the simple form of \u003ccode\u003e\u0026lt;\\t\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eA fix was deployed to \u003cstrong\u003eremove anything following a\u003c/strong\u003e \u003ccode\u003e\u0026lt;\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch3 id=\"report-2\"\u003eReport #2\u003c/h3\u003e\n\n\u003cp\u003eTwo weeks after the fix, I ended up discovering what would soon become a “head-scratching” mystery: injecting a \u003cstrong\u003esingle\u003c/strong\u003e \u003ccode\u003e%\u003c/code\u003e in the payload would bypass the filter entirely and force the back-end to somehow produce an unescaped \u003ccode\u003e\u0026lt;\u003c/code\u003e along with the escaped one.\u003c/p\u003e\n\n\u003cp\u003eThe original payload was complex and confusing, and it led me to the wrong conclusion that \u003ca href=\"https://hackerone.com/redirect?signature=e9fdfe4ae08f06fd697d9820b6472cbc3aceb3a2\u0026amp;url=https%3A%2F%2Fwebsec.github.io%2Funicode-security-guide%2Fcharacter-transformations%2F%23overconsumption\"\u003eover-consumption flaws\u003c/a\u003e were to blame, but as analysis proceeded, it was finally discovered that the culprit was the \u003cstrong\u003esimple, single\u003c/strong\u003e \u003ccode\u003e%\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe final payload \u003ccode\u003e\u0026lt;%\u0026amp;lt;script/src=//...?\u003c/code\u003e produced an output of \u003ccode\u003e\u0026amp;lt;%\u0026lt;script/src=\u0026quot;//...\u0026quot; \u0026lt;=\u0026quot;\u0026quot; p=\u0026quot;\u0026quot;\u0026gt;\u003c/code\u003e from the back-end.\u003c/p\u003e\n\n\u003cp\u003eA fix was deployed and the WAF rules were made more strict, defeating all attempts with a 302 redirect to an error page.\u003c/p\u003e\n\n\u003ch3 id=\"report-3\"\u003eReport #3\u003c/h3\u003e\n\n\u003cp\u003eTwo months after the last fix, I discovered how the WAF wouldn\u0026#39;t account for \u003ca href=\"https://hackerone.com/redirect?signature=94c9f9639fb2c55281d3c1e2820f40ecadc45807\u0026amp;url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2BFF00\"\u003eFull-Width\u003c/a\u003e and \u003ca href=\"https://hackerone.com/redirect?signature=e823898824394a9c0700e14806b23d9982e8d57a\u0026amp;url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2BFE50\"\u003eSmall-Forms\u003c/a\u003e variants which, chained with the \u003ccode\u003e%\u003c/code\u003e confusion from the second report would again trick the back-end into producing a valid output: indeed, giving \u003cstrong\u003e\u003ccode\u003eU+FF1C\u003c/code\u003e\u003c/strong\u003e or \u003cstrong\u003e\u003ccode\u003eU+FE64\u003c/code\u003e\u003c/strong\u003e as the input would pass the WAF and the back-end would transform both into \u003ccode\u003e\u0026lt;\u003c/code\u003e. This is called a \u003ca href=\"https://hackerone.com/redirect?signature=bc75d2374467e877b490cd0801b7c340ad395857\u0026amp;url=https%3A%2F%2Fwebsec.github.io%2Funicode-security-guide%2Fcharacter-transformations%2F%23best-fit\"\u003ebest-fit match flaw\u003c/a\u003e and it usually happens on Windows-powered technology stacks, where one of the processing layers fails to properly account for missing characters in destination codepages.\u003c/p\u003e\n\n\u003cp\u003eThe payload \u003ccode\u003e\\uFE64%\\uFF1Cscript/src=//...?\u003c/code\u003e, evaded the WAF and produced \u003ccode\u003e\u0026amp;lt;%\u0026lt;script/src=\u0026quot;//...?\u0026quot; class=\u0026quot;badLink\u0026quot;\u003c/code\u003e in the HTML page.\u003c/p\u003e\n\n\u003cp\u003eA first fix was deployed preventing both script injections and DOM events manipulation, both of which I was able to bypass after a few days using a combination of \u003cstrong\u003econtrol chars, percentages, breaks, and exotic function invokation\u003c/strong\u003e. The payload \u003ccode\u003e\\uFF1C%\\uFE64input/autofocus onfocus\\b=\u0026#39;[1].find(alert)\u0026#39;\u003c/code\u003e successfully bypassed the new filters and popped an alert before the report was closed as resolved, allowing the team to look for a better solution in time. A second, stronger fix was deployed and the WAF rules were made even stricter prohibiting any combination of direct or indirect forms of \u003ccode\u003e\u0026lt;\u003c/code\u003e and \u003ccode\u003e%\u003c/code\u003e in suspicious contextes, plus any shape or form of \u003ccode\u003eonXXX\u003c/code\u003e DOM events.\u003c/p\u003e\n\n\u003ch3 id=\"report-4\"\u003eReport #4\u003c/h3\u003e\n\n\u003cp\u003eThe new WAF rules prevented any kind of injection: no useful HTML elements, no DOM events. Anything went straight to /dev/null. After spending a few weeks in trial \u0026amp; error tests, I remembered how the payload from \u003cstrong\u003ereport #3\u003c/strong\u003e would have a \u003ccode\u003ebadLink class\u003c/code\u003e added to it, as the back-end detected a suspicious URI in the comment and would \u003cdel\u003estrike it out\u003c/del\u003e and prevent it from becoming clickable.\u003c/p\u003e\n\n\u003cp\u003eAfter weeks of tests, in a few hours I was able to chain \u003cstrong\u003e\u003cu\u003eeight\u003c/u\u003e different techniques\u003c/strong\u003e to go through the WAF, the back-end filter, and the client-side Javascript filter:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eusing \u003ccode\u003e\u0026lt;\u0026gt;\u003c/code\u003e to separate “trigger words” in order to turn them “invisible” to the WAF (ie: \u003ccode\u003e\u0026amp;\u0026lt;\u0026gt;lt;\u003c/code\u003e). The \u003cu\u003eback-end\u003c/u\u003e would remove it for me.\u003c/li\u003e\n\u003cli\u003eusing \u003ccode\u003e\\u0025\u003c/code\u003e instead of \u003ccode\u003e%\u003c/code\u003e which would now trigger the WAF\u003c/li\u003e\n\u003cli\u003eusing the unaccounted for \u003ccode\u003eMATH\u003c/code\u003e \u003ca href=\"https://hackerone.com/redirect?signature=f00315bb1ba003cb663832891ce2f04a5e1709e2\u0026amp;url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FMathML%2FElement%2Fmath\"\u003eMathML\u003c/a\u003e element\u003c/li\u003e\n\u003cli\u003eusing control characters (\u003ccode\u003e\\n \\t \\b \\r \\f\u003c/code\u003e from \u003cstrong\u003ereport #1\u003c/strong\u003e) to break element names to trick the \u003cu\u003eback-end\u003c/u\u003e (not the WAF) into reassembling them in output (ie: \u003ccode\u003e\u0026lt;m\\bath\u003c/code\u003e instead of \u003ccode\u003e\u0026lt;math\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eusing the \u003ccode\u003exml:base\u003c/code\u003e attribute instead of the usual \u003ccode\u003ehref\u003c/code\u003e to specify a Javascript URI\u003c/li\u003e\n\u003cli\u003einjecting quotes to mess up the output from the back-end\u003c/li\u003e\n\u003cli\u003eusing an innocuos \u003ccode\u003ehref=#\u003c/code\u003e to make everything following the payload clickable\u003c/li\u003e\n\u003cli\u003eusing a \u003cstrong\u003efake URL\u003c/strong\u003e enclosed in \u003ccode\u003e[]\u003c/code\u003e to exploit a flaw in the rendering engine in the back-end that would cause it to move the payload outside of the \u0026quot;badUrl\u0026quot; element and place it where we could use it\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe final payload was \u003ccode\u003e\u0026amp;\u0026lt;\u0026gt;lt;%\u0026amp;\u0026lt;\u0026gt;lt;m\\bath xml:base=\\\u0026quot;j\u0026lt;\u0026gt;avascript:alert(document.domain)//\\\u0026quot; href=#\\\u0026quot;[bad.url.pls]\u003c/code\u003e which produced \u003ccode\u003e\u0026amp;lt%\u0026lt;math xml:base=\u0026quot;javascript:alert(document.domain)//\u0026quot; href=\u0026quot;#\u0026quot; x=\u0026quot;\u0026quot; class=\u0026quot;badLink\u0026quot;\u0026gt;[bad.url.pls]\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eAs a bonus note, this led to the discovery of a particular payload that would render a newsfeed comment \u003cstrong\u003eun-repliable and un-deletable\u003c/strong\u003e. Both flaws were fixed with better rules, and by preventing the back-end from stripping “\u003cem\u003econveniently-placed\u003c/em\u003e” tags and control characters.\u003c/p\u003e\n\n\u003ch3 id=\"report-5\"\u003eReport #5\u003c/h3\u003e\n\n\u003cp\u003eSomewhat less-related to the SocialClub per sé, this was a variation on \u003cstrong\u003ereport #3\u003c/strong\u003e where it was discovered that Snapmatic and R★ Editor comments would go a different validation flow than any other entry, and the \u003ca href=\"https://hackerone.com/redirect?signature=bc75d2374467e877b490cd0801b7c340ad395857\u0026amp;url=https%3A%2F%2Fwebsec.github.io%2Funicode-security-guide%2Fcharacter-transformations%2F%23best-fit\"\u003ebest-fit matchings\u003c/a\u003e would once again act up but on a different codepage this time, when using \u003cstrong\u003eLeft-Angle brackets\u003c/strong\u003e \u003ccode\u003eU+3008 \u0026quot;〈\u0026quot;\u003c/code\u003e from the \u003ca href=\"https://hackerone.com/redirect?signature=73b9a54dadbf0c72c2d6cba07cdf52f97d13da52\u0026amp;url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2B3000\"\u003eCjk Symbols and Punctuation block\u003c/a\u003e, and \u003cstrong\u003eLeft-pointing Angle brackets\u003c/strong\u003e \u003ccode\u003eU+2329 \u0026quot;〈\u0026quot;\u003c/code\u003e from the \u003ca href=\"https://hackerone.com/redirect?signature=12de40484af21138b7e46413f2fa9bc6eaff769e\u0026amp;url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2B2300\"\u003eMiscellaneus Technical block\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eWhile the Snapmatic/R★ Editor back-end would block \u003ccode\u003eU+FF1C\u003c/code\u003e and \u003ccode\u003eU+FE64\u003c/code\u003e, the other two would go through and get \u0026quot;matched\u0026quot; to \u003ccode\u003e\u0026lt;\u003c/code\u003e somewhere in the web technology stack. My last payload was \u003ccode\u003e〈script/src=//...?\u003c/code\u003e and it was promptly fixed in both its variations.\u003c/p\u003e\n\n\u003ch3 id=\"conclusions\"\u003eConclusions\u003c/h3\u003e\n\n\u003cp\u003eThe Rockstar Games team is amazing. My first duplicate report was with them back in September and if it wasn\u0026#39;t for \u003ca href=\"/jmarshall\"\u003e@jmarshall\u003c/a\u003e reacting so politely to my unjustified noobish irk to a duplicate I would\u0026#39;ve probably dropped bug bounties altogether.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026#39;s been great to be involved all these months into researching new things and approaches—failing for weeks at a time allowed me to learn new techniques and extremely peculiar quirks I now feel ready to share with the community. I still go back and try new ideas as of today, so far without success. Which is great.\u003c/p\u003e\n\n\u003cp\u003eAd maiora!\u003c/p\u003e\n"},{"id":7061,"category":"researcher","content":"I requested the disclosure of what I hope is the final report regarding stored cross-site-scripting vulnerabilities on the Rockstar Games SocialClub, to also allow me to summarize the research that went into the other 5 reports. \nHave fun!\n\n---\n\n### Report #1\nThe 6-months adventure into researching and bypassing the SocialClub WAF begun with a simple discovery at first: while the WAF was removing anything enclosed in `\u003c.*`, some **control characters** (`\\b \\f \\n \\r \\t`) weren't being taken into account when injecting a `\u003c`, allowing an adversary to create a malicious payload in the simple form of `\u003c\\t`.\n\nA fix was deployed to **remove anything following a `\u003c`**.\n\n### Report #2\nTwo weeks after the fix, I ended up discovering what would soon become a “head-scratching” mystery: injecting a **single `%`** in the payload would bypass the filter entirely and force the back-end to somehow produce an unescaped `\u003c` along with the escaped one.  \nThe original payload was complex and confusing, and it led me to the wrong conclusion that [over-consumption flaws](https://websec.github.io/unicode-security-guide/character-transformations/#overconsumption) were to blame, but as analysis proceeded, it was finally discovered that the culprit was the **simple, single `%`**.\n\nThe final payload `\u003c%\u0026lt;script/src=//...?` produced an output of `\u0026lt;%\u003cscript/src=\"//...\" \u003c=\"\" p=\"\"\u003e` from the back-end.\n\nA fix was deployed and the WAF rules were made more strict, defeating all attempts with a 302 redirect to an error page.\n\n### Report #3\nTwo months after the last fix, I discovered how the WAF wouldn't account for [**Full-Width**](https://www.compart.com/en/unicode/block/U+FF00) and [**Small-Forms**](https://www.compart.com/en/unicode/block/U+FE50) variants which, chained with the `%` confusion from the second report would again trick the back-end into producing a valid output: indeed, giving **`U+FF1C` or `U+FE64`** as the input would pass the WAF and the back-end would transform both into `\u003c`. This is called a [best-fit match flaw](https://websec.github.io/unicode-security-guide/character-transformations/#best-fit) and it usually happens on Windows-powered technology stacks, where one of the processing layers fails to properly account for missing characters in destination codepages.\n\nThe payload `\\uFE64%\\uFF1Cscript/src=//...?`, evaded the WAF and produced `\u0026lt;%\u003cscript/src=\"//...?\" class=\"badLink\"` in the HTML page.  \n\nA first fix was deployed preventing both script injections and DOM events manipulation, both of which I was able to bypass after a few days using a combination of **control chars, percentages, breaks, and exotic function invokation**.  The payload `\\uFF1C%\\uFE64input/autofocus onfocus\\b='[1].find(alert)'` successfully bypassed the new filters and popped an alert before the report was closed as resolved, allowing the team to look for a better solution in time. A second, stronger fix was deployed and the WAF rules were made even stricter prohibiting any combination of direct or indirect forms of `\u003c` and `%` in suspicious contextes, plus any shape or form of `onXXX` DOM events.\n\n### Report #4\nThe new WAF rules prevented *any* kind of injection: no useful HTML elements, no DOM events. Anything went straight to /dev/null. After spending a few weeks in trial \u0026 error tests, I remembered how the payload from **report #3** would have a `badLink` class added to it, as the back-end detected a suspicious URI in the comment and would ~~strike it out~~ and prevent it from becoming clickable.\n\nAfter weeks of tests, in a few hours I was able to chain **_eight_ different techniques** to go through the WAF, the back-end filter, and the client-side Javascript filter:\n\n1. using `\u003c\u003e` to separate “trigger words” in order to turn them “invisible” to the WAF (ie: `\u0026\u003c\u003elt;`). The _back-end_ would remove it for me.\n2. using `\\u0025` instead of `%` which would now trigger the WAF\n3. using the unaccounted for `MATH` [MathML element](https://developer.mozilla.org/en-US/docs/Web/MathML/Element/math)\n4. using control characters (`\\n \\t \\b \\r \\f` from **report #1**) to break element names to trick the _back-end_ (not the WAF) into reassembling them in output (ie: `\u003cm\\bath` instead of `\u003cmath`)\n5. using the `xml:base` attribute instead of the usual `href` to specify a Javascript URI\n6. injecting quotes to mess up the output from the back-end\n7. using an innocuos `href=#` to make everything following the payload clickable\n8. using a **fake URL** enclosed in `[]` to exploit a flaw in the rendering engine in the back-end that would cause it to move the payload *outside* of the \"badUrl\" element and place it where we could use it \n\nThe final payload was `\u0026\u003c\u003elt;%\u0026\u003c\u003elt;m\\bath xml:base=\\\"j\u003c\u003eavascript:alert(document.domain)//\\\" href=#\\\"[bad.url.pls]` which produced `\u0026lt%\u003cmath xml:base=\"javascript:alert(document.domain)//\" href=\"#\" x=\"\" class=\"badLink\"\u003e[bad.url.pls]`\n\nAs a bonus note, this led to the discovery of a particular payload that would render a newsfeed comment **un-repliable and un-deletable**. Both flaws were fixed with better rules, and by preventing the back-end from stripping *“conveniently-placed”* tags and control characters.\n\n### Report #5\nSomewhat *less-related* to the SocialClub per sé, this was a variation on **report #3** where it was discovered that Snapmatic and R★ Editor comments would go a different validation flow than any other entry, and the [best-fit matchings](https://websec.github.io/unicode-security-guide/character-transformations/#best-fit) would once again act up but on a different codepage this time, when using **Left-Angle brackets** `U+3008 \"〈\"` from the [Cjk Symbols and Punctuation block](https://www.compart.com/en/unicode/block/U+3000), and **Left-pointing Angle brackets** `U+2329 \"〈\"` from the [Miscellaneus Technical block](https://www.compart.com/en/unicode/block/U+2300).\n\nWhile the Snapmatic/R★ Editor back-end would block `U+FF1C` and `U+FE64`, the other two would go through and get \"matched\" to `\u003c` somewhere in the web technology stack. My last payload was `〈script/src=//...?` and it was promptly fixed in both its variations.\n\n### Conclusions\nThe Rockstar Games team is amazing. My first duplicate report was with them back in September and if it wasn't for @jmarshall reacting so politely to my unjustified noobish irk to a duplicate I would've probably dropped bug bounties altogether.  \nIt's been great to be involved all these months into researching new things and approaches—failing for weeks at a time allowed me to learn new techniques and extremely peculiar quirks I now feel ready to share with the community. I still go back and try new ideas as of today, so far without success. Which is great.\n\nAd maiora!","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eI requested the disclosure of what I hope is the final report regarding stored cross-site-scripting vulnerabilities on the Rockstar Games SocialClub, to also allow me to summarize the research that went into the other 5 reports. \u003cbr\u003e\nHave fun!\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003ch3 id=\"report-1\"\u003eReport #1\u003c/h3\u003e\n\n\u003cp\u003eThe 6-months adventure into researching and bypassing the SocialClub WAF begun with a simple discovery at first: while the WAF was removing anything enclosed in \u003ccode\u003e\u0026lt;.*\u003c/code\u003e, some \u003cstrong\u003econtrol characters\u003c/strong\u003e (\u003ccode\u003e\\b \\f \\n \\r \\t\u003c/code\u003e) weren\u0026#39;t being taken into account when injecting a \u003ccode\u003e\u0026lt;\u003c/code\u003e, allowing an adversary to create a malicious payload in the simple form of \u003ccode\u003e\u0026lt;\\t\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eA fix was deployed to \u003cstrong\u003eremove anything following a \u003ccode\u003e\u0026lt;\u003c/code\u003e\u003c/strong\u003e.\u003c/p\u003e\n\n\u003ch3 id=\"report-2\"\u003eReport #2\u003c/h3\u003e\n\n\u003cp\u003eTwo weeks after the fix, I ended up discovering what would soon become a “head-scratching” mystery: injecting a \u003cstrong\u003esingle \u003ccode\u003e%\u003c/code\u003e\u003c/strong\u003e in the payload would bypass the filter entirely and force the back-end to somehow produce an unescaped \u003ccode\u003e\u0026lt;\u003c/code\u003e along with the escaped one.\u003cbr\u003e\u003cbr\u003e\nThe original payload was complex and confusing, and it led me to the wrong conclusion that \u003ca href=\"/redirect?url=https%3A%2F%2Fwebsec.github.io%2Funicode-security-guide%2Fcharacter-transformations%2F%23overconsumption\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eover-consumption flaws\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e were to blame, but as analysis proceeded, it was finally discovered that the culprit was the \u003cstrong\u003esimple, single \u003ccode\u003e%\u003c/code\u003e\u003c/strong\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe final payload \u003ccode\u003e\u0026lt;%\u0026amp;lt;script/src=//...?\u003c/code\u003e produced an output of \u003ccode\u003e\u0026amp;lt;%\u0026lt;script/src=\u0026quot;//...\u0026quot; \u0026lt;=\u0026quot;\u0026quot; p=\u0026quot;\u0026quot;\u0026gt;\u003c/code\u003e from the back-end.\u003c/p\u003e\n\n\u003cp\u003eA fix was deployed and the WAF rules were made more strict, defeating all attempts with a 302 redirect to an error page.\u003c/p\u003e\n\n\u003ch3 id=\"report-3\"\u003eReport #3\u003c/h3\u003e\n\n\u003cp\u003eTwo months after the last fix, I discovered how the WAF wouldn\u0026#39;t account for \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2BFF00\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e\u003cstrong\u003eFull-Width\u003c/strong\u003e\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2BFE50\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e\u003cstrong\u003eSmall-Forms\u003c/strong\u003e\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e variants which, chained with the \u003ccode\u003e%\u003c/code\u003e confusion from the second report would again trick the back-end into producing a valid output: indeed, giving \u003cstrong\u003e\u003ccode\u003eU+FF1C\u003c/code\u003e or \u003ccode\u003eU+FE64\u003c/code\u003e\u003c/strong\u003e as the input would pass the WAF and the back-end would transform both into \u003ccode\u003e\u0026lt;\u003c/code\u003e. This is called a \u003ca href=\"/redirect?url=https%3A%2F%2Fwebsec.github.io%2Funicode-security-guide%2Fcharacter-transformations%2F%23best-fit\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ebest-fit match flaw\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and it usually happens on Windows-powered technology stacks, where one of the processing layers fails to properly account for missing characters in destination codepages.\u003c/p\u003e\n\n\u003cp\u003eThe payload \u003ccode\u003e\\uFE64%\\uFF1Cscript/src=//...?\u003c/code\u003e, evaded the WAF and produced \u003ccode\u003e\u0026amp;lt;%\u0026lt;script/src=\u0026quot;//...?\u0026quot; class=\u0026quot;badLink\u0026quot;\u003c/code\u003e in the HTML page.  \u003c/p\u003e\n\n\u003cp\u003eA first fix was deployed preventing both script injections and DOM events manipulation, both of which I was able to bypass after a few days using a combination of \u003cstrong\u003econtrol chars, percentages, breaks, and exotic function invokation\u003c/strong\u003e.  The payload \u003ccode\u003e\\uFF1C%\\uFE64input/autofocus onfocus\\b=\u0026#39;[1].find(alert)\u0026#39;\u003c/code\u003e successfully bypassed the new filters and popped an alert before the report was closed as resolved, allowing the team to look for a better solution in time. A second, stronger fix was deployed and the WAF rules were made even stricter prohibiting any combination of direct or indirect forms of \u003ccode\u003e\u0026lt;\u003c/code\u003e and \u003ccode\u003e%\u003c/code\u003e in suspicious contextes, plus any shape or form of \u003ccode\u003eonXXX\u003c/code\u003e DOM events.\u003c/p\u003e\n\n\u003ch3 id=\"report-4\"\u003eReport #4\u003c/h3\u003e\n\n\u003cp\u003eThe new WAF rules prevented \u003cem\u003eany\u003c/em\u003e kind of injection: no useful HTML elements, no DOM events. Anything went straight to /dev/null. After spending a few weeks in trial \u0026amp; error tests, I remembered how the payload from \u003cstrong\u003ereport #3\u003c/strong\u003e would have a \u003ccode\u003ebadLink\u003c/code\u003e class added to it, as the back-end detected a suspicious URI in the comment and would \u003cdel\u003estrike it out\u003c/del\u003e and prevent it from becoming clickable.\u003c/p\u003e\n\n\u003cp\u003eAfter weeks of tests, in a few hours I was able to chain \u003cstrong\u003e\u003cu\u003eeight\u003c/u\u003e different techniques\u003c/strong\u003e to go through the WAF, the back-end filter, and the client-side Javascript filter:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eusing \u003ccode\u003e\u0026lt;\u0026gt;\u003c/code\u003e to separate “trigger words” in order to turn them “invisible” to the WAF (ie: \u003ccode\u003e\u0026amp;\u0026lt;\u0026gt;lt;\u003c/code\u003e). The \u003cu\u003eback-end\u003c/u\u003e would remove it for me.\u003c/li\u003e\n\u003cli\u003eusing \u003ccode\u003e\\u0025\u003c/code\u003e instead of \u003ccode\u003e%\u003c/code\u003e which would now trigger the WAF\u003c/li\u003e\n\u003cli\u003eusing the unaccounted for \u003ccode\u003eMATH\u003c/code\u003e \u003ca href=\"/redirect?url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FMathML%2FElement%2Fmath\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eMathML element\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eusing control characters (\u003ccode\u003e\\n \\t \\b \\r \\f\u003c/code\u003e from \u003cstrong\u003ereport #1\u003c/strong\u003e) to break element names to trick the \u003cu\u003eback-end\u003c/u\u003e (not the WAF) into reassembling them in output (ie: \u003ccode\u003e\u0026lt;m\\bath\u003c/code\u003e instead of \u003ccode\u003e\u0026lt;math\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eusing the \u003ccode\u003exml:base\u003c/code\u003e attribute instead of the usual \u003ccode\u003ehref\u003c/code\u003e to specify a Javascript URI\u003c/li\u003e\n\u003cli\u003einjecting quotes to mess up the output from the back-end\u003c/li\u003e\n\u003cli\u003eusing an innocuos \u003ccode\u003ehref=#\u003c/code\u003e to make everything following the payload clickable\u003c/li\u003e\n\u003cli\u003eusing a \u003cstrong\u003efake URL\u003c/strong\u003e enclosed in \u003ccode\u003e[]\u003c/code\u003e to exploit a flaw in the rendering engine in the back-end that would cause it to move the payload \u003cem\u003eoutside\u003c/em\u003e of the \u0026quot;badUrl\u0026quot; element and place it where we could use it \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe final payload was \u003ccode\u003e\u0026amp;\u0026lt;\u0026gt;lt;%\u0026amp;\u0026lt;\u0026gt;lt;m\\bath xml:base=\\\u0026quot;j\u0026lt;\u0026gt;avascript:alert(document.domain)//\\\u0026quot; href=#\\\u0026quot;[bad.url.pls]\u003c/code\u003e which produced \u003ccode\u003e\u0026amp;lt%\u0026lt;math xml:base=\u0026quot;javascript:alert(document.domain)//\u0026quot; href=\u0026quot;#\u0026quot; x=\u0026quot;\u0026quot; class=\u0026quot;badLink\u0026quot;\u0026gt;[bad.url.pls]\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eAs a bonus note, this led to the discovery of a particular payload that would render a newsfeed comment \u003cstrong\u003eun-repliable and un-deletable\u003c/strong\u003e. Both flaws were fixed with better rules, and by preventing the back-end from stripping \u003cem\u003e“conveniently-placed”\u003c/em\u003e tags and control characters.\u003c/p\u003e\n\n\u003ch3 id=\"report-5\"\u003eReport #5\u003c/h3\u003e\n\n\u003cp\u003eSomewhat \u003cem\u003eless-related\u003c/em\u003e to the SocialClub per sé, this was a variation on \u003cstrong\u003ereport #3\u003c/strong\u003e where it was discovered that Snapmatic and R★ Editor comments would go a different validation flow than any other entry, and the \u003ca href=\"/redirect?url=https%3A%2F%2Fwebsec.github.io%2Funicode-security-guide%2Fcharacter-transformations%2F%23best-fit\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ebest-fit matchings\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e would once again act up but on a different codepage this time, when using \u003cstrong\u003eLeft-Angle brackets\u003c/strong\u003e \u003ccode\u003eU+3008 \u0026quot;〈\u0026quot;\u003c/code\u003e from the \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2B3000\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCjk Symbols and Punctuation block\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, and \u003cstrong\u003eLeft-pointing Angle brackets\u003c/strong\u003e \u003ccode\u003eU+2329 \u0026quot;〈\u0026quot;\u003c/code\u003e from the \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.compart.com%2Fen%2Funicode%2Fblock%2FU%2B2300\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eMiscellaneus Technical block\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eWhile the Snapmatic/R★ Editor back-end would block \u003ccode\u003eU+FF1C\u003c/code\u003e and \u003ccode\u003eU+FE64\u003c/code\u003e, the other two would go through and get \u0026quot;matched\u0026quot; to \u003ccode\u003e\u0026lt;\u003c/code\u003e somewhere in the web technology stack. My last payload was \u003ccode\u003e〈script/src=//...?\u003c/code\u003e and it was promptly fixed in both its variations.\u003c/p\u003e\n\n\u003ch3 id=\"conclusions\"\u003eConclusions\u003c/h3\u003e\n\n\u003cp\u003eThe Rockstar Games team is amazing. My first duplicate report was with them back in September and if it wasn\u0026#39;t for \u003ca href=\"/jmarshall\"\u003e@jmarshall\u003c/a\u003e reacting so politely to my unjustified noobish irk to a duplicate I would\u0026#39;ve probably dropped bug bounties altogether.\u003cbr\u003e\u003cbr\u003e\nIt\u0026#39;s been great to be involved all these months into researching new things and approaches—failing for weeks at a time allowed me to learn new techniques and extremely peculiar quirks I now feel ready to share with the community. I still go back and try new ideas as of today, so far without success. Which is great.\u003c/p\u003e\n\n\u003cp\u003eAd maiora!\u003c/p\u003e\n"}]}