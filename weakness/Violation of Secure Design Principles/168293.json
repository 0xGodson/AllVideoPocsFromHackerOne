{"id":168293,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjgyOTM=","url":"https://hackerone.com/reports/168293","title":"Not clearing hex-decoded variable after usage in Authentication","state":"Closed","substate":"informative","severity_rating":"none","readable_substate":"Informative","created_at":"2016-09-14T11:57:21.746Z","submitted_at":"2016-09-14T11:57:21.746Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sstok","url":"/sstok","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8539,"url":"https://hackerone.com/paragonie","handle":"paragonie","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/539/72f76fed45e5220b47ba2f679371ebf9ccb19c70_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/539/72f76fed45e5220b47ba2f679371ebf9ccb19c70_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Paragon Initiative Enterprises","twitter_handle":"ParagonIE","website":"https://github.com/paragonie","about":"Cryptography and Application Security Consultants - We Produce Various Open Source Libraries"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-11-03T04:57:58.979Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2016-09-14T13:18:40.485Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"All the sensitive information variables are zeroed from memory, expect the hex2bin value of \"validator\".\n\nhttps://github.com/paragonie/airship/blob/8f04f071c414c3893cf66311839d20a343af1237/src/Engine/Security/Authentication.php#L223-L236\n\n```\n        $stored = \\Sodium\\hex2bin($record[$f['validator']]);\n        \\Sodium\\memzero($record[$f['validator']]);\n        if (!\\hash_equals($stored, $val)) {\n            throw new LongTermAuthAlert(\n                \\trk('errors.security.invalid_persistent_token')\n            );\n        }\n        $userID = (int) $record[$f['userid']];\n        $_SESSION['session_canary'] = $this-\u003edb-\u003ecell(\n            'SELECT session_canary FROM airship_users WHERE userid = ?',\n            $userID\n        );\n        return $userID;\n```\n\nThe encoded value of \"validator\" is zeroed from memory, but the **decoded** version is not.\nThe value of $stored is not returned anywhere, so it should be zeroed from memory.\n\nNote. As the exception throw stops the flow, it should *also* be cleared when the hash doesn't equal üëç","vulnerability_information_html":"\u003cp\u003eAll the sensitive information variables are zeroed from memory, expect the hex2bin value of \u0026quot;validator\u0026quot;.\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://github.com/paragonie/airship/blob/8f04f071c414c3893cf66311839d20a343af1237/src/Engine/Security/Authentication.php#L223-L236\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fparagonie%2Fairship%2Fblob%2F8f04f071c414c3893cf66311839d20a343af1237%2Fsrc%2FEngine%2FSecurity%2FAuthentication.php%23L223-L236\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/paragonie/airship/blob/8f04f071c414c3893cf66311839d20a343af1237/src/Engine/Security/Authentication.php#L223-L236\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e        $stored = \\Sodium\\hex2bin($record[$f[\u0026#39;validator\u0026#39;]]);\n        \\Sodium\\memzero($record[$f[\u0026#39;validator\u0026#39;]]);\n        if (!\\hash_equals($stored, $val)) {\n            throw new LongTermAuthAlert(\n                \\trk(\u0026#39;errors.security.invalid_persistent_token\u0026#39;)\n            );\n        }\n        $userID = (int) $record[$f[\u0026#39;userid\u0026#39;]];\n        $_SESSION[\u0026#39;session_canary\u0026#39;] = $this-\u0026gt;db-\u0026gt;cell(\n            \u0026#39;SELECT session_canary FROM airship_users WHERE userid = ?\u0026#39;,\n            $userID\n        );\n        return $userID;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe encoded value of \u0026quot;validator\u0026quot; is zeroed from memory, but the \u003cstrong\u003edecoded\u003c/strong\u003e version is not.\u003cbr\u003e\nThe value of $stored is not returned anywhere, so it should be zeroed from memory.\u003c/p\u003e\n\n\u003cp\u003eNote. As the exception throw stops the flow, it should \u003cem\u003ealso\u003c/em\u003e be cleared when the hash doesn\u0026#39;t equal üëç\u003c/p\u003e\n","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":2,"voters":["paragonie-scott","d4s7"],"severity":{"rating":"none","score":0.0,"author_type":"Team","metrics":{"attack_vector":"physical","attack_complexity":"high","privileges_required":"high","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"none","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1193326,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"May have found a similar problem in https://github.com/paragonie/airship/blob/8f04f071c414c3893cf66311839d20a343af1237/src/Engine/Bolt/Security.php but exploiting this will require more work when (performed), as the session data needs to be changed.","markdown_message":"\u003cp\u003eMay have found a similar problem in \u003ca title=\"https://github.com/paragonie/airship/blob/8f04f071c414c3893cf66311839d20a343af1237/src/Engine/Bolt/Security.php\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fparagonie%2Fairship%2Fblob%2F8f04f071c414c3893cf66311839d20a343af1237%2Fsrc%2FEngine%2FBolt%2FSecurity.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/paragonie/airship/blob/8f04f071c414c3893cf66311839d20a343af1237/src/Engine/Bolt/Security.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e but exploiting this will require more work when (performed), as the session data needs to be changed.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-14T12:15:48.400Z","updated_at":"2016-09-14T12:15:48.400Z","actor":{"username":"sstok","cleared":false,"url":"/sstok","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1193399,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e but exploiting this will require more work\n\nStrictly speaking, neither is really exploitable with any reasonable threat model.\n\nIf you have even read-only access to the webserver's memory, you can already just grab the database credentials and dump all the data that's being handled. We're using memzero as a matter of good hygiene, and it's certainly true that we should do so consistently, but there's nothing remotely exploitable going on here.","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003ebut exploiting this will require more work\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eStrictly speaking, neither is really exploitable with any reasonable threat model.\u003c/p\u003e\n\n\u003cp\u003eIf you have even read-only access to the webserver\u0026#39;s memory, you can already just grab the database credentials and dump all the data that\u0026#39;s being handled. We\u0026#39;re using memzero as a matter of good hygiene, and it\u0026#39;s certainly true that we should do so consistently, but there\u0026#39;s nothing remotely exploitable going on here.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-14T13:10:46.730Z","updated_at":"2016-09-14T13:10:46.730Z","actor":{"username":"paragonie-scott","cleared":false,"url":"/paragonie-scott","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/441/089de22b2f1b80a1e57a2792318dede5cbad81db_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1193401,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Should have chosen my words more carefully, hehe.\nJust trying to be good person here, but I did not feel comfortable posting this on GitHub.","markdown_message":"\u003cp\u003eShould have chosen my words more carefully, hehe.\u003cbr\u003e\nJust trying to be good person here, but I did not feel comfortable posting this on GitHub.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-14T13:16:08.355Z","updated_at":"2016-09-14T13:19:29.267Z","actor":{"username":"sstok","cleared":false,"url":"/sstok","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1193403,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"It's all good.\n\nThanks for taking the time to read our code and identify inconsistencies. I'll add more `\\Sodium\\memzero()` calls in the next release.","markdown_message":"\u003cp\u003eIt\u0026#39;s all good.\u003c/p\u003e\n\n\u003cp\u003eThanks for taking the time to read our code and identify inconsistencies. I\u0026#39;ll add more \u003ccode\u003e\\Sodium\\memzero()\u003c/code\u003e calls in the next release.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-14T13:18:34.741Z","updated_at":"2016-09-14T13:18:34.741Z","actor":{"username":"paragonie-scott","cleared":false,"url":"/paragonie-scott","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/441/089de22b2f1b80a1e57a2792318dede5cbad81db_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1193404,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-09-14T13:18:40.522Z","updated_at":"2016-09-14T13:18:40.522Z","first_to_agree":true,"actor":{"username":"paragonie-scott","cleared":false,"url":"/paragonie-scott","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/441/089de22b2f1b80a1e57a2792318dede5cbad81db_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1281704,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-03T04:57:58.956Z","updated_at":"2016-11-03T04:57:58.956Z","actor":{"username":"paragonie-scott","cleared":false,"url":"/paragonie-scott","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/441/089de22b2f1b80a1e57a2792318dede5cbad81db_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1283755,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-04T03:08:53.953Z","updated_at":"2016-11-04T03:08:53.953Z","additional_data":{"old_severity":null,"new_severity":"None (0.0)","old_severity_id":null,"new_severity_id":5889},"actor":{"username":"paragonie-scott","cleared":false,"url":"/paragonie-scott","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/441/089de22b2f1b80a1e57a2792318dede5cbad81db_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1285130,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I forgot to add: v1.4.0 has more consistent use of memzero","markdown_message":"\u003cp\u003eI forgot to add: v1.4.0 has more consistent use of memzero\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-04T20:15:28.213Z","updated_at":"2016-11-04T20:15:28.213Z","actor":{"username":"paragonie-scott","cleared":false,"url":"/paragonie-scott","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/441/089de22b2f1b80a1e57a2792318dede5cbad81db_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}