{"id":429617,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80Mjk2MTc=","url":"https://hackerone.com/reports/429617","title":"Reverse Proxy misroute leading to steal X-Shopify-Access-Token header","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-10-27T10:16:39.287Z","submitted_at":"2018-10-27T10:16:39.287Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"chaosbolt","url":"/chaosbolt","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-03-14T10:50:35.082Z","bug_reporter_agreed_on_going_public_at":"2019-03-14T10:50:34.949Z","team_member_agreed_on_going_public_at":"2018-12-06T15:23:42.927Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello Shopify team! I found out that on /admin/api/graphql endpoint server fetches content of Host header value (${HTTP_Host} + /admin/api/graphql). If my own host was sent to server, request comes from ██████████or ██████████ (your google cloud cluster). Also I can grab all reverse proxy headers including X-Shopify-Access-Token.\n\nexample of such request in base64:\n\n```\n███\n```\n\n\nAlso it returns response your server got on ${HTTP_Host} + /admin/api/graphql address\n\n\nHow to reproduce:\n1. POST /admin/api/graphql with Host pointing to external website\n2. As external website owner grab incoming headers.\n\n## Impact\n\nSSRF, X-Shopify-Access-Token leakage","vulnerability_information_html":"\u003cp\u003eHello Shopify team! I found out that on /admin/api/graphql endpoint server fetches content of Host header value (${HTTP_Host} + /admin/api/graphql). If my own host was sent to server, request comes from ██████████or ██████████ (your google cloud cluster). Also I can grab all reverse proxy headers including X-Shopify-Access-Token.\u003c/p\u003e\n\n\u003cp\u003eexample of such request in base64:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e███\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAlso it returns response your server got on ${HTTP_Host} + /admin/api/graphql address\u003c/p\u003e\n\n\u003cp\u003eHow to reproduce:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003ePOST /admin/api/graphql with Host pointing to external website\u003c/li\u003e\n\u003cli\u003eAs external website owner grab incoming headers.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eSSRF, X-Shopify-Access-Token leakage\u003c/p\u003e\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":367003,"file_name":"responseleakage.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/367/003/1967fde0fb8d6eb8e2e8d78fe933b08c8e148710/responseleakage.png?response-content-disposition=attachment%3B%20filename%3D%22responseleakage.png%22%3B%20filename%2A%3DUTF-8%27%27responseleakage.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQR35GR77K%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055705Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCkRanG9z5zVLdCyDzQPrLE3FYUPIiibXLrC%2FbV7ethQgIgW3VYr7ML9zFS7keXgTden2zkvr6xtk%2Bwqk4LfHGPkcUqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDCiVagLxMUVikdnfsCqRA2ESo%2FIThyM%2BI3TCZtigaox50Q4zhKxTQUgUM4jlR9ukMcmdu%2BCIgxqNXnFit2GwvZneedN1j%2Bbb2Lf%2Fk9LJIBloG0%2BBQ0DIW5llPzhlHBsf8qtXHgtlw3rsN1B9wIqRFFMGG4erHLHiQ927dumft3fH4WdUWWVFhaFZW%2Bw4BBxYga3%2FaAi3ovDfVVALXK5%2BpCaFWVs%2FpaNk%2FyE3nUH75JZvja1tpNt%2F6qsqsoaXl8ySebrstQXUEOB%2Be7AzgomPo1txxlxQRCWAxLJ91zb%2F8zbc4Mpqm3pYwpxNZNRMuJXf4gzHggFM%2F7EkopM926Hsh9N4eLnJ1YBbqX5nnqAx55PEzHirbBxZ31aDZRbfbmB1%2BCiOEV8iMEpwvIsyUZuOSffvpzs7Qe3dj2pI6zhzA0wUT5LPywpwV5LVDQwbGng87pA%2Bgtcg27onS7Jn48hXv6UkYG%2FjlBuSEho0agiNLjv8bIxpSHhah2llBo0iC%2FiJ6%2FmqISjfYpqB%2FXgA1aFX1J8VmBmDpEvse7vhRyn5GK%2BNMMjyqv8FOusBHTvY1UWZJTekbF8f0h5%2Fm9EETlkX57JGosj1P6za%2F%2BD1YhhGhxzYMqBjP4hJZrSDsKea8vBxlLbsPJ8Zp1AAhrC9YRtCof2hTYz2%2BhsURQSGCBeuFyIDmWSH5JQoO43ilJhDzyewxnrYD%2BeM5KfEX4%2Fn5D9vBPxSv0EAr8PalTK5ZAcoJBHWWJ9pMQRjAqFKZVsT5TOjOi1OL0hsm4jWxfvejzxF5%2F3DrF%2BlMwOzwjOAJZgOrX0soe5jTVlSMpmCtRzgiDMIQz0P5TQyzi0oxvgKgrkhIF7bwqbkYqDYIH4z2J2IflgXhzV%2BUQ%3D%3D\u0026X-Amz-Signature=4e45cf485aad926e75f6221631b13a13f09d437f1186d7c8abf6d670763f6bd1","file_size":226084,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":81,"voters":["secator","michiel","danila","bogdantcaciuc","teuvokas","base_64","leetboi","sameerphad72","logicmap","zeroxyele","and 71 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3563592,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank your for your report! We have reproduced this, and our engineering team is investigating this issue.","markdown_message":"\u003cp\u003eThank your for your report! We have reproduced this, and our engineering team is investigating this issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-31T14:21:56.110Z","updated_at":"2018-10-31T14:21:56.110Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3565670,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report! We have recently deployed a fix for this issue. A recent change removed our host validation when proxying to the graphql endpoint. These protections are now back in place.\nOur next round of bounty decisions will take place within the next few days, so we'll be in touch with you again soon.","markdown_message":"\u003cp\u003eThanks again for your report! We have recently deployed a fix for this issue. A recent change removed our host validation when proxying to the graphql endpoint. These protections are now back in place.\u003cbr\u003e\nOur next round of bounty decisions will take place within the next few days, so we\u0026#39;ll be in touch with you again soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-31T18:12:01.731Z","updated_at":"2018-10-31T18:12:01.731Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"chaosbolt","url":"/chaosbolt"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3571540,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-01T18:50:11.327Z","updated_at":"2018-11-01T18:50:11.327Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"chaosbolt","url":"/chaosbolt"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3775861,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-12-06T15:23:42.953Z","updated_at":"2018-12-06T15:23:42.953Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4322199,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-03-14T10:50:35.010Z","updated_at":"2019-03-14T10:50:35.010Z","actor":{"username":"chaosbolt","cleared":true,"url":"/chaosbolt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4322200,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-03-14T10:50:35.102Z","updated_at":"2019-03-14T10:50:35.102Z","actor":{"username":"chaosbolt","cleared":true,"url":"/chaosbolt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d81xKAqqBxYLV8QQn83n3V5d/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":11386,"category":"team","content":"@ruvlol discovered that the `/admin/api/graphql` endpoint in Shopify admin was missing host validation, and would proxy to arbitrary hosts when the host header was modified. This could have allowed making POST requests with that path to internal services, or exposing the X-Shopify-Access token for the current user (which the client does not typically have access to). However, this token has the same access level as interacting normally with the graphql endpoint in admin for that session.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003ca href=\"/ruvlol\"\u003e@ruvlol\u003c/a\u003e discovered that the \u003ccode\u003e/admin/api/graphql\u003c/code\u003e endpoint in Shopify admin was missing host validation, and would proxy to arbitrary hosts when the host header was modified. This could have allowed making POST requests with that path to internal services, or exposing the X-Shopify-Access token for the current user (which the client does not typically have access to). However, this token has the same access level as interacting normally with the graphql endpoint in admin for that session.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}