{"id":382612,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zODI2MTI=","url":"https://hackerone.com/reports/382612","title":"Potential SSRF and disclosure of sensitive site on *shopifycloud.com","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2018-07-17T14:01:13.005Z","submitted_at":"2018-07-17T14:01:13.005Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rijalrojan","url":"/rijalrojan","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fBoPSSRSdMDTghBJexdu4AwG/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-07-19T20:47:58.912Z","bug_reporter_agreed_on_going_public_at":"2018-07-19T20:47:58.767Z","team_member_agreed_on_going_public_at":"2018-07-19T20:20:16.548Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"*Note: I am reporting this after talking with @shopify-peteryaworski*\n\n**Summary**\nThere is a staging/testing site for payment cancellations and refunds at shopifycloud.com. This site allows sending post request and fetching the response back to the user. This leads to SSRF because it allows fetching potential internal clients and servers. \n\n**Description**\nhttps://offsite-gateway-sim.shopifycloud.com/notification allows sending test request to a user supplied `x_url_callback` url. In such request it is allowed to submit Google metadata IPs and get a response back. Thankfully it seems that after the last SSRF report on Shopify, you guys have completely stripped the server from having any access to Google Metadata because for `v1beta1` this server responds with `This metadata api is not allowed in the metadata proxy`. Additionally for the regular `v1` it returns 403 because the header is missing. The only potential exploit here is that if there is any internal site only Google IP is able to access then someone can call that site and see its details. \n\n**Reproduction**\n1. Go to https://offsite-gateway-sim.shopifycloud.com/notification and put http://metadata/computeMetadata/v1beta1/ as a test request.\n\n## Impact\n\nSSRF. The repo for this is private so I am assuming this has to be private too?","vulnerability_information_html":"\u003cp\u003e\u003cem\u003eNote: I am reporting this after talking with \u003ca href=\"/shopify-peteryaworski\"\u003e@shopify-peteryaworski\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e\u003cbr\u003e\nThere is a staging/testing site for payment cancellations and refunds at shopifycloud.com. This site allows sending post request and fetching the response back to the user. This leads to SSRF because it allows fetching potential internal clients and servers. \u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription\u003c/strong\u003e\u003cbr\u003e\n\u003ca title=\"https://offsite-gateway-sim.shopifycloud.com/notification\" href=\"/redirect?url=https%3A%2F%2Foffsite-gateway-sim.shopifycloud.com%2Fnotification\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://offsite-gateway-sim.shopifycloud.com/notification\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e allows sending test request to a user supplied \u003ccode\u003ex_url_callback\u003c/code\u003e url. In such request it is allowed to submit Google metadata IPs and get a response back. Thankfully it seems that after the last SSRF report on Shopify, you guys have completely stripped the server from having any access to Google Metadata because for \u003ccode\u003ev1beta1\u003c/code\u003e this server responds with \u003ccode\u003eThis metadata api is not allowed in the metadata proxy\u003c/code\u003e. Additionally for the regular \u003ccode\u003ev1\u003c/code\u003e it returns 403 because the header is missing. The only potential exploit here is that if there is any internal site only Google IP is able to access then someone can call that site and see its details. \u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eReproduction\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eGo to \u003ca title=\"https://offsite-gateway-sim.shopifycloud.com/notification\" href=\"/redirect?url=https%3A%2F%2Foffsite-gateway-sim.shopifycloud.com%2Fnotification\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://offsite-gateway-sim.shopifycloud.com/notification\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and put \u003ca title=\"http://metadata/computeMetadata/v1beta1/\" href=\"/redirect?url=http%3A%2F%2Fmetadata%2FcomputeMetadata%2Fv1beta1%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://metadata/computeMetadata/v1beta1/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e as a test request.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eSSRF. The repo for this is private so I am assuming this has to be private too?\u003c/p\u003e\n","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":6,"voters":["emitrani","eveeez","apapedulimu","asad_anwar","cryptographer","makpoer"],"severity":{"rating":"low","author_type":"Team"},"structured_scope":{"databaseId":10202,"asset_type":"URL","asset_identifier":"*.shopify.com","max_severity":"medium"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3058219,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report! Our engineering team is investigating the issue. \n\nAs you noticed, the protections we applied after the last SSRF report reduced the exploitability of this issue significantly. Since this asset is out of scope and because of the low severity of this issue this report won't be eligible for a bounty.","markdown_message":"\u003cp\u003eThank you for your report! Our engineering team is investigating the issue. \u003c/p\u003e\n\n\u003cp\u003eAs you noticed, the protections we applied after the last SSRF report reduced the exploitability of this issue significantly. Since this asset is out of scope and because of the low severity of this issue this report won\u0026#39;t be eligible for a bounty.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-17T17:27:01.575Z","updated_at":"2018-07-17T17:27:01.575Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3058239,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sounds good to me. Thank you for accepting the report :) ","markdown_message":"\u003cp\u003eSounds good to me. Thank you for accepting the report :) \u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-17T17:33:04.340Z","updated_at":"2018-07-17T17:33:04.340Z","actor":{"username":"rijalrojan","cleared":true,"url":"/rijalrojan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fBoPSSRSdMDTghBJexdu4AwG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3069245,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-19T15:35:39.379Z","updated_at":"2018-07-19T15:35:39.379Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3070211,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report! \n\nWe have recently deployed a fix for this issue. As I mentioned in my previous comment, unfortunately this report is not eligible for a bounty.\n\nWe look forward to future reports from you!","markdown_message":"\u003cp\u003eThanks again for your report! \u003c/p\u003e\n\n\u003cp\u003eWe have recently deployed a fix for this issue. As I mentioned in my previous comment, unfortunately this report is not eligible for a bounty.\u003c/p\u003e\n\n\u003cp\u003eWe look forward to future reports from you!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-19T20:15:43.880Z","updated_at":"2018-07-19T20:15:43.880Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"rijalrojan","url":"/rijalrojan"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3070241,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-19T20:20:16.659Z","updated_at":"2018-07-19T20:20:16.659Z","first_to_agree":true,"actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3070359,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"I am fine with. Thanks! ","markdown_message":"\u003cp\u003eI am fine with. Thanks! \u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-19T20:47:58.806Z","updated_at":"2018-07-19T20:47:58.806Z","actor":{"username":"rijalrojan","cleared":true,"url":"/rijalrojan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fBoPSSRSdMDTghBJexdu4AwG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3070360,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-19T20:47:58.950Z","updated_at":"2018-07-19T20:47:58.950Z","actor":{"username":"rijalrojan","cleared":true,"url":"/rijalrojan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fBoPSSRSdMDTghBJexdu4AwG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3070373,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-19T20:50:04.350Z","updated_at":"2018-07-19T20:50:04.350Z","additional_data":{"old_severity":"Medium","new_severity":"Low","old_severity_id":183979,"new_severity_id":185723},"actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}