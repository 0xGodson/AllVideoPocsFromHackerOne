{"id":826361,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84MjYzNjE=","url":"https://hackerone.com/reports/826361","title":"SSRF on project import via the remote_attachment_url on a Note","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2020-03-22T12:37:34.144Z","submitted_at":"2020-03-22T12:37:34.144Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"vakzz","url":"/vakzz","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-06-07T22:41:22.183Z","bug_reporter_agreed_on_going_public_at":"2020-06-07T01:29:57.176Z","team_member_agreed_on_going_public_at":"2020-06-07T22:41:21.957Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nThe Note model has an `attachment` which is provided by a CarrierWave uploader:\n\n```ruby\nmount_uploader :attachment, AttachmentUploader\n```\n\nOne of the features this provides is the ability to download and attach a file via a url, see https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mount.rb#L80. This means that the Note model has a method `remote_attachment_url=` which can be used to perform this action.\n\nAs this attribute isn't removed by the `AttributeCleaner` on project import, it can be set in the `project.json` for a note and will be set when the note is created, downloading the file:\n\nhttps://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mounter.rb#L72\n```ruby\n  def remote_urls=(urls)\n      return if not urls or urls == \"\" or urls.all?(\u0026:blank?)\n\n      @remote_urls = urls\n      @download_error = nil\n      @integrity_error = nil\n\n      @uploaders = urls.zip(remote_request_headers || []).map do |url, header|\n        uploader = blank_uploader\n        uploader.download!(url, header || {})\n        uploader\n      end\n```\n\nhttps://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/uploader/download.rb#L43\n```ruby\n    def file\n          if @file.blank?\n            headers = @remote_headers.\n              reverse_merge('User-Agent' =\u003e \"CarrierWave/#{CarrierWave::VERSION}\")\n\n            @file = Kernel.open(@uri.to_s, headers)\n            @file = @file.is_a?(String) ? StringIO.new(@file) : @file\n          end\n```\n\nThe downloaded file is then attached to the note and can be viewed from the newly imported project.\n\nAny model that has a `mount_uploader` and is importable is potentially vulnerable to the same attack, although the majority of the others are `AvatarUploader` which checks the file type and prevents the response from being viewed.\n\n### Steps to reproduce\n\n1. Create a new project\n1. Create an issue in the project\n1. Add a note to the issue\n1. Export the project\n1. Extract the export\n1. Add  `remote_attachment_url` to the `note` hash with a url\n1. Recompress the export and import it\n1. View the note on the issue\n\nDemo {F756257}\n\n### Examples\n\nExample of project import on gitlab.com hitting postbin:\n\nhttps://gitlab.com/wbowling/ssrf1/-/issues/1#note_309127303\n{F756269}\n\n### What is the current *bug* behavior?\nWhen importing a model that has a mount_uploader it's possible to use the carrierwave uploader seed attributes to download a file from any host: https://github.com/carrierwaveuploader/carrierwave/wiki/How-to:-Upload-remote-image-urls-to-your-seedfile\n\n### What is the expected *correct* behavior?\nThe attributes should be prohibited and removed via the `AttributeCleaner`\n\n### Output of checks\nThis bug happens on gitlab.com\n\n#### Results of GitLab environment info\n```\nSystem information\nSystem:\t\tUbuntu 18.04\nProxy:\t\tno\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.6.5p114\nGem Version:\t2.7.10\nBundler Version:1.17.3\nRake Version:\t12.3.3\nRedis Version:\t5.0.7\nGit Version:\t2.24.1\nSidekiq Version:5.2.7\nGo Version:\tunknown\n\nGitLab information\nVersion:\t12.8.7-ee\nRevision:\t2643fd87200\nDirectory:\t/opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:\tPostgreSQL\nDB Version:\t10.12\nURL:\t\thttp://gitlab-vm.local\nHTTP Clone URL:\thttp://gitlab-vm.local/some-group/some-project.git\nSSH Clone URL:\tgit@gitlab-vm.local:some-group/some-project.git\nElasticsearch:\tno\nGeo:\t\tno\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers:\n\nGitLab Shell\nVersion:\t11.0.0\nRepository storage paths:\n- default: \t/var/opt/gitlab/git-data/repositories\nGitLab Shell path:\t\t/opt/gitlab/embedded/service/gitlab-shell\nGit:\t\t/opt/gitlab/embedded/bin/git\n```\n\n## Impact\n\n* Allows an attacker to access internal services, for example the Omnibus GitLab has all of the exporters, Prometheus, Alertmanager exposed on localhost. \n* If GitLab is hosted on AWS it allows for the instance metadata to be accessed.\n* Redis is running locally or accessible via tcp (address could be found by looking at the targets in Prometheus at http://localhost:9090/api/v1/targets) it could be possible to obtain RCE (similar to https://github.com/jas502n/gitlab-SSRF-redis-RCE#poc). A POST request is not possible here, but as `remote_attachment_request_header=` is also available (https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mount.rb#L169) and not blacklisted, the payload could be set via a header.\n* If GitLab is hosted on Google Cloud, the above could be used to set the `Metadata-Flavor: Google` header and access `http://metadata.google.internal/`","vulnerability_information_html":"\u003ch3 id=\"summary\"\u003eSummary\u003c/h3\u003e\n\n\u003cp\u003eThe Note model has an \u003ccode\u003eattachment\u003c/code\u003e which is provided by a CarrierWave uploader:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emount_uploader\u003c/span\u003e \u003cspan class=\"ss\"\u003e:attachment\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"no\"\u003eAttachmentUploader\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOne of the features this provides is the ability to download and attach a file via a url, see \u003ca title=\"https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mount.rb#L80\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fblob%2Fv1.3.1%2Flib%2Fcarrierwave%2Fmount.rb%23L80\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mount.rb#L80\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. This means that the Note model has a method \u003ccode\u003eremote_attachment_url=\u003c/code\u003e which can be used to perform this action.\u003c/p\u003e\n\n\u003cp\u003eAs this attribute isn\u0026#39;t removed by the \u003ccode\u003eAttributeCleaner\u003c/code\u003e on project import, it can be set in the \u003ccode\u003eproject.json\u003c/code\u003e for a note and will be set when the note is created, downloading the file:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mounter.rb#L72\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fblob%2Fv1.3.1%2Flib%2Fcarrierwave%2Fmounter.rb%23L72\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mounter.rb#L72\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eremote_urls\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enot\u003c/span\u003e \u003cspan class=\"n\"\u003eurls\u003c/span\u003e \u003cspan class=\"n\"\u003eor\u003c/span\u003e \u003cspan class=\"n\"\u003eurls\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"n\"\u003eor\u003c/span\u003e \u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eall?\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"ss\"\u003e:blank?\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n      \u003cspan class=\"vi\"\u003e@remote_urls\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurls\u003c/span\u003e\n      \u003cspan class=\"vi\"\u003e@download_error\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kp\"\u003enil\u003c/span\u003e\n      \u003cspan class=\"vi\"\u003e@integrity_error\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kp\"\u003enil\u003c/span\u003e\n\n      \u003cspan class=\"vi\"\u003e@uploaders\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ezip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eremote_request_headers\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e[]).\u003c/span\u003e\u003cspan class=\"nf\"\u003emap\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eheader\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"n\"\u003euploader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eblank_uploader\u003c/span\u003e\n        \u003cspan class=\"n\"\u003euploader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edownload!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eheader\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e{})\u003c/span\u003e\n        \u003cspan class=\"n\"\u003euploader\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca title=\"https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/uploader/download.rb#L43\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fblob%2Fv1.3.1%2Flib%2Fcarrierwave%2Fuploader%2Fdownload.rb%23L43\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/uploader/download.rb#L43\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efile\u003c/span\u003e\n          \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vi\"\u003e@file\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eblank?\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eheaders\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"vi\"\u003e@remote_headers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n              \u003cspan class=\"nf\"\u003ereverse_merge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;User-Agent\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;CarrierWave/\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"no\"\u003eCarrierWave\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eVERSION\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"vi\"\u003e@file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eKernel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"vi\"\u003e@uri\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eto_s\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"vi\"\u003e@file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"vi\"\u003e@file\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eis_a?\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"no\"\u003eStringIO\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"vi\"\u003e@file\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"vi\"\u003e@file\u003c/span\u003e\n          \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe downloaded file is then attached to the note and can be viewed from the newly imported project.\u003c/p\u003e\n\n\u003cp\u003eAny model that has a \u003ccode\u003emount_uploader\u003c/code\u003e and is importable is potentially vulnerable to the same attack, although the majority of the others are \u003ccode\u003eAvatarUploader\u003c/code\u003e which checks the file type and prevents the response from being viewed.\u003c/p\u003e\n\n\u003ch3 id=\"steps-to-reproduce\"\u003eSteps to reproduce\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003eCreate a new project\u003c/li\u003e\n\u003cli\u003eCreate an issue in the project\u003c/li\u003e\n\u003cli\u003eAdd a note to the issue\u003c/li\u003e\n\u003cli\u003eExport the project\u003c/li\u003e\n\u003cli\u003eExtract the export\u003c/li\u003e\n\u003cli\u003eAdd  \u003ccode\u003eremote_attachment_url\u003c/code\u003e to the \u003ccode\u003enote\u003c/code\u003e hash with a url\u003c/li\u003e\n\u003cli\u003eRecompress the export and import it\u003c/li\u003e\n\u003cli\u003eView the note on the issue\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eDemo \u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"ssrf-note.mp4\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/84ADZaqXNjpoVWHc7RaSAprN?response-content-disposition=attachment%3B%20filename%3D%22ssrf-note.mp4%22%3B%20filename%2A%3DUTF-8%27%27ssrf-note.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ3VAHLH6Z%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T065832Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCD4BvSsKgWcuX7%2Fh3b1LWkKs9s4yRHAxqyVwXJYWsOAwIhANvLMyKSbceDyM1TNnWf11IvuT7a61DuFVJhD%2BT%2Fb9IrKrQDCFcQARoMMDEzNjE5Mjc0ODQ5Igxmi6woSxw%2B6wnwBEMqkQPI1uJcvWS%2B7FQadeW43PrlhsnF4xiGOroakbutVFcvcHOdYKgLxjIJI5m7XwadzbZWnWfHV0%2B62Zb%2BWCUOjMWiTVIXVX7AwYN1lfeKcXEYUp0h0oyXmZ8r9%2Bj%2FMZUagb%2BGKS%2B8zxvRdQjMX1tdjoDe9OxP6o1mlqEZpx8AKw7LDp1Hz2ezBoeya6X2GupABl%2FOhOfLY3VwJj7aPTg85UEwxOdZDtc%2FqzwALQiQUZo0A1RP3Y8nbzGb8CydaoFTXkp8rbJlMiimc%2BP%2BkZhbzJrdAs2rl68CFeUO2KSps4veGXWDFFoEAu1EvHwhAyOhkUlWXmX73VMyIVDvCkiHkuulKA8DiBfGp90UyI0AqLxJxXh%2FgCjGVxceHzAhM03UULwYdje89A1ziU5p%2BKL3KWD4xZiWFhlIiy3U92ksRt8S3l2NanthhEGEvTgf6wIclSsc9f4UbYnjYnAAiXkBg6iZTwORuQ0lVt30ma%2B%2BklzemkOgRIzghR66jzWcsjfvliY27ODm9Z12Vrj3LNetmm3XRTDEg6v%2FBTrqAb0W67QCovsIpNAiT4CujLyYV%2FjYmZ4VKcAok0lQwqZsNMCoze3egJJr5KwJfEhstOKt8adGE2Rfh5M%2BaAuxUHx9CHzHYR0HmUar1TnotcADpaizJlkcQmrsTfX3xtHVR8i9rhilHwmpYSeCQBjKHP%2BS656Uyq6ksGCrQWI4ZK%2F8QgDLIm%2FkIF6FlqRmaPtAeqfdwNxXQoCBcVLYgai%2FvmYu0CSd0Q1ngm%2FQMLqJqwYCLLmqTZrGYBRc5a553mtVqPYXlzc8Pgvjp59x%2Fjbix5wBt%2BoNg6EeSWNYAv4D0k4TzkJ4Aj8N%2BdAfag%3D%3D\u0026amp;X-Amz-Signature=c3db6b287bbf8e4cbdab382ebb91568e2eb70e6c6684a263fc23e5de6f4f49d7\" data-attachment-type=\"video/mp4\"\u003e\u003cvideo controls=\"controls\" src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/84ADZaqXNjpoVWHc7RaSAprN?response-content-disposition=attachment%3B%20filename%3D%22ssrf-note.mp4%22%3B%20filename%2A%3DUTF-8%27%27ssrf-note.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ3VAHLH6Z%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T065832Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCD4BvSsKgWcuX7%2Fh3b1LWkKs9s4yRHAxqyVwXJYWsOAwIhANvLMyKSbceDyM1TNnWf11IvuT7a61DuFVJhD%2BT%2Fb9IrKrQDCFcQARoMMDEzNjE5Mjc0ODQ5Igxmi6woSxw%2B6wnwBEMqkQPI1uJcvWS%2B7FQadeW43PrlhsnF4xiGOroakbutVFcvcHOdYKgLxjIJI5m7XwadzbZWnWfHV0%2B62Zb%2BWCUOjMWiTVIXVX7AwYN1lfeKcXEYUp0h0oyXmZ8r9%2Bj%2FMZUagb%2BGKS%2B8zxvRdQjMX1tdjoDe9OxP6o1mlqEZpx8AKw7LDp1Hz2ezBoeya6X2GupABl%2FOhOfLY3VwJj7aPTg85UEwxOdZDtc%2FqzwALQiQUZo0A1RP3Y8nbzGb8CydaoFTXkp8rbJlMiimc%2BP%2BkZhbzJrdAs2rl68CFeUO2KSps4veGXWDFFoEAu1EvHwhAyOhkUlWXmX73VMyIVDvCkiHkuulKA8DiBfGp90UyI0AqLxJxXh%2FgCjGVxceHzAhM03UULwYdje89A1ziU5p%2BKL3KWD4xZiWFhlIiy3U92ksRt8S3l2NanthhEGEvTgf6wIclSsc9f4UbYnjYnAAiXkBg6iZTwORuQ0lVt30ma%2B%2BklzemkOgRIzghR66jzWcsjfvliY27ODm9Z12Vrj3LNetmm3XRTDEg6v%2FBTrqAb0W67QCovsIpNAiT4CujLyYV%2FjYmZ4VKcAok0lQwqZsNMCoze3egJJr5KwJfEhstOKt8adGE2Rfh5M%2BaAuxUHx9CHzHYR0HmUar1TnotcADpaizJlkcQmrsTfX3xtHVR8i9rhilHwmpYSeCQBjKHP%2BS656Uyq6ksGCrQWI4ZK%2F8QgDLIm%2FkIF6FlqRmaPtAeqfdwNxXQoCBcVLYgai%2FvmYu0CSd0Q1ngm%2FQMLqJqwYCLLmqTZrGYBRc5a553mtVqPYXlzc8Pgvjp59x%2Fjbix5wBt%2BoNg6EeSWNYAv4D0k4TzkJ4Aj8N%2BdAfag%3D%3D\u0026amp;X-Amz-Signature=c3db6b287bbf8e4cbdab382ebb91568e2eb70e6c6684a263fc23e5de6f4f49d7\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/video\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3 id=\"examples\"\u003eExamples\u003c/h3\u003e\n\n\u003cp\u003eExample of project import on gitlab.com hitting postbin:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://gitlab.com/wbowling/ssrf1/-/issues/1#note_309127303\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fwbowling%2Fssrf1%2F-%2Fissues%2F1%23note_309127303\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/wbowling/ssrf1/-/issues/1#note_309127303\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screen_Shot_2020-03-22_at_11.22.06_pm.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/pD6Xf8ZiqbysXKVRzQ9ocWFQ?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2020-03-22_at_11.22.06_pm.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2020-03-22_at_11.22.06_pm.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ3VAHLH6Z%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T065832Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCD4BvSsKgWcuX7%2Fh3b1LWkKs9s4yRHAxqyVwXJYWsOAwIhANvLMyKSbceDyM1TNnWf11IvuT7a61DuFVJhD%2BT%2Fb9IrKrQDCFcQARoMMDEzNjE5Mjc0ODQ5Igxmi6woSxw%2B6wnwBEMqkQPI1uJcvWS%2B7FQadeW43PrlhsnF4xiGOroakbutVFcvcHOdYKgLxjIJI5m7XwadzbZWnWfHV0%2B62Zb%2BWCUOjMWiTVIXVX7AwYN1lfeKcXEYUp0h0oyXmZ8r9%2Bj%2FMZUagb%2BGKS%2B8zxvRdQjMX1tdjoDe9OxP6o1mlqEZpx8AKw7LDp1Hz2ezBoeya6X2GupABl%2FOhOfLY3VwJj7aPTg85UEwxOdZDtc%2FqzwALQiQUZo0A1RP3Y8nbzGb8CydaoFTXkp8rbJlMiimc%2BP%2BkZhbzJrdAs2rl68CFeUO2KSps4veGXWDFFoEAu1EvHwhAyOhkUlWXmX73VMyIVDvCkiHkuulKA8DiBfGp90UyI0AqLxJxXh%2FgCjGVxceHzAhM03UULwYdje89A1ziU5p%2BKL3KWD4xZiWFhlIiy3U92ksRt8S3l2NanthhEGEvTgf6wIclSsc9f4UbYnjYnAAiXkBg6iZTwORuQ0lVt30ma%2B%2BklzemkOgRIzghR66jzWcsjfvliY27ODm9Z12Vrj3LNetmm3XRTDEg6v%2FBTrqAb0W67QCovsIpNAiT4CujLyYV%2FjYmZ4VKcAok0lQwqZsNMCoze3egJJr5KwJfEhstOKt8adGE2Rfh5M%2BaAuxUHx9CHzHYR0HmUar1TnotcADpaizJlkcQmrsTfX3xtHVR8i9rhilHwmpYSeCQBjKHP%2BS656Uyq6ksGCrQWI4ZK%2F8QgDLIm%2FkIF6FlqRmaPtAeqfdwNxXQoCBcVLYgai%2FvmYu0CSd0Q1ngm%2FQMLqJqwYCLLmqTZrGYBRc5a553mtVqPYXlzc8Pgvjp59x%2Fjbix5wBt%2BoNg6EeSWNYAv4D0k4TzkJ4Aj8N%2BdAfag%3D%3D\u0026amp;X-Amz-Signature=bac631cdeb045d378c9f2944f7763da8f287ccbe81489471d9b8a0e70f8e8795\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/pD6Xf8ZiqbysXKVRzQ9ocWFQ?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2020-03-22_at_11.22.06_pm.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2020-03-22_at_11.22.06_pm.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ3VAHLH6Z%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T065832Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCD4BvSsKgWcuX7%2Fh3b1LWkKs9s4yRHAxqyVwXJYWsOAwIhANvLMyKSbceDyM1TNnWf11IvuT7a61DuFVJhD%2BT%2Fb9IrKrQDCFcQARoMMDEzNjE5Mjc0ODQ5Igxmi6woSxw%2B6wnwBEMqkQPI1uJcvWS%2B7FQadeW43PrlhsnF4xiGOroakbutVFcvcHOdYKgLxjIJI5m7XwadzbZWnWfHV0%2B62Zb%2BWCUOjMWiTVIXVX7AwYN1lfeKcXEYUp0h0oyXmZ8r9%2Bj%2FMZUagb%2BGKS%2B8zxvRdQjMX1tdjoDe9OxP6o1mlqEZpx8AKw7LDp1Hz2ezBoeya6X2GupABl%2FOhOfLY3VwJj7aPTg85UEwxOdZDtc%2FqzwALQiQUZo0A1RP3Y8nbzGb8CydaoFTXkp8rbJlMiimc%2BP%2BkZhbzJrdAs2rl68CFeUO2KSps4veGXWDFFoEAu1EvHwhAyOhkUlWXmX73VMyIVDvCkiHkuulKA8DiBfGp90UyI0AqLxJxXh%2FgCjGVxceHzAhM03UULwYdje89A1ziU5p%2BKL3KWD4xZiWFhlIiy3U92ksRt8S3l2NanthhEGEvTgf6wIclSsc9f4UbYnjYnAAiXkBg6iZTwORuQ0lVt30ma%2B%2BklzemkOgRIzghR66jzWcsjfvliY27ODm9Z12Vrj3LNetmm3XRTDEg6v%2FBTrqAb0W67QCovsIpNAiT4CujLyYV%2FjYmZ4VKcAok0lQwqZsNMCoze3egJJr5KwJfEhstOKt8adGE2Rfh5M%2BaAuxUHx9CHzHYR0HmUar1TnotcADpaizJlkcQmrsTfX3xtHVR8i9rhilHwmpYSeCQBjKHP%2BS656Uyq6ksGCrQWI4ZK%2F8QgDLIm%2FkIF6FlqRmaPtAeqfdwNxXQoCBcVLYgai%2FvmYu0CSd0Q1ngm%2FQMLqJqwYCLLmqTZrGYBRc5a553mtVqPYXlzc8Pgvjp59x%2Fjbix5wBt%2BoNg6EeSWNYAv4D0k4TzkJ4Aj8N%2BdAfag%3D%3D\u0026amp;X-Amz-Signature=bac631cdeb045d378c9f2944f7763da8f287ccbe81489471d9b8a0e70f8e8795\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3 id=\"what-is-the-current-bug-behavior\"\u003eWhat is the current \u003cem\u003ebug\u003c/em\u003e behavior?\u003c/h3\u003e\n\n\u003cp\u003eWhen importing a model that has a mount_uploader it\u0026#39;s possible to use the carrierwave uploader seed attributes to download a file from any host: \u003ca title=\"https://github.com/carrierwaveuploader/carrierwave/wiki/How-to:-Upload-remote-image-urls-to-your-seedfile\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fwiki%2FHow-to%3A-Upload-remote-image-urls-to-your-seedfile\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/carrierwaveuploader/carrierwave/wiki/How-to:-Upload-remote-image-urls-to-your-seedfile\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3 id=\"what-is-the-expected-correct-behavior\"\u003eWhat is the expected \u003cem\u003ecorrect\u003c/em\u003e behavior?\u003c/h3\u003e\n\n\u003cp\u003eThe attributes should be prohibited and removed via the \u003ccode\u003eAttributeCleaner\u003c/code\u003e\u003c/p\u003e\n\n\u003ch3 id=\"output-of-checks\"\u003eOutput of checks\u003c/h3\u003e\n\n\u003cp\u003eThis bug happens on gitlab.com\u003c/p\u003e\n\n\u003ch4 id=\"results-of-gitlab-environment-info\"\u003eResults of GitLab environment info\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eSystem information\nSystem:     Ubuntu 18.04\nProxy:      no\nCurrent User:   git\nUsing RVM:  no\nRuby Version:   2.6.5p114\nGem Version:    2.7.10\nBundler Version:1.17.3\nRake Version:   12.3.3\nRedis Version:  5.0.7\nGit Version:    2.24.1\nSidekiq Version:5.2.7\nGo Version: unknown\n\nGitLab information\nVersion:    12.8.7-ee\nRevision:   2643fd87200\nDirectory:  /opt/gitlab/embedded/service/gitlab-rails\nDB Adapter: PostgreSQL\nDB Version: 10.12\nURL:        http://gitlab-vm.local\nHTTP Clone URL: http://gitlab-vm.local/some-group/some-project.git\nSSH Clone URL:  git@gitlab-vm.local:some-group/some-project.git\nElasticsearch:  no\nGeo:        no\nUsing LDAP: no\nUsing Omniauth: yes\nOmniauth Providers:\n\nGitLab Shell\nVersion:    11.0.0\nRepository storage paths:\n- default:  /var/opt/gitlab/git-data/repositories\nGitLab Shell path:      /opt/gitlab/embedded/service/gitlab-shell\nGit:        /opt/gitlab/embedded/bin/git\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eAllows an attacker to access internal services, for example the Omnibus GitLab has all of the exporters, Prometheus, Alertmanager exposed on localhost. \u003c/li\u003e\n\u003cli\u003eIf GitLab is hosted on AWS it allows for the instance metadata to be accessed.\u003c/li\u003e\n\u003cli\u003eRedis is running locally or accessible via tcp (address could be found by looking at the targets in Prometheus at \u003ca title=\"http://localhost:9090/api/v1/targets\" href=\"/redirect?url=http%3A%2F%2Flocalhost%3A9090%2Fapi%2Fv1%2Ftargets\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://localhost:9090/api/v1/targets\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) it could be possible to obtain RCE (similar to \u003ca title=\"https://github.com/jas502n/gitlab-SSRF-redis-RCE#poc\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fjas502n%2Fgitlab-SSRF-redis-RCE%23poc\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/jas502n/gitlab-SSRF-redis-RCE#poc\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e). A POST request is not possible here, but as \u003ccode\u003eremote_attachment_request_header=\u003c/code\u003e is also available (\u003ca title=\"https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mount.rb#L169\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fblob%2Fv1.3.1%2Flib%2Fcarrierwave%2Fmount.rb%23L169\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mount.rb#L169\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) and not blacklisted, the payload could be set via a header.\u003c/li\u003e\n\u003cli\u003eIf GitLab is hosted on Google Cloud, the above could be used to set the \u003ccode\u003eMetadata-Flavor: Google\u003c/code\u003e header and access \u003ccode\u003ehttp://metadata.google.internal/\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","bounty_amount":"10000.0","formatted_bounty":"$10,000","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":756257,"file_name":"ssrf-note.mp4","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/84ADZaqXNjpoVWHc7RaSAprN?response-content-disposition=attachment%3B%20filename%3D%22ssrf-note.mp4%22%3B%20filename%2A%3DUTF-8%27%27ssrf-note.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ3VAHLH6Z%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T065832Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCD4BvSsKgWcuX7%2Fh3b1LWkKs9s4yRHAxqyVwXJYWsOAwIhANvLMyKSbceDyM1TNnWf11IvuT7a61DuFVJhD%2BT%2Fb9IrKrQDCFcQARoMMDEzNjE5Mjc0ODQ5Igxmi6woSxw%2B6wnwBEMqkQPI1uJcvWS%2B7FQadeW43PrlhsnF4xiGOroakbutVFcvcHOdYKgLxjIJI5m7XwadzbZWnWfHV0%2B62Zb%2BWCUOjMWiTVIXVX7AwYN1lfeKcXEYUp0h0oyXmZ8r9%2Bj%2FMZUagb%2BGKS%2B8zxvRdQjMX1tdjoDe9OxP6o1mlqEZpx8AKw7LDp1Hz2ezBoeya6X2GupABl%2FOhOfLY3VwJj7aPTg85UEwxOdZDtc%2FqzwALQiQUZo0A1RP3Y8nbzGb8CydaoFTXkp8rbJlMiimc%2BP%2BkZhbzJrdAs2rl68CFeUO2KSps4veGXWDFFoEAu1EvHwhAyOhkUlWXmX73VMyIVDvCkiHkuulKA8DiBfGp90UyI0AqLxJxXh%2FgCjGVxceHzAhM03UULwYdje89A1ziU5p%2BKL3KWD4xZiWFhlIiy3U92ksRt8S3l2NanthhEGEvTgf6wIclSsc9f4UbYnjYnAAiXkBg6iZTwORuQ0lVt30ma%2B%2BklzemkOgRIzghR66jzWcsjfvliY27ODm9Z12Vrj3LNetmm3XRTDEg6v%2FBTrqAb0W67QCovsIpNAiT4CujLyYV%2FjYmZ4VKcAok0lQwqZsNMCoze3egJJr5KwJfEhstOKt8adGE2Rfh5M%2BaAuxUHx9CHzHYR0HmUar1TnotcADpaizJlkcQmrsTfX3xtHVR8i9rhilHwmpYSeCQBjKHP%2BS656Uyq6ksGCrQWI4ZK%2F8QgDLIm%2FkIF6FlqRmaPtAeqfdwNxXQoCBcVLYgai%2FvmYu0CSd0Q1ngm%2FQMLqJqwYCLLmqTZrGYBRc5a553mtVqPYXlzc8Pgvjp59x%2Fjbix5wBt%2BoNg6EeSWNYAv4D0k4TzkJ4Aj8N%2BdAfag%3D%3D\u0026X-Amz-Signature=c3db6b287bbf8e4cbdab382ebb91568e2eb70e6c6684a263fc23e5de6f4f49d7","file_size":661771,"type":"video/mp4"},{"id":756269,"file_name":"Screen_Shot_2020-03-22_at_11.22.06_pm.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/pD6Xf8ZiqbysXKVRzQ9ocWFQ?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2020-03-22_at_11.22.06_pm.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2020-03-22_at_11.22.06_pm.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ3VAHLH6Z%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T065832Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCD4BvSsKgWcuX7%2Fh3b1LWkKs9s4yRHAxqyVwXJYWsOAwIhANvLMyKSbceDyM1TNnWf11IvuT7a61DuFVJhD%2BT%2Fb9IrKrQDCFcQARoMMDEzNjE5Mjc0ODQ5Igxmi6woSxw%2B6wnwBEMqkQPI1uJcvWS%2B7FQadeW43PrlhsnF4xiGOroakbutVFcvcHOdYKgLxjIJI5m7XwadzbZWnWfHV0%2B62Zb%2BWCUOjMWiTVIXVX7AwYN1lfeKcXEYUp0h0oyXmZ8r9%2Bj%2FMZUagb%2BGKS%2B8zxvRdQjMX1tdjoDe9OxP6o1mlqEZpx8AKw7LDp1Hz2ezBoeya6X2GupABl%2FOhOfLY3VwJj7aPTg85UEwxOdZDtc%2FqzwALQiQUZo0A1RP3Y8nbzGb8CydaoFTXkp8rbJlMiimc%2BP%2BkZhbzJrdAs2rl68CFeUO2KSps4veGXWDFFoEAu1EvHwhAyOhkUlWXmX73VMyIVDvCkiHkuulKA8DiBfGp90UyI0AqLxJxXh%2FgCjGVxceHzAhM03UULwYdje89A1ziU5p%2BKL3KWD4xZiWFhlIiy3U92ksRt8S3l2NanthhEGEvTgf6wIclSsc9f4UbYnjYnAAiXkBg6iZTwORuQ0lVt30ma%2B%2BklzemkOgRIzghR66jzWcsjfvliY27ODm9Z12Vrj3LNetmm3XRTDEg6v%2FBTrqAb0W67QCovsIpNAiT4CujLyYV%2FjYmZ4VKcAok0lQwqZsNMCoze3egJJr5KwJfEhstOKt8adGE2Rfh5M%2BaAuxUHx9CHzHYR0HmUar1TnotcADpaizJlkcQmrsTfX3xtHVR8i9rhilHwmpYSeCQBjKHP%2BS656Uyq6ksGCrQWI4ZK%2F8QgDLIm%2FkIF6FlqRmaPtAeqfdwNxXQoCBcVLYgai%2FvmYu0CSd0Q1ngm%2FQMLqJqwYCLLmqTZrGYBRc5a553mtVqPYXlzc8Pgvjp59x%2Fjbix5wBt%2BoNg6EeSWNYAv4D0k4TzkJ4Aj8N%2BdAfag%3D%3D\u0026X-Amz-Signature=bac631cdeb045d378c9f2944f7763da8f287ccbe81489471d9b8a0e70f8e8795","file_size":131897,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":332,"voters":["trojan187","r4d1kal","superhero1","acid_slug","sky003","sultancad","kegn","wh0ru","everybodyhurts","a_d_a_m","and 322 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":7390641,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Attached is the modified project export used in the demo","markdown_message":"\u003cp\u003eAttached is the modified project export used in the demo\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-22T12:41:21.208Z","updated_at":"2020-03-22T12:41:21.208Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":756275,"filename":"ssrf_note.tar.gz","type":"application/gzip","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/T1mT5XqkRZLuqvtFX6rWhJm8?response-content-disposition=attachment%3B%20filename%3D%22ssrf_note.tar.gz%22%3B%20filename%2A%3DUTF-8%27%27ssrf_note.tar.gz\u0026response-content-type=application%2Fgzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ3VAHLH6Z%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T065832Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCD4BvSsKgWcuX7%2Fh3b1LWkKs9s4yRHAxqyVwXJYWsOAwIhANvLMyKSbceDyM1TNnWf11IvuT7a61DuFVJhD%2BT%2Fb9IrKrQDCFcQARoMMDEzNjE5Mjc0ODQ5Igxmi6woSxw%2B6wnwBEMqkQPI1uJcvWS%2B7FQadeW43PrlhsnF4xiGOroakbutVFcvcHOdYKgLxjIJI5m7XwadzbZWnWfHV0%2B62Zb%2BWCUOjMWiTVIXVX7AwYN1lfeKcXEYUp0h0oyXmZ8r9%2Bj%2FMZUagb%2BGKS%2B8zxvRdQjMX1tdjoDe9OxP6o1mlqEZpx8AKw7LDp1Hz2ezBoeya6X2GupABl%2FOhOfLY3VwJj7aPTg85UEwxOdZDtc%2FqzwALQiQUZo0A1RP3Y8nbzGb8CydaoFTXkp8rbJlMiimc%2BP%2BkZhbzJrdAs2rl68CFeUO2KSps4veGXWDFFoEAu1EvHwhAyOhkUlWXmX73VMyIVDvCkiHkuulKA8DiBfGp90UyI0AqLxJxXh%2FgCjGVxceHzAhM03UULwYdje89A1ziU5p%2BKL3KWD4xZiWFhlIiy3U92ksRt8S3l2NanthhEGEvTgf6wIclSsc9f4UbYnjYnAAiXkBg6iZTwORuQ0lVt30ma%2B%2BklzemkOgRIzghR66jzWcsjfvliY27ODm9Z12Vrj3LNetmm3XRTDEg6v%2FBTrqAb0W67QCovsIpNAiT4CujLyYV%2FjYmZ4VKcAok0lQwqZsNMCoze3egJJr5KwJfEhstOKt8adGE2Rfh5M%2BaAuxUHx9CHzHYR0HmUar1TnotcADpaizJlkcQmrsTfX3xtHVR8i9rhilHwmpYSeCQBjKHP%2BS656Uyq6ksGCrQWI4ZK%2F8QgDLIm%2FkIF6FlqRmaPtAeqfdwNxXQoCBcVLYgai%2FvmYu0CSd0Q1ngm%2FQMLqJqwYCLLmqTZrGYBRc5a553mtVqPYXlzc8Pgvjp59x%2Fjbix5wBt%2BoNg6EeSWNYAv4D0k4TzkJ4Aj8N%2BdAfag%3D%3D\u0026X-Amz-Signature=5e74f9195a62142c60207c04f4351d1e4999b6dc465a5df558c8f79e59512f73"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7390746,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @vakzz,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 10 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","markdown_message":"\u003cp\u003eHi \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report. We will investigate the issue as soon as possible.\u003cbr\u003e\nDue to our current workload, we will get back within 10 business days with an update.\u003c/p\u003e\n\n\u003cp\u003ePlease refrain from submitting your report or inquiring about its status through\u003cbr\u003e\nadditional channels, as this unnecessarily binds resources in the security team.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nGitLab Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2020-03-22T13:05:21.989Z","updated_at":"2020-03-22T13:05:21.989Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7392735,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"To confirm that this affects gitlab.com as well as the omnibus edition, I did a quick scan of localhost ports on gitlab.com which shows that the following are accessible:\n* `████` on port ██████ allowing the metrics to be retrieved, ███████████████\n\n```\n# TYPE apt_upgrades_pending gauge\napt_upgrades_pending{arch=\"all\",origin=\"Ubuntu:16.04/xenial-updates\"} 32\napt_upgrades_pending{arch=\"amd64\",origin=\"Ubuntu:16.04/xenial\"} 2\napt_upgrades_pending{arch=\"amd64\",origin=\"Ubuntu:16.04/xenial-updates\"} 79\napt_upgrades_pending{arch=\"amd64\",origin=\"pre-release:1/xenial\"} 1\n# HELP chef_client_duration_seconds The duration of chef-client run in seconds.\n# TYPE chef_client_duration_seconds gauge\nchef_client_duration_seconds 75.031342872\n# HELP chef_client_error The bool error status of the last chef-client run.\n# TYPE chef_client_error gauge\nchef_client_error 0\n# HELP chef_client_info The chef client version info.\n# TYPE chef_client_info gauge\n███\n```\n\n*  Consul on port ███████ allowing things like dumping the KV Store at, ███\n\n```json\n[\n  {\n    \"LockIndex\": 0,\n    \"Key\": \"█████\",\n    \"Flags\": 0,\n    \"Value\": null,\n    \"CreateIndex\": 689878,\n    \"ModifyIndex\": 8420654\n  },\n  {\n    \"LockIndex\": 0,\n    \"Key\": \"████████\",\n    \"Flags\": 0,\n    \"Value\": null,\n    \"CreateIndex\": 685871,\n    \"ModifyIndex\": 8420655\n  },\n  {\n    \"LockIndex\": 0,\n    \"Key\": \"█████\",\n    \"Flags\": 0,\n    \"Value\": \"eyJwb3N0Z...\n```\n\nThese both show other internal hosts which could potentially be accessed via the same ssrf to leak private data.\n\nCheers,\nWill","markdown_message":"\u003cp\u003eTo confirm that this affects gitlab.com as well as the omnibus edition, I did a quick scan of localhost ports on gitlab.com which shows that the following are accessible:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003e████\u003c/code\u003e on port ██████ allowing the metrics to be retrieved, ███████████████\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e# TYPE apt_upgrades_pending gauge\napt_upgrades_pending{arch=\u0026quot;all\u0026quot;,origin=\u0026quot;Ubuntu:16.04/xenial-updates\u0026quot;} 32\napt_upgrades_pending{arch=\u0026quot;amd64\u0026quot;,origin=\u0026quot;Ubuntu:16.04/xenial\u0026quot;} 2\napt_upgrades_pending{arch=\u0026quot;amd64\u0026quot;,origin=\u0026quot;Ubuntu:16.04/xenial-updates\u0026quot;} 79\napt_upgrades_pending{arch=\u0026quot;amd64\u0026quot;,origin=\u0026quot;pre-release:1/xenial\u0026quot;} 1\n# HELP chef_client_duration_seconds The duration of chef-client run in seconds.\n# TYPE chef_client_duration_seconds gauge\nchef_client_duration_seconds 75.031342872\n# HELP chef_client_error The bool error status of the last chef-client run.\n# TYPE chef_client_error gauge\nchef_client_error 0\n# HELP chef_client_info The chef client version info.\n# TYPE chef_client_info gauge\n███\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e Consul on port ███████ allowing things like dumping the KV Store at, ███\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;LockIndex\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;Key\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;█████\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;Flags\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;Value\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;CreateIndex\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e689878\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;ModifyIndex\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e8420654\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;LockIndex\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;Key\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;████████\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;Flags\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;Value\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;CreateIndex\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e685871\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;ModifyIndex\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e8420655\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;LockIndex\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;Key\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;█████\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;Flags\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;Value\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;eyJwb3N0Z...\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThese both show other internal hosts which could potentially be accessed via the same ssrf to leak private data.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nWill\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-23T00:32:47.401Z","updated_at":"2020-06-07T22:40:39.608Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7402186,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @vakzz,\n\nthank you for sending in the report! \n\nWe could reproduce the SSRF and are in the process of assessing the impact of your finding. You mentioned that it is possible to set custom HTTP headers on the request by setting `remote_attachment_request_header`:\n\n\u003e as remote_attachment_request_header= is also available (https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mount.rb#L169) and not blacklisted, the payload could be set via a header.\n\nWe were not able to set custom headers on the request with `remote_attachment_request_header`. Can you provide an example project export that demonstrates how to add customer headers?\n\nBest regards,\nDennis","markdown_message":"\u003cp\u003eHi \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003ethank you for sending in the report! \u003c/p\u003e\n\n\u003cp\u003eWe could reproduce the SSRF and are in the process of assessing the impact of your finding. You mentioned that it is possible to set custom HTTP headers on the request by setting \u003ccode\u003eremote_attachment_request_header\u003c/code\u003e:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eas remote_attachment_request_header= is also available (\u003ca title=\"https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mount.rb#L169\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fcarrierwaveuploader%2Fcarrierwave%2Fblob%2Fv1.3.1%2Flib%2Fcarrierwave%2Fmount.rb%23L169\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/mount.rb#L169\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) and not blacklisted, the payload could be set via a header.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eWe were not able to set custom headers on the request with \u003ccode\u003eremote_attachment_request_header\u003c/code\u003e. Can you provide an example project export that demonstrates how to add customer headers?\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nDennis\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-23T16:47:12.275Z","updated_at":"2020-03-23T16:47:12.275Z","actor":{"username":"dappelt","cleared":false,"url":"/dappelt","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7404358,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @vakzz,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab/-/issues/212089.  This issue will be made public 30 days following the release of a patch.\n\nGiven the severity of the report, we are paying an initial $1000 on triage. Congratulations! The final severity of the report might change, depending on if we can reproduce the ability to add custom headers. \n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nRon\nSecurity Team | GitLab Inc.","markdown_message":"\u003cp\u003eHello \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report.\u003c/p\u003e\n\n\u003cp\u003eWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at \u003ca title=\"https://gitlab.com/gitlab-org/gitlab/-/issues/212089\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-org%2Fgitlab%2F-%2Fissues%2F212089\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/gitlab-org/gitlab/-/issues/212089\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.  This issue will be made public 30 days following the release of a patch.\u003c/p\u003e\n\n\u003cp\u003eGiven the severity of the report, we are paying an initial $1000 on triage. Congratulations! The final severity of the report might change, depending on if we can reproduce the ability to add custom headers. \u003c/p\u003e\n\n\u003cp\u003eWe will continue to update you via HackerOne as a patch is scheduled for release.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nRon\u003cbr\u003e\nSecurity Team | GitLab Inc.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-23T20:41:13.885Z","updated_at":"2020-03-23T20:41:13.885Z","actor":{"username":"rchan","cleared":false,"url":"/rchan","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7404364,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-03-23T20:41:47.897Z","updated_at":"2020-03-23T20:41:47.897Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"GitLab"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"vakzz","url":"/vakzz"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7404618,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dappelt,\n\nAfter trying to use a custom header on a project import I was unable to get it to work either (I had previously been testing this via a rails console after confirming it made it through the `AttributeCleaner`). I thought perhaps it was just an issue with randomness (depending on which attribute gets set first) but after digging into the rails code it looks like hash attributes are always set at the end:\n\n```ruby\n    def _assign_attributes(attributes)\n        multi_parameter_attributes  = {}\n        nested_parameter_attributes = {}\n\n        attributes.each do |k, v|\n          if k.include?(\"(\")\n            multi_parameter_attributes[k] = attributes.delete(k)\n          elsif v.is_a?(Hash)\n            nested_parameter_attributes[k] = attributes.delete(k)\n          end\n        end\n        super(attributes)\n\n        assign_nested_parameter_attributes(nested_parameter_attributes) unless nested_parameter_attributes.empty?\n        assign_multiparameter_attributes(multi_parameter_attributes) unless multi_parameter_attributes.empty?\n      end\n``` \n\nAs `remote_attachment_request_header` requires a hash to be passed in due to the following (and it's what `Kernel.open` expects) it will always be assigned last:\n\n```ruby\n# https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/uploader/download.rb#L40\nheaders = @remote_headers.reverse_merge('User-Agent' =\u003e \"CarrierWave/#{CarrierWave::VERSION}\")\n```\n\nSo in summary you can get `remote_attachment_request_header=` to be called but it will always happen after `remote_attachment_url=` meaning the header wont be set yet when the request is made, unless there is a away to create a Note and then retrieve and update it from the cache during the same import (but I can't see a way for that to happen).\n\nSorry about that, I should have tested it a bit more!\n\nCheers,\nWill","markdown_message":"\u003cp\u003eHi \u003ca href=\"/dappelt\"\u003e@dappelt\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eAfter trying to use a custom header on a project import I was unable to get it to work either (I had previously been testing this via a rails console after confirming it made it through the \u003ccode\u003eAttributeCleaner\u003c/code\u003e). I thought perhaps it was just an issue with randomness (depending on which attribute gets set first) but after digging into the rails code it looks like hash attributes are always set at the end:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e_assign_attributes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eattributes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emulti_parameter_attributes\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enested_parameter_attributes\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eattributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eeach\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"o\"\u003e|\u003c/span\u003e\n          \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003einclude?\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;(\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emulti_parameter_attributes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eattributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"k\"\u003eelsif\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eis_a?\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003eHash\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003enested_parameter_attributes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eattributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n        \u003cspan class=\"k\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eattributes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eassign_nested_parameter_attributes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enested_parameter_attributes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eunless\u003c/span\u003e \u003cspan class=\"n\"\u003enested_parameter_attributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eempty?\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassign_multiparameter_attributes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emulti_parameter_attributes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eunless\u003c/span\u003e \u003cspan class=\"n\"\u003emulti_parameter_attributes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eempty?\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs \u003ccode\u003eremote_attachment_request_header\u003c/code\u003e requires a hash to be passed in due to the following (and it\u0026#39;s what \u003ccode\u003eKernel.open\u003c/code\u003e expects) it will always be assigned last:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# https://github.com/carrierwaveuploader/carrierwave/blob/v1.3.1/lib/carrierwave/uploader/download.rb#L40\u003c/span\u003e\n\u003cspan class=\"n\"\u003eheaders\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"vi\"\u003e@remote_headers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ereverse_merge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;User-Agent\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;CarrierWave/\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"no\"\u003eCarrierWave\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eVERSION\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSo in summary you can get \u003ccode\u003eremote_attachment_request_header=\u003c/code\u003e to be called but it will always happen after \u003ccode\u003eremote_attachment_url=\u003c/code\u003e meaning the header wont be set yet when the request is made, unless there is a away to create a Note and then retrieve and update it from the cache during the same import (but I can\u0026#39;t see a way for that to happen).\u003c/p\u003e\n\n\u003cp\u003eSorry about that, I should have tested it a bit more!\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nWill\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-23T21:29:46.506Z","updated_at":"2020-03-23T21:29:46.506Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7406005,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @vakzz,\n\nThe issue you reported is currently scheduled to be fixed by 2020-04-30.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","markdown_message":"\u003cp\u003eETA for fix:\u003c/p\u003e\n\n\u003cp\u003eHi \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThe issue you reported is currently scheduled to be fixed by 2020-04-30.\u003c/p\u003e\n\n\u003cp\u003eThank you again for contacting us!\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nGitLab Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2020-03-24T04:06:21.532Z","updated_at":"2020-03-24T04:06:21.532Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7486997,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @vakzz,\n\nThank you again for the report! Your finding has been patched in GitLab version 12.9.1 and we are awarding a bounty. Congratulations!\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nRon\nSecurity Team | GitLab Inc.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you again for the report! Your finding has been patched in GitLab version 12.9.1 and we are awarding a bounty. Congratulations!\u003c/p\u003e\n\n\u003cp\u003ePlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab\u0026#39;s issue tracker.\u003c/p\u003e\n\n\u003cp\u003eWe look forward to your next report!\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nRon\u003cbr\u003e\nSecurity Team | GitLab Inc.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-30T21:20:12.723Z","updated_at":"2020-03-30T21:20:12.723Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"GitLab"}},"bounty_amount":"9000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"vakzz","url":"/vakzz"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7487006,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2020-03-30T21:20:46.290Z","updated_at":"2020-03-30T21:20:46.290Z","actor":{"username":"rchan","cleared":false,"url":"/rchan","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"vakzz","url":"/vakzz"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8222132,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-07T01:29:57.205Z","updated_at":"2020-06-07T01:29:57.205Z","first_to_agree":true,"actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8226148,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-07T22:41:21.995Z","updated_at":"2020-06-07T22:41:21.995Z","actor":{"username":"rchan","cleared":false,"url":"/rchan","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8226149,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-07T22:41:22.209Z","updated_at":"2020-06-07T22:41:22.209Z","actor":{"username":"rchan","cleared":false,"url":"/rchan","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}