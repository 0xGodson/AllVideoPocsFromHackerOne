{"id":191216,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTEyMTY=","url":"https://hackerone.com/reports/191216","title":"SSRF via git Repo by URL Abuse","state":"Closed","substate":"duplicate","severity_rating":"medium","readable_substate":"Duplicate","created_at":"2016-12-14T19:59:53.158Z","submitted_at":"2016-12-14T19:59:53.158Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"pwnisher","url":"/pwnisher","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/834/cb8dfbf20e924397f137df7bae89c1fd7160903c_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-11-28T18:11:33.802Z","bug_reporter_agreed_on_going_public_at":"2017-11-28T08:13:49.782Z","team_member_agreed_on_going_public_at":"2017-11-28T18:11:33.568Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi team ,\n\nFirst things first, awesome work with \u003c3 Gitlab \n\n######Description :\nWhen creating a repository there is an option to pull existing repo from github by providing your github repos url endpoint, then a request is made to that url endpoint to fetch data and create repo on github fair enough till here. But the issue i wanna address here is that you are **not validating that the URL provided by user** this lets any malicious user request any arbitrary url on the internet and use gitlabs server to connect back to him.\n\n######Steps to Reproduce : \n\n1. Create a repo\n2. Click on git repo by url option \n3. Enter url of your public server and create a repo\n4. Now if you access your servers access logs you will find \n\n``` http\n 40.84.0.225 - - [14/Dec/2016 11:36:33] \"GET /info/refs?service=git-upload-pack HTTP/1.1\" 404 - \n```  \nWhich is requested by gitlab when creating the repo.\n\n######POC:\n\n\u003e\u003eAs a poc i simply port forwarded port  **4444** on my router and started simple HTTP server and listened on 4444 to check for incoming connections, by doing the steps mentioned above i got a GET request from **40.84.0.225**  , images for the same are attached for reference.\n\n\n######Impact:\n\nSuccessful attack on this issue can lead to the following:\n\n* Port scan intranet and external Internet facing servers\n* Fingerprint internal (non-Internet exposed) network aware services\n* Perform banner grabbing\n* Run code on reachable machines\n* Enumerate and attack services that are running on these hosts\n\nAlthough i have not tested for any of these yet, this issue can still be misused to use this endpoint to initiate port scans or dos on other servers on the internet, as the hits will be going from your endpoint.\n\n\n**Cheers!** \n####*Siddhu*","vulnerability_information_html":"\u003cp\u003eHi team ,\u003c/p\u003e\n\n\u003cp\u003eFirst things first, awesome work with \u0026lt;3 Gitlab \u003c/p\u003e\n\n\u003ch6 id=\"description\"\u003eDescription :\u003c/h6\u003e\n\n\u003cp\u003eWhen creating a repository there is an option to pull existing repo from github by providing your github repos url endpoint, then a request is made to that url endpoint to fetch data and create repo on github fair enough till here. But the issue i wanna address here is that you are \u003cstrong\u003enot validating that the URL provided by user\u003c/strong\u003e this lets any malicious user request any arbitrary url on the internet and use gitlabs server to connect back to him.\u003c/p\u003e\n\n\u003ch6 id=\"steps-to-reproduce\"\u003eSteps to Reproduce :\u003c/h6\u003e\n\n\u003col\u003e\n\u003cli\u003eCreate a repo\u003c/li\u003e\n\u003cli\u003eClick on git repo by url option \u003c/li\u003e\n\u003cli\u003eEnter url of your public server and create a repo\u003c/li\u003e\n\u003cli\u003eNow if you access your servers access logs you will find \u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight http\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e 40.84.0.225 - - [14/Dec/2016 11:36:33] \u0026quot;GET /info/refs?service=git-upload-pack HTTP/1.1\u0026quot; 404 - \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhich is requested by gitlab when creating the repo.\u003c/p\u003e\n\n\u003ch6 id=\"poc\"\u003ePOC:\u003c/h6\u003e\n\n\u003cblockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAs a poc i simply port forwarded port  \u003cstrong\u003e4444\u003c/strong\u003e on my router and started simple HTTP server and listened on 4444 to check for incoming connections, by doing the steps mentioned above i got a GET request from \u003cstrong\u003e40.84.0.225\u003c/strong\u003e  , images for the same are attached for reference.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/blockquote\u003e\n\n\u003ch6 id=\"impact\"\u003eImpact:\u003c/h6\u003e\n\n\u003cp\u003eSuccessful attack on this issue can lead to the following:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePort scan intranet and external Internet facing servers\u003c/li\u003e\n\u003cli\u003eFingerprint internal (non-Internet exposed) network aware services\u003c/li\u003e\n\u003cli\u003ePerform banner grabbing\u003c/li\u003e\n\u003cli\u003eRun code on reachable machines\u003c/li\u003e\n\u003cli\u003eEnumerate and attack services that are running on these hosts\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAlthough i have not tested for any of these yet, this issue can still be misused to use this endpoint to initiate port scans or dos on other servers on the internet, as the hits will be going from your endpoint.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eCheers!\u003c/strong\u003e \u003c/p\u003e\n\n\u003ch4 id=\"siddhu\"\u003e\u003cem\u003eSiddhu\u003c/em\u003e\u003c/h4\u003e\n","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":143574,"file_name":"1.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/143/574/e3062e9d32836238b2a73161247250bc5d8d53aa/1.PNG?response-content-disposition=attachment%3B%20filename%3D%221.PNG%22%3B%20filename%2A%3DUTF-8%27%271.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQUOQU5REA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044914Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDKbajvkbgJ0bk%2BBvRtGQ7p5KCzGha%2FVaDDwyFq8CM66wIgaw7%2FMRI5kyRpH%2BnIlLG4ZnmM%2FrLjLjJWrmkX0zZfd9sqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDP91WL002Wbo0XGfnyqRA%2FNt3W4r54Z2Rrjnbzg30AtIqSAaUbiKh6dYPI5iumJt%2FacDVM4CmdTQCSkrpk45DFotrgtd1tIXQUPsAioE3hz70xop4zS0jebfAPdwBp38Mc3YKPYsW1TgWIT19zK4t%2B4eGJVFjPey5O%2FEfBu4XYpGDd%2Fy2VO0kVCb43%2F76mvlk6aWlA01UhpCilK3J%2F7qqZsw4P3jggaBSCjGhssHvqDLjMzfR%2FDpDE7VaotOr3rJmP5ZK66Q9%2BkoG5kaLgKcslwRO9FGLNBY8AuIhUCEMRp9RM9yBIFYe%2FyyvHRriCVGHEgdIJ9wvxaVVvCfEcWZw1dEIriA6BftAk5kML6b8WN8zwMI3cyqbnvBS9PGbEcrzzU67DDkEk0llxEfFqJB1g4ruY5L2BsxjsulOVXWFSQHoykg7EnBFBbQGmuPAyxW942tXfkTyjH7aQIFAbpwURAHEFFcnVcJBzYS%2B6tGyu1ozPdrsFK5Ko2OryeYDFeK8b9JxwAMZqBekNlk1Bn%2BWq2RJZZBgBTV1X9LfuQ%2FLbSAMJq2qv8FOusBgtnFtNPu6rgydFw%2BpCNudbVGZ39p3P2aIl7K%2B6fRTLBImgaGX5r2pXgGjSRb3Co5NHURzMlQWYw9SJdMt5vMsDNtT9otjm5R%2Fz00sRO779VmfaZOO18lLujlVlImBZA%2BY20iW%2B%2FVBR4UOivJTvxApUCo%2BQYZQghLFkO4s17mPPAo6XeP%2BtXjXhn71RPHuwavkbgQ0EuL1pf5gaqdarsB4psJiZ3FphFomE6unCMAErk3vFIwEIi%2Be5%2FjAIsDg6zS3oetmQEMR7IeJadGwnOF7tifKH8X2cyJk2IoG8HLG%2FfDEf2cBUt6EjPoIQ%3D%3D\u0026X-Amz-Signature=18f6190bf9adcfa0f56af2ea11ee30689c1d5609170ee39eea13a7789128ba4e","file_size":38336,"type":"image/png"},{"id":143575,"file_name":"2.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/143/575/7087b6d0619ff536adae0085e57bcdd8a13c9b10/2.PNG?response-content-disposition=attachment%3B%20filename%3D%222.PNG%22%3B%20filename%2A%3DUTF-8%27%272.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQUOQU5REA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044914Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDKbajvkbgJ0bk%2BBvRtGQ7p5KCzGha%2FVaDDwyFq8CM66wIgaw7%2FMRI5kyRpH%2BnIlLG4ZnmM%2FrLjLjJWrmkX0zZfd9sqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDP91WL002Wbo0XGfnyqRA%2FNt3W4r54Z2Rrjnbzg30AtIqSAaUbiKh6dYPI5iumJt%2FacDVM4CmdTQCSkrpk45DFotrgtd1tIXQUPsAioE3hz70xop4zS0jebfAPdwBp38Mc3YKPYsW1TgWIT19zK4t%2B4eGJVFjPey5O%2FEfBu4XYpGDd%2Fy2VO0kVCb43%2F76mvlk6aWlA01UhpCilK3J%2F7qqZsw4P3jggaBSCjGhssHvqDLjMzfR%2FDpDE7VaotOr3rJmP5ZK66Q9%2BkoG5kaLgKcslwRO9FGLNBY8AuIhUCEMRp9RM9yBIFYe%2FyyvHRriCVGHEgdIJ9wvxaVVvCfEcWZw1dEIriA6BftAk5kML6b8WN8zwMI3cyqbnvBS9PGbEcrzzU67DDkEk0llxEfFqJB1g4ruY5L2BsxjsulOVXWFSQHoykg7EnBFBbQGmuPAyxW942tXfkTyjH7aQIFAbpwURAHEFFcnVcJBzYS%2B6tGyu1ozPdrsFK5Ko2OryeYDFeK8b9JxwAMZqBekNlk1Bn%2BWq2RJZZBgBTV1X9LfuQ%2FLbSAMJq2qv8FOusBgtnFtNPu6rgydFw%2BpCNudbVGZ39p3P2aIl7K%2B6fRTLBImgaGX5r2pXgGjSRb3Co5NHURzMlQWYw9SJdMt5vMsDNtT9otjm5R%2Fz00sRO779VmfaZOO18lLujlVlImBZA%2BY20iW%2B%2FVBR4UOivJTvxApUCo%2BQYZQghLFkO4s17mPPAo6XeP%2BtXjXhn71RPHuwavkbgQ0EuL1pf5gaqdarsB4psJiZ3FphFomE6unCMAErk3vFIwEIi%2Be5%2FjAIsDg6zS3oetmQEMR7IeJadGwnOF7tifKH8X2cyJk2IoG8HLG%2FfDEf2cBUt6EjPoIQ%3D%3D\u0026X-Amz-Signature=2dea8a77394f0b5678157c395baceda8901ad09ae18fd6b755f6628e0c82969e","file_size":8381,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":2,"voters":["eveeez","sa1tama0"],"severity":{"rating":"medium","score":6.6,"author_type":"User","metrics":{"attack_vector":"local","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1365064,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Hi @intercept9, thanks for the report.\n\nWe have an open issue for this problem already: #135937. To be honest, it's not an easy problem to solve given the way GitLab imports projects. We hope to have a patch out very soon.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/intercept9\"\u003e@intercept9\u003c/a\u003e, thanks for the report.\u003c/p\u003e\n\n\u003cp\u003eWe have an open issue for this problem already: \u003ca href=\"/reports/135937\"\u003e#135937\u003c/a\u003e. To be honest, it\u0026#39;s not an easy problem to solve given the way GitLab imports projects. We hope to have a patch out very soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-14T20:30:28.265Z","updated_at":"2016-12-14T20:30:28.265Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1365099,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"i was thinking a regex check for https://github.com as a starting would be sufficient , i want to know how you guys gonna patch this , anyways thanks a lot for replaying back soon, will come back with better bugs soon  :)\n\nWith love on Gitlab  ","markdown_message":"\u003cp\u003ei was thinking a regex check for \u003ca title=\"https://github.com\" href=\"/redirect?url=https%3A%2F%2Fgithub.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e as a starting would be sufficient , i want to know how you guys gonna patch this , anyways thanks a lot for replaying back soon, will come back with better bugs soon  :)\u003c/p\u003e\n\n\u003cp\u003eWith love on Gitlab  \u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-14T20:49:52.666Z","updated_at":"2016-12-14T20:49:52.666Z","actor":{"username":"pwnisher","cleared":false,"url":"/pwnisher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/834/cb8dfbf20e924397f137df7bae89c1fd7160903c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1365304,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"You're right that that would probably work for GitHub imports. We're working on a patch for all other types of imports as well.\n\nHappy Hunting!","markdown_message":"\u003cp\u003eYou\u0026#39;re right that that would probably work for GitHub imports. We\u0026#39;re working on a patch for all other types of imports as well.\u003c/p\u003e\n\n\u003cp\u003eHappy Hunting!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-14T22:36:33.855Z","updated_at":"2016-12-14T22:36:33.855Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2185843,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-28T08:13:49.809Z","updated_at":"2017-11-28T08:13:49.809Z","first_to_agree":true,"actor":{"username":"pwnisher","cleared":false,"url":"/pwnisher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/834/cb8dfbf20e924397f137df7bae89c1fd7160903c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2187179,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-28T18:11:33.595Z","updated_at":"2017-11-28T18:11:33.595Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2187180,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-28T18:11:33.830Z","updated_at":"2017-11-28T18:11:33.830Z","actor":{"username":"briann","cleared":false,"url":"/briann","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}