{"id":189633,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODk2MzM=","url":"https://hackerone.com/reports/189633","title":"Certain inputs cause tight C-level recursion leading to process stack overflow","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-12-08T22:16:40.299Z","submitted_at":"2016-12-08T22:16:40.299Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"dkasak","url":"/dkasak","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/122/858/df3e45a00fd0f5e53ef7dc7f9b12168cbde93200_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-03-14T22:22:39.902Z","bug_reporter_agreed_on_going_public_at":"2017-03-14T22:22:39.853Z","team_member_agreed_on_going_public_at":"2017-03-14T21:08:23.756Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Introduction\n============\n\nCertain legal Ruby programs can cause a tight recursion on the C-level (without using `eval`) while spending very little of the Ruby-level stack. This precludes triggering a Ruby stack overflow exception and eventually leads to a process stack overflow and a segfault. Both vanilla mruby and mruby running inside mruby-engine are vulnerable.\n\nProof of concept\n================\n\nrecursive_to_i.rb:\n------------------\n\n    def to_i\n        '' * self\n    end\n\n    to_i\n\n1. Save the above code as `recursive_to_i.rb`.\n2. Run either:\n   a) `mruby recursive_to_i.rb`\n   b) `sandbox recursive_to_i.rb`\n3. Both cause a segfault due to a process stack overflow.\n\nDiscussion\n==========\n\nEverything below assumes the latest master of the mruby repository as of Dec 08th, which is commit `b84e005fc36a3c669586cc66ab3c87630d7a5509`.\n\nSince the above POC redefines `to_i` on `Object`, it is very easy to trigger the crash afterwards, for instance, by trying to use any subclass of `Object` without its own `to_i` in an integer context.\n\nIncidentally, that mruby uses `to_i` for implicit conversion to an `Integer` seems wrong (the offending code being in object.c, line 561). For instance, MRI Ruby gives the following for the above POC:\n\n    recursive_to_i.rb:2:in `*': no implicit conversion of Object into Integer (TypeError)\n            from recursive_to_i.rb:2:in `to_i'\n            from recursive_to_i.rb:5:in `\u003cmain\u003e'\u003cPaste\u003e\n\nHowever, the problem isn't limited to overriding `to_i`. Some other inputs that exploit the same bug:\n\nnil_method_ensure.rb\n--------------------\n\n    def nil.m\n        m a ensure m + a\n    end\n\n    nil.m\n\nThis one crashes only mruby and not the sandbox:\n\nmodule_new_do.rb\n----------------\n\n    def a\n        Module.new do\n            a\n        end\n    end\n\n    a\n\nThere are probably others since the underlying cause is the same.\n\nSolution\n========\n\nWhile there may be a way to fix these cases individually, it is our opinion that the C-level recursion depth should be tracked and, ideally, limited according to the size of the process stack.\n\nWe managed to produce recursions that spend as much as 3200 bytes of the process stack between two recursive `mrb_vm_run` calls while only spending 80 bytes of the Ruby stack. Based on some testing, we've derived a loose upper limit of the number of recursions needed to crash the interpreter in this scenario:\n\n    (stack_size * 0.98) / 3200\n\nTightening the factors up a bit, we arrive at the following formula that should give a good safety margin (assumptions: 10% of the stack used before first call to `mrb_vm_run`, 4096 bytes of the process stack used between two recursive calls):\n\n    (stack_size * 0.9) / 4096 - 1\n\nWe supply a patch where we've implemented C-level recursion depth tracking based on this formula, hardcoded to a stack size of 8 MiB (defined as a macro constant). Ideally, the process stack size should be determined using a method appropriate for the OS (for instance, `getrlimit` on POSIX).\n\n--\nDenis Kasak\nDamir JeliÄ‡","vulnerability_information_html":"\u003ch1 id=\"introduction\"\u003eIntroduction\u003c/h1\u003e\n\n\u003cp\u003eCertain legal Ruby programs can cause a tight recursion on the C-level (without using \u003ccode\u003eeval\u003c/code\u003e) while spending very little of the Ruby-level stack. This precludes triggering a Ruby stack overflow exception and eventually leads to a process stack overflow and a segfault. Both vanilla mruby and mruby running inside mruby-engine are vulnerable.\u003c/p\u003e\n\n\u003ch1 id=\"proof-of-concept\"\u003eProof of concept\u003c/h1\u003e\n\n\u003ch2 id=\"recursive_to_i-rb\"\u003erecursive_to_i.rb:\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003edef to_i\n    \u0026#39;\u0026#39; * self\nend\n\nto_i\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col\u003e\n\u003cli\u003eSave the above code as \u003ccode\u003erecursive_to_i.rb\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eRun either:\na) \u003ccode\u003emruby recursive_to_i.rb\u003c/code\u003e\nb) \u003ccode\u003esandbox recursive_to_i.rb\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eBoth cause a segfault due to a process stack overflow.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1 id=\"discussion\"\u003eDiscussion\u003c/h1\u003e\n\n\u003cp\u003eEverything below assumes the latest master of the mruby repository as of Dec 08th, which is commit \u003ccode\u003eb84e005fc36a3c669586cc66ab3c87630d7a5509\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eSince the above POC redefines \u003ccode\u003eto_i\u003c/code\u003e on \u003ccode\u003eObject\u003c/code\u003e, it is very easy to trigger the crash afterwards, for instance, by trying to use any subclass of \u003ccode\u003eObject\u003c/code\u003e without its own \u003ccode\u003eto_i\u003c/code\u003e in an integer context.\u003c/p\u003e\n\n\u003cp\u003eIncidentally, that mruby uses \u003ccode\u003eto_i\u003c/code\u003e for implicit conversion to an \u003ccode\u003eInteger\u003c/code\u003e seems wrong (the offending code being in object.c, line 561). For instance, MRI Ruby gives the following for the above POC:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003erecursive_to_i.rb:2:in `*\u0026#39;: no implicit conversion of Object into Integer (TypeError)\n        from recursive_to_i.rb:2:in `to_i\u0026#39;\n        from recursive_to_i.rb:5:in `\u0026lt;main\u0026gt;\u0026#39;\u0026lt;Paste\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHowever, the problem isn\u0026#39;t limited to overriding \u003ccode\u003eto_i\u003c/code\u003e. Some other inputs that exploit the same bug:\u003c/p\u003e\n\n\u003ch2 id=\"nil_method_ensure-rb\"\u003enil_method_ensure.rb\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003edef nil.m\n    m a ensure m + a\nend\n\nnil.m\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis one crashes only mruby and not the sandbox:\u003c/p\u003e\n\n\u003ch2 id=\"module_new_do-rb\"\u003emodule_new_do.rb\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003edef a\n    Module.new do\n        a\n    end\nend\n\na\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThere are probably others since the underlying cause is the same.\u003c/p\u003e\n\n\u003ch1 id=\"solution\"\u003eSolution\u003c/h1\u003e\n\n\u003cp\u003eWhile there may be a way to fix these cases individually, it is our opinion that the C-level recursion depth should be tracked and, ideally, limited according to the size of the process stack.\u003c/p\u003e\n\n\u003cp\u003eWe managed to produce recursions that spend as much as 3200 bytes of the process stack between two recursive \u003ccode\u003emrb_vm_run\u003c/code\u003e calls while only spending 80 bytes of the Ruby stack. Based on some testing, we\u0026#39;ve derived a loose upper limit of the number of recursions needed to crash the interpreter in this scenario:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e(stack_size * 0.98) / 3200\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTightening the factors up a bit, we arrive at the following formula that should give a good safety margin (assumptions: 10% of the stack used before first call to \u003ccode\u003emrb_vm_run\u003c/code\u003e, 4096 bytes of the process stack used between two recursive calls):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e(stack_size * 0.9) / 4096 - 1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe supply a patch where we\u0026#39;ve implemented C-level recursion depth tracking based on this formula, hardcoded to a stack size of 8 MiB (defined as a macro constant). Ideally, the process stack size should be determined using a method appropriate for the OS (for instance, \u003ccode\u003egetrlimit\u003c/code\u003e on POSIX).\u003c/p\u003e\n\n\u003cp\u003e--\u003cbr\u003e\nDenis Kasak\u003cbr\u003e\nDamir JeliÄ‡\u003c/p\u003e\n","bounty_amount":"10000.0","formatted_bounty":"$10,000","weakness":{"id":2,"name":"Memory Corruption - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":141844,"file_name":"recursive_to_i.rb","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/141/844/6576345b6dd29de0f7d5db6cb80fca34e26c4591/recursive_to_i.rb?response-content-disposition=attachment%3B%20filename%3D%22recursive_to_i.rb%22%3B%20filename%2A%3DUTF-8%27%27recursive_to_i.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQUOQU5REA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044845Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDKbajvkbgJ0bk%2BBvRtGQ7p5KCzGha%2FVaDDwyFq8CM66wIgaw7%2FMRI5kyRpH%2BnIlLG4ZnmM%2FrLjLjJWrmkX0zZfd9sqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDP91WL002Wbo0XGfnyqRA%2FNt3W4r54Z2Rrjnbzg30AtIqSAaUbiKh6dYPI5iumJt%2FacDVM4CmdTQCSkrpk45DFotrgtd1tIXQUPsAioE3hz70xop4zS0jebfAPdwBp38Mc3YKPYsW1TgWIT19zK4t%2B4eGJVFjPey5O%2FEfBu4XYpGDd%2Fy2VO0kVCb43%2F76mvlk6aWlA01UhpCilK3J%2F7qqZsw4P3jggaBSCjGhssHvqDLjMzfR%2FDpDE7VaotOr3rJmP5ZK66Q9%2BkoG5kaLgKcslwRO9FGLNBY8AuIhUCEMRp9RM9yBIFYe%2FyyvHRriCVGHEgdIJ9wvxaVVvCfEcWZw1dEIriA6BftAk5kML6b8WN8zwMI3cyqbnvBS9PGbEcrzzU67DDkEk0llxEfFqJB1g4ruY5L2BsxjsulOVXWFSQHoykg7EnBFBbQGmuPAyxW942tXfkTyjH7aQIFAbpwURAHEFFcnVcJBzYS%2B6tGyu1ozPdrsFK5Ko2OryeYDFeK8b9JxwAMZqBekNlk1Bn%2BWq2RJZZBgBTV1X9LfuQ%2FLbSAMJq2qv8FOusBgtnFtNPu6rgydFw%2BpCNudbVGZ39p3P2aIl7K%2B6fRTLBImgaGX5r2pXgGjSRb3Co5NHURzMlQWYw9SJdMt5vMsDNtT9otjm5R%2Fz00sRO779VmfaZOO18lLujlVlImBZA%2BY20iW%2B%2FVBR4UOivJTvxApUCo%2BQYZQghLFkO4s17mPPAo6XeP%2BtXjXhn71RPHuwavkbgQ0EuL1pf5gaqdarsB4psJiZ3FphFomE6unCMAErk3vFIwEIi%2Be5%2FjAIsDg6zS3oetmQEMR7IeJadGwnOF7tifKH8X2cyJk2IoG8HLG%2FfDEf2cBUt6EjPoIQ%3D%3D\u0026X-Amz-Signature=0b06ce2aea270285a1c7c2ce479b7ede9ddc303cc18e448010e7c51af793842e","file_size":33,"type":"text/plain"},{"id":141845,"file_name":"nil_method_ensure.rb","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/141/845/e56137747f7b994e0966527af7a92c24ac2e342b/nil_method_ensure.rb?response-content-disposition=attachment%3B%20filename%3D%22nil_method_ensure.rb%22%3B%20filename%2A%3DUTF-8%27%27nil_method_ensure.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQUOQU5REA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044845Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDKbajvkbgJ0bk%2BBvRtGQ7p5KCzGha%2FVaDDwyFq8CM66wIgaw7%2FMRI5kyRpH%2BnIlLG4ZnmM%2FrLjLjJWrmkX0zZfd9sqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDP91WL002Wbo0XGfnyqRA%2FNt3W4r54Z2Rrjnbzg30AtIqSAaUbiKh6dYPI5iumJt%2FacDVM4CmdTQCSkrpk45DFotrgtd1tIXQUPsAioE3hz70xop4zS0jebfAPdwBp38Mc3YKPYsW1TgWIT19zK4t%2B4eGJVFjPey5O%2FEfBu4XYpGDd%2Fy2VO0kVCb43%2F76mvlk6aWlA01UhpCilK3J%2F7qqZsw4P3jggaBSCjGhssHvqDLjMzfR%2FDpDE7VaotOr3rJmP5ZK66Q9%2BkoG5kaLgKcslwRO9FGLNBY8AuIhUCEMRp9RM9yBIFYe%2FyyvHRriCVGHEgdIJ9wvxaVVvCfEcWZw1dEIriA6BftAk5kML6b8WN8zwMI3cyqbnvBS9PGbEcrzzU67DDkEk0llxEfFqJB1g4ruY5L2BsxjsulOVXWFSQHoykg7EnBFBbQGmuPAyxW942tXfkTyjH7aQIFAbpwURAHEFFcnVcJBzYS%2B6tGyu1ozPdrsFK5Ko2OryeYDFeK8b9JxwAMZqBekNlk1Bn%2BWq2RJZZBgBTV1X9LfuQ%2FLbSAMJq2qv8FOusBgtnFtNPu6rgydFw%2BpCNudbVGZ39p3P2aIl7K%2B6fRTLBImgaGX5r2pXgGjSRb3Co5NHURzMlQWYw9SJdMt5vMsDNtT9otjm5R%2Fz00sRO779VmfaZOO18lLujlVlImBZA%2BY20iW%2B%2FVBR4UOivJTvxApUCo%2BQYZQghLFkO4s17mPPAo6XeP%2BtXjXhn71RPHuwavkbgQ0EuL1pf5gaqdarsB4psJiZ3FphFomE6unCMAErk3vFIwEIi%2Be5%2FjAIsDg6zS3oetmQEMR7IeJadGwnOF7tifKH8X2cyJk2IoG8HLG%2FfDEf2cBUt6EjPoIQ%3D%3D\u0026X-Amz-Signature=2d07741ca55d7cb2adb288ed9c74a7f65fc28bcc41292d999e38b773ee74652a","file_size":39,"type":"text/plain"},{"id":141846,"file_name":"module_new_do.rb","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/141/846/94476de134c28ddfb995697704eae6ea6b9b2d55/module_new_do.rb?response-content-disposition=attachment%3B%20filename%3D%22module_new_do.rb%22%3B%20filename%2A%3DUTF-8%27%27module_new_do.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQUOQU5REA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044845Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDKbajvkbgJ0bk%2BBvRtGQ7p5KCzGha%2FVaDDwyFq8CM66wIgaw7%2FMRI5kyRpH%2BnIlLG4ZnmM%2FrLjLjJWrmkX0zZfd9sqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDP91WL002Wbo0XGfnyqRA%2FNt3W4r54Z2Rrjnbzg30AtIqSAaUbiKh6dYPI5iumJt%2FacDVM4CmdTQCSkrpk45DFotrgtd1tIXQUPsAioE3hz70xop4zS0jebfAPdwBp38Mc3YKPYsW1TgWIT19zK4t%2B4eGJVFjPey5O%2FEfBu4XYpGDd%2Fy2VO0kVCb43%2F76mvlk6aWlA01UhpCilK3J%2F7qqZsw4P3jggaBSCjGhssHvqDLjMzfR%2FDpDE7VaotOr3rJmP5ZK66Q9%2BkoG5kaLgKcslwRO9FGLNBY8AuIhUCEMRp9RM9yBIFYe%2FyyvHRriCVGHEgdIJ9wvxaVVvCfEcWZw1dEIriA6BftAk5kML6b8WN8zwMI3cyqbnvBS9PGbEcrzzU67DDkEk0llxEfFqJB1g4ruY5L2BsxjsulOVXWFSQHoykg7EnBFBbQGmuPAyxW942tXfkTyjH7aQIFAbpwURAHEFFcnVcJBzYS%2B6tGyu1ozPdrsFK5Ko2OryeYDFeK8b9JxwAMZqBekNlk1Bn%2BWq2RJZZBgBTV1X9LfuQ%2FLbSAMJq2qv8FOusBgtnFtNPu6rgydFw%2BpCNudbVGZ39p3P2aIl7K%2B6fRTLBImgaGX5r2pXgGjSRb3Co5NHURzMlQWYw9SJdMt5vMsDNtT9otjm5R%2Fz00sRO779VmfaZOO18lLujlVlImBZA%2BY20iW%2B%2FVBR4UOivJTvxApUCo%2BQYZQghLFkO4s17mPPAo6XeP%2BtXjXhn71RPHuwavkbgQ0EuL1pf5gaqdarsB4psJiZ3FphFomE6unCMAErk3vFIwEIi%2Be5%2FjAIsDg6zS3oetmQEMR7IeJadGwnOF7tifKH8X2cyJk2IoG8HLG%2FfDEf2cBUt6EjPoIQ%3D%3D\u0026X-Amz-Signature=ce5771cdbb8c3a5edd40415fe72b62c17da8ecd9c1cb5182aac12e90157af672","file_size":49,"type":"text/plain"},{"id":141847,"file_name":"recursion_limit.patch","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/141/847/8982788f1dd9880b1891614805258659d2b48e56/recursion_limit.patch?response-content-disposition=attachment%3B%20filename%3D%22recursion_limit.patch%22%3B%20filename%2A%3DUTF-8%27%27recursion_limit.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQUOQU5REA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044845Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDKbajvkbgJ0bk%2BBvRtGQ7p5KCzGha%2FVaDDwyFq8CM66wIgaw7%2FMRI5kyRpH%2BnIlLG4ZnmM%2FrLjLjJWrmkX0zZfd9sqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDP91WL002Wbo0XGfnyqRA%2FNt3W4r54Z2Rrjnbzg30AtIqSAaUbiKh6dYPI5iumJt%2FacDVM4CmdTQCSkrpk45DFotrgtd1tIXQUPsAioE3hz70xop4zS0jebfAPdwBp38Mc3YKPYsW1TgWIT19zK4t%2B4eGJVFjPey5O%2FEfBu4XYpGDd%2Fy2VO0kVCb43%2F76mvlk6aWlA01UhpCilK3J%2F7qqZsw4P3jggaBSCjGhssHvqDLjMzfR%2FDpDE7VaotOr3rJmP5ZK66Q9%2BkoG5kaLgKcslwRO9FGLNBY8AuIhUCEMRp9RM9yBIFYe%2FyyvHRriCVGHEgdIJ9wvxaVVvCfEcWZw1dEIriA6BftAk5kML6b8WN8zwMI3cyqbnvBS9PGbEcrzzU67DDkEk0llxEfFqJB1g4ruY5L2BsxjsulOVXWFSQHoykg7EnBFBbQGmuPAyxW942tXfkTyjH7aQIFAbpwURAHEFFcnVcJBzYS%2B6tGyu1ozPdrsFK5Ko2OryeYDFeK8b9JxwAMZqBekNlk1Bn%2BWq2RJZZBgBTV1X9LfuQ%2FLbSAMJq2qv8FOusBgtnFtNPu6rgydFw%2BpCNudbVGZ39p3P2aIl7K%2B6fRTLBImgaGX5r2pXgGjSRb3Co5NHURzMlQWYw9SJdMt5vMsDNtT9otjm5R%2Fz00sRO779VmfaZOO18lLujlVlImBZA%2BY20iW%2B%2FVBR4UOivJTvxApUCo%2BQYZQghLFkO4s17mPPAo6XeP%2BtXjXhn71RPHuwavkbgQ0EuL1pf5gaqdarsB4psJiZ3FphFomE6unCMAErk3vFIwEIi%2Be5%2FjAIsDg6zS3oetmQEMR7IeJadGwnOF7tifKH8X2cyJk2IoG8HLG%2FfDEf2cBUt6EjPoIQ%3D%3D\u0026X-Amz-Signature=779b6c721e3df114069afee5320f8627f9012005673abc65264a4e133a4ef1b8","file_size":2389,"type":"text/x-diff"}],"allow_singular_disclosure_at":"2017-04-13T21:08:23.802Z","allow_singular_disclosure_after":-117099621.57024723,"singular_disclosure_allowed":true,"vote_count":11,"voters":["dkasak","dgaletic","eveeez","dz_samir","grampae","t-4-y-m","japz","spetr0x","bughuntergr","localhost1st","and 1 more..."],"severity":{"rating":"high","score":8.6,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"none","integrity":"none","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1367376,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Thank you for your report.\n\nWe were already aware of the issue with C-level recursion, as we received earlier reports that demonstrated it and we encountered the issue in our own investigations. It doesn't appear to be exploitable within the current sandbox limits, and would also be mitigated by the recent sandboxing \u0026 process isolation we have implemented. Because the issue was previously known, we're closing this report as a duplicate.","markdown_message":"\u003cp\u003eThank you for your report.\u003c/p\u003e\n\n\u003cp\u003eWe were already aware of the issue with C-level recursion, as we received earlier reports that demonstrated it and we encountered the issue in our own investigations. It doesn\u0026#39;t appear to be exploitable within the current sandbox limits, and would also be mitigated by the recent sandboxing \u0026amp; process isolation we have implemented. Because the issue was previously known, we\u0026#39;re closing this report as a duplicate.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-15T19:02:03.030Z","updated_at":"2016-12-15T19:02:03.030Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1367451,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We supposed you were already aware that C-level recursion was potentially problematic since there is no check for it in mruby code. However, the point here is in concrete inputs which *are* exploitable with the current sandbox limits. Does the first input (`recursive_to_i.rb`) not crash on your end with the default limits (4 MB, 100ms, 100k instructions)? I just checked with the latest codebase again and it still crashes for me.\n\nWe were also under the impression that the sandboxing / process isolation was irrelevant for this particular report since it was submitted prior to their implementation (Dec 9th).","markdown_message":"\u003cp\u003eWe supposed you were already aware that C-level recursion was potentially problematic since there is no check for it in mruby code. However, the point here is in concrete inputs which \u003cem\u003eare\u003c/em\u003e exploitable with the current sandbox limits. Does the first input (\u003ccode\u003erecursive_to_i.rb\u003c/code\u003e) not crash on your end with the default limits (4 MB, 100ms, 100k instructions)? I just checked with the latest codebase again and it still crashes for me.\u003c/p\u003e\n\n\u003cp\u003eWe were also under the impression that the sandboxing / process isolation was irrelevant for this particular report since it was submitted prior to their implementation (Dec 9th).\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-15T19:24:09.852Z","updated_at":"2016-12-15T19:24:40.541Z","actor":{"username":"dkasak","cleared":true,"url":"/dkasak","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/122/858/df3e45a00fd0f5e53ef7dc7f9b12168cbde93200_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1367559,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The POC's didn't crash in my OS X development environment, but I see that the first one does segfault on Ubuntu. I believe we did have instances of C-level recursion causing crashes prior to your submission but I'll have to check into that, and will re-open this ticket if not.","markdown_message":"\u003cp\u003eThe POC\u0026#39;s didn\u0026#39;t crash in my OS X development environment, but I see that the first one does segfault on Ubuntu. I believe we did have instances of C-level recursion causing crashes prior to your submission but I\u0026#39;ll have to check into that, and will re-open this ticket if not.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-15T20:04:35.665Z","updated_at":"2016-12-15T20:04:35.665Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1369436,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T16:25:45.906Z","updated_at":"2016-12-16T16:25:45.906Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1369441,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I didn't find an earlier report, so I'm marking this as triaged for now while we investigate further. Sorry for the confusion.","markdown_message":"\u003cp\u003eI didn\u0026#39;t find an earlier report, so I\u0026#39;m marking this as triaged for now while we investigate further. Sorry for the confusion.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-16T16:27:59.571Z","updated_at":"2016-12-16T16:27:59.571Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1518305,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Since this has been open for some time, we're wondering if there is any progress on this.","markdown_message":"\u003cp\u003eSince this has been open for some time, we\u0026#39;re wondering if there is any progress on this.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-03T21:41:46.054Z","updated_at":"2017-03-03T21:41:46.054Z","actor":{"username":"dkasak","cleared":true,"url":"/dkasak","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/122/858/df3e45a00fd0f5e53ef7dc7f9b12168cbde93200_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1522722,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report, and sorry for the delay in getting back to you. This issue was addressed upstream with a limit on the maximum recursion depth, similar to what you had proposed in your patch: https://github.com/mruby/mruby/commit/1e5b5b14d7468ca4fedaa9ba1c9dba0ff67d7ea8\n\nStack overflows in MRuby are also mitigated by the extra layer of sandboxing we now have in place.\n\nOur next round of bounty decisions will take place within two weeks, so we'll be in touch with you again soon.","markdown_message":"\u003cp\u003eThanks again for your report, and sorry for the delay in getting back to you. This issue was addressed upstream with a limit on the maximum recursion depth, similar to what you had proposed in your patch: \u003ca title=\"https://github.com/mruby/mruby/commit/1e5b5b14d7468ca4fedaa9ba1c9dba0ff67d7ea8\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fcommit%2F1e5b5b14d7468ca4fedaa9ba1c9dba0ff67d7ea8\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/commit/1e5b5b14d7468ca4fedaa9ba1c9dba0ff67d7ea8\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eStack overflows in MRuby are also mitigated by the extra layer of sandboxing we now have in place.\u003c/p\u003e\n\n\u003cp\u003eOur next round of bounty decisions will take place within two weeks, so we\u0026#39;ll be in touch with you again soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-06T19:42:23.958Z","updated_at":"2017-03-06T19:42:23.958Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"dkasak","url":"/dkasak"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541564,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify and the MRuby project!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify and the MRuby project!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-14T21:08:17.587Z","updated_at":"2017-03-14T21:08:17.587Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"10000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"dkasak","url":"/dkasak"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541566,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-14T21:08:23.776Z","updated_at":"2017-03-14T21:08:23.776Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541713,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-14T22:22:39.876Z","updated_at":"2017-03-14T22:22:39.876Z","actor":{"username":"dkasak","cleared":true,"url":"/dkasak","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/122/858/df3e45a00fd0f5e53ef7dc7f9b12168cbde93200_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1541714,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-14T22:22:39.919Z","updated_at":"2017-03-14T22:22:39.919Z","actor":{"username":"dkasak","cleared":true,"url":"/dkasak","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/122/858/df3e45a00fd0f5e53ef7dc7f9b12168cbde93200_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}