{"id":193517,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTM1MTc=","url":"https://hackerone.com/reports/193517","title":"attempting double-free using the mruby compiler `mrbc`","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-12-23T00:13:38.306Z","submitted_at":"2016-12-23T00:13:38.306Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"geeknik","url":"/geeknik","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-02-07T01:26:49.578Z","bug_reporter_agreed_on_going_public_at":"2017-02-07T01:26:49.492Z","team_member_agreed_on_going_public_at":"2017-02-07T01:24:59.631Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I cloned the mruby git 4 days ago, started fuzzing with American Fuzzy Lop. This is the 1st crash. \n\n./mrbc test000\n```\ncodegen error:test000:1: too complex expression\n=================================================================\n==12142==ERROR: AddressSanitizer: attempting double-free on 0x60200000d750 in thread T0:\n    #0 0x7f2fd1fd0527 in __interceptor_free (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x54527)\n    #1 0x425788 in mrb_default_allocf /root/mruby/src/state.c:56\n    #2 0x4af31b in mrb_free_symtbl /root/mruby/src/symbol.c:166\n    #3 0x4285b1 in mrb_close /root/mruby/src/state.c:249\n    #4 0x404d48 in cleanup /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:165\n    #5 0x404d48 in main /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:314\n    #6 0x7f2fd18f1b44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n    #7 0x4061c9 (/root/mruby/bin/mrbc+0x4061c9)\n\n0x60200000d750 is located 0 bytes inside of 8-byte region [0x60200000d750,0x60200000d758)\nfreed by thread T0 here:\n    #0 0x7f2fd1fd0527 in __interceptor_free (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x54527)\n    #1 0x425788 in mrb_default_allocf /root/mruby/src/state.c:56\n    #2 0x426867 in mrb_irep_free /root/mruby/src/state.c:162\n    #3 0x4267a9 in mrb_irep_decref /root/mruby/src/state.c:133\n    #4 0x4267a9 in mrb_irep_free /root/mruby/src/state.c:158\n    #5 0x687046 in mrb_generate_code /root/mruby/mrbgems/mruby-compiler/core/codegen.c:2960\n    #6 0x5df3c1 in mrb_load_exec /root/mruby/mrbgems/mruby-compiler/core/parse.y:5732\n    #7 0x5ed6c6 in mrb_load_file_cxt /root/mruby/mrbgems/mruby-compiler/core/parse.y:5764\n    #8 0x4041a1 in load_file /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:220\n    #9 0x4041a1 in main /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:285\n    #10 0x7f2fd18f1b44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n\npreviously allocated by thread T0 here:\n    #0 0x7f2fd1fd09f6 in __interceptor_realloc (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x549f6)\n    #1 0x488211 in mrb_realloc_simple /root/mruby/src/gc.c:201\n    #2 0x488211 in mrb_realloc /root/mruby/src/gc.c:215\n    #3 0x488211 in mrb_malloc /root/mruby/src/gc.c:236\n    #4 0x4acea8 in sym_intern /root/mruby/src/symbol.c:81\n    #5 0x4acea8 in mrb_intern /root/mruby/src/symbol.c:95\n    #6 0x4acea8 in mrb_intern_cstr /root/mruby/src/symbol.c:107\n    #7 0x5de18b in mrb_parser_set_filename /root/mruby/mrbgems/mruby-compiler/core/parse.y:5639\n    #8 0x5eb623 in parser_init_cxt /root/mruby/mrbgems/mruby-compiler/core/parse.y:5467\n    #9 0x5eb623 in mrb_parser_parse /root/mruby/mrbgems/mruby-compiler/core/parse.y:5520\n    #10 0x5ed680 in mrb_parse_file /root/mruby/mrbgems/mruby-compiler/core/parse.y:5679\n    #11 0x5ed680 in mrb_load_file_cxt /root/mruby/mrbgems/mruby-compiler/core/parse.y:5764\n    #12 0x4041a1 in load_file /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:220\n    #13 0x4041a1 in main /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:285\n    #14 0x7f2fd18f1b44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n\nSUMMARY: AddressSanitizer: double-free ??:0 __interceptor_free\n==12142==ABORTING\n```\n\n","vulnerability_information_html":"\u003cp\u003eI cloned the mruby git 4 days ago, started fuzzing with American Fuzzy Lop. This is the 1st crash. \u003c/p\u003e\n\n\u003cp\u003e./mrbc test000\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ecodegen error:test000:1: too complex expression\n=================================================================\n==12142==ERROR: AddressSanitizer: attempting double-free on 0x60200000d750 in thread T0:\n    #0 0x7f2fd1fd0527 in __interceptor_free (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x54527)\n    #1 0x425788 in mrb_default_allocf /root/mruby/src/state.c:56\n    #2 0x4af31b in mrb_free_symtbl /root/mruby/src/symbol.c:166\n    #3 0x4285b1 in mrb_close /root/mruby/src/state.c:249\n    #4 0x404d48 in cleanup /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:165\n    #5 0x404d48 in main /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:314\n    #6 0x7f2fd18f1b44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n    #7 0x4061c9 (/root/mruby/bin/mrbc+0x4061c9)\n\n0x60200000d750 is located 0 bytes inside of 8-byte region [0x60200000d750,0x60200000d758)\nfreed by thread T0 here:\n    #0 0x7f2fd1fd0527 in __interceptor_free (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x54527)\n    #1 0x425788 in mrb_default_allocf /root/mruby/src/state.c:56\n    #2 0x426867 in mrb_irep_free /root/mruby/src/state.c:162\n    #3 0x4267a9 in mrb_irep_decref /root/mruby/src/state.c:133\n    #4 0x4267a9 in mrb_irep_free /root/mruby/src/state.c:158\n    #5 0x687046 in mrb_generate_code /root/mruby/mrbgems/mruby-compiler/core/codegen.c:2960\n    #6 0x5df3c1 in mrb_load_exec /root/mruby/mrbgems/mruby-compiler/core/parse.y:5732\n    #7 0x5ed6c6 in mrb_load_file_cxt /root/mruby/mrbgems/mruby-compiler/core/parse.y:5764\n    #8 0x4041a1 in load_file /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:220\n    #9 0x4041a1 in main /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:285\n    #10 0x7f2fd18f1b44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n\npreviously allocated by thread T0 here:\n    #0 0x7f2fd1fd09f6 in __interceptor_realloc (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x549f6)\n    #1 0x488211 in mrb_realloc_simple /root/mruby/src/gc.c:201\n    #2 0x488211 in mrb_realloc /root/mruby/src/gc.c:215\n    #3 0x488211 in mrb_malloc /root/mruby/src/gc.c:236\n    #4 0x4acea8 in sym_intern /root/mruby/src/symbol.c:81\n    #5 0x4acea8 in mrb_intern /root/mruby/src/symbol.c:95\n    #6 0x4acea8 in mrb_intern_cstr /root/mruby/src/symbol.c:107\n    #7 0x5de18b in mrb_parser_set_filename /root/mruby/mrbgems/mruby-compiler/core/parse.y:5639\n    #8 0x5eb623 in parser_init_cxt /root/mruby/mrbgems/mruby-compiler/core/parse.y:5467\n    #9 0x5eb623 in mrb_parser_parse /root/mruby/mrbgems/mruby-compiler/core/parse.y:5520\n    #10 0x5ed680 in mrb_parse_file /root/mruby/mrbgems/mruby-compiler/core/parse.y:5679\n    #11 0x5ed680 in mrb_load_file_cxt /root/mruby/mrbgems/mruby-compiler/core/parse.y:5764\n    #12 0x4041a1 in load_file /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:220\n    #13 0x4041a1 in main /root/mruby/mrbgems/mruby-bin-mrbc/tools/mrbc/mrbc.c:285\n    #14 0x7f2fd18f1b44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n\nSUMMARY: AddressSanitizer: double-free ??:0 __interceptor_free\n==12142==ABORTING\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","bounty_amount":"800.0","formatted_bounty":"$800","weakness":{"id":2,"name":"Memory Corruption - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":146392,"file_name":"test000.gz","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/146/392/9e3a77dd30bc10f2ed227a6e9518112490738259/test000.gz?response-content-disposition=attachment%3B%20filename%3D%22test000.gz%22%3B%20filename%2A%3DUTF-8%27%27test000.gz\u0026response-content-type=application%2Fgzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVN4C5GIR%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T045028Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCICjdrX7ABZ%2BvfX76vY4hAT36HAFa7ABTRFnFNWlME3RsAiA6spUqHGGbpGIJMpDYYPRLrN21uLj3JvPgDLV04KLXWCq0AwhSEAEaDDAxMzYxOTI3NDg0OSIM%2BwbYtZgzO0HRNuilKpED0QRzghA3dQ82LDNvNHg%2F%2Bapjkbzzquj0OQyaslf6lhZ6ae5aaEALaU1htc90%2FTkEnCjK7YAB%2BOOqYauHnXFwgnicH8P2qB1b6qq8ByPdiyv%2F6FeKLaeKEKd1ked0wxhxGILfvv9geWvP9kPkCkrnpW%2Bk3I2nWFhXQ59oSwcUQzXUMoZ0agtptlqAo0vIB0BQ8w3QdM1eyZALy%2Fa2aEoAk0NEEkFhGgVq6y7NSlne0HYNYsnTubU1gtBiWgKFN75WWxAKzP41DZr9biaTv2LpKz%2BS54%2B0D7gM01Pv9DWNFSxduldCjFNWMHaz53TpINKZivByzZ%2FZritkdAHNoYR8NUHdDo4fG9KADtaMgItKYoCYS9dQ3VQKUnEB%2FG5XIqiEWJNuiVPw9Xo1zZJ7ItciKJ%2F2lZOYbSY5IWLtOLK3LAXfBln%2BqWM6KN%2BYSgAqj80OMMoKJozuCJRCLPgT%2BsuXVxgkfPMjWm0msUwRdOuNqAG3PPIFx7Qi20ur1fS33s63LIR24RY3pe1aeEm14DkixQAwqvyp%2FwU67AFUTZKxgkosuC9%2FFnLTDWAcFKkGbWeTSyQlX9WvARJtmEGSKKE3O3RCz4o1fvK2y8cIWG4ZDqIQnnY30DkA5lvQ1S96196eUcIlxUE3IU6WzlYzirsAJvCXzxdcKxl0gn59sA3vLFJkUTgoas7IMyJTtRG6%2B0%2BVBuYKCHqJR1eTwSQxZvSP%2Bzn9VyHRQJZnA1hWcpkteF706gKj%2FXnieX9VW%2FOBOoEUExU1kfEmA0ZpoQRXSm8ma7vzsQoYhwoevAvKutaOvkhM8WM71tgT1%2FjC27FmA%2F%2FsDsAjQs2Rv9IujFElYACO0n6OSheOZw%3D%3D\u0026X-Amz-Signature=d66acf3ce0cd9df5b4733078269eff27d1a534cfc489daa187c4342a52632164","file_size":291,"type":"application/gzip"}],"allow_singular_disclosure_at":"2017-03-09T01:24:59.661Z","allow_singular_disclosure_after":-120194728.970493,"singular_disclosure_allowed":true,"vote_count":6,"voters":["icanthack","mpz","eveeez","geeknik","spetr0x","roh_tester"],"severity":{"rating":"high","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1382857,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the holiday period and the large volume of reports we have received, it may take us up to three weeks to respond. Thank you for your patience!","markdown_message":"\u003cp\u003eThank you for reporting this bug! This is an automated response to let you know that we\u0026#39;ve received your issue, and we\u0026#39;ll process it as soon as possible.\u003c/p\u003e\n\n\u003cp\u003eDue to the holiday period and the large volume of reports we have received, it may take us up to three weeks to respond. Thank you for your patience!\u003c/p\u003e\n","automated_response":true,"created_at":"2016-12-23T00:13:38.518Z","updated_at":"2016-12-23T00:13:38.518Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1404318,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We've reproduced the issue, and opened an issue upstream: https://github.com/mruby/mruby/issues/3378","markdown_message":"\u003cp\u003eThank you for your report. We\u0026#39;ve reproduced the issue, and opened an issue upstream: \u003ca title=\"https://github.com/mruby/mruby/issues/3378\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fissues%2F3378\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/issues/3378\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-06T15:49:15.149Z","updated_at":"2017-01-06T15:49:15.149Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1438958,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. This issue has been resolved upstream in https://github.com/mruby/mruby/commit/f0f095bc135c4d2e6f6d54d6b5683db77708369b\n\nOur next round of bounty decisions will take place within two weeks, so we'll be in touch with you again soon.","markdown_message":"\u003cp\u003eThanks again for your report. This issue has been resolved upstream in \u003ca title=\"https://github.com/mruby/mruby/commit/f0f095bc135c4d2e6f6d54d6b5683db77708369b\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fcommit%2Ff0f095bc135c4d2e6f6d54d6b5683db77708369b\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/commit/f0f095bc135c4d2e6f6d54d6b5683db77708369b\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eOur next round of bounty decisions will take place within two weeks, so we\u0026#39;ll be in touch with you again soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-23T18:41:32.901Z","updated_at":"2017-01-23T18:41:32.901Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"geeknik","url":"/geeknik"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1467339,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Mruby and Shopify Scripts!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Mruby and Shopify Scripts!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-07T01:24:53.754Z","updated_at":"2017-02-07T01:24:53.754Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"geeknik","url":"/geeknik"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1467340,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-07T01:24:59.646Z","updated_at":"2017-02-07T01:24:59.646Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1467355,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"My pleasure Andrew. Thank you for the bounty!","markdown_message":"\u003cp\u003eMy pleasure Andrew. Thank you for the bounty!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-07T01:26:49.533Z","updated_at":"2017-02-07T01:26:49.533Z","actor":{"username":"geeknik","cleared":true,"url":"/geeknik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1467356,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-07T01:26:49.598Z","updated_at":"2017-02-07T01:26:49.598Z","actor":{"username":"geeknik","cleared":true,"url":"/geeknik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}