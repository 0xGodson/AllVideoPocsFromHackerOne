{"id":498845,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80OTg4NDU=","url":"https://hackerone.com/reports/498845","title":"A small set of users were assigned someone else's payout preference","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2019-02-20T20:09:49.042Z","submitted_at":"2019-02-20T20:09:49.042Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jobert","url":"/jobert","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-02-20T21:38:34.418Z","bug_reporter_agreed_on_going_public_at":"2019-02-20T21:38:34.318Z","team_member_agreed_on_going_public_at":"2019-02-20T21:37:32.460Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"On December 20th, 2016, HackerOne introduced a new payout preference that allowed employee bounties to be paid through payroll. At the time, a feature was added to our support backend that allowed the IT department to provision this special payout preference for HackerOne employees. To help the IT team, the Engineering team wrote a data migration to provision the payout preference for all current HackerOne employees. During this migration, an incorrect assumption was made that caused the payout preference to be provisioned for non-HackerOne employees.\n\nHackerOne identified the discrepancy on February 19, 2019 and resolved it on February 20, 2019. No users were notified because none of them received any bounties and it only disclosed HackerOne employees' corporate email address. Twelve (12) users were affected.\n\n# Root Cause\nHackerOne's payments service is a separate system that takes care of receiving money from customers and sending it to people everywhere around the world. This service is separated from the core platform.\n\nBoth systems have a concept of a **User**. In the payments backend it identifies a natural person that holds information like a tax form, payout preferences, payouts, OFAC checks, etc. In the main platform it identifies any user that can sign into the platform. Both models are identified by an auto incrementing integer. These IDs were never intended to be identical, which is why the platform's **User** model contains a reference to the payments service **User** model.\n\nUp until April 2016 these IDs were always identical. For every user that signed up for hackerone.com an API call would create a **User** object in the payments service. When the [HackerOne API](https://api.hackerone.com) publicly launched, **User** objects would be created in the core platform that would not have a corresponding **User** object in the payments backend because they are not able to receive bounties. This is when the primary keys of the tables started to diverge.\n\nIn December 2016, when the payroll feature was rolled out, a data migration was executed to create the new payout preferences in the payments backend. This payout preference was set as the default for these users and blocked the users from updating it. A list of users was queried from the core platform, which was needed because the core platform holds information about whether someone is an employee or not. This query generated a list of primary keys of users in the core platform. This list was then used to create the payout preferences.\n\nHowever, because the first query used the core platform's user IDs instead of the payment service user IDs, the wrong primary keys were used to assign the payout preferences to the user. HackerOne employees that joined between April 2016 and December 2016 were incorrectly identified, resulting in non-HackerOne employees getting a HackerOne employee's payout preference. Twelve (12) users were affected.\n\nAll code changes go through mandatory code review at HackerOne. Because information from two separate systems had to be synchronized, a decision was made to manually run the data migration on a production console. This bypassed the mandatory code review. A code review from people more familiar with the integration might've caught the minor mistake in the data migration.\n\n# Resolution and Recovery\nThe affected users were identified and a data migration was executed to reassign the original payout preference to the user. The payroll payout preference was removed from the users to avoid that they'd be able to access the corporate email address assigned to their account.\n\n# Impact on Data\nIf the affected users would've received a bounty, it would've been send to a HackerOne employee instead of the user. These users would've also been able to see the HackerOne employee's corporate email address. Even though these payments are exported manually, we were not completely confident that we would've caught this in the export file. None of the users received a bounty and there is no evidence that the users accessed the HackerOne employees' corporate email address that was assigned to their account.\n\n# Preventative Measures\nA lot of improvements have been made since December 2016 that would've prevented the mistakes if it were to happen today. Some notable changes have been listed below.\n\n* The payments backend API has been significantly improved, which removed the need to query information from two separate systems.\n* Console access has been significantly limited and is currently being phased out completely.\n* Alerting has been put in place for code executed on a production console.\n* A user is notified when its default payout preference is updated, which would've caught this error sooner.\n\n## Impact\n\nSee above post mortem.","vulnerability_information_html":"\u003cp\u003eOn December 20th, 2016, HackerOne introduced a new payout preference that allowed employee bounties to be paid through payroll. At the time, a feature was added to our support backend that allowed the IT department to provision this special payout preference for HackerOne employees. To help the IT team, the Engineering team wrote a data migration to provision the payout preference for all current HackerOne employees. During this migration, an incorrect assumption was made that caused the payout preference to be provisioned for non-HackerOne employees.\u003c/p\u003e\n\n\u003cp\u003eHackerOne identified the discrepancy on February 19, 2019 and resolved it on February 20, 2019. No users were notified because none of them received any bounties and it only disclosed HackerOne employees\u0026#39; corporate email address. Twelve (12) users were affected.\u003c/p\u003e\n\n\u003ch1 id=\"root-cause\"\u003eRoot Cause\u003c/h1\u003e\n\n\u003cp\u003eHackerOne\u0026#39;s payments service is a separate system that takes care of receiving money from customers and sending it to people everywhere around the world. This service is separated from the core platform.\u003c/p\u003e\n\n\u003cp\u003eBoth systems have a concept of a \u003cstrong\u003eUser\u003c/strong\u003e. In the payments backend it identifies a natural person that holds information like a tax form, payout preferences, payouts, OFAC checks, etc. In the main platform it identifies any user that can sign into the platform. Both models are identified by an auto incrementing integer. These IDs were never intended to be identical, which is why the platform\u0026#39;s \u003cstrong\u003eUser\u003c/strong\u003e model contains a reference to the payments service \u003cstrong\u003eUser\u003c/strong\u003e model.\u003c/p\u003e\n\n\u003cp\u003eUp until April 2016 these IDs were always identical. For every user that signed up for hackerone.com an API call would create a \u003cstrong\u003eUser\u003c/strong\u003e object in the payments service. When the \u003ca href=\"/redirect?url=https%3A%2F%2Fapi.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eHackerOne API\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e publicly launched, \u003cstrong\u003eUser\u003c/strong\u003e objects would be created in the core platform that would not have a corresponding \u003cstrong\u003eUser\u003c/strong\u003e object in the payments backend because they are not able to receive bounties. This is when the primary keys of the tables started to diverge.\u003c/p\u003e\n\n\u003cp\u003eIn December 2016, when the payroll feature was rolled out, a data migration was executed to create the new payout preferences in the payments backend. This payout preference was set as the default for these users and blocked the users from updating it. A list of users was queried from the core platform, which was needed because the core platform holds information about whether someone is an employee or not. This query generated a list of primary keys of users in the core platform. This list was then used to create the payout preferences.\u003c/p\u003e\n\n\u003cp\u003eHowever, because the first query used the core platform\u0026#39;s user IDs instead of the payment service user IDs, the wrong primary keys were used to assign the payout preferences to the user. HackerOne employees that joined between April 2016 and December 2016 were incorrectly identified, resulting in non-HackerOne employees getting a HackerOne employee\u0026#39;s payout preference. Twelve (12) users were affected.\u003c/p\u003e\n\n\u003cp\u003eAll code changes go through mandatory code review at HackerOne. Because information from two separate systems had to be synchronized, a decision was made to manually run the data migration on a production console. This bypassed the mandatory code review. A code review from people more familiar with the integration might\u0026#39;ve caught the minor mistake in the data migration.\u003c/p\u003e\n\n\u003ch1 id=\"resolution-and-recovery\"\u003eResolution and Recovery\u003c/h1\u003e\n\n\u003cp\u003eThe affected users were identified and a data migration was executed to reassign the original payout preference to the user. The payroll payout preference was removed from the users to avoid that they\u0026#39;d be able to access the corporate email address assigned to their account.\u003c/p\u003e\n\n\u003ch1 id=\"impact-on-data\"\u003eImpact on Data\u003c/h1\u003e\n\n\u003cp\u003eIf the affected users would\u0026#39;ve received a bounty, it would\u0026#39;ve been send to a HackerOne employee instead of the user. These users would\u0026#39;ve also been able to see the HackerOne employee\u0026#39;s corporate email address. Even though these payments are exported manually, we were not completely confident that we would\u0026#39;ve caught this in the export file. None of the users received a bounty and there is no evidence that the users accessed the HackerOne employees\u0026#39; corporate email address that was assigned to their account.\u003c/p\u003e\n\n\u003ch1 id=\"preventative-measures\"\u003ePreventative Measures\u003c/h1\u003e\n\n\u003cp\u003eA lot of improvements have been made since December 2016 that would\u0026#39;ve prevented the mistakes if it were to happen today. Some notable changes have been listed below.\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe payments backend API has been significantly improved, which removed the need to query information from two separate systems.\u003c/li\u003e\n\u003cli\u003eConsole access has been significantly limited and is currently being phased out completely.\u003c/li\u003e\n\u003cli\u003eAlerting has been put in place for code executed on a production console.\u003c/li\u003e\n\u003cli\u003eA user is notified when its default payout preference is updated, which would\u0026#39;ve caught this error sooner.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eSee above post mortem.\u003c/p\u003e\n","weakness":{"id":46,"name":"Privacy Violation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-03-22T21:37:32.694Z","allow_singular_disclosure_after":-55931492.56768076,"singular_disclosure_allowed":true,"vote_count":30,"voters":["jobert","sameerphad72","testert1ng","mygf","cswiers","r3y","lordjerry0x01","an0nym0us","kunal94","what_web","and 20 more..."],"severity":{"rating":"low","score":2.7,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"high","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":3,"asset_type":"URL","asset_identifier":"https://hackerone.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":4182364,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-20T20:10:15.316Z","updated_at":"2019-02-20T20:10:15.316Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4182747,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-20T21:37:19.291Z","updated_at":"2019-02-20T21:37:19.291Z","actor":{"username":"bencode","cleared":false,"url":"/bencode","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/117/ddaa1da4e004e1234c6857c42f9bfa8df85b5ccf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"jobert","url":"/jobert"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4182749,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-20T21:37:32.535Z","updated_at":"2019-02-20T21:37:32.535Z","first_to_agree":true,"actor":{"username":"bencode","cleared":false,"url":"/bencode","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/117/ddaa1da4e004e1234c6857c42f9bfa8df85b5ccf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4182753,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"This report was submitted by a HackerOne employee and therefor isn't eligible for a bounty and reputation.","markdown_message":"\u003cp\u003eThis report was submitted by a HackerOne employee and therefor isn\u0026#39;t eligible for a bounty and reputation.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-20T21:38:23.851Z","updated_at":"2019-02-20T21:38:23.851Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"HackerOne"}},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4182754,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-20T21:38:34.343Z","updated_at":"2019-02-20T21:38:34.343Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4182755,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-20T21:38:34.444Z","updated_at":"2019-02-20T21:38:34.444Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}