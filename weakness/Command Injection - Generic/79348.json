{"id":79348,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83OTM0OA==","url":"https://hackerone.com/reports/79348","title":"OSX slack:// protocol handler javascript injection","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-07-29T05:47:55.388Z","submitted_at":"2015-07-29T05:47:55.388Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"computerality","url":"/computerality","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":69,"url":"https://hackerone.com/slack","handle":"slack","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Slack","twitter_handle":"slackhq","website":"https://slack.com","about":"All your team communication in one place, instantly searchable, and available wherever you go."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-06-24T16:17:17.826Z","bug_reporter_agreed_on_going_public_at":"2016-05-25T16:17:08.565Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The Mac Slack app version 1.1 introduced the slack:// protocol handler. Due to improper input sanitization, arbitrary Javascript code can be run in the context of the client app if the user clicks on a slack:// link on a website or email. I have confirmed this issue still exists in the 1.1.1 release.\r\n\r\nPoC\r\n=== \r\nIf a user clicks this link, a message will be posted on their behalf to their general channel.\r\n    \u003ca href=\"slack://test?team=1\u0026a=');eval(atob('VFNTU0Iuc2VuZE1zZ0Zyb21Vc2VyKHdpbmRvdy5UUy5jaGFubmVscy5nZXRHZW5lcmFsQ2hhbm5lbCgpLmlkLCAiSGVsbG8sIEkgYW0gcHJvb2Ygb2YganMgaW5qZWN0aW9uIik7'));String('\"\u003eClick me for a good time\u003c/a\u003e\r\n\r\nor go to http://computerality.com/t/slack_report.html\r\n\r\nThe example javascript that is run in the context of the client app is:\r\n    TSSSB.sendMsgFromUser(window.TS.channels.getGeneralChannel().id, \"Hello, I am proof of js injection\");\r\n\r\nDetails\r\n======\r\nThe Objective-C function responsible for handling the scheme processing is:\r\n -[SLAppDelegate handleURLEvent:withReplyEvent:]\r\n\r\nThe argument is passed into the format string: \"TSSSB.handleDeepLink(‘%@‘);”. Then the resulting string is evaluated in javascript via the stringByEvaluatingJavaScriptFromString method call.\r\n\r\nAn attempt is made to sanitize input by calling stringByAddingPercentEscapesUsingEncoding. This function will perform escaping of certain characters but leave the single quote character unmodified.\r\n\r\nIn the PoC link, the team argument is set to any value. When an invalid team id is used, a popup appears but the rest of the Javascript still runs. Next, the a parameter is processed. We escape and end the TSSSB.handleDeepLink() function call. Next we want to run arbitrary Javascript without having any spaces. To do this, we use the base64 decoding function atob() and call eval() on the result. Finally, the Javascript needs to continue to be valid so we create an unused object using the String constructor.\r\n\r\nIf you have any other questions or if anything needs clarification, please let me know.\r\n\r\nThanks!\r\n\r\n-Jay","vulnerability_information_html":"\u003cp\u003eThe Mac Slack app version 1.1 introduced the slack:// protocol handler. Due to improper input sanitization, arbitrary Javascript code can be run in the context of the client app if the user clicks on a slack:// link on a website or email. I have confirmed this issue still exists in the 1.1.1 release.\u003c/p\u003e\n\n\u003ch1 id=\"poc\"\u003ePoC\u003c/h1\u003e\n\n\u003cp\u003eIf a user clicks this link, a message will be posted on their behalf to their general channel.\u003cbr\u003e\n    \u0026lt;a href=\u0026quot;slack://test?team=1\u0026amp;a=\u0026#39;);eval(atob(\u0026#39;VFNTU0Iuc2VuZE1zZ0Zyb21Vc2VyKHdpbmRvdy5UUy5jaGFubmVscy5nZXRHZW5lcmFsQ2hhbm5lbCgpLmlkLCAiSGVsbG8sIEkgYW0gcHJvb2Ygb2YganMgaW5qZWN0aW9uIik7\u0026#39;));String(\u0026#39;\u0026quot;\u0026gt;Click me for a good time\u0026lt;/a\u0026gt;\u003c/p\u003e\n\n\u003cp\u003eor go to \u003ca title=\"http://computerality.com/t/slack_report.html\" href=\"/redirect?url=http%3A%2F%2Fcomputerality.com%2Ft%2Fslack_report.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://computerality.com/t/slack_report.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe example javascript that is run in the context of the client app is:\u003cbr\u003e\n    TSSSB.sendMsgFromUser(window.TS.channels.getGeneralChannel().id, \u0026quot;Hello, I am proof of js injection\u0026quot;);\u003c/p\u003e\n\n\u003ch1 id=\"details\"\u003eDetails\u003c/h1\u003e\n\n\u003cp\u003eThe Objective-C function responsible for handling the scheme processing is:\u003cbr\u003e\n -[SLAppDelegate handleURLEvent:withReplyEvent:]\u003c/p\u003e\n\n\u003cp\u003eThe argument is passed into the format string: \u0026quot;TSSSB.handleDeepLink(‘%@‘);”. Then the resulting string is evaluated in javascript via the stringByEvaluatingJavaScriptFromString method call.\u003c/p\u003e\n\n\u003cp\u003eAn attempt is made to sanitize input by calling stringByAddingPercentEscapesUsingEncoding. This function will perform escaping of certain characters but leave the single quote character unmodified.\u003c/p\u003e\n\n\u003cp\u003eIn the PoC link, the team argument is set to any value. When an invalid team id is used, a popup appears but the rest of the Javascript still runs. Next, the a parameter is processed. We escape and end the TSSSB.handleDeepLink() function call. Next we want to run arbitrary Javascript without having any spaces. To do this, we use the base64 decoding function atob() and call eval() on the result. Finally, the Javascript needs to continue to be valid so we create an unused object using the String constructor.\u003c/p\u003e\n\n\u003cp\u003eIf you have any other questions or if anything needs clarification, please let me know.\u003c/p\u003e\n\n\u003cp\u003eThanks!\u003c/p\u003e\n\n\u003cp\u003e-Jay\u003c/p\u003e\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-06-24T16:17:08.757Z","allow_singular_disclosure_after":-142439823.14163628,"singular_disclosure_allowed":true,"vote_count":71,"voters":["lukasreschke","dirk","jokebookservice1","tomdev","fransrosen","jobert","harisec","hunter","michiel","wkcaj","and 61 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":529597,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2015-07-29T06:42:36.038Z","updated_at":"2015-07-29T06:42:36.038Z","actor":{"username":"leighhoneywell","cleared":false,"url":"/leighhoneywell","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/411/956aec0fd38fb8e9577a2f87a2d5e33ee4eb8a9e_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":529599,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Jay! Thanks for the report. We've been able to reproduce this bug and are investigating a comprehensive fix.","markdown_message":"\u003cp\u003eHi Jay! Thanks for the report. We\u0026#39;ve been able to reproduce this bug and are investigating a comprehensive fix.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-07-29T06:44:37.851Z","updated_at":"2015-07-29T06:44:37.851Z","actor":{"username":"leighhoneywell","cleared":false,"url":"/leighhoneywell","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/411/956aec0fd38fb8e9577a2f87a2d5e33ee4eb8a9e_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":536398,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey, it looks like the issue I reported has been fixed with the 1.1.2 release. I checked the function again and didn't see additional injections.","markdown_message":"\u003cp\u003eHey, it looks like the issue I reported has been fixed with the 1.1.2 release. I checked the function again and didn\u0026#39;t see additional injections.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-08-03T22:02:51.323Z","updated_at":"2015-08-03T22:02:51.323Z","actor":{"username":"computerality","cleared":false,"url":"/computerality","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":552985,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, since this is now fixed, would it qualify for a bounty award? Thanks.","markdown_message":"\u003cp\u003eHi, since this is now fixed, would it qualify for a bounty award? Thanks.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-08-18T14:30:42.613Z","updated_at":"2015-08-18T14:30:42.613Z","actor":{"username":"computerality","cleared":false,"url":"/computerality","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":553312,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hey Jay! Thanks for your patience. This was a great bug so I'm happy to award you $1000.","markdown_message":"\u003cp\u003eHey Jay! Thanks for your patience. This was a great bug so I\u0026#39;m happy to award you $1000.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-08-18T18:52:28.087Z","updated_at":"2015-08-18T18:52:28.087Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Slack"}},"bounty_amount":"1000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"slack","collaborator":{"username":"computerality","url":"/computerality"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":553314,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2015-08-18T18:52:44.291Z","updated_at":"2015-08-18T18:52:44.291Z","actor":{"username":"leighhoneywell","cleared":false,"url":"/leighhoneywell","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/411/956aec0fd38fb8e9577a2f87a2d5e33ee4eb8a9e_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"computerality","url":"/computerality"},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":983277,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"This was a fixed a while ago and I think it would be a valuable pattern for the public to learn about.","markdown_message":"\u003cp\u003eThis was a fixed a while ago and I think it would be a valuable pattern for the public to learn about.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-05-25T16:17:08.614Z","updated_at":"2016-05-25T16:17:08.614Z","first_to_agree":true,"actor":{"username":"computerality","cleared":false,"url":"/computerality","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1035650,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-06-24T16:17:18.093Z","updated_at":"2016-06-24T16:17:18.093Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}