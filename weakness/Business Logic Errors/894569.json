{"id":894569,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84OTQ1Njk=","url":"https://hackerone.com/reports/894569","title":"An attacker can run pipeline jobs as arbitrary user","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2020-06-09T15:53:22.000Z","submitted_at":"2020-06-09T15:53:22.000Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"u3mur4","url":"/u3mur4","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-26T14:11:44.351Z","bug_reporter_agreed_on_going_public_at":"2020-08-17T05:35:38.057Z","team_member_agreed_on_going_public_at":"2020-08-26T14:11:44.225Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nAn attacker can run arbitrary pipeline jobs as a `victim` user. This means the attacker can access the user private repositories, member only repositories, registry, etc... by using the victim `CI_JOB_TOKEN` token.\n\n\u003e This is only my recent research and I wanted to report it as soon as possible. I will update the report with more information later on.\n\n### Steps to reproduce\n\nVICTIM:\n\n- Sign in to a GitLab instance as a *Victim user*\n- Create an arbitrary private repository with some private files. (We will steal this repo as a poc.)\n\nATTACKER ACCOUNT 1: \n\n- Sign in to a GitLab instance as a *Attacker1 user*\n- Create a new project using the following settings:\n    - Project Name: `poc`\n    - Visibility Level : `public`\n    - Check the `Initialize repository with a README` checkbox\n- Add a new `.gitlab-ci.yml` file to the project\n\n```\nimage: \"ruby:2.6\"\n\nbefore_script:\n  - echo Hello\n\nrspec:\n  script:\n    - echo Hello\n```\n\n\u003e We will mirror this repository and update the `.gitlab-ci.yml` file later on to trigger the CI/CD job.\n\nATTACKER ACCOUNT 2: \n- Sign in / Register to a GitLab instance as a *Attacker2 user*\n- Create a new public group called as `test`\n- Create a new project inside the `test` group using the following settings:\n    - Project Name: `poc`\n    - Visibility Level : `public`\n- Go to `Project settings` =\u003e `Repository` =\u003e `Mirroring repositories`\n    - Set `Git repository URL` to the previously created repository by the *Attacker1 user*\n    - Set `Mirror direction` to `Pull`\n    - Check the `Trigger pipelines for mirror updates` checkbox\n    - Click the `Mirror repository` button\n- Go to the `test` group `Members` option and invite the *Victim user*\n- Set the *Victim user* `Choose a role permission` to `Owner`\n- Go to the `Account Setting` =\u003e `Account` and delete this account.\n\nATTACKER ACCOUNT 1: \n\n- Sign in back to the GitLab instance as a *Attacker1 user*\n- Go to the `attacker1/poc` project and update the `.gitlab-ci.yml` file using the following content:\n\n```\nimage: \"ruby:2.6\"\n\nrspec:\n  script:\n    - git clone https://gitlab-ci-token:$CI_JOB_TOKEN@gitlab.com/victim/private_repo_name.git\n    - cd private_repo_name\n    - ls -lah .\n    - cat README.md\n```\n- Wait half an hour to automatically trigger a mirror update in the `test/poc` project which owner is the *Victim user*.\n\nThe `test/poc` project will trigger a mirror update which also triggers a pipeline run. The triggerer of the pipeline will be the *Victim user*. \nThe *Attacker1 user* controls the `attacker/poc/gitlab-ci.yml` file which is mirrored to the `test/poc` project.\n\n\n### What is the current *bug* behavior?\n\n- If there is a mirrored project with `Trigger pipelines for mirror updates` enabled inside a group and the group owner delete its account (need another owner role inside the group) then the trigger of the pipeline will be to other owner account. (I think this only works when the account deleted without removing the account from the group members but I still need to confirm this.)\n\n### What is the expected *correct* behavior?\n\n- refuse pipeline run in the previously mentioned case\n\n### Output of checks\n\nThis bug happens on GitLab.com.\n\n#### Results of GitLab environment info\n```\nbundle exec rake gitlab:env:info RAILS_ENV=development\nSystem information\nSystem:\t\t\nProxy:\t\tno\nCurrent User:\tu3mur4\nUsing RVM:\tno\nRuby Version:\t2.6.6p146\nGem Version:\t3.0.3\nBundler Version:1.17.3\nRake Version:\t12.3.3\nRedis Version:\t6.0.4\nGit Version:\t2.27.0\nSidekiq Version:5.2.7\nGo Version:\tgo1.14.4 linux/amd64\n\nGitLab information\nVersion:\t13.1.0-pre\nRevision:\t4bd9f8164e0\nDirectory:\t/home/u3mur4/Hack/gitlab/gitlab-development-kit/gitlab\nDB Adapter:\tPostgreSQL\nDB Version:\t12.3\nURL:\t\thttp://gdk.yoyo.pw:3000\nHTTP Clone URL:\thttp://gdk.yoyo.pw:3000/some-group/some-project.git\nSSH Clone URL:\tssh://u3mur4@gdk.yoyo.pw:2222/some-group/some-project.git\nElasticsearch:\tno\nGeo:\t\tno\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers: google_oauth2\n\nGitLab Shell\nVersion:\t13.3.0\nRepository storage paths:\n- default: \t/home/u3mur4/Hack/gitlab/gitlab-development-kit/repositories\nGitLab Shell path:\t\t/home/u3mur4/Hack/gitlab/gitlab-development-kit/gitlab-shell\nGit:\t\t/usr/bin/git\n```\n\n## Impact\n\nstealing the CI_JOB_TOKEN of any user (access the user private repositories, member only repositories and registry, etc...)","vulnerability_information_html":"\u003ch3 id=\"summary\"\u003eSummary\u003c/h3\u003e\n\n\u003cp\u003eAn attacker can run arbitrary pipeline jobs as a \u003ccode\u003evictim\u003c/code\u003e user. This means the attacker can access the user private repositories, member only repositories, registry, etc... by using the victim \u003ccode\u003eCI_JOB_TOKEN\u003c/code\u003e token.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThis is only my recent research and I wanted to report it as soon as possible. I will update the report with more information later on.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch3 id=\"steps-to-reproduce\"\u003eSteps to reproduce\u003c/h3\u003e\n\n\u003cp\u003eVICTIM:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSign in to a GitLab instance as a \u003cem\u003eVictim user\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate an arbitrary private repository with some private files. (We will steal this repo as a poc.)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eATTACKER ACCOUNT 1: \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSign in to a GitLab instance as a \u003cem\u003eAttacker1 user\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate a new project using the following settings:\n\n\u003cul\u003e\n\u003cli\u003eProject Name: \u003ccode\u003epoc\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eVisibility Level : \u003ccode\u003epublic\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eCheck the \u003ccode\u003eInitialize repository with a README\u003c/code\u003e checkbox\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAdd a new \u003ccode\u003e.gitlab-ci.yml\u003c/code\u003e file to the project\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eimage: \u0026quot;ruby:2.6\u0026quot;\n\nbefore_script:\n  - echo Hello\n\nrspec:\n  script:\n    - echo Hello\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWe will mirror this repository and update the \u003ccode\u003e.gitlab-ci.yml\u003c/code\u003e file later on to trigger the CI/CD job.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eATTACKER ACCOUNT 2: \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSign in / Register to a GitLab instance as a \u003cem\u003eAttacker2 user\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate a new public group called as \u003ccode\u003etest\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate a new project inside the \u003ccode\u003etest\u003c/code\u003e group using the following settings:\n\n\u003cul\u003e\n\u003cli\u003eProject Name: \u003ccode\u003epoc\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eVisibility Level : \u003ccode\u003epublic\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eGo to \u003ccode\u003eProject settings\u003c/code\u003e =\u0026gt; \u003ccode\u003eRepository\u003c/code\u003e =\u0026gt; \u003ccode\u003eMirroring repositories\u003c/code\u003e\n\n\u003cul\u003e\n\u003cli\u003eSet \u003ccode\u003eGit repository URL\u003c/code\u003e to the previously created repository by the \u003cem\u003eAttacker1 user\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eSet \u003ccode\u003eMirror direction\u003c/code\u003e to \u003ccode\u003ePull\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eCheck the \u003ccode\u003eTrigger pipelines for mirror updates\u003c/code\u003e checkbox\u003c/li\u003e\n\u003cli\u003eClick the \u003ccode\u003eMirror repository\u003c/code\u003e button\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eGo to the \u003ccode\u003etest\u003c/code\u003e group \u003ccode\u003eMembers\u003c/code\u003e option and invite the \u003cem\u003eVictim user\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eSet the \u003cem\u003eVictim user\u003c/em\u003e \u003ccode\u003eChoose a role permission\u003c/code\u003e to \u003ccode\u003eOwner\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eGo to the \u003ccode\u003eAccount Setting\u003c/code\u003e =\u0026gt; \u003ccode\u003eAccount\u003c/code\u003e and delete this account.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eATTACKER ACCOUNT 1: \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSign in back to the GitLab instance as a \u003cem\u003eAttacker1 user\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eGo to the \u003ccode\u003eattacker1/poc\u003c/code\u003e project and update the \u003ccode\u003e.gitlab-ci.yml\u003c/code\u003e file using the following content:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eimage: \u0026quot;ruby:2.6\u0026quot;\n\nrspec:\n  script:\n    - git clone https://gitlab-ci-token:$CI_JOB_TOKEN@gitlab.com/victim/private_repo_name.git\n    - cd private_repo_name\n    - ls -lah .\n    - cat README.md\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eWait half an hour to automatically trigger a mirror update in the \u003ccode\u003etest/poc\u003c/code\u003e project which owner is the \u003cem\u003eVictim user\u003c/em\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe \u003ccode\u003etest/poc\u003c/code\u003e project will trigger a mirror update which also triggers a pipeline run. The triggerer of the pipeline will be the \u003cem\u003eVictim user\u003c/em\u003e. \u003cbr\u003e\nThe \u003cem\u003eAttacker1 user\u003c/em\u003e controls the \u003ccode\u003eattacker/poc/gitlab-ci.yml\u003c/code\u003e file which is mirrored to the \u003ccode\u003etest/poc\u003c/code\u003e project.\u003c/p\u003e\n\n\u003ch3 id=\"what-is-the-current-bug-behavior\"\u003eWhat is the current \u003cem\u003ebug\u003c/em\u003e behavior?\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eIf there is a mirrored project with \u003ccode\u003eTrigger pipelines for mirror updates\u003c/code\u003e enabled inside a group and the group owner delete its account (need another owner role inside the group) then the trigger of the pipeline will be to other owner account. (I think this only works when the account deleted without removing the account from the group members but I still need to confirm this.)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"what-is-the-expected-correct-behavior\"\u003eWhat is the expected \u003cem\u003ecorrect\u003c/em\u003e behavior?\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003erefuse pipeline run in the previously mentioned case\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"output-of-checks\"\u003eOutput of checks\u003c/h3\u003e\n\n\u003cp\u003eThis bug happens on GitLab.com.\u003c/p\u003e\n\n\u003ch4 id=\"results-of-gitlab-environment-info\"\u003eResults of GitLab environment info\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ebundle exec rake gitlab:env:info RAILS_ENV=development\nSystem information\nSystem:     \nProxy:      no\nCurrent User:   u3mur4\nUsing RVM:  no\nRuby Version:   2.6.6p146\nGem Version:    3.0.3\nBundler Version:1.17.3\nRake Version:   12.3.3\nRedis Version:  6.0.4\nGit Version:    2.27.0\nSidekiq Version:5.2.7\nGo Version: go1.14.4 linux/amd64\n\nGitLab information\nVersion:    13.1.0-pre\nRevision:   4bd9f8164e0\nDirectory:  /home/u3mur4/Hack/gitlab/gitlab-development-kit/gitlab\nDB Adapter: PostgreSQL\nDB Version: 12.3\nURL:        http://gdk.yoyo.pw:3000\nHTTP Clone URL: http://gdk.yoyo.pw:3000/some-group/some-project.git\nSSH Clone URL:  ssh://u3mur4@gdk.yoyo.pw:2222/some-group/some-project.git\nElasticsearch:  no\nGeo:        no\nUsing LDAP: no\nUsing Omniauth: yes\nOmniauth Providers: google_oauth2\n\nGitLab Shell\nVersion:    13.3.0\nRepository storage paths:\n- default:  /home/u3mur4/Hack/gitlab/gitlab-development-kit/repositories\nGitLab Shell path:      /home/u3mur4/Hack/gitlab/gitlab-development-kit/gitlab-shell\nGit:        /usr/bin/git\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003estealing the CI_JOB_TOKEN of any user (access the user private repositories, member only repositories and registry, etc...)\u003c/p\u003e\n","bounty_amount":"12000.0","formatted_bounty":"$12,000","weakness":{"id":65,"name":"Business Logic Errors"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":292,"voters":["overjt","sky003","jarij","acid_slug","ltidi","physuru","arneswinnen","organdonor","mashoud1122","spam404","and 282 more..."],"severity":{"rating":"critical","score":9.6,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8244749,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I’ll add a video version right away to make it more understandable.","markdown_message":"\u003cp\u003eI’ll add a video version right away to make it more understandable.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-09T16:09:19.145Z","updated_at":"2020-06-09T16:09:19.145Z","actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8244831,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @u3mur4,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 20 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","markdown_message":"\u003cp\u003eHi \u003ca href=\"/u3mur4\"\u003e@u3mur4\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report. We will investigate the issue as soon as possible.\u003cbr\u003e\nDue to our current workload, we will get back within 20 business days with an update.\u003c/p\u003e\n\n\u003cp\u003ePlease refrain from submitting your report or inquiring about its status through\u003cbr\u003e\nadditional channels, as this unnecessarily binds resources in the security team.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nGitLab Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2020-06-09T16:19:48.166Z","updated_at":"2020-06-09T16:19:48.166Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":8245757,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello,\n\nThank you for submitting this report.\n\nWe have verified this finding and our engineering team is investigating.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitlab/-/issues/220972.  This issue will be made public 30 days following the release of a patch.\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nSecurity Team | GitLab Inc.","markdown_message":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report.\u003c/p\u003e\n\n\u003cp\u003eWe have verified this finding and our engineering team is investigating.  We will be tracking progress internally at \u003ca title=\"https://gitlab.com/gitlab-org/gitlab/-/issues/220972\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-org%2Fgitlab%2F-%2Fissues%2F220972\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/gitlab-org/gitlab/-/issues/220972\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.  This issue will be made public 30 days following the release of a patch.\u003c/p\u003e\n\n\u003cp\u003eWe will continue to update you via HackerOne as a patch is scheduled for release.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nSecurity Team | GitLab Inc.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-09T18:14:18.943Z","updated_at":"2020-06-09T18:14:18.943Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8246363,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here is the video version.\n{F861141}\n\nAlso this behavior is intentional (but obviously not secure). I received an email while making the video.\n```\nThe mirror user for test742/poc has been changed from Attacker Second Account to yourself because their account was deleted.\n\nYou can change this setting from the repository settings page.\n```","markdown_message":"\u003cp\u003eHere is the video version.\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"poc.mp4\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/KS3LvGFyX4oLxJDL1oT8PCDP?response-content-disposition=attachment%3B%20filename%3D%22poc.mp4%22%3B%20filename%2A%3DUTF-8%27%27poc.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQRVDVIAIN%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T070743Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCIE32Mqh2tZr%2BOU5TpCkMAcCIP7cUR4Cmx6knF0aE1pAIhANosl%2BxHV6Q%2F51LP%2Fec3HeAsrkcv3Oonagtggk2l2fcHKrQDCFYQARoMMDEzNjE5Mjc0ODQ5IgyvivkNb%2F%2FihtanvJsqkQOxVl0vet745bZV8lQI5KYtwTWpcIFAsML7JxymD3vn9i8QCWhlYeT2MW%2B9baTQMb%2BdveMhrdwbKcBh3ip%2ByweQnVl9ueQzetzoXpB5k2WZrDCF3m0PA%2BCv6ox3XmJRewIkURiq4Ztl%2BHyUPdAtuOYZDYkHGUB8OqZgDmy0YoWLDqNPzGZK7dX7v62QUuo2TiCO%2BWHnWiVN2sIAHkLQ1c0cRYR2hre0%2FHfkXdHak9EM%2FJlTAH%2BQnt3DZGo6v788Hni0I1X%2F70QyGnfzTEgA8%2Fvb6vKESyULs14SrfKtlo9En1u2T1%2B79JNxVdhJNX%2BfERg06V3dMkcO%2BhECVPAWHzRrJ3bTOIIfgttUE3yW5ViJmecveb28ezf1szEuiXvW%2BZQUdTtFctgvSq22L57hu2QitzJ%2F7EFXuPPyfSKn70goiFML2nsYjayzP2jOzI85Wf0PZwwCg%2BTr7Ldre4VPxLs2y%2BAhqKPahi9iLDrk5IVFZPWBWrmRjgRlhjIP7aYZzYQEoqoD%2F3susXDMHlsiMv8yoDDN6ar%2FBTrqAdSZzhKXhWU9aDM9pF9urQto0LgyoOSxshu8McAhBrfa%2FReNxxcISybiMxPssa8oRShR7XUSBWuVRE7CnX5MQKY6UeaUB8HDokdym3sz7IA0tuq64XmfywVqSVqOZTRnXaNG%2BObO1m4FlOQ%2FC4n%2Fbe50N8rAEPnkWd81lyuaeMezjo4O%2BlEpCZ%2ByBXnfl88Bjx8KUaMIVJ5VHQ8J6PBiG%2FjOWow2rty2SDO%2BTqlQJxjPwbenYT7WUyEPOBmi%2FZgSy9qD6EP%2B5GMYGk0q2R6LmuTGm6QPTGNHaZ%2BHqK3PMyvOo0eC1hMcq6KJ8g%3D%3D\u0026amp;X-Amz-Signature=b91c2c450d2e34aa4444eda250daf12c857e5d9fac79fa15fe51fd251377ddfd\" data-attachment-type=\"video/mp4\"\u003e\u003cvideo controls=\"controls\" src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/KS3LvGFyX4oLxJDL1oT8PCDP?response-content-disposition=attachment%3B%20filename%3D%22poc.mp4%22%3B%20filename%2A%3DUTF-8%27%27poc.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQRVDVIAIN%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T070743Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCIE32Mqh2tZr%2BOU5TpCkMAcCIP7cUR4Cmx6knF0aE1pAIhANosl%2BxHV6Q%2F51LP%2Fec3HeAsrkcv3Oonagtggk2l2fcHKrQDCFYQARoMMDEzNjE5Mjc0ODQ5IgyvivkNb%2F%2FihtanvJsqkQOxVl0vet745bZV8lQI5KYtwTWpcIFAsML7JxymD3vn9i8QCWhlYeT2MW%2B9baTQMb%2BdveMhrdwbKcBh3ip%2ByweQnVl9ueQzetzoXpB5k2WZrDCF3m0PA%2BCv6ox3XmJRewIkURiq4Ztl%2BHyUPdAtuOYZDYkHGUB8OqZgDmy0YoWLDqNPzGZK7dX7v62QUuo2TiCO%2BWHnWiVN2sIAHkLQ1c0cRYR2hre0%2FHfkXdHak9EM%2FJlTAH%2BQnt3DZGo6v788Hni0I1X%2F70QyGnfzTEgA8%2Fvb6vKESyULs14SrfKtlo9En1u2T1%2B79JNxVdhJNX%2BfERg06V3dMkcO%2BhECVPAWHzRrJ3bTOIIfgttUE3yW5ViJmecveb28ezf1szEuiXvW%2BZQUdTtFctgvSq22L57hu2QitzJ%2F7EFXuPPyfSKn70goiFML2nsYjayzP2jOzI85Wf0PZwwCg%2BTr7Ldre4VPxLs2y%2BAhqKPahi9iLDrk5IVFZPWBWrmRjgRlhjIP7aYZzYQEoqoD%2F3susXDMHlsiMv8yoDDN6ar%2FBTrqAdSZzhKXhWU9aDM9pF9urQto0LgyoOSxshu8McAhBrfa%2FReNxxcISybiMxPssa8oRShR7XUSBWuVRE7CnX5MQKY6UeaUB8HDokdym3sz7IA0tuq64XmfywVqSVqOZTRnXaNG%2BObO1m4FlOQ%2FC4n%2Fbe50N8rAEPnkWd81lyuaeMezjo4O%2BlEpCZ%2ByBXnfl88Bjx8KUaMIVJ5VHQ8J6PBiG%2FjOWow2rty2SDO%2BTqlQJxjPwbenYT7WUyEPOBmi%2FZgSy9qD6EP%2B5GMYGk0q2R6LmuTGm6QPTGNHaZ%2BHqK3PMyvOo0eC1hMcq6KJ8g%3D%3D\u0026amp;X-Amz-Signature=b91c2c450d2e34aa4444eda250daf12c857e5d9fac79fa15fe51fd251377ddfd\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/video\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAlso this behavior is intentional (but obviously not secure). I received an email while making the video.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eThe mirror user for test742/poc has been changed from Attacker Second Account to yourself because their account was deleted.\n\nYou can change this setting from the repository settings page.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2020-06-09T19:29:29.147Z","updated_at":"2020-06-09T19:29:29.147Z","actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":861141,"filename":"poc.mp4","type":"video/mp4","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/KS3LvGFyX4oLxJDL1oT8PCDP?response-content-disposition=attachment%3B%20filename%3D%22poc.mp4%22%3B%20filename%2A%3DUTF-8%27%27poc.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQRVDVIAIN%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T070743Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCIE32Mqh2tZr%2BOU5TpCkMAcCIP7cUR4Cmx6knF0aE1pAIhANosl%2BxHV6Q%2F51LP%2Fec3HeAsrkcv3Oonagtggk2l2fcHKrQDCFYQARoMMDEzNjE5Mjc0ODQ5IgyvivkNb%2F%2FihtanvJsqkQOxVl0vet745bZV8lQI5KYtwTWpcIFAsML7JxymD3vn9i8QCWhlYeT2MW%2B9baTQMb%2BdveMhrdwbKcBh3ip%2ByweQnVl9ueQzetzoXpB5k2WZrDCF3m0PA%2BCv6ox3XmJRewIkURiq4Ztl%2BHyUPdAtuOYZDYkHGUB8OqZgDmy0YoWLDqNPzGZK7dX7v62QUuo2TiCO%2BWHnWiVN2sIAHkLQ1c0cRYR2hre0%2FHfkXdHak9EM%2FJlTAH%2BQnt3DZGo6v788Hni0I1X%2F70QyGnfzTEgA8%2Fvb6vKESyULs14SrfKtlo9En1u2T1%2B79JNxVdhJNX%2BfERg06V3dMkcO%2BhECVPAWHzRrJ3bTOIIfgttUE3yW5ViJmecveb28ezf1szEuiXvW%2BZQUdTtFctgvSq22L57hu2QitzJ%2F7EFXuPPyfSKn70goiFML2nsYjayzP2jOzI85Wf0PZwwCg%2BTr7Ldre4VPxLs2y%2BAhqKPahi9iLDrk5IVFZPWBWrmRjgRlhjIP7aYZzYQEoqoD%2F3susXDMHlsiMv8yoDDN6ar%2FBTrqAdSZzhKXhWU9aDM9pF9urQto0LgyoOSxshu8McAhBrfa%2FReNxxcISybiMxPssa8oRShR7XUSBWuVRE7CnX5MQKY6UeaUB8HDokdym3sz7IA0tuq64XmfywVqSVqOZTRnXaNG%2BObO1m4FlOQ%2FC4n%2Fbe50N8rAEPnkWd81lyuaeMezjo4O%2BlEpCZ%2ByBXnfl88Bjx8KUaMIVJ5VHQ8J6PBiG%2FjOWow2rty2SDO%2BTqlQJxjPwbenYT7WUyEPOBmi%2FZgSy9qD6EP%2B5GMYGk0q2R6LmuTGm6QPTGNHaZ%2BHqK3PMyvOo0eC1hMcq6KJ8g%3D%3D\u0026X-Amz-Signature=b91c2c450d2e34aa4444eda250daf12c857e5d9fac79fa15fe51fd251377ddfd"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8247130,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I think this feature was introduced in the `4d52c01516c80f40520896809b9bf0da00ee6c7e` commit on 2018.03.05.\n```diff\n@@ -0,0 +1,34 @@\n+module EE\n+  module Users\n+    module DestroyService\n+      extend ::Gitlab::Utils::Override\n+\n+      override :execute\n+      def execute(user, options = {})\n+        super(user, options) do |delete_user|\n+          mirror_cleanup(delete_user)\n+        end\n+      end\n+\n+      def mirror_cleanup(user)\n+        user_mirrors = ::Project.where(mirror_user: user)\n+\n+        user_mirrors.find_each do |mirror|\n+          new_mirror_user = first_mirror_owner(user, mirror)\n+\n+          mirror.update_attributes(mirror_user: new_mirror_user)\n+          ::NotificationService.new.project_mirror_user_changed(new_mirror_user, user.name, mirror)\n+        end\n+      end\n+\n+      private\n+\n+      def first_mirror_owner(user, mirror)\n+        mirror_owners = mirror.team.owners\n+        mirror_owners -= [user]\n+\n+        mirror_owners.first\n+      end\n+    end\n+  end\n+end\n```\n\nhttps://gitlab.com/gitlab-org/gitlab/blob/master/ee/app/services/ee/users/destroy_service.rb#L19","markdown_message":"\u003cp\u003eI think this feature was introduced in the \u003ccode\u003e4d52c01516c80f40520896809b9bf0da00ee6c7e\u003c/code\u003e commit on 2018.03.05.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e@@ -0,0 +1,34 @@\u003c/span\u003e\n\u003cspan class=\"gi\"\u003e+module EE\n+  module Users\n+    module DestroyService\n+      extend ::Gitlab::Utils::Override\n+\n+      override :execute\n+      def execute(user, options = {})\n+        super(user, options) do |delete_user|\n+          mirror_cleanup(delete_user)\n+        end\n+      end\n+\n+      def mirror_cleanup(user)\n+        user_mirrors = ::Project.where(mirror_user: user)\n+\n+        user_mirrors.find_each do |mirror|\n+          new_mirror_user = first_mirror_owner(user, mirror)\n+\n+          mirror.update_attributes(mirror_user: new_mirror_user)\n+          ::NotificationService.new.project_mirror_user_changed(new_mirror_user, user.name, mirror)\n+        end\n+      end\n+\n+      private\n+\n+      def first_mirror_owner(user, mirror)\n+        mirror_owners = mirror.team.owners\n+        mirror_owners -= [user]\n+\n+        mirror_owners.first\n+      end\n+    end\n+  end\n+end\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca title=\"https://gitlab.com/gitlab-org/gitlab/blob/master/ee/app/services/ee/users/destroy_service.rb#L19\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-org%2Fgitlab%2Fblob%2Fmaster%2Fee%2Fapp%2Fservices%2Fee%2Fusers%2Fdestroy_service.rb%23L19\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/gitlab-org/gitlab/blob/master/ee/app/services/ee/users/destroy_service.rb#L19\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-09T20:00:40.340Z","updated_at":"2020-06-09T20:00:40.340Z","actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8249737,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @u3mur4,\n\nThe issue you reported is currently scheduled to be fixed by 2020-06-30.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","markdown_message":"\u003cp\u003eETA for fix:\u003c/p\u003e\n\n\u003cp\u003eHi \u003ca href=\"/u3mur4\"\u003e@u3mur4\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThe issue you reported is currently scheduled to be fixed by 2020-06-30.\u003c/p\u003e\n\n\u003cp\u003eThank you again for contacting us!\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nGitLab Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2020-06-10T04:20:07.579Z","updated_at":"2020-06-10T04:20:07.579Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":8345664,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi,\n\nThank you again for your report! Your finding has been patched in GitLab version 13.0.6 and we are awarding a bounty. \n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThank you again for your report! Your finding has been patched in GitLab version 13.0.6 and we are awarding a bounty. \u003c/p\u003e\n\n\u003cp\u003ePlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab\u0026#39;s issue tracker.\u003c/p\u003e\n\n\u003cp\u003eWe look forward to your next report!\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nSecurity Team | GitLab Inc.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-19T17:34:25.636Z","updated_at":"2020-06-19T17:34:25.636Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"u3mur4","url":"/u3mur4"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8345667,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-19T17:34:46.479Z","updated_at":"2020-06-19T17:34:46.479Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"GitLab"}},"bounty_amount":"12000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"u3mur4","url":"/u3mur4"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8952586,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-17T05:35:38.101Z","updated_at":"2020-08-17T05:35:38.101Z","first_to_agree":true,"actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9045428,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-26T14:11:44.259Z","updated_at":"2020-08-26T14:11:44.259Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9045429,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-26T14:11:44.422Z","updated_at":"2020-08-26T14:11:44.422Z","actor":{"username":"dcouture","cleared":false,"url":"/dcouture","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/TpSJ356VRAW7GpCzzZ25R8Kb/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}