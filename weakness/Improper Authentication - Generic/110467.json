{"id":110467,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTA0Njc=","url":"https://hackerone.com/reports/110467","title":"Bypassing Digits bridge origin validation","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-01-13T14:14:24.338Z","submitted_at":"2016-01-13T14:14:24.338Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"filedescriptor","url":"/filedescriptor","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":61,"url":"https://hackerone.com/twitter","handle":"twitter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Twitter","twitter_handle":"twittersecurity","website":"https://twitter.com","about":"Twitter helps you create and share ideas and information instantly, without barriers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-04-30T15:41:17.220Z","bug_reporter_agreed_on_going_public_at":"2017-03-31T15:41:11.333Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\nI would like to report an issue in the bridge proxy in Digits which allows attacker to retrieve the OAuth credential data of an application victims authorized.\n\n#Detail\nIn the Digits Web SDK, the method [getLoginStatus](https://docs.fabric.io/web/digits/getting-started.html#set-up-digits-authentication) can be used to retrieve the OAuth credential data of an application if the user has already logged in Digits and authorized the app. The way it works is to inject an hidden iframe (I call it bridge because the URL is https://www.digits.com/bridge) which acts like a proxy into the webpage and communicate using *postMessage*. Once the bridge receives the *getLoginStatus* command, it will make an AJAX request to /login_status and the response will contain the OAuth credential data of the user of an application. Then, the bridge will send back the data via *postMessage* to parent window.\n\nFor example:\n\n```\n+----------------------------------------------------------------------------------+\n| https://www.periscope.tv/                                                        |\n+----------------------------------------------------------------------------------+\n|                                                                                  |\n|  +----------------------------------------------------------------------------+  |\n|  | https://www.digits.com/bridge?consumer_key=.\u0026host=https://www.periscope.tv |  |\n|  +----------------------------------------------------------------------------+  |\n|  |                                                                            |  |\n|  |                      ^                           +                         |  |\n|  +----------------------------------------------------------------------------+  |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         +                           v                            |\n|                   getLoginStatus             OAuth Credential                    |\n|                                                                                  |\n+----------------------------------------------------------------------------------+\n```\n\nIf https://www.periscope.tv/ invokes *Digits.getLoginStatus()*, then an iframe will be injected where the *host* parameter is the invoker origin.\n\nThere's a protection in place which validates whether the *host* parameter provided matches the application registered domain. For example, ```/bridge?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026host=https://www.periscope.tv``` passes while ```/bridge?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026host=https://attacker.com``` fails. This prevents others to use the same *consumer_key* to pretend to be the legit application to issue the command.\n\nHowever, **there is no validation to check whether the page which embeds the bridge proxy is from the registered domain**. In other words, attacker can manually embed ```/bridge?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026host=https://www.periscope.tv``` into his/her webpage and issue command on behalf of the legit application.\n\n#Impact\nIt affects every application that has integrated Digits, and even official application (Periscope). Attacker can abuse the flaw to login to victim's account on the affected applications. In addition, this attack **does not require user interaction**. The only prerequisite is that the victim has already logged in Digits and authorized the application.\n\n#PoC\n1. Prepare a Periscope account which is associated with a phone number, and make sure you have logged in Digits (https://www.digits.com/signin) with that number\n2. Go to http://innerht.ml/pocs/digits-bridge-origin-validation-bypass/\n3. Wait for a while\n4. You Periscope account will be renamed as \"Pwn3d\"\n\nVideo demo: https://vimeo.com/151646523 (password: proxy)\n\nAnd as always, since it does not require user interaction, it can be put into a player card to achieve maximum stealthiness.\n\n#Fix\nIt would be ideal to employ CORS instead of postMessage + proxy for that purpose. An alternative fix would be to check whether the page embedding the bridge proxy is from the registered domain by comparing referrer (pretty unsound though).","vulnerability_information_html":"\u003cp\u003eHi,\u003cbr\u003e\nI would like to report an issue in the bridge proxy in Digits which allows attacker to retrieve the OAuth credential data of an application victims authorized.\u003c/p\u003e\n\n\u003ch1 id=\"detail\"\u003eDetail\u003c/h1\u003e\n\n\u003cp\u003eIn the Digits Web SDK, the method \u003ca href=\"/redirect?url=https%3A%2F%2Fdocs.fabric.io%2Fweb%2Fdigits%2Fgetting-started.html%23set-up-digits-authentication\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003egetLoginStatus\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e can be used to retrieve the OAuth credential data of an application if the user has already logged in Digits and authorized the app. The way it works is to inject an hidden iframe (I call it bridge because the URL is \u003ca title=\"https://www.digits.com/bridge\" href=\"/redirect?url=https%3A%2F%2Fwww.digits.com%2Fbridge\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digits.com/bridge\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) which acts like a proxy into the webpage and communicate using \u003cem\u003epostMessage\u003c/em\u003e. Once the bridge receives the \u003cem\u003egetLoginStatus\u003c/em\u003e command, it will make an AJAX request to /login_status and the response will contain the OAuth credential data of the user of an application. Then, the bridge will send back the data via \u003cem\u003epostMessage\u003c/em\u003e to parent window.\u003c/p\u003e\n\n\u003cp\u003eFor example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e+----------------------------------------------------------------------------------+\n| https://www.periscope.tv/                                                        |\n+----------------------------------------------------------------------------------+\n|                                                                                  |\n|  +----------------------------------------------------------------------------+  |\n|  | https://www.digits.com/bridge?consumer_key=.\u0026amp;host=https://www.periscope.tv |  |\n|  +----------------------------------------------------------------------------+  |\n|  |                                                                            |  |\n|  |                      ^                           +                         |  |\n|  +----------------------------------------------------------------------------+  |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         |                           |                            |\n|                         +                           v                            |\n|                   getLoginStatus             OAuth Credential                    |\n|                                                                                  |\n+----------------------------------------------------------------------------------+\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf \u003ca title=\"https://www.periscope.tv/\" href=\"/redirect?url=https%3A%2F%2Fwww.periscope.tv%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.periscope.tv/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e invokes \u003cem\u003eDigits.getLoginStatus()\u003c/em\u003e, then an iframe will be injected where the \u003cem\u003ehost\u003c/em\u003e parameter is the invoker origin.\u003c/p\u003e\n\n\u003cp\u003eThere\u0026#39;s a protection in place which validates whether the \u003cem\u003ehost\u003c/em\u003e parameter provided matches the application registered domain. For example, \u003ccode\u003e/bridge?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026amp;host=https://www.periscope.tv\u003c/code\u003e passes while \u003ccode\u003e/bridge?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026amp;host=https://attacker.com\u003c/code\u003e fails. This prevents others to use the same \u003cem\u003econsumer_key\u003c/em\u003e to pretend to be the legit application to issue the command.\u003c/p\u003e\n\n\u003cp\u003eHowever, \u003cstrong\u003ethere is no validation to check whether the page which embeds the bridge proxy is from the registered domain\u003c/strong\u003e. In other words, attacker can manually embed \u003ccode\u003e/bridge?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026amp;host=https://www.periscope.tv\u003c/code\u003e into his/her webpage and issue command on behalf of the legit application.\u003c/p\u003e\n\n\u003ch1 id=\"impact\"\u003eImpact\u003c/h1\u003e\n\n\u003cp\u003eIt affects every application that has integrated Digits, and even official application (Periscope). Attacker can abuse the flaw to login to victim\u0026#39;s account on the affected applications. In addition, this attack \u003cstrong\u003edoes not require user interaction\u003c/strong\u003e. The only prerequisite is that the victim has already logged in Digits and authorized the application.\u003c/p\u003e\n\n\u003ch1 id=\"poc\"\u003ePoC\u003c/h1\u003e\n\n\u003col\u003e\n\u003cli\u003ePrepare a Periscope account which is associated with a phone number, and make sure you have logged in Digits (\u003ca title=\"https://www.digits.com/signin\" href=\"/redirect?url=https%3A%2F%2Fwww.digits.com%2Fsignin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digits.com/signin\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) with that number\u003c/li\u003e\n\u003cli\u003eGo to \u003ca title=\"http://innerht.ml/pocs/digits-bridge-origin-validation-bypass/\" href=\"/redirect?url=http%3A%2F%2Finnerht.ml%2Fpocs%2Fdigits-bridge-origin-validation-bypass%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://innerht.ml/pocs/digits-bridge-origin-validation-bypass/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eWait for a while\u003c/li\u003e\n\u003cli\u003eYou Periscope account will be renamed as \u0026quot;Pwn3d\u0026quot;\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eVideo demo: \u003ca title=\"https://vimeo.com/151646523\" href=\"/redirect?url=https%3A%2F%2Fvimeo.com%2F151646523\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://vimeo.com/151646523\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (password: proxy)\u003c/p\u003e\n\n\u003cp\u003eAnd as always, since it does not require user interaction, it can be put into a player card to achieve maximum stealthiness.\u003c/p\u003e\n\n\u003ch1 id=\"fix\"\u003eFix\u003c/h1\u003e\n\n\u003cp\u003eIt would be ideal to employ CORS instead of postMessage + proxy for that purpose. An alternative fix would be to check whether the page embedding the bridge proxy is from the registered domain by comparing referrer (pretty unsound though).\u003c/p\u003e\n","bounty_amount":"5040.0","formatted_bounty":"$5,040","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-04-30T15:41:11.389Z","allow_singular_disclosure_after":-115648497.62643926,"singular_disclosure_allowed":true,"vote_count":88,"voters":["zhchbin","sp1d3rs","kapytein","hunter","woltage","adn","bl4de","bogdantcaciuc","spam404","ta8ahi","and 78 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":759579,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\n\nThank you for helping keep Twitter secure!","markdown_message":"\u003cp\u003eThank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\u003c/p\u003e\n\n\u003cp\u003eThank you for helping keep Twitter secure!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-15T17:03:23.631Z","updated_at":"2016-01-15T17:03:23.631Z","actor":{"username":"bfd","cleared":false,"url":"/bfd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/639/cb4711f9ee63746ad25d3c68fdef609f4ea84711_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":769166,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just as an update - we haven't forgotten about the bounty for this report. We should get back to you next week.\n\nThanks for thinking of Twitter security!","markdown_message":"\u003cp\u003eJust as an update - we haven\u0026#39;t forgotten about the bounty for this report. We should get back to you next week.\u003c/p\u003e\n\n\u003cp\u003eThanks for thinking of Twitter security!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-23T00:52:48.766Z","updated_at":"2016-01-23T00:52:48.766Z","actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":769209,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Cool, gotcha!","markdown_message":"\u003cp\u003eCool, gotcha!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-23T01:49:04.733Z","updated_at":"2016-01-23T01:49:13.295Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":777239,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-01-29T19:10:29.349Z","updated_at":"2016-01-29T19:10:29.349Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Twitter"}},"bounty_amount":"5040.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"twitter","collaborator":{"username":"filedescriptor","url":"/filedescriptor"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":809212,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We consider this issue to be fixed now. Can you please confirm?\n\nThank you for helping keep Twitter secure!","markdown_message":"\u003cp\u003eWe consider this issue to be fixed now. Can you please confirm?\u003c/p\u003e\n\n\u003cp\u003eThank you for helping keep Twitter secure!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-23T19:27:27.172Z","updated_at":"2016-02-23T19:27:27.172Z","actor":{"username":"bfd","cleared":false,"url":"/bfd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/639/cb4711f9ee63746ad25d3c68fdef609f4ea84711_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":809213,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I can confirm this is fixed! (I believe this was fixed a while ago)","markdown_message":"\u003cp\u003eI can confirm this is fixed! (I believe this was fixed a while ago)\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-23T19:28:02.678Z","updated_at":"2016-02-23T19:28:02.678Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1575364,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-31T15:41:11.358Z","updated_at":"2017-03-31T15:41:11.358Z","first_to_agree":true,"actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1645430,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-04-30T15:41:17.254Z","updated_at":"2017-04-30T15:41:17.254Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Twitter"}},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}