{"id":129873,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMjk4NzM=","url":"https://hackerone.com/reports/129873","title":"Bypassing Digits origin validation which leads to account takeover","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-04-11T17:02:26.419Z","submitted_at":"2016-04-11T17:02:26.419Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"filedescriptor","url":"/filedescriptor","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":61,"url":"https://hackerone.com/twitter","handle":"twitter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Twitter","twitter_handle":"twittersecurity","website":"https://twitter.com","about":"Twitter helps you create and share ideas and information instantly, without barriers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-06-24T17:55:18.018Z","bug_reporter_agreed_on_going_public_at":"2020-06-22T16:15:29.585Z","team_member_agreed_on_going_public_at":"2020-06-24T17:55:17.912Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\nI would like to report an important issue that affects websites that has integrated \"Signin with Digits\" , leading to potential account takeover.\n\n#Detail\nIn Digits architecture, the data communication channel between Digits and customer's site relies on *postMessage()*. In order to prevent malicious websites prevent themselves to be the legit Digits website and send arbitrary commands to the customer's websites, an origin validation is in place in the SDK. Specifically, the code that's responsible to perform the validation is as follow:\n\n**File: https://cdn.digits.com/1/sdk.js**\n```javascript\ne.exports = {\n    sdk_host: \"https://www.digits.com\",\n[..]\nonReceiveMessage: function(t) {\n    this.config \u0026\u0026 -1 !== this.config.get(\"sdk_host\").search(t.origin) \u0026\u0026 this.resolve(t.data)\n},\n```\nIn short, the event origin is checked against Digits' origin in this line:`-1 !== this.config.get(\"sdk_host\").search(t.origin)`, which is the same as `-1 !== \"https://www.digits.com\".search(t.origin)`. In essence, it looks for the occurrence of Digit's origin from sender's origin.\n\nThe way the validation is done is however flawed. According to the [docs of String.prototype.search()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/search), the method takes a regular repression object instead of a string. If anything other than regexp is passed, it will get implicitly converted into a regexp. In this case, `t.origin` which is a string is converted into a regexp.\n\nIn regular expression, a dot (.) is treated as a wildcard. In other words, any character of Digits' origin can be replaced with a dot. An attacker can take advantage of it and use a special domain instead of the official one to bypass the validation, such as `www.d.gits.co`\n\nAn example of comparing such a special domain looks like this: \n`www.d.gits.co`\n`www.digits.com`\nNotice that `www.d.gits.co` is now a subset of `www.digits.com`, thus it effective bypasses the validation.\n\n#Impact\nIt affects websites that have integrated Digits signin feature, leading to potential account takeover issue on those websites. Twitter official applications like Fabric is also affected.\n\n#PoC\nTo provide a concrete example of how this vulnerability can lead to account takeover, a Proof of Concept against Fabric is presented.\n\n1. Make sure you have logged in Fabric.io\n2. Go to https://www.d.gits.co/fabric.html\n3. Click the button\n4. You will see a phone number is automatically associated with your account\n5. Now, attacker can use the reset password with Digits feature to takeover the account\n\nNotice the attack can be done silently without user interaction and awareness.\n\nA video demo: https://vimeo.com/162397716 (password: origin)\n\n#Fix\nIn my opinion, a simple string comparison is enough for validation. Therefore I recommend changing it to use either `indexOf` or `===`.","vulnerability_information_html":"\u003cp\u003eHi,\u003cbr\u003e\nI would like to report an important issue that affects websites that has integrated \u0026quot;Signin with Digits\u0026quot; , leading to potential account takeover.\u003c/p\u003e\n\n\u003ch1 id=\"detail\"\u003eDetail\u003c/h1\u003e\n\n\u003cp\u003eIn Digits architecture, the data communication channel between Digits and customer\u0026#39;s site relies on \u003cem\u003epostMessage()\u003c/em\u003e. In order to prevent malicious websites prevent themselves to be the legit Digits website and send arbitrary commands to the customer\u0026#39;s websites, an origin validation is in place in the SDK. Specifically, the code that\u0026#39;s responsible to perform the validation is as follow:\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eFile: \u003ca title=\"https://cdn.digits.com/1/sdk.js\" href=\"/redirect?url=https%3A%2F%2Fcdn.digits.com%2F1%2Fsdk.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://cdn.digits.com/1/sdk.js\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esdk_host\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps://www.digits.com\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[..]\u003c/span\u003e\n\u003cspan class=\"na\"\u003eonReceiveMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003esdk_host\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003esearch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eorigin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn short, the event origin is checked against Digits\u0026#39; origin in this line:\u003ccode\u003e-1 !== this.config.get(\u0026quot;sdk_host\u0026quot;).search(t.origin)\u003c/code\u003e, which is the same as \u003ccode\u003e-1 !== \u0026quot;https://www.digits.com\u0026quot;.search(t.origin)\u003c/code\u003e. In essence, it looks for the occurrence of Digit\u0026#39;s origin from sender\u0026#39;s origin.\u003c/p\u003e\n\n\u003cp\u003eThe way the validation is done is however flawed. According to the \u003ca href=\"/redirect?url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString%2Fsearch\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003edocs of String.prototype.search()\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, the method takes a regular repression object instead of a string. If anything other than regexp is passed, it will get implicitly converted into a regexp. In this case, \u003ccode\u003et.origin\u003c/code\u003e which is a string is converted into a regexp.\u003c/p\u003e\n\n\u003cp\u003eIn regular expression, a dot (.) is treated as a wildcard. In other words, any character of Digits\u0026#39; origin can be replaced with a dot. An attacker can take advantage of it and use a special domain instead of the official one to bypass the validation, such as \u003ccode\u003ewww.d.gits.co\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eAn example of comparing such a special domain looks like this: \u003cbr\u003e\n\u003ccode\u003ewww.d.gits.co\u003c/code\u003e\u003cbr\u003e\n\u003ccode\u003ewww.digits.com\u003c/code\u003e\u003cbr\u003e\nNotice that \u003ccode\u003ewww.d.gits.co\u003c/code\u003e is now a subset of \u003ccode\u003ewww.digits.com\u003c/code\u003e, thus it effective bypasses the validation.\u003c/p\u003e\n\n\u003ch1 id=\"impact\"\u003eImpact\u003c/h1\u003e\n\n\u003cp\u003eIt affects websites that have integrated Digits signin feature, leading to potential account takeover issue on those websites. Twitter official applications like Fabric is also affected.\u003c/p\u003e\n\n\u003ch1 id=\"poc\"\u003ePoC\u003c/h1\u003e\n\n\u003cp\u003eTo provide a concrete example of how this vulnerability can lead to account takeover, a Proof of Concept against Fabric is presented.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eMake sure you have logged in Fabric.io\u003c/li\u003e\n\u003cli\u003eGo to \u003ca title=\"https://www.d.gits.co/fabric.html\" href=\"/redirect?url=https%3A%2F%2Fwww.d.gits.co%2Ffabric.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.d.gits.co/fabric.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eClick the button\u003c/li\u003e\n\u003cli\u003eYou will see a phone number is automatically associated with your account\u003c/li\u003e\n\u003cli\u003eNow, attacker can use the reset password with Digits feature to takeover the account\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eNotice the attack can be done silently without user interaction and awareness.\u003c/p\u003e\n\n\u003cp\u003eA video demo: \u003ca title=\"https://vimeo.com/162397716\" href=\"/redirect?url=https%3A%2F%2Fvimeo.com%2F162397716\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://vimeo.com/162397716\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (password: origin)\u003c/p\u003e\n\n\u003ch1 id=\"fix\"\u003eFix\u003c/h1\u003e\n\n\u003cp\u003eIn my opinion, a simple string comparison is enough for validation. Therefore I recommend changing it to use either \u003ccode\u003eindexOf\u003c/code\u003e or \u003ccode\u003e===\u003c/code\u003e.\u003c/p\u003e\n","bounty_amount":"5040.0","formatted_bounty":"$5,040","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-07-22T16:15:29.641Z","allow_singular_disclosure_after":-13781341.686427152,"singular_disclosure_allowed":true,"vote_count":569,"voters":["rootsploit","4n_curze","xdms","whoareme","thiezn","totz_sec","nrockhouse","samengmg","m0chan","stefanofinding","and 559 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":899759,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Forgot to include this:\nAfter the attacker bypasses the validation, he/she can then send a fake sign in command to the customer's site with his/her own tokens. Customer's site then accepts it and associates victim's account with attacker's phone number.","markdown_message":"\u003cp\u003eForgot to include this:\u003cbr\u003e\nAfter the attacker bypasses the validation, he/she can then send a fake sign in command to the customer\u0026#39;s site with his/her own tokens. Customer\u0026#39;s site then accepts it and associates victim\u0026#39;s account with attacker\u0026#39;s phone number.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-04-11T17:09:48.777Z","updated_at":"2016-04-11T17:09:48.777Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":902496,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\n\nThank you for helping keep Twitter secure!","markdown_message":"\u003cp\u003eThank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\u003c/p\u003e\n\n\u003cp\u003eThank you for helping keep Twitter secure!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-04-12T22:52:32.451Z","updated_at":"2016-04-12T22:52:32.451Z","actor":{"username":"mfinifter","cleared":false,"url":"/mfinifter","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":908441,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again. As mentioned we’ll keep you updated as we investigate further. As a reminder, please remember to keep the details of this report private until we have fully investigated and addressed the issue.","markdown_message":"\u003cp\u003eThanks again. As mentioned we’ll keep you updated as we investigate further. As a reminder, please remember to keep the details of this report private until we have fully investigated and addressed the issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-04-15T18:51:57.388Z","updated_at":"2016-04-15T18:51:57.388Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Twitter"}},"bounty_amount":"5040.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"twitter","collaborator":{"username":"filedescriptor","url":"/filedescriptor"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1007349,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We consider this issue to be fixed now. Can you please confirm?\n\nThank you for helping keep Twitter secure!","markdown_message":"\u003cp\u003eWe consider this issue to be fixed now. Can you please confirm?\u003c/p\u003e\n\n\u003cp\u003eThank you for helping keep Twitter secure!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-06-09T22:44:10.369Z","updated_at":"2016-06-09T22:44:10.369Z","actor":{"username":"apinter","cleared":false,"url":"/apinter","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/688/53801559ec10573f82935ef2c1682b2ce25f2d38_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1009152,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I can confirm the issue is fixed!","markdown_message":"\u003cp\u003eI can confirm the issue is fixed!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-06-11T10:04:47.371Z","updated_at":"2016-06-11T10:04:47.371Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8373622,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-22T16:15:29.607Z","updated_at":"2020-06-22T16:15:29.607Z","first_to_agree":true,"actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8397608,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-24T17:55:17.943Z","updated_at":"2020-06-24T17:55:17.943Z","actor":{"username":"yongjink","cleared":false,"url":"/yongjink","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8397609,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-24T17:55:18.041Z","updated_at":"2020-06-24T17:55:18.041Z","actor":{"username":"yongjink","cleared":false,"url":"/yongjink","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}