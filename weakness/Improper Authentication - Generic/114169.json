{"id":114169,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTQxNjk=","url":"https://hackerone.com/reports/114169","title":"Bypassing Digits web authentication's host validation with HPP","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-02-02T16:44:27.070Z","submitted_at":"2016-02-02T16:44:27.070Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"filedescriptor","url":"/filedescriptor","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":61,"url":"https://hackerone.com/twitter","handle":"twitter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Twitter","twitter_handle":"twittersecurity","website":"https://twitter.com","about":"Twitter helps you create and share ideas and information instantly, without barriers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-08-12T17:30:08.804Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2016-07-13T17:30:05.120Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\nI would like to report an issue on Digits web authentication which allows attackers to retrieve the OAuth credential data of an application victims authorized.\n\n#Detail\nAs described in #108429, the login page has 2 parameters, *consumer_key* and *host*. The former identifies which app a user wants to authenticate, and the latter specifies which domain the OAuth credential data is sent to after authentication. In order to prevent other websites to pretend to be the application, the *host* parameter will be validated to see if it matches the registered domain of the app. Take Periscope as an example:\n\n\u003e https://www.digits.com/login?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026host=https%3A%2F%2Fwww.periscope.tv\n\nhost=https://www.periscope.tv matches the registered domain\n\nIf we modify it:\n\n\u003e https://www.digits.com/login?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026host=https%3A%2F%2Fattacker.com\n\nhost=https://attacker.com does not match the registered domain, thus the page will show an error.\n\nHowever, the validation can be bypassed with HPP (HTTP Parameter Pollution). If we supply multiple *host* parameters, the validation will only compare the first one but the last one is used in the transfer step instead.\n\nFor example:\n\n\u003ehttps://www.digits.com/login?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026host=https%3A%2F%2Fwww.periscope.tv\u0026host=https%3A%2F%2Fattacker.com\n\nThe first *host* (host=https://www.periscope.tv) is validated but not the second one. After authentication the second *host* (host=https://attacker.com) is used as the transfer origin.\n\n#Impact\n\nIt affects every application that has integrated Digits, and even official application (Periscope). Attacker can abuse the flaw to login to victim's account on the affected applications.\n\n#PoC\n1. Prepare a Periscope account which is associated with a phone number\n2. Login to Periscope using the phone number with digits web login flow: http://innerht.ml/pocs/digits-host-validation-bypass-hpp/\n3. After that your account will be renamed as \"Pwn3d\"\n\n#Fix\nMake sure the validated *host* is the same as the one used as the transfer host, or return error if HPP detected","vulnerability_information_html":"\u003cp\u003eHi,\u003cbr\u003e\nI would like to report an issue on Digits web authentication which allows attackers to retrieve the OAuth credential data of an application victims authorized.\u003c/p\u003e\n\n\u003ch1 id=\"detail\"\u003eDetail\u003c/h1\u003e\n\n\u003cp\u003eAs described in \u003ca href=\"/reports/108429\"\u003e#108429\u003c/a\u003e, the login page has 2 parameters, \u003cem\u003econsumer_key\u003c/em\u003e and \u003cem\u003ehost\u003c/em\u003e. The former identifies which app a user wants to authenticate, and the latter specifies which domain the OAuth credential data is sent to after authentication. In order to prevent other websites to pretend to be the application, the \u003cem\u003ehost\u003c/em\u003e parameter will be validated to see if it matches the registered domain of the app. Take Periscope as an example:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca title=\"https://www.digits.com/login?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026amp;host=https%3A%2F%2Fwww.periscope.tv\" href=\"/redirect?url=https%3A%2F%2Fwww.digits.com%2Flogin%3Fconsumer_key%3D9I4iINIyd0R01qEPEwT9IC6RE%26host%3Dhttps%253A%252F%252Fwww.periscope.tv\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digits.com/login?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026amp;host=https%3A%2F%2Fwww.periscope.tv\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ehost=\u003ca title=\"https://www.periscope.tv\" href=\"/redirect?url=https%3A%2F%2Fwww.periscope.tv\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.periscope.tv\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e matches the registered domain\u003c/p\u003e\n\n\u003cp\u003eIf we modify it:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca title=\"https://www.digits.com/login?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026amp;host=https%3A%2F%2Fattacker.com\" href=\"/redirect?url=https%3A%2F%2Fwww.digits.com%2Flogin%3Fconsumer_key%3D9I4iINIyd0R01qEPEwT9IC6RE%26host%3Dhttps%253A%252F%252Fattacker.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digits.com/login?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026amp;host=https%3A%2F%2Fattacker.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ehost=\u003ca title=\"https://attacker.com\" href=\"/redirect?url=https%3A%2F%2Fattacker.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://attacker.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e does not match the registered domain, thus the page will show an error.\u003c/p\u003e\n\n\u003cp\u003eHowever, the validation can be bypassed with HPP (HTTP Parameter Pollution). If we supply multiple \u003cem\u003ehost\u003c/em\u003e parameters, the validation will only compare the first one but the last one is used in the transfer step instead.\u003c/p\u003e\n\n\u003cp\u003eFor example:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca title=\"https://www.digits.com/login?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026amp;host=https%3A%2F%2Fwww.periscope.tv\u0026amp;host=https%3A%2F%2Fattacker.com\" href=\"/redirect?url=https%3A%2F%2Fwww.digits.com%2Flogin%3Fconsumer_key%3D9I4iINIyd0R01qEPEwT9IC6RE%26host%3Dhttps%253A%252F%252Fwww.periscope.tv%26host%3Dhttps%253A%252F%252Fattacker.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digits.com/login?consumer_key=9I4iINIyd0R01qEPEwT9IC6RE\u0026amp;host=https%3A%2F%2Fwww.periscope.tv\u0026amp;host=https%3A%2F%2Fattacker.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe first \u003cem\u003ehost\u003c/em\u003e (host=\u003ca title=\"https://www.periscope.tv\" href=\"/redirect?url=https%3A%2F%2Fwww.periscope.tv\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.periscope.tv\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) is validated but not the second one. After authentication the second \u003cem\u003ehost\u003c/em\u003e (host=\u003ca title=\"https://attacker.com\" href=\"/redirect?url=https%3A%2F%2Fattacker.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://attacker.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) is used as the transfer origin.\u003c/p\u003e\n\n\u003ch1 id=\"impact\"\u003eImpact\u003c/h1\u003e\n\n\u003cp\u003eIt affects every application that has integrated Digits, and even official application (Periscope). Attacker can abuse the flaw to login to victim\u0026#39;s account on the affected applications.\u003c/p\u003e\n\n\u003ch1 id=\"poc\"\u003ePoC\u003c/h1\u003e\n\n\u003col\u003e\n\u003cli\u003ePrepare a Periscope account which is associated with a phone number\u003c/li\u003e\n\u003cli\u003eLogin to Periscope using the phone number with digits web login flow: \u003ca title=\"http://innerht.ml/pocs/digits-host-validation-bypass-hpp/\" href=\"/redirect?url=http%3A%2F%2Finnerht.ml%2Fpocs%2Fdigits-host-validation-bypass-hpp%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://innerht.ml/pocs/digits-host-validation-bypass-hpp/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eAfter that your account will be renamed as \u0026quot;Pwn3d\u0026quot;\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1 id=\"fix\"\u003eFix\u003c/h1\u003e\n\n\u003cp\u003eMake sure the validated \u003cem\u003ehost\u003c/em\u003e is the same as the one used as the transfer host, or return error if HPP detected\u003c/p\u003e\n","bounty_amount":"2520.0","formatted_bounty":"$2,520","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-08-12T17:30:05.204Z","allow_singular_disclosure_after":-138192444.47112444,"singular_disclosure_allowed":true,"vote_count":100,"voters":["zhchbin","arneswinnen","hogarth45","hunter","michiel","dawgyg","bogdantcaciuc","spam404","yaworsk","nahamsec","and 90 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":782043,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\n\nThank you for helping keep Twitter secure!","markdown_message":"\u003cp\u003eThank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\u003c/p\u003e\n\n\u003cp\u003eThank you for helping keep Twitter secure!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-02T23:41:15.476Z","updated_at":"2016-02-02T23:41:15.476Z","actor":{"username":"mfinifter","cleared":false,"url":"/mfinifter","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":783596,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We consider this issue to be fixed now. Can you please confirm?\n\nThank you for helping keep Twitter secure!","markdown_message":"\u003cp\u003eWe consider this issue to be fixed now. Can you please confirm?\u003c/p\u003e\n\n\u003cp\u003eThank you for helping keep Twitter secure!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-03T20:47:11.532Z","updated_at":"2016-02-03T20:47:11.532Z","actor":{"username":"mfinifter","cleared":false,"url":"/mfinifter","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":784319,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Now the presence of HPP will be detected and rejected - confirm fixed!","markdown_message":"\u003cp\u003eNow the presence of HPP will be detected and rejected - confirm fixed!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-04T09:17:41.690Z","updated_at":"2016-02-04T09:17:52.086Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":791810,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again for helping us keep Twitter safe and secure for our users!","markdown_message":"\u003cp\u003eThanks again for helping us keep Twitter safe and secure for our users!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-09T19:49:18.681Z","updated_at":"2016-02-09T19:49:18.681Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Twitter"}},"bounty_amount":"2520.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"twitter","collaborator":{"username":"filedescriptor","url":"/filedescriptor"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1067334,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"We are requesting public disclosure of this bug to encourage more reports of this quality. Thanks again!","markdown_message":"\u003cp\u003eWe are requesting public disclosure of this bug to encourage more reports of this quality. Thanks again!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-13T17:30:05.167Z","updated_at":"2016-07-13T17:30:05.167Z","first_to_agree":true,"actor":{"username":"andrewsorensen","cleared":false,"url":"/andrewsorensen","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1123492,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-12T17:30:08.877Z","updated_at":"2016-08-12T17:30:08.877Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Twitter"}},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}