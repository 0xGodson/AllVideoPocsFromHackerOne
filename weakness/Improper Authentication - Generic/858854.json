{"id":858854,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NTg4NTQ=","url":"https://hackerone.com/reports/858854","title":"Recursor accepts unsigned, empty NXDOMAINs in secure zones","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-04-24T21:00:59.445Z","submitted_at":"2020-04-24T21:00:59.445Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mnordhoff","url":"/mnordhoff","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2020-12244"],"singular_disclosure_disabled":true,"disclosed_at":"2020-05-20T14:20:04.657Z","bug_reporter_agreed_on_going_public_at":"2020-05-20T14:20:04.620Z","team_member_agreed_on_going_public_at":"2020-05-20T07:14:05.744Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi! This is a slightly edited version of the email I sent to the project's security contacts on 2020-04-21.\n\nOpen-Xchange confirmed it and asked me to resubmit it here.\n\n---\n\nSubject: Recursor may be accepting unsigned, empty NXDOMAINs in secure zones\n\nI can easily reproduce this against Cloudflare's authoritative DNS (see below). I put \"may be\" in the subject because I'm uncomfortable sounding a red alert without checking another authoritative implementation, but I don't know something available off hand.\n\nBackground: Cloudflare's authoritative DNS service has a funny issue where it will return an NXDOMAIN with no SOA or DNSSEC records if the query name has a : in it. (They know and don't want to change it.) Try it with anything -- :.cloudflare.com, foo:bar.mattnordhoff.net, whatever.\n\n```\n$ dig +dnssec +norecurse @dana.ns.cloudflare.com foo:bar.mattnordhoff.net\n\n; \u003c\u003c\u003e\u003e DiG 9.17.1 \u003c\u003c\u003e\u003e +dnssec +norecurse @dana.ns.cloudflare.com\nfoo:bar.mattnordhoff.net\n; (2 servers found)\n;; global options: +cmd\n;; Got answer:\n;; -\u003e\u003eHEADER\u003c\u003c- opcode: QUERY, status: NXDOMAIN, id: 2420\n;; flags: qr aa; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 512\n;; QUESTION SECTION:\n;foo:bar.mattnordhoff.net.      IN      A\n\n;; Query time: 3 msec\n;; SERVER: 2606:4700:50::adf5:3a69#53(2606:4700:50::adf5:3a69)\n;; WHEN: Tue Apr 21 20:23:38 UTC 2020\n;; MSG SIZE  rcvd: 53\n\n$ dig +dnssec +norecurse @dana.ns.cloudflare.com foo:bar.mattnordhoff.net ds\n\n; \u003c\u003c\u003e\u003e DiG 9.17.1 \u003c\u003c\u003e\u003e +dnssec +norecurse @dana.ns.cloudflare.com\nfoo:bar.mattnordhoff.net ds\n; (2 servers found)\n;; global options: +cmd\n;; Got answer:\n;; -\u003e\u003eHEADER\u003c\u003c- opcode: QUERY, status: NXDOMAIN, id: 60683\n;; flags: qr aa; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 512\n;; QUESTION SECTION:\n;foo:bar.mattnordhoff.net.      IN      DS\n\n;; Query time: 3 msec\n;; SERVER: 2606:4700:50::adf5:3a69#53(2606:4700:50::adf5:3a69)\n;; WHEN: Tue Apr 21 20:24:41 UTC 2020\n;; MSG SIZE  rcvd: 53\n```\n\nA few minutes ago in #powerdns we were talking about wacky characters in DNS labels, so I queried that, and... got a supposedly authenticated NXDOMAIN back from PowerDNS Recursor!\n\n```\n$ dig +dnssec foo:bar.mattnordhoff.net\n\n; \u003c\u003c\u003e\u003e DiG 9.17.1 \u003c\u003c\u003e\u003e +dnssec foo:bar.mattnordhoff.net\n;; global options: +cmd\n;; Got answer:\n;; -\u003e\u003eHEADER\u003c\u003c- opcode: QUERY, status: NXDOMAIN, id: 3681\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 512\n;; QUESTION SECTION:\n;foo:bar.mattnordhoff.net.      IN      A\n\n;; Query time: 9 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Tue Apr 21 20:25:59 UTC 2020\n;; MSG SIZE  rcvd: 53\n```\n\nI'm running 4.4.0-alpha0.78.master.g63544077f and 4.4.0-alpha0.273.master.g8b82ded0a.\n\nI can also reproduce it with Quad9: Their Unbound instances return SERVFAIL and their PowerDNS Recursor instances return NXDOMAIN. (You can tell them apart by the advertised EDNS buffer size in responses.)\n\n```\n$ dig +dnssec $(uuidgen | sed s/-/:/g).mattnordhoff.net @dns.quad9.net\n\n; \u003c\u003c\u003e\u003e DiG 9.17.1 \u003c\u003c\u003e\u003e +dnssec\nce845380:447d:470a:8db9:9f29c7604913.mattnordhoff.net @dns.quad9.net\n;; global options: +cmd\n;; Got answer:\n;; -\u003e\u003eHEADER\u003c\u003c- opcode: QUERY, status: NXDOMAIN, id: 26361\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 512\n;; QUESTION SECTION:\n;ce845380:447d:470a:8db9:9f29c7604913.mattnordhoff.net. IN A\n\n;; Query time: 89 msec\n;; SERVER: 2620:fe::9#53(2620:fe::9)\n;; WHEN: Tue Apr 21 20:28:24 UTC 2020\n;; MSG SIZE  rcvd: 82\n\n$ dig +dnssec $(uuidgen | sed s/-/:/g).mattnordhoff.net @dns.quad9.net\n\n; \u003c\u003c\u003e\u003e DiG 9.17.1 \u003c\u003c\u003e\u003e +dnssec\n5f8c5c62:06f8:42e2:b834:39aa866b0788.mattnordhoff.net @dns.quad9.net\n;; global options: +cmd\n;; Got answer:\n;; -\u003e\u003eHEADER\u003c\u003c- opcode: QUERY, status: SERVFAIL, id: 43770\n;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 4096\n;; QUESTION SECTION:\n;5f8c5c62:06f8:42e2:b834:39aa866b0788.mattnordhoff.net. IN A\n\n;; Query time: 113 msec\n;; SERVER: 2620:fe::9#53(2620:fe::9)\n;; WHEN: Tue Apr 21 20:28:50 UTC 2020\n;; MSG SIZE  rcvd: 82\n```\n\n## Impact\n\nAn active network attacker can spoof NXDOMAIN within secure zones. The correct behavior is only SERVFAIL, but the difference could result in things like turning off DANE in SMTP connections.","vulnerability_information_html":"\u003cp\u003eHi! This is a slightly edited version of the email I sent to the project\u0026#39;s security contacts on 2020-04-21.\u003c/p\u003e\n\n\u003cp\u003eOpen-Xchange confirmed it and asked me to resubmit it here.\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eSubject: Recursor may be accepting unsigned, empty NXDOMAINs in secure zones\u003c/p\u003e\n\n\u003cp\u003eI can easily reproduce this against Cloudflare\u0026#39;s authoritative DNS (see below). I put \u0026quot;may be\u0026quot; in the subject because I\u0026#39;m uncomfortable sounding a red alert without checking another authoritative implementation, but I don\u0026#39;t know something available off hand.\u003c/p\u003e\n\n\u003cp\u003eBackground: Cloudflare\u0026#39;s authoritative DNS service has a funny issue where it will return an NXDOMAIN with no SOA or DNSSEC records if the query name has a : in it. (They know and don\u0026#39;t want to change it.) Try it with anything -- :.cloudflare.com, foo:bar.mattnordhoff.net, whatever.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ dig +dnssec +norecurse @dana.ns.cloudflare.com foo:bar.mattnordhoff.net\n\n; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.17.1 \u0026lt;\u0026lt;\u0026gt;\u0026gt; +dnssec +norecurse @dana.ns.cloudflare.com\nfoo:bar.mattnordhoff.net\n; (2 servers found)\n;; global options: +cmd\n;; Got answer:\n;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NXDOMAIN, id: 2420\n;; flags: qr aa; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 512\n;; QUESTION SECTION:\n;foo:bar.mattnordhoff.net.      IN      A\n\n;; Query time: 3 msec\n;; SERVER: 2606:4700:50::adf5:3a69#53(2606:4700:50::adf5:3a69)\n;; WHEN: Tue Apr 21 20:23:38 UTC 2020\n;; MSG SIZE  rcvd: 53\n\n$ dig +dnssec +norecurse @dana.ns.cloudflare.com foo:bar.mattnordhoff.net ds\n\n; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.17.1 \u0026lt;\u0026lt;\u0026gt;\u0026gt; +dnssec +norecurse @dana.ns.cloudflare.com\nfoo:bar.mattnordhoff.net ds\n; (2 servers found)\n;; global options: +cmd\n;; Got answer:\n;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NXDOMAIN, id: 60683\n;; flags: qr aa; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 512\n;; QUESTION SECTION:\n;foo:bar.mattnordhoff.net.      IN      DS\n\n;; Query time: 3 msec\n;; SERVER: 2606:4700:50::adf5:3a69#53(2606:4700:50::adf5:3a69)\n;; WHEN: Tue Apr 21 20:24:41 UTC 2020\n;; MSG SIZE  rcvd: 53\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eA few minutes ago in #powerdns we were talking about wacky characters in DNS labels, so I queried that, and... got a supposedly authenticated NXDOMAIN back from PowerDNS Recursor!\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ dig +dnssec foo:bar.mattnordhoff.net\n\n; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.17.1 \u0026lt;\u0026lt;\u0026gt;\u0026gt; +dnssec foo:bar.mattnordhoff.net\n;; global options: +cmd\n;; Got answer:\n;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NXDOMAIN, id: 3681\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 512\n;; QUESTION SECTION:\n;foo:bar.mattnordhoff.net.      IN      A\n\n;; Query time: 9 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Tue Apr 21 20:25:59 UTC 2020\n;; MSG SIZE  rcvd: 53\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI\u0026#39;m running 4.4.0-alpha0.78.master.g63544077f and 4.4.0-alpha0.273.master.g8b82ded0a.\u003c/p\u003e\n\n\u003cp\u003eI can also reproduce it with Quad9: Their Unbound instances return SERVFAIL and their PowerDNS Recursor instances return NXDOMAIN. (You can tell them apart by the advertised EDNS buffer size in responses.)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ dig +dnssec $(uuidgen | sed s/-/:/g).mattnordhoff.net @dns.quad9.net\n\n; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.17.1 \u0026lt;\u0026lt;\u0026gt;\u0026gt; +dnssec\nce845380:447d:470a:8db9:9f29c7604913.mattnordhoff.net @dns.quad9.net\n;; global options: +cmd\n;; Got answer:\n;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NXDOMAIN, id: 26361\n;; flags: qr rd ra ad; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 512\n;; QUESTION SECTION:\n;ce845380:447d:470a:8db9:9f29c7604913.mattnordhoff.net. IN A\n\n;; Query time: 89 msec\n;; SERVER: 2620:fe::9#53(2620:fe::9)\n;; WHEN: Tue Apr 21 20:28:24 UTC 2020\n;; MSG SIZE  rcvd: 82\n\n$ dig +dnssec $(uuidgen | sed s/-/:/g).mattnordhoff.net @dns.quad9.net\n\n; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.17.1 \u0026lt;\u0026lt;\u0026gt;\u0026gt; +dnssec\n5f8c5c62:06f8:42e2:b834:39aa866b0788.mattnordhoff.net @dns.quad9.net\n;; global options: +cmd\n;; Got answer:\n;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: SERVFAIL, id: 43770\n;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags: do; udp: 4096\n;; QUESTION SECTION:\n;5f8c5c62:06f8:42e2:b834:39aa866b0788.mattnordhoff.net. IN A\n\n;; Query time: 113 msec\n;; SERVER: 2620:fe::9#53(2620:fe::9)\n;; WHEN: Tue Apr 21 20:28:50 UTC 2020\n;; MSG SIZE  rcvd: 82\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAn active network attacker can spoof NXDOMAIN within secure zones. The correct behavior is only SERVFAIL, but the difference could result in things like turning off DANE in SMTP connections.\u003c/p\u003e\n","bounty_amount":"400.0","formatted_bounty":"$400","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":5,"voters":["mygf","h2x0","sa1tama0","faisalw","akshay67"],"severity":{"rating":"medium","score":4.8,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"low","availability":"low"}},"structured_scope":{"databaseId":42903,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/PowerDNS/pdns","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":7787817,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Issue has been confirmed on our side.","markdown_message":"\u003cp\u003eIssue has been confirmed on our side.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-04-24T21:22:00.158Z","updated_at":"2020-04-24T21:22:00.158Z","actor":{"username":"peter_van-dijk","cleared":false,"url":"/peter_van-dijk","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7789331,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I didn't notice this until now because I use a version of `dig` with cookies on by default, but apparently the packet cache will continue serving the `NXDOMAIN` for a surprisingly long period of time -- at least a few minutes -- even though something without an `SOA` record should be cached briefly, or not at all.\n\nThat might be a whole 'nother issue...\n\n(If you bypass the packet cache by using cookies or something, the Recursor will make fresh `DS` and \u003cquery type\u003e queries every time.)\n\nI assumed it was uncacheable, and therefore not very valuable to traditional \"spam the server with millions of responses\" cache poisoning attackers, but apparently I was wrong...","markdown_message":"\u003cp\u003eI didn\u0026#39;t notice this until now because I use a version of \u003ccode\u003edig\u003c/code\u003e with cookies on by default, but apparently the packet cache will continue serving the \u003ccode\u003eNXDOMAIN\u003c/code\u003e for a surprisingly long period of time -- at least a few minutes -- even though something without an \u003ccode\u003eSOA\u003c/code\u003e record should be cached briefly, or not at all.\u003c/p\u003e\n\n\u003cp\u003eThat might be a whole \u0026#39;nother issue...\u003c/p\u003e\n\n\u003cp\u003e(If you bypass the packet cache by using cookies or something, the Recursor will make fresh \u003ccode\u003eDS\u003c/code\u003e and \u0026lt;query type\u0026gt; queries every time.)\u003c/p\u003e\n\n\u003cp\u003eI assumed it was uncacheable, and therefore not very valuable to traditional \u0026quot;spam the server with millions of responses\u0026quot; cache poisoning attackers, but apparently I was wrong...\u003c/p\u003e\n","automated_response":false,"created_at":"2020-04-25T04:55:21.536Z","updated_at":"2020-04-25T04:55:21.536Z","actor":{"username":"mnordhoff","cleared":false,"url":"/mnordhoff","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7804488,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-04-27T08:10:42.736Z","updated_at":"2020-04-27T08:10:42.736Z","cve_ids":["CVE-2020-12244"],"actor":{"username":"rgacogne","cleared":false,"url":"/rgacogne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/055/239/a3503ea8f701a567579e9aa3c6eebafbec50fe2d_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7811196,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-04-27T15:49:56.402Z","updated_at":"2020-04-27T15:49:56.402Z","additional_data":{"old_severity":null,"new_severity":"Medium (4.8)","old_severity_id":null,"new_severity_id":704925},"actor":{"username":"rgacogne","cleared":false,"url":"/rgacogne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/055/239/a3503ea8f701a567579e9aa3c6eebafbec50fe2d_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7811351,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello Matt!\n\nThanks a lot for reporting this! We have reproduced the issue from 4.1.0 to master, and we are currently testing the following patch to resolve it:\n```\ndiff --git a/pdns/syncres.cc b/pdns/syncres.cc\nindex c62099ba4..16ad3860a 100644\n--- a/pdns/syncres.cc\n+++ b/pdns/syncres.cc\n@@ -2657,6 +2657,10 @@ bool SyncRes::processAnswer(unsigned int depth, LWResult\u0026 lwr, const DNSName\u0026 qn\n   if(lwr.d_rcode == RCode::NXDomain) {\n     LOG(prefix\u003c\u003cqname\u003c\u003c\": status=NXDOMAIN, we are done \"\u003c\u003c(negindic ? \"(have negative SOA)\" : \"\")\u003c\u003cendl);\n \n+    if (state == Secure \u0026\u0026 (lwr.d_aabit || sendRDQuery) \u0026\u0026 !negindic) {\n+      updateValidationState(state, Bogus);\n+    }\n+\n     if(d_doDNSSEC)\n       addNXNSECS(ret, lwr.d_records);\n```\n\nAs for the packet cache issue, we do cache an entry for as long as the lowest between the smallest TTL in the answer or `packetcache-ttl`. In that case we have no records in the answer so we use `packetcache-ttl`, which defaults to 3600s. I guess we could do something smarter here, from refusing to cache an answer with no records (which is what dnsdist does) to using a smaller TTL (perhaps `packetcache-servfail-ttl` would make sense).\n\nBest regards,\n\nRemi","markdown_message":"\u003cp\u003eHello Matt!\u003c/p\u003e\n\n\u003cp\u003eThanks a lot for reporting this! We have reproduced the issue from 4.1.0 to master, and we are currently testing the following patch to resolve it:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gh\"\u003ediff --git a/pdns/syncres.cc b/pdns/syncres.cc\nindex c62099ba4..16ad3860a 100644\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- a/pdns/syncres.cc\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/pdns/syncres.cc\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -2657,6 +2657,10 @@\u003c/span\u003e bool SyncRes::processAnswer(unsigned int depth, LWResult\u0026amp; lwr, const DNSName\u0026amp; qn\n   if(lwr.d_rcode == RCode::NXDomain) {\n     LOG(prefix\u0026lt;\u0026lt;qname\u0026lt;\u0026lt;\u0026quot;: status=NXDOMAIN, we are done \u0026quot;\u0026lt;\u0026lt;(negindic ? \u0026quot;(have negative SOA)\u0026quot; : \u0026quot;\u0026quot;)\u0026lt;\u0026lt;endl);\n\n+    if (state == Secure \u0026amp;\u0026amp; (lwr.d_aabit || sendRDQuery) \u0026amp;\u0026amp; !negindic) {\n\u003cspan class=\"gi\"\u003e+      updateValidationState(state, Bogus);\n+    }\n+\n\u003c/span\u003e     if(d_doDNSSEC)\n       addNXNSECS(ret, lwr.d_records);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs for the packet cache issue, we do cache an entry for as long as the lowest between the smallest TTL in the answer or \u003ccode\u003epacketcache-ttl\u003c/code\u003e. In that case we have no records in the answer so we use \u003ccode\u003epacketcache-ttl\u003c/code\u003e, which defaults to 3600s. I guess we could do something smarter here, from refusing to cache an answer with no records (which is what dnsdist does) to using a smaller TTL (perhaps \u003ccode\u003epacketcache-servfail-ttl\u003c/code\u003e would make sense).\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003c/p\u003e\n\n\u003cp\u003eRemi\u003c/p\u003e\n","automated_response":false,"created_at":"2020-04-27T15:58:29.285Z","updated_at":"2020-04-27T15:58:29.285Z","actor":{"username":"rgacogne","cleared":false,"url":"/rgacogne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/055/239/a3503ea8f701a567579e9aa3c6eebafbec50fe2d_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7815852,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the update and the information!\n\nI'm sorry it goes back that far, but it's good news if such a small patch is successful.\n\nIf it's alright with you, I can file a (public GitHub) issue about the packet cache thing after this is over? It can easily be reproduced without drawing attention to this CVE, but it's not necessary to rush either.","markdown_message":"\u003cp\u003eThank you for the update and the information!\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m sorry it goes back that far, but it\u0026#39;s good news if such a small patch is successful.\u003c/p\u003e\n\n\u003cp\u003eIf it\u0026#39;s alright with you, I can file a (public GitHub) issue about the packet cache thing after this is over? It can easily be reproduced without drawing attention to this CVE, but it\u0026#39;s not necessary to rush either.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-04-27T23:04:19.554Z","updated_at":"2020-04-27T23:04:19.554Z","actor":{"username":"mnordhoff","cleared":false,"url":"/mnordhoff","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7826293,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e If it's alright with you, I can file a (public GitHub) issue about the packet cache thing after this is over? It can easily be reproduced without drawing attention to this CVE, but it's not necessary to rush either.\n\nThat would be great, thanks a lot!","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003eIf it\u0026#39;s alright with you, I can file a (public GitHub) issue about the packet cache thing after this is over? It can easily be reproduced without drawing attention to this CVE, but it\u0026#39;s not necessary to rush either.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThat would be great, thanks a lot!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-04-28T15:17:49.406Z","updated_at":"2020-04-28T15:17:49.406Z","actor":{"username":"rgacogne","cleared":false,"url":"/rgacogne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/055/239/a3503ea8f701a567579e9aa3c6eebafbec50fe2d_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7826302,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just so you know, this issue has been assigned CVE-2020-12244 by MITRE.","markdown_message":"\u003cp\u003eJust so you know, this issue has been assigned CVE-2020-12244 by MITRE.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-04-28T15:18:37.951Z","updated_at":"2020-04-28T15:18:37.951Z","actor":{"username":"rgacogne","cleared":false,"url":"/rgacogne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/055/239/a3503ea8f701a567579e9aa3c6eebafbec50fe2d_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8049975,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again for reporting this issue! The amount of the bounty is computed based on the severity, but we are very happy to add a small bonus for the outstanding quality of your report.","markdown_message":"\u003cp\u003eThanks again for reporting this issue! The amount of the bounty is computed based on the severity, but we are very happy to add a small bonus for the outstanding quality of your report.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-19T15:58:07.856Z","updated_at":"2020-05-19T15:58:07.856Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"350.0","bounty_currency":"usd","bonus_amount":"50.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"mnordhoff","url":"/mnordhoff"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8049977,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-19T15:58:39.473Z","updated_at":"2020-05-19T15:58:39.473Z","actor":{"username":"rgacogne","cleared":false,"url":"/rgacogne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/055/239/a3503ea8f701a567579e9aa3c6eebafbec50fe2d_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"mnordhoff","url":"/mnordhoff"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8050238,"is_internal":false,"editable":false,"type":"Activities::Comment","message":":O\n\nThank you!\n\n(It was my first official CVE, whoo hoo!)","markdown_message":"\u003cp\u003e:O\u003c/p\u003e\n\n\u003cp\u003eThank you!\u003c/p\u003e\n\n\u003cp\u003e(It was my first official CVE, whoo hoo!)\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-19T16:36:26.042Z","updated_at":"2020-05-19T16:36:26.042Z","actor":{"username":"mnordhoff","cleared":false,"url":"/mnordhoff","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8051253,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Question! Can I talk about this publicly?\n\nI don't have anything to say, but I'd still like to know. :P\n\nNew releases are out, the sec advisory is public, but this report is still private, and HackerOne has scary language regarding confidentiality.","markdown_message":"\u003cp\u003eQuestion! Can I talk about this publicly?\u003c/p\u003e\n\n\u003cp\u003eI don\u0026#39;t have anything to say, but I\u0026#39;d still like to know. :P\u003c/p\u003e\n\n\u003cp\u003eNew releases are out, the sec advisory is public, but this report is still private, and HackerOne has scary language regarding confidentiality.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-19T18:13:38.982Z","updated_at":"2020-05-19T18:13:38.982Z","actor":{"username":"mnordhoff","cleared":false,"url":"/mnordhoff","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8055085,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e Question! Can I talk about this publicly?\n\nSure, go ahead! Thank you for asking :-)","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003eQuestion! Can I talk about this publicly?\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eSure, go ahead! Thank you for asking :-)\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-20T07:06:23.324Z","updated_at":"2020-05-20T07:06:23.324Z","actor":{"username":"rgacogne","cleared":false,"url":"/rgacogne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/055/239/a3503ea8f701a567579e9aa3c6eebafbec50fe2d_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8055121,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-20T07:14:05.775Z","updated_at":"2020-05-20T07:14:05.775Z","first_to_agree":true,"actor":{"username":"rgacogne","cleared":false,"url":"/rgacogne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/055/239/a3503ea8f701a567579e9aa3c6eebafbec50fe2d_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8059062,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-20T14:20:04.638Z","updated_at":"2020-05-20T14:20:04.638Z","actor":{"username":"mnordhoff","cleared":false,"url":"/mnordhoff","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8059063,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-20T14:20:04.678Z","updated_at":"2020-05-20T14:20:04.678Z","actor":{"username":"mnordhoff","cleared":false,"url":"/mnordhoff","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8082790,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"For posterity, I'll note that the packet cache thing was filed as https://github.com/PowerDNS/pdns/issues/9135.","markdown_message":"\u003cp\u003eFor posterity, I\u0026#39;ll note that the packet cache thing was filed as \u003ca title=\"https://github.com/PowerDNS/pdns/issues/9135\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FPowerDNS%2Fpdns%2Fissues%2F9135\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/PowerDNS/pdns/issues/9135\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-22T19:33:34.175Z","updated_at":"2020-05-22T19:33:34.175Z","actor":{"username":"mnordhoff","cleared":false,"url":"/mnordhoff","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}