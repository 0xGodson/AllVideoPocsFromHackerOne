{"id":168108,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjgxMDg=","url":"https://hackerone.com/reports/168108","title":"SSO Authentication Bypass","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-09-13T19:15:09.748Z","submitted_at":"2016-09-13T19:15:09.748Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"danielhartnell","url":"/danielhartnell","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17011,"url":"https://hackerone.com/newrelic","handle":"newrelic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"New Relic","twitter_handle":"newrelic","website":"https://newrelic.com","about":"New Relic's Coordinated Disclosure Program"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-02-18T03:23:48.191Z","bug_reporter_agreed_on_going_public_at":"2017-02-18T03:23:48.141Z","team_member_agreed_on_going_public_at":"2017-02-18T01:42:16.037Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nAs I reported to security@newrelic.com, here's the authentication bypass vulnerability report. I've left some details out in this report but you're welcome to reach out to me with any questions.\n\nHere's a more detailed overview:\n\n# SSO Authentication Bypass\n\n## Summary\n\nIt is possible to POST a custom SAML response to https://rpm.newrelic.com/accounts/$account_id/sso/saml/finalize and bypass authentication. When a SAML response is built by an identity provider, like Okta, it should be signed with an X.509 certificate. We should be confirming that the signed SAML response is valid but it appears that we’re overlooking that. This is described here: https://developers.onelogin.com/saml\n\nRequirements to exploit this vulnerability: An account ID (for an SSO-enabled account) and user email are required.\n\n## Proof of concept\n\nI wrote a simple proof of concept to help illustrate this problem. The file, `nr-saml-poc.html` was emailed to security@newrelic.com in my initial report. You can open it in your browser and provide an account ID and user email and then POST the base64 encoded payload to New Relic. This should result in successful authentication.\n\n## Recommendations\n\nI believe that if we ensure that the signed response is valid, it should be sufficient to resolve this issue. Unfortunately I have not had a lot of time to explore this issue and I think it would be good to review this in depth to make sure I have not missed any other important details.","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eAs I reported to \u003ca title=\"security@newrelic.com\" href=\"mailto:security@newrelic.com\" rel=\"nofollow noopener noreferrer\"\u003esecurity@newrelic.com\u003c/a\u003e, here\u0026#39;s the authentication bypass vulnerability report. I\u0026#39;ve left some details out in this report but you\u0026#39;re welcome to reach out to me with any questions.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026#39;s a more detailed overview:\u003c/p\u003e\n\n\u003ch1 id=\"sso-authentication-bypass\"\u003eSSO Authentication Bypass\u003c/h1\u003e\n\n\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003eIt is possible to POST a custom SAML response to \u003ca title=\"https://rpm.newrelic.com/accounts/$account_id/sso/saml/finalize\" href=\"/redirect?url=https%3A%2F%2Frpm.newrelic.com%2Faccounts%2F%24account_id%2Fsso%2Fsaml%2Ffinalize\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://rpm.newrelic.com/accounts/$account_id/sso/saml/finalize\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and bypass authentication. When a SAML response is built by an identity provider, like Okta, it should be signed with an X.509 certificate. We should be confirming that the signed SAML response is valid but it appears that we’re overlooking that. This is described here: \u003ca title=\"https://developers.onelogin.com/saml\" href=\"/redirect?url=https%3A%2F%2Fdevelopers.onelogin.com%2Fsaml\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://developers.onelogin.com/saml\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eRequirements to exploit this vulnerability: An account ID (for an SSO-enabled account) and user email are required.\u003c/p\u003e\n\n\u003ch2 id=\"proof-of-concept\"\u003eProof of concept\u003c/h2\u003e\n\n\u003cp\u003eI wrote a simple proof of concept to help illustrate this problem. The file, \u003ccode\u003enr-saml-poc.html\u003c/code\u003e was emailed to \u003ca title=\"security@newrelic.com\" href=\"mailto:security@newrelic.com\" rel=\"nofollow noopener noreferrer\"\u003esecurity@newrelic.com\u003c/a\u003e in my initial report. You can open it in your browser and provide an account ID and user email and then POST the base64 encoded payload to New Relic. This should result in successful authentication.\u003c/p\u003e\n\n\u003ch2 id=\"recommendations\"\u003eRecommendations\u003c/h2\u003e\n\n\u003cp\u003eI believe that if we ensure that the signed response is valid, it should be sufficient to resolve this issue. Unfortunately I have not had a lot of time to explore this issue and I think it would be good to review this in depth to make sure I have not missed any other important details.\u003c/p\u003e\n","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-03-20T01:42:16.101Z","allow_singular_disclosure_after":-119242672.34141915,"singular_disclosure_allowed":true,"vote_count":12,"voters":["lukasreschke","arneswinnen","bogdantcaciuc","mpz","eveeez","khizer47","paulos_","spetr0x","filepicker","rajani1","and 2 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1193810,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2016-09-14T16:09:19.654Z","updated_at":"2016-09-14T16:09:19.654Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1193815,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey Daniel,\n\nWe've filed a ticket w/ the engineering team responsible for this issue and a fix is underway. Thanks again for the awesome find!","markdown_message":"\u003cp\u003eHey Daniel,\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;ve filed a ticket w/ the engineering team responsible for this issue and a fix is underway. Thanks again for the awesome find!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-14T16:10:28.750Z","updated_at":"2016-09-14T16:10:28.750Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1205300,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Daniel,\n\nThe fix for this went out today. Can you please verify that the fix addresses the issue you reported?\n\nThanks!","markdown_message":"\u003cp\u003eHi Daniel,\u003c/p\u003e\n\n\u003cp\u003eThe fix for this went out today. Can you please verify that the fix addresses the issue you reported?\u003c/p\u003e\n\n\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-19T23:08:46.452Z","updated_at":"2016-09-19T23:08:46.452Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1205302,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @mlapworth,\n\nThanks for letting me know! I'll have some time to evaluate the fix over the next day or two. I'll let you know what I find.\n\nRegards,\nDaniel","markdown_message":"\u003cp\u003eHey \u003ca href=\"/mlapworth\"\u003e@mlapworth\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks for letting me know! I\u0026#39;ll have some time to evaluate the fix over the next day or two. I\u0026#39;ll let you know what I find.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nDaniel\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-19T23:11:14.108Z","updated_at":"2016-09-19T23:11:14.108Z","actor":{"username":"danielhartnell","cleared":false,"url":"/danielhartnell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1207115,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @mlapworth,\n\nBased on my testing, it looks like this issue has been fixed! Thanks for being awesome :)\n\nRegards,\nDaniel","markdown_message":"\u003cp\u003eHey \u003ca href=\"/mlapworth\"\u003e@mlapworth\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eBased on my testing, it looks like this issue has been fixed! Thanks for being awesome :)\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nDaniel\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-20T16:46:34.972Z","updated_at":"2016-09-20T16:46:34.972Z","actor":{"username":"danielhartnell","cleared":false,"url":"/danielhartnell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1207418,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank YOU for your report!","markdown_message":"\u003cp\u003eThank YOU for your report!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-20T18:58:45.697Z","updated_at":"2016-09-20T18:58:45.697Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1207419,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-09-20T18:58:51.785Z","updated_at":"2016-09-20T18:58:51.785Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"danielhartnell","url":"/danielhartnell"},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1492478,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-18T01:42:16.072Z","updated_at":"2017-02-18T01:42:16.072Z","first_to_agree":true,"actor":{"username":"imelven","cleared":false,"url":"/imelven","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/153/809e507ea6cd7c5c120920d1d4ce70336974d422_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1492488,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @imelven,\n\nPublic disclosure's fine with me! Thanks!","markdown_message":"\u003cp\u003eHey \u003ca href=\"/imelven\"\u003e@imelven\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003ePublic disclosure\u0026#39;s fine with me! Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-18T02:00:08.965Z","updated_at":"2017-02-18T02:00:08.965Z","actor":{"username":"danielhartnell","cleared":false,"url":"/danielhartnell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1492511,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-18T03:23:48.160Z","updated_at":"2017-02-18T03:23:48.160Z","actor":{"username":"danielhartnell","cleared":false,"url":"/danielhartnell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1492512,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-18T03:23:48.205Z","updated_at":"2017-02-18T03:23:48.205Z","actor":{"username":"danielhartnell","cleared":false,"url":"/danielhartnell","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2694211,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-03T03:27:50.463Z","updated_at":"2018-05-03T03:27:50.463Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"New Relic"}},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}