{"id":271960,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNzE5NjA=","url":"https://hackerone.com/reports/271960","title":"Client-side Template Injection in Search, user email/token leak and maybe sandbox escape","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-09-26T13:17:48.784Z","submitted_at":"2017-09-26T13:17:48.784Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"europa","url":"/europa","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2143,"url":"https://hackerone.com/rockstargames","handle":"rockstargames","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Rockstar Games","twitter_handle":"RockstarGames","website":"http://www.rockstargames.com/","about":"Publishers of such popular games as Grand Theft Auto, Max Payne, Red Dead Redemption, L.A. Noire, Bully \u0026 more."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-05-01T15:37:55.437Z","bug_reporter_agreed_on_going_public_at":"2018-04-08T13:44:48.634Z","team_member_agreed_on_going_public_at":"2018-05-01T15:37:55.290Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-05-08T13:44:48.756Z","allow_singular_disclosure_after":-83432073.14402458,"singular_disclosure_allowed":true,"vote_count":13,"voters":["jokebookservice1","sp1d3rs","europa","muon4","bl4de","fa1rlight","eveeez","13ern","lordjerry0x01","khizer47","and 3 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":440,"asset_type":"URL","asset_identifier":"support.rockstargames.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2024345,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-26T14:42:11.792Z","updated_at":"2017-09-26T14:42:11.792Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2025356,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-26T17:51:59.354Z","updated_at":"2017-09-26T18:06:23.403Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2026609,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-27T06:47:11.226Z","updated_at":"2017-09-27T06:47:11.226Z","actor":{"username":"joystick","cleared":false,"url":"/joystick","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/167/228/0840eb314aa099d9369d475d9ef9ba6299e83822_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2026614,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-27T06:50:16.871Z","updated_at":"2017-09-27T06:50:16.871Z","actor":{"username":"joystick","cleared":false,"url":"/joystick","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/167/228/0840eb314aa099d9369d475d9ef9ba6299e83822_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2026911,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-27T09:46:05.196Z","updated_at":"2017-09-27T09:46:05.196Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2027012,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-27T10:54:36.909Z","updated_at":"2017-09-27T11:01:22.640Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2032804,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-29T14:52:42.417Z","updated_at":"2017-09-29T14:52:42.417Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2033147,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-29T17:19:52.261Z","updated_at":"2017-09-29T17:19:52.261Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2033688,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-29T19:17:00.583Z","updated_at":"2017-09-29T19:17:00.583Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2041845,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-03T19:42:52.591Z","updated_at":"2017-10-03T19:42:52.591Z","actor":{"url":"/rockstargames","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Rockstar Games"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"rockstargames","collaborator":{"username":"europa","url":"/europa"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2041993,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-03T20:49:21.921Z","updated_at":"2017-10-03T20:49:21.921Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2057524,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-10T21:46:59.619Z","updated_at":"2017-10-10T21:48:12.190Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2113281,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-30T15:08:01.814Z","updated_at":"2017-10-30T15:08:01.814Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2113482,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-30T15:48:46.108Z","updated_at":"2017-10-30T15:53:38.685Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2113501,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-30T15:52:41.997Z","updated_at":"2017-10-30T15:52:41.997Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2132609,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-03T17:58:29.283Z","updated_at":"2017-11-03T18:00:24.334Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2160110,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-15T18:47:54.484Z","updated_at":"2017-11-15T18:47:54.484Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2160123,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-15T18:54:42.720Z","updated_at":"2017-11-15T18:54:42.720Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2160143,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-15T19:11:34.253Z","updated_at":"2017-11-15T19:11:34.253Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"europa","url":"/europa"},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2578409,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-08T13:44:48.674Z","updated_at":"2018-04-08T13:44:48.674Z","first_to_agree":true,"actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2686783,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-01T15:37:55.333Z","updated_at":"2018-05-01T15:37:55.333Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2686784,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-01T15:37:55.476Z","updated_at":"2018-05-01T15:37:55.476Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":7282,"category":"team","content":"In this report, the researcher was able to perform [AngularJS Template Injection](https://hackerone.com/redirect?signature=49c7114e65f27ab7700511ac15aaa633cf22a68b\u0026url=http%3A%2F%2Fblog.portswigger.net%2F2016%2F01%2Fxss-without-html-client-side-template.html) on our Support site in order to retrieve data, including email address, userid and tokens. Typically, a user is always able to retrieve this information about themselves and on its own, this is known behavior. However, by utilizing a manipulated Avatar URI value, the researcher was able to demonstrate how an attacker could exfiltrate *another* user's email, userid, and tokens to an external server owned by the attacker. The researcher was further able to demonstrate other types of attacks possible via AngularJS Template Injection, but the most interesting one to us was the data exfiltration POC.\n\nWe resolved this issue by updating our version of AngularJS, and by applying the `ng-non-bindable` directive to the vulnerable fields. This directive prevents AngularJS from compiling or binding the contents of the current DOM element, making it effective at preventing XSS and Code Injection attacks.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eIn this report, the researcher was able to perform \u003ca href=\"https://hackerone.com/redirect?signature=49c7114e65f27ab7700511ac15aaa633cf22a68b\u0026amp;url=http%3A%2F%2Fblog.portswigger.net%2F2016%2F01%2Fxss-without-html-client-side-template.html\"\u003eAngularJS Template Injection\u003c/a\u003e on our Support site in order to retrieve data, including email address, userid and tokens. Typically, a user is always able to retrieve this information about themselves and on its own, this is known behavior. However, by utilizing a manipulated Avatar URI value, the researcher was able to demonstrate how an attacker could exfiltrate \u003cem\u003eanother\u003c/em\u003e user\u0026#39;s email, userid, and tokens to an external server owned by the attacker. The researcher was further able to demonstrate other types of attacks possible via AngularJS Template Injection, but the most interesting one to us was the data exfiltration POC.\u003c/p\u003e\n\n\u003cp\u003eWe resolved this issue by updating our version of AngularJS, and by applying the \u003ccode\u003eng-non-bindable\u003c/code\u003e directive to the vulnerable fields. This directive prevents AngularJS from compiling or binding the contents of the current DOM element, making it effective at preventing XSS and Code Injection attacks.\u003c/p\u003e\n"},{"id":5437,"category":"researcher","content":"Sometimes you don't need a fully-fledged XSS to leak useful data!\n\nAn [AngularJS template injection](http://blog.portswigger.net/2016/01/xss-without-html-client-side-template.html) was possible in the search field giving me access to the whole AngularJS scope for the page.\n\nBy traversing the DOM via childHead / nextSibling objects it was possible to grab informations from the active scope (ie: email, userid, and tokens); subsequently manipulating the victim's avatar URL to a resource on an adversary-controlled server allowed the attacker to exfiltrate session details without strictly relying on Javascript injection, delivering the goodies through simple GET requests.\n\nA sandbox escape was found later on rendering the unorthodox approach unnecessary, but extremely fun nonetheless—also given the fact that Rockstar Games decided scoped this flaw as a Reflected XSS before that happened.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eSometimes you don\u0026#39;t need a fully-fledged XSS to leak useful data!\u003c/p\u003e\n\n\u003cp\u003eAn \u003ca href=\"/redirect?url=http%3A%2F%2Fblog.portswigger.net%2F2016%2F01%2Fxss-without-html-client-side-template.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eAngularJS template injection\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e was possible in the search field giving me access to the whole AngularJS scope for the page.\u003c/p\u003e\n\n\u003cp\u003eBy traversing the DOM via childHead / nextSibling objects it was possible to grab informations from the active scope (ie: email, userid, and tokens); subsequently manipulating the victim\u0026#39;s avatar URL to a resource on an adversary-controlled server allowed the attacker to exfiltrate session details without strictly relying on Javascript injection, delivering the goodies through simple GET requests.\u003c/p\u003e\n\n\u003cp\u003eA sandbox escape was found later on rendering the unorthodox approach unnecessary, but extremely fun nonetheless—also given the fact that Rockstar Games decided scoped this flaw as a Reflected XSS before that happened.\u003c/p\u003e\n"}]}