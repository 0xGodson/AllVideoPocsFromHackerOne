{"id":767482,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83Njc0ODI=","url":"https://hackerone.com/reports/767482","title":"Java Debug Console Provides Command Injection Without Privellage Esclation","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2020-01-03T05:59:05.336Z","submitted_at":"2020-01-03T05:59:05.336Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rpbeast33","url":"/rpbeast33","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/1xZdqyMDpFF8F1pVHhPfZrk1/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":41919,"url":"https://hackerone.com/mtn_group","handle":"mtn_group","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/F81QA4NLiRgbof5FRQvj1SJG/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/F81QA4NLiRgbof5FRQvj1SJG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"MTN Group","twitter_handle":"","website":"https://www.mtn.com/","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-07-23T17:03:55.662Z","bug_reporter_agreed_on_going_public_at":"2020-06-23T17:03:54.655Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\n\n   I intially found the debug console as a tool to insert arbitrary html/xss bugs, however after further probing the debug console it has some serious security flaws to allow arbitrary java code to be executed. My intial report of a seperate bug using this console, https://hackerone.com/reports/767077, uses the out.print functionality to write html code into the jsp page to perform a XSS attack. This intself is a dangerous bug for compromising users of the webapp. However, what is even more dangerous is allowing any abritratry java code to be executed on the server that an attacker controls. This is exactly what the debug console allows. The console spawns calls the execute.jsp page and then spawns a new .jsp page to give back to the user. Within this scope, the java code that the user/attacker writes is excuted on the server with the privellages given to the new .jsp file under the auspcies of the execute.jsp file. What does this mean? Well, an attacker can write custom .jsp files with native java code to do all sorts of malicous things, which includes Local File Inclusion and overwriting/changing source code - among other attacks. \n\n\n## Steps To Reproduce:\n\n\n  1. Visit: http://ptldynamicgame.mtn.sd/portal-api/tools/debug_console/index.jsp\n  2. Write any java code you want to be excuted:\n\n\n####PoC Java Code:\nout.print(\"LOCAL FILE DATA\");\nout.print(\":\");%\u003e\n\u003c%@ page import=\"java.util.Random\"%\u003e\n\u003c%@ page import=\"java.io.*\"%\u003e\n\u003c%\nout.println(\"\\n\");\nFile file = new File(\"/etc/mime.types\"); \nBufferedReader br = new BufferedReader(new FileReader(file)); \nString st;\nwhile ((st = br.readLine()) != null)  \n{ out.println(st); };%\u003e\n\u003c% out.println(\"Exit\");\n\n        Here please note the custom import of java.io.* for file reading purposes.\n        As you can see, you can directly import native java code into the .jsp file by closing your opening tag %\u003e and then using \n        your own custom \u003c% %\u003e tags afterwords. At the end also note the \u003c% to ensure the floating tag from the template jsp is closed\n\n## Supporting Material/References:\n\nAs stated in my intro, this is similar to my other reported bug found here https://hackerone.com/reports/767077 , but is actually quite different in its attack vector and impact. This represents a uniquely different bug due to the fact you are able to execute java code on the server and thus you are attacking the server rather than performing an XSS attack to target clients of the webapp. Overall, in my opinion these are two distinct bugs that just use the same console as its source. Also what is key to note is you do not have to get the current runtime enviroment of java to execute malicous commands, which in itself would be another crtical bug.\n\n## Impact\n\nOverall the impact for this is critical. In my PoC I demonstrated how you can run attacker controlled java code to read local files, which in itself is a huge bug. However, the power of this bug comes from the ability to really craft the payload to do whatever an attacker desires on your site. Overall, this bug leads to Remote Code Execution which is critical to compromising a server.","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003eI intially found the debug console as a tool to insert arbitrary html/xss bugs, however after further probing the debug console it has some serious security flaws to allow arbitrary java code to be executed. My intial report of a seperate bug using this console, \u003ca title=\"https://hackerone.com/reports/767077\" href=\"https://hackerone.com/reports/767077\"\u003ehttps://hackerone.com/reports/767077\u003c/a\u003e, uses the out.print functionality to write html code into the jsp page to perform a XSS attack. This intself is a dangerous bug for compromising users of the webapp. However, what is even more dangerous is allowing any abritratry java code to be executed on the server that an attacker controls. This is exactly what the debug console allows. The console spawns calls the execute.jsp page and then spawns a new .jsp page to give back to the user. Within this scope, the java code that the user/attacker writes is excuted on the server with the privellages given to the new .jsp file under the auspcies of the execute.jsp file. What does this mean? Well, an attacker can write custom .jsp files with native java code to do all sorts of malicous things, which includes Local File Inclusion and overwriting/changing source code - among other attacks. \u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eVisit: \u003ca title=\"http://ptldynamicgame.mtn.sd/portal-api/tools/debug_console/index.jsp\" href=\"/redirect?url=http%3A%2F%2Fptldynamicgame.mtn.sd%2Fportal-api%2Ftools%2Fdebug_console%2Findex.jsp\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://ptldynamicgame.mtn.sd/portal-api/tools/debug_console/index.jsp\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eWrite any java code you want to be excuted:\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch4 id=\"poc-java-code\"\u003ePoC Java Code:\u003c/h4\u003e\n\n\u003cp\u003eout.print(\u0026quot;LOCAL FILE DATA\u0026quot;);\u003cbr\u003e\nout.print(\u0026quot;:\u0026quot;);%\u0026gt;\u003cbr\u003e\n\u0026lt;%@ page import=\u0026quot;java.util.Random\u0026quot;%\u0026gt;\u003cbr\u003e\n\u0026lt;%@ page import=\u0026quot;java.io.*\u0026quot;%\u0026gt;\u003cbr\u003e\n\u0026lt;%\u003cbr\u003e\nout.println(\u0026quot;\\n\u0026quot;);\u003cbr\u003e\nFile file = new File(\u0026quot;/etc/mime.types\u0026quot;); \u003cbr\u003e\nBufferedReader br = new BufferedReader(new FileReader(file)); \u003cbr\u003e\nString st;\u003cbr\u003e\nwhile ((st = br.readLine()) != null)\u003cbr\u003e\u003cbr\u003e\n{ out.println(st); };%\u0026gt;\u003cbr\u003e\n\u0026lt;% out.println(\u0026quot;Exit\u0026quot;);\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e    Here please note the custom import of java.io.* for file reading purposes.\n    As you can see, you can directly import native java code into the .jsp file by closing your opening tag %\u0026gt; and then using \n    your own custom \u0026lt;% %\u0026gt; tags afterwords. At the end also note the \u0026lt;% to ensure the floating tag from the template jsp is closed\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cp\u003eAs stated in my intro, this is similar to my other reported bug found here \u003ca title=\"https://hackerone.com/reports/767077\" href=\"https://hackerone.com/reports/767077\"\u003ehttps://hackerone.com/reports/767077\u003c/a\u003e , but is actually quite different in its attack vector and impact. This represents a uniquely different bug due to the fact you are able to execute java code on the server and thus you are attacking the server rather than performing an XSS attack to target clients of the webapp. Overall, in my opinion these are two distinct bugs that just use the same console as its source. Also what is key to note is you do not have to get the current runtime enviroment of java to execute malicous commands, which in itself would be another crtical bug.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eOverall the impact for this is critical. In my PoC I demonstrated how you can run attacker controlled java code to read local files, which in itself is a huge bug. However, the power of this bug comes from the ability to really craft the payload to do whatever an attacker desires on your site. Overall, this bug leads to Remote Code Execution which is critical to compromising a server.\u003c/p\u003e\n","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-07-23T17:03:54.722Z","allow_singular_disclosure_after":-13700692.019414432,"singular_disclosure_allowed":true,"vote_count":6,"voters":["everybodyhurts","rpbeast33","vishalchauhan2212","sa1tama0","khaliz","v13rsba"],"severity":{"rating":"critical","author_type":"User"},"structured_scope":{"databaseId":34322,"asset_type":"URL","asset_identifier":"Mtn.sd","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":6752171,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-13T09:01:32.389Z","updated_at":"2020-01-13T09:01:32.389Z","actor":{"username":"vancora","cleared":false,"url":"/vancora","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"mtn_group","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7050821,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-14T08:35:51.191Z","updated_at":"2020-02-14T08:35:51.191Z","actor":{"username":"vancora","cleared":false,"url":"/vancora","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"rpbeast33","url":"/rpbeast33"},"genius_execution_id":null,"team_handle":"mtn_group","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8387500,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Would it be possible for disclosure of this bug? I noted the subdomain is no longer active so thought it would be a good canidate! ","markdown_message":"\u003cp\u003eWould it be possible for disclosure of this bug? I noted the subdomain is no longer active so thought it would be a good canidate! \u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-23T17:03:54.684Z","updated_at":"2020-06-23T17:03:54.684Z","first_to_agree":true,"actor":{"username":"rpbeast33","cleared":false,"url":"/rpbeast33","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/1xZdqyMDpFF8F1pVHhPfZrk1/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"mtn_group","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8725164,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T17:03:55.723Z","updated_at":"2020-07-23T17:03:55.723Z","actor":{"url":"/mtn_group","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/F81QA4NLiRgbof5FRQvj1SJG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"MTN Group"}},"genius_execution_id":null,"team_handle":"mtn_group","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":23549,"category":"researcher","content":"Arbitrary Java code could be executed inside a container on the server for debug purposes. However due to improper sandboxing an attacker could create a new .jsp file that would be served under the web servers temp folder. This attacker controlled file could then execute native java code with the permissions of the Web Servers ```uid```. \n\nThe debug console was designed to insert an admins/users code within a ```.jsp``` file ```\u003c% %\u003e``` tags which would allow very limited code to be executed. Due to no filtering of user input, an attacker could close the intial ```\u003c%``` tag and thus have full control over the .jsp file, including importing ```java classes```. The attack logically worked similar to an ```XSS``` attack where an attacker would close a HTML tag and insert their own. However, due the ability to have ```.jsp``` files include ```java``` code and execute on the server on load this attack is quite critical.  Overall this led to a situation where an attacker could have command injection on the server and could spawn a reverse shell, read local files, or other nefarious attacks. \n\nThe below PoC was used to demonstrate reading local files on the server: \n\n```Java\nout.print(\"LOCAL FILE DATA\");\nout.print(\":\");%\u003e\n\u003c%@ page import=\"java.util.Random\"%\u003e\n\u003c%@ page import=\"java.io.*\"%\u003e\n\u003c%\nout.println(\"\\n\");\nFile file = new File(\"/etc/mime.types\");\nBufferedReader br = new BufferedReader(new FileReader(file));\nString st;\nwhile ((st = br.readLine()) != null)\n\n{ out.println(st); };%\u003e\n\u003c% out.println(\"Exit\");\n```\n\n","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eArbitrary Java code could be executed inside a container on the server for debug purposes. However due to improper sandboxing an attacker could create a new .jsp file that would be served under the web servers temp folder. This attacker controlled file could then execute native java code with the permissions of the Web Servers \u003ccode\u003euid\u003c/code\u003e. \u003c/p\u003e\n\n\u003cp\u003eThe debug console was designed to insert an admins/users code within a \u003ccode\u003e.jsp\u003c/code\u003e file \u003ccode\u003e\u0026lt;% %\u0026gt;\u003c/code\u003e tags which would allow very limited code to be executed. Due to no filtering of user input, an attacker could close the intial \u003ccode\u003e\u0026lt;%\u003c/code\u003e tag and thus have full control over the .jsp file, including importing \u003ccode\u003ejava classes\u003c/code\u003e. The attack logically worked similar to an \u003ccode\u003eXSS\u003c/code\u003e attack where an attacker would close a HTML tag and insert their own. However, due the ability to have \u003ccode\u003e.jsp\u003c/code\u003e files include \u003ccode\u003ejava\u003c/code\u003e code and execute on the server on load this attack is quite critical.  Overall this led to a situation where an attacker could have command injection on the server and could spawn a reverse shell, read local files, or other nefarious attacks. \u003c/p\u003e\n\n\u003cp\u003eThe below PoC was used to demonstrate reading local files on the server: \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eout.print(\u0026quot;LOCAL FILE DATA\u0026quot;);\nout.print(\u0026quot;:\u0026quot;);%\u0026gt;\n\u0026lt;%@ page import=\u0026quot;java.util.Random\u0026quot;%\u0026gt;\n\u0026lt;%@ page import=\u0026quot;java.io.*\u0026quot;%\u0026gt;\n\u0026lt;%\nout.println(\u0026quot;\\n\u0026quot;);\nFile file = new File(\u0026quot;/etc/mime.types\u0026quot;);\nBufferedReader br = new BufferedReader(new FileReader(file));\nString st;\nwhile ((st = br.readLine()) != null)\n\n{ out.println(st); };%\u0026gt;\n\u0026lt;% out.println(\u0026quot;Exit\u0026quot;);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"}]}