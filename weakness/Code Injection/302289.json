{"id":302289,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDIyODk=","url":"https://hackerone.com/reports/302289","title":"// (double slash) inside es6 template literals interpreted as an inline comment by the auto-minifier","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-01-04T04:07:48.771Z","submitted_at":"2018-01-04T04:07:48.771Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"veggie","url":"/veggie","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/229/505/5555cc894a8a63508f4e6b8341d86ab9f203eb62_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":41,"url":"https://hackerone.com/cloudflare","handle":"cloudflare","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Cloudflare Vulnerability Disclosure","twitter_handle":"cloudflare","website":"https://www.cloudflare.com/disclosure","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-03-17T22:32:39.419Z","bug_reporter_agreed_on_going_public_at":"2018-02-15T22:32:35.555Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The following is valid javascript:\n\n    var a = `//`;\n\nSo is this:\n\n    var url = `https://hackerone.com`;\n\nHowever, Cloudflare's auto-minifier removes the parts of both lines including and after the `//`, meaning in production, they look like this:\n\n    var a = `\n    var url = `https:\n\nThis can either straight up break or introduce sneaky bugs in production that don't show up in development (development mode turns off minification, and in local dev, this obviously doesn't happen) since those strings never get closed. There's also no way to get around this other than to stop using template literals for strings containing `//`.\n\nHere's a relatively contrived proof of concept of code that behaves differently in dev and production without any errors:\n\n    var subreddit = 'cloudflare';\n    var url = `https://www.reddit.com/r/${subreddit}`;\n    `;console.log('what is up'); // this shouldn't run! `;\n\nMinified, it becomes:\n\n    var subreddit='cloudflare';var url=`https:`;console.log('what is up');\n\nwhich prints \"what is up\" to console. It's live here: https://jli.host/cloudflare-bug/\n\n## Impact\n\nThis requires either access to the source code, or a really badly misconfigured website that dynamically builds scripts and injects user input. There's hardly a security impact, but there's definitely still a bug that's causing unintended behavior.","vulnerability_information_html":"\u003cp\u003eThe following is valid javascript:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003evar a = `//`;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSo is this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003evar url = `https://hackerone.com`;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHowever, Cloudflare\u0026#39;s auto-minifier removes the parts of both lines including and after the \u003ccode\u003e//\u003c/code\u003e, meaning in production, they look like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003evar a = `\nvar url = `https:\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis can either straight up break or introduce sneaky bugs in production that don\u0026#39;t show up in development (development mode turns off minification, and in local dev, this obviously doesn\u0026#39;t happen) since those strings never get closed. There\u0026#39;s also no way to get around this other than to stop using template literals for strings containing \u003ccode\u003e//\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026#39;s a relatively contrived proof of concept of code that behaves differently in dev and production without any errors:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003evar subreddit = \u0026#39;cloudflare\u0026#39;;\nvar url = `https://www.reddit.com/r/${subreddit}`;\n`;console.log(\u0026#39;what is up\u0026#39;); // this shouldn\u0026#39;t run! `;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eMinified, it becomes:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003evar subreddit=\u0026#39;cloudflare\u0026#39;;var url=`https:`;console.log(\u0026#39;what is up\u0026#39;);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewhich prints \u0026quot;what is up\u0026quot; to console. It\u0026#39;s live here: \u003ca title=\"https://jli.host/cloudflare-bug/\" href=\"/redirect?url=https%3A%2F%2Fjli.host%2Fcloudflare-bug%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://jli.host/cloudflare-bug/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThis requires either access to the source code, or a really badly misconfigured website that dynamically builds scripts and injects user input. There\u0026#39;s hardly a security impact, but there\u0026#39;s definitely still a bug that\u0026#39;s causing unintended behavior.\u003c/p\u003e\n","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-03-17T22:32:35.772Z","allow_singular_disclosure_after":-87893816.55673741,"singular_disclosure_allowed":true,"vote_count":7,"voters":["jokebookservice1","kapytein","bl4de","gerben_javado","edoverflow","eveeez","apapedulimu"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2261959,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you very much for this, a ticket will be opened and I will investigate further!","markdown_message":"\u003cp\u003eThank you very much for this, a ticket will be opened and I will investigate further!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-04T15:34:55.300Z","updated_at":"2018-01-04T15:34:55.300Z","actor":{"username":"higcf","cleared":false,"url":"/higcf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/225/738/e1bf67bce170313b0984233d5f46a010718ead67_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2262519,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome, that's great to hear! This issue also extends to C style comments, `/* ... */` if there's a matching pair of those (from my minimal testing, you need both), meaning entire lines can disappear. For example,\n\n    var domain = 'hackerone';\n    var url = `www.${domain}.com/*`;\n    console.log(url);\n    var other_url = `www.${domain}.com/*/`;\n\nNotice the `/*` on line 2 and `*/` on line 4, which are perfectly normal looking strings that behave as you'd expect unminified. However, the entire last two lines and the `/*` on line 2 are omitted from output after minification:\n\n    var domain='hackerone';var url=`www.${domain}.com`;\n\nLive: https://jli.host/cloudflare-bug/c-style","markdown_message":"\u003cp\u003eAwesome, that\u0026#39;s great to hear! This issue also extends to C style comments, \u003ccode\u003e/* ... */\u003c/code\u003e if there\u0026#39;s a matching pair of those (from my minimal testing, you need both), meaning entire lines can disappear. For example,\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003evar domain = \u0026#39;hackerone\u0026#39;;\nvar url = `www.${domain}.com/*`;\nconsole.log(url);\nvar other_url = `www.${domain}.com/*/`;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNotice the \u003ccode\u003e/*\u003c/code\u003e on line 2 and \u003ccode\u003e*/\u003c/code\u003e on line 4, which are perfectly normal looking strings that behave as you\u0026#39;d expect unminified. However, the entire last two lines and the \u003ccode\u003e/*\u003c/code\u003e on line 2 are omitted from output after minification:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003evar domain=\u0026#39;hackerone\u0026#39;;var url=`www.${domain}.com`;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLive: \u003ca title=\"https://jli.host/cloudflare-bug/c-style\" href=\"/redirect?url=https%3A%2F%2Fjli.host%2Fcloudflare-bug%2Fc-style\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://jli.host/cloudflare-bug/c-style\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-04T18:34:52.509Z","updated_at":"2018-01-04T18:47:57.816Z","actor":{"username":"veggie","cleared":false,"url":"/veggie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/229/505/5555cc894a8a63508f4e6b8341d86ab9f203eb62_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2307970,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for submission. I have escalated your report to our engineers for review.","markdown_message":"\u003cp\u003eThank you for submission. I have escalated your report to our engineers for review.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-22T19:33:57.141Z","updated_at":"2018-01-22T19:33:57.141Z","actor":{"username":"higcf","cleared":false,"url":"/higcf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/225/738/e1bf67bce170313b0984233d5f46a010718ead67_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2371361,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just to let you know that this bug is queued up for the Engineering team so there should be a response soon.","markdown_message":"\u003cp\u003eJust to let you know that this bug is queued up for the Engineering team so there should be a response soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-10T21:06:00.089Z","updated_at":"2018-02-10T21:06:00.089Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2388102,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We have pushed out a new version of the affected code. As far as we can tell from testing this bug has now been fixed and is no longer reproducable. As a result I am going to close this report.\n\nIf you find that this is not the case, please let me know and iIll re-open it.","markdown_message":"\u003cp\u003eWe have pushed out a new version of the affected code. As far as we can tell from testing this bug has now been fixed and is no longer reproducable. As a result I am going to close this report.\u003c/p\u003e\n\n\u003cp\u003eIf you find that this is not the case, please let me know and iIll re-open it.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-15T22:19:02.585Z","updated_at":"2018-02-15T22:19:02.585Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"veggie","url":"/veggie"},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2388137,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks! It looks to be fixed.\n\nBy the way, is this bug eligible for that sweet t-shirt?","markdown_message":"\u003cp\u003eThanks! It looks to be fixed.\u003c/p\u003e\n\n\u003cp\u003eBy the way, is this bug eligible for that sweet t-shirt?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-15T22:32:35.628Z","updated_at":"2018-02-15T22:32:35.628Z","first_to_agree":true,"actor":{"username":"veggie","cleared":false,"url":"/veggie","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/229/505/5555cc894a8a63508f4e6b8341d86ab9f203eb62_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2388217,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"Absolutely. Make sure you fill out your details into hackerone.","markdown_message":"\u003cp\u003eAbsolutely. Make sure you fill out your details into hackerone.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-15T23:06:57.436Z","updated_at":"2018-02-15T23:06:57.436Z","actor":{"url":"/cloudflare","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Cloudflare Vulnerability Disclosure"}},"reporter":{"username":"veggie","url":"/veggie"},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2502346,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-17T22:32:39.460Z","updated_at":"2018-03-17T22:32:39.460Z","actor":{"url":"/cloudflare","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Cloudflare Vulnerability Disclosure"}},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}