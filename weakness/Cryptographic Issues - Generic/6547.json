{"id":6547,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NTQ3","url":"https://hackerone.com/reports/6547","title":"(lack of) smtp transport layer security","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2014-04-08T17:09:55.612Z","submitted_at":"2014-04-08T17:09:55.612Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"leander","url":"/leander","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/004/627/31b99e478bdc5b23c3284c58c9612a43a9acc4be_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2015-05-05T21:29:27.366Z","bug_reporter_agreed_on_going_public_at":"2015-05-02T17:05:14.066Z","team_member_agreed_on_going_public_at":"2015-05-05T21:29:26.729Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\r\n\r\nIt appears that email messages from the platform are sent via plain SMTP even though the receiving MX supports ESMTPS (the use of ESMTP when STARTTLS is also successfully negotiated to provide a strong transport encryption layer).\r\n\r\nThis allows for eavesdropping along the path between the originating system (such as o1.email.hackerone.com) and the receiving MX.\r\n\r\nTo reproduce:\r\n- Have the platform deliver a message to a recipient whose MX supports STARTTLS\r\n- Inspect the email headers, in most cases the first 'Received:' header is relevant\r\n- Observe the transaction id and look for 'SMTP id' (versus 'ESMTPS id')\r\n- Observe lack of version/cipher/bits information that would be shown if TLS was used\r\n\r\n\r\nFictional example headers provided below;\r\n\r\n- current\r\nReceived: from o1.email.hackerone.com (o1.email.hackerone.com. [167.89.13.71])\r\n        by mx.receiving.tld with SMTP id e3si1568039obp.178.2014.04.08.05.59.10\r\n        for \u003crecipient@domain.tld\u003e;\r\n        Tue, 08 Apr 2014 05:59:11 -0700 (PDT)\r\n\r\n- suggested\r\nReceived: from o1.email.hackerone.com (o1.email.hackerone.com. [167.89.13.71])\r\n        by mx.receiving.tld with ESMTPS id e3si1568039obp.178.2014.04.08.05.59.10\r\n        for \u003crecipient@domain.tld\u003e\r\n        (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);\r\n        Tue, 08 Apr 2014 05:59:11 -0700 (PDT)\r\n\r\nThe perhaps slightly obvious fix seems to be to support ESMTPS by allowing STARTTLS to be negotiated by the sending system(s). Note that blunt enforcement will cause delivery problems as it depends on EMSTPS being supported on (any) receiving MX.\r\n\r\nHTH.\r\n\r\n-leander\r\n\r\n","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eIt appears that email messages from the platform are sent via plain SMTP even though the receiving MX supports ESMTPS (the use of ESMTP when STARTTLS is also successfully negotiated to provide a strong transport encryption layer).\u003c/p\u003e\n\n\u003cp\u003eThis allows for eavesdropping along the path between the originating system (such as o1.email.hackerone.com) and the receiving MX.\u003c/p\u003e\n\n\u003cp\u003eTo reproduce:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eHave the platform deliver a message to a recipient whose MX supports STARTTLS\u003c/li\u003e\n\u003cli\u003eInspect the email headers, in most cases the first \u0026#39;Received:\u0026#39; header is relevant\u003c/li\u003e\n\u003cli\u003eObserve the transaction id and look for \u0026#39;SMTP id\u0026#39; (versus \u0026#39;ESMTPS id\u0026#39;)\u003c/li\u003e\n\u003cli\u003eObserve lack of version/cipher/bits information that would be shown if TLS was used\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eFictional example headers provided below;\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003ecurrent\u003cbr\u003e\nReceived: from o1.email.hackerone.com (o1.email.hackerone.com. [167.89.13.71])\u003cbr\u003e\n    by mx.receiving.tld with SMTP id e3si1568039obp.178.2014.04.08.05.59.10\u003cbr\u003e\n    for \u003ca title=\"recipient@domain.tld\" href=\"mailto:recipient@domain.tld\" rel=\"nofollow noopener noreferrer\"\u003erecipient@domain.tld\u003c/a\u003e;\u003cbr\u003e\n    Tue, 08 Apr 2014 05:59:11 -0700 (PDT)\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003esuggested\u003cbr\u003e\nReceived: from o1.email.hackerone.com (o1.email.hackerone.com. [167.89.13.71])\u003cbr\u003e\n    by mx.receiving.tld with ESMTPS id e3si1568039obp.178.2014.04.08.05.59.10\u003cbr\u003e\n    for \u003ca title=\"recipient@domain.tld\" href=\"mailto:recipient@domain.tld\" rel=\"nofollow noopener noreferrer\"\u003erecipient@domain.tld\u003c/a\u003e\u003cbr\u003e\n    (version=TLSv1 cipher=ECDHE-RSA-RC4-SHA bits=128/128);\u003cbr\u003e\n    Tue, 08 Apr 2014 05:59:11 -0700 (PDT)\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe perhaps slightly obvious fix seems to be to support ESMTPS by allowing STARTTLS to be negotiated by the sending system(s). Note that blunt enforcement will cause delivery problems as it depends on EMSTPS being supported on (any) receiving MX.\u003c/p\u003e\n\n\u003cp\u003eHTH.\u003c/p\u003e\n\n\u003cp\u003e-leander\u003c/p\u003e\n","weakness":{"id":32,"name":"Cryptographic Issues - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-06-01T17:05:14.988Z","allow_singular_disclosure_after":-176045330.78552446,"singular_disclosure_allowed":true,"vote_count":2,"voters":["sw33tlie","dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":27523,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"We rely on our our email delivery partner Sendgrid here. Reached out to their tech support. Will keep you posted!","markdown_message":"\u003cp\u003eWe rely on our our email delivery partner Sendgrid here. Reached out to their tech support. Will keep you posted!\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-09T21:01:54.755Z","updated_at":"2014-04-09T21:01:54.755Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":28922,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"I pinged Sendgrid about this and there response is:\n```\nUnfortunately there is no way to enable this setup. We currently do not have support for it. Please let me know if anything else happens.\n```\nWe share your concern and will try to nudge Sendgrid in the right direction (or maybe explore their competition). Unfortunately a won't fix at this moment for us.\n\nThanks for your report!","markdown_message":"\u003cp\u003eI pinged Sendgrid about this and there response is:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eUnfortunately there is no way to enable this setup. We currently do not have support for it. Please let me know if anything else happens.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe share your concern and will try to nudge Sendgrid in the right direction (or maybe explore their competition). Unfortunately a won\u0026#39;t fix at this moment for us.\u003c/p\u003e\n\n\u003cp\u003eThanks for your report!\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-11T17:04:56.938Z","updated_at":"2014-04-11T17:04:56.938Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":28959,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nWhile I appreciate the situation, I'd like to stress the importance of ensuring transport layer security.\n\nI've seen a bug (that was later disclosed publicly) in which the reply contained the actual vector whilst mentioning difficulties to reproduce. \n\nSuch responses, when sent over unencrypted channels, could allow an eavesdropper to learn about vulnerabilities before or without them being disclosed intentionally.\n\nPerhaps an acceptable workaround would be to not include the message body in emails? \n\nThis way:\n\n- Any sensitive information in the message body would not be sent as plain text;\n- You won't depend on recipients supporting STARTTLS which is impossible to control anyway, stopping short of actual enforcement.\n\nThis could look like:\n\n/*\njjoos closed your bug (lack of) smtp transport layer security as Won't fix.\n\nPlease login \u003chere\u003e to review further details.\n*/\n\nLet me know what you think.\n\nKind regards,\n\n-leander\n\n\n","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eWhile I appreciate the situation, I\u0026#39;d like to stress the importance of ensuring transport layer security.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve seen a bug (that was later disclosed publicly) in which the reply contained the actual vector whilst mentioning difficulties to reproduce. \u003c/p\u003e\n\n\u003cp\u003eSuch responses, when sent over unencrypted channels, could allow an eavesdropper to learn about vulnerabilities before or without them being disclosed intentionally.\u003c/p\u003e\n\n\u003cp\u003ePerhaps an acceptable workaround would be to not include the message body in emails? \u003c/p\u003e\n\n\u003cp\u003eThis way:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAny sensitive information in the message body would not be sent as plain text;\u003c/li\u003e\n\u003cli\u003eYou won\u0026#39;t depend on recipients supporting STARTTLS which is impossible to control anyway, stopping short of actual enforcement.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThis could look like:\u003c/p\u003e\n\n\u003cp\u003e/*\u003cbr\u003e\njjoos closed your bug (lack of) smtp transport layer security as Won\u0026#39;t fix.\u003c/p\u003e\n\n\u003cp\u003ePlease login \u0026lt;here\u0026gt; to review further details.\u003cbr\u003e\n*/\u003c/p\u003e\n\n\u003cp\u003eLet me know what you think.\u003c/p\u003e\n\n\u003cp\u003eKind regards,\u003c/p\u003e\n\n\u003cp\u003e-leander\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-11T17:35:19.016Z","updated_at":"2014-04-11T17:35:19.016Z","actor":{"username":"leander","cleared":false,"url":"/leander","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/627/31b99e478bdc5b23c3284c58c9612a43a9acc4be_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":29947,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We used to have this, but we decided to move away from it because it made email notifications almost useless. I agree with you that this is a potential security risk, but for an attacker it would be quite an investment to deploy a successful MitM attack in order to obtain potentially sensitive vulnerability information. The time window to exploit the obtained information is extremely limited, since the bug has been disclosed to a security team that'll likely fix it soon. Low attack ROI. Also, if you are being MitM'd, I can think of way more interesting things to go after. \n\nWe hear you though and I appreciate your efforts explaining the risks involved, but it's not something we're going to address right now. We have planned PGP support, but it's not at the top of our roadmap at this time. ","markdown_message":"\u003cp\u003eWe used to have this, but we decided to move away from it because it made email notifications almost useless. I agree with you that this is a potential security risk, but for an attacker it would be quite an investment to deploy a successful MitM attack in order to obtain potentially sensitive vulnerability information. The time window to exploit the obtained information is extremely limited, since the bug has been disclosed to a security team that\u0026#39;ll likely fix it soon. Low attack ROI. Also, if you are being MitM\u0026#39;d, I can think of way more interesting things to go after. \u003c/p\u003e\n\n\u003cp\u003eWe hear you though and I appreciate your efforts explaining the risks involved, but it\u0026#39;s not something we\u0026#39;re going to address right now. We have planned PGP support, but it\u0026#39;s not at the top of our roadmap at this time. \u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-14T09:39:37.501Z","updated_at":"2014-04-14T09:40:40.078Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":67306,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nI've got some good news, Sendgrid has enabled esmpt starttls.\n\nMore information:\nhttp://sendgrid.com/blog/sendgrid-and-the-future-of-email-security/","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve got some good news, Sendgrid has enabled esmpt starttls.\u003c/p\u003e\n\n\u003cp\u003eMore information:\u003cbr\u003e\n\u003ca title=\"http://sendgrid.com/blog/sendgrid-and-the-future-of-email-security/\" href=\"/redirect?url=http%3A%2F%2Fsendgrid.com%2Fblog%2Fsendgrid-and-the-future-of-email-security%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://sendgrid.com/blog/sendgrid-and-the-future-of-email-security/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-05T16:43:23.020Z","updated_at":"2014-06-05T16:43:23.020Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":78644,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"woot.","markdown_message":"\u003cp\u003ewoot.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-24T20:06:54.513Z","updated_at":"2014-06-24T20:06:54.513Z","actor":{"username":"leander","cleared":false,"url":"/leander","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/627/31b99e478bdc5b23c3284c58c9612a43a9acc4be_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":400128,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-05-02T17:05:14.364Z","updated_at":"2015-05-02T17:05:14.364Z","first_to_agree":true,"actor":{"username":"leander","cleared":false,"url":"/leander","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/627/31b99e478bdc5b23c3284c58c9612a43a9acc4be_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":402792,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-05-05T21:29:26.784Z","updated_at":"2015-05-05T21:29:26.784Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":402793,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-05-05T21:29:27.393Z","updated_at":"2015-05-05T21:29:27.393Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}