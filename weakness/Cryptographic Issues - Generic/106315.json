{"id":106315,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDYzMTU=","url":"https://hackerone.com/reports/106315","title":"Potential for Double Spend via Sign Message Utility","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2015-12-21T14:43:00.047Z","submitted_at":"2015-12-21T14:43:00.047Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ddworken","url":"/ddworken","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/344/0f539160a7134b9d14cd1f9c8e38bbc32c3b3604_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":104,"url":"https://hackerone.com/coinbase","handle":"coinbase","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Coinbase","twitter_handle":"","website":"https://coinbase.com/security","about":"Creating an open financial system for the world"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-01-06T16:29:44.923Z","bug_reporter_agreed_on_going_public_at":"2016-01-06T16:29:44.556Z","team_member_agreed_on_going_public_at":"2016-01-06T06:41:39.490Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi, \n\nThere is an unlikely (but theoretically exploitable vulnerability) is caused by allowing users to sign messages with their addresses. So far I have not been able to exploit this, but I believe that it is exploitable. \n\nOn coinbse.com, the user can see a list of their addresses [here](https://www.coinbase.com/addresses). When they click on an address, they get the option to \"Sign a message\". \n\nAn attacker could create a raw transaction (explanation of how to do so is [here](http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html)) spending from one of the addresses listed there to an attacker controlled address. The attacker would then sign the raw transaction so that it is ready to be sent out to the entire network. Then the attacker would send some amount of bitcoin to Coinbase (a predetermined amount to a predetermined address). Shortly after sending the bitcoin to Coinbase, the attacker would then relay his signed transaction to send the bitcoin to his own privately held address. \n\nThe end outcome of this is that Coinbase believes they have received some amount of Bitcoin (and it had a number of confirmations in an address controlled by Coinbase), but in reality they lost it since the attacker stole it before Coinbase could transfer it elsewhere. \n\nRealistically, I'm not sure whether this can be practically exploited. None the less, I would recommend adding some sort of parsing code to the \"Sign a message\" utility so that it will refuse to sign a transaction. \n\nThanks,\nDavid Dworken","vulnerability_information_html":"\u003cp\u003eHi, \u003c/p\u003e\n\n\u003cp\u003eThere is an unlikely (but theoretically exploitable vulnerability) is caused by allowing users to sign messages with their addresses. So far I have not been able to exploit this, but I believe that it is exploitable. \u003c/p\u003e\n\n\u003cp\u003eOn coinbse.com, the user can see a list of their addresses \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.coinbase.com%2Faddresses\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehere\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. When they click on an address, they get the option to \u0026quot;Sign a message\u0026quot;. \u003c/p\u003e\n\n\u003cp\u003eAn attacker could create a raw transaction (explanation of how to do so is \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.righto.com%2F2014%2F02%2Fbitcoins-hard-way-using-raw-bitcoin.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehere\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) spending from one of the addresses listed there to an attacker controlled address. The attacker would then sign the raw transaction so that it is ready to be sent out to the entire network. Then the attacker would send some amount of bitcoin to Coinbase (a predetermined amount to a predetermined address). Shortly after sending the bitcoin to Coinbase, the attacker would then relay his signed transaction to send the bitcoin to his own privately held address. \u003c/p\u003e\n\n\u003cp\u003eThe end outcome of this is that Coinbase believes they have received some amount of Bitcoin (and it had a number of confirmations in an address controlled by Coinbase), but in reality they lost it since the attacker stole it before Coinbase could transfer it elsewhere. \u003c/p\u003e\n\n\u003cp\u003eRealistically, I\u0026#39;m not sure whether this can be practically exploited. None the less, I would recommend adding some sort of parsing code to the \u0026quot;Sign a message\u0026quot; utility so that it will refuse to sign a transaction. \u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\nDavid Dworken\u003c/p\u003e\n","weakness":{"id":32,"name":"Cryptographic Issues - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-02-05T06:41:39.766Z","allow_singular_disclosure_after":-154560775.8406048,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":729024,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the report, we're investigating whether this is exploitable.","markdown_message":"\u003cp\u003eThanks for the report, we\u0026#39;re investigating whether this is exploitable.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-12-22T04:57:21.899Z","updated_at":"2015-12-22T04:57:21.899Z","actor":{"username":"coinbase2","cleared":false,"url":"/coinbase2","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":743309,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Appreciate the patience, still investigating this one.","markdown_message":"\u003cp\u003eAppreciate the patience, still investigating this one.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-05T22:59:35.821Z","updated_at":"2016-01-05T22:59:35.821Z","actor":{"username":"coinbase9001","cleared":false,"url":"/coinbase9001","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":743613,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Hi ddworken,\n\nThis is a clever idea, we had some fun working through it but determined in was not exploitable.  The concept is totally sound, but doesn't work because the string \"Bitcoin signed message:\\n\" is prepended to whatever you POST to Coinbase.  This is consistent with the behavior of bitcoin-core.\n\nExample in core: https://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L101\nExample in bitcoin-ruby:  https://github.com/mhanne/bitcoin-ruby/blob/master/lib/bitcoin.rb#L326\n\nBut, assuming that was not present, you would still have some trouble exploiting this.  What you are trying to get us to sign is the raw sighash of a transaction, which is a binary sequence not guaranteed to be UTF-8 (or parse-able by any web server).  You would need to generate a transaction who's hash contains only valid UTF-8 characters.  We determined this could be done by including an OP_RETURN script with a nonce, where the nonce is changed until a hash is discovered with all valid UTF-8 bytes.  We were able to generate examples of this.\n\nThank you for your time, looking forward to future submissions.","markdown_message":"\u003cp\u003eHi ddworken,\u003c/p\u003e\n\n\u003cp\u003eThis is a clever idea, we had some fun working through it but determined in was not exploitable.  The concept is totally sound, but doesn\u0026#39;t work because the string \u0026quot;Bitcoin signed message:\\n\u0026quot; is prepended to whatever you POST to Coinbase.  This is consistent with the behavior of bitcoin-core.\u003c/p\u003e\n\n\u003cp\u003eExample in core: \u003ca title=\"https://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L101\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fbitcoin%2Fbitcoin%2Fblob%2Fmaster%2Fsrc%2Fmain.cpp%23L101\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/bitcoin/bitcoin/blob/master/src/main.cpp#L101\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nExample in bitcoin-ruby:  \u003ca title=\"https://github.com/mhanne/bitcoin-ruby/blob/master/lib/bitcoin.rb#L326\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmhanne%2Fbitcoin-ruby%2Fblob%2Fmaster%2Flib%2Fbitcoin.rb%23L326\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mhanne/bitcoin-ruby/blob/master/lib/bitcoin.rb#L326\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eBut, assuming that was not present, you would still have some trouble exploiting this.  What you are trying to get us to sign is the raw sighash of a transaction, which is a binary sequence not guaranteed to be UTF-8 (or parse-able by any web server).  You would need to generate a transaction who\u0026#39;s hash contains only valid UTF-8 characters.  We determined this could be done by including an OP_RETURN script with a nonce, where the nonce is changed until a hash is discovered with all valid UTF-8 bytes.  We were able to generate examples of this.\u003c/p\u003e\n\n\u003cp\u003eThank you for your time, looking forward to future submissions.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-06T03:07:59.487Z","updated_at":"2016-01-06T03:07:59.487Z","actor":{"username":"coinbase9001","cleared":false,"url":"/coinbase9001","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":743751,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-01-06T06:41:39.517Z","updated_at":"2016-01-06T06:41:39.517Z","first_to_agree":true,"actor":{"username":"coinbase2","cleared":false,"url":"/coinbase2","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":744388,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you very much for looking into this! My guess was that it was not exploitable, so thank you for confirming that. \n\nThanks,\nDavid Dworken","markdown_message":"\u003cp\u003eThank you very much for looking into this! My guess was that it was not exploitable, so thank you for confirming that. \u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\nDavid Dworken\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-06T16:29:29.431Z","updated_at":"2016-01-06T16:29:29.431Z","actor":{"username":"ddworken","cleared":true,"url":"/ddworken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/344/0f539160a7134b9d14cd1f9c8e38bbc32c3b3604_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":744389,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-01-06T16:29:44.584Z","updated_at":"2016-01-06T16:29:44.584Z","actor":{"username":"ddworken","cleared":true,"url":"/ddworken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/344/0f539160a7134b9d14cd1f9c8e38bbc32c3b3604_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":744390,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-01-06T16:29:44.946Z","updated_at":"2016-01-06T16:29:44.946Z","actor":{"username":"ddworken","cleared":true,"url":"/ddworken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/344/0f539160a7134b9d14cd1f9c8e38bbc32c3b3604_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}