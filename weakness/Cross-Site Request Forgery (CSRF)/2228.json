{"id":2228,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjI4","url":"https://hackerone.com/reports/2228","title":"Login CSRF using Twitter OAuth","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-02-23T17:25:25.462Z","submitted_at":"2014-02-23T17:25:25.462Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mathias","url":"/mathias","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/086/c8610c392c890a1330940f3c7f8e15aa1a0d45a6_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":18,"url":"https://hackerone.com/phabricator","handle":"phabricator","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Phabricator","twitter_handle":"phabricator","website":"http://phacility.com/phabricator/","about":"Phabricator is a collection of open source web applications that help software companies build better software."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-03-26T01:09:32.610Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2014-02-24T01:16:17.483Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"This bug is related to bug report [#774 (Log in a user to another account)](https://hackerone.com/reports/774) by @dawidczagan as this bug also allows a user to be logged in as the attacker. The main reason is that no state is maintained in the authentication flow. Although the Twitter flow still uses OAuth 1.0A, which has no `state` parameter as in OAuth 2, it is still possible to prevent this type of attack by setting an additional parameter in the `oauth_callback` value.\r\n\r\nAn attacker could exploit this bug as follows:\r\n\r\n1. Attacker initiates Twitter OAuth process with Phabricator\r\n2. Attacker allows access to Phabricator app\r\n3. Attacker records and drops redirection to Phabricator (in order not to consume token)\r\n4. Attacker directs victim to `/auth/login/twitter:twitter.com/?oauth_token={attacker_token}\u0026oauth_verifier={attacker_verifier}`\r\n5. Victim is now logged in as attacker\r\n\r\nTo mitigate this vulnerability, either maintain state in the authentication flow by adding a parameter in the callback value or, as Twitter seems to support OAuth 2, use that instead.","vulnerability_information_html":"\u003cp\u003eThis bug is related to bug report \u003ca href=\"https://hackerone.com/reports/774\"\u003e#774 (Log in a user to another account)\u003c/a\u003e by \u003ca href=\"/dawidczagan\"\u003e@dawidczagan\u003c/a\u003e as this bug also allows a user to be logged in as the attacker. The main reason is that no state is maintained in the authentication flow. Although the Twitter flow still uses OAuth 1.0A, which has no \u003ccode\u003estate\u003c/code\u003e parameter as in OAuth 2, it is still possible to prevent this type of attack by setting an additional parameter in the \u003ccode\u003eoauth_callback\u003c/code\u003e value.\u003c/p\u003e\n\n\u003cp\u003eAn attacker could exploit this bug as follows:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAttacker initiates Twitter OAuth process with Phabricator\u003c/li\u003e\n\u003cli\u003eAttacker allows access to Phabricator app\u003c/li\u003e\n\u003cli\u003eAttacker records and drops redirection to Phabricator (in order not to consume token)\u003c/li\u003e\n\u003cli\u003eAttacker directs victim to \u003ccode\u003e/auth/login/twitter:twitter.com/?oauth_token={attacker_token}\u0026amp;oauth_verifier={attacker_verifier}\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eVictim is now logged in as attacker\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eTo mitigate this vulnerability, either maintain state in the authentication flow by adding a parameter in the callback value or, as Twitter seems to support OAuth 2, use that instead.\u003c/p\u003e\n","bounty_amount":"300.0","formatted_bounty":"$300","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-03-26T01:09:27.025Z","allow_singular_disclosure_after":-213421909.9987175,"singular_disclosure_allowed":true,"vote_count":3,"voters":["sw33tlie","cryptographer","spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":9005,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Another report slipped in right before this, but I'll look at this as soon as I resolve that. Thanks for the report!","markdown_message":"\u003cp\u003eAnother report slipped in right before this, but I\u0026#39;ll look at this as soon as I resolve that. Thanks for the report!\u003c/p\u003e\n","automated_response":false,"created_at":"2014-02-23T17:45:15.467Z","updated_at":"2014-02-23T17:45:15.467Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9019,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"(Something more severe and hard to address slipped in after this, too. This is still on our radar but may take a bit before we can look at it.)","markdown_message":"\u003cp\u003e(Something more severe and hard to address slipped in after this, too. This is still on our radar but may take a bit before we can look at it.)\u003c/p\u003e\n","automated_response":false,"created_at":"2014-02-23T19:02:00.166Z","updated_at":"2014-02-23T19:02:00.166Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9041,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"(Looking at this now...)","markdown_message":"\u003cp\u003e(Looking at this now...)\u003c/p\u003e\n","automated_response":false,"created_at":"2014-02-23T22:28:17.657Z","updated_at":"2014-02-23T22:28:17.657Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9045,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2014-02-23T23:25:53.181Z","updated_at":"2014-02-23T23:25:53.181Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9047,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I believe I have a fix ready for this:\n\nhttps://secure.phabricator.com/D8318\n\nThis will probably get reviewed within the next 24 hours.","markdown_message":"\u003cp\u003eI believe I have a fix ready for this:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://secure.phabricator.com/D8318\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2FD8318\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/D8318\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThis will probably get reviewed within the next 24 hours.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-02-23T23:28:07.640Z","updated_at":"2014-02-23T23:28:07.640Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9058,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This is now in HEAD.","markdown_message":"\u003cp\u003eThis is now in HEAD.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-02-24T01:09:27.123Z","updated_at":"2014-02-24T01:09:27.123Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"mathias","url":"/mathias"},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9060,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"We consider this to be an issue of relatively low severity because it only affects Twitter and JIRA (where it would often be harder for many attackers to acquire credentials), requires the victim be logged out, and only allows an attacker to force the victim to log in to an account they control, which might be the first step in a more interesting attack but isn't clearly valuable on its own.","markdown_message":"\u003cp\u003eWe consider this to be an issue of relatively low severity because it only affects Twitter and JIRA (where it would often be harder for many attackers to acquire credentials), requires the victim be logged out, and only allows an attacker to force the victim to log in to an account they control, which might be the first step in a more interesting attack but isn\u0026#39;t clearly valuable on its own.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-02-24T01:15:48.776Z","updated_at":"2014-02-24T01:15:48.776Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Phabricator"}},"bounty_amount":"300.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"phabricator","collaborator":{"username":"mathias","url":"/mathias"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9061,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"This is public in the commit log and we've issued and advisory for the other stuff which was reported today, so it can be disclosed at any time.","markdown_message":"\u003cp\u003eThis is public in the commit log and we\u0026#39;ve issued and advisory for the other stuff which was reported today, so it can be disclosed at any time.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-02-24T01:16:17.494Z","updated_at":"2014-02-24T01:16:17.494Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":19792,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-03-26T01:09:32.623Z","updated_at":"2014-03-26T01:09:32.623Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Phabricator"}},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}