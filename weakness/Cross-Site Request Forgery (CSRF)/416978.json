{"id":416978,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MTY5Nzg=","url":"https://hackerone.com/reports/416978","title":"H1514 CSRF in Domain transfer allows adding your domain to other user's account","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-10-01T17:47:43.255Z","submitted_at":"2018-10-01T17:47:43.255Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rijalrojan","url":"/rijalrojan","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fBoPSSRSdMDTghBJexdu4AwG/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-03-30T16:25:16.748Z","bug_reporter_agreed_on_going_public_at":"2020-03-30T16:25:16.684Z","team_member_agreed_on_going_public_at":"2020-03-30T16:00:10.122Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\n\nShopify allows users to buy their own domain from the Shopify system. One of the facility on this is that if you buy the domain through Shopify, you can do an inter-store transfers. This means:\n\n\n\u003e You can only transfer your domain to a Shopify store owned by you. It can take up to 24 hours to complete the transfer.\n\nI ended up finding a CSRF that allows adding my domain to user X's store granted I know their *.myshopify.com.\n\n**Description:**\n\nWhen you request for a transfer of your domain to another store, an email is sent to you with the transfer link. This link looks like this: \n\n`https://www.shopify.com/login?redirect=settings/domains/initiate_inter_shop_domain_transfer?transfer_code=6fa6d18a-d2d1-4114-b11e-236b20f81398`\n\nWhat I realized was that it was asking me to login to my store inorder to transfer the domain. But because this would then redirect to settings/domains and initiate transfer, I decided to check what happens if I change the link to: \n\nhttps://victimstore.myshopify.com/admin/settings/domains/initiate_inter_shop_domain_transfer?transfer_code=6fa6d18a-d2d1-4114-b11e-236b20f81398.\n\nAfter I changed the link, I saved it as a HTML tag: `\u003cimg src=https://victimstore.myshopify.com/admin/settings/domains/initiate_inter_shop_domain_transfer?transfer_code=6fa6d18a-d2d1-4114-b11e-236b20f81398\u003e` and saved it as a .html file. Then, I logged into my \"victim\" store in incognito (no previous login to any shopify store) and opened the HTML. Soon after that the domain was transferred to the victim store. \n\nThe interesting part here is that it copies not just the domain but the DNS data as well. This not only included the MX, A, NS records but email forwarders and custom subdomains that I as an attacker would set prior to transferring. \n\n## Steps To Reproduce:\n\n(Add details for how we can reproduce the issue)\n\n**Not sure when the transfer link expires so if this does not work, please ping me on Slack**\n\n  1. Edit the attached html and replace YOURSTORE with your myshopify.com domain. You will then realize that going to h1-5142.com will redirect to your store.\n\n## Impact\n\nDomain changes to victim's store. I will look into this more in the coming week to escalate the attack further (possibly to steal store info and payment details).","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eShopify allows users to buy their own domain from the Shopify system. One of the facility on this is that if you buy the domain through Shopify, you can do an inter-store transfers. This means:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eYou can only transfer your domain to a Shopify store owned by you. It can take up to 24 hours to complete the transfer.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI ended up finding a CSRF that allows adding my domain to user X\u0026#39;s store granted I know their *.myshopify.com.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eWhen you request for a transfer of your domain to another store, an email is sent to you with the transfer link. This link looks like this: \u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ehttps://www.shopify.com/login?redirect=settings/domains/initiate_inter_shop_domain_transfer?transfer_code=6fa6d18a-d2d1-4114-b11e-236b20f81398\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eWhat I realized was that it was asking me to login to my store inorder to transfer the domain. But because this would then redirect to settings/domains and initiate transfer, I decided to check what happens if I change the link to: \u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://victimstore.myshopify.com/admin/settings/domains/initiate_inter_shop_domain_transfer?transfer_code=6fa6d18a-d2d1-4114-b11e-236b20f81398\" href=\"/redirect?url=https%3A%2F%2Fvictimstore.myshopify.com%2Fadmin%2Fsettings%2Fdomains%2Finitiate_inter_shop_domain_transfer%3Ftransfer_code%3D6fa6d18a-d2d1-4114-b11e-236b20f81398\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://victimstore.myshopify.com/admin/settings/domains/initiate_inter_shop_domain_transfer?transfer_code=6fa6d18a-d2d1-4114-b11e-236b20f81398\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eAfter I changed the link, I saved it as a HTML tag: \u003ccode\u003e\u0026lt;img src=https://victimstore.myshopify.com/admin/settings/domains/initiate_inter_shop_domain_transfer?transfer_code=6fa6d18a-d2d1-4114-b11e-236b20f81398\u0026gt;\u003c/code\u003e and saved it as a .html file. Then, I logged into my \u0026quot;victim\u0026quot; store in incognito (no previous login to any shopify store) and opened the HTML. Soon after that the domain was transferred to the victim store. \u003c/p\u003e\n\n\u003cp\u003eThe interesting part here is that it copies not just the domain but the DNS data as well. This not only included the MX, A, NS records but email forwarders and custom subdomains that I as an attacker would set prior to transferring. \u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003cp\u003e(Add details for how we can reproduce the issue)\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eNot sure when the transfer link expires so if this does not work, please ping me on Slack\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eEdit the attached html and replace YOURSTORE with your myshopify.com domain. You will then realize that going to h1-5142.com will redirect to your store.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eDomain changes to victim\u0026#39;s store. I will look into this more in the coming week to escalate the attack further (possibly to steal store info and payment details).\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":353858,"file_name":"csrf.html","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/353/858/4a927df4c8ac8bce9beda7192789c0ac86baa6b5/csrf.html?response-content-disposition=attachment%3B%20filename%3D%22csrf.html%22%3B%20filename%2A%3DUTF-8%27%27csrf.html\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6SZWJ7EV%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055447Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDnUzI%2BFGOFBLAScWuVOL4Lj3JmbbQAzP3Z0CGixtLCuAIgQzjjEEfRLfyvyTUcWPuh1TmLwtvXfhn4Y1cmYaMrO6cqtAMIVRABGgwwMTM2MTkyNzQ4NDkiDGp%2BpnVA5musWTL7NCqRA8%2FtWDfuTNl%2BTEZ8%2F83sOgEjGfhPO7hqas9S5YFvyrG29udKPmtcuewMHQFGoWh6uvbSTE9LPEkFDl6RosJJJY3ZsFaD9BGxtIOBINUPfZd26XnOL01fuCQ8x%2BiErJvv8vHBR5mWXV7L6t7A2%2F5H8dY91iEQFmPdZboRnRed4t2q9jcZCwrkzHwMk8bNRFkfRqzqUB6%2Buk39e4oyKwiyqROwDwnoUxIOrVdA29STuUYzszGBQ%2B3Eg%2Fr4I9Ys7sDaoYDHJAVEt%2F6kVnewTLU3uHfL%2F%2FzDR0ZnJa5Oo%2BmValn4%2Fn34Ke7o7csnn3piiGYIK4mihEWUVtJZnq0bZ%2BEU14q4ZLfb79tvTTKy5%2B9XC3vM1tWdFU6K%2F2PISAY5LoVEscNgJL0aQIq7sAX0f00Uyo2TeQTR%2B9TUOeUvW40metpNAt6ZQ8u0%2BuTZij%2FLNaYEe6v5RA7Fg8wzm%2Bu7IVusddMT4HgUuba3afxdFVj8x9iXROa6QZZ%2BdlHYNGywE8eJxO3jkpwbaZpUg8PZ17ztcb5%2BMLHSqv8FOusBshs3Z1RNetRK0o6yVAL2zGdldUlxbnMrusEP31v5WyfcSXKYrW1oJGSAAOlTEHZOawyDOEVKZdmLftLsa7vpv4NkkvDc0MjvNZjQrLWiuTmEalVC704buBLYftchmedTLOrsCMIpwWkxoPJnEqO2VZwPnup4B1lMH%2B%2FHO0btRwbDEfX1bZu7nae%2FPoCvN9o%2FT1iQ8GcaSv5OUJxppuy2cagjSuiUWEkOXPhYiBKpxTQMFIMtd6%2FpRtJ2YeCQgmRXXl1K6ayBDQAQxWFeKQPM5vtrAzDrzE9Adaqtb3AdlxqDjg74xdcM9YFdyg%3D%3D\u0026X-Amz-Signature=6c96ad1e179b654e6fdad70c17bffe0fed6009eae4c06b5a117fe9c6062a50e6","file_size":188,"type":"text/plain"}],"allow_singular_disclosure_at":null,"vote_count":19,"voters":["mik317","prophet","dhakal_ananda","mygf","0xatul","its_afolic","zimmer75","haruto","hamzaazam","clarckowen_","and 9 more..."],"severity":{"rating":"high","score":7.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"low"}},"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3476147,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @rijalrojan,\n\nThanks for the report! It appears the impact here would be relatively low, as you're \"gifting\" someone a domain. Bounty should be coming soon.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/rijalrojan\"\u003e@rijalrojan\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks for the report! It appears the impact here would be relatively low, as you\u0026#39;re \u0026quot;gifting\u0026quot; someone a domain. Bounty should be coming soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-13T19:15:51.902Z","updated_at":"2018-10-13T19:15:51.902Z","actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3476172,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-13T19:28:25.593Z","updated_at":"2018-10-13T19:28:25.593Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"rijalrojan","url":"/rijalrojan"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3476273,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @jack_mccracken. I looked into this and I can confirm, there was not much I could do.","markdown_message":"\u003cp\u003eThanks \u003ca href=\"/jack_mccracken\"\u003e@jack_mccracken\u003c/a\u003e. I looked into this and I can confirm, there was not much I could do.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-13T19:58:12.399Z","updated_at":"2018-10-13T19:58:12.399Z","actor":{"username":"rijalrojan","cleared":true,"url":"/rijalrojan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fBoPSSRSdMDTghBJexdu4AwG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3686505,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @rijalrojan,\n\nWe've deployed a fix for this. Thanks so much for your report \u0026 your participation in H1-514! We hope to see more from you soon :) ","markdown_message":"\u003cp\u003eHey \u003ca href=\"/rijalrojan\"\u003e@rijalrojan\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;ve deployed a fix for this. Thanks so much for your report \u0026amp; your participation in H1-514! We hope to see more from you soon :) \u003c/p\u003e\n","automated_response":false,"created_at":"2018-11-20T18:10:46.635Z","updated_at":"2018-11-20T18:10:46.635Z","actor":{"username":"jack_mccracken","cleared":false,"url":"/jack_mccracken","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/164/342/6543dc397b4dbb2c24dc81f92a42de654a3e6a99_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"rijalrojan","url":"/rijalrojan"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7147509,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-25T14:59:00.712Z","updated_at":"2020-02-25T14:59:00.712Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"your-store.myshopify.com","genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7483023,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-03-30T16:00:10.179Z","updated_at":"2020-03-30T16:00:10.179Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7483419,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-03-30T16:25:16.712Z","updated_at":"2020-03-30T16:25:16.712Z","actor":{"username":"rijalrojan","cleared":true,"url":"/rijalrojan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fBoPSSRSdMDTghBJexdu4AwG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7483420,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-03-30T16:25:16.779Z","updated_at":"2020-03-30T16:25:16.779Z","actor":{"username":"rijalrojan","cleared":true,"url":"/rijalrojan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fBoPSSRSdMDTghBJexdu4AwG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}