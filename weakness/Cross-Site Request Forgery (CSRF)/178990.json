{"id":178990,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNzg5OTA=","url":"https://hackerone.com/reports/178990","title":"The websocket traffic is not secure enough","state":"Closed","substate":"informative","severity_rating":"medium","readable_substate":"Informative","created_at":"2016-10-30T19:17:43.941Z","submitted_at":"2016-10-30T19:17:43.941Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"arnonymous","url":"/arnonymous","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/115/966/039e3ef33791903eef67a80ca6a255b9cc7601de_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1601,"url":"https://hackerone.com/legalrobot","handle":"legalrobot","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/601/0f164c3d9618b04b006b859517ff032ec57ab42a_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/601/0f164c3d9618b04b006b859517ff032ec57ab42a_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Legal Robot","twitter_handle":"LegalRobot","website":"https://www.legalrobot.com","about":"Automated legal document review using artificial intelligence"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-08-27T11:11:43.633Z","bug_reporter_agreed_on_going_public_at":"2017-08-27T11:11:43.604Z","team_member_agreed_on_going_public_at":"2017-08-26T23:19:57.976Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"'Cross-Site WebSocket Hijacking' is possible, because the websocket connection is not secure (enough). \nThe traffic from and to the websocket can be sniffed with Chrome (see attachment), and replayed elsewhere (cross-domain). Explanation: https://www.christian-schneider.net/CrossSiteWebSocketHijacking.html\n\n**Steps**:\nAfter opening the homepage (https://app.legalrobot-uat.com) a websocket is created after a HTTP request like: https://app.legalrobot-uat.com/sockjs/689/k287_2tz/websocket, with a HTTP101 (switching protocols) response, resulting in a connection wss://app.legalrobot-uat.com/sockjs/689/k287_2tz/websocket.\n\nThis (upgrade) request can be called from an external origin.\n{F131186}\n\nAfter knowing the websocket URL, messages (captured in chrome) can be successfully sent. \n\nFor example:\nOpen a session:  [\"{\\\"msg\\\":\\\"connect\\\",\\\"version\\\":\\\"1\\\",\\\"support\\\":[\\\"1\\\",\\\"pre2\\\",\\\"pre1\\\"]}\"]\nPing:  [\"{\\\"msg\\\":\\\"ping\\\"}\"]\nLogin:  [\"{\\\"msg\\\":\\\"method\\\",\\\"method\\\":\\\"login\\\",\\\"params\\\":[{\\\"user\\\":{\\\"email\\\":\\\"arnotstacc@gmail.com\\\"},\\\"password\\\":{\\\"digest\\\":\\\"082a7a2a81c2733fd03567e47e0b6d9f09d32ec80065bda9c5cd34dd1c4f9edf\\\",\\\"algorithm\\\":\\\"sha-256\\\"}}],\\\"id\\\":\\\"7\\\"}\"]\nIt is also unnecessary, to include the password algorithm in the login message (which can be encrypted with: http://md5decrypt.net/en/Sha256/)\n\nA successful test with above messages using: http://ironwasp.org/cswsh.html (an online test tool).\n{F131189}\n\n**Suggestions to fix**:\n- Check the origin from the requester server-side and adjust the Origin header for the 'upgrade' request.\n- Add additional 'CSRF tokens'.\n- Encrypt messages, so they cannot be intercepted in Chrome\n\n**Additional references**:\nhttps://www.notsosecure.com/how-cross-site-websocket-hijacking-could-lead-to-full-session-compromise/\nhttps://www.owasp.org/index.php/Testing_WebSockets_(OTG-CLIENT-010)\nhttps://humblesoftwaredev.wordpress.com/2016/08/01/securing-websocket-sockjs-connection/\n\n\n","vulnerability_information_html":"\u003cp\u003e\u0026#39;Cross-Site WebSocket Hijacking\u0026#39; is possible, because the websocket connection is not secure (enough). \u003cbr\u003e\nThe traffic from and to the websocket can be sniffed with Chrome (see attachment), and replayed elsewhere (cross-domain). Explanation: \u003ca title=\"https://www.christian-schneider.net/CrossSiteWebSocketHijacking.html\" href=\"/redirect?url=https%3A%2F%2Fwww.christian-schneider.net%2FCrossSiteWebSocketHijacking.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.christian-schneider.net/CrossSiteWebSocketHijacking.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSteps\u003c/strong\u003e:\u003cbr\u003e\nAfter opening the homepage (\u003ca title=\"https://app.legalrobot-uat.com\" href=\"/redirect?url=https%3A%2F%2Fapp.legalrobot-uat.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://app.legalrobot-uat.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) a websocket is created after a HTTP request like: \u003ca title=\"https://app.legalrobot-uat.com/sockjs/689/k287_2tz/websocket\" href=\"/redirect?url=https%3A%2F%2Fapp.legalrobot-uat.com%2Fsockjs%2F689%2Fk287_2tz%2Fwebsocket\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://app.legalrobot-uat.com/sockjs/689/k287_2tz/websocket\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, with a HTTP101 (switching protocols) response, resulting in a connection wss://app.legalrobot-uat.com/sockjs/689/k287_2tz/websocket.\u003c/p\u003e\n\n\u003cp\u003eThis (upgrade) request can be called from an external origin.\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"legarobot-ws-upgrade_2016-10-30_1641_001.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/131/186/172b87d930a3f23774e55c1c9e36272043209655/legarobot-ws-upgrade_2016-10-30_1641_001.png?response-content-disposition=attachment%3B%20filename%3D%22legarobot-ws-upgrade_2016-10-30_1641_001.png%22%3B%20filename%2A%3DUTF-8%27%27legarobot-ws-upgrade_2016-10-30_1641_001.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQVBWWKZ4H%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T044418Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCmEbZvVQ%2FI1GHRJjrhZK2Y6zh4lCWK725%2FwOpNu%2BnZkAIhAIZlqGHog%2B4PZMdnvhSU5APZbycPDz1wpNXbi5uE94ueKrQDCFUQARoMMDEzNjE5Mjc0ODQ5IgxU5AAHhqo1cPAzbTcqkQOGB5pEHXl6QCBCTSHUmyd%2FF8M3rpTqzp%2BOigrWU%2BrXYHZYm%2BGDawsiXhnqeD9o8Qw0b%2Fr0efVbRmhj5baoPrxgSiY%2B9zsreR3qClZZKnS0%2Brs8OqiMGd3clBbyfOxw2fa2vgQglV4dLF6EXSiGfxOms8eWdw%2F8mPtc81dMxDIlxTs50KUnd6aUjgG5BJs2k%2FL0rOKXYBS%2FdVqIQdN8JcCKMvqDv0u7pvSGEecQXa7pGdf07ufO02E64eU0OnaTeNyoq7WlZzT%2FGyvHjVtIvbXdPW15pwZm2Q4u8%2FW7ksSv4%2BxsESWLLCop0OeGUhtIppCDQlaMPC9JTj0HYKbMEGmZagmLfgHX4DKRg75%2FLNQViGcE%2FRCCaMxd6wrsv0dlz4dekjWvp4mXzLFkuKBM6c%2F%2BAemkmkgOJKnp%2FJUV1zJTe%2BO14GyIigsvxJqvrnKvkmsUrYwar1bX%2Be7UkqGzVbMAlsbRDNIOok7bVRXerhpXnbqFQsLWlqe%2BNfa4gSSfmgu4iIjCRRMdTWsvy2NQHfTsGjDAzar%2FBTrqAcniMm3eG7%2BxDZb9XVqMyQiSNyiuBD8pwO78bO8T3Uu8vSI3S05C6UCutmNkOnjR9D2NZaOgbFO4YujbW%2FY0mhhdjSppvg%2Bzdgu0AfZOou0DDwqm4vwEc0ekiNYUD6KHvD5tZwOaalihV5dSfbzoDyvfsJI6x7RYpBZmwPcshKw3Csz0uZew1JqrbUJVmc9v6q0aXols8bxyDKKPfp6siyzKhHELgTS3XGskds%2BWx5FaWemc%2Bo8QqyIuoOtWjmUwF39ydFOfg%2FyeKdwBxELGLKCSN8MyV6ov7IBrib4UiM%2F6l36ymDoHIX8ohg%3D%3D\u0026amp;X-Amz-Signature=08709ddadd7e74240e22d65ddf449334f25225105990f77aaa05853ef02c8a9d\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/131/186/172b87d930a3f23774e55c1c9e36272043209655/legarobot-ws-upgrade_2016-10-30_1641_001.png?response-content-disposition=attachment%3B%20filename%3D%22legarobot-ws-upgrade_2016-10-30_1641_001.png%22%3B%20filename%2A%3DUTF-8%27%27legarobot-ws-upgrade_2016-10-30_1641_001.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQVBWWKZ4H%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T044418Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCmEbZvVQ%2FI1GHRJjrhZK2Y6zh4lCWK725%2FwOpNu%2BnZkAIhAIZlqGHog%2B4PZMdnvhSU5APZbycPDz1wpNXbi5uE94ueKrQDCFUQARoMMDEzNjE5Mjc0ODQ5IgxU5AAHhqo1cPAzbTcqkQOGB5pEHXl6QCBCTSHUmyd%2FF8M3rpTqzp%2BOigrWU%2BrXYHZYm%2BGDawsiXhnqeD9o8Qw0b%2Fr0efVbRmhj5baoPrxgSiY%2B9zsreR3qClZZKnS0%2Brs8OqiMGd3clBbyfOxw2fa2vgQglV4dLF6EXSiGfxOms8eWdw%2F8mPtc81dMxDIlxTs50KUnd6aUjgG5BJs2k%2FL0rOKXYBS%2FdVqIQdN8JcCKMvqDv0u7pvSGEecQXa7pGdf07ufO02E64eU0OnaTeNyoq7WlZzT%2FGyvHjVtIvbXdPW15pwZm2Q4u8%2FW7ksSv4%2BxsESWLLCop0OeGUhtIppCDQlaMPC9JTj0HYKbMEGmZagmLfgHX4DKRg75%2FLNQViGcE%2FRCCaMxd6wrsv0dlz4dekjWvp4mXzLFkuKBM6c%2F%2BAemkmkgOJKnp%2FJUV1zJTe%2BO14GyIigsvxJqvrnKvkmsUrYwar1bX%2Be7UkqGzVbMAlsbRDNIOok7bVRXerhpXnbqFQsLWlqe%2BNfa4gSSfmgu4iIjCRRMdTWsvy2NQHfTsGjDAzar%2FBTrqAcniMm3eG7%2BxDZb9XVqMyQiSNyiuBD8pwO78bO8T3Uu8vSI3S05C6UCutmNkOnjR9D2NZaOgbFO4YujbW%2FY0mhhdjSppvg%2Bzdgu0AfZOou0DDwqm4vwEc0ekiNYUD6KHvD5tZwOaalihV5dSfbzoDyvfsJI6x7RYpBZmwPcshKw3Csz0uZew1JqrbUJVmc9v6q0aXols8bxyDKKPfp6siyzKhHELgTS3XGskds%2BWx5FaWemc%2Bo8QqyIuoOtWjmUwF39ydFOfg%2FyeKdwBxELGLKCSN8MyV6ov7IBrib4UiM%2F6l36ymDoHIX8ohg%3D%3D\u0026amp;X-Amz-Signature=08709ddadd7e74240e22d65ddf449334f25225105990f77aaa05853ef02c8a9d\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAfter knowing the websocket URL, messages (captured in chrome) can be successfully sent. \u003c/p\u003e\n\n\u003cp\u003eFor example:\u003cbr\u003e\nOpen a session:  [\u0026quot;{\\\u0026quot;msg\\\u0026quot;:\\\u0026quot;connect\\\u0026quot;,\\\u0026quot;version\\\u0026quot;:\\\u0026quot;1\\\u0026quot;,\\\u0026quot;support\\\u0026quot;:[\\\u0026quot;1\\\u0026quot;,\\\u0026quot;pre2\\\u0026quot;,\\\u0026quot;pre1\\\u0026quot;]}\u0026quot;]\u003cbr\u003e\nPing:  [\u0026quot;{\\\u0026quot;msg\\\u0026quot;:\\\u0026quot;ping\\\u0026quot;}\u0026quot;]\u003cbr\u003e\nLogin:  [\u0026quot;{\\\u0026quot;msg\\\u0026quot;:\\\u0026quot;method\\\u0026quot;,\\\u0026quot;method\\\u0026quot;:\\\u0026quot;login\\\u0026quot;,\\\u0026quot;params\\\u0026quot;:[{\\\u0026quot;user\\\u0026quot;:{\\\u0026quot;email\\\u0026quot;:\\\u0026quot;\u003ca title=\"arnotstacc@gmail.com\" href=\"mailto:arnotstacc@gmail.com\" rel=\"nofollow noopener noreferrer\"\u003earnotstacc@gmail.com\u003c/a\u003e\\\u0026quot;},\\\u0026quot;password\\\u0026quot;:{\\\u0026quot;digest\\\u0026quot;:\\\u0026quot;082a7a2a81c2733fd03567e47e0b6d9f09d32ec80065bda9c5cd34dd1c4f9edf\\\u0026quot;,\\\u0026quot;algorithm\\\u0026quot;:\\\u0026quot;sha-256\\\u0026quot;}}],\\\u0026quot;id\\\u0026quot;:\\\u0026quot;7\\\u0026quot;}\u0026quot;]\u003cbr\u003e\nIt is also unnecessary, to include the password algorithm in the login message (which can be encrypted with: \u003ca title=\"http://md5decrypt.net/en/Sha256/\" href=\"/redirect?url=http%3A%2F%2Fmd5decrypt.net%2Fen%2FSha256%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://md5decrypt.net/en/Sha256/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003eA successful test with above messages using: \u003ca title=\"http://ironwasp.org/cswsh.html\" href=\"/redirect?url=http%3A%2F%2Fironwasp.org%2Fcswsh.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://ironwasp.org/cswsh.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (an online test tool).\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"ironwasp-test_2016-10-30_1909.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/131/189/b53c05681ff006b76690dfa606fa61eee7500b1f/ironwasp-test_2016-10-30_1909.png?response-content-disposition=attachment%3B%20filename%3D%22ironwasp-test_2016-10-30_1909.png%22%3B%20filename%2A%3DUTF-8%27%27ironwasp-test_2016-10-30_1909.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQVBWWKZ4H%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T044418Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCmEbZvVQ%2FI1GHRJjrhZK2Y6zh4lCWK725%2FwOpNu%2BnZkAIhAIZlqGHog%2B4PZMdnvhSU5APZbycPDz1wpNXbi5uE94ueKrQDCFUQARoMMDEzNjE5Mjc0ODQ5IgxU5AAHhqo1cPAzbTcqkQOGB5pEHXl6QCBCTSHUmyd%2FF8M3rpTqzp%2BOigrWU%2BrXYHZYm%2BGDawsiXhnqeD9o8Qw0b%2Fr0efVbRmhj5baoPrxgSiY%2B9zsreR3qClZZKnS0%2Brs8OqiMGd3clBbyfOxw2fa2vgQglV4dLF6EXSiGfxOms8eWdw%2F8mPtc81dMxDIlxTs50KUnd6aUjgG5BJs2k%2FL0rOKXYBS%2FdVqIQdN8JcCKMvqDv0u7pvSGEecQXa7pGdf07ufO02E64eU0OnaTeNyoq7WlZzT%2FGyvHjVtIvbXdPW15pwZm2Q4u8%2FW7ksSv4%2BxsESWLLCop0OeGUhtIppCDQlaMPC9JTj0HYKbMEGmZagmLfgHX4DKRg75%2FLNQViGcE%2FRCCaMxd6wrsv0dlz4dekjWvp4mXzLFkuKBM6c%2F%2BAemkmkgOJKnp%2FJUV1zJTe%2BO14GyIigsvxJqvrnKvkmsUrYwar1bX%2Be7UkqGzVbMAlsbRDNIOok7bVRXerhpXnbqFQsLWlqe%2BNfa4gSSfmgu4iIjCRRMdTWsvy2NQHfTsGjDAzar%2FBTrqAcniMm3eG7%2BxDZb9XVqMyQiSNyiuBD8pwO78bO8T3Uu8vSI3S05C6UCutmNkOnjR9D2NZaOgbFO4YujbW%2FY0mhhdjSppvg%2Bzdgu0AfZOou0DDwqm4vwEc0ekiNYUD6KHvD5tZwOaalihV5dSfbzoDyvfsJI6x7RYpBZmwPcshKw3Csz0uZew1JqrbUJVmc9v6q0aXols8bxyDKKPfp6siyzKhHELgTS3XGskds%2BWx5FaWemc%2Bo8QqyIuoOtWjmUwF39ydFOfg%2FyeKdwBxELGLKCSN8MyV6ov7IBrib4UiM%2F6l36ymDoHIX8ohg%3D%3D\u0026amp;X-Amz-Signature=eb5177a8f0b68239fd0689e6a59a0f282e43d59d81d34eaa534f54c33e2ea800\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/131/189/b53c05681ff006b76690dfa606fa61eee7500b1f/ironwasp-test_2016-10-30_1909.png?response-content-disposition=attachment%3B%20filename%3D%22ironwasp-test_2016-10-30_1909.png%22%3B%20filename%2A%3DUTF-8%27%27ironwasp-test_2016-10-30_1909.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQVBWWKZ4H%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T044418Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCmEbZvVQ%2FI1GHRJjrhZK2Y6zh4lCWK725%2FwOpNu%2BnZkAIhAIZlqGHog%2B4PZMdnvhSU5APZbycPDz1wpNXbi5uE94ueKrQDCFUQARoMMDEzNjE5Mjc0ODQ5IgxU5AAHhqo1cPAzbTcqkQOGB5pEHXl6QCBCTSHUmyd%2FF8M3rpTqzp%2BOigrWU%2BrXYHZYm%2BGDawsiXhnqeD9o8Qw0b%2Fr0efVbRmhj5baoPrxgSiY%2B9zsreR3qClZZKnS0%2Brs8OqiMGd3clBbyfOxw2fa2vgQglV4dLF6EXSiGfxOms8eWdw%2F8mPtc81dMxDIlxTs50KUnd6aUjgG5BJs2k%2FL0rOKXYBS%2FdVqIQdN8JcCKMvqDv0u7pvSGEecQXa7pGdf07ufO02E64eU0OnaTeNyoq7WlZzT%2FGyvHjVtIvbXdPW15pwZm2Q4u8%2FW7ksSv4%2BxsESWLLCop0OeGUhtIppCDQlaMPC9JTj0HYKbMEGmZagmLfgHX4DKRg75%2FLNQViGcE%2FRCCaMxd6wrsv0dlz4dekjWvp4mXzLFkuKBM6c%2F%2BAemkmkgOJKnp%2FJUV1zJTe%2BO14GyIigsvxJqvrnKvkmsUrYwar1bX%2Be7UkqGzVbMAlsbRDNIOok7bVRXerhpXnbqFQsLWlqe%2BNfa4gSSfmgu4iIjCRRMdTWsvy2NQHfTsGjDAzar%2FBTrqAcniMm3eG7%2BxDZb9XVqMyQiSNyiuBD8pwO78bO8T3Uu8vSI3S05C6UCutmNkOnjR9D2NZaOgbFO4YujbW%2FY0mhhdjSppvg%2Bzdgu0AfZOou0DDwqm4vwEc0ekiNYUD6KHvD5tZwOaalihV5dSfbzoDyvfsJI6x7RYpBZmwPcshKw3Csz0uZew1JqrbUJVmc9v6q0aXols8bxyDKKPfp6siyzKhHELgTS3XGskds%2BWx5FaWemc%2Bo8QqyIuoOtWjmUwF39ydFOfg%2FyeKdwBxELGLKCSN8MyV6ov7IBrib4UiM%2F6l36ymDoHIX8ohg%3D%3D\u0026amp;X-Amz-Signature=eb5177a8f0b68239fd0689e6a59a0f282e43d59d81d34eaa534f54c33e2ea800\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSuggestions to fix\u003c/strong\u003e:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eCheck the origin from the requester server-side and adjust the Origin header for the \u0026#39;upgrade\u0026#39; request.\u003c/li\u003e\n\u003cli\u003eAdd additional \u0026#39;CSRF tokens\u0026#39;.\u003c/li\u003e\n\u003cli\u003eEncrypt messages, so they cannot be intercepted in Chrome\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003eAdditional references\u003c/strong\u003e:\u003cbr\u003e\n\u003ca title=\"https://www.notsosecure.com/how-cross-site-websocket-hijacking-could-lead-to-full-session-compromise/\" href=\"/redirect?url=https%3A%2F%2Fwww.notsosecure.com%2Fhow-cross-site-websocket-hijacking-could-lead-to-full-session-compromise%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.notsosecure.com/how-cross-site-websocket-hijacking-could-lead-to-full-session-compromise/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://www.owasp.org/index.php/Testing_WebSockets_(OTG-CLIENT-010)\" href=\"/redirect?url=https%3A%2F%2Fwww.owasp.org%2Findex.php%2FTesting_WebSockets_%28OTG-CLIENT-010%29\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.owasp.org/index.php/Testing_WebSockets_(OTG-CLIENT-010)\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://humblesoftwaredev.wordpress.com/2016/08/01/securing-websocket-sockjs-connection/\" href=\"/redirect?url=https%3A%2F%2Fhumblesoftwaredev.wordpress.com%2F2016%2F08%2F01%2Fsecuring-websocket-sockjs-connection%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://humblesoftwaredev.wordpress.com/2016/08/01/securing-websocket-sockjs-connection/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":131186,"file_name":"legarobot-ws-upgrade_2016-10-30_1641_001.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/131/186/172b87d930a3f23774e55c1c9e36272043209655/legarobot-ws-upgrade_2016-10-30_1641_001.png?response-content-disposition=attachment%3B%20filename%3D%22legarobot-ws-upgrade_2016-10-30_1641_001.png%22%3B%20filename%2A%3DUTF-8%27%27legarobot-ws-upgrade_2016-10-30_1641_001.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVBWWKZ4H%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044418Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCmEbZvVQ%2FI1GHRJjrhZK2Y6zh4lCWK725%2FwOpNu%2BnZkAIhAIZlqGHog%2B4PZMdnvhSU5APZbycPDz1wpNXbi5uE94ueKrQDCFUQARoMMDEzNjE5Mjc0ODQ5IgxU5AAHhqo1cPAzbTcqkQOGB5pEHXl6QCBCTSHUmyd%2FF8M3rpTqzp%2BOigrWU%2BrXYHZYm%2BGDawsiXhnqeD9o8Qw0b%2Fr0efVbRmhj5baoPrxgSiY%2B9zsreR3qClZZKnS0%2Brs8OqiMGd3clBbyfOxw2fa2vgQglV4dLF6EXSiGfxOms8eWdw%2F8mPtc81dMxDIlxTs50KUnd6aUjgG5BJs2k%2FL0rOKXYBS%2FdVqIQdN8JcCKMvqDv0u7pvSGEecQXa7pGdf07ufO02E64eU0OnaTeNyoq7WlZzT%2FGyvHjVtIvbXdPW15pwZm2Q4u8%2FW7ksSv4%2BxsESWLLCop0OeGUhtIppCDQlaMPC9JTj0HYKbMEGmZagmLfgHX4DKRg75%2FLNQViGcE%2FRCCaMxd6wrsv0dlz4dekjWvp4mXzLFkuKBM6c%2F%2BAemkmkgOJKnp%2FJUV1zJTe%2BO14GyIigsvxJqvrnKvkmsUrYwar1bX%2Be7UkqGzVbMAlsbRDNIOok7bVRXerhpXnbqFQsLWlqe%2BNfa4gSSfmgu4iIjCRRMdTWsvy2NQHfTsGjDAzar%2FBTrqAcniMm3eG7%2BxDZb9XVqMyQiSNyiuBD8pwO78bO8T3Uu8vSI3S05C6UCutmNkOnjR9D2NZaOgbFO4YujbW%2FY0mhhdjSppvg%2Bzdgu0AfZOou0DDwqm4vwEc0ekiNYUD6KHvD5tZwOaalihV5dSfbzoDyvfsJI6x7RYpBZmwPcshKw3Csz0uZew1JqrbUJVmc9v6q0aXols8bxyDKKPfp6siyzKhHELgTS3XGskds%2BWx5FaWemc%2Bo8QqyIuoOtWjmUwF39ydFOfg%2FyeKdwBxELGLKCSN8MyV6ov7IBrib4UiM%2F6l36ymDoHIX8ohg%3D%3D\u0026X-Amz-Signature=08709ddadd7e74240e22d65ddf449334f25225105990f77aaa05853ef02c8a9d","file_size":50001,"type":"image/png"},{"id":131188,"file_name":"websocket_legalrobot_chrome.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/131/188/77642563f712b5477a69cd3080662612224eb863/websocket_legalrobot_chrome.png?response-content-disposition=attachment%3B%20filename%3D%22websocket_legalrobot_chrome.png%22%3B%20filename%2A%3DUTF-8%27%27websocket_legalrobot_chrome.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVBWWKZ4H%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044418Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCmEbZvVQ%2FI1GHRJjrhZK2Y6zh4lCWK725%2FwOpNu%2BnZkAIhAIZlqGHog%2B4PZMdnvhSU5APZbycPDz1wpNXbi5uE94ueKrQDCFUQARoMMDEzNjE5Mjc0ODQ5IgxU5AAHhqo1cPAzbTcqkQOGB5pEHXl6QCBCTSHUmyd%2FF8M3rpTqzp%2BOigrWU%2BrXYHZYm%2BGDawsiXhnqeD9o8Qw0b%2Fr0efVbRmhj5baoPrxgSiY%2B9zsreR3qClZZKnS0%2Brs8OqiMGd3clBbyfOxw2fa2vgQglV4dLF6EXSiGfxOms8eWdw%2F8mPtc81dMxDIlxTs50KUnd6aUjgG5BJs2k%2FL0rOKXYBS%2FdVqIQdN8JcCKMvqDv0u7pvSGEecQXa7pGdf07ufO02E64eU0OnaTeNyoq7WlZzT%2FGyvHjVtIvbXdPW15pwZm2Q4u8%2FW7ksSv4%2BxsESWLLCop0OeGUhtIppCDQlaMPC9JTj0HYKbMEGmZagmLfgHX4DKRg75%2FLNQViGcE%2FRCCaMxd6wrsv0dlz4dekjWvp4mXzLFkuKBM6c%2F%2BAemkmkgOJKnp%2FJUV1zJTe%2BO14GyIigsvxJqvrnKvkmsUrYwar1bX%2Be7UkqGzVbMAlsbRDNIOok7bVRXerhpXnbqFQsLWlqe%2BNfa4gSSfmgu4iIjCRRMdTWsvy2NQHfTsGjDAzar%2FBTrqAcniMm3eG7%2BxDZb9XVqMyQiSNyiuBD8pwO78bO8T3Uu8vSI3S05C6UCutmNkOnjR9D2NZaOgbFO4YujbW%2FY0mhhdjSppvg%2Bzdgu0AfZOou0DDwqm4vwEc0ekiNYUD6KHvD5tZwOaalihV5dSfbzoDyvfsJI6x7RYpBZmwPcshKw3Csz0uZew1JqrbUJVmc9v6q0aXols8bxyDKKPfp6siyzKhHELgTS3XGskds%2BWx5FaWemc%2Bo8QqyIuoOtWjmUwF39ydFOfg%2FyeKdwBxELGLKCSN8MyV6ov7IBrib4UiM%2F6l36ymDoHIX8ohg%3D%3D\u0026X-Amz-Signature=1df369b8f0c78d888969f79d0e7b2f5fb6a5b521ff407aff77b349edfb439dac","file_size":168709,"type":"image/png"},{"id":131189,"file_name":"ironwasp-test_2016-10-30_1909.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/131/189/b53c05681ff006b76690dfa606fa61eee7500b1f/ironwasp-test_2016-10-30_1909.png?response-content-disposition=attachment%3B%20filename%3D%22ironwasp-test_2016-10-30_1909.png%22%3B%20filename%2A%3DUTF-8%27%27ironwasp-test_2016-10-30_1909.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVBWWKZ4H%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044418Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCmEbZvVQ%2FI1GHRJjrhZK2Y6zh4lCWK725%2FwOpNu%2BnZkAIhAIZlqGHog%2B4PZMdnvhSU5APZbycPDz1wpNXbi5uE94ueKrQDCFUQARoMMDEzNjE5Mjc0ODQ5IgxU5AAHhqo1cPAzbTcqkQOGB5pEHXl6QCBCTSHUmyd%2FF8M3rpTqzp%2BOigrWU%2BrXYHZYm%2BGDawsiXhnqeD9o8Qw0b%2Fr0efVbRmhj5baoPrxgSiY%2B9zsreR3qClZZKnS0%2Brs8OqiMGd3clBbyfOxw2fa2vgQglV4dLF6EXSiGfxOms8eWdw%2F8mPtc81dMxDIlxTs50KUnd6aUjgG5BJs2k%2FL0rOKXYBS%2FdVqIQdN8JcCKMvqDv0u7pvSGEecQXa7pGdf07ufO02E64eU0OnaTeNyoq7WlZzT%2FGyvHjVtIvbXdPW15pwZm2Q4u8%2FW7ksSv4%2BxsESWLLCop0OeGUhtIppCDQlaMPC9JTj0HYKbMEGmZagmLfgHX4DKRg75%2FLNQViGcE%2FRCCaMxd6wrsv0dlz4dekjWvp4mXzLFkuKBM6c%2F%2BAemkmkgOJKnp%2FJUV1zJTe%2BO14GyIigsvxJqvrnKvkmsUrYwar1bX%2Be7UkqGzVbMAlsbRDNIOok7bVRXerhpXnbqFQsLWlqe%2BNfa4gSSfmgu4iIjCRRMdTWsvy2NQHfTsGjDAzar%2FBTrqAcniMm3eG7%2BxDZb9XVqMyQiSNyiuBD8pwO78bO8T3Uu8vSI3S05C6UCutmNkOnjR9D2NZaOgbFO4YujbW%2FY0mhhdjSppvg%2Bzdgu0AfZOou0DDwqm4vwEc0ekiNYUD6KHvD5tZwOaalihV5dSfbzoDyvfsJI6x7RYpBZmwPcshKw3Csz0uZew1JqrbUJVmc9v6q0aXols8bxyDKKPfp6siyzKhHELgTS3XGskds%2BWx5FaWemc%2Bo8QqyIuoOtWjmUwF39ydFOfg%2FyeKdwBxELGLKCSN8MyV6ov7IBrib4UiM%2F6l36ymDoHIX8ohg%3D%3D\u0026X-Amz-Signature=eb5177a8f0b68239fd0689e6a59a0f282e43d59d81d34eaa534f54c33e2ea800","file_size":77670,"type":"image/png"}],"allow_singular_disclosure_at":null,"vote_count":1,"voters":["skansing"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1284868,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Thanks for the report. Luckily for us, the framework we use (Meteor), while it relies heavily on web sockets, seems to be immune to this type of attack because it uses on localStorage for authentication rather than cookie-based auth or other fairly vulnerable methods. By design, the sensitive information in localStorage is only accessible by javascript from the same origin.\n\nWhile it is possible to replay an upgrade request from another origin, the process you describe would require an attacker to compromise a user's browser to access the digest in order to be authenticated. If the browser itself is compromised, that's not really something we could protect against.\n\nHere is some more detail on the security implications of CSWSH-type attacks in Meteor: http://www.east5th.co/blog/2015/06/08/authentication-with-localstorage/\n\nNow, if there was some way to establish an authenticated web socket connection from another origin, that would be A Very Bad Day™ for us, and for every other site that uses the Meteor framework. It's one reason we're so sensitive to respond to script injection attacks since some of those could potentially expose localStorage. Perhaps that is a potential attack vector for you to attempt: if you can somehow inject a script and expose the token in localStorage, then use that to execute arbitrary code on a malicious server. So, I'm going to close out this issue and we can reopen it if an attack like that can be demonstrated.","markdown_message":"\u003cp\u003eThanks for the report. Luckily for us, the framework we use (Meteor), while it relies heavily on web sockets, seems to be immune to this type of attack because it uses on localStorage for authentication rather than cookie-based auth or other fairly vulnerable methods. By design, the sensitive information in localStorage is only accessible by javascript from the same origin.\u003c/p\u003e\n\n\u003cp\u003eWhile it is possible to replay an upgrade request from another origin, the process you describe would require an attacker to compromise a user\u0026#39;s browser to access the digest in order to be authenticated. If the browser itself is compromised, that\u0026#39;s not really something we could protect against.\u003c/p\u003e\n\n\u003cp\u003eHere is some more detail on the security implications of CSWSH-type attacks in Meteor: \u003ca title=\"http://www.east5th.co/blog/2015/06/08/authentication-with-localstorage/\" href=\"/redirect?url=http%3A%2F%2Fwww.east5th.co%2Fblog%2F2015%2F06%2F08%2Fauthentication-with-localstorage%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.east5th.co/blog/2015/06/08/authentication-with-localstorage/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNow, if there was some way to establish an authenticated web socket connection from another origin, that would be A Very Bad Day™ for us, and for every other site that uses the Meteor framework. It\u0026#39;s one reason we\u0026#39;re so sensitive to respond to script injection attacks since some of those could potentially expose localStorage. Perhaps that is a potential attack vector for you to attempt: if you can somehow inject a script and expose the token in localStorage, then use that to execute arbitrary code on a malicious server. So, I\u0026#39;m going to close out this issue and we can reopen it if an attack like that can be demonstrated.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-04T18:13:07.936Z","updated_at":"2016-11-04T18:13:07.936Z","actor":{"username":"danrubins","cleared":false,"url":"/danrubins","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/222/c1d0d51f40e0c570e2153b6801fe54c997c757f0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1957553,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-26T23:19:57.995Z","updated_at":"2017-08-26T23:19:57.995Z","first_to_agree":true,"actor":{"username":"danrubins","cleared":false,"url":"/danrubins","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/222/c1d0d51f40e0c570e2153b6801fe54c997c757f0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1958025,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-27T11:11:43.618Z","updated_at":"2017-08-27T11:11:43.618Z","actor":{"username":"arnonymous","cleared":false,"url":"/arnonymous","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/115/966/039e3ef33791903eef67a80ca6a255b9cc7601de_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1958026,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-27T11:11:43.647Z","updated_at":"2017-08-27T11:11:43.647Z","actor":{"username":"arnonymous","cleared":false,"url":"/arnonymous","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/115/966/039e3ef33791903eef67a80ca6a255b9cc7601de_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}