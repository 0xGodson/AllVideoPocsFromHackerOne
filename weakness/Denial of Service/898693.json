{"id":898693,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84OTg2OTM=","url":"https://hackerone.com/reports/898693","title":"Out of memory with combination of `test_config_set` and `test_config_reload`","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-06-15T14:41:29.602Z","submitted_at":"2020-06-15T14:41:29.602Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"catenacyber","url":"/catenacyber","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-07-07T07:07:37.423Z","bug_reporter_agreed_on_going_public_at":"2020-07-07T07:06:57.168Z","team_member_agreed_on_going_public_at":"2020-07-07T07:07:37.343Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Running testsuite on input\n```\nrequire \"vnd.dovecot.testsuite\";\nrequire \"variables\";\nrequire \"editheader\";\n\n\ntest_set \"message\" \"${message}\";\ntest \"Default protected\" {\n\tif not exists \"received\" {\n\t\ttest_fail \"received header did not exist in the first place\";\n\t}\n}\n\ntest_config_set \"sieve_editheader_protected\" \"Àubject delivery-date x-frop\";\ntest_config_reload :extension \"editheader\";\n```\n\nseems to reach an infinite loop keeping on allocating memory, leading to Denial of service by memory exhaustion.\n\nTop allocations are :\n```\n268370400 byte(s) (61%) in 12 allocation(s)\n    #0 0x1112f7f53 in wrap_malloc (libclang_rt.asan_osx_dynamic.dylib:x86_64h+0x56f53)\n    #1 0x111166f65 in mem_block_alloc (libdovecot.0.dylib:x86_64+0xa8f65)\n    #2 0x111166bb3 in t_malloc_real (libdovecot.0.dylib:x86_64+0xa8bb3)\n    #3 0x111166d9f in t_buffer_get (libdovecot.0.dylib:x86_64+0xa8d9f)\n    #4 0x1111aa1a7 in t_noalloc_strdup_vprintf (libdovecot.0.dylib:x86_64+0xec1a7)\n    #5 0x1111aa0cf in p_strdup_vprintf (libdovecot.0.dylib:x86_64+0xec0cf)\n    #6 0x10f8ccb0b in testsuite_error_handler testsuite-log.c:168\n    #7 0x11118ce77 in event_vsend (libdovecot.0.dylib:x86_64+0xcee77)\n    #8 0x11118cda1 in event_send (libdovecot.0.dylib:x86_64+0xceda1)\n    #9 0x111169938 in event_logv (libdovecot.0.dylib:x86_64+0xab938)\n    #10 0x111169a31 in e_warning (libdovecot.0.dylib:x86_64+0xaba31)\n    #11 0x110cdb4f8 in ext_editheader_config_headers ext-editheader-common.c:68\n    #12 0x110cdb064 in ext_editheader_load ext-editheader-common.c:111\n    #13 0x110c51d1f in _sieve_extension_load sieve-extensions.c:322\n    #14 0x10f8d4b91 in cmd_test_config_reload_operation_execute cmd-test-config.c:501\n    #15 0x110c2321d in sieve_interpreter_operation_execute sieve-interpreter.c:900\n    #16 0x110c22c2e in sieve_interpreter_continue sieve-interpreter.c:941\n    #17 0x110c23806 in sieve_interpreter_start sieve-interpreter.c:1013\n\n\n134168576 byte(s) (30%) in 12 allocation(s)\n    #0 0x1112f8497 in wrap_calloc (libclang_rt.asan_osx_dynamic.dylib:x86_64h+0x57497)\n    #1 0x111191071 in block_alloc (libdovecot.0.dylib:x86_64+0xd3071)\n    #2 0x1111913dd in pool_alloconly_malloc (libdovecot.0.dylib:x86_64+0xd33dd)\n    #3 0x1111aa0fb in p_strdup_vprintf (libdovecot.0.dylib:x86_64+0xec0fb)\n    #4 0x10f8ccb0b in testsuite_error_handler testsuite-log.c:168\n    #5 0x11118ce77 in event_vsend (libdovecot.0.dylib:x86_64+0xcee77)\n    #6 0x11118cda1 in event_send (libdovecot.0.dylib:x86_64+0xceda1)\n    #7 0x111169938 in event_logv (libdovecot.0.dylib:x86_64+0xab938)\n    #8 0x111169a31 in e_warning (libdovecot.0.dylib:x86_64+0xaba31)\n    #9 0x110cdb4f8 in ext_editheader_config_headers ext-editheader-common.c:68\n    #10 0x110cdb064 in ext_editheader_load ext-editheader-common.c:111\n    #11 0x110c51d1f in _sieve_extension_load sieve-extensions.c:322\n    #12 0x10f8d4b91 in cmd_test_config_reload_operation_execute cmd-test-config.c:501\n    #13 0x110c2321d in sieve_interpreter_operation_execute sieve-interpreter.c:900\n    #14 0x110c22c2e in sieve_interpreter_continue sieve-interpreter.c:941\n    #15 0x110c23806 in sieve_interpreter_start sieve-interpreter.c:1013\n```\n\n## Impact\n\nConsuming too much memory leads to denial of service of the software, and even of the whole machine if not configured properly.","vulnerability_information_html":"\u003cp\u003eRunning testsuite on input\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003erequire \u0026quot;vnd.dovecot.testsuite\u0026quot;;\nrequire \u0026quot;variables\u0026quot;;\nrequire \u0026quot;editheader\u0026quot;;\n\n\ntest_set \u0026quot;message\u0026quot; \u0026quot;${message}\u0026quot;;\ntest \u0026quot;Default protected\u0026quot; {\n    if not exists \u0026quot;received\u0026quot; {\n        test_fail \u0026quot;received header did not exist in the first place\u0026quot;;\n    }\n}\n\ntest_config_set \u0026quot;sieve_editheader_protected\u0026quot; \u0026quot;Àubject delivery-date x-frop\u0026quot;;\ntest_config_reload :extension \u0026quot;editheader\u0026quot;;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eseems to reach an infinite loop keeping on allocating memory, leading to Denial of service by memory exhaustion.\u003c/p\u003e\n\n\u003cp\u003eTop allocations are :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e268370400 byte(s) (61%) in 12 allocation(s)\n    #0 0x1112f7f53 in wrap_malloc (libclang_rt.asan_osx_dynamic.dylib:x86_64h+0x56f53)\n    #1 0x111166f65 in mem_block_alloc (libdovecot.0.dylib:x86_64+0xa8f65)\n    #2 0x111166bb3 in t_malloc_real (libdovecot.0.dylib:x86_64+0xa8bb3)\n    #3 0x111166d9f in t_buffer_get (libdovecot.0.dylib:x86_64+0xa8d9f)\n    #4 0x1111aa1a7 in t_noalloc_strdup_vprintf (libdovecot.0.dylib:x86_64+0xec1a7)\n    #5 0x1111aa0cf in p_strdup_vprintf (libdovecot.0.dylib:x86_64+0xec0cf)\n    #6 0x10f8ccb0b in testsuite_error_handler testsuite-log.c:168\n    #7 0x11118ce77 in event_vsend (libdovecot.0.dylib:x86_64+0xcee77)\n    #8 0x11118cda1 in event_send (libdovecot.0.dylib:x86_64+0xceda1)\n    #9 0x111169938 in event_logv (libdovecot.0.dylib:x86_64+0xab938)\n    #10 0x111169a31 in e_warning (libdovecot.0.dylib:x86_64+0xaba31)\n    #11 0x110cdb4f8 in ext_editheader_config_headers ext-editheader-common.c:68\n    #12 0x110cdb064 in ext_editheader_load ext-editheader-common.c:111\n    #13 0x110c51d1f in _sieve_extension_load sieve-extensions.c:322\n    #14 0x10f8d4b91 in cmd_test_config_reload_operation_execute cmd-test-config.c:501\n    #15 0x110c2321d in sieve_interpreter_operation_execute sieve-interpreter.c:900\n    #16 0x110c22c2e in sieve_interpreter_continue sieve-interpreter.c:941\n    #17 0x110c23806 in sieve_interpreter_start sieve-interpreter.c:1013\n\n\n134168576 byte(s) (30%) in 12 allocation(s)\n    #0 0x1112f8497 in wrap_calloc (libclang_rt.asan_osx_dynamic.dylib:x86_64h+0x57497)\n    #1 0x111191071 in block_alloc (libdovecot.0.dylib:x86_64+0xd3071)\n    #2 0x1111913dd in pool_alloconly_malloc (libdovecot.0.dylib:x86_64+0xd33dd)\n    #3 0x1111aa0fb in p_strdup_vprintf (libdovecot.0.dylib:x86_64+0xec0fb)\n    #4 0x10f8ccb0b in testsuite_error_handler testsuite-log.c:168\n    #5 0x11118ce77 in event_vsend (libdovecot.0.dylib:x86_64+0xcee77)\n    #6 0x11118cda1 in event_send (libdovecot.0.dylib:x86_64+0xceda1)\n    #7 0x111169938 in event_logv (libdovecot.0.dylib:x86_64+0xab938)\n    #8 0x111169a31 in e_warning (libdovecot.0.dylib:x86_64+0xaba31)\n    #9 0x110cdb4f8 in ext_editheader_config_headers ext-editheader-common.c:68\n    #10 0x110cdb064 in ext_editheader_load ext-editheader-common.c:111\n    #11 0x110c51d1f in _sieve_extension_load sieve-extensions.c:322\n    #12 0x10f8d4b91 in cmd_test_config_reload_operation_execute cmd-test-config.c:501\n    #13 0x110c2321d in sieve_interpreter_operation_execute sieve-interpreter.c:900\n    #14 0x110c22c2e in sieve_interpreter_continue sieve-interpreter.c:941\n    #15 0x110c23806 in sieve_interpreter_start sieve-interpreter.c:1013\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eConsuming too much memory leads to denial of service of the software, and even of the whole machine if not configured properly.\u003c/p\u003e\n","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":5,"voters":["secator","prophet","b69fb2ebda43240ece9dbeb","redteamleader","entr0py_"],"severity":{"rating":"medium","score":4.0,"author_type":"User","metrics":{"attack_vector":"local","attack_complexity":"high","privileges_required":"high","user_interaction":"required","scope":"unchanged","confidentiality":"none","integrity":"none","availability":"high"}},"structured_scope":{"databaseId":42900,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/dovecot/pigeonhole","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8325025,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is an infinite loop indeed. This can only be triggered by the administrator though (configuring setting with bad value), so the security impact of this bug is very low.","markdown_message":"\u003cp\u003eThis is an infinite loop indeed. This can only be triggered by the administrator though (configuring setting with bad value), so the security impact of this bug is very low.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-17T22:30:41.296Z","updated_at":"2020-06-17T22:30:41.296Z","actor":{"username":"sbosch","cleared":false,"url":"/sbosch","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8325105,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Created a trivial fix for this issue.","markdown_message":"\u003cp\u003eCreated a trivial fix for this issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-17T22:32:28.623Z","updated_at":"2020-06-17T22:32:28.623Z","actor":{"username":"sbosch","cleared":false,"url":"/sbosch","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8366878,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-22T08:29:43.146Z","updated_at":"2020-06-22T08:29:43.146Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8366881,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-22T08:29:50.772Z","updated_at":"2020-06-22T08:29:50.772Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8523313,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We have determined this bug has no practical security impact, and thus we are closing it. Thank you for taking the time to report this bug.","markdown_message":"\u003cp\u003eWe have determined this bug has no practical security impact, and thus we are closing it. Thank you for taking the time to report this bug.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-07-07T05:49:17.694Z","updated_at":"2020-07-07T05:49:17.694Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"catenacyber","url":"/catenacyber"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8523315,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-07T05:49:30.491Z","updated_at":"2020-07-07T05:49:30.491Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"50.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"catenacyber","url":"/catenacyber"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8523743,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-07T07:06:57.192Z","updated_at":"2020-07-07T07:06:57.192Z","first_to_agree":true,"actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8523744,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-07T07:07:37.365Z","updated_at":"2020-07-07T07:07:37.365Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8523745,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-07T07:07:37.446Z","updated_at":"2020-07-07T07:07:37.446Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}