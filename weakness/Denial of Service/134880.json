{"id":134880,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzQ4ODA=","url":"https://hackerone.com/reports/134880","title":"ASN.1 BIO excessive memory allocation (CVE-2016-2109)","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-04-26T22:31:48.187Z","submitted_at":"2016-04-26T22:31:48.187Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"geeknik","url":"/geeknik","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":24,"url":"https://hackerone.com/ibb-openssl","handle":"ibb-openssl","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/024/523699736f62cf8e067320163b49e80626b1b3a3_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/024/523699736f62cf8e067320163b49e80626b1b3a3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"OpenSSL (IBB)","twitter_handle":"","website":"https://www.openssl.org","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-05-03T20:38:06.025Z","bug_reporter_agreed_on_going_public_at":"2016-05-03T20:38:05.944Z","team_member_agreed_on_going_public_at":"2016-05-03T15:59:01.938Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"On 4 April 2016 I reported a bug to the OpenSSL Security Team where I was able to force OpenSSL to use large amounts of cpu time, memory and swap space. They confirmed receipt on 6 April 2016 and on 22 April 2016 I was notified that they were assigning CVE-2016-2109 to this flaw and the fix was committed to git on 22 April 2016. \n\n```\nThe main cause is the way asn1_d2i_read_bio works: it allocates memory depending on the length field. Your test cases looks like this:\n\n30 84 30 30 30 30 30\n\nWhich translates to a SEQUENCE with a length of 0x30303030 which explains the huge memory requirements.\n\nIn some cases this is intended (for example large CMS messages) so we can't just reject these. Additionally because the input comes from a BIO we may not know the actual length of the data (e.g. from a pipe) so we can't immediately determine if there isn't enough data to read. We can however read the input in\nsmaller chunks and determine if there is an unexpected EOF. That would mean that you couldn't have a tiny file allocate huge amounts of memory. We currently have a patch being reviewed that does this: that would reject your test case instead of allocating lots of memory.\n\nIf you're calling the memory based ASN.1 decoders this shouldn't happen because they can sanity check length fields.\n```\n\nFixed in master:\nhttps://git.openssl.org/?p=openssl.git;a=commit;h=c62981390d6cf9e3d612c489b8b77c2913b25807","vulnerability_information_html":"\u003cp\u003eOn 4 April 2016 I reported a bug to the OpenSSL Security Team where I was able to force OpenSSL to use large amounts of cpu time, memory and swap space. They confirmed receipt on 6 April 2016 and on 22 April 2016 I was notified that they were assigning CVE-2016-2109 to this flaw and the fix was committed to git on 22 April 2016. \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eThe main cause is the way asn1_d2i_read_bio works: it allocates memory depending on the length field. Your test cases looks like this:\n\n30 84 30 30 30 30 30\n\nWhich translates to a SEQUENCE with a length of 0x30303030 which explains the huge memory requirements.\n\nIn some cases this is intended (for example large CMS messages) so we can\u0026#39;t just reject these. Additionally because the input comes from a BIO we may not know the actual length of the data (e.g. from a pipe) so we can\u0026#39;t immediately determine if there isn\u0026#39;t enough data to read. We can however read the input in\nsmaller chunks and determine if there is an unexpected EOF. That would mean that you couldn\u0026#39;t have a tiny file allocate huge amounts of memory. We currently have a patch being reviewed that does this: that would reject your test case instead of allocating lots of memory.\n\nIf you\u0026#39;re calling the memory based ASN.1 decoders this shouldn\u0026#39;t happen because they can sanity check length fields.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFixed in master:\u003cbr\u003e\n\u003ca title=\"https://git.openssl.org/?p=openssl.git%3Ba=commit%3Bh=c62981390d6cf9e3d612c489b8b77c2913b25807\" href=\"/redirect?url=https%3A%2F%2Fgit.openssl.org%2F%3Fp%3Dopenssl.git%253Ba%3Dcommit%253Bh%3Dc62981390d6cf9e3d612c489b8b77c2913b25807\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://git.openssl.org/?p=openssl.git%3Ba=commit%3Bh=c62981390d6cf9e3d612c489b8b77c2913b25807\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-06-02T15:59:01.992Z","allow_singular_disclosure_after":-144332810.43098354,"singular_disclosure_allowed":true,"vote_count":2,"voters":["geeknik","dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":929822,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks! Do you know if a public advisory is planned for the next release? I'd assume so given the CVE assignment. Could you please comment back here when that occurs? (We use the Severity rating to assign bounty amounts)","markdown_message":"\u003cp\u003eThanks! Do you know if a public advisory is planned for the next release? I\u0026#39;d assume so given the CVE assignment. Could you please comment back here when that occurs? (We use the Severity rating to assign bounty amounts)\u003c/p\u003e\n","automated_response":false,"created_at":"2016-04-27T06:38:45.381Z","updated_at":"2016-04-27T06:38:45.381Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-openssl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":930389,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I asked Dr Henson if the commit to git was considered public disclosure and this was his reply:\n\n\"Yes: since it's considered low severity it was fixed immediately and not held back as part of a security release. We'll be including details of that (and some other low severity issues) in the next advisory.\"","markdown_message":"\u003cp\u003eI asked Dr Henson if the commit to git was considered public disclosure and this was his reply:\u003c/p\u003e\n\n\u003cp\u003e\u0026quot;Yes: since it\u0026#39;s considered low severity it was fixed immediately and not held back as part of a security release. We\u0026#39;ll be including details of that (and some other low severity issues) in the next advisory.\u0026quot;\u003c/p\u003e\n","automated_response":false,"created_at":"2016-04-27T15:55:52.921Z","updated_at":"2016-04-27T15:55:52.921Z","actor":{"username":"geeknik","cleared":true,"url":"/geeknik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-openssl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":930665,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sounds good, thanks! Drop us a note when the advisory goes live and we'll trigger the bounty.","markdown_message":"\u003cp\u003eSounds good, thanks! Drop us a note when the advisory goes live and we\u0026#39;ll trigger the bounty.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-04-27T18:40:22.205Z","updated_at":"2016-04-27T18:40:22.205Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-openssl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":938708,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"https://www.openssl.org/news/secadv/20160503.txt","markdown_message":"\u003cp\u003e\u003ca title=\"https://www.openssl.org/news/secadv/20160503.txt\" href=\"/redirect?url=https%3A%2F%2Fwww.openssl.org%2Fnews%2Fsecadv%2F20160503.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.openssl.org/news/secadv/20160503.txt\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2016-05-03T15:48:51.244Z","updated_at":"2016-05-03T15:48:51.244Z","actor":{"username":"geeknik","cleared":true,"url":"/geeknik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-openssl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":938716,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-03T15:57:18.840Z","updated_at":"2016-05-03T15:57:18.840Z","additional_data":{"old_title":"OpenSSL CVE-2016-2109","new_title":"ASN.1 BIO excessive memory allocation (CVE-2016-2109)"},"actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-openssl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":938720,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-03T15:58:48.786Z","updated_at":"2016-05-03T15:58:48.786Z","actor":{"url":"/ibb-openssl","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/024/523699736f62cf8e067320163b49e80626b1b3a3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"OpenSSL (IBB)"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"ibb-openssl","collaborator":{"username":"geeknik","url":"/geeknik"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":938721,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-03T15:58:56.892Z","updated_at":"2016-05-03T15:58:56.892Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"geeknik","url":"/geeknik"},"genius_execution_id":null,"team_handle":"ibb-openssl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":938723,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-03T15:59:01.959Z","updated_at":"2016-05-03T15:59:01.959Z","first_to_agree":true,"actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-openssl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":939172,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-03T20:38:05.976Z","updated_at":"2016-05-03T20:38:05.976Z","actor":{"username":"geeknik","cleared":true,"url":"/geeknik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-openssl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":939173,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-03T20:38:06.046Z","updated_at":"2016-05-03T20:38:06.046Z","actor":{"username":"geeknik","cleared":true,"url":"/geeknik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-openssl","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":1842,"category":"team","content":"Severity: Low\n\nWhen ASN.1 data is read from a BIO using functions such as d2i_CMS_bio() a short invalid encoding can casuse allocation of large amounts of memory potentially consuming excessive resources or exhausting memory.\n\nAny application parsing untrusted data through d2i BIO functions is affected. The memory based functions such as d2i_X509() are *not* affected. Since the memory based functions are used by the TLS library, TLS applications are not affected.\n\nOpenSSL 1.0.2 users should upgrade to 1.0.2h\nOpenSSL 1.0.1 users should upgrade to 1.0.1t\n\nThis issue was reported to OpenSSL on 4th April 2016 by Brian Carpenter.\nThe fix was developed by Stephen Henson of the OpenSSL development team.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eSeverity: Low\u003c/p\u003e\n\n\u003cp\u003eWhen ASN.1 data is read from a BIO using functions such as d2i_CMS_bio() a short invalid encoding can casuse allocation of large amounts of memory potentially consuming excessive resources or exhausting memory.\u003c/p\u003e\n\n\u003cp\u003eAny application parsing untrusted data through d2i BIO functions is affected. The memory based functions such as d2i_X509() are \u003cem\u003enot\u003c/em\u003e affected. Since the memory based functions are used by the TLS library, TLS applications are not affected.\u003c/p\u003e\n\n\u003cp\u003eOpenSSL 1.0.2 users should upgrade to 1.0.2h\u003cbr\u003e\nOpenSSL 1.0.1 users should upgrade to 1.0.1t\u003c/p\u003e\n\n\u003cp\u003eThis issue was reported to OpenSSL on 4th April 2016 by Brian Carpenter.\u003cbr\u003e\nThe fix was developed by Stephen Henson of the OpenSSL development team.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}