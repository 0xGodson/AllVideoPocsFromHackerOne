{"id":890793,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84OTA3OTM=","url":"https://hackerone.com/reports/890793","title":"Panic: Input stream data unexpectedly has references","state":"Closed","substate":"resolved","severity_rating":"none","readable_substate":"Resolved","created_at":"2020-06-04T13:16:03.446Z","submitted_at":"2020-06-04T13:16:03.446Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"catenacyber","url":"/catenacyber","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-06-22T09:18:11.513Z","bug_reporter_agreed_on_going_public_at":"2020-06-22T09:18:11.474Z","team_member_agreed_on_going_public_at":"2020-06-22T08:32:19.452Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Run test suite binary on following input\n```\n./testsuite crash.txt\n```\nwith crash.txt file being :\n```\nrequire \"vnd.dovecot.testsuite\";\nrequire \"variables\";\n\nrequire \"editheader\";\n\nset \"message\" text:\nFrom: stephan@example.com\nTo: timo@example.com\nSubject: Frop!\n\nFrop!\n\n.\n;\n\n\ntest_set \"message\" \"${message}\";\ntest \"Alternating - add; delete\" {\n\taddheader \"X-Some-Header\" \"Header content\";\n}\n\ntest_result_reset;\n\ntest_set \"message\" \"${message}\";\n```\n\nThe output is the following :\n```\nTest case: crash.txt:\n\n 1: Test 'Alternating - add; delete' SUCCEEDED\ntestsuite(catena): Panic: Input stream data unexpectedly has references\nAbort trap: 6\n```\n\nThe stack trace is :\n```\n==49249== ERROR: libFuzzer: deadly signal\n    #0 0x10a9c90e7 in __sanitizer_print_stack_trace (libclang_rt.asan_osx_dynamic.dylib:x86_64h+0x600e7)\n    #1 0x108fb8cd6 in fuzzer::Fuzzer::CrashCallback() FuzzerLoop.cpp:233\n    #2 0x108fb8c93 in fuzzer::Fuzzer::StaticCrashSignalCallback() FuzzerLoop.cpp:206\n    #3 0x7fff7a245f59 in _sigtramp (libsystem_platform.dylib:x86_64+0x1f59)\n    #4 0x7ffee6c6fba7  (\u003cunknown module\u003e)\n    #5 0x7fff79fe31ad in abort (libsystem_c.dylib:x86_64+0x5d1ad)\n    #6 0x10a838e45 in default_fatal_finish failures.c:459\n    #7 0x10a83764c in fatal_handler_real failures.c:471\n    #8 0x10a837610 in default_fatal_handler failures.c:479\n    #9 0x10a83784f in i_panic failures.c:523\n    #10 0x10a6a220f in index_mail_close_streams_full index-mail.c:1698\n    #11 0x10a6a22b9 in index_mail_close index-mail.c:1777\n    #12 0x10a6a3002 in index_mail_free index-mail.c:2127\n    #13 0x10a61a347 in mail_free mail.c:44\n    #14 0x10a3c1857 in mail_raw_close mail-raw.c:240\n    #15 0x108faad8f in sieve_tool_open_data_as_mail sieve-tool.c:403\n    #16 0x108f947a5 in testsuite_message_set_string testsuite-message.c:140\n    #17 0x108f91911 in tsto_message_set_member testsuite-objects.c:315\n    #18 0x108f9ea50 in cmd_test_set_operation_execute cmd-test-set.c:156\n    #19 0x10a2ee37d in sieve_interpreter_operation_execute sieve-interpreter.c:860\n    #20 0x10a2edd8e in sieve_interpreter_continue sieve-interpreter.c:901\n    #21 0x10a2ee966 in sieve_interpreter_start sieve-interpreter.c:973\n    #22 0x10a2eeb49 in sieve_interpreter_run sieve-interpreter.c:984\n```\n\n## Impact\n\nI am not sure of the impact, as this may be a bug in the test framework\nBut there may be a logic bug leading to this...","vulnerability_information_html":"\u003cp\u003eRun test suite binary on following input\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e./testsuite crash.txt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewith crash.txt file being :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003erequire \u0026quot;vnd.dovecot.testsuite\u0026quot;;\nrequire \u0026quot;variables\u0026quot;;\n\nrequire \u0026quot;editheader\u0026quot;;\n\nset \u0026quot;message\u0026quot; text:\nFrom: stephan@example.com\nTo: timo@example.com\nSubject: Frop!\n\nFrop!\n\n.\n;\n\n\ntest_set \u0026quot;message\u0026quot; \u0026quot;${message}\u0026quot;;\ntest \u0026quot;Alternating - add; delete\u0026quot; {\n    addheader \u0026quot;X-Some-Header\u0026quot; \u0026quot;Header content\u0026quot;;\n}\n\ntest_result_reset;\n\ntest_set \u0026quot;message\u0026quot; \u0026quot;${message}\u0026quot;;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe output is the following :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eTest case: crash.txt:\n\n 1: Test \u0026#39;Alternating - add; delete\u0026#39; SUCCEEDED\ntestsuite(catena): Panic: Input stream data unexpectedly has references\nAbort trap: 6\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe stack trace is :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e==49249== ERROR: libFuzzer: deadly signal\n    #0 0x10a9c90e7 in __sanitizer_print_stack_trace (libclang_rt.asan_osx_dynamic.dylib:x86_64h+0x600e7)\n    #1 0x108fb8cd6 in fuzzer::Fuzzer::CrashCallback() FuzzerLoop.cpp:233\n    #2 0x108fb8c93 in fuzzer::Fuzzer::StaticCrashSignalCallback() FuzzerLoop.cpp:206\n    #3 0x7fff7a245f59 in _sigtramp (libsystem_platform.dylib:x86_64+0x1f59)\n    #4 0x7ffee6c6fba7  (\u0026lt;unknown module\u0026gt;)\n    #5 0x7fff79fe31ad in abort (libsystem_c.dylib:x86_64+0x5d1ad)\n    #6 0x10a838e45 in default_fatal_finish failures.c:459\n    #7 0x10a83764c in fatal_handler_real failures.c:471\n    #8 0x10a837610 in default_fatal_handler failures.c:479\n    #9 0x10a83784f in i_panic failures.c:523\n    #10 0x10a6a220f in index_mail_close_streams_full index-mail.c:1698\n    #11 0x10a6a22b9 in index_mail_close index-mail.c:1777\n    #12 0x10a6a3002 in index_mail_free index-mail.c:2127\n    #13 0x10a61a347 in mail_free mail.c:44\n    #14 0x10a3c1857 in mail_raw_close mail-raw.c:240\n    #15 0x108faad8f in sieve_tool_open_data_as_mail sieve-tool.c:403\n    #16 0x108f947a5 in testsuite_message_set_string testsuite-message.c:140\n    #17 0x108f91911 in tsto_message_set_member testsuite-objects.c:315\n    #18 0x108f9ea50 in cmd_test_set_operation_execute cmd-test-set.c:156\n    #19 0x10a2ee37d in sieve_interpreter_operation_execute sieve-interpreter.c:860\n    #20 0x10a2edd8e in sieve_interpreter_continue sieve-interpreter.c:901\n    #21 0x10a2ee966 in sieve_interpreter_start sieve-interpreter.c:973\n    #22 0x10a2eeb49 in sieve_interpreter_run sieve-interpreter.c:984\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eI am not sure of the impact, as this may be a bug in the test framework\u003cbr\u003e\nBut there may be a logic bug leading to this...\u003c/p\u003e\n","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":21,"voters":["a_d_a_m","brahim_boufakri01","mygf","b69fb2ebda43240ece9dbeb","cyb3r_l3arn3r","gflores","deepak26v","hitmansmi45","hacker25256","g_007","and 11 more..."],"severity":{"rating":"none","author_type":"Team"},"structured_scope":{"databaseId":42900,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/dovecot/pigeonhole","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8201385,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"A simplified version of crash.txt:\n\n```\nrequire \"vnd.dovecot.testsuite\";\nrequire \"variables\";\nrequire \"editheader\";\n\nset \"message\" \".\";\naddheader \"X-Some-Header\" \"Header content\";\ntest_result_reset;\ntest_set \"message\" \"${message}\";\n```\n\nTo me it looks like test_result_reset doesn't correctly unreference the original message, so likely a testsuite bug. But still have to verify. But even if the attacker was able to create a Sieve script that causes this panic, I don't think it's a security bug. The attacker could only cause their own mails to become discarded.","markdown_message":"\u003cp\u003eA simplified version of crash.txt:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003erequire \u0026quot;vnd.dovecot.testsuite\u0026quot;;\nrequire \u0026quot;variables\u0026quot;;\nrequire \u0026quot;editheader\u0026quot;;\n\nset \u0026quot;message\u0026quot; \u0026quot;.\u0026quot;;\naddheader \u0026quot;X-Some-Header\u0026quot; \u0026quot;Header content\u0026quot;;\ntest_result_reset;\ntest_set \u0026quot;message\u0026quot; \u0026quot;${message}\u0026quot;;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo me it looks like test_result_reset doesn\u0026#39;t correctly unreference the original message, so likely a testsuite bug. But still have to verify. But even if the attacker was able to create a Sieve script that causes this panic, I don\u0026#39;t think it\u0026#39;s a security bug. The attacker could only cause their own mails to become discarded.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-04T14:30:54.039Z","updated_at":"2020-06-04T14:30:54.039Z","actor":{"username":"tss","cleared":false,"url":"/tss","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8201594,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"With some further checking it looks like the addheader command opens the message and references it. test_set \"message\" then attempts to close+recreate the mail while the edit-mail stream still has a reference. I'm not sure why test_result_reset is needed in the middle. This test_set can't be called by regular Sieve scripts, so it's a testsuite bug only.\n","markdown_message":"\u003cp\u003eWith some further checking it looks like the addheader command opens the message and references it. test_set \u0026quot;message\u0026quot; then attempts to close+recreate the mail while the edit-mail stream still has a reference. I\u0026#39;m not sure why test_result_reset is needed in the middle. This test_set can\u0026#39;t be called by regular Sieve scripts, so it\u0026#39;s a testsuite bug only.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-04T14:52:16.400Z","updated_at":"2020-06-04T14:53:00.837Z","actor":{"username":"tss","cleared":false,"url":"/tss","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8202514,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the analysis. Do you need more information ?\n","markdown_message":"\u003cp\u003eThanks for the analysis. Do you need more information ?\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-04T15:34:05.036Z","updated_at":"2020-06-04T15:34:05.036Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8240814,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, no need for more information. We have a fix pending for this. It's a testsuite-only issue.","markdown_message":"\u003cp\u003eThanks, no need for more information. We have a fix pending for this. It\u0026#39;s a testsuite-only issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-09T09:30:30.685Z","updated_at":"2020-06-09T09:30:30.685Z","actor":{"username":"tss","cleared":false,"url":"/tss","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8240816,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-09T09:30:38.617Z","updated_at":"2020-06-09T09:30:38.617Z","actor":{"username":"tss","cleared":false,"url":"/tss","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8366851,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-22T08:27:57.420Z","updated_at":"2020-06-22T08:27:57.420Z","additional_data":{"old_severity":"Low","new_severity":"None","old_severity_id":740661,"new_severity_id":756926},"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8366857,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Not really a security bug as it affects the test suite only.","markdown_message":"\u003cp\u003eNot really a security bug as it affects the test suite only.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-22T08:28:12.771Z","updated_at":"2020-06-22T08:28:12.771Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"catenacyber","url":"/catenacyber"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8366862,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-22T08:28:24.463Z","updated_at":"2020-06-22T08:28:24.463Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"50.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"catenacyber","url":"/catenacyber"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8366913,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-22T08:32:19.470Z","updated_at":"2020-06-22T08:32:19.470Z","first_to_agree":true,"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8368023,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-22T09:18:11.491Z","updated_at":"2020-06-22T09:18:11.491Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8368024,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-22T09:18:11.538Z","updated_at":"2020-06-22T09:18:11.538Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}