{"id":181685,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODE2ODU=","url":"https://hackerone.com/reports/181685","title":"Range#initialize_copy null pointer dereference","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-11-12T01:19:47.017Z","submitted_at":"2016-11-12T01:19:47.017Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"charliesome","url":"/charliesome","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/738/78470971e95623d272226b011823c8590ffe6cf3_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-17T01:03:44.537Z","bug_reporter_agreed_on_going_public_at":"2016-12-17T01:03:44.485Z","team_member_agreed_on_going_public_at":"2016-12-16T19:47:51.689Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Heya!\n\nIt's possible to segfault mruby through mruby-engine with the following snippet of code:\n\n    Range.remove_method(:initialize_copy)\n    (1..2).dup.to_s\n\nThis can be triggered through mruby-engine like this:\n\n    MRubyEngine.new(512*1024, 1000, 1000).sandbox_eval(\"/tmp\", %{\n      Range.remove_method(:initialize_copy)\n      (1..2).dup.to_s\n    })\n\nThe `dup` and `clone` methods allocate a new object and then call `initialize_copy` on the new object with the old object as an argument to copy over internal state.\n\nRemoving `Range#initialize_copy` makes it possible to construct an uninitialized `Range` object. Calling (pretty much) any instance method on the uninitialized `Range` object afterwards causes mruby to dereference a null pointer, leading to a segfault.\n\nI've attached a patch that fixes the bug by copying internal range state before calling `initialize_copy`, similar to what mruby already does for classes and modules.","vulnerability_information_html":"\u003cp\u003eHeya!\u003c/p\u003e\n\n\u003cp\u003eIt\u0026#39;s possible to segfault mruby through mruby-engine with the following snippet of code:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eRange.remove_method(:initialize_copy)\n(1..2).dup.to_s\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis can be triggered through mruby-engine like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eMRubyEngine.new(512*1024, 1000, 1000).sandbox_eval(\u0026quot;/tmp\u0026quot;, %{\n  Range.remove_method(:initialize_copy)\n  (1..2).dup.to_s\n})\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003edup\u003c/code\u003e and \u003ccode\u003eclone\u003c/code\u003e methods allocate a new object and then call \u003ccode\u003einitialize_copy\u003c/code\u003e on the new object with the old object as an argument to copy over internal state.\u003c/p\u003e\n\n\u003cp\u003eRemoving \u003ccode\u003eRange#initialize_copy\u003c/code\u003e makes it possible to construct an uninitialized \u003ccode\u003eRange\u003c/code\u003e object. Calling (pretty much) any instance method on the uninitialized \u003ccode\u003eRange\u003c/code\u003e object afterwards causes mruby to dereference a null pointer, leading to a segfault.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve attached a patch that fixes the bug by copying internal range state before calling \u003ccode\u003einitialize_copy\u003c/code\u003e, similar to what mruby already does for classes and modules.\u003c/p\u003e\n","bounty_amount":"10000.0","formatted_bounty":"$10,000","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":134226,"file_name":"range-initialize-copy-segfault.patch","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/134/226/c17732014bbc23d135074255a49138104c07766b/range-initialize-copy-segfault.patch?response-content-disposition=attachment%3B%20filename%3D%22range-initialize-copy-segfault.patch%22%3B%20filename%2A%3DUTF-8%27%27range-initialize-copy-segfault.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSC5UFWXL%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044535Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCwK%2B%2BlMufFx2twThN55FpWvSNFMRcTw6DIMXMwu3SRJgIgbfhKiC5W8N8YFQB0Nj1%2Boe6pAlr8Ti%2FvGEEHHH13JNkqtAMIUxABGgwwMTM2MTkyNzQ4NDkiDKRKppBQcflzJsWylyqRAzVMKZ6jWFrSD2Y9kWok2waN0zNoEyuNoms1kUC37gd2cWniMYOCGZa9pHJ%2BTGOcJDE8mr7X3wJV03PeWNx%2FJ3x1t1adSeplF3kKkxVzwMpsJiOYMPMNaXbK6aN%2FVxaTTjwIHJMTw7ej%2BNad1lrBkNYM8xmTFPzJdlIn3krUMQVcm66POZCl3IpgIriUdvRQsdjWZjnf%2FUXejEcDwlys5fmmpAap4FXWkuE4xPD5JITrqd71Zc4guVr49IYqaJ9P8ZOa39l8Cm9yOfvHOdc%2FHHkeb3dhc64lVpxLQxnIzdRkUBVcVDfLrNaCOxpa9K0SDMt9HK%2B6%2F6SozxEKFb7iD2%2BQkM42Rwtm3vBMeKEUDeFG3yO5gW6KJtirosz7Y3m8DdEylt%2F8air6KKuH0wjD%2B9LfO7%2FWKZCn3h7tRVYtr71OXTcV4jMC7Q6El1VpYoy1%2FUyJLt0VlyMhH1u00hOd2Ed613mjv9Lq0b8iTU4W3vlCcM%2FtjGgBfI2lPMbp3cacOsLTQtiqUw%2FMXKZM7aikuuh%2BML6aqv8FOusBAaUZsZRvtcfsxqJAwQO39V21wLoeubOAIV%2BtvLyfXzwltZABeAGkBPYy8xl5ryQb8Y%2BKG%2FfwUfCGsCxtOppNqsZCDg0JzwPVO8CdiGO1QqRKJpkb23agNpWEIAa8FY4BpDjQUZHUIl4jWVfFWH2sizzpICjQxnSI3JQpi2%2B9GAdI3gAmweVyhKgicRGn9QyAfoRtqO3YWntGA8EeCXAhyWW%2BxebF5JNSGoYhvM72O00zG1YKAYz%2F6ymrbrJmLpZ0WbBqG4d2%2BRi9F0TVfiKq0rdWihYUV%2FstwlGLcPIVuYIDnBH4oA5HYk7pFw%3D%3D\u0026X-Amz-Signature=39a9edc4f2a6c93d5e90a26c08747244988a0af8eb13d19f1ff52887f89dafe7","file_size":3563,"type":"text/x-diff"}],"allow_singular_disclosure_at":"2017-01-15T19:47:51.751Z","allow_singular_disclosure_after":-124707463.96052018,"singular_disclosure_allowed":true,"vote_count":7,"voters":["mpz","eveeez","spetr0x","scept1c","elakrimi","no-longer-with-company","pr0x_r00t3r"],"severity":{"rating":"high","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1299270,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-14T21:26:24.806Z","updated_at":"2016-11-14T21:26:24.806Z","additional_data":{"old_severity":null,"new_severity":"High","old_severity_id":null,"new_severity_id":7538},"actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1299273,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report! We've reproduced the issue, and our engineering team is working on a fix.","markdown_message":"\u003cp\u003eThank you for your report! We\u0026#39;ve reproduced the issue, and our engineering team is working on a fix.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-14T21:27:07.817Z","updated_at":"2016-11-14T21:27:07.817Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1307401,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for the report and patch! We've deployed a fix for this in our production environment as of earlier today.\n\nAs I've mentioned on your other issues, I'm marking this issue as resolved now but we still need to fix this bug upstream before we can assess the impact \u0026 determine a final bounty amount. This may take a few weeks since we received a large number of valid issues and we want to calibrate our payouts across all of them.","markdown_message":"\u003cp\u003eThanks for the report and patch! We\u0026#39;ve deployed a fix for this in our production environment as of earlier today.\u003c/p\u003e\n\n\u003cp\u003eAs I\u0026#39;ve mentioned on your other issues, I\u0026#39;m marking this issue as resolved now but we still need to fix this bug upstream before we can assess the impact \u0026amp; determine a final bounty amount. This may take a few weeks since we received a large number of valid issues and we want to calibrate our payouts across all of them.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-18T20:39:50.305Z","updated_at":"2016-11-18T20:39:50.305Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"charliesome","url":"/charliesome"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370009,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify Scripts and the mruby project!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify Scripts and the mruby project!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-16T19:47:46.297Z","updated_at":"2016-12-16T19:47:46.297Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"10000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"charliesome","url":"/charliesome"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370010,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T19:47:51.704Z","updated_at":"2016-12-16T19:47:51.704Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370649,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-17T01:03:44.506Z","updated_at":"2016-12-17T01:03:44.506Z","actor":{"username":"charliesome","cleared":false,"url":"/charliesome","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/738/78470971e95623d272226b011823c8590ffe6cf3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1370650,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-17T01:03:44.555Z","updated_at":"2016-12-17T01:03:44.555Z","actor":{"username":"charliesome","cleared":false,"url":"/charliesome","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/738/78470971e95623d272226b011823c8590ffe6cf3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}