{"id":332632,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMzI2MzI=","url":"https://hackerone.com/reports/332632","title":"(Possible) staff account takeover via reset token bruteforce at helpdesk.bistudio.com","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2018-04-03T15:53:55.674Z","submitted_at":"2018-04-03T15:53:55.674Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"europa","url":"/europa","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":18362,"url":"https://hackerone.com/bohemia","handle":"bohemia","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/018/362/cdc81f05eed3c29e276521da9dff6e209f949352_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/018/362/cdc81f05eed3c29e276521da9dff6e209f949352_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"BOHEMIA INTERACTIVE a.s.","twitter_handle":"bohemiainteract","website":"http://www.bohemia.net","about":"Independent developer of video games @arma3official @DayZ @takeonthegame @ylandsgame"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-09-19T14:42:15.945Z","bug_reporter_agreed_on_going_public_at":"2018-09-18T14:39:11.939Z","team_member_agreed_on_going_public_at":"2018-09-19T14:42:15.803Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"As stated in a brief exchange with @rvn in my other report ##312433, I might have found a logic flaw in the way https://helpdesk.bistudio.com handles the reset flow and tokens.\nI've asked if it was possible to obtain a test account, but I fully understand that it's something that cannot be done; as such I'll submit a \"blind\" report based on my black-box analysis and wait for your team to verify it. Also note that this flaw seems to also be present in the \"Set out of office email response\" flow, albeit less critical.\n\n### Flow\nThe **SYSTEM PASSWORD RESET** flow is a 3-steps process:\n\n1. the staff member requests a SMS TOKEN using the first form\n2. the 6-digits SMS TOKEN is used in the second form\n3. the staff member can now set a new SYSTEM PASSWORD in the third form\n\n### Analysis and logic\nI was able to go through the process even after providing non-existing usernames and tokens by intercepting the **response** in BurpSuite and changing the status code from **400 Bad Request** to **200 OK** and the body from `\"status\":\"error\"` to `\"status\":\"ok\"`, allowing the AngularJS applet to follow through.\nI then noticed that the API endpoint for verifying the SMS TOKEN and changing the password where open and free of rate-limiting measures, allowing for a quick bruteforce of the 000000-999999 space. \nIt should be therefore possible to perform an account takeover on any staff member, provided the SMS TOKEN really is a 6-digits code\n\n### Theoretical POC\n1. adversary starts the SYSTEM PASSWORD RESET process for the target victim using a POST request to `/api/system/verification-codes` (ie: `{\"username\":\"admin\"}`). The backend generates a SMS TOKEN and sends it to the victim's phone. Meanwhile,\n2. adversary obtains the **securityCode** value for the victim by bruteforcing `/api/system/verification-codes/[0-9]{6}` before the victim can cancel the flow (threat scenario places the attack durin night time)\n3. adversary can now reset the SYSTEM PASSWORD by sending the complete POST request to `/api/system/email-account/password` (ie: `{\"password\":\"\u003cNEW PASSWORD\u003e\",\"code\":\"\u003cBRUTEFORCED SMS TOKEN\u003e\",\"securityCode\":\"\u003cRETRIEVED SECURITY CODE\u003e\"}`)\n\nStep #1 offers a ReCAPTCHA anti-CSRF token but it's not used anywhere in the flow, making the attack possible\n\nStep #2 is really a matter of resources. Being free of rate-limiting, the API endpoint will be quickly queried for all the possible token combinations in a matter of minutes using a multithreaded approach (ie: using BurpSuite's Intruder).\n\nAlbeit theoretical, the logic behind the threat scenario seems plausible. It might be worth investigating.\n\n### Recommended actions\nProperly implement the ReCAPTCHA and a strict ratelimiting on the API endpoints\n\n## Impact\n\nAn adversary might be able to takeover staff accounts, or set their \"out of office\" email replies.","vulnerability_information_html":"\u003cp\u003eAs stated in a brief exchange with \u003ca href=\"/rvn\"\u003e@rvn\u003c/a\u003e in my other report ##312433, I might have found a logic flaw in the way \u003ca title=\"https://helpdesk.bistudio.com\" href=\"/redirect?url=https%3A%2F%2Fhelpdesk.bistudio.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://helpdesk.bistudio.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e handles the reset flow and tokens.\u003cbr\u003e\nI\u0026#39;ve asked if it was possible to obtain a test account, but I fully understand that it\u0026#39;s something that cannot be done; as such I\u0026#39;ll submit a \u0026quot;blind\u0026quot; report based on my black-box analysis and wait for your team to verify it. Also note that this flaw seems to also be present in the \u0026quot;Set out of office email response\u0026quot; flow, albeit less critical.\u003c/p\u003e\n\n\u003ch3 id=\"flow\"\u003eFlow\u003c/h3\u003e\n\n\u003cp\u003eThe \u003cstrong\u003eSYSTEM PASSWORD RESET\u003c/strong\u003e flow is a 3-steps process:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003ethe staff member requests a SMS TOKEN using the first form\u003c/li\u003e\n\u003cli\u003ethe 6-digits SMS TOKEN is used in the second form\u003c/li\u003e\n\u003cli\u003ethe staff member can now set a new SYSTEM PASSWORD in the third form\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3 id=\"analysis-and-logic\"\u003eAnalysis and logic\u003c/h3\u003e\n\n\u003cp\u003eI was able to go through the process even after providing non-existing usernames and tokens by intercepting the \u003cstrong\u003eresponse\u003c/strong\u003e in BurpSuite and changing the status code from \u003cstrong\u003e400 Bad Request\u003c/strong\u003e to \u003cstrong\u003e200 OK\u003c/strong\u003e and the body from \u003ccode\u003e\u0026quot;status\u0026quot;:\u0026quot;error\u0026quot;\u003c/code\u003e to \u003ccode\u003e\u0026quot;status\u0026quot;:\u0026quot;ok\u0026quot;\u003c/code\u003e, allowing the AngularJS applet to follow through.\u003cbr\u003e\nI then noticed that the API endpoint for verifying the SMS TOKEN and changing the password where open and free of rate-limiting measures, allowing for a quick bruteforce of the 000000-999999 space. \u003cbr\u003e\nIt should be therefore possible to perform an account takeover on any staff member, provided the SMS TOKEN really is a 6-digits code\u003c/p\u003e\n\n\u003ch3 id=\"theoretical-poc\"\u003eTheoretical POC\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003eadversary starts the SYSTEM PASSWORD RESET process for the target victim using a POST request to \u003ccode\u003e/api/system/verification-codes\u003c/code\u003e (ie: \u003ccode\u003e{\u0026quot;username\u0026quot;:\u0026quot;admin\u0026quot;}\u003c/code\u003e). The backend generates a SMS TOKEN and sends it to the victim\u0026#39;s phone. Meanwhile,\u003c/li\u003e\n\u003cli\u003eadversary obtains the \u003cstrong\u003esecurityCode\u003c/strong\u003e value for the victim by bruteforcing \u003ccode\u003e/api/system/verification-codes/[0-9]{6}\u003c/code\u003e before the victim can cancel the flow (threat scenario places the attack durin night time)\u003c/li\u003e\n\u003cli\u003eadversary can now reset the SYSTEM PASSWORD by sending the complete POST request to \u003ccode\u003e/api/system/email-account/password\u003c/code\u003e (ie: \u003ccode\u003e{\u0026quot;password\u0026quot;:\u0026quot;\u0026lt;NEW PASSWORD\u0026gt;\u0026quot;,\u0026quot;code\u0026quot;:\u0026quot;\u0026lt;BRUTEFORCED SMS TOKEN\u0026gt;\u0026quot;,\u0026quot;securityCode\u0026quot;:\u0026quot;\u0026lt;RETRIEVED SECURITY CODE\u0026gt;\u0026quot;}\u003c/code\u003e)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eStep #1 offers a ReCAPTCHA anti-CSRF token but it\u0026#39;s not used anywhere in the flow, making the attack possible\u003c/p\u003e\n\n\u003cp\u003eStep #2 is really a matter of resources. Being free of rate-limiting, the API endpoint will be quickly queried for all the possible token combinations in a matter of minutes using a multithreaded approach (ie: using BurpSuite\u0026#39;s Intruder).\u003c/p\u003e\n\n\u003cp\u003eAlbeit theoretical, the logic behind the threat scenario seems plausible. It might be worth investigating.\u003c/p\u003e\n\n\u003ch3 id=\"recommended-actions\"\u003eRecommended actions\u003c/h3\u003e\n\n\u003cp\u003eProperly implement the ReCAPTCHA and a strict ratelimiting on the API endpoints\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAn adversary might be able to takeover staff accounts, or set their \u0026quot;out of office\u0026quot; email replies.\u003c/p\u003e\n","bounty_amount":"200.0","formatted_bounty":"$200","weakness":{"id":92,"name":"Weak Password Recovery Mechanism for Forgotten Password"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-10-18T14:39:12.047Z","allow_singular_disclosure_after":-69346693.74090584,"singular_disclosure_allowed":true,"vote_count":23,"voters":["kapytein","europa","spam404","mik317","sameerphad72","emitrani","mygf","eveeez","malcolmx","apapedulimu","and 13 more..."],"severity":{"rating":"critical","author_type":"Team"},"structured_scope":{"databaseId":5853,"asset_type":"OTHER","asset_identifier":"Domain listed in the policy scope","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2563727,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the report, we will check it out.","markdown_message":"\u003cp\u003eThanks for the report, we will check it out.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-04T08:19:14.783Z","updated_at":"2018-04-04T08:19:14.783Z","actor":{"username":"rvn","cleared":false,"url":"/rvn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/144/104/9f11d937232d6a42214b3bd66b367e56840de689_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2564763,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"This has been confirmed as a legitimate issue.","markdown_message":"\u003cp\u003eThis has been confirmed as a legitimate issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-04T14:07:38.674Z","updated_at":"2018-04-04T14:07:38.674Z","actor":{"username":"rvn","cleared":false,"url":"/rvn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/144/104/9f11d937232d6a42214b3bd66b367e56840de689_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2564813,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Bounty awarded. Thanks!","markdown_message":"\u003cp\u003eBounty awarded. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-04T14:29:22.111Z","updated_at":"2018-04-04T14:29:22.111Z","actor":{"url":"/bohemia","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/018/362/cdc81f05eed3c29e276521da9dff6e209f949352_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"BOHEMIA INTERACTIVE a.s."}},"bounty_amount":"200.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"bohemia","collaborator":{"username":"europa","url":"/europa"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2564833,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Glad I was able to blindly help!\nThanks for the reward, I remain available for further testing\nCheers!","markdown_message":"\u003cp\u003eGlad I was able to blindly help!\u003cbr\u003e\nThanks for the reward, I remain available for further testing\u003cbr\u003e\nCheers!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-04T14:37:53.810Z","updated_at":"2018-04-04T14:37:53.810Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2567067,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This should be fixed now. Thanks again!","markdown_message":"\u003cp\u003eThis should be fixed now. Thanks again!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-05T08:04:24.809Z","updated_at":"2018-04-05T08:04:24.809Z","actor":{"username":"rvn","cleared":false,"url":"/rvn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/144/104/9f11d937232d6a42214b3bd66b367e56840de689_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"europa","url":"/europa"},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2567641,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"First of all, thank you again for the highest reward!\n\nI just tested and it's still \"working\":\n* the ReCAPTCHA value isn't  checked in the flow, the X-XSRF-TOKEN header can be omitted and the flow will still go through\n* the `/api/system/email-account/password` API endpoint isn't rate-limited, allowing me to send as many requests as I want (I tried with 1,000)\nHas the fix been deployed in production already?","markdown_message":"\u003cp\u003eFirst of all, thank you again for the highest reward!\u003c/p\u003e\n\n\u003cp\u003eI just tested and it\u0026#39;s still \u0026quot;working\u0026quot;:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ethe ReCAPTCHA value isn\u0026#39;t  checked in the flow, the X-XSRF-TOKEN header can be omitted and the flow will still go through\u003c/li\u003e\n\u003cli\u003ethe \u003ccode\u003e/api/system/email-account/password\u003c/code\u003e API endpoint isn\u0026#39;t rate-limited, allowing me to send as many requests as I want (I tried with 1,000)\nHas the fix been deployed in production already?\u003c/li\u003e\n\u003c/ul\u003e\n","automated_response":false,"created_at":"2018-04-05T08:43:51.806Z","updated_at":"2018-04-05T08:43:51.806Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2568568,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Captcha isn't that necessary anymore as now you have a fix amount of tries before the account gets locked. Sending further requests is possible but will not have any effect. There is a side issue related to this that is being fixed right now but overall it should be resolved","markdown_message":"\u003cp\u003eCaptcha isn\u0026#39;t that necessary anymore as now you have a fix amount of tries before the account gets locked. Sending further requests is possible but will not have any effect. There is a side issue related to this that is being fixed right now but overall it should be resolved\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-05T10:46:37.563Z","updated_at":"2018-04-05T10:46:37.563Z","actor":{"username":"rvn","cleared":false,"url":"/rvn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/144/104/9f11d937232d6a42214b3bd66b367e56840de689_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2568593,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Alrighty, should be good as long as it's not used to purposely lock staff accounts. Cheers!","markdown_message":"\u003cp\u003eAlrighty, should be good as long as it\u0026#39;s not used to purposely lock staff accounts. Cheers!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-05T10:55:16.706Z","updated_at":"2018-04-05T10:55:16.706Z","actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3353850,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"If you guys are okay with this one, I believe it could be disclosed as it highlights the honesty of the team and why hackers should work on your program regardless of its bounty table.\nNeedless to say, it is also why I sticked around. Great job!","markdown_message":"\u003cp\u003eIf you guys are okay with this one, I believe it could be disclosed as it highlights the honesty of the team and why hackers should work on your program regardless of its bounty table.\u003cbr\u003e\nNeedless to say, it is also why I sticked around. Great job!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-18T14:39:11.985Z","updated_at":"2018-09-18T14:39:11.985Z","first_to_agree":true,"actor":{"username":"europa","cleared":true,"url":"/europa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yLAfkbEdjS5TTkov1RViumZ4/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3358692,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Disclosed per reporter's request.","markdown_message":"\u003cp\u003eDisclosed per reporter\u0026#39;s request.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-19T14:42:15.848Z","updated_at":"2018-09-19T14:42:15.848Z","actor":{"username":"freespirit","cleared":false,"url":"/freespirit","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3358693,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-19T14:42:16.012Z","updated_at":"2018-09-19T14:42:16.012Z","actor":{"username":"freespirit","cleared":false,"url":"/freespirit","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3358700,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-19T14:43:51.778Z","updated_at":"2018-09-19T14:43:51.778Z","additional_data":{"old_severity":"High","new_severity":"Critical","old_severity_id":135018,"new_severity_id":211914},"actor":{"username":"rvn","cleared":false,"url":"/rvn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/144/104/9f11d937232d6a42214b3bd66b367e56840de689_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"bohemia","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}