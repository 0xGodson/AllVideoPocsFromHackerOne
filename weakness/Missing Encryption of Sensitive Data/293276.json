{"id":293276,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yOTMyNzY=","url":"https://hackerone.com/reports/293276","title":"Cloudflare does not sufficiently truncate credit card numbers in invoices","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2017-11-27T17:16:17.654Z","submitted_at":"2017-11-27T17:16:17.654Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"webster","url":"/webster","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/011/356/eed5737c20d80301221d2a268bb08c4126644fe5_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":41,"url":"https://hackerone.com/cloudflare","handle":"cloudflare","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Cloudflare Vulnerability Disclosure","twitter_handle":"cloudflare","website":"https://www.cloudflare.com/disclosure","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-01-12T22:11:50.857Z","bug_reporter_agreed_on_going_public_at":"2017-12-13T22:11:34.429Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"When a Cloudflare user has a paid account, but Cloudflare can't process the user's credit card, Cloudflare emails the user from billing@cloudflare.com, subject line \"Cloudflare Failed Taking Payment for (#INV-D1234567)\".\n\nThe email contains an attachment, \"2017-11-19_Cloudflare_INV-D1234567.pdf\", a PDF file that contains an invoice. The invoice includes the user's name, the user's address, and under \"Payment Methods\" lists the user's name as it appears on their credit card, and \"Visa ending 123456******1234\". Additionally, invoices containing partial card numbers in the same format can be downloaded from /a/account on the Cloudflare site.\n\nIn other words, Cloudflare is both storing cleartext, and transmitting cleartext (via third-party Mandrill), the first six digits AND the last four digits of user credit cards. \n\nThis practice is discouraged by Visa best practices documentation (\"Disguise or suppress all but the last four digits of the PAN\"), and prohibited by MasterCard rules (\"must reflect only the last four digits of the primary account number\"). PCI DSS rules discourage the practice, but allow it. See Requirement 3 preface, Requirement 3.3; Technical Guidelines for Protecting Stored Payment Card Data.\n\nThe practice violates federal law, *See*, 15 U.S.C. § 1681(c)(g), \"no person that accepts credit cards or debit cards for the transaction of business shall print more than the last 5 digits of the card number or the expiration date upon any receipt provided to the cardholder at the point of the sale or transaction\". There has been significant litigation over whether online receipts fall under these requirements, and courts have held that they have. Violation of this provision exposes Cloudflare to damages, fees, and costs.\n\nThe practice also violates the laws of numerous states, which in some states prohibit display of more than a certain number of digits, or actively require encryption at rest of more than a certain number of digits. *See*, e.g., Cal. Civ. Code § 1747.09, \"no person, firm, partnership, association, corporation, or limited liability company that accepts credit or debit cards for the transaction of business shall print more than the last five digits of the credit or debit card account number or the expiration date upon ... Any receipt provided to the cardholder ...\"\n\nCloudflare should display only the last four digits of the user's card number, and ensure the remainder of the card number is encrypted. All existing invoices should be regenerated. Cloudflare should research if this matter triggers any breach notification requirements under state or federal law. Cloudflare should also ensure that personal information and especially financial information transmitted via third parties—in this case, Mandrill—is covered by the third party's policies and Cloudflare's privacy policy. Finally, Cloudflare should review the processes involved in generation of the invoices, to ensure that systems that generate the invoice (I see wkhtmltopdf is being used) do not even have *access* to full PANs, but only truncated PANs.\n\nIn addition to the foregoing, the first six digits of a card number are the BIN number, which identify network, bank name, type of card (e.g. credit, debit, prepaid), and in some cases brand. Making 10 out of 16 digits of a card number available in cleartext via email exposes Cloudflare customers to an elevated risk of fraud and identity theft.\n\nAnywhere sequential numbers appears in this report (e.g. 1234), the actual numbers have been replaced. Thanks!\n\n## Impact\n\nInvoices without sufficient PAN truncation, which display 10 of 16 digits of card numbers, are sent cleartext and are downloadable by users, resulting in too many digits of the card number being accessible. In addition to being against best practices, it violates law, and could result in fraud and identity theft.","vulnerability_information_html":"\u003cp\u003eWhen a Cloudflare user has a paid account, but Cloudflare can\u0026#39;t process the user\u0026#39;s credit card, Cloudflare emails the user from \u003ca title=\"billing@cloudflare.com\" href=\"mailto:billing@cloudflare.com\" rel=\"nofollow noopener noreferrer\"\u003ebilling@cloudflare.com\u003c/a\u003e, subject line \u0026quot;Cloudflare Failed Taking Payment for (#INV-D1234567)\u0026quot;.\u003c/p\u003e\n\n\u003cp\u003eThe email contains an attachment, \u0026quot;2017-11-19_Cloudflare_INV-D1234567.pdf\u0026quot;, a PDF file that contains an invoice. The invoice includes the user\u0026#39;s name, the user\u0026#39;s address, and under \u0026quot;Payment Methods\u0026quot; lists the user\u0026#39;s name as it appears on their credit card, and \u0026quot;Visa ending 123456******1234\u0026quot;. Additionally, invoices containing partial card numbers in the same format can be downloaded from /a/account on the Cloudflare site.\u003c/p\u003e\n\n\u003cp\u003eIn other words, Cloudflare is both storing cleartext, and transmitting cleartext (via third-party Mandrill), the first six digits AND the last four digits of user credit cards. \u003c/p\u003e\n\n\u003cp\u003eThis practice is discouraged by Visa best practices documentation (\u0026quot;Disguise or suppress all but the last four digits of the PAN\u0026quot;), and prohibited by MasterCard rules (\u0026quot;must reflect only the last four digits of the primary account number\u0026quot;). PCI DSS rules discourage the practice, but allow it. See Requirement 3 preface, Requirement 3.3; Technical Guidelines for Protecting Stored Payment Card Data.\u003c/p\u003e\n\n\u003cp\u003eThe practice violates federal law, \u003cem\u003eSee\u003c/em\u003e, 15 U.S.C. § 1681(c)(g), \u0026quot;no person that accepts credit cards or debit cards for the transaction of business shall print more than the last 5 digits of the card number or the expiration date upon any receipt provided to the cardholder at the point of the sale or transaction\u0026quot;. There has been significant litigation over whether online receipts fall under these requirements, and courts have held that they have. Violation of this provision exposes Cloudflare to damages, fees, and costs.\u003c/p\u003e\n\n\u003cp\u003eThe practice also violates the laws of numerous states, which in some states prohibit display of more than a certain number of digits, or actively require encryption at rest of more than a certain number of digits. \u003cem\u003eSee\u003c/em\u003e, e.g., Cal. Civ. Code § 1747.09, \u0026quot;no person, firm, partnership, association, corporation, or limited liability company that accepts credit or debit cards for the transaction of business shall print more than the last five digits of the credit or debit card account number or the expiration date upon ... Any receipt provided to the cardholder ...\u0026quot;\u003c/p\u003e\n\n\u003cp\u003eCloudflare should display only the last four digits of the user\u0026#39;s card number, and ensure the remainder of the card number is encrypted. All existing invoices should be regenerated. Cloudflare should research if this matter triggers any breach notification requirements under state or federal law. Cloudflare should also ensure that personal information and especially financial information transmitted via third parties—in this case, Mandrill—is covered by the third party\u0026#39;s policies and Cloudflare\u0026#39;s privacy policy. Finally, Cloudflare should review the processes involved in generation of the invoices, to ensure that systems that generate the invoice (I see wkhtmltopdf is being used) do not even have \u003cem\u003eaccess\u003c/em\u003e to full PANs, but only truncated PANs.\u003c/p\u003e\n\n\u003cp\u003eIn addition to the foregoing, the first six digits of a card number are the BIN number, which identify network, bank name, type of card (e.g. credit, debit, prepaid), and in some cases brand. Making 10 out of 16 digits of a card number available in cleartext via email exposes Cloudflare customers to an elevated risk of fraud and identity theft.\u003c/p\u003e\n\n\u003cp\u003eAnywhere sequential numbers appears in this report (e.g. 1234), the actual numbers have been replaced. Thanks!\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eInvoices without sufficient PAN truncation, which display 10 of 16 digits of card numbers, are sent cleartext and are downloadable by users, resulting in too many digits of the card number being accessible. In addition to being against best practices, it violates law, and could result in fraud and identity theft.\u003c/p\u003e\n","weakness":{"id":84,"name":"Missing Encryption of Sensitive Data"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-01-12T22:11:34.517Z","allow_singular_disclosure_after":-93424470.27964196,"singular_disclosure_allowed":true,"vote_count":1,"voters":["eveeez"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2184417,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-27T17:16:29.382Z","updated_at":"2017-11-27T17:16:29.382Z","additional_data":{"old_title":"Cloudflare does nut sufficiently truncate credit card numbers in invoices","new_title":"Cloudflare does not sufficiently truncate credit card numbers in invoices"},"actor":{"username":"webster","cleared":false,"url":"/webster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/011/356/eed5737c20d80301221d2a268bb08c4126644fe5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2190000,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your submission.\n\nYou are completely correct that this should not be happening. We use a 3rd party billing company to handle our credit card transactions, so I suspect this may be related. \n\nI've raised a ticket with the relevant engineering teams and will update you as it progresses.","markdown_message":"\u003cp\u003eThanks for your submission.\u003c/p\u003e\n\n\u003cp\u003eYou are completely correct that this should not be happening. We use a 3rd party billing company to handle our credit card transactions, so I suspect this may be related. \u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve raised a ticket with the relevant engineering teams and will update you as it progresses.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-29T22:34:37.039Z","updated_at":"2017-11-29T22:34:37.039Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2190173,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We are working with our 3rd party billing provider on getting a patch prepared for this. As soon as I have any more information I will update this ticket.","markdown_message":"\u003cp\u003eWe are working with our 3rd party billing provider on getting a patch prepared for this. As soon as I have any more information I will update this ticket.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-30T00:11:18.385Z","updated_at":"2017-11-30T00:11:18.385Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2190250,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update, much appreciated.","markdown_message":"\u003cp\u003eThanks for the update, much appreciated.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-30T01:05:59.359Z","updated_at":"2017-11-30T01:05:59.359Z","actor":{"username":"webster","cleared":false,"url":"/webster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/011/356/eed5737c20d80301221d2a268bb08c4126644fe5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2199994,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank's for your patience. Our fix is now in place. From now on the email's you get sent will only contain the last 4 digits. Can you check and confirm that you are happy it is fixed from your end?","markdown_message":"\u003cp\u003eThank\u0026#39;s for your patience. Our fix is now in place. From now on the email\u0026#39;s you get sent will only contain the last 4 digits. Can you check and confirm that you are happy it is fixed from your end?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-04T20:04:30.241Z","updated_at":"2017-12-04T20:04:30.241Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2200721,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Marc, the invoices in my Cloudflare account—even old ones—now appear to just say card type (e.g. Visa) and last four digits of the PAN. There's no way to trigger getting one emailed to me, but I presume they use the same system since they're styled the same, so it seems fixed to me. Thanks!\n\nHas Cloudflare investigated if any notification requirements have been triggered?","markdown_message":"\u003cp\u003eHi Marc, the invoices in my Cloudflare account—even old ones—now appear to just say card type (e.g. Visa) and last four digits of the PAN. There\u0026#39;s no way to trigger getting one emailed to me, but I presume they use the same system since they\u0026#39;re styled the same, so it seems fixed to me. Thanks!\u003c/p\u003e\n\n\u003cp\u003eHas Cloudflare investigated if any notification requirements have been triggered?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-05T01:05:23.462Z","updated_at":"2017-12-05T01:05:23.462Z","actor":{"username":"webster","cleared":false,"url":"/webster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/011/356/eed5737c20d80301221d2a268bb08c4126644fe5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2200899,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes. No sensitive data was leaked, so there are no notification requirements. The first 6 digits of a credit card are the \"IIN\", or Issuer Identification number. It identifies the credit card issuer and in some cases the card type. Further, the format we were using is actually the one still advocated by the current PCI DSS:\n\nPCI DSS 3.2 section 3.3 says:\nMask PAN when displayed (the first six and last four digits are the maximum number of digits to be displayed), such that only personnel with a legitimate business need can see more than the first six/last four digits of the PAN.\n \nAll that said, after an internal review we agreed with you, that displaying less information is better.  Thanks for your submission, if its ok with you i'm going to close this ticket as resolved.\n\nLet us know if you want us to send you some swag as a thank-you.","markdown_message":"\u003cp\u003eYes. No sensitive data was leaked, so there are no notification requirements. The first 6 digits of a credit card are the \u0026quot;IIN\u0026quot;, or Issuer Identification number. It identifies the credit card issuer and in some cases the card type. Further, the format we were using is actually the one still advocated by the current PCI DSS:\u003c/p\u003e\n\n\u003cp\u003ePCI DSS 3.2 section 3.3 says:\u003cbr\u003e\nMask PAN when displayed (the first six and last four digits are the maximum number of digits to be displayed), such that only personnel with a legitimate business need can see more than the first six/last four digits of the PAN.\u003c/p\u003e\n\n\u003cp\u003eAll that said, after an internal review we agreed with you, that displaying less information is better.  Thanks for your submission, if its ok with you i\u0026#39;m going to close this ticket as resolved.\u003c/p\u003e\n\n\u003cp\u003eLet us know if you want us to send you some swag as a thank-you.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-05T04:23:07.103Z","updated_at":"2017-12-05T04:23:07.103Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2221035,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Unless you have anything further to add, I am going to close this report and mark it resolved.","markdown_message":"\u003cp\u003eUnless you have anything further to add, I am going to close this report and mark it resolved.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-13T22:03:31.140Z","updated_at":"2017-12-13T22:03:31.140Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"webster","url":"/webster"},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2221060,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Marc. Respectfully, we are in agreement as to what PCI DSS Requirement 3 provides, but PCI DSS does not control, the law does. Has Cloudflare conducted a legal review of this issue under both state and federal law? Thanks, I appreciate your continued assistance.","markdown_message":"\u003cp\u003eHi Marc. Respectfully, we are in agreement as to what PCI DSS Requirement 3 provides, but PCI DSS does not control, the law does. Has Cloudflare conducted a legal review of this issue under both state and federal law? Thanks, I appreciate your continued assistance.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-13T22:10:41.863Z","updated_at":"2017-12-13T22:10:41.863Z","actor":{"username":"webster","cleared":false,"url":"/webster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/011/356/eed5737c20d80301221d2a268bb08c4126644fe5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2221061,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"I'm requesting public disclosure, as well. Thank you.","markdown_message":"\u003cp\u003eI\u0026#39;m requesting public disclosure, as well. Thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-13T22:11:34.459Z","updated_at":"2017-12-13T22:11:34.459Z","first_to_agree":true,"actor":{"username":"webster","cleared":false,"url":"/webster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/011/356/eed5737c20d80301221d2a268bb08c4126644fe5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2228671,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Public disclosure is fine.\n\nYes we have carried out a legal review of this.  Since the information was sent only to the cardholder, and was sent in a manner and format that met industry guidelines, our general counsel is comfortable that we have met all of our legal obligations.","markdown_message":"\u003cp\u003ePublic disclosure is fine.\u003c/p\u003e\n\n\u003cp\u003eYes we have carried out a legal review of this.  Since the information was sent only to the cardholder, and was sent in a manner and format that met industry guidelines, our general counsel is comfortable that we have met all of our legal obligations.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-16T05:21:30.115Z","updated_at":"2017-12-16T05:21:30.115Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2281282,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-12T22:11:50.882Z","updated_at":"2018-01-12T22:11:50.882Z","actor":{"url":"/cloudflare","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Cloudflare Vulnerability Disclosure"}},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}