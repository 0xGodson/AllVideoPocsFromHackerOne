{"id":16330,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjMzMA==","url":"https://hackerone.com/reports/16330","title":"Multiple issues in looking-glass software (aka from web to BGP injections)","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-06-13T14:30:13.410Z","submitted_at":"2014-06-13T14:30:13.410Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"kaeso","url":"/kaeso","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/006/350/dc751e0337dd4ea3b5cfd50d8f78ec223e59bb3a_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":20,"url":"https://hackerone.com/internet","handle":"internet","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"The Internet","twitter_handle":null,"website":"","about":"Hack all the things."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-09-17T19:43:06.035Z","bug_reporter_agreed_on_going_public_at":"2014-08-18T19:43:03.398Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"During the month of May 2014 we performed an offensive security analysis, trying to find how hard would it be for a low-to-medium skilled attacker to disrupt the core of the Internet (ie. achieve the largest possible impact at the lowest common layer, with minimal resource). This is a confidential report on our results, showing vulnerabilities and incidents which have been properly reported in the meanwhile (authors contacted, CVE assigned, patches written and incidents handled).\r\n\r\nMotivations\r\n==========\r\n\r\nThe target of our analysis are looking-glasses, web applications hosted by Autonomous Systems to offer restrict public access in order to debug network connectivity issues. We identified them as a possible weak links because:\r\n * they are web scripts, directly connected to backbone (BGP) routers via telnet/ssh\r\n * many of them have been written in 90's or 00's, without security in mind\r\n * many of them have not seen any update in many years\r\n * a bunch of open-source software are deployed by many ASes\r\n \r\n A succesfull attack on a looking-glass means gaining access to routers console, by just attacking decade-old PHP/Perl scripts.\r\nAn attacker could steal credentials or find web-flaws to login and run arbitrary commands on the routers. Even with proper ACL in place, it is easy to escalate privileges by abusing one of many existing techniques, eg. on Cisco [0] and on Juniper [1] routers.\r\n \r\nOnce there, an attacker can cause great havoc on the network. Low-hanging targets include leaking sensitive informations (eg. private routing plans) and fingerprinting the internal network. Medium-level attacks could encompass redirecting some of internal routing (eg. setting up mirroring interfaces) or performing DoS (eg. by changin OSPF configuration).\r\nHigh-level attacks would instead be targeted to the Internet: multiple rogue routers announcing malicious BGP routes will effectively disrupt worldwide connectivity.\r\n \r\n The last point is basically our motivation to submitting for this bug bounty, as the vulnerabilities and incidents below could have been abused to disrupt the Internet at BGP level from multiple injection points.\r\n \r\nResults\r\n======\r\n\r\nAll the flaws we found can be categorized as follow:\r\n * unsafe default config resulting in exposed IP, credentials, and SSH private keys =\u003e *direct login to routers*\r\n * weak commands sanitization =\u003e *arbitrary commands injection to routers*\r\n * remote memory corruption =\u003e *RCE on looking-glass servers, exploitable to read routers credentials*\r\n * reflected XSS =\u003e *stealing cookies for other network administration panels under the same-origin*\r\n\r\n \r\nIn particular, we got 6 CVEs assigned and confirmed:\r\n  * XSS in Cougar-LG - http://www.s3.eurecom.fr/cve/CVE-2014-3926.txt\r\n  * Routers command injection in mrlg4php - http://www.s3.eurecom.fr/cve/CVE-2014-3927.txt\r\n  * Exposed credentials in Cougar-LG - http://www.s3.eurecom.fr/cve/CVE-2014-3928.txt\r\n  * Exposed SSH keys in Cougar-LG  - http://www.s3.eurecom.fr/cve/CVE-2014-3929.txt\r\n  * Exposed credentials in Cistron-LG - http://www.s3.eurecom.fr/cve/CVE-2014-3930.txt\r\n  * Remote memory corruption in SUID binary - http://www.s3.eurecom.fr/cve/CVE-2014-3931.txt\r\n\r\nEach report contains full details and timeline on the issue.\r\n\r\nStarting from the above CVEs, we performed a brief survey of impacted AS and we observed the following number of incidents:\r\n * 18 exposed configuration files (containing IPs, usernames, telnet/ssh passwords)\r\n * 12 remote command injection (via mrlg4php)\r\n * 4 misconfigured CGI (exposed IPs, usernames, telnet/ssh passwords)\r\n * 3 exposed SSH private keys\r\n\r\nWe privately contacted all the ISP (Cc:ing their national FSIRT) to properly secure the exposed configuration files, and to update mrlg4php to fixed version.\r\n\r\nDisclosure\r\n=========\r\nIn order to avoid major screw-ups, we proceed as following:\r\n * asked CERT-FR (our national one) and CERT/CC to coordinate disclosure for us, they suggested instead to handle the issue ourself\r\n * contacted MITRE to get confirmation of the issues, got 6 CVEs assigned\r\n * contacted authors to report the issues. Worked with the available ones for a patched version. Filled bugs for unreachable ones, as suggested by CERT/CC.\r\n * contacted all AS and national FSIRT to report the incidents we spot in the wild. Worked with them for follow-ups.\r\n\r\nAll the process took ~1 month, and was handled in embargo mode and in private as far as possible. We are now reaching the proposed deadline for full public disclosure (16/06) with no pending blockers by software authors and AS.\r\n\r\nResearch reports\r\n==============\r\n\r\nOnce the embargo is over we would like to produce more detailed reports on what we found during the study, as such we are submitting an academic paper to WOOT'14 and a talk at DEFCON'14. Both are current under embargo and pending review, but we can attach them, if requested, under an informal non-disclosure agreement.\r\n\r\n[0] Cisco bulletin: *cisco-sr-20130318-type4*\r\n\r\n[1] Juniper bulletin: *JSA10420*\r\n","vulnerability_information_html":"\u003cp\u003eDuring the month of May 2014 we performed an offensive security analysis, trying to find how hard would it be for a low-to-medium skilled attacker to disrupt the core of the Internet (ie. achieve the largest possible impact at the lowest common layer, with minimal resource). This is a confidential report on our results, showing vulnerabilities and incidents which have been properly reported in the meanwhile (authors contacted, CVE assigned, patches written and incidents handled).\u003c/p\u003e\n\n\u003ch1 id=\"motivations\"\u003eMotivations\u003c/h1\u003e\n\n\u003cp\u003eThe target of our analysis are looking-glasses, web applications hosted by Autonomous Systems to offer restrict public access in order to debug network connectivity issues. We identified them as a possible weak links because:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ethey are web scripts, directly connected to backbone (BGP) routers via telnet/ssh\u003c/li\u003e\n\u003cli\u003emany of them have been written in 90\u0026#39;s or 00\u0026#39;s, without security in mind\u003c/li\u003e\n\u003cli\u003emany of them have not seen any update in many years\u003c/li\u003e\n\u003cli\u003ea bunch of open-source software are deployed by many ASes\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eA succesfull attack on a looking-glass means gaining access to routers console, by just attacking decade-old PHP/Perl scripts.\u003cbr\u003e\nAn attacker could steal credentials or find web-flaws to login and run arbitrary commands on the routers. Even with proper ACL in place, it is easy to escalate privileges by abusing one of many existing techniques, eg. on Cisco [0] and on Juniper [1] routers.\u003c/p\u003e\n\n\u003cp\u003eOnce there, an attacker can cause great havoc on the network. Low-hanging targets include leaking sensitive informations (eg. private routing plans) and fingerprinting the internal network. Medium-level attacks could encompass redirecting some of internal routing (eg. setting up mirroring interfaces) or performing DoS (eg. by changin OSPF configuration).\u003cbr\u003e\nHigh-level attacks would instead be targeted to the Internet: multiple rogue routers announcing malicious BGP routes will effectively disrupt worldwide connectivity.\u003c/p\u003e\n\n\u003cp\u003eThe last point is basically our motivation to submitting for this bug bounty, as the vulnerabilities and incidents below could have been abused to disrupt the Internet at BGP level from multiple injection points.\u003c/p\u003e\n\n\u003ch1 id=\"results\"\u003eResults\u003c/h1\u003e\n\n\u003cp\u003eAll the flaws we found can be categorized as follow:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eunsafe default config resulting in exposed IP, credentials, and SSH private keys =\u0026gt; \u003cem\u003edirect login to routers\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eweak commands sanitization =\u0026gt; \u003cem\u003earbitrary commands injection to routers\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eremote memory corruption =\u0026gt; \u003cem\u003eRCE on looking-glass servers, exploitable to read routers credentials\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003ereflected XSS =\u0026gt; \u003cem\u003estealing cookies for other network administration panels under the same-origin\u003c/em\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIn particular, we got 6 CVEs assigned and confirmed:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eXSS in Cougar-LG - \u003ca title=\"http://www.s3.eurecom.fr/cve/CVE-2014-3926.txt\" href=\"/redirect?url=http%3A%2F%2Fwww.s3.eurecom.fr%2Fcve%2FCVE-2014-3926.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.s3.eurecom.fr/cve/CVE-2014-3926.txt\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eRouters command injection in mrlg4php - \u003ca title=\"http://www.s3.eurecom.fr/cve/CVE-2014-3927.txt\" href=\"/redirect?url=http%3A%2F%2Fwww.s3.eurecom.fr%2Fcve%2FCVE-2014-3927.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.s3.eurecom.fr/cve/CVE-2014-3927.txt\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eExposed credentials in Cougar-LG - \u003ca title=\"http://www.s3.eurecom.fr/cve/CVE-2014-3928.txt\" href=\"/redirect?url=http%3A%2F%2Fwww.s3.eurecom.fr%2Fcve%2FCVE-2014-3928.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.s3.eurecom.fr/cve/CVE-2014-3928.txt\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eExposed SSH keys in Cougar-LG  - \u003ca title=\"http://www.s3.eurecom.fr/cve/CVE-2014-3929.txt\" href=\"/redirect?url=http%3A%2F%2Fwww.s3.eurecom.fr%2Fcve%2FCVE-2014-3929.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.s3.eurecom.fr/cve/CVE-2014-3929.txt\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eExposed credentials in Cistron-LG - \u003ca title=\"http://www.s3.eurecom.fr/cve/CVE-2014-3930.txt\" href=\"/redirect?url=http%3A%2F%2Fwww.s3.eurecom.fr%2Fcve%2FCVE-2014-3930.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.s3.eurecom.fr/cve/CVE-2014-3930.txt\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eRemote memory corruption in SUID binary - \u003ca title=\"http://www.s3.eurecom.fr/cve/CVE-2014-3931.txt\" href=\"/redirect?url=http%3A%2F%2Fwww.s3.eurecom.fr%2Fcve%2FCVE-2014-3931.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.s3.eurecom.fr/cve/CVE-2014-3931.txt\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eEach report contains full details and timeline on the issue.\u003c/p\u003e\n\n\u003cp\u003eStarting from the above CVEs, we performed a brief survey of impacted AS and we observed the following number of incidents:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e18 exposed configuration files (containing IPs, usernames, telnet/ssh passwords)\u003c/li\u003e\n\u003cli\u003e12 remote command injection (via mrlg4php)\u003c/li\u003e\n\u003cli\u003e4 misconfigured CGI (exposed IPs, usernames, telnet/ssh passwords)\u003c/li\u003e\n\u003cli\u003e3 exposed SSH private keys\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWe privately contacted all the ISP (Cc:ing their national FSIRT) to properly secure the exposed configuration files, and to update mrlg4php to fixed version.\u003c/p\u003e\n\n\u003ch1 id=\"disclosure\"\u003eDisclosure\u003c/h1\u003e\n\n\u003cp\u003eIn order to avoid major screw-ups, we proceed as following:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003easked CERT-FR (our national one) and CERT/CC to coordinate disclosure for us, they suggested instead to handle the issue ourself\u003c/li\u003e\n\u003cli\u003econtacted MITRE to get confirmation of the issues, got 6 CVEs assigned\u003c/li\u003e\n\u003cli\u003econtacted authors to report the issues. Worked with the available ones for a patched version. Filled bugs for unreachable ones, as suggested by CERT/CC.\u003c/li\u003e\n\u003cli\u003econtacted all AS and national FSIRT to report the incidents we spot in the wild. Worked with them for follow-ups.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAll the process took ~1 month, and was handled in embargo mode and in private as far as possible. We are now reaching the proposed deadline for full public disclosure (16/06) with no pending blockers by software authors and AS.\u003c/p\u003e\n\n\u003ch1 id=\"research-reports\"\u003eResearch reports\u003c/h1\u003e\n\n\u003cp\u003eOnce the embargo is over we would like to produce more detailed reports on what we found during the study, as such we are submitting an academic paper to WOOT\u0026#39;14 and a talk at DEFCON\u0026#39;14. Both are current under embargo and pending review, but we can attach them, if requested, under an informal non-disclosure agreement.\u003c/p\u003e\n\n\u003cp\u003e[0] Cisco bulletin: \u003cem\u003ecisco-sr-20130318-type4\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e[1] Juniper bulletin: \u003cem\u003eJSA10420\u003c/em\u003e\u003c/p\u003e\n","bounty_amount":"5000.0","formatted_bounty":"$5,000","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-09-17T19:43:03.555Z","allow_singular_disclosure_after":-198233677.87874365,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":92142,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"This is great. Thanks for the solid write-up. I've nominated this to the panel for a bounty, and we'll get back to you shortly with the results.","markdown_message":"\u003cp\u003eThis is great. Thanks for the solid write-up. I\u0026#39;ve nominated this to the panel for a bounty, and we\u0026#39;ll get back to you shortly with the results.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-07-19T23:25:48.023Z","updated_at":"2014-07-19T23:25:48.023Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":98564,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2014-07-30T23:48:42.505Z","updated_at":"2014-07-30T23:48:42.505Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"kaeso","url":"/kaeso"},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":98565,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2014-07-30T23:48:52.022Z","updated_at":"2014-07-30T23:48:52.022Z","actor":{"url":"/internet","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"The Internet"}},"bounty_amount":"5000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"internet","collaborator":{"username":"kaeso","url":"/kaeso"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":98567,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@kaeso - have you publicly disclosed these findings yet? If not, we'll keep it private here as well for the time being. Just select the public disclosure option if you're ready to share more broadly. Thanks again!","markdown_message":"\u003cp\u003e\u003ca href=\"/kaeso\"\u003e@kaeso\u003c/a\u003e - have you publicly disclosed these findings yet? If not, we\u0026#39;ll keep it private here as well for the time being. Just select the public disclosure option if you\u0026#39;re ready to share more broadly. Thanks again!\u003c/p\u003e\n","automated_response":false,"created_at":"2014-07-30T23:50:22.135Z","updated_at":"2014-07-30T23:50:22.135Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":111154,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"All bugs in active projects have been handled by upstream authors, and all known incidents have been reported to involved ASes. A final heads-up mail was sent to NANOG before going public. More detailed reports are now available as a slide-deck for DEFCON 22 and a paper at WOOT '14, both [online](http://www.s3.eurecom.fr/lg/). ","markdown_message":"\u003cp\u003eAll bugs in active projects have been handled by upstream authors, and all known incidents have been reported to involved ASes. A final heads-up mail was sent to NANOG before going public. More detailed reports are now available as a slide-deck for DEFCON 22 and a paper at WOOT \u0026#39;14, both \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.s3.eurecom.fr%2Flg%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eonline\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. \u003c/p\u003e\n","automated_response":false,"created_at":"2014-08-18T19:43:03.415Z","updated_at":"2014-08-18T19:43:03.415Z","actor":{"username":"kaeso","cleared":false,"url":"/kaeso","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/350/dc751e0337dd4ea3b5cfd50d8f78ec223e59bb3a_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":128731,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-09-17T19:43:06.070Z","updated_at":"2014-09-17T19:43:06.070Z","actor":{"url":"/internet","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"The Internet"}},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}