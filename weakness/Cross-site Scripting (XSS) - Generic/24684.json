{"id":24684,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNDY4NA==","url":"https://hackerone.com/reports/24684","title":"Potential XSS vulnerability to HTML minification","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-08-17T04:09:46.269Z","submitted_at":"2014-08-17T04:09:46.269Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"filedescriptor","url":"/filedescriptor","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":41,"url":"https://hackerone.com/cloudflare","handle":"cloudflare","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Cloudflare Vulnerability Disclosure","twitter_handle":"cloudflare","website":"https://www.cloudflare.com/disclosure","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-04-17T15:55:59.407Z","bug_reporter_agreed_on_going_public_at":"2018-03-18T15:55:49.142Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I have already reported it through email but I was advised to post it here.\r\n\r\nOriginal request: https://support.cloudflare.com/hc/requests/166005\r\n\r\nThe issue\r\n---------\r\n\r\nThe HTML minification function optimizes the HTML content without validating the HTML syntax. In particular circumstances this may lead to XSS vulnerability.\r\n\r\nDetails\r\n-------\r\n\r\nThe HTML minification strips off any space between an less than sign(\u003c) and an element name, making every XSS prevention that relies on tag stripping mechanism vulnerable.\r\n\r\nFor example, PHP's strip_tags() function is one of them. The way it handles malicious text is to remove complete tags, so if it encounters anything other than a valid tag it will do nothing.\r\n\r\nNow, if I am going to input the following secquence: _a less than sign(\u003c) followed by a space, followed by an element name, followed by a greater than sign(\u003e)_, e.g.```\u003c img\u003e```, the function will ignore it since it is not a valid tag according to HTML specification, and browsers will not parse it so the output remains safe.\r\n\r\nHowever, when HTML minification comes to play, it strips off the space between the less than sign and the element name, turning the safe text into a tag, which is unexpected to the function's intention.\r\n\r\nNeedless to say, it is not limited to the particular function or language.\r\n\r\nPoC\r\n---\r\n```php\r\n\u003c?php echo strip_tags('\u003c svg onload=alert(1)\u003e'); ?\u003e\r\n```\r\n\r\nComparing the results:\r\n\r\nNormal: \r\n```html\r\n\u003c svg onload=alert(1)\u003e\r\n```\r\n\r\nMinified: \r\n```html\r\n\u003csvg onload=alert(1)\u003e\r\n```","vulnerability_information_html":"\u003cp\u003eI have already reported it through email but I was advised to post it here.\u003c/p\u003e\n\n\u003cp\u003eOriginal request: \u003ca title=\"https://support.cloudflare.com/hc/requests/166005\" href=\"/redirect?url=https%3A%2F%2Fsupport.cloudflare.com%2Fhc%2Frequests%2F166005\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://support.cloudflare.com/hc/requests/166005\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"the-issue\"\u003eThe issue\u003c/h2\u003e\n\n\u003cp\u003eThe HTML minification function optimizes the HTML content without validating the HTML syntax. In particular circumstances this may lead to XSS vulnerability.\u003c/p\u003e\n\n\u003ch2 id=\"details\"\u003eDetails\u003c/h2\u003e\n\n\u003cp\u003eThe HTML minification strips off any space between an less than sign(\u0026lt;) and an element name, making every XSS prevention that relies on tag stripping mechanism vulnerable.\u003c/p\u003e\n\n\u003cp\u003eFor example, PHP\u0026#39;s strip_tags() function is one of them. The way it handles malicious text is to remove complete tags, so if it encounters anything other than a valid tag it will do nothing.\u003c/p\u003e\n\n\u003cp\u003eNow, if I am going to input the following secquence: \u003cu\u003ea less than sign(\u0026lt;) followed by a space, followed by an element name, followed by a greater than sign(\u0026gt;)\u003c/u\u003e, e.g.\u003ccode\u003e\u0026lt; img\u0026gt;\u003c/code\u003e, the function will ignore it since it is not a valid tag according to HTML specification, and browsers will not parse it so the output remains safe.\u003c/p\u003e\n\n\u003cp\u003eHowever, when HTML minification comes to play, it strips off the space between the less than sign and the element name, turning the safe text into a tag, which is unexpected to the function\u0026#39;s intention.\u003c/p\u003e\n\n\u003cp\u003eNeedless to say, it is not limited to the particular function or language.\u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePoC\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nb\"\u003estrip_tags\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt; svg onload=alert(1)\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eComparing the results:\u003c/p\u003e\n\n\u003cp\u003eNormal: \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nt\"\u003esvg\u003c/span\u003e \u003cspan class=\"na\"\u003eonload=\u003c/span\u003e\u003cspan class=\"s\"\u003ealert(1)\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eMinified: \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;svg\u003c/span\u003e \u003cspan class=\"na\"\u003eonload=\u003c/span\u003e\u003cspan class=\"s\"\u003ealert(1)\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-04-17T15:55:49.229Z","allow_singular_disclosure_after":-85238094.02733688,"singular_disclosure_allowed":true,"vote_count":21,"voters":["jokebookservice1","foobar7","avlidienbrunn","inhibitor181","spam404","tungpun","bugdiscloseguys","abr1k0s","eveeez","apapedulimu","and 11 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":112661,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for submission. I have escalated your report to our engineers for review.","markdown_message":"\u003cp\u003eThank you for submission. I have escalated your report to our engineers for review.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-08-20T16:35:55.496Z","updated_at":"2014-08-20T16:35:55.496Z","actor":{"username":"justin","cleared":false,"url":"/justin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/714/460ff848ebf95933694f8e6c967854da33ee949e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":129061,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any update? It seems the bug was fixed.","markdown_message":"\u003cp\u003eAny update? It seems the bug was fixed.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-09-18T10:33:04.412Z","updated_at":"2014-09-18T10:33:04.412Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":129236,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nOur engineers is reviewing the bug and we should have an update soon.","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eOur engineers is reviewing the bug and we should have an update soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-09-18T17:20:15.290Z","updated_at":"2014-09-18T17:20:15.290Z","actor":{"username":"dngo","cleared":false,"url":"/dngo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/378/f1a4953335a4480e4fc117e8c3b33f97378d65b8_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":140266,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\n\nApologies for the delay in updating you. Our engineers are still working on this and once a fix hits production, we will endeavour to update you.","markdown_message":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eApologies for the delay in updating you. Our engineers are still working on this and once a fix hits production, we will endeavour to update you.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-10-10T16:54:30.772Z","updated_at":"2014-10-10T16:54:30.772Z","actor":{"username":"matthewgall","cleared":false,"url":"/matthewgall","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/593/ebff87f1f73b91d9e1f9e49c53ad190f6939aeb0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":177833,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I do believe the fix has already hit production, just wondering is there any update?","markdown_message":"\u003cp\u003eI do believe the fix has already hit production, just wondering is there any update?\u003c/p\u003e\n","automated_response":false,"created_at":"2014-12-13T04:08:55.464Z","updated_at":"2014-12-13T04:08:55.464Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":351959,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello there, any updates on this issue?","markdown_message":"\u003cp\u003eHello there, any updates on this issue?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-03-12T09:28:40.728Z","updated_at":"2015-03-12T09:28:40.728Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":380416,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"We believe this issue has been resolved. Please take a moment to reassess and let us know if you disagree.","markdown_message":"\u003cp\u003eWe believe this issue has been resolved. Please take a moment to reassess and let us know if you disagree.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-15T10:02:46.743Z","updated_at":"2015-04-15T10:02:46.743Z","actor":{"username":"matthewgall","cleared":false,"url":"/matthewgall","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/593/ebff87f1f73b91d9e1f9e49c53ad190f6939aeb0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":380428,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"I can confirm this is fixed.","markdown_message":"\u003cp\u003eI can confirm this is fixed.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-15T10:11:26.801Z","updated_at":"2015-04-15T10:11:26.801Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":448243,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hello,\n\nThanks - This is a case where the bug was already being addressed and the fix was already on the roadmap. Thank-you however for your submission!\n\nMarc","markdown_message":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eThanks - This is a case where the bug was already being addressed and the fix was already on the roadmap. Thank-you however for your submission!\u003c/p\u003e\n\n\u003cp\u003eMarc\u003c/p\u003e\n","automated_response":false,"created_at":"2015-06-09T21:51:56.212Z","updated_at":"2015-06-09T21:51:56.212Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":448563,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey thanks for fixing it. Any chance to get a T-shirt or something?","markdown_message":"\u003cp\u003eHey thanks for fixing it. Any chance to get a T-shirt or something?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-06-10T02:14:06.591Z","updated_at":"2015-06-10T02:14:06.591Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":448592,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sure, I dont see why not :)\n\nSend me your name, address and T-shirt size, and I will get one shipped out to you.\n\nCheers!\n\nMarc","markdown_message":"\u003cp\u003eSure, I dont see why not :)\u003c/p\u003e\n\n\u003cp\u003eSend me your name, address and T-shirt size, and I will get one shipped out to you.\u003c/p\u003e\n\n\u003cp\u003eCheers!\u003c/p\u003e\n\n\u003cp\u003eMarc\u003c/p\u003e\n","automated_response":false,"created_at":"2015-06-10T02:50:09.460Z","updated_at":"2015-06-10T02:50:09.460Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":448621,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"How should I send you the information? I don't feel like posting it here is an option (public disclosure will leak it).","markdown_message":"\u003cp\u003eHow should I send you the information? I don\u0026#39;t feel like posting it here is an option (public disclosure will leak it).\u003c/p\u003e\n","automated_response":false,"created_at":"2015-06-10T03:41:40.293Z","updated_at":"2015-06-10T03:42:16.344Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":448665,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If you want, send it directly to my company email - marc@cloudflare.com\nIf you are feeling particularly paranoid, ping me tomorrow and I will send you my work PGP key.\n\nMarc","markdown_message":"\u003cp\u003eIf you want, send it directly to my company email - \u003ca title=\"marc@cloudflare.com\" href=\"mailto:marc@cloudflare.com\" rel=\"nofollow noopener noreferrer\"\u003emarc@cloudflare.com\u003c/a\u003e\u003cbr\u003e\nIf you are feeling particularly paranoid, ping me tomorrow and I will send you my work PGP key.\u003c/p\u003e\n\n\u003cp\u003eMarc\u003c/p\u003e\n","automated_response":false,"created_at":"2015-06-10T04:27:22.524Z","updated_at":"2015-06-10T04:27:22.524Z","actor":{"username":"cjunky","cleared":false,"url":"/cjunky","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":448703,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"Thanks for your valid bug report, we'll follow up with you in the near future regarding reward fulfilment. Thank you!","markdown_message":"\u003cp\u003eThanks for your valid bug report, we\u0026#39;ll follow up with you in the near future regarding reward fulfilment. Thank you!\u003c/p\u003e\n","automated_response":false,"created_at":"2015-06-10T05:26:10.343Z","updated_at":"2015-06-10T05:26:10.343Z","actor":{"url":"/cloudflare","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Cloudflare Vulnerability Disclosure"}},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2503655,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-18T15:55:49.184Z","updated_at":"2018-03-18T15:55:49.184Z","first_to_agree":true,"actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2625044,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-17T15:55:59.437Z","updated_at":"2018-04-17T15:55:59.437Z","actor":{"url":"/cloudflare","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Cloudflare Vulnerability Disclosure"}},"genius_execution_id":null,"team_handle":"cloudflare","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}