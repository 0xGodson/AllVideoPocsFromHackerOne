{"id":54327,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81NDMyNw==","url":"https://hackerone.com/reports/54327","title":"Persistent cross-site scripting (XSS) in map attribution","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-04-02T00:56:42.619Z","submitted_at":"2015-04-02T00:56:42.619Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ph3t","url":"/ph3t","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/684/6cad2fe0171fe59a58e987bf54392e21f1e54242_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1366,"url":"https://hackerone.com/mapbox","handle":"mapbox","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/366/d4dfa3c8752e3849cdfb22fea49c17bd37f03850_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/366/d4dfa3c8752e3849cdfb22fea49c17bd37f03850_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Mapbox","twitter_handle":"mapbox","website":"https://www.mapbox.com/security","about":"Mapbox is an open source mapping platform, providing building blocks for developers to integrate location into any mobile or online application."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2017-1000042"],"singular_disclosure_disabled":true,"disclosed_at":"2016-03-30T20:59:53.184Z","bug_reporter_agreed_on_going_public_at":"2016-03-01T15:03:35.245Z","team_member_agreed_on_going_public_at":"2016-03-30T20:59:52.799Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\r\n\r\nI have found a Persistent Cross Site Scripting vulnerability when using a custom style uploaded by myself.\r\n\r\nMapbox Studio allows create and upload styles for your maps. So if we create a new style with javascript code as attribution value it will be executed when loading a map that uses our evil style. I used the following javascript code for testing:\r\n\u003e\"\u003e\u003cimg src=x onerror=alert(document.cookie)\u003e\r\n\r\nTo reproduce this vulnerability you must download the Mapbox Studio from [here](https://www.mapbox.com/mapbox-studio/). Then you must write a random name and description. In the Attribution field you must inject the javascript code you want to execute. Save the changes again, upload the project and close the Mapbox Studio.\r\nNow, log into your Mapbox account and go to Styles, select the style you have just created, this will expand the div, and click on \"New project\". The code will be already executed, but the vulnerability is not as much exploitable as we want.\r\nWe want everybody can execute our javascript code so, choose the settings you want in the project we created and save it. Go to your [project list](https://www.mapbox.com/projects/) and search the project we have just saved. If we share this project, everybody who access to it will execute the code we have injected, including people without Mapbox account.\r\n\r\nPoC: https://api.tiles.mapbox.com/v4/pr0ph3t.lkag551j/page.html?access_token=pk.eyJ1IjoicHIwcGgzdCIsImEiOiJuRlQ1RDk0In0.qWRU_9DCEAMsAYIEpNTpnw#3/0.00/0.00\r\n\r\nDemo video: https://youtu.be/NHjTqjndRik\r\n\r\nRegards,\r\nJuan Broullón Sampedro.","vulnerability_information_html":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eI have found a Persistent Cross Site Scripting vulnerability when using a custom style uploaded by myself.\u003c/p\u003e\n\n\u003cp\u003eMapbox Studio allows create and upload styles for your maps. So if we create a new style with javascript code as attribution value it will be executed when loading a map that uses our evil style. I used the following javascript code for testing:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u0026quot;\u0026gt;\u0026lt;img src=x onerror=alert(document.cookie)\u0026gt;\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eTo reproduce this vulnerability you must download the Mapbox Studio from \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.mapbox.com%2Fmapbox-studio%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehere\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Then you must write a random name and description. In the Attribution field you must inject the javascript code you want to execute. Save the changes again, upload the project and close the Mapbox Studio.\u003cbr\u003e\nNow, log into your Mapbox account and go to Styles, select the style you have just created, this will expand the div, and click on \u0026quot;New project\u0026quot;. The code will be already executed, but the vulnerability is not as much exploitable as we want.\u003cbr\u003e\nWe want everybody can execute our javascript code so, choose the settings you want in the project we created and save it. Go to your \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.mapbox.com%2Fprojects%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eproject list\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and search the project we have just saved. If we share this project, everybody who access to it will execute the code we have injected, including people without Mapbox account.\u003c/p\u003e\n\n\u003cp\u003ePoC: \u003ca title=\"https://api.tiles.mapbox.com/v4/pr0ph3t.lkag551j/page.html?access_token=pk.eyJ1IjoicHIwcGgzdCIsImEiOiJuRlQ1RDk0In0.qWRU_9DCEAMsAYIEpNTpnw#3/0.00/0.00\" href=\"/redirect?url=https%3A%2F%2Fapi.tiles.mapbox.com%2Fv4%2Fpr0ph3t.lkag551j%2Fpage.html%3Faccess_token%3Dpk.eyJ1IjoicHIwcGgzdCIsImEiOiJuRlQ1RDk0In0.qWRU_9DCEAMsAYIEpNTpnw%233%2F0.00%2F0.00\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://api.tiles.mapbox.com/v4/pr0ph3t.lkag551j/page.html?access_token=pk.eyJ1IjoicHIwcGgzdCIsImEiOiJuRlQ1RDk0In0.qWRU_9DCEAMsAYIEpNTpnw#3/0.00/0.00\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eDemo video: \u003ca title=\"https://youtu.be/NHjTqjndRik\" href=\"/redirect?url=https%3A%2F%2Fyoutu.be%2FNHjTqjndRik\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://youtu.be/NHjTqjndRik\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nJuan Broullón Sampedro.\u003c/p\u003e\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-03-31T15:03:35.606Z","allow_singular_disclosure_after":-149786016.5450697,"singular_disclosure_allowed":true,"vote_count":3,"voters":["sw33tlie","ph3t","dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":369410,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Juan, thank you for the report. I can confirm this issue and we have started to work on a fix.","markdown_message":"\u003cp\u003eJuan, thank you for the report. I can confirm this issue and we have started to work on a fix.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-02T18:41:51.336Z","updated_at":"2015-04-02T18:41:51.336Z","actor":{"username":"jfirebaugh","cleared":false,"url":"/jfirebaugh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":370992,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Juan,\n\nWe determined that this is vulnerability in one of our JavaScript libraries, Mapbox.js. We'll be making a public release of this library shortly. In the meantime, we've deployed an internal fix for this issue on the project share page. Can you verify that the project share page is no longer vulnerable?\n\nThanks again for the report.","markdown_message":"\u003cp\u003eHi Juan,\u003c/p\u003e\n\n\u003cp\u003eWe determined that this is vulnerability in one of our JavaScript libraries, Mapbox.js. We\u0026#39;ll be making a public release of this library shortly. In the meantime, we\u0026#39;ve deployed an internal fix for this issue on the project share page. Can you verify that the project share page is no longer vulnerable?\u003c/p\u003e\n\n\u003cp\u003eThanks again for the report.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-03T17:06:55.823Z","updated_at":"2015-04-03T17:06:55.823Z","actor":{"username":"jfirebaugh","cleared":false,"url":"/jfirebaugh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":371157,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello, \n\nI still can execute the XSS as you can see in the attached image.\n\nRegards!","markdown_message":"\u003cp\u003eHello, \u003c/p\u003e\n\n\u003cp\u003eI still can execute the XSS as you can see in the attached image.\u003c/p\u003e\n\n\u003cp\u003eRegards!\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-03T19:25:51.453Z","updated_at":"2015-04-03T19:25:51.453Z","actor":{"username":"ph3t","cleared":false,"url":"/ph3t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/684/6cad2fe0171fe59a58e987bf54392e21f1e54242_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":33682,"filename":"Captura_de_pantalla_2015-04-03_a_las_21.23.31.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/033/682/9382f60e5e099db32cd1383a2a7805dd32aacf23/Captura_de_pantalla_2015-04-03_a_las_21.23.31.png?response-content-disposition=attachment%3B%20filename%3D%22Captura_de_pantalla_2015-04-03_a_las_21.23.31.png%22%3B%20filename%2A%3DUTF-8%27%27Captura_de_pantalla_2015-04-03_a_las_21.23.31.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXTSUKMQR%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T061712Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCICj7knYENMnZh5A0NglwhkrcefT2BpvxRPeuGap0VUVRAiAmn0d7G6cOHj4E%2FKnqMO8ijTpfdfQo0l3AXDA9%2BVALKyq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM%2FiUJtIxCtzL546wIKpEDje0AX20BGKjUrOSYKWZEdzHWjKRP8eQkcBUNH01qDuCwWFb492oSkH%2FEbtHYsr08fP7HLp%2BTd6LcNHSrDFB9d%2BFYETRUG%2BADKmSGmr3Nwq3xqOP7v1EpWK%2BMEc71vsf2gHyy2w59dToZZzlFf2LAOtvhw7zU2wPf4yKeKdDuOWSWY%2FYHF9%2FAyxR3PD619mcgslnZ5pnYBzX6KdEFvaj1f6s0iYObvLdLHSGri%2BDq6ie%2BP8QhqPHtP8GrAkyOULwf0RxusfkoOYlk6RCSPeGnc%2B%2F0xS4Z3WGTX1xspZfXd0eNVxbwMndOmyXOgV4rAgYhogZMCF8CUdB54myomh4lvN8GC6ZOidewqvFMUYwvJDtcv5pamoBOKfBja9zALg1XyMVI0veiuhxW3yKuxhVLdNKxYadV6pexYwarFA3FPF7h4jC%2F4kY3598KIMbOh7q27L9WfbepKiXnfyh29KSGWxJCVMqZfME%2F5fKTENVzxThmVhSuR%2BN%2FKLX7fsytnAWZSmFjtkQ0xLsf2eZqtVvhJBAwkdSq%2FwU67AHKBp0gQe3TLXIgmEnz83bIH2CwQkZMzah2yfBPWtq0ZmAtH%2B0SUMwvTFocxndYggkQSymMXlnMxSrW%2BShlOraR%2FvJ3Ray4%2FLsf09Cb2XaPSrPR5Wx1KvVAyb2Z18jluSP%2Fm5hPR5XJ4tbNBRxfzhgRI1u4O97hl5qsWT1DT7hNdHJ0BNkn7AUS4VJKTLipMdxmxf4j4xDx5eEMqe7Wr5xoy56daL76ywzY%2F7%2B2Yy7SSE3lpZivXSYx0hn1jJAOzsp%2BLLnwo599EX%2FHSD0E4ZBDvjofSUuw6iva2j9O%2BZyk3WJc%2FbmM7LEVw1QRhA%3D%3D\u0026X-Amz-Signature=6fdcf7a5db70674ac8ebb1cd9a2ca38678ef854ac5b00ef639dc107596605609"}],"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":371238,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry about that, I think some of our CDN nodes did not have their caches invalidated. Would you mind trying again?","markdown_message":"\u003cp\u003eSorry about that, I think some of our CDN nodes did not have their caches invalidated. Would you mind trying again?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-03T21:08:03.954Z","updated_at":"2015-04-03T21:08:03.954Z","actor":{"username":"jfirebaugh","cleared":false,"url":"/jfirebaugh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":371268,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem!\n\nI have tried with other payloads also and the javascript is correctly filtered in the shared page, but it is being executed in the editor following the same steps.\n\nI have attached a screenshot.","markdown_message":"\u003cp\u003eNo problem!\u003c/p\u003e\n\n\u003cp\u003eI have tried with other payloads also and the javascript is correctly filtered in the shared page, but it is being executed in the editor following the same steps.\u003c/p\u003e\n\n\u003cp\u003eI have attached a screenshot.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-03T21:31:46.454Z","updated_at":"2015-04-03T21:31:46.454Z","actor":{"username":"ph3t","cleared":false,"url":"/ph3t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/684/6cad2fe0171fe59a58e987bf54392e21f1e54242_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":33698,"filename":"Captura_de_pantalla_2015-04-03_a_las_23.29.43.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/033/698/ef968c47049d42ea0e934176ae6b758455913c05/Captura_de_pantalla_2015-04-03_a_las_23.29.43.png?response-content-disposition=attachment%3B%20filename%3D%22Captura_de_pantalla_2015-04-03_a_las_23.29.43.png%22%3B%20filename%2A%3DUTF-8%27%27Captura_de_pantalla_2015-04-03_a_las_23.29.43.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXTSUKMQR%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T061712Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCICj7knYENMnZh5A0NglwhkrcefT2BpvxRPeuGap0VUVRAiAmn0d7G6cOHj4E%2FKnqMO8ijTpfdfQo0l3AXDA9%2BVALKyq0AwhVEAEaDDAxMzYxOTI3NDg0OSIM%2FiUJtIxCtzL546wIKpEDje0AX20BGKjUrOSYKWZEdzHWjKRP8eQkcBUNH01qDuCwWFb492oSkH%2FEbtHYsr08fP7HLp%2BTd6LcNHSrDFB9d%2BFYETRUG%2BADKmSGmr3Nwq3xqOP7v1EpWK%2BMEc71vsf2gHyy2w59dToZZzlFf2LAOtvhw7zU2wPf4yKeKdDuOWSWY%2FYHF9%2FAyxR3PD619mcgslnZ5pnYBzX6KdEFvaj1f6s0iYObvLdLHSGri%2BDq6ie%2BP8QhqPHtP8GrAkyOULwf0RxusfkoOYlk6RCSPeGnc%2B%2F0xS4Z3WGTX1xspZfXd0eNVxbwMndOmyXOgV4rAgYhogZMCF8CUdB54myomh4lvN8GC6ZOidewqvFMUYwvJDtcv5pamoBOKfBja9zALg1XyMVI0veiuhxW3yKuxhVLdNKxYadV6pexYwarFA3FPF7h4jC%2F4kY3598KIMbOh7q27L9WfbepKiXnfyh29KSGWxJCVMqZfME%2F5fKTENVzxThmVhSuR%2BN%2FKLX7fsytnAWZSmFjtkQ0xLsf2eZqtVvhJBAwkdSq%2FwU67AHKBp0gQe3TLXIgmEnz83bIH2CwQkZMzah2yfBPWtq0ZmAtH%2B0SUMwvTFocxndYggkQSymMXlnMxSrW%2BShlOraR%2FvJ3Ray4%2FLsf09Cb2XaPSrPR5Wx1KvVAyb2Z18jluSP%2Fm5hPR5XJ4tbNBRxfzhgRI1u4O97hl5qsWT1DT7hNdHJ0BNkn7AUS4VJKTLipMdxmxf4j4xDx5eEMqe7Wr5xoy56daL76ywzY%2F7%2B2Yy7SSE3lpZivXSYx0hn1jJAOzsp%2BLLnwo599EX%2FHSD0E4ZBDvjofSUuw6iva2j9O%2BZyk3WJc%2FbmM7LEVw1QRhA%3D%3D\u0026X-Amz-Signature=f768a35fe488be9f1c79b94ae9950a25643992a42dcc5ef58cf5d1385e21ff93"}],"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":371296,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you, I had missed that you reported the editor as vulnerable in your original report. I've rolled out a fix there, and we are currently reviewing if any other pages on www.mapbox.com are affected.","markdown_message":"\u003cp\u003eThank you, I had missed that you reported the editor as vulnerable in your original report. I\u0026#39;ve rolled out a fix there, and we are currently reviewing if any other pages on \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.mapbox.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.mapbox.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e are affected.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-03T22:10:59.736Z","updated_at":"2015-04-03T22:10:59.736Z","actor":{"username":"jfirebaugh","cleared":false,"url":"/jfirebaugh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":371298,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry if I didn't say clearly it was vulnerable, I focused the report in the final map vulnerability.","markdown_message":"\u003cp\u003eSorry if I didn\u0026#39;t say clearly it was vulnerable, I focused the report in the final map vulnerability.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-03T22:15:00.031Z","updated_at":"2015-04-03T22:15:00.031Z","actor":{"username":"ph3t","cleared":false,"url":"/ph3t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/684/6cad2fe0171fe59a58e987bf54392e21f1e54242_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":373676,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your patience. We are now preparing a public release of Mapbox.js which includes sanitization of the incoming attribution. As an additional precaution, we are adding sanitization of the attribution in the map data API which Mapbox.js uses.","markdown_message":"\u003cp\u003eThanks for your patience. We are now preparing a public release of Mapbox.js which includes sanitization of the incoming attribution. As an additional precaution, we are adding sanitization of the attribution in the map data API which Mapbox.js uses.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-06T22:21:00.921Z","updated_at":"2015-04-06T22:21:00.921Z","actor":{"username":"jfirebaugh","cleared":false,"url":"/jfirebaugh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":373681,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"You're welcome, let me know when you upload it and I will continue testing.","markdown_message":"\u003cp\u003eYou\u0026#39;re welcome, let me know when you upload it and I will continue testing.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-06T22:26:24.760Z","updated_at":"2015-04-06T22:28:08.879Z","actor":{"username":"ph3t","cleared":false,"url":"/ph3t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/684/6cad2fe0171fe59a58e987bf54392e21f1e54242_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":375759,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e As an additional precaution, we are adding sanitization of the attribution in the map data API which Mapbox.js uses.\n\nThis has now been deployed.\n\nWe have also released Mapbox.js versions 2.1.7 and 1.6.5, making public the mitigations that were previously applied to the editor and share pages. In certain uncommon scenarios (using `L.mapbox.map` or `L.mapbox.tileLayer` to load untrusted TileJSON content from a non-Mapbox URL), users of Mapbox.js could be vulnerable to this XSS vector even after the API-level mitigations. I've sent a security advisory covering those scenarios to nodesecurity.io.\n\nI now consider this fully resolved on our end. Is there anything else you want to confirm or add?","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003eAs an additional precaution, we are adding sanitization of the attribution in the map data API which Mapbox.js uses.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThis has now been deployed.\u003c/p\u003e\n\n\u003cp\u003eWe have also released Mapbox.js versions 2.1.7 and 1.6.5, making public the mitigations that were previously applied to the editor and share pages. In certain uncommon scenarios (using \u003ccode\u003eL.mapbox.map\u003c/code\u003e or \u003ccode\u003eL.mapbox.tileLayer\u003c/code\u003e to load untrusted TileJSON content from a non-Mapbox URL), users of Mapbox.js could be vulnerable to this XSS vector even after the API-level mitigations. I\u0026#39;ve sent a security advisory covering those scenarios to nodesecurity.io.\u003c/p\u003e\n\n\u003cp\u003eI now consider this fully resolved on our end. Is there anything else you want to confirm or add?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-09T00:22:33.256Z","updated_at":"2015-04-09T00:22:33.256Z","actor":{"username":"jfirebaugh","cleared":false,"url":"/jfirebaugh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":375893,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, it's fixed.","markdown_message":"\u003cp\u003eYes, it\u0026#39;s fixed.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-09T06:26:05.669Z","updated_at":"2015-04-09T06:26:05.669Z","actor":{"username":"ph3t","cleared":false,"url":"/ph3t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/684/6cad2fe0171fe59a58e987bf54392e21f1e54242_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":376109,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2015-04-09T16:54:27.844Z","updated_at":"2015-04-09T16:54:27.844Z","actor":{"username":"jfirebaugh","cleared":false,"url":"/jfirebaugh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ph3t","url":"/ph3t"},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":376111,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2015-04-09T16:55:16.769Z","updated_at":"2015-04-09T16:55:16.769Z","actor":{"url":"/mapbox","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/366/d4dfa3c8752e3849cdfb22fea49c17bd37f03850_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Mapbox"}},"bounty_amount":"1000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"mapbox","collaborator":{"username":"ph3t","url":"/ph3t"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":818909,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-03-01T15:03:35.276Z","updated_at":"2016-03-01T15:03:35.276Z","first_to_agree":true,"actor":{"username":"ph3t","cleared":false,"url":"/ph3t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/684/6cad2fe0171fe59a58e987bf54392e21f1e54242_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":836578,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"May I disclose this vulnerability?\n\nThank you.","markdown_message":"\u003cp\u003eMay I disclose this vulnerability?\u003c/p\u003e\n\n\u003cp\u003eThank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-03-12T14:47:46.955Z","updated_at":"2016-03-12T14:47:46.955Z","actor":{"username":"ph3t","cleared":false,"url":"/ph3t","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/684/6cad2fe0171fe59a58e987bf54392e21f1e54242_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":878836,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-03-30T20:38:49.413Z","updated_at":"2016-03-30T20:38:49.413Z","additional_data":{"old_title":"Mapbox Persistent Cross Site Scripting using custom styles","new_title":"Persistent cross-site scripting (XSS) in map attribution"},"actor":{"username":"alulsh","cleared":false,"url":"/alulsh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":878883,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-03-30T20:59:52.823Z","updated_at":"2016-03-30T20:59:52.823Z","actor":{"username":"alulsh","cleared":false,"url":"/alulsh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":878884,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-03-30T20:59:53.207Z","updated_at":"2016-03-30T20:59:53.207Z","actor":{"username":"alulsh","cleared":false,"url":"/alulsh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":1574,"category":"team","content":"@ph3t reported a persistent cross-site scripting (XSS) issue in the [map attribution](https://www.mapbox.com/help/attribution/) control for Mapbox.js maps. This allowed a potential attacker to have full control over a user's Mapbox.com session and execute arbitrary JavaScript commands. It also allowed for the execution of arbitrary JavaScript in websites using Mapbox.js with the uncommon usage scenario of loading untrusted TileJSON.\n\n@ph3t's proof of concept used our [Mapbox Studio Classic](https://www.mapbox.com/mapbox-studio-classic/) desktop application to add a custom attribution with an XSS payload (`\"\u003e\u003cimg src=\"x onerror=alert(document.cookie)\u003e`) to a custom map style. @ph3t then uploaded the custom style to their account on mapbox.com and created a new project using the malicious style. Saving the project allowed @ph3t to send a URL of the project with the executable XSS payload to a potential victim.\n\nBy default the attribution control contains a link to Mapbox (`\"\u003ca href=\"https://www.mapbox.com\u003eMapbox\u003c/a\u003e\"`). Support for HTML in the map attribution is necessary and after @ph3t's report, we first deployed a patch to our mapping API for server-side sanitization of user-provided attribution controls. We also released a [client-side sanitization fix](https://github.com/mapbox/mapbox.js/commit/538d229ab6767bb4c3f3969c417f9884189c1512) in Mapbox.js v2.1.7 and v1.6.5 to mitigate the uncommon usage scenario of using untrusted TileJSON. The patches used [sanitize-caja](https://github.com/mapbox/sanitize-caja) to sanitize any script content added to the [attribution property](https://github.com/mapbox/tilejson-spec/blob/adde70cde80ebfdb9609980750691edc3f7492ef/2.1.0/schema.json#L19-L21) of untrusted TileJSON.\n\nAdditional details can be found in the [Node Security project advisory](https://nodesecurity.io/advisories) submitted for this issue, [#49 - Content Injection via TileJSON attribute](https://nodesecurity.io/advisories/49).","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003ca href=\"/ph3t\"\u003e@ph3t\u003c/a\u003e reported a persistent cross-site scripting (XSS) issue in the \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.mapbox.com%2Fhelp%2Fattribution%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003emap attribution\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e control for Mapbox.js maps. This allowed a potential attacker to have full control over a user\u0026#39;s Mapbox.com session and execute arbitrary JavaScript commands. It also allowed for the execution of arbitrary JavaScript in websites using Mapbox.js with the uncommon usage scenario of loading untrusted TileJSON.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"/ph3t\"\u003e@ph3t\u003c/a\u003e\u0026#39;s proof of concept used our \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.mapbox.com%2Fmapbox-studio-classic%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eMapbox Studio Classic\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e desktop application to add a custom attribution with an XSS payload (\u003ccode\u003e\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;x onerror=alert(document.cookie)\u0026gt;\u003c/code\u003e) to a custom map style. \u003ca href=\"/ph3t\"\u003e@ph3t\u003c/a\u003e then uploaded the custom style to their account on mapbox.com and created a new project using the malicious style. Saving the project allowed \u003ca href=\"/ph3t\"\u003e@ph3t\u003c/a\u003e to send a URL of the project with the executable XSS payload to a potential victim.\u003c/p\u003e\n\n\u003cp\u003eBy default the attribution control contains a link to Mapbox (\u003ccode\u003e\u0026quot;\u0026lt;a href=\u0026quot;https://www.mapbox.com\u0026gt;Mapbox\u0026lt;/a\u0026gt;\u0026quot;\u003c/code\u003e). Support for HTML in the map attribution is necessary and after \u003ca href=\"/ph3t\"\u003e@ph3t\u003c/a\u003e\u0026#39;s report, we first deployed a patch to our mapping API for server-side sanitization of user-provided attribution controls. We also released a \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmapbox%2Fmapbox.js%2Fcommit%2F538d229ab6767bb4c3f3969c417f9884189c1512\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eclient-side sanitization fix\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e in Mapbox.js v2.1.7 and v1.6.5 to mitigate the uncommon usage scenario of using untrusted TileJSON. The patches used \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmapbox%2Fsanitize-caja\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003esanitize-caja\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to sanitize any script content added to the \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmapbox%2Ftilejson-spec%2Fblob%2Fadde70cde80ebfdb9609980750691edc3f7492ef%2F2.1.0%2Fschema.json%23L19-L21\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eattribution property\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e of untrusted TileJSON.\u003c/p\u003e\n\n\u003cp\u003eAdditional details can be found in the \u003ca href=\"/redirect?url=https%3A%2F%2Fnodesecurity.io%2Fadvisories\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eNode Security project advisory\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e submitted for this issue, \u003ca href=\"/redirect?url=https%3A%2F%2Fnodesecurity.io%2Fadvisories%2F49\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e#49 - Content Injection via TileJSON attribute\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}