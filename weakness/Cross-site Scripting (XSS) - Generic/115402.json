{"id":115402,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTU0MDI=","url":"https://hackerone.com/reports/115402","title":"XSS via modified Zomato widget (res_search_widget.php)","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-02-08T15:39:16.409Z","submitted_at":"2016-02-08T15:39:16.409Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"pr0tagon1st","url":"/pr0tagon1st","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/033/123/9e3397fc4128a6ea0579adedf2a30f47f54ad11a_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2943,"url":"https://hackerone.com/zomato","handle":"zomato","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Zomato","twitter_handle":"Zomato","website":"https://www.zomato.com","about":"The fastest way to search for great places to eat at and order from around you. Serving 24 countries worldwide."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-03-11T06:17:58.904Z","bug_reporter_agreed_on_going_public_at":"2016-02-10T06:17:56.247Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Table of Contents:\n1.  Short Description of Security Issue\n2. Proof of Concept\n\n#### 1. Short Description of Security Issue\n\nThe widget API endpoint at `https://www.zomato.com/widgets/res_search_widget.php` is vulnerable to XSS in the `language_id` parameter.\n\nAn attacker can create a web page that includes a Zomato widget inside an iframe with a specially crafted URL parameter that contains javascript. If a Zomato user opens this page, the iframe will load and execute the malicious javascript in the zomato.com origin using the user's active session.\n\nThis javascript can then steal a CSRF token from the zomato.com homepage and perform actions _as_ the user - actions such as inviting/removing friends, posting reviews, posting ratings and others. This can potentially be used to message other users with the malicious web page and get them to execute the malicious code, creating a sort of javascript worm or embed external malicious documents (flash, pdf, other) to continue the attack on a user's machine. On the good side, the injected javascript _may not_ steal the user's session cookie thanks to the HTTPOnly cookie parameter.\n\nThe `language_id` parameter should be filtered so that non-essential characters are removed before being output to users.\n\n#### 2. Proof of Concept\n\nI use a piece of javascript code that creates an alert box with the `document.domain`, which shows the SOP is bypassed: `\"}');alert(document.domain);console.log('`. This code is urlencoded and inserted into the `language_id` parameter of the request like so:\n\n```\nhttps://www.zomato.com/widgets/res_search_widget.php?city_id=276\u0026language_id=%22%7D%27)%3Balert(1)%3Bconsole.log(%27\u0026theme=blue\u0026hideCitySearch=on\u0026hideResSearch=on\u0026sort=popularity\n```\n\nThis URL is used to create an iframe as described in Zomato's widget documentation: https://developers.zomato.com/widgets and the final code looks like this:\n\n```\n\u003chtml\u003e\n    \u003cbody\u003e\n        \u003ciframe src=\"https://www.zomato.com/widgets/res_search_widget.php?city_id=273\u0026language_id=%22%7D%27)%3Balert(document.domain)%3Bconsole.log(%27\u0026theme=blue\u0026hideCitySearch=on\u0026hideResSearch=on\u0026sort=popularity\" style=\"position:relative;width:100%;height:100%;\" border=\"0\" frameborder=\"0\"\u003e\u003c/iframe\u003e\n    \u003c/body\u003e\n\u003c/html\u003e\n```\n\nOpening this html document, even locally, will run the javascript in the context of zomato.com as shown in the attached screenshot.\n\nLet me know if you have any questions.\n\nBest,\nMatt","vulnerability_information_html":"\u003cp\u003eTable of Contents:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e Short Description of Security Issue\u003c/li\u003e\n\u003cli\u003eProof of Concept\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch4 id=\"1-short-description-of-security-issue\"\u003e1. Short Description of Security Issue\u003c/h4\u003e\n\n\u003cp\u003eThe widget API endpoint at \u003ccode\u003ehttps://www.zomato.com/widgets/res_search_widget.php\u003c/code\u003e is vulnerable to XSS in the \u003ccode\u003elanguage_id\u003c/code\u003e parameter.\u003c/p\u003e\n\n\u003cp\u003eAn attacker can create a web page that includes a Zomato widget inside an iframe with a specially crafted URL parameter that contains javascript. If a Zomato user opens this page, the iframe will load and execute the malicious javascript in the zomato.com origin using the user\u0026#39;s active session.\u003c/p\u003e\n\n\u003cp\u003eThis javascript can then steal a CSRF token from the zomato.com homepage and perform actions \u003cu\u003eas\u003c/u\u003e the user - actions such as inviting/removing friends, posting reviews, posting ratings and others. This can potentially be used to message other users with the malicious web page and get them to execute the malicious code, creating a sort of javascript worm or embed external malicious documents (flash, pdf, other) to continue the attack on a user\u0026#39;s machine. On the good side, the injected javascript \u003cu\u003emay not\u003c/u\u003e steal the user\u0026#39;s session cookie thanks to the HTTPOnly cookie parameter.\u003c/p\u003e\n\n\u003cp\u003eThe \u003ccode\u003elanguage_id\u003c/code\u003e parameter should be filtered so that non-essential characters are removed before being output to users.\u003c/p\u003e\n\n\u003ch4 id=\"2-proof-of-concept\"\u003e2. Proof of Concept\u003c/h4\u003e\n\n\u003cp\u003eI use a piece of javascript code that creates an alert box with the \u003ccode\u003edocument.domain\u003c/code\u003e, which shows the SOP is bypassed: \u003ccode\u003e\u0026quot;}\u0026#39;);alert(document.domain);console.log(\u0026#39;\u003c/code\u003e. This code is urlencoded and inserted into the \u003ccode\u003elanguage_id\u003c/code\u003e parameter of the request like so:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ehttps://www.zomato.com/widgets/res_search_widget.php?city_id=276\u0026amp;language_id=%22%7D%27)%3Balert(1)%3Bconsole.log(%27\u0026amp;theme=blue\u0026amp;hideCitySearch=on\u0026amp;hideResSearch=on\u0026amp;sort=popularity\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis URL is used to create an iframe as described in Zomato\u0026#39;s widget documentation: \u003ca title=\"https://developers.zomato.com/widgets\" href=\"/redirect?url=https%3A%2F%2Fdevelopers.zomato.com%2Fwidgets\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://developers.zomato.com/widgets\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and the final code looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;iframe\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://www.zomato.com/widgets/res_search_widget.php?city_id=273\u0026amp;language_id=%22%7D%27)%3Balert(document.domain)%3Bconsole.log(%27\u0026amp;theme=blue\u0026amp;hideCitySearch=on\u0026amp;hideResSearch=on\u0026amp;sort=popularity\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003estyle=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;position:relative;width:100%;height:100%;\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eborder=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;0\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eframeborder=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;0\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/iframe\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOpening this html document, even locally, will run the javascript in the context of zomato.com as shown in the attached screenshot.\u003c/p\u003e\n\n\u003cp\u003eLet me know if you have any questions.\u003c/p\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nMatt\u003c/p\u003e\n","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":72661,"file_name":"zomato_poc.jpg","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/072/661/16d15c201d028c6f94c40f3871004d67af1a35af/zomato_poc.jpg?response-content-disposition=attachment%3B%20filename%3D%22zomato_poc.jpg%22%3B%20filename%2A%3DUTF-8%27%27zomato_poc.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQUOQU5REA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T041808Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDKbajvkbgJ0bk%2BBvRtGQ7p5KCzGha%2FVaDDwyFq8CM66wIgaw7%2FMRI5kyRpH%2BnIlLG4ZnmM%2FrLjLjJWrmkX0zZfd9sqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDP91WL002Wbo0XGfnyqRA%2FNt3W4r54Z2Rrjnbzg30AtIqSAaUbiKh6dYPI5iumJt%2FacDVM4CmdTQCSkrpk45DFotrgtd1tIXQUPsAioE3hz70xop4zS0jebfAPdwBp38Mc3YKPYsW1TgWIT19zK4t%2B4eGJVFjPey5O%2FEfBu4XYpGDd%2Fy2VO0kVCb43%2F76mvlk6aWlA01UhpCilK3J%2F7qqZsw4P3jggaBSCjGhssHvqDLjMzfR%2FDpDE7VaotOr3rJmP5ZK66Q9%2BkoG5kaLgKcslwRO9FGLNBY8AuIhUCEMRp9RM9yBIFYe%2FyyvHRriCVGHEgdIJ9wvxaVVvCfEcWZw1dEIriA6BftAk5kML6b8WN8zwMI3cyqbnvBS9PGbEcrzzU67DDkEk0llxEfFqJB1g4ruY5L2BsxjsulOVXWFSQHoykg7EnBFBbQGmuPAyxW942tXfkTyjH7aQIFAbpwURAHEFFcnVcJBzYS%2B6tGyu1ozPdrsFK5Ko2OryeYDFeK8b9JxwAMZqBekNlk1Bn%2BWq2RJZZBgBTV1X9LfuQ%2FLbSAMJq2qv8FOusBgtnFtNPu6rgydFw%2BpCNudbVGZ39p3P2aIl7K%2B6fRTLBImgaGX5r2pXgGjSRb3Co5NHURzMlQWYw9SJdMt5vMsDNtT9otjm5R%2Fz00sRO779VmfaZOO18lLujlVlImBZA%2BY20iW%2B%2FVBR4UOivJTvxApUCo%2BQYZQghLFkO4s17mPPAo6XeP%2BtXjXhn71RPHuwavkbgQ0EuL1pf5gaqdarsB4psJiZ3FphFomE6unCMAErk3vFIwEIi%2Be5%2FjAIsDg6zS3oetmQEMR7IeJadGwnOF7tifKH8X2cyJk2IoG8HLG%2FfDEf2cBUt6EjPoIQ%3D%3D\u0026X-Amz-Signature=d4402dd680614e8eade745492299cf017b0edd335fcd01abd278f4deaac5d478","file_size":87241,"type":"image/jpeg"}],"allow_singular_disclosure_at":"2016-03-11T06:17:56.646Z","allow_singular_disclosure_after":-151538412.09187287,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":792440,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi Matt, \n\nThis bug has been resolved now. \nThank you for helping keep Zomato safe for the community !","markdown_message":"\u003cp\u003eHi Matt, \u003c/p\u003e\n\n\u003cp\u003eThis bug has been resolved now. \u003cbr\u003e\nThank you for helping keep Zomato safe for the community !\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-10T03:57:03.899Z","updated_at":"2016-02-10T03:57:03.899Z","actor":{"username":"nidhi","cleared":false,"url":"/nidhi","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"pr0tagon1st","url":"/pr0tagon1st"},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":792477,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hi! Glad to help! Would you mind if we made this disclosure public? Thanks!","markdown_message":"\u003cp\u003eHi! Glad to help! Would you mind if we made this disclosure public? Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-10T06:17:56.274Z","updated_at":"2016-02-10T06:17:56.274Z","first_to_agree":true,"actor":{"username":"pr0tagon1st","cleared":false,"url":"/pr0tagon1st","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/033/123/9e3397fc4128a6ea0579adedf2a30f47f54ad11a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":834555,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-03-11T06:17:58.943Z","updated_at":"2016-03-11T06:17:58.943Z","actor":{"url":"/zomato","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Zomato"}},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5206810,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-27T14:51:25.501Z","updated_at":"2019-06-27T14:51:25.501Z","actor":{"url":"/zomato","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Zomato"}},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}