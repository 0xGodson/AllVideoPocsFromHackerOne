{"id":180196,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODAxOTY=","url":"https://hackerone.com/reports/180196","title":"Host header Injection rubygems.org","state":"Closed","substate":"not-applicable","severity_rating":"low","readable_substate":"N/A","created_at":"2016-11-04T18:12:04.182Z","submitted_at":"2016-11-04T18:12:04.182Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bugs3ra","url":"/bugs3ra","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/031/877/979f1b2f975110612d4cab7336f0d594e4afb678_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8212,"url":"https://hackerone.com/rubygems","handle":"rubygems","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"RubyGems","twitter_handle":"rubygems_status","website":"https://rubygems.org","about":"RubyGems.org is the Ruby communityâ€™s gem hosting service."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-02-08T23:10:47.550Z","bug_reporter_agreed_on_going_public_at":"2016-11-05T17:08:04.782Z","team_member_agreed_on_going_public_at":"2018-02-08T23:10:47.455Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nAs you are interested in any bug in rubygems.org, I thought of reporting it.\n\nThe host header is not validated on rubygems.org. In many cases, developers are trusting the HTTP Host header value and using it to generate links, import scripts and even generate password resets links with its value. This is a very bad idea, because the HTTP Host header can be controlled by an attacker. This can be exploited using web-cache poisoning and by abusing alternative channels like password reset emails.\n\n**POC**\n```\nGET / HTTP/1.1\nHost: www.google.com\n```\nResponse\n```\nHTTP/1.1 500 Domain Not Found\nServer: Varnish\nRetry-After: 0\ncontent-type: text/html\nCache-Control: private, no-cache\nconnection: keep-alive\nContent-Length: 207\nAccept-Ranges: bytes\nDate: Mon, 31 Oct 2016 07:49:14 GMT\nVia: 1.1 varnish\nConnection: close\n\n\u003chtml\u003e\n\u003chead\u003e\n\u003ctitle\u003eFastly error: unknown domain www.google.com\u003c/title\u003e\n\u003c/head\u003e\n\u003cbody\u003e\nFastly error: unknown domain: www.google.com. Please check that this domain has been added to a service.\u003c/body\u003e\u003c/html\u003e\n```\nNow having my malicious page hosted on fastly(example taken is www.newrelic.com running on faslty), I can expolit the issue:\n```\nGET / HTTP/1.1\nHost: www.newrelic.com\n```\nResponse\n```\nHTTP/1.1 301 Moved Permanently\nServer: nginx\nContent-Type: application/x-msdownload\nStatus: 301 Moved Permanently\nLocation: http://newrelic.com/\n```","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eAs you are interested in any bug in rubygems.org, I thought of reporting it.\u003c/p\u003e\n\n\u003cp\u003eThe host header is not validated on rubygems.org. In many cases, developers are trusting the HTTP Host header value and using it to generate links, import scripts and even generate password resets links with its value. This is a very bad idea, because the HTTP Host header can be controlled by an attacker. This can be exploited using web-cache poisoning and by abusing alternative channels like password reset emails.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003ePOC\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eGET / HTTP/1.1\nHost: www.google.com\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eResponse\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003eHTTP/1.1 500 Domain Not Found\nServer: Varnish\nRetry-After: 0\ncontent-type: text/html\nCache-Control: private, no-cache\nconnection: keep-alive\nContent-Length: 207\nAccept-Ranges: bytes\nDate: Mon, 31 Oct 2016 07:49:14 GMT\nVia: 1.1 varnish\nConnection: close\n\n\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;title\u0026gt;\u003c/span\u003eFastly error: unknown domain www.google.com\u003cspan class=\"nt\"\u003e\u0026lt;/title\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/head\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\nFastly error: unknown domain: www.google.com. Please check that this domain has been added to a service.\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow having my malicious page hosted on fastly(example taken is \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.newrelic.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.newrelic.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e running on faslty), I can expolit the issue:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eGET / HTTP/1.1\nHost: www.newrelic.com\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eResponse\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 301 Moved Permanently\nServer: nginx\nContent-Type: application/x-msdownload\nStatus: 301 Moved Permanently\nLocation: http://newrelic.com/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","weakness":{"id":53,"name":"Open Redirect"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":132923,"file_name":"POC.JPG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/132/923/1a7c1bddb241f90e764ee6db3d2211cf2bab4b22/POC.JPG?response-content-disposition=attachment%3B%20filename%3D%22POC.JPG%22%3B%20filename%2A%3DUTF-8%27%27POC.JPG\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSUJSTWNA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044452Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDC4LZo82wc2eCvBFlhjwE027CwJoHB88%2BMK2v03JEf7AIgTsNTuR7XI5zLkpcU%2F192zliPMALv25wXWHyoW56mHW0qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDDQxd6Ep%2FudaJolhjiqRA%2FV9m3Q5qTHiEf%2B0F56QxIa0FX4xcw3kyVQ754zuEWG6%2FFHm5u50c%2FkjIZTK4iokf%2F5bg8%2F9lzPcfaf%2FlyMeeuZQiIR66c8Q0ZynlQYFFg39COCCRcmQH0rk4Py7SioeZK1WX50szdnMCAEBM0%2FYGIJRFlpJYz5%2BF7cuCEDZDVFz70QPaeLM9Aq2Hp0OWlaD%2BlKU2Ya8oXmKGTVLeV6xTf66mRdzvW8I4qKgZpByKnAcip5WWnkttPjUxPiLaEeZ%2BClnUyHZas2bB1iPmPH0rQXcKWbTOq%2BJJm8xX%2FgqtqSgjGTmncJVZJxe0UaRUPXS%2BxPh0KYERT9Te4D5sREOcmaPJ0lojWm5AuNIxK3S30FeTamdldG5jOgcjm7r6e2HjWcB7yfe4%2BCsYd2eVLbbXk95jZRHQohr%2B7Z9YEqq00TUANe07BXm%2FKoAPBMy0bYQHYmVJaGS31XhmN6DRKUn5mwwU6NQ87eIymigu48swQSaSOa0S3Ve15n99tYKCLxw%2FqcLrXK9DmAPRXyB2cTH85tpMJ7Qqv8FOusB0TY7T%2F8PPlS9Pw17cj5sLPnZSdHFb4OJ7xNuArhvZUxC%2FDdQIpfgbN40hDHy3r94ejzq63ULcWroBoxExSJ8F%2BIqLrT2jEE%2BHYV9rJ3uN20mlrWN07M1wfpVQeu7mZyiWu%2BTKEOjyLznji7d3Efn7A1SwzF%2FWi11RcA9%2BGeNTFCiOeyJRV4JWopx6NNi8TVr6hBraJmZeqXIUCIj4yW%2BvdbZ%2F7b%2BDWNq1S8BMna3Htt9r6lmeANRYdDH%2BkiA2F6n7nJrrrNm3hF7NHjHy1GdUin3XffXKseDfHdRNqxNelH1SrChi2zziLtHrQ%3D%3D\u0026X-Amz-Signature=16b2a933d65fa3a96c040863b4e244139d703ea0ead6246eeef94465407c49a5","file_size":87842,"type":"image/jpeg"}],"allow_singular_disclosure_at":null,"vote_count":2,"voters":["tushar_cyber04","armansameer"],"severity":{"rating":"low","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1284864,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for submitting this report to RubyGems. Our team will review and investigate the issue. Please note that only issues in the rubygems library are eligible for our bug bounty program.","markdown_message":"\u003cp\u003eThanks for submitting this report to RubyGems. Our team will review and investigate the issue. Please note that only issues in the rubygems library are eligible for our bug bounty program.\u003c/p\u003e\n","automated_response":true,"created_at":"2016-11-04T18:12:04.307Z","updated_at":"2016-11-04T18:12:04.307Z","actor":{"url":"/rubygems","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"RubyGems"}},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1285894,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"Thanks for your report. If you have a site hosted on Fastly, this request would actually be no different than a request to your site. Fastly uses the Host header to route to the appropriate service. There's no vulnerability here.","markdown_message":"\u003cp\u003eThanks for your report. If you have a site hosted on Fastly, this request would actually be no different than a request to your site. Fastly uses the Host header to route to the appropriate service. There\u0026#39;s no vulnerability here.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-05T14:00:43.617Z","updated_at":"2016-11-05T14:00:43.617Z","actor":{"username":"dwradcliffe","cleared":false,"url":"/dwradcliffe","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/082/355/821154e381fe27d2273bc54a18049a3a87e1591d_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1286101,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@dwradcliffe I think you have not understood my report. Actually when server receives any request it checks HOST in header to see for which site the request is coming and forwards it if the site is known. This is normal to you, however this is not considered as secured. The server should always send the request to the site/domain for which it was intended regardless of what is being sent in the HOST. If my request is going to http://rubygems.org, the response should come from rubygems.org only, no matter what is sent in HOST.\n\nHere fastly is not redirecting to newrelic, instead rubygems.org redirects user to newrelic.com. Becuase if you notice in screenshot, the connection is already established with rubygems.org.  Fastly does have some limitation, so it won't understand any domain not hosted on Fastly and redirection doen't happens.\n\nPlease read more about this issue and how it can be exploited from [here](http://www.skeletonscribe.net/2013/05/practical-http-host-header-attacks.html)","markdown_message":"\u003cp\u003e\u003ca href=\"/dwradcliffe\"\u003e@dwradcliffe\u003c/a\u003e I think you have not understood my report. Actually when server receives any request it checks HOST in header to see for which site the request is coming and forwards it if the site is known. This is normal to you, however this is not considered as secured. The server should always send the request to the site/domain for which it was intended regardless of what is being sent in the HOST. If my request is going to \u003ca title=\"http://rubygems.org\" href=\"/redirect?url=http%3A%2F%2Frubygems.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://rubygems.org\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, the response should come from rubygems.org only, no matter what is sent in HOST.\u003c/p\u003e\n\n\u003cp\u003eHere fastly is not redirecting to newrelic, instead rubygems.org redirects user to newrelic.com. Becuase if you notice in screenshot, the connection is already established with rubygems.org.  Fastly does have some limitation, so it won\u0026#39;t understand any domain not hosted on Fastly and redirection doen\u0026#39;t happens.\u003c/p\u003e\n\n\u003cp\u003ePlease read more about this issue and how it can be exploited from \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.skeletonscribe.net%2F2013%2F05%2Fpractical-http-host-header-attacks.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehere\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-05T17:04:41.040Z","updated_at":"2016-11-05T17:04:41.040Z","actor":{"username":"bugs3ra","cleared":false,"url":"/bugs3ra","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/031/877/979f1b2f975110612d4cab7336f0d594e4afb678_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1286116,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Disclosure please...","markdown_message":"\u003cp\u003eDisclosure please...\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-05T17:08:04.804Z","updated_at":"2016-11-05T17:08:04.804Z","first_to_agree":true,"actor":{"username":"bugs3ra","cleared":false,"url":"/bugs3ra","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/031/877/979f1b2f975110612d4cab7336f0d594e4afb678_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2364299,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Requesting public disclosure.  I'm aware of the article referenced and it's potential impacts.  The issue, if exploitable, would affect all users of the CDN if exploitable, and is not specific to rubygems.org.","markdown_message":"\u003cp\u003eRequesting public disclosure.  I\u0026#39;m aware of the article referenced and it\u0026#39;s potential impacts.  The issue, if exploitable, would affect all users of the CDN if exploitable, and is not specific to rubygems.org.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-08T23:10:47.485Z","updated_at":"2018-02-08T23:10:47.485Z","actor":{"username":"claudijd","cleared":false,"url":"/claudijd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/131/3c373767fbd4f34648ab754b0f692fb718bfb8e5_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2364300,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-08T23:10:47.575Z","updated_at":"2018-02-08T23:10:47.575Z","actor":{"username":"claudijd","cleared":false,"url":"/claudijd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/131/3c373767fbd4f34648ab754b0f692fb718bfb8e5_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}