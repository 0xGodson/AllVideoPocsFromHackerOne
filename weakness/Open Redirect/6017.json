{"id":6017,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82MDE3","url":"https://hackerone.com/reports/6017","title":"Facebook Takeover using Slack using 302 from files.slack.com with access_token","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-04-06T07:24:52.591Z","submitted_at":"2014-04-06T07:24:52.591Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"fransrosen","url":"/fransrosen","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":69,"url":"https://hackerone.com/slack","handle":"slack","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Slack","twitter_handle":"slackhq","website":"https://slack.com","about":"All your team communication in one place, instantly searchable, and available wherever you go."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2015-01-11T15:25:45.229Z","bug_reporter_agreed_on_going_public_at":"2014-12-12T15:25:30.102Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\r\n\r\nI noticed that your Facebook application used in the \"Import Photo\" can be used to take over the Facebook account of the user being attacked.\r\n\r\nIt's multiple issues in one:\r\n1. You have a 302 redirect from a *.slack.com domain. Hash-values will follow the redirect.\r\n2. The Facebook application OAuth settings are too weak, and a files.slack.com-URL will be accepted as the redirect_uri. You should restrict these to a www.slack.com that then redirects to the subdomain, instead of allowing all *.slack.com-subdomains, or deny the files.slack.com as a OAuth redirect-subdomain.\r\n\r\nSo, the following URL will redirect the user to files.slack.com after authentication of the app (or if the user already has it approved, no client interaction is needed):\r\n\r\nhttps://www.facebook.com/dialog/oauth?client_id=569627156411038\u0026redirect_uri=https%3A%2F%2Ffiles.slack.com%2Ffiles-pri%2FT025M9QPZ-F0283NJ20%2Fhash.swf\u0026response_type=token\u0026scope=user_photos\u0026sdk=joey\r\n\r\nI have attached POC-images showing what happens and what the Token provides as it is today (you can modify the scope, the user needs to approve it, but it still looks legit coming from Slack).\r\n\r\nRegards,\r\nFrans\r\n\r\n","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eI noticed that your Facebook application used in the \u0026quot;Import Photo\u0026quot; can be used to take over the Facebook account of the user being attacked.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026#39;s multiple issues in one:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eYou have a 302 redirect from a *.slack.com domain. Hash-values will follow the redirect.\u003c/li\u003e\n\u003cli\u003eThe Facebook application OAuth settings are too weak, and a files.slack.com-URL will be accepted as the redirect_uri. You should restrict these to a \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.slack.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.slack.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e that then redirects to the subdomain, instead of allowing all *.slack.com-subdomains, or deny the files.slack.com as a OAuth redirect-subdomain.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eSo, the following URL will redirect the user to files.slack.com after authentication of the app (or if the user already has it approved, no client interaction is needed):\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://www.facebook.com/dialog/oauth?client_id=569627156411038\u0026amp;redirect_uri=https%3A%2F%2Ffiles.slack.com%2Ffiles-pri%2FT025M9QPZ-F0283NJ20%2Fhash.swf\u0026amp;response_type=token\u0026amp;scope=user_photos\u0026amp;sdk=joey\" href=\"/redirect?url=https%3A%2F%2Fwww.facebook.com%2Fdialog%2Foauth%3Fclient_id%3D569627156411038%26redirect_uri%3Dhttps%253A%252F%252Ffiles.slack.com%252Ffiles-pri%252FT025M9QPZ-F0283NJ20%252Fhash.swf%26response_type%3Dtoken%26scope%3Duser_photos%26sdk%3Djoey\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.facebook.com/dialog/oauth?client_id=569627156411038\u0026amp;redirect_uri=https%3A%2F%2Ffiles.slack.com%2Ffiles-pri%2FT025M9QPZ-F0283NJ20%2Fhash.swf\u0026amp;response_type=token\u0026amp;scope=user_photos\u0026amp;sdk=joey\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI have attached POC-images showing what happens and what the Token provides as it is today (you can modify the scope, the user needs to approve it, but it still looks legit coming from Slack).\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nFrans\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":53,"name":"Open Redirect"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":5676,"file_name":"Screen_Shot_2014-04-06_at_09.16.07.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/005/676/601efe008c11116f86e2ba1ed125a71125ca4c9d/Screen_Shot_2014-04-06_at_09.16.07.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2014-04-06_at_09.16.07.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2014-04-06_at_09.16.07.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQS4MXLS4F%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T062935Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCdPyDr833HeXJwYpWjpt%2BE8j%2FssC2h5%2FlaE7mZngOMiQIhAIhVLq5AR6H%2BIAtKS0YClrr2gxSJzGl8%2FZmOeT68dbjNKrQDCFYQARoMMDEzNjE5Mjc0ODQ5IgyLw4q7eiVATMCuJ5oqkQNRnoM2%2F7QfXwU%2Fz3OKzDhPBavarq1CsKnppYIDxpxowNYh40iJGbW36kruwk7Up1vRvNyltjF5q8qwhzaGeQZ%2BiAxZXfxuO%2B2Kcrl44J%2BblDlgfJxT%2FhANHqEJ52YkeCqL%2F8Jog8rViNOOl6oETOov%2FmlWe%2BSn52SY6oPYBRdYu%2BBKeiMV8Z7HXhpAE7juI1J25wS6dso8QH7RSAhNGIs8Y8svP20AF0GCUvT57CvEpTEKNmlMu6qBfLwB6pdnFPVBhYyN%2FfIE4%2FQa2wOG4EtJYFQfTQjLwttTt9CYHJbPWKgJsiqZWwvzgG5RucysYaY1Dvc5h%2B9x16jomi9UPmmxblIqy%2BUz9R8kd2FgetX%2B5J5YRu%2FIt1eM4Pmo0vWG1EERVUZkvMX57A4jS5kp%2F0ojOEF2BB5VpPswd3ts8BMSrW%2BwRyh9hJwmvOT24d%2FVDV1XlH12OfiqXYDHqfINlxhQS6ahBnjyeup6YaEdMK6oUB8ZRQCgIyT6ugHXy7R98squWf9jBVCuea8OVuecORCfgjCE76r%2FBTrqAVa%2BDcEKB0%2FoTap54OIKsextuoDcyV%2B5vaIZrhq52EXThW%2BXIbAp6mSkhzoWUgjsywl0H1o%2FDaG%2BNn3BBVN%2BRn45Quca4CUlobnDZ4s%2FQCgf9Z7bonFsVRNiD0YQAXIATjx%2FHm9NSP5TZgVxAil%2FiJbzMr5CzCPucZqQZHGinQXPFIlAHaN7P8LEs1k%2BYLHWhoCxufAjr4F07sxUlcZob%2BG%2FmA%2B1KCCNdIEo%2B%2BJY954m5YuWhqgrGS3SilW7Zv%2FcvslV9aFtJ6DgZI3AgcMDa3advxrZKKcSBi8tFdkDhjvGZZWiwX118rNoAQ%3D%3D\u0026X-Amz-Signature=c4e88d6c776f2957afd7a7582b2fd540dd18334d96eaa761d78ee5422c47501e","file_size":268939,"type":"image/png"},{"id":5677,"file_name":"Screen_Shot_2014-04-06_at_09.16.24.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/005/677/e42b905a334df5ec83ea0f31d1ae6b61bdefd3f7/Screen_Shot_2014-04-06_at_09.16.24.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2014-04-06_at_09.16.24.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2014-04-06_at_09.16.24.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQS4MXLS4F%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T062935Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCdPyDr833HeXJwYpWjpt%2BE8j%2FssC2h5%2FlaE7mZngOMiQIhAIhVLq5AR6H%2BIAtKS0YClrr2gxSJzGl8%2FZmOeT68dbjNKrQDCFYQARoMMDEzNjE5Mjc0ODQ5IgyLw4q7eiVATMCuJ5oqkQNRnoM2%2F7QfXwU%2Fz3OKzDhPBavarq1CsKnppYIDxpxowNYh40iJGbW36kruwk7Up1vRvNyltjF5q8qwhzaGeQZ%2BiAxZXfxuO%2B2Kcrl44J%2BblDlgfJxT%2FhANHqEJ52YkeCqL%2F8Jog8rViNOOl6oETOov%2FmlWe%2BSn52SY6oPYBRdYu%2BBKeiMV8Z7HXhpAE7juI1J25wS6dso8QH7RSAhNGIs8Y8svP20AF0GCUvT57CvEpTEKNmlMu6qBfLwB6pdnFPVBhYyN%2FfIE4%2FQa2wOG4EtJYFQfTQjLwttTt9CYHJbPWKgJsiqZWwvzgG5RucysYaY1Dvc5h%2B9x16jomi9UPmmxblIqy%2BUz9R8kd2FgetX%2B5J5YRu%2FIt1eM4Pmo0vWG1EERVUZkvMX57A4jS5kp%2F0ojOEF2BB5VpPswd3ts8BMSrW%2BwRyh9hJwmvOT24d%2FVDV1XlH12OfiqXYDHqfINlxhQS6ahBnjyeup6YaEdMK6oUB8ZRQCgIyT6ugHXy7R98squWf9jBVCuea8OVuecORCfgjCE76r%2FBTrqAVa%2BDcEKB0%2FoTap54OIKsextuoDcyV%2B5vaIZrhq52EXThW%2BXIbAp6mSkhzoWUgjsywl0H1o%2FDaG%2BNn3BBVN%2BRn45Quca4CUlobnDZ4s%2FQCgf9Z7bonFsVRNiD0YQAXIATjx%2FHm9NSP5TZgVxAil%2FiJbzMr5CzCPucZqQZHGinQXPFIlAHaN7P8LEs1k%2BYLHWhoCxufAjr4F07sxUlcZob%2BG%2FmA%2B1KCCNdIEo%2B%2BJY954m5YuWhqgrGS3SilW7Zv%2FcvslV9aFtJ6DgZI3AgcMDa3advxrZKKcSBi8tFdkDhjvGZZWiwX118rNoAQ%3D%3D\u0026X-Amz-Signature=a9ca6c95a3b98a7c9731f435a385a03797c29e37a222112f1ff838aa2005d6a9","file_size":43284,"type":"image/png"}],"allow_singular_disclosure_at":"2015-01-11T15:25:30.532Z","allow_singular_disclosure_after":-188233445.4554954,"singular_disclosure_allowed":true,"vote_count":10,"voters":["sw33tlie","michiel","tosun","samet","r3y","d3f4u17","japz","spetr0x","0619","victory10"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":24692,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi again,\n\nOne simple solution which I think would work is to modify the redirect from files.slack.com:\n\nlocation:https://slack-files.com/files-pri-safe/T025M9QPZ-F0283NJ20/hash.swf?c=1396769705-f034ef9e2f4301fd2dd339b9ac42dd7148c8effe\n\nSo it's actually will reset the hash:\n\nlocation:https://slack-files.com/files-pri-safe/T025M9QPZ-F0283NJ20/hash.swf?c=1396769705-f034ef9e2f4301fd2dd339b9ac42dd7148c8effe#_=_\n\nBut I guess that needs to be tested so it works, but that's a solution that would do so no access_token is transferred over to files.slack.com\n\nRegards,\nFrans","markdown_message":"\u003cp\u003eHi again,\u003c/p\u003e\n\n\u003cp\u003eOne simple solution which I think would work is to modify the redirect from files.slack.com:\u003c/p\u003e\n\n\u003cp\u003elocation:\u003ca title=\"https://slack-files.com/files-pri-safe/T025M9QPZ-F0283NJ20/hash.swf?c=1396769705-f034ef9e2f4301fd2dd339b9ac42dd7148c8effe\" href=\"/redirect?url=https%3A%2F%2Fslack-files.com%2Ffiles-pri-safe%2FT025M9QPZ-F0283NJ20%2Fhash.swf%3Fc%3D1396769705-f034ef9e2f4301fd2dd339b9ac42dd7148c8effe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://slack-files.com/files-pri-safe/T025M9QPZ-F0283NJ20/hash.swf?c=1396769705-f034ef9e2f4301fd2dd339b9ac42dd7148c8effe\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSo it\u0026#39;s actually will reset the hash:\u003c/p\u003e\n\n\u003cp\u003elocation:\u003ca title=\"https://slack-files.com/files-pri-safe/T025M9QPZ-F0283NJ20/hash.swf?c=1396769705-f034ef9e2f4301fd2dd339b9ac42dd7148c8effe#_=_\" href=\"/redirect?url=https%3A%2F%2Fslack-files.com%2Ffiles-pri-safe%2FT025M9QPZ-F0283NJ20%2Fhash.swf%3Fc%3D1396769705-f034ef9e2f4301fd2dd339b9ac42dd7148c8effe%23_%3D_\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://slack-files.com/files-pri-safe/T025M9QPZ-F0283NJ20/hash.swf?c=1396769705-f034ef9e2f4301fd2dd339b9ac42dd7148c8effe#_=_\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eBut I guess that needs to be tested so it works, but that\u0026#39;s a solution that would do so no access_token is transferred over to files.slack.com\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nFrans\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-06T07:36:30.479Z","updated_at":"2014-04-06T07:36:30.479Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":24696,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here's some good info (some browsers did not support 302 with fragment in url):\nhttp://stackoverflow.com/a/2305927\n\n/F","markdown_message":"\u003cp\u003eHere\u0026#39;s some good info (some browsers did not support 302 with fragment in url):\u003cbr\u003e\n\u003ca title=\"http://stackoverflow.com/a/2305927\" href=\"/redirect?url=http%3A%2F%2Fstackoverflow.com%2Fa%2F2305927\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://stackoverflow.com/a/2305927\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e/F\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-06T07:53:52.123Z","updated_at":"2014-04-06T07:53:52.123Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":25446,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Good find. This one is tough to fix, since:\n\n* Facebook doesn't let you specify URLs *not* to allow\n* Facebook appears to always allow subdomains for OAuth\n* Browsers don't reliably allow stripping of fragments on redirect\n\nThis requires some investigation","markdown_message":"\u003cp\u003eGood find. This one is tough to fix, since:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eFacebook doesn\u0026#39;t let you specify URLs \u003cem\u003enot\u003c/em\u003e to allow\u003c/li\u003e\n\u003cli\u003eFacebook appears to always allow subdomains for OAuth\u003c/li\u003e\n\u003cli\u003eBrowsers don\u0026#39;t reliably allow stripping of fragments on redirect\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThis requires some investigation\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-07T18:13:33.257Z","updated_at":"2014-04-07T18:13:33.257Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":25448,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2014-04-07T18:14:16.625Z","updated_at":"2014-04-07T18:14:16.625Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":38369,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey,\nNoticed that this was still vulnerable, I checked your list on the issues, and number 2 is actually fixable, you can force it to only allow one subdomain, like www.slack.com or something, and tunnel it through it, that would fix it. By setting the domain to slack.com only in Facebook will allow *.slack.com but setting it to www.slack.com will fix that.\n\nHope that helps,\n\nRegards,\nFrans","markdown_message":"\u003cp\u003eHey,\u003cbr\u003e\nNoticed that this was still vulnerable, I checked your list on the issues, and number 2 is actually fixable, you can force it to only allow one subdomain, like \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.slack.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.slack.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e or something, and tunnel it through it, that would fix it. By setting the domain to slack.com only in Facebook will allow *.slack.com but setting it to \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.slack.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.slack.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e will fix that.\u003c/p\u003e\n\n\u003cp\u003eHope that helps,\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nFrans\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-24T22:34:25.663Z","updated_at":"2014-04-24T22:34:25.663Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":40748,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Good idea for a fix - thanks","markdown_message":"\u003cp\u003eGood idea for a fix - thanks\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-28T20:29:09.716Z","updated_at":"2014-04-28T20:29:09.716Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":51640,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi again,\n\nNoticed that there was a wontfix for the link?url=xxx on another report that was publicly posted yesterday, this however, makes my vulnerability above global for all users on Slack.\n\nhttps://www.facebook.com/dialog/oauth?client_id=569627156411038\u0026redirect_uri=https%3A%2F%2Fslack.com%2Flink%3furl%3Dhttp%3A%2F%2Fwww.detectify.com\u0026response_type=token\u0026scope=user_photos\u0026sdk=joey\n\nAs soon as someone using slack visits that link, token is sent to me. Game over... I would escalate to fix this issue much more now as the link-url is now publicly posted on the Wont-fix-report.\n\nCheers,\nFrans","markdown_message":"\u003cp\u003eHi again,\u003c/p\u003e\n\n\u003cp\u003eNoticed that there was a wontfix for the link?url=xxx on another report that was publicly posted yesterday, this however, makes my vulnerability above global for all users on Slack.\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://www.facebook.com/dialog/oauth?client_id=569627156411038\u0026amp;redirect_uri=https%3A%2F%2Fslack.com%2Flink%3furl%3Dhttp%3A%2F%2Fwww.detectify.com\u0026amp;response_type=token\u0026amp;scope=user_photos\u0026amp;sdk=joey\" href=\"/redirect?url=https%3A%2F%2Fwww.facebook.com%2Fdialog%2Foauth%3Fclient_id%3D569627156411038%26redirect_uri%3Dhttps%253A%252F%252Fslack.com%252Flink%253furl%253Dhttp%253A%252F%252Fwww.detectify.com%26response_type%3Dtoken%26scope%3Duser_photos%26sdk%3Djoey\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.facebook.com/dialog/oauth?client_id=569627156411038\u0026amp;redirect_uri=https%3A%2F%2Fslack.com%2Flink%3furl%3Dhttp%3A%2F%2Fwww.detectify.com\u0026amp;response_type=token\u0026amp;scope=user_photos\u0026amp;sdk=joey\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAs soon as someone using slack visits that link, token is sent to me. Game over... I would escalate to fix this issue much more now as the link-url is now publicly posted on the Wont-fix-report.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nFrans\u003c/p\u003e\n","automated_response":false,"created_at":"2014-05-15T14:07:15.705Z","updated_at":"2014-05-15T14:07:15.705Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":52587,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I agree this is pretty high priority, but I can't figure out how to fix it. We never pass a redirect URI of any kind to Facebook - we're just using the JavaScript SDK and it's doing some secret black box magic. I can't find any documentation on how to configure this or if it's even possible. It looks like we might need to stop using the JavaScript SDK completely and move to a full manual OAuth flow.","markdown_message":"\u003cp\u003eI agree this is pretty high priority, but I can\u0026#39;t figure out how to fix it. We never pass a redirect URI of any kind to Facebook - we\u0026#39;re just using the JavaScript SDK and it\u0026#39;s doing some secret black box magic. I can\u0026#39;t find any documentation on how to configure this or if it\u0026#39;s even possible. It looks like we might need to stop using the JavaScript SDK completely and move to a full manual OAuth flow.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-05-16T22:00:49.286Z","updated_at":"2014-05-16T22:00:49.286Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":54337,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the info Cal, I've reported this to Facebook as I believe the combination of JS SDK and dynamic subdomains creates a non-patchable issue here, which does not makes sense. I suggested a solution where you're able to restrict your app to JS SDK only so the redirect_uri cannot be anything else than Facebooks xd_arbiter.js.\n\nWe'll see what happens there. I think the answer will be a Wontfix to them as the dynamic subdomains (which are added to the request since the page using the JS SDK is on *.slack.com) is the anti pattern according to Facebook. \n\nOne solution would be to host the Facebook-JS on //slack.com which are then utlized by *.slack.com, that would make it possible for you to add a whitelist-redirect_uri on //slack.com so nothing more than JS SDK and that redirect_uri (which then would be something like https://slack.com/404). But that would require you to move out the FB.init code to some sort of iframe-proxy or something, which is pretty ugly.\n\nAnyway, let's see what happens. I'll be in touch.\n\nRegards,\nFrans","markdown_message":"\u003cp\u003eThanks for the info Cal, I\u0026#39;ve reported this to Facebook as I believe the combination of JS SDK and dynamic subdomains creates a non-patchable issue here, which does not makes sense. I suggested a solution where you\u0026#39;re able to restrict your app to JS SDK only so the redirect_uri cannot be anything else than Facebooks xd_arbiter.js.\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;ll see what happens there. I think the answer will be a Wontfix to them as the dynamic subdomains (which are added to the request since the page using the JS SDK is on *.slack.com) is the anti pattern according to Facebook. \u003c/p\u003e\n\n\u003cp\u003eOne solution would be to host the Facebook-JS on //slack.com which are then utlized by *.slack.com, that would make it possible for you to add a whitelist-redirect_uri on //slack.com so nothing more than JS SDK and that redirect_uri (which then would be something like \u003ca title=\"https://slack.com/404\" href=\"/redirect?url=https%3A%2F%2Fslack.com%2F404\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://slack.com/404\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e). But that would require you to move out the FB.init code to some sort of iframe-proxy or something, which is pretty ugly.\u003c/p\u003e\n\n\u003cp\u003eAnyway, let\u0026#39;s see what happens. I\u0026#39;ll be in touch.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nFrans\u003c/p\u003e\n","automated_response":false,"created_at":"2014-05-20T20:57:01.063Z","updated_at":"2014-05-20T20:57:01.063Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":54437,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks!","markdown_message":"\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2014-05-20T23:08:58.512Z","updated_at":"2014-05-20T23:08:58.512Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":67024,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Cal,\n\nI've got an answer from Facebook today, and it's the thing I believed should be the answer. TL;DR, you need to implement the real OAuth-flow when you're dealing with unlimited subdomains. The JS-SDK is impossible to secure when you do not have control over your subdomains.\n\nHere's their answer:\n\n\u003e Hi Frans,\n\u003e \n\u003e The platform engineers I talked to agreed that the situation you laid out (using the JS SDK for a single app on unlimited subdomains without enabling other forms of client auth) isn't well-supported by our current set of configuration settings:\n\u003e \n\u003e - Turning off client-auth also turns off the JS SDK (since it uses an access token)\n\u003e - As you pointed out, adding an explicit OAuth redirect URI works if you have a single domain or a known set of subdomains but not with an unlimited number.\n\u003e \n\u003e At this point there are not any plans to support keeping the JS SDK enabled while disabling other forms of client-auth. In cases where you need to support an unlimited number of subdomains, our recommendation is to use the explicit/code flow, which gives you more control over the application and its interaction with Facebook. You can define a single OAuth redirect endpoint and redirect from there to the appropriate subdomain-specific endpoint.\n\u003e \n\u003e Please let me know if you have any additional questions!\n\u003e \n\u003e Thanks,\n\u003e \n\u003e Neal\n\u003e Security\n\u003e Facebook\n\nRegards,\nFrans","markdown_message":"\u003cp\u003eHi Cal,\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve got an answer from Facebook today, and it\u0026#39;s the thing I believed should be the answer. TL;DR, you need to implement the real OAuth-flow when you\u0026#39;re dealing with unlimited subdomains. The JS-SDK is impossible to secure when you do not have control over your subdomains.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026#39;s their answer:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eHi Frans,\u003c/p\u003e\n\n\u003cp\u003eThe platform engineers I talked to agreed that the situation you laid out (using the JS SDK for a single app on unlimited subdomains without enabling other forms of client auth) isn\u0026#39;t well-supported by our current set of configuration settings:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eTurning off client-auth also turns off the JS SDK (since it uses an access token)\u003c/li\u003e\n\u003cli\u003eAs you pointed out, adding an explicit OAuth redirect URI works if you have a single domain or a known set of subdomains but not with an unlimited number.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAt this point there are not any plans to support keeping the JS SDK enabled while disabling other forms of client-auth. In cases where you need to support an unlimited number of subdomains, our recommendation is to use the explicit/code flow, which gives you more control over the application and its interaction with Facebook. You can define a single OAuth redirect endpoint and redirect from there to the appropriate subdomain-specific endpoint.\u003c/p\u003e\n\n\u003cp\u003ePlease let me know if you have any additional questions!\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003c/p\u003e\n\n\u003cp\u003eNeal\u003cbr\u003e\nSecurity\u003cbr\u003e\nFacebook\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nFrans\u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-05T07:30:15.236Z","updated_at":"2014-06-05T07:30:15.236Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":67559,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for figuring this out!","markdown_message":"\u003cp\u003eThanks for figuring this out!\u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-05T21:29:00.828Z","updated_at":"2014-06-05T21:29:00.828Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":177122,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for reporting this (and the followup). Much appreciated!","markdown_message":"\u003cp\u003eThanks again for reporting this (and the followup). Much appreciated!\u003c/p\u003e\n","automated_response":false,"created_at":"2014-12-12T05:40:23.994Z","updated_at":"2014-12-12T05:40:23.994Z","actor":{"username":"rhuber","cleared":false,"url":"/rhuber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"fransrosen","url":"/fransrosen"},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":177123,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2014-12-12T05:41:08.266Z","updated_at":"2014-12-12T05:41:08.266Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Slack"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"slack","collaborator":{"username":"fransrosen","url":"/fransrosen"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":177149,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks! I believe you got a few dupes on this report during this time. :) Is it completely solved now? Would you mind if I make the report public?\nThanks again,\nFrans","markdown_message":"\u003cp\u003eThanks! I believe you got a few dupes on this report during this time. :) Is it completely solved now? Would you mind if I make the report public?\u003cbr\u003e\nThanks again,\u003cbr\u003e\nFrans\u003c/p\u003e\n","automated_response":false,"created_at":"2014-12-12T07:45:58.540Z","updated_at":"2014-12-12T07:45:58.540Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":177331,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-12-12T15:25:30.117Z","updated_at":"2014-12-12T15:25:30.117Z","first_to_agree":true,"actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":308432,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-01-11T15:25:45.604Z","updated_at":"2015-01-11T15:25:45.604Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}