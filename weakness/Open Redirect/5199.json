{"id":5199,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MTk5","url":"https://hackerone.com/reports/5199","title":"Improper Validation of the Referrer header leading to Open URL Redirection","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2014-03-29T23:54:06.996Z","submitted_at":"2014-03-29T23:54:06.996Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"anshuman_bh","url":"/anshuman_bh","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/274/e61ac38cffc356f9d4531f8581e62fd4b6603c67_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":104,"url":"https://hackerone.com/coinbase","handle":"coinbase","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Coinbase","twitter_handle":"","website":"https://coinbase.com/security","about":"Creating an open financial system for the world"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2014-04-29T21:42:33.343Z","bug_reporter_agreed_on_going_public_at":"2014-03-31T01:11:43.928Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Using a proxy tool such as Burp, set the Target as https://coinbase.com.\r\nThen, send the following request:\r\n\r\nGET /cdn-cgi/l/chk_jschl HTTP/1.1\r\nHost: coinbase.com\r\nReferer: http://attacker.com\r\nContent-Length: 2\r\n\r\nNotice the attacker's domain in the Referrer header. This value is not being validated on the server side and as a result, the user is redirected to http://www.attacker.com\r\n\r\nAttack Scenario:\r\n1. An attacker hosts his own website www.attacker.com.\r\n2. He has a link on this website https://coinbase.com/cdn-cgi/l/chk_jschl.\r\n3. The attacker tricks a legitimate coinbase user to click on this link.\r\n4. When the user clicks on the link, he gets redirected to the attacker controlled website.\r\n5. Now, if the coinbase user is authenticated to the coinbase website in the same browser, all the cookies from the browser are sent to the attacker controlled website.\r\n6. The attacker now has access to the user's session cookies which he can use to impersonate the coinbase user and take complete control over the user's account.","vulnerability_information_html":"\u003cp\u003eUsing a proxy tool such as Burp, set the Target as \u003ca title=\"https://coinbase.com\" href=\"/redirect?url=https%3A%2F%2Fcoinbase.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://coinbase.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003cbr\u003e\nThen, send the following request:\u003c/p\u003e\n\n\u003cp\u003eGET /cdn-cgi/l/chk_jschl HTTP/1.1\u003cbr\u003e\nHost: coinbase.com\u003cbr\u003e\nReferer: \u003ca title=\"http://attacker.com\" href=\"/redirect?url=http%3A%2F%2Fattacker.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://attacker.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nContent-Length: 2\u003c/p\u003e\n\n\u003cp\u003eNotice the attacker\u0026#39;s domain in the Referrer header. This value is not being validated on the server side and as a result, the user is redirected to \u003ca title=\"http://www.attacker.com\" href=\"/redirect?url=http%3A%2F%2Fwww.attacker.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.attacker.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAttack Scenario:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAn attacker hosts his own website \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.attacker.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.attacker.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eHe has a link on this website \u003ca title=\"https://coinbase.com/cdn-cgi/l/chk_jschl\" href=\"/redirect?url=https%3A%2F%2Fcoinbase.com%2Fcdn-cgi%2Fl%2Fchk_jschl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://coinbase.com/cdn-cgi/l/chk_jschl\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eThe attacker tricks a legitimate coinbase user to click on this link.\u003c/li\u003e\n\u003cli\u003eWhen the user clicks on the link, he gets redirected to the attacker controlled website.\u003c/li\u003e\n\u003cli\u003eNow, if the coinbase user is authenticated to the coinbase website in the same browser, all the cookies from the browser are sent to the attacker controlled website.\u003c/li\u003e\n\u003cli\u003eThe attacker now has access to the user\u0026#39;s session cookies which he can use to impersonate the coinbase user and take complete control over the user\u0026#39;s account.\u003c/li\u003e\n\u003c/ol\u003e\n","weakness":{"id":53,"name":"Open Redirect"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":5084,"file_name":"Screen_Shot_2014-03-29_at_7.51.28_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/005/084/fe516b9703b9c54db4fd43bb22798073f492beaa/Screen_Shot_2014-03-29_at_7.51.28_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2014-03-29_at_7.51.28_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2014-03-29_at_7.51.28_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ3Q6GNRX4%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T061415Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIB%2F4DOSXz4Uk7JQqVyIKOhXYFqWTxcD44Z3HdHcn0dvKAiEA3PYdLzeI5Kv3E9WFbSVqd%2BUBlw0212Xg7H3tNiixN5gqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDIUObNP5fEX8bJXBsSqRA%2BL7Z0plmhSxsMHnrb83ftPuhWkgvNoQbpQ66ErJF8Tab4HbvnqeuplpQgE7hhKtqBYOEsdafEq0r9zNmqA7m92b%2BxDq63GNbNVm2hS%2FrGlDOjkNPC4s9Y9jvsKbOyEaodYyGTaNp7nXzoPtsVsXWu3VzjV5rY1%2FOniQ2%2B1s8ySEdTjZaRHk8P%2FwXbNfsl1hT2TAe2rleD%2BZ%2BVAaUzHyFNU%2F1mQkQNOozyUs%2B0kWyLXo4oDuk2v6G%2B%2B%2BOffGDFiu%2F5vFGTwCcw9LcpG50TBnwx2MYUfVFlGDhzFRqqeFnE8%2BVLdMRhVxgbXYhePjinuq12WCpDVAhCJNj8IR3wEJ1%2FQoonHq3u3s4Fjef1%2Bw%2BXtypskg56dqBrrGLe95zM0RechJC4u4kZN3x7RKFnUe%2BQTgA2fsU4g%2FeYbY51bNGPKZw3ELWdMZpvEwvawS7vQJcERLBBN%2FFBpdyPI7tU9GTieNVwCAMdziMkUN3bUc%2BsG8%2BbAIpsp1R0fqA4Zzh1fBBmHnAwvAA0nggtgLe0MkU7v1MNiFq%2F8FOusBRvYvRZdkMedUg2M4tNHIP5rUiGXbyy3g4wRqI3QxmX%2FtfXzpLdSUg3BMdPDmPj8jrIy0bzAIMzEhANIb5ri2Nz0%2FfFqmnJ3rjk8e005Fnv5uK088J0m7HFCYIe7hgj40pmM5UNmkGs30hxAnycAlyRaDL94ttdw5SqAS%2FW4MMrRVIliym5o9kruL0SoyWZC0kQciksSypgYXswzm%2BAeZve49Cnzr6ikwTN3S7tncfj0WMJznDG890QvBL3O7QjntIQ6Hf9oANAQjphy38wZSi3%2FB45i5bX5Kr2E9NKFLEy5UWui5G%2BmfVfaVyg%3D%3D\u0026X-Amz-Signature=fde370a62b7e8ab9693fc0959eba41c671c6458fae8468d4046490c633210b65","file_size":80398,"type":"image/png"},{"id":5085,"file_name":"Screen_Shot_2014-03-29_at_7.51.42_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/005/085/a4d1011a3e42d98398bfcb67b9fe70705c285253/Screen_Shot_2014-03-29_at_7.51.42_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2014-03-29_at_7.51.42_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2014-03-29_at_7.51.42_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ3Q6GNRX4%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T061415Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIB%2F4DOSXz4Uk7JQqVyIKOhXYFqWTxcD44Z3HdHcn0dvKAiEA3PYdLzeI5Kv3E9WFbSVqd%2BUBlw0212Xg7H3tNiixN5gqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDIUObNP5fEX8bJXBsSqRA%2BL7Z0plmhSxsMHnrb83ftPuhWkgvNoQbpQ66ErJF8Tab4HbvnqeuplpQgE7hhKtqBYOEsdafEq0r9zNmqA7m92b%2BxDq63GNbNVm2hS%2FrGlDOjkNPC4s9Y9jvsKbOyEaodYyGTaNp7nXzoPtsVsXWu3VzjV5rY1%2FOniQ2%2B1s8ySEdTjZaRHk8P%2FwXbNfsl1hT2TAe2rleD%2BZ%2BVAaUzHyFNU%2F1mQkQNOozyUs%2B0kWyLXo4oDuk2v6G%2B%2B%2BOffGDFiu%2F5vFGTwCcw9LcpG50TBnwx2MYUfVFlGDhzFRqqeFnE8%2BVLdMRhVxgbXYhePjinuq12WCpDVAhCJNj8IR3wEJ1%2FQoonHq3u3s4Fjef1%2Bw%2BXtypskg56dqBrrGLe95zM0RechJC4u4kZN3x7RKFnUe%2BQTgA2fsU4g%2FeYbY51bNGPKZw3ELWdMZpvEwvawS7vQJcERLBBN%2FFBpdyPI7tU9GTieNVwCAMdziMkUN3bUc%2BsG8%2BbAIpsp1R0fqA4Zzh1fBBmHnAwvAA0nggtgLe0MkU7v1MNiFq%2F8FOusBRvYvRZdkMedUg2M4tNHIP5rUiGXbyy3g4wRqI3QxmX%2FtfXzpLdSUg3BMdPDmPj8jrIy0bzAIMzEhANIb5ri2Nz0%2FfFqmnJ3rjk8e005Fnv5uK088J0m7HFCYIe7hgj40pmM5UNmkGs30hxAnycAlyRaDL94ttdw5SqAS%2FW4MMrRVIliym5o9kruL0SoyWZC0kQciksSypgYXswzm%2BAeZve49Cnzr6ikwTN3S7tncfj0WMJznDG890QvBL3O7QjntIQ6Hf9oANAQjphy38wZSi3%2FB45i5bX5Kr2E9NKFLEy5UWui5G%2BmfVfaVyg%3D%3D\u0026X-Amz-Signature=6a89a8a2dcded423ef608f15980a07b98754ec2b717b259e703e4954439685fb","file_size":98408,"type":"image/png"}],"allow_singular_disclosure_at":"2014-04-29T21:42:20.013Z","allow_singular_disclosure_after":-210414715.29589337,"singular_disclosure_allowed":true,"vote_count":1,"voters":["spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":21401,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Hi abhariya - \n\nThanks for the submission. This is a behavior of most large hosts like Cloudflare and CDN's and a known behavior. The host header is needed by these services to determine content to send back to the client. If  an attacker was able to position themselves as you have, then they'd be able to accomplish much more dangerous attacks than changing the host header.","markdown_message":"\u003cp\u003eHi abhariya - \u003c/p\u003e\n\n\u003cp\u003eThanks for the submission. This is a behavior of most large hosts like Cloudflare and CDN\u0026#39;s and a known behavior. The host header is needed by these services to determine content to send back to the client. If  an attacker was able to position themselves as you have, then they\u0026#39;d be able to accomplish much more dangerous attacks than changing the host header.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-30T21:42:20.108Z","updated_at":"2014-03-30T21:42:20.108Z","actor":{"username":"magoo","cleared":false,"url":"/magoo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/044/c5a0272bf5bace329125da5217384d22c444edb3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":21404,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ryan - you mean the Referer? I didn't do anything with the Host header. ","markdown_message":"\u003cp\u003eRyan - you mean the Referer? I didn\u0026#39;t do anything with the Host header. \u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-30T21:48:10.692Z","updated_at":"2014-03-30T21:48:10.692Z","actor":{"username":"anshuman_bh","cleared":true,"url":"/anshuman_bh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/274/e61ac38cffc356f9d4531f8581e62fd4b6603c67_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":21424,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-03-31T01:11:43.946Z","updated_at":"2014-03-31T01:11:43.946Z","actor":{"username":"anshuman_bh","cleared":true,"url":"/anshuman_bh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/274/e61ac38cffc356f9d4531f8581e62fd4b6603c67_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":41739,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-04-29T21:42:33.379Z","updated_at":"2014-04-29T21:42:33.379Z","actor":{"url":"/coinbase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Coinbase"}},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":49092,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just an FYI - The behavior your browser is exhibiting violates the Same Origin policy, so we are assuming you are using the repeater feature in Burp which is forcing your browser to send cookies to the incorrect domain. :)","markdown_message":"\u003cp\u003eJust an FYI - The behavior your browser is exhibiting violates the Same Origin policy, so we are assuming you are using the repeater feature in Burp which is forcing your browser to send cookies to the incorrect domain. :)\u003c/p\u003e\n","automated_response":false,"created_at":"2014-05-12T13:23:46.661Z","updated_at":"2014-05-12T13:23:46.661Z","actor":{"username":"magoo","cleared":false,"url":"/magoo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/044/c5a0272bf5bace329125da5217384d22c444edb3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":596599,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","markdown_message":"","automated_response":false,"created_at":"2015-09-23T19:28:03.958Z","updated_at":"2015-09-23T19:28:03.958Z","additional_data":{"duplicate_report_id":90224},"actor":{"username":"souicat007","cleared":false,"url":"/souicat007","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":596601,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Would they fix this?","markdown_message":"\u003cp\u003eWould they fix this?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-23T19:29:34.785Z","updated_at":"2015-09-23T19:29:34.785Z","actor":{"username":"souicat007","cleared":false,"url":"/souicat007","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":599292,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I am not sure whether they would fix this or not but the SOP doesn't apply to cookies as mentioned by @magoo above. See http://www.kb.cert.org/vuls/id/804060. And, I didn't want to argue this any further so I left this as it is.","markdown_message":"\u003cp\u003eI am not sure whether they would fix this or not but the SOP doesn\u0026#39;t apply to cookies as mentioned by \u003ca href=\"/magoo\"\u003e@magoo\u003c/a\u003e above. See \u003ca title=\"http://www.kb.cert.org/vuls/id/804060\" href=\"/redirect?url=http%3A%2F%2Fwww.kb.cert.org%2Fvuls%2Fid%2F804060\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.kb.cert.org/vuls/id/804060\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. And, I didn\u0026#39;t want to argue this any further so I left this as it is.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-26T18:19:58.992Z","updated_at":"2015-09-26T18:19:58.992Z","actor":{"username":"anshuman_bh","cleared":true,"url":"/anshuman_bh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/274/e61ac38cffc356f9d4531f8581e62fd4b6603c67_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}