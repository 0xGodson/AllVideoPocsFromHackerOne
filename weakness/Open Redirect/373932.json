{"id":373932,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNzM5MzI=","url":"https://hackerone.com/reports/373932","title":"Open redirect in Serendipity (exit.php)","state":"Closed","substate":"duplicate","severity_rating":"none","readable_substate":"Duplicate","created_at":"2018-06-29T14:17:49.624Z","submitted_at":"2018-06-29T14:17:49.624Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"oreamnos","url":"/oreamnos","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/178/427/1f5f5e51101ffa57eab64523a8b1fe4e75aee36c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":30278,"url":"https://hackerone.com/hannob","handle":"hannob","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/030/278/97035f061f6de55a9362b39edae4f5948bda6735_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/030/278/97035f061f6de55a9362b39edae4f5948bda6735_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Hanno's projects","twitter_handle":"hanno","website":"https://hboeck.de/","about":"Personal web projects from Hanno Böck."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-11-09T14:53:43.894Z","bug_reporter_agreed_on_going_public_at":"2018-11-09T14:45:34.205Z","team_member_agreed_on_going_public_at":"2018-11-09T14:53:43.846Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary\n\nSerendipity contains a script named `exit.php` that can be directly accessed. When crafting an hyperlink pointing to this page with the parameter `url` containing a base64-encoded  URL, it will redirect the user to this URL.\n\n## Description\n\nThe file `exit.php` contains the following code:\n\n```php\n\u003c?php\n// [...]\nif (isset($_GET['url_id']) \u0026\u0026 !empty($_GET['url_id']) \u0026\u0026 isset($_GET['entry_id']) \u0026\u0026 !empty($_GET['entry_id'])) {\n// [...]\n} elseif (isset($_GET['url']) \u0026\u0026 !empty($_GET['url'])) {\n    // No entry-link ID was submitted. Possibly a spammer tried to mis-use the script to get into the top-list.\n    $url = strip_tags(str_replace('\u0026amp;', '\u0026', base64_decode($_GET['url'])));\n}\n\nif (serendipity_isResponseClean($url)) {\n    header('HTTP/1.0 301 Moved Permanently');\n    header('Status: 301 Moved Permanently');\n    header('Location: ' . $url);\n}\n```\n\nThe interesting part is the handling of `$_GET['url']`. The function `serendipity_isResponseClean()` tries to prevent response splitting issues but does not validate the hostname of the URL where the user is redirected to. \n\n## Steps To Reproduce\n\n1. Access https://blog.fuzzing-project.org/exit.php?url=aHR0cHM6Ly9nb29nbGUuY29t with a browser;\n1. Notice that the `Location` header of the response contains an arbitrary URL (here, https://google.com).\n\n## Impact\n\nAn attacker can craft an hyperlink pointing to https://blog.fuzzing-project.org that, once accessed, will redirect the victim to an arbitrary URL.","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003eSerendipity contains a script named \u003ccode\u003eexit.php\u003c/code\u003e that can be directly accessed. When crafting an hyperlink pointing to this page with the parameter \u003ccode\u003eurl\u003c/code\u003e containing a base64-encoded  URL, it will redirect the user to this URL.\u003c/p\u003e\n\n\u003ch2 id=\"description\"\u003e Description\u003c/h2\u003e\n\n\u003cp\u003eThe file \u003ccode\u003eexit.php\u003c/code\u003e contains the following code:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// [...]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eisset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;url_id\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;url_id\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003eisset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;entry_id\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;entry_id\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// [...]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelseif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eisset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;url\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;url\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// No entry-link ID was submitted. Possibly a spammer tried to mis-use the script to get into the top-list.\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$url\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003estrip_tags\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026amp;amp;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026amp;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003ebase64_decode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;url\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e])));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eserendipity_isResponseClean\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$url\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;HTTP/1.0 301 Moved Permanently\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Status: 301 Moved Permanently\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Location: \u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nv\"\u003e$url\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe interesting part is the handling of \u003ccode\u003e$_GET[\u0026#39;url\u0026#39;]\u003c/code\u003e. The function \u003ccode\u003eserendipity_isResponseClean()\u003c/code\u003e tries to prevent response splitting issues but does not validate the hostname of the URL where the user is redirected to. \u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eAccess \u003ca title=\"https://blog.fuzzing-project.org/exit.php?url=aHR0cHM6Ly9nb29nbGUuY29t\" href=\"/redirect?url=https%3A%2F%2Fblog.fuzzing-project.org%2Fexit.php%3Furl%3DaHR0cHM6Ly9nb29nbGUuY29t\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://blog.fuzzing-project.org/exit.php?url=aHR0cHM6Ly9nb29nbGUuY29t\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e with a browser;\u003c/li\u003e\n\u003cli\u003eNotice that the \u003ccode\u003eLocation\u003c/code\u003e header of the response contains an arbitrary URL (here, \u003ca title=\"https://google.com\" href=\"/redirect?url=https%3A%2F%2Fgoogle.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://google.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e).\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAn attacker can craft an hyperlink pointing to \u003ca title=\"https://blog.fuzzing-project.org\" href=\"/redirect?url=https%3A%2F%2Fblog.fuzzing-project.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://blog.fuzzing-project.org\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e that, once accessed, will redirect the victim to an arbitrary URL.\u003c/p\u003e\n","weakness":{"id":53,"name":"Open Redirect"},"original_report_id":373916,"original_report_url":"https://hackerone.com/reports/373916","attachments":[],"allow_singular_disclosure_at":null,"vote_count":2,"voters":["eveeez","moonless"],"severity":{"rating":"none","author_type":"User"},"structured_scope":{"databaseId":11140,"asset_type":"URL","asset_identifier":"*.fuzzing-project.org","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2959432,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Thanks, the same issue has already been reported by another person. I have reported it to serendipity and will update you about the result.","markdown_message":"\u003cp\u003eThanks, the same issue has already been reported by another person. I have reported it to serendipity and will update you about the result.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-29T16:19:44.701Z","updated_at":"2018-06-29T16:19:44.701Z","original_report_id":373916,"actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3617269,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-09T14:45:34.231Z","updated_at":"2018-11-09T14:45:34.231Z","first_to_agree":true,"actor":{"username":"oreamnos","cleared":false,"url":"/oreamnos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/178/427/1f5f5e51101ffa57eab64523a8b1fe4e75aee36c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3617305,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-09T14:53:43.872Z","updated_at":"2018-11-09T14:53:43.872Z","actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3617306,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-09T14:53:43.913Z","updated_at":"2018-11-09T14:53:43.913Z","actor":{"username":"hanno","cleared":false,"url":"/hanno","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/020/918/74da560ef66bf8cc239e219843444b441a7dfac6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"hannob","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}