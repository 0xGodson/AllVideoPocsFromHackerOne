{"id":25191,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNTE5MQ==","url":"https://hackerone.com/reports/25191","title":"SMTP protection not used (please read carefully )","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2014-08-19T01:15:21.614Z","submitted_at":"2014-08-19T01:15:21.614Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ashesh","url":"/ashesh","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/003/791/220e701eb9be549162dfdb1da9b1a1b72ee2dd08_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":312,"url":"https://hackerone.com/greenhouse","handle":"greenhouse","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/312/2b811c151c20eedf86c0458beeaa67210510235e_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/312/2b811c151c20eedf86c0458beeaa67210510235e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Greenhouse.io","twitter_handle":"","website":"https://app.greenhouse.io","about":"Software to optimize your entire recruiting and onboarding process."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2014-12-07T15:22:49.750Z","bug_reporter_agreed_on_going_public_at":"2014-11-07T15:22:36.661Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Details:\r\nCompanies like Coinbase, Yahoo,Google,Facebook and even hackerone  implemented a strict email security policy (combining SPF, DKIM, and DMARC) but I don't see taht from mailgreenhouse.ioru , You should apply strict SMPT policy to stop spoofed email sending from your domain. POC is attached.\r\n\r\nExploit scenario:\r\n-----------------------\r\nAn attacker would send a Fake email from support@greenhouse.io saying that Please change your password, The victim is aware of phishing attacks, But when he sees that the mail originated from support@greenhouse.io , He has no other way than to believe it. Clicking on the link takes him to a website where certain JavaScript is executed which steals his greenhouse.io id and password (SESSION COOKIE). The results can be more dangerous.\r\n\r\n\r\nCode to Exploit:\r\n-------------------\r\n    \u003c?php\r\n    $to = \"VICTIM@example.com\";\r\n    $subject = \"Password Change\";\r\n    $txt = \"Change your password by visiting here - [VIRUS LINK HERE]l\";\r\n    $headers = \"From: support@greenhouse.io\";\r\n    mail($to,$subject,$txt,$headers);\r\n    ?\u003e\r\n\r\nYou should do the fix (see the fix below) To prevent misunderstanding and to protect your users.\r\nFIX\r\n----------\r\n\r\nYour SPF record is `dig +short greenhouse.io txt\r\n\"v=spf1 include:sendgrid.net include:spf.recurly.com include:mailgun.org include:servers.mcsv.net ~all`\r\n\r\nIt should be `dig +short greenhouse.io txt\r\n\"v=spf1 include:sendgrid.net include:spf.recurly.com include:mailgun.org include:servers.mcsv.net   -all`\r\n\r\nI **strongly** recommend you to read this article :\r\n\r\nhttps://www.digitalocean.com/community/tutorials/how-to-use-an-spf-record-to-prevent-spoofing-improve-e-mail-reliability\r\n\r\n**The problem**\r\nThe article clearly shows difference between softmail and fail you should be using fail as Softmail allows anyone to send spoofed emails from your domains. in your SPF record you should replace `~` with `-` at last before all , `-` is strict which prevents all spoofed emails except if you are sending. Your bug is that you are using`~` , you should use `-`\r\n\r\n","vulnerability_information_html":"\u003cp\u003eDetails:\u003cbr\u003e\nCompanies like Coinbase, Yahoo,Google,Facebook and even hackerone  implemented a strict email security policy (combining SPF, DKIM, and DMARC) but I don\u0026#39;t see taht from mailgreenhouse.ioru , You should apply strict SMPT policy to stop spoofed email sending from your domain. POC is attached.\u003c/p\u003e\n\n\u003ch2 id=\"exploit-scenario\"\u003eExploit scenario:\u003c/h2\u003e\n\n\u003cp\u003eAn attacker would send a Fake email from \u003ca title=\"support@greenhouse.io\" href=\"mailto:support@greenhouse.io\" rel=\"nofollow noopener noreferrer\"\u003esupport@greenhouse.io\u003c/a\u003e saying that Please change your password, The victim is aware of phishing attacks, But when he sees that the mail originated from \u003ca title=\"support@greenhouse.io\" href=\"mailto:support@greenhouse.io\" rel=\"nofollow noopener noreferrer\"\u003esupport@greenhouse.io\u003c/a\u003e , He has no other way than to believe it. Clicking on the link takes him to a website where certain JavaScript is executed which steals his greenhouse.io id and password (SESSION COOKIE). The results can be more dangerous.\u003c/p\u003e\n\n\u003ch2 id=\"code-to-exploit\"\u003eCode to Exploit:\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$to\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;VICTIM@example.com\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;Password Change\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$txt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;Change your password by visiting here - [VIRUS LINK HERE]l\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$headers\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;From: support@greenhouse.io\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003email\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$to\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nv\"\u003e$subject\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nv\"\u003e$txt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"nv\"\u003e$headers\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou should do the fix (see the fix below) To prevent misunderstanding and to protect your users.\u003c/p\u003e\n\n\u003ch2 id=\"fix\"\u003eFIX\u003c/h2\u003e\n\n\u003cp\u003eYour SPF record is \u003ccode\u003edig +short greenhouse.io txt\u003cbr\u003e\n\u0026quot;v=spf1 include:sendgrid.net include:spf.recurly.com include:mailgun.org include:servers.mcsv.net ~all\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eIt should be \u003ccode\u003edig +short greenhouse.io txt\u003cbr\u003e\n\u0026quot;v=spf1 include:sendgrid.net include:spf.recurly.com include:mailgun.org include:servers.mcsv.net   -all\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eI \u003cstrong\u003estrongly\u003c/strong\u003e recommend you to read this article :\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://www.digitalocean.com/community/tutorials/how-to-use-an-spf-record-to-prevent-spoofing-improve-e-mail-reliability\" href=\"/redirect?url=https%3A%2F%2Fwww.digitalocean.com%2Fcommunity%2Ftutorials%2Fhow-to-use-an-spf-record-to-prevent-spoofing-improve-e-mail-reliability\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digitalocean.com/community/tutorials/how-to-use-an-spf-record-to-prevent-spoofing-improve-e-mail-reliability\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eThe problem\u003c/strong\u003e\u003cbr\u003e\nThe article clearly shows difference between softmail and fail you should be using fail as Softmail allows anyone to send spoofed emails from your domains. in your SPF record you should replace \u003ccode\u003e~\u003c/code\u003e with \u003ccode\u003e-\u003c/code\u003e at last before all , \u003ccode\u003e-\u003c/code\u003e is strict which prevents all spoofed emails except if you are sending. Your bug is that you are using\u003ccode\u003e~\u003c/code\u003e , you should use \u003ccode\u003e-\u003c/code\u003e\u003c/p\u003e\n","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-12-07T15:22:36.852Z","allow_singular_disclosure_after":-191252980.29428855,"singular_disclosure_allowed":true,"vote_count":1,"voters":["cuso4"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":116535,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"We are aware of the difference between `~all` and `-all`. We do not wish to change our SFP settings at this time.","markdown_message":"\u003cp\u003eWe are aware of the difference between \u003ccode\u003e~all\u003c/code\u003e and \u003ccode\u003e-all\u003c/code\u003e. We do not wish to change our SFP settings at this time.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-08-28T01:34:31.873Z","updated_at":"2014-08-28T01:34:31.873Z","actor":{"username":"mcclurmc","cleared":false,"url":"/mcclurmc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"greenhouse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":156786,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-11-07T15:22:36.677Z","updated_at":"2014-11-07T15:22:36.677Z","first_to_agree":true,"actor":{"username":"ashesh","cleared":false,"url":"/ashesh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/791/220e701eb9be549162dfdb1da9b1a1b72ee2dd08_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"greenhouse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":156980,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No, you may not disclose this. This is not a bug, this is simply a setting we've chosen for our SPF records. This isn't at all a security flaw. Look, google has the same thing in their SPF record:\n\n```\ndig +short google.com TXT\n\"v=spf1 include:_spf.google.com ip4:216.73.93.70/31 ip4:216.73.93.72/31 ~all\"\n```","markdown_message":"\u003cp\u003eNo, you may not disclose this. This is not a bug, this is simply a setting we\u0026#39;ve chosen for our SPF records. This isn\u0026#39;t at all a security flaw. Look, google has the same thing in their SPF record:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003edig +short google.com TXT\n\u0026quot;v=spf1 include:_spf.google.com ip4:216.73.93.70/31 ip4:216.73.93.72/31 ~all\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2014-11-07T18:04:38.372Z","updated_at":"2014-11-07T18:04:38.372Z","actor":{"username":"mcclurmc","cleared":false,"url":"/mcclurmc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"greenhouse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":173567,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-12-07T15:22:50.325Z","updated_at":"2014-12-07T15:22:50.325Z","actor":{"url":"/greenhouse","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/312/2b811c151c20eedf86c0458beeaa67210510235e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Greenhouse.io"}},"genius_execution_id":null,"team_handle":"greenhouse","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}