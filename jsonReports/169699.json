{"id":169699,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjk2OTk=","url":"https://hackerone.com/reports/169699","title":"CSRF in the \"Add restaurant picture\" function","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-09-16T00:08:43.021Z","submitted_at":"2016-09-16T00:08:43.021Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"0xamir","url":"/0xamir","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/039/124/1b521ca60048e6145df498b397f6bd086667d18f_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2943,"url":"https://hackerone.com/zomato","handle":"zomato","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Zomato","twitter_handle":"Zomato","website":"https://www.zomato.com","about":"The fastest way to search for great places to eat at and order from around you. Serving 24 countries worldwide."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-09-14T22:57:21.979Z","bug_reporter_agreed_on_going_public_at":"2017-08-15T22:57:02.831Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"##Overview  \nI found a CSRF vulnerability within the process responsible for adding photos for a restaurant which can lead to tricking victims into adding arbitrary photos to their restaurant's page.  \n##Details  \nThe CSRF vulnerability exists due to a misconfiguration on your part in which your `X-CSRF-TOKEN` header is set to \"Undefined\" which leads to any request being accepted and processed.  \nUploading a picture to your restaurant is a two step process, when you start the process you first have to upload a picture off your device to the server, after that you'll be presented with another form which will allow you to add any captions or descriptions you want to the photo. The misconfiguration in question resides in the first request (The photo upload request) which allows attackers to forge a picture upload request to the server, however the photo will not be added to the restaurant's page unless the second request from the second form (the captions and description form)  is also submitted.  \nIt's also worth noting that there're no CSRF protections in place on the second form.  \n##PoC  \nTo carry out a successful attack the attacker needs to obtain two values which will tie the requests to the victim's account. these values are namely `res_id` and `user_id`. After obtaining these two values (Which are publicly available for any user and restaurant) all the attacker will have to do is to fill these values in the GET parameters in the first request with the values of the victim and the `res_id` parameter in the body of the second POST request. I'll provide a PoC HTML file below in order to make it easier for you to reproduce the flaw, the PoC couldn't be included here due to the huge size of it (because the first request has the binary form of the photo being uploaded in the code itself.)  \nAfter modifying the values in the two requests, click the button that says \"Request 1\" to submit the first request and then \"Request 2\" the submit the second. By this point you can now visit the photos page in your restaurant's page and you'll find a picture of a star added there.  \n##PoC Code:  \n[You can download the exploit code from Mega.nz here](https://mega.nz/#!0wpkhLJL!Xkjm37fvqhcl7Ybp8yPBugnaRz0ruLU0eWS26icsz7s), The file is protected so there's no need to worry about accidental disclosure.  ","vulnerability_information_html":"\u003ch2 id=\"overview\"\u003eOverview\u003c/h2\u003e\n\n\u003cp\u003eI found a CSRF vulnerability within the process responsible for adding photos for a restaurant which can lead to tricking victims into adding arbitrary photos to their restaurant\u0026#39;s page.  \u003c/p\u003e\n\n\u003ch2 id=\"details\"\u003eDetails\u003c/h2\u003e\n\n\u003cp\u003eThe CSRF vulnerability exists due to a misconfiguration on your part in which your \u003ccode\u003eX-CSRF-TOKEN\u003c/code\u003e header is set to \u0026quot;Undefined\u0026quot; which leads to any request being accepted and processed.\u003cbr\u003e\u003cbr\u003e\nUploading a picture to your restaurant is a two step process, when you start the process you first have to upload a picture off your device to the server, after that you\u0026#39;ll be presented with another form which will allow you to add any captions or descriptions you want to the photo. The misconfiguration in question resides in the first request (The photo upload request) which allows attackers to forge a picture upload request to the server, however the photo will not be added to the restaurant\u0026#39;s page unless the second request from the second form (the captions and description form)  is also submitted.\u003cbr\u003e\u003cbr\u003e\nIt\u0026#39;s also worth noting that there\u0026#39;re no CSRF protections in place on the second form.  \u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePoC\u003c/h2\u003e\n\n\u003cp\u003eTo carry out a successful attack the attacker needs to obtain two values which will tie the requests to the victim\u0026#39;s account. these values are namely \u003ccode\u003eres_id\u003c/code\u003e and \u003ccode\u003euser_id\u003c/code\u003e. After obtaining these two values (Which are publicly available for any user and restaurant) all the attacker will have to do is to fill these values in the GET parameters in the first request with the values of the victim and the \u003ccode\u003eres_id\u003c/code\u003e parameter in the body of the second POST request. I\u0026#39;ll provide a PoC HTML file below in order to make it easier for you to reproduce the flaw, the PoC couldn\u0026#39;t be included here due to the huge size of it (because the first request has the binary form of the photo being uploaded in the code itself.)\u003cbr\u003e\u003cbr\u003e\nAfter modifying the values in the two requests, click the button that says \u0026quot;Request 1\u0026quot; to submit the first request and then \u0026quot;Request 2\u0026quot; the submit the second. By this point you can now visit the photos page in your restaurant\u0026#39;s page and you\u0026#39;ll find a picture of a star added there.  \u003c/p\u003e\n\n\u003ch2 id=\"poc-code\"\u003ePoC Code:\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"/redirect?url=https%3A%2F%2Fmega.nz%2F%23%210wpkhLJL%21Xkjm37fvqhcl7Ybp8yPBugnaRz0ruLU0eWS26icsz7s\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eYou can download the exploit code from Mega.nz here\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, The file is protected so there\u0026#39;s no need to worry about accidental disclosure.  \u003c/p\u003e\n","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-09-14T22:57:02.876Z","allow_singular_disclosure_after":-103787005.96881804,"singular_disclosure_allowed":true,"vote_count":8,"voters":["cyanpiny","eveeez","r3y","malcolmx","safehacker_27","ronygigi","geekninja","thejaguar"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1248314,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any updates? ","markdown_message":"\u003cp\u003eAny updates? \u003c/p\u003e\n","automated_response":false,"created_at":"2016-10-14T20:42:16.150Z","updated_at":"2016-10-14T20:42:16.150Z","actor":{"username":"0xamir","cleared":false,"url":"/0xamir","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/124/1b521ca60048e6145df498b397f6bd086667d18f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1346134,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Guys? \nIt's getting kinda lonely here.. ","markdown_message":"\u003cp\u003eGuys? \u003cbr\u003e\nIt\u0026#39;s getting kinda lonely here.. \u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-07T01:36:21.014Z","updated_at":"2016-12-07T01:36:21.014Z","actor":{"username":"0xamir","cleared":false,"url":"/0xamir","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/124/1b521ca60048e6145df498b397f6bd086667d18f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1669871,"is_internal":false,"editable":false,"type":"Activities::HackerRequestedMediation","message":"I know that teams should be given time in order to deal with reports but i think 8 months is more than enough, someone could've had a baby between the time i sent the report and today.","markdown_message":"\u003cp\u003eI know that teams should be given time in order to deal with reports but i think 8 months is more than enough, someone could\u0026#39;ve had a baby between the time i sent the report and today.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-12T11:48:45.660Z","updated_at":"2017-05-12T11:48:45.660Z","actor":{"username":"0xamir","cleared":false,"url":"/0xamir","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/124/1b521ca60048e6145df498b397f6bd086667d18f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1708709,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"@ak_17","markdown_message":"\u003cp\u003e\u003ca href=\"/ak_17\"\u003e@ak_17\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-30T07:34:49.875Z","updated_at":"2017-05-30T07:34:49.875Z","actor":{"username":"shubhamchaudhary","cleared":false,"url":"/shubhamchaudhary","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1869857,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This should be resolved. Thanks for reporting.","markdown_message":"\u003cp\u003eThis should be resolved. Thanks for reporting.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-07-27T04:11:28.385Z","updated_at":"2017-07-27T04:11:28.385Z","actor":{"username":"ankitladhania","cleared":false,"url":"/ankitladhania","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"0xamir","url":"/0xamir"},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1879028,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-31T09:11:39.589Z","updated_at":"2017-07-31T09:11:39.589Z","actor":{"url":"/zomato","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Zomato"}},"bounty_amount":"50.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"zomato","collaborator":{"username":"0xamir","url":"/0xamir"},"actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1931941,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-15T22:57:02.847Z","updated_at":"2017-08-15T22:57:02.847Z","first_to_agree":true,"actor":{"username":"0xamir","cleared":false,"url":"/0xamir","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/039/124/1b521ca60048e6145df498b397f6bd086667d18f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1998087,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-14T22:57:21.996Z","updated_at":"2017-09-14T22:57:21.996Z","actor":{"url":"/zomato","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Zomato"}},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}