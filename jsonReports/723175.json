{"id":723175,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MjMxNzU=","url":"https://hackerone.com/reports/723175","title":"De-anonymization Attack: Cross Site Information Leakage","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-10-26T09:18:27.896Z","submitted_at":"2019-10-26T09:18:27.896Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"soheilkhodayari","url":"/soheilkhodayari","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":638,"url":"https://hackerone.com/imgur","handle":"imgur","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/638/c66ef01545064639821798ab311aa0063acd8aa7_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/638/c66ef01545064639821798ab311aa0063acd8aa7_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Imgur","twitter_handle":"imgur","website":"http://imgur.com","about":"The most awesome images on the Internet."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-12-14T07:57:42.259Z","bug_reporter_agreed_on_going_public_at":"2019-12-06T21:53:01.434Z","team_member_agreed_on_going_public_at":"2019-12-14T07:57:42.188Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Dear Imgur Security Team,\n\nWe are researchers at the IMDEA Software Institute in Madrid, Spain. We have been working on analyzing Cross-Site Browser Leaks (xsleaks) and building a tool for finding instances of it on target web sites. Recently we tested imgur.com and discovered a flaw that can affect Imgur users. We would like to responsibly disclose it and support you to mitigate the issue. The details follow.\n\n## Attack Overview:\nEvents-Fired xsLeak: a cross-domain attack website, say attacker.org, could embed specific resources from imgur.com in a script Tag, and check if an error or load event is triggered in one state but not in the other. \nBased on which events are triggered for each vulnerable resource, the attacker can infer the victim state (e.g. logged in vs logged out, or owner of a specific profile). This happens because the leaky endpoint return a 2xx HTTP response in one state but a 4xx in the other.\n\nIn particular, we have found 2 vulnerable (leaky) endpoints:\n\n1. The first one can be used for login detection (onerror =  logged out, onload = logged in):https://api.imgur.com/3/larynx/history?IMGURPLATFORM=web\u0026IMGURUIDJAFO=9d77969d8b3a7a6ac6cb78943c96e48cd0bd74e02b29839f9f19aea827429db6\u0026SESSIONCOUNT=3\u0026client_id=546c25a59c58ad7\n\n2.  The second one can be used to track and deanonymize the owner of a Imgur profile across origins. For this, the attacker leverages the resource: https://\u003cUSERNAME\u003e.imgur.com/all  where \u003cUSERNAME\u003e is the username of  the victim to be fingerprinted (e.g., https://user1imdea.imgur.com/all). \nIf the victim visiting the attack page is the owner of the \u003cUSERNAME\u003e profile, the \"onload\" event will be triggered. Otherwise, the \"onerror\" event is fired.\n\n## How to reproduce the attack:\na. We have attached a PoC attack page.\nb. Acting as the victim, login to imgur.com from a browser and load the attached page in a different tab of the same browser.c. Specify the profile/home page url of format:  https://\u003cUSERNAME\u003e.imgur.com/all  for the target victim in the input field, and press the submit button.\nc. After a couple of seconds, popups should appear saying whether you are logged at imgur and if you are the owner of the specified account.\n\n\n## Browser/OS tested: \nWe tested the PoC on windows 10 in:  Chrome Version: 77.0.3865.120 (Official Build) (64-bit) and Firefox 67.0.3  (Official Build) (64-bit). The same attack should work on other browsers and OSes too, although we haven't verified it thoroughly!\n\n## Similarity with known attacks:\nSimilar attacks were reported in the past against Facebook (https://www.imperva.com/blog/facebook-privacy-bug/) and Twitter (https://hackerone.com/reports/329957) and the vendors have taken the necessary preventive measures.\n\nFor any further questions, we are available at your disposal.\n\n## Impact\n\n## Impact of the attack\nThe attack enables malicious web sites of the internet to uniquely determine if any of their visitors is logged at Imgur, and also to track and fingerprint Imgur users across origins who have shared particular images. ","vulnerability_information_html":"\u003cp\u003eDear Imgur Security Team,\u003c/p\u003e\n\n\u003cp\u003eWe are researchers at the IMDEA Software Institute in Madrid, Spain. We have been working on analyzing Cross-Site Browser Leaks (xsleaks) and building a tool for finding instances of it on target web sites. Recently we tested imgur.com and discovered a flaw that can affect Imgur users. We would like to responsibly disclose it and support you to mitigate the issue. The details follow.\u003c/p\u003e\n\n\u003ch2 id=\"attack-overview\"\u003eAttack Overview:\u003c/h2\u003e\n\n\u003cp\u003eEvents-Fired xsLeak: a cross-domain attack website, say attacker.org, could embed specific resources from imgur.com in a script Tag, and check if an error or load event is triggered in one state but not in the other. \u003cbr\u003e\nBased on which events are triggered for each vulnerable resource, the attacker can infer the victim state (e.g. logged in vs logged out, or owner of a specific profile). This happens because the leaky endpoint return a 2xx HTTP response in one state but a 4xx in the other.\u003c/p\u003e\n\n\u003cp\u003eIn particular, we have found 2 vulnerable (leaky) endpoints:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThe first one can be used for login detection (onerror =  logged out, onload = logged in):\u003ca title=\"https://api.imgur.com/3/larynx/history?IMGURPLATFORM=web\u0026amp;IMGURUIDJAFO=9d77969d8b3a7a6ac6cb78943c96e48cd0bd74e02b29839f9f19aea827429db6\u0026amp;SESSIONCOUNT=3\u0026amp;client_id=546c25a59c58ad7\" href=\"/redirect?url=https%3A%2F%2Fapi.imgur.com%2F3%2Flarynx%2Fhistory%3FIMGURPLATFORM%3Dweb%26IMGURUIDJAFO%3D9d77969d8b3a7a6ac6cb78943c96e48cd0bd74e02b29839f9f19aea827429db6%26SESSIONCOUNT%3D3%26client_id%3D546c25a59c58ad7\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://api.imgur.com/3/larynx/history?IMGURPLATFORM=web\u0026amp;IMGURUIDJAFO=9d77969d8b3a7a6ac6cb78943c96e48cd0bd74e02b29839f9f19aea827429db6\u0026amp;SESSIONCOUNT=3\u0026amp;client_id=546c25a59c58ad7\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e2.  The second one can be used to track and deanonymize the owner of a Imgur profile across origins. For this, the attacker leverages the resource: https://\u0026lt;USERNAME\u0026gt;.imgur.com/all  where \u0026lt;USERNAME\u0026gt; is the username of  the victim to be fingerprinted (e.g., \u003ca title=\"https://user1imdea.imgur.com/all\" href=\"/redirect?url=https%3A%2F%2Fuser1imdea.imgur.com%2Fall\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://user1imdea.imgur.com/all\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e). \u003cbr\u003e\nIf the victim visiting the attack page is the owner of the \u0026lt;USERNAME\u0026gt; profile, the \u0026quot;onload\u0026quot; event will be triggered. Otherwise, the \u0026quot;onerror\u0026quot; event is fired.\u003c/p\u003e\n\n\u003ch2 id=\"how-to-reproduce-the-attack\"\u003eHow to reproduce the attack:\u003c/h2\u003e\n\n\u003cp\u003ea. We have attached a PoC attack page.\u003cbr\u003e\nb. Acting as the victim, login to imgur.com from a browser and load the attached page in a different tab of the same browser.c. Specify the profile/home page url of format:  https://\u0026lt;USERNAME\u0026gt;.imgur.com/all  for the target victim in the input field, and press the submit button.\u003cbr\u003e\nc. After a couple of seconds, popups should appear saying whether you are logged at imgur and if you are the owner of the specified account.\u003c/p\u003e\n\n\u003ch2 id=\"browser-os-tested\"\u003eBrowser/OS tested: \u003c/h2\u003e\n\n\u003cp\u003eWe tested the PoC on windows 10 in:  Chrome Version: 77.0.3865.120 (Official Build) (64-bit) and Firefox 67.0.3  (Official Build) (64-bit). The same attack should work on other browsers and OSes too, although we haven\u0026#39;t verified it thoroughly!\u003c/p\u003e\n\n\u003ch2 id=\"similarity-with-known-attacks\"\u003eSimilarity with known attacks:\u003c/h2\u003e\n\n\u003cp\u003eSimilar attacks were reported in the past against Facebook (\u003ca title=\"https://www.imperva.com/blog/facebook-privacy-bug/\" href=\"/redirect?url=https%3A%2F%2Fwww.imperva.com%2Fblog%2Ffacebook-privacy-bug%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.imperva.com/blog/facebook-privacy-bug/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) and Twitter (\u003ca title=\"https://hackerone.com/reports/329957\" href=\"https://hackerone.com/reports/329957\"\u003ehttps://hackerone.com/reports/329957\u003c/a\u003e) and the vendors have taken the necessary preventive measures.\u003c/p\u003e\n\n\u003cp\u003eFor any further questions, we are available at your disposal.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003ch2 id=\"impact-of-the-attack\"\u003eImpact of the attack\u003c/h2\u003e\n\n\u003cp\u003eThe attack enables malicious web sites of the internet to uniquely determine if any of their visitors is logged at Imgur, and also to track and fingerprint Imgur users across origins who have shared particular images. \u003c/p\u003e\n","bounty_amount":"250.0","formatted_bounty":"$250","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":618318,"file_name":"imgur_attack_page.html","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/pCVZYXbWjYWvXk8PV5EvEkSe?response-content-disposition=attachment%3B%20filename%3D%22imgur_attack_page.html%22%3B%20filename%2A%3DUTF-8%27%27imgur_attack_page.html\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZNBK7XE3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T064159Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDJ7z4CmMY3RV8XLMfdiTISQ9S1r9LCcJaOgCsH72FPNAiEAuja%2BBBclEzFTidjiCeJDfo4MzChKrB6582xpvIRZVHkqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDKF6a0ltLoRnSbls0yqRA3RGeXBNEYkcjQZeQFx3bgZwO3IO2Lrw6zpAqUNvB9kgtFfucTajkpiHPbxlEXUipMBgdqwocs7gTZt2N3PS5ofO0SiwdnSDzloAVKwvO0XxAw38SFZ70tsG2d%2FGMwjmhna0T8MpEDx2rGBrOrmMGD%2BxUltiSMg5RbP4rOtmNv8ar9c6C5QMOqO65NG11MRvC%2BWmpwVTu7rYIfx6VqNqNYuYBj3X8lrkAIj49fYyj6hO9J%2B192rAZcrZy%2Fw%2FVAObxfNeR4Ody9MGHCied9SDXd94Id6OVnLovmWuyeU9tqRxlCjsbK8JU%2BX4cPpzzLv2M%2BXo9FPZzDo%2BJsudoZ%2FGhP8gGO7tqmufjBlUJeCMc7PJwExjkANhZZ8jsuHUnG6x0ut5DHPqdKpuFrdIEEkM54WZUmpVWXhr4FFAQpHmxo5CDioZ8fJISU03lWiVZsNHNUNL9JvOP%2F9r%2BD39N6cKvQsPj88OjMOdSwqmXok7EmQpEHjQJD7E2qU3u9NYOegEnJbeEDovuNzvrAFxWCR8Jb54MPSEq%2F8FOusBO2kLVSIwkWtiWhkMaF2Er8oC8IS3vbK0bWd1vKM6%2B7NbNWRuqTnvJZaJWfp3F9jcm3FnwzYHZTcGXifg17Nbzb0roUgfsHPeorCwFQWH5sgSgHT2%2FWJtKCiy%2Bq70tsC4rbZb9rhONxp4U1mUQ1FHptDEi7qq4G0IX8as4zxX7lD6kdQWT5OzW%2B1QZT5nCSKbiYjBuLsBWu7yufMUkemOm2u4kDIOdccYg1ZGDofBPx4GFA%2B8IOAMP3e7bz6rUgxMr2NMjzX%2Byr%2FFaK2EDYbEgcI81le58BokeFu68wlopZbfnJvFia1ReCQe1Q%3D%3D\u0026X-Amz-Signature=3dd1b0b9d58bfc65593f24554a087eab2d6f4e41ca8050066774c3e0973d0bee","file_size":1946,"type":"text/html"}],"allow_singular_disclosure_at":"2020-01-05T21:53:01.494Z","allow_singular_disclosure_after":-30962937.682334635,"singular_disclosure_allowed":true,"vote_count":21,"voters":["yxw21","sameerphad72","prophet","g30rg3","zerosin","realtess","naategh","khizer47","soheilkhodayari","cryptographer","and 11 more..."],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":6143331,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello! Thanks for taking the time to make this report to the Imgur security team! We look forward to reviewing and assessing the risk of this vuln. In the meantime, we ask that you sit tight while we get to it - we're a small team and sometimes it takes us a while to verify all reports. Please don't ask for updates as these take time and effort away from the reports we're working through and make our response time slower across the board. Thanks - we'll be in touch soon!","markdown_message":"\u003cp\u003eHello! Thanks for taking the time to make this report to the Imgur security team! We look forward to reviewing and assessing the risk of this vuln. In the meantime, we ask that you sit tight while we get to it - we\u0026#39;re a small team and sometimes it takes us a while to verify all reports. Please don\u0026#39;t ask for updates as these take time and effort away from the reports we\u0026#39;re working through and make our response time slower across the board. Thanks - we\u0026#39;ll be in touch soon!\u003c/p\u003e\n","automated_response":true,"created_at":"2019-10-26T09:18:28.221Z","updated_at":"2019-10-26T09:18:28.221Z","actor":{"url":"/imgur","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/638/c66ef01545064639821798ab311aa0063acd8aa7_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Imgur"}},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6160799,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @soheilkhodayari,\nWe have accepted the report as valid and added an issue in our internal issue tracker for your report. We will update this page when more progress is made. Thanks!","markdown_message":"\u003cp\u003eHi \u003ca href=\"/soheilkhodayari\"\u003e@soheilkhodayari\u003c/a\u003e,\u003cbr\u003e\nWe have accepted the report as valid and added an issue in our internal issue tracker for your report. We will update this page when more progress is made. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-10-29T05:58:05.308Z","updated_at":"2019-10-29T05:58:05.308Z","actor":{"username":"srinidhik","cleared":false,"url":"/srinidhik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/342/158/8d34a803d2f3fffe842a3047954bcf0007d73044_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6307225,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-14T17:40:29.041Z","updated_at":"2019-11-14T17:40:29.041Z","additional_data":{"old_severity":"Critical (9.1)","new_severity":"Medium","old_severity_id":548890,"new_severity_id":565781},"actor":{"username":"kodermike","cleared":false,"url":"/kodermike","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6307228,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"The Imgur team really appreciates your report and would like to give you a monetary bounty. Thanks for taking the time to report this issue and please let us know if you come upon more issues!","markdown_message":"\u003cp\u003eThe Imgur team really appreciates your report and would like to give you a monetary bounty. Thanks for taking the time to report this issue and please let us know if you come upon more issues!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-14T17:40:45.388Z","updated_at":"2019-11-14T17:40:45.388Z","actor":{"url":"/imgur","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/638/c66ef01545064639821798ab311aa0063acd8aa7_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Imgur"}},"bounty_amount":"250.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"imgur","collaborator":{"username":"soheilkhodayari","url":"/soheilkhodayari"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6307680,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@soheilkhodayari,\nWe have rolled out a fix for this issue, can you please confirm?\nThanks!","markdown_message":"\u003cp\u003e\u003ca href=\"/soheilkhodayari\"\u003e@soheilkhodayari\u003c/a\u003e,\u003cbr\u003e\nWe have rolled out a fix for this issue, can you please confirm?\u003cbr\u003e\nThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-14T18:36:40.522Z","updated_at":"2019-11-14T18:36:40.522Z","actor":{"username":"srinidhik","cleared":false,"url":"/srinidhik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/342/158/8d34a803d2f3fffe842a3047954bcf0007d73044_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6310958,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, thanks for the bounty. I have checked the fix, and I confirm that the second reported endpoint is no longer vulnerable via the Events-Fired XsLeak. The endpoint returns a 2xx response in all states, and seems to be correctly patched. However, the login detection endpoint still seems to be leaky, although it may not be considered security relevant alone.\n\nHaving said that, I noticed that the de-anonymization attack is still possible via another trick (in particular, CSP). While checking the fix, I observed the following behaviour:\n1. when visiting a URL like https://user2imdea.imgur.com/all, the victim is first redirected to https://imgur.com/signin. \n2. Next, if the victim is logged, and her username is anything other than user2imdea, say, user1imdea, she will be redirected to https://user1imdea.imgur.com/all\nSince this redirection is across origin, an attacker can craft an attack page with a suitable content security policy that only allows the three domains: imgur.com/signin, user2imdea.imgur.com and api.imur.com.  Attempting to access any other domain, such as user1imdea.imgur.com, would then trigger a securitypolicyviolation event, by which the attacker can the read the blockedURI attribute from the event, which in turn shows the victim profile address, and thus de-anonymizing the victim.\nI assume this behaviour should in most parts only affect Chrome users.\n\n# Attack steps\n1. Attacker creates a dummy account for herself with profileURL of, e.g., https://user2imdea.imgur.com/all\n2. First a login detection attack is launched\n3. if the user is logged, to deanonymize the victim, the attacker captures content security policy violations (redirections to other domains). To do this:\n\na.  the login endpoint (https://imgur.com/signin) and api endpoint (https://api.imgur.com), as well as the attacker created dummy account (https://user2imdea.imgur.com/all) are placed on the CSP white list\nb. the attacker reads the blockedURI attribute from the securitypolicyviolation event. The blockedURI is the profile address of the logged victim! \n\n\n# Steps to reproduce the attack\nI have provided a PoC attack page for demonstration purposes. \nThe attack page was tested on Chrome 78.0.3904.70 (Official Build) (64-bit).\njust visit the PoC from a logged account in Chrome, and wait for couple of seconds for the pop ups to show up.\n\nIf you have any other questions, do not hesitate to contact me.\n\n","markdown_message":"\u003cp\u003eHi, thanks for the bounty. I have checked the fix, and I confirm that the second reported endpoint is no longer vulnerable via the Events-Fired XsLeak. The endpoint returns a 2xx response in all states, and seems to be correctly patched. However, the login detection endpoint still seems to be leaky, although it may not be considered security relevant alone.\u003c/p\u003e\n\n\u003cp\u003eHaving said that, I noticed that the de-anonymization attack is still possible via another trick (in particular, CSP). While checking the fix, I observed the following behaviour:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003ewhen visiting a URL like \u003ca title=\"https://user2imdea.imgur.com/all\" href=\"/redirect?url=https%3A%2F%2Fuser2imdea.imgur.com%2Fall\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://user2imdea.imgur.com/all\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, the victim is first redirected to \u003ca title=\"https://imgur.com/signin\" href=\"/redirect?url=https%3A%2F%2Fimgur.com%2Fsignin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://imgur.com/signin\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. \u003c/li\u003e\n\u003cli\u003eNext, if the victim is logged, and her username is anything other than user2imdea, say, user1imdea, she will be redirected to \u003ca title=\"https://user1imdea.imgur.com/all\" href=\"/redirect?url=https%3A%2F%2Fuser1imdea.imgur.com%2Fall\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://user1imdea.imgur.com/all\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\nSince this redirection is across origin, an attacker can craft an attack page with a suitable content security policy that only allows the three domains: imgur.com/signin, user2imdea.imgur.com and api.imur.com.  Attempting to access any other domain, such as user1imdea.imgur.com, would then trigger a securitypolicyviolation event, by which the attacker can the read the blockedURI attribute from the event, which in turn shows the victim profile address, and thus de-anonymizing the victim.\nI assume this behaviour should in most parts only affect Chrome users.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1 id=\"attack-steps\"\u003eAttack steps\u003c/h1\u003e\n\n\u003col\u003e\n\u003cli\u003eAttacker creates a dummy account for herself with profileURL of, e.g., \u003ca title=\"https://user2imdea.imgur.com/all\" href=\"/redirect?url=https%3A%2F%2Fuser2imdea.imgur.com%2Fall\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://user2imdea.imgur.com/all\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eFirst a login detection attack is launched\u003c/li\u003e\n\u003cli\u003eif the user is logged, to deanonymize the victim, the attacker captures content security policy violations (redirections to other domains). To do this:\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003ea.  the login endpoint (\u003ca title=\"https://imgur.com/signin\" href=\"/redirect?url=https%3A%2F%2Fimgur.com%2Fsignin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://imgur.com/signin\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) and api endpoint (\u003ca title=\"https://api.imgur.com\" href=\"/redirect?url=https%3A%2F%2Fapi.imgur.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://api.imgur.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e), as well as the attacker created dummy account (\u003ca title=\"https://user2imdea.imgur.com/all\" href=\"/redirect?url=https%3A%2F%2Fuser2imdea.imgur.com%2Fall\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://user2imdea.imgur.com/all\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) are placed on the CSP white list\u003cbr\u003e\nb. the attacker reads the blockedURI attribute from the securitypolicyviolation event. The blockedURI is the profile address of the logged victim! \u003c/p\u003e\n\n\u003ch1 id=\"steps-to-reproduce-the-attack\"\u003eSteps to reproduce the attack\u003c/h1\u003e\n\n\u003cp\u003eI have provided a PoC attack page for demonstration purposes. \u003cbr\u003e\nThe attack page was tested on Chrome 78.0.3904.70 (Official Build) (64-bit).\u003cbr\u003e\njust visit the PoC from a logged account in Chrome, and wait for couple of seconds for the pop ups to show up.\u003c/p\u003e\n\n\u003cp\u003eIf you have any other questions, do not hesitate to contact me.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-15T01:13:03.220Z","updated_at":"2019-11-15T01:13:03.220Z","actor":{"username":"soheilkhodayari","cleared":false,"url":"/soheilkhodayari","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":634830,"filename":"imgur_csp_attack_page.html","type":"text/html","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/1LJYx64dg1uePjsw65Fp6M5U?response-content-disposition=attachment%3B%20filename%3D%22imgur_csp_attack_page.html%22%3B%20filename%2A%3DUTF-8%27%27imgur_csp_attack_page.html\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZNBK7XE3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T064159Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDJ7z4CmMY3RV8XLMfdiTISQ9S1r9LCcJaOgCsH72FPNAiEAuja%2BBBclEzFTidjiCeJDfo4MzChKrB6582xpvIRZVHkqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDKF6a0ltLoRnSbls0yqRA3RGeXBNEYkcjQZeQFx3bgZwO3IO2Lrw6zpAqUNvB9kgtFfucTajkpiHPbxlEXUipMBgdqwocs7gTZt2N3PS5ofO0SiwdnSDzloAVKwvO0XxAw38SFZ70tsG2d%2FGMwjmhna0T8MpEDx2rGBrOrmMGD%2BxUltiSMg5RbP4rOtmNv8ar9c6C5QMOqO65NG11MRvC%2BWmpwVTu7rYIfx6VqNqNYuYBj3X8lrkAIj49fYyj6hO9J%2B192rAZcrZy%2Fw%2FVAObxfNeR4Ody9MGHCied9SDXd94Id6OVnLovmWuyeU9tqRxlCjsbK8JU%2BX4cPpzzLv2M%2BXo9FPZzDo%2BJsudoZ%2FGhP8gGO7tqmufjBlUJeCMc7PJwExjkANhZZ8jsuHUnG6x0ut5DHPqdKpuFrdIEEkM54WZUmpVWXhr4FFAQpHmxo5CDioZ8fJISU03lWiVZsNHNUNL9JvOP%2F9r%2BD39N6cKvQsPj88OjMOdSwqmXok7EmQpEHjQJD7E2qU3u9NYOegEnJbeEDovuNzvrAFxWCR8Jb54MPSEq%2F8FOusBO2kLVSIwkWtiWhkMaF2Er8oC8IS3vbK0bWd1vKM6%2B7NbNWRuqTnvJZaJWfp3F9jcm3FnwzYHZTcGXifg17Nbzb0roUgfsHPeorCwFQWH5sgSgHT2%2FWJtKCiy%2Bq70tsC4rbZb9rhONxp4U1mUQ1FHptDEi7qq4G0IX8as4zxX7lD6kdQWT5OzW%2B1QZT5nCSKbiYjBuLsBWu7yufMUkemOm2u4kDIOdccYg1ZGDofBPx4GFA%2B8IOAMP3e7bz6rUgxMr2NMjzX%2Byr%2FFaK2EDYbEgcI81le58BokeFu68wlopZbfnJvFia1ReCQe1Q%3D%3D\u0026X-Amz-Signature=a15f3f234f4ac5181508f299d94b94476838a7fa4ef59e6bbbdad0a77745df54"}],"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6480861,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@soheilkhodayari,\nWe have deployed another fix for this, can you please take a look?\n\nThanks!","markdown_message":"\u003cp\u003e\u003ca href=\"/soheilkhodayari\"\u003e@soheilkhodayari\u003c/a\u003e,\u003cbr\u003e\nWe have deployed another fix for this, can you please take a look?\u003c/p\u003e\n\n\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-06T09:46:50.279Z","updated_at":"2019-12-06T09:46:50.279Z","actor":{"username":"srinidhik","cleared":false,"url":"/srinidhik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/342/158/8d34a803d2f3fffe842a3047954bcf0007d73044_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6480935,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @srinidhik,\nI confirm that the issues are completely resolved now.  \nThank you!\n ","markdown_message":"\u003cp\u003eHi \u003ca href=\"/srinidhik\"\u003e@srinidhik\u003c/a\u003e,\u003cbr\u003e\nI confirm that the issues are completely resolved now.\u003cbr\u003e\u003cbr\u003e\nThank you!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-06T09:59:39.884Z","updated_at":"2019-12-06T10:05:16.134Z","actor":{"username":"soheilkhodayari","cleared":false,"url":"/soheilkhodayari","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6485577,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for helping make Imgur more secure! ","markdown_message":"\u003cp\u003eThanks for helping make Imgur more secure! \u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-06T17:39:57.215Z","updated_at":"2019-12-06T17:39:57.215Z","actor":{"username":"srinidhik","cleared":false,"url":"/srinidhik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/342/158/8d34a803d2f3fffe842a3047954bcf0007d73044_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"soheilkhodayari","url":"/soheilkhodayari"},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6487146,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-06T21:53:01.453Z","updated_at":"2019-12-06T21:53:01.453Z","first_to_agree":true,"actor":{"username":"soheilkhodayari","cleared":false,"url":"/soheilkhodayari","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6546885,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-14T07:57:42.202Z","updated_at":"2019-12-14T07:57:42.202Z","actor":{"username":"srinidhik","cleared":false,"url":"/srinidhik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/342/158/8d34a803d2f3fffe842a3047954bcf0007d73044_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6546886,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-14T07:57:42.271Z","updated_at":"2019-12-14T07:57:42.271Z","actor":{"username":"srinidhik","cleared":false,"url":"/srinidhik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/342/158/8d34a803d2f3fffe842a3047954bcf0007d73044_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"imgur","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}