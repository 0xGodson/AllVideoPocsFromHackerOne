{"id":47357,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NzM1Nw==","url":"https://hackerone.com/reports/47357","title":"CSRF token from another valid user session accepted","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2015-02-10T21:15:00.309Z","submitted_at":"2015-02-10T21:15:00.309Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"4lemon","url":"/4lemon","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/194/aa0eb7d0d4c0ee7d20ae9b2550953b4eeda26ef9_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":607,"url":"https://hackerone.com/mobilevikings","handle":"mobilevikings","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/607/58ac309f0f3fb06a4bdcfe6480d51a32b699b72e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/607/58ac309f0f3fb06a4bdcfe6480d51a32b699b72e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Mobile Vikings","twitter_handle":"mobilevikingsBE","website":"https://mobilevikings.be/","about":"Mobile Vikings is a prepaid provider that lets you connect to your Viking friends for free!"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2015-04-03T14:03:59.511Z","bug_reporter_agreed_on_going_public_at":"2015-03-04T14:03:35.505Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"While testing website i have found interesting issue. For example request to remove sim auth:\r\nPOST /en/sims/authorization/remove/admin/1036359/ HTTP/1.1\r\nHost: mobilevikings.be\r\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:35.0) Gecko/20100101 Firefox/35.0\r\nAccept: */*\r\nAccept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3\r\nAccept-Encoding: gzip, deflate\r\nX-CSRFToken: LI6qbdczbgPPQ7fxXR3duFENgY1qr3wB\r\nX-Requested-With: XMLHttpRequest\r\nReferer: https://mobilevikings.be/en/account/authorization/overview/\r\nCookie: mobilevikingsbe=fda79999f5d3ea86aee1cac688306948; csrftoken=LI6qbdczbgPPQ7fxXR3duFENgY1qr3wB; cookies.js=1; _ga=GA1.2.843387348.1423586164; __utmx=177304377.1C02iW_2TT2rFZKjDPjE7Q$0:0; __utmxx=177304377.1C02iW_2TT2rFZKjDPjE7Q$0:1423600511:8035200; __atuvc=5%7C6\r\nConnection: keep-alive\r\nPragma: no-cache\r\nCache-Control: no-cache\r\nContent-Length: 0\r\n\r\nResponse:\r\nHTTP/1.1 302 FOUND\r\nServer: nginx/1.4.2\r\nDate: Tue, 10 Feb 2015 21:02:50 GMT\r\nContent-Type: text/html; charset=utf-8\r\nConnection: keep-alive\r\nVary: Cookie\r\nLocation: https://mobilevikings.be/en/account/authorization/overview/\r\nContent-Language: en-be\r\nSet-Cookie: messages=\"cc71d85271dc293bce25170e9cfb3d36beef0b5f$[[\\\"__json_message\\\"\\0540\\05425\\054\\\"Authorization on this SIM card for  has been removed.\\\"]]\"; Path=/\r\nContent-Length: 0\r\n\r\nProblem is that this request works with \r\n X-CSRFToken: LI6qbdczbgPPQ7fxXR3duFENgY1qr3wB\r\nthis token i got from another account\r\nthe real token was \r\nAlEqSERKOXKjZfSdw2WtPY4l7n5b68BM\r\n\r\nThis issue make possible to attacker bypass CSRF using his own valid token (for example thru xss). Best practice is:\r\n- token from different user do not work on other session\r\n- and much better if token change on each request\r\n","vulnerability_information_html":"\u003cp\u003eWhile testing website i have found interesting issue. For example request to remove sim auth:\u003cbr\u003e\nPOST /en/sims/authorization/remove/admin/1036359/ HTTP/1.1\u003cbr\u003e\nHost: mobilevikings.be\u003cbr\u003e\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:35.0) Gecko/20100101 Firefox/35.0\u003cbr\u003e\nAccept: \u003cem\u003e/\u003c/em\u003e\u003cbr\u003e\nAccept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3\u003cbr\u003e\nAccept-Encoding: gzip, deflate\u003cbr\u003e\nX-CSRFToken: LI6qbdczbgPPQ7fxXR3duFENgY1qr3wB\u003cbr\u003e\nX-Requested-With: XMLHttpRequest\u003cbr\u003e\nReferer: \u003ca title=\"https://mobilevikings.be/en/account/authorization/overview/\" href=\"/redirect?url=https%3A%2F%2Fmobilevikings.be%2Fen%2Faccount%2Fauthorization%2Foverview%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://mobilevikings.be/en/account/authorization/overview/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nCookie: mobilevikingsbe=fda79999f5d3ea86aee1cac688306948; csrftoken=LI6qbdczbgPPQ7fxXR3duFENgY1qr3wB; cookies.js=1; _ga=GA1.2.843387348.1423586164; __utmx=177304377.1C02iW_2TT2rFZKjDPjE7Q$0:0; __utmxx=177304377.1C02iW_2TT2rFZKjDPjE7Q$0:1423600511:8035200; __atuvc=5%7C6\u003cbr\u003e\nConnection: keep-alive\u003cbr\u003e\nPragma: no-cache\u003cbr\u003e\nCache-Control: no-cache\u003cbr\u003e\nContent-Length: 0\u003c/p\u003e\n\n\u003cp\u003eResponse:\u003cbr\u003e\nHTTP/1.1 302 FOUND\u003cbr\u003e\nServer: nginx/1.4.2\u003cbr\u003e\nDate: Tue, 10 Feb 2015 21:02:50 GMT\u003cbr\u003e\nContent-Type: text/html; charset=utf-8\u003cbr\u003e\nConnection: keep-alive\u003cbr\u003e\nVary: Cookie\u003cbr\u003e\nLocation: \u003ca title=\"https://mobilevikings.be/en/account/authorization/overview/\" href=\"/redirect?url=https%3A%2F%2Fmobilevikings.be%2Fen%2Faccount%2Fauthorization%2Foverview%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://mobilevikings.be/en/account/authorization/overview/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nContent-Language: en-be\u003cbr\u003e\nSet-Cookie: messages=\u0026quot;cc71d85271dc293bce25170e9cfb3d36beef0b5f$[[\\\u0026quot;__json_message\\\u0026quot;\\0540\\05425\\054\\\u0026quot;Authorization on this SIM card for  has been removed.\\\u0026quot;]]\u0026quot;; Path=/\u003cbr\u003e\nContent-Length: 0\u003c/p\u003e\n\n\u003cp\u003eProblem is that this request works with \u003cbr\u003e\n X-CSRFToken: LI6qbdczbgPPQ7fxXR3duFENgY1qr3wB\u003cbr\u003e\nthis token i got from another account\u003cbr\u003e\nthe real token was \u003cbr\u003e\nAlEqSERKOXKjZfSdw2WtPY4l7n5b68BM\u003c/p\u003e\n\n\u003cp\u003eThis issue make possible to attacker bypass CSRF using his own valid token (for example thru xss). Best practice is:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003etoken from different user do not work on other session\u003c/li\u003e\n\u003cli\u003eand much better if token change on each request\u003c/li\u003e\n\u003c/ul\u003e\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-04-03T14:03:35.862Z","allow_singular_disclosure_after":-181151986.7907185,"singular_disclosure_allowed":true,"vote_count":1,"voters":["spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":329626,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey,\n\nThanks for sending this in. I can indeed confirm the X-CSRF token will also work using another token (in fact, it just seems to check whether it has a valid length, this shouldn't happen), but I'm a bit confused when it comes to the attack scenario: you'd bypass this CSRF protection using an XSS inserting the token of the attacker - but if the attacker can already exploit an XSS, why wouldn't he just use the victim's CSRF token then instead of his?\n\nOr does this trick work elsewhere where an external CSRF (e.g. auto submitting form, get request through image, ...) will work?\n\nThanks\n\nInti","markdown_message":"\u003cp\u003eHey,\u003c/p\u003e\n\n\u003cp\u003eThanks for sending this in. I can indeed confirm the X-CSRF token will also work using another token (in fact, it just seems to check whether it has a valid length, this shouldn\u0026#39;t happen), but I\u0026#39;m a bit confused when it comes to the attack scenario: you\u0026#39;d bypass this CSRF protection using an XSS inserting the token of the attacker - but if the attacker can already exploit an XSS, why wouldn\u0026#39;t he just use the victim\u0026#39;s CSRF token then instead of his?\u003c/p\u003e\n\n\u003cp\u003eOr does this trick work elsewhere where an external CSRF (e.g. auto submitting form, get request through image, ...) will work?\u003c/p\u003e\n\n\u003cp\u003eThanks\u003c/p\u003e\n\n\u003cp\u003eInti\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-10T23:49:51.820Z","updated_at":"2015-02-10T23:49:51.820Z","actor":{"username":"intidc","cleared":true,"url":"/intidc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/322/cb30ac31b7653e73d6dd5a0f0e2cfeed113d2feb_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mobilevikings","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":329768,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"but if the attacker can already exploit an XSS, why wouldn't he just use the victim's CSRF token  - because it is easer to use own token than retrieve it on the user side. I made some test in your system there are three places where token is - header, cookie and post data. And my test shown that all of them should be the same. Although in common case auto form submit should work but only if CSRF token used only in post data. At this time i didn't find forms in the system where used only post data token. In all cases it compared with cookie token. So i think that this issue not good (as i said before attacker can use it's own token), but not really bad because auto form submit is hard to exploit.","markdown_message":"\u003cp\u003ebut if the attacker can already exploit an XSS, why wouldn\u0026#39;t he just use the victim\u0026#39;s CSRF token  - because it is easer to use own token than retrieve it on the user side. I made some test in your system there are three places where token is - header, cookie and post data. And my test shown that all of them should be the same. Although in common case auto form submit should work but only if CSRF token used only in post data. At this time i didn\u0026#39;t find forms in the system where used only post data token. In all cases it compared with cookie token. So i think that this issue not good (as i said before attacker can use it\u0026#39;s own token), but not really bad because auto form submit is hard to exploit.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-11T02:04:50.913Z","updated_at":"2015-02-11T02:04:50.913Z","actor":{"username":"4lemon","cleared":true,"url":"/4lemon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/194/aa0eb7d0d4c0ee7d20ae9b2550953b4eeda26ef9_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mobilevikings","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":330500,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Hey 4lemon,\n\nI took a moment to think about your submission. I see what you are saying (CSRF token does not really get checked in all instances), but as we'd need a working XSS to use this trick, I can't think of any realistic attack scenario. Please correct me if I'm wrong. Facebook sometimes also includes CSRF tokens in their requests without really checking them.\n\nClosing this for now - If ever manage to create an external working PoC with an attack scenario using this technique, I will re-open this bug.\n\nThanks anyways, and if there are any further questions or comments, let me know!\n\nInti","markdown_message":"\u003cp\u003eHey 4lemon,\u003c/p\u003e\n\n\u003cp\u003eI took a moment to think about your submission. I see what you are saying (CSRF token does not really get checked in all instances), but as we\u0026#39;d need a working XSS to use this trick, I can\u0026#39;t think of any realistic attack scenario. Please correct me if I\u0026#39;m wrong. Facebook sometimes also includes CSRF tokens in their requests without really checking them.\u003c/p\u003e\n\n\u003cp\u003eClosing this for now - If ever manage to create an external working PoC with an attack scenario using this technique, I will re-open this bug.\u003c/p\u003e\n\n\u003cp\u003eThanks anyways, and if there are any further questions or comments, let me know!\u003c/p\u003e\n\n\u003cp\u003eInti\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-11T22:34:25.243Z","updated_at":"2015-02-11T22:34:25.243Z","actor":{"username":"intidc","cleared":true,"url":"/intidc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/322/cb30ac31b7653e73d6dd5a0f0e2cfeed113d2feb_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mobilevikings","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":338956,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"Hey @4lemon,\n\nChanged my mind - this shouldn't happen. Will check with our devs how our CSRF system works and whether this can be exploited. \n\nThank you!\n\nInti","markdown_message":"\u003cp\u003eHey \u003ca href=\"/4lemon\"\u003e@4lemon\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eChanged my mind - this shouldn\u0026#39;t happen. Will check with our devs how our CSRF system works and whether this can be exploited. \u003c/p\u003e\n\n\u003cp\u003eThank you!\u003c/p\u003e\n\n\u003cp\u003eInti\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-24T08:45:09.685Z","updated_at":"2015-02-24T08:45:09.685Z","actor":{"username":"intidc","cleared":true,"url":"/intidc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/322/cb30ac31b7653e73d6dd5a0f0e2cfeed113d2feb_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mobilevikings","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":338957,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2015-02-24T08:45:42.143Z","updated_at":"2015-02-24T08:45:42.143Z","actor":{"username":"intidc","cleared":true,"url":"/intidc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/322/cb30ac31b7653e73d6dd5a0f0e2cfeed113d2feb_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mobilevikings","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":344601,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Hi @4lemon,\n\nWe discussed this internally and decided not no fix this one. Note from out developer:\n\n\u003e Django currently compares the content of the csrf cookie with the token in the post data. So, if you're able to set a cookie, this can be abused. However, we're not going to fix this one.\n\nThanks anyways for your great work so far. Keep your reports coming (make sure to take a look at our Viking Point system!)\nIf you have any further concerns to share regarding this issue, don't hesitate to contact me here.\n\nInti","markdown_message":"\u003cp\u003eHi \u003ca href=\"/4lemon\"\u003e@4lemon\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eWe discussed this internally and decided not no fix this one. Note from out developer:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eDjango currently compares the content of the csrf cookie with the token in the post data. So, if you\u0026#39;re able to set a cookie, this can be abused. However, we\u0026#39;re not going to fix this one.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThanks anyways for your great work so far. Keep your reports coming (make sure to take a look at our Viking Point system!)\u003cbr\u003e\nIf you have any further concerns to share regarding this issue, don\u0026#39;t hesitate to contact me here.\u003c/p\u003e\n\n\u003cp\u003eInti\u003c/p\u003e\n","automated_response":false,"created_at":"2015-03-02T20:58:57.219Z","updated_at":"2015-03-02T20:58:57.219Z","actor":{"username":"intidc","cleared":true,"url":"/intidc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/322/cb30ac31b7653e73d6dd5a0f0e2cfeed113d2feb_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mobilevikings","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":345848,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-03-04T14:03:35.575Z","updated_at":"2015-03-04T14:03:35.575Z","first_to_agree":true,"actor":{"username":"4lemon","cleared":true,"url":"/4lemon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/194/aa0eb7d0d4c0ee7d20ae9b2550953b4eeda26ef9_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mobilevikings","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":370869,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-04-03T14:03:59.555Z","updated_at":"2015-04-03T14:03:59.555Z","actor":{"url":"/mobilevikings","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/607/58ac309f0f3fb06a4bdcfe6480d51a32b699b72e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Mobile Vikings"}},"genius_execution_id":null,"team_handle":"mobilevikings","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}