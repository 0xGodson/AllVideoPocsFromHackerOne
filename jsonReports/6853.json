{"id":6853,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82ODUz","url":"https://hackerone.com/reports/6853","title":"XSS on [/concrete/concrete/elements/dashboard/sitemap.php]","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-04-10T19:30:42.072Z","submitted_at":"2014-04-10T19:30:42.072Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"gsalazar","url":"/gsalazar","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":60,"url":"https://hackerone.com/concrete5","handle":"concrete5","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/060/c549a89ab4a3550cb9bfdeba1bee6d77e2019c7e_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/060/c549a89ab4a3550cb9bfdeba1bee6d77e2019c7e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"concrete5","twitter_handle":"concrete5","website":"https://www.concrete5.org","about":"A simple and powerful content management system."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2014-08-28T22:40:56.160Z","bug_reporter_agreed_on_going_public_at":"2014-07-29T22:40:46.925Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Alright, here's the other bug I said I would report. I have found the file that is affected by this bug, which is outlined in the title. The affected file is here - /concrete/concrete/elements/dashboard/sitemap.php\r\n\r\nOn line 40, this section:\r\n\r\n\u003cdiv id=\"tree\" sitemap-wrapper=\"1\" sitemap-select-callback=\"\u003c?php echo $callback?\u003e\"\r\n\r\nPHP echoes the $callback without filtering any user input. Here is the PoC link - \r\n\r\nhttp://localhost/concrete/index.php/tools/required/pages/search_dialog?sitemap_select_mode=%22%3E%3Cscript%3Ealert%280%29%3C/script%3E\r\n\r\nChange localhost/ to wherever you're hosting your concrete installation.\r\n\r\nThat might not be the source of the problem, but I used grep to find the place where it was echoed.\r\n\r\nThank you.\r\n\r\n","vulnerability_information_html":"\u003cp\u003eAlright, here\u0026#39;s the other bug I said I would report. I have found the file that is affected by this bug, which is outlined in the title. The affected file is here - /concrete/concrete/elements/dashboard/sitemap.php\u003c/p\u003e\n\n\u003cp\u003eOn line 40, this section:\u003c/p\u003e\n\n\u003cp\u003e\u0026lt;div id=\u0026quot;tree\u0026quot; sitemap-wrapper=\u0026quot;1\u0026quot; sitemap-select-callback=\u0026quot;\u0026lt;?php echo $callback?\u0026gt;\u0026quot;\u003c/p\u003e\n\n\u003cp\u003ePHP echoes the $callback without filtering any user input. Here is the PoC link - \u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"http://localhost/concrete/index.php/tools/required/pages/search_dialog?sitemap_select_mode=%22%3E%3Cscript%3Ealert%280%29%3C/script%3E\" href=\"/redirect?url=http%3A%2F%2Flocalhost%2Fconcrete%2Findex.php%2Ftools%2Frequired%2Fpages%2Fsearch_dialog%3Fsitemap_select_mode%3D%2522%253E%253Cscript%253Ealert%25280%2529%253C%2Fscript%253E\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://localhost/concrete/index.php/tools/required/pages/search_dialog?sitemap_select_mode=%22%3E%3Cscript%3Ealert%280%29%3C/script%3E\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eChange localhost/ to wherever you\u0026#39;re hosting your concrete installation.\u003c/p\u003e\n\n\u003cp\u003eThat might not be the source of the problem, but I used grep to find the place where it was echoed.\u003c/p\u003e\n\n\u003cp\u003eThank you.\u003c/p\u003e\n","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-08-28T22:40:47.054Z","allow_singular_disclosure_after":-199958230.64332804,"singular_disclosure_allowed":true,"vote_count":4,"voters":["mygf","harry_mg","an0nym0us","t-4-y-m"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":28821,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello again,\n\nI have discovered that the file I provided is not the source of the problem, but rather the file [/concrete/concrete/tools/pages/search_dialog.php] is the file that contains the issue. I have been able to patch this issue on my own installation of concrete5 stable, and the issue is no longer present since.\n\nThis section on the [search_dialog.php] on line 47 contains the bug.\n\n`\u003c?php Loader::element('pages/search_results', array('columns' =\u003e $columns, 'searchInstance' =\u003e $searchInstance, 'sitemap_select_callback' =\u003e $sitemap_select_callback, 'sitemap_select_mode' =\u003e $sitemap_select_mode, 'searchDialog' =\u003e true, 'pages' =\u003e $pages, 'pageList' =\u003e $pageList, 'pagination' =\u003e $pagination)); ?\u003e`\n\nThe $sitemap_select_mode parameter goes unfiltered, and to remedy that situation, we could add htmlspecialchars() in front of $sitemap_select_mode to successfully filter out malicious input.\n\nHere is the fixed section - \n\n`\u003c?php Loader::element('pages/search_results', array('columns' =\u003e $columns, 'searchInstance' =\u003e $searchInstance, 'sitemap_select_callback' =\u003e $sitemap_select_callback, 'sitemap_select_mode' =\u003e htmlspecialchars($sitemap_select_mode), 'searchDialog' =\u003e true, 'pages' =\u003e $pages, 'pageList' =\u003e $pageList, 'pagination' =\u003e $pagination)); ?\u003e`\n\nThank you for reading this, and fixing it too.\n","markdown_message":"\u003cp\u003eHello again,\u003c/p\u003e\n\n\u003cp\u003eI have discovered that the file I provided is not the source of the problem, but rather the file [/concrete/concrete/tools/pages/search_dialog.php] is the file that contains the issue. I have been able to patch this issue on my own installation of concrete5 stable, and the issue is no longer present since.\u003c/p\u003e\n\n\u003cp\u003eThis section on the [search_dialog.php] on line 47 contains the bug.\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e\u0026lt;?php Loader::element(\u0026#39;pages/search_results\u0026#39;, array(\u0026#39;columns\u0026#39; =\u0026gt; $columns, \u0026#39;searchInstance\u0026#39; =\u0026gt; $searchInstance, \u0026#39;sitemap_select_callback\u0026#39; =\u0026gt; $sitemap_select_callback, \u0026#39;sitemap_select_mode\u0026#39; =\u0026gt; $sitemap_select_mode, \u0026#39;searchDialog\u0026#39; =\u0026gt; true, \u0026#39;pages\u0026#39; =\u0026gt; $pages, \u0026#39;pageList\u0026#39; =\u0026gt; $pageList, \u0026#39;pagination\u0026#39; =\u0026gt; $pagination)); ?\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eThe $sitemap_select_mode parameter goes unfiltered, and to remedy that situation, we could add htmlspecialchars() in front of $sitemap_select_mode to successfully filter out malicious input.\u003c/p\u003e\n\n\u003cp\u003eHere is the fixed section - \u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e\u0026lt;?php Loader::element(\u0026#39;pages/search_results\u0026#39;, array(\u0026#39;columns\u0026#39; =\u0026gt; $columns, \u0026#39;searchInstance\u0026#39; =\u0026gt; $searchInstance, \u0026#39;sitemap_select_callback\u0026#39; =\u0026gt; $sitemap_select_callback, \u0026#39;sitemap_select_mode\u0026#39; =\u0026gt; htmlspecialchars($sitemap_select_mode), \u0026#39;searchDialog\u0026#39; =\u0026gt; true, \u0026#39;pages\u0026#39; =\u0026gt; $pages, \u0026#39;pageList\u0026#39; =\u0026gt; $pageList, \u0026#39;pagination\u0026#39; =\u0026gt; $pagination)); ?\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eThank you for reading this, and fixing it too.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-11T14:56:26.032Z","updated_at":"2014-04-11T14:56:26.032Z","actor":{"username":"gsalazar","cleared":false,"url":"/gsalazar","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":30394,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Awesome, thank you for this!\nPlease send an address that can receive mail to security@concrete5.org with a link to this report.\nBest wishes,\nKorvin","markdown_message":"\u003cp\u003eAwesome, thank you for this!\u003cbr\u003e\nPlease send an address that can receive mail to \u003ca title=\"security@concrete5.org\" href=\"mailto:security@concrete5.org\" rel=\"nofollow noopener noreferrer\"\u003esecurity@concrete5.org\u003c/a\u003e with a link to this report.\u003cbr\u003e\nBest wishes,\u003cbr\u003e\nKorvin\u003c/p\u003e\n","automated_response":false,"created_at":"2014-04-14T19:47:38.554Z","updated_at":"2014-04-14T19:47:38.554Z","actor":{"username":"korvin","cleared":false,"url":"/korvin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yi9xvfnDmjKpKA1reqNSwGct/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":97905,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"https://github.com/concrete5/concrete5/commit/971340cc660c70dd121253f7efb109bc4ae3a506\n\nBest wishes,\nKorvin","markdown_message":"\u003cp\u003e\u003ca title=\"https://github.com/concrete5/concrete5/commit/971340cc660c70dd121253f7efb109bc4ae3a506\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fconcrete5%2Fconcrete5%2Fcommit%2F971340cc660c70dd121253f7efb109bc4ae3a506\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/concrete5/concrete5/commit/971340cc660c70dd121253f7efb109bc4ae3a506\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eBest wishes,\u003cbr\u003e\nKorvin\u003c/p\u003e\n","automated_response":false,"created_at":"2014-07-29T21:30:58.253Z","updated_at":"2014-07-29T21:30:58.253Z","actor":{"username":"korvin","cleared":false,"url":"/korvin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yi9xvfnDmjKpKA1reqNSwGct/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"gsalazar","url":"/gsalazar"},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":97937,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-07-29T22:40:46.939Z","updated_at":"2014-07-29T22:40:46.939Z","actor":{"username":"gsalazar","cleared":false,"url":"/gsalazar","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":117096,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-08-28T22:40:56.171Z","updated_at":"2014-08-28T22:40:56.171Z","actor":{"url":"/concrete5","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/060/c549a89ab4a3550cb9bfdeba1bee6d77e2019c7e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"concrete5"}},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}