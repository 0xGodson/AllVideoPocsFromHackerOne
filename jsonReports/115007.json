{"id":115007,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTUwMDc=","url":"https://hackerone.com/reports/115007","title":"Race conditions can be used to bypass invitation limit","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-02-06T01:41:33.280Z","submitted_at":"2016-02-06T01:41:33.280Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"franjkovic","url":"/franjkovic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/194/1e20cd6e4a20863ffe9f6f0601ab3ed347bc852b_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2809,"url":"https://hackerone.com/keybase","handle":"keybase","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Keybase","twitter_handle":"keybaseio","website":"https://keybase.io","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-08-10T19:47:01.886Z","bug_reporter_agreed_on_going_public_at":"2016-07-11T19:46:57.579Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nI have received 3 invites from Chris (I might have screwed up the PGP email, but thanks anyway), added to my account https://keybase.io/josipfranjkovic. Using race conditions, I was able to send out a total of 7 invites to my throwaway emails, obviously bypassing the 3 invitations limit. \nHere are the steps to reproduce:\n1. Login to your Keybase account, which has \u003e0 invitations left.\n2. Go to https://keybase.io/account/invitations\n3. Enter an email, and click the invitation button\n4. A POST request will be sent to `/_/api/1.0/send_invitation.json`. Repeat this POST request multiple times in short time frame, and change the `email` POST parameter as needed.\n5. Multiple invitations will be send, bypassing the limit. \n\n(I have reclaimed the invitations for further testing)\n\nBest regards,\n\nJosip\n","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eI have received 3 invites from Chris (I might have screwed up the PGP email, but thanks anyway), added to my account \u003ca title=\"https://keybase.io/josipfranjkovic\" href=\"/redirect?url=https%3A%2F%2Fkeybase.io%2Fjosipfranjkovic\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://keybase.io/josipfranjkovic\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Using race conditions, I was able to send out a total of 7 invites to my throwaway emails, obviously bypassing the 3 invitations limit. \u003cbr\u003e\nHere are the steps to reproduce:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eLogin to your Keybase account, which has \u0026gt;0 invitations left.\u003c/li\u003e\n\u003cli\u003eGo to \u003ca title=\"https://keybase.io/account/invitations\" href=\"/redirect?url=https%3A%2F%2Fkeybase.io%2Faccount%2Finvitations\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://keybase.io/account/invitations\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eEnter an email, and click the invitation button\u003c/li\u003e\n\u003cli\u003eA POST request will be sent to \u003ccode\u003e/_/api/1.0/send_invitation.json\u003c/code\u003e. Repeat this POST request multiple times in short time frame, and change the \u003ccode\u003eemail\u003c/code\u003e POST parameter as needed.\u003c/li\u003e\n\u003cli\u003eMultiple invitations will be send, bypassing the limit. \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e(I have reclaimed the invitations for further testing)\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003c/p\u003e\n\n\u003cp\u003eJosip\u003c/p\u003e\n","bounty_amount":"350.0","formatted_bounty":"$350","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-08-10T19:46:57.734Z","allow_singular_disclosure_after":-138357050.0371445,"singular_disclosure_allowed":true,"vote_count":29,"voters":["michiel","spam404","yaworsk","ngalog","ysx","bugdiscloseguys","peeper35","dpgribkov","franjkovic","zhurig","and 19 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":787314,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just a small update, I have poked around a bit more by trying to use one code to get multiple accounts. It seemed to fail, returning DB errors (sorry about that!). I will delete all the throwaway accounts I have created. ","markdown_message":"\u003cp\u003eJust a small update, I have poked around a bit more by trying to use one code to get multiple accounts. It seemed to fail, returning DB errors (sorry about that!). I will delete all the throwaway accounts I have created. \u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-06T02:05:51.253Z","updated_at":"2016-02-06T02:09:16.098Z","actor":{"username":"franjkovic","cleared":false,"url":"/franjkovic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/194/1e20cd6e4a20863ffe9f6f0601ab3ed347bc852b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":789534,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2016-02-08T18:47:47.892Z","updated_at":"2016-02-08T18:47:47.892Z","actor":{"username":"chriscoyne","cleared":false,"url":"/chriscoyne","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":789535,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I believe I've fixed this. Can you confirm you can't get a race condition on either sending invites or joining now?   (btw, I've sent you more invitations since you exhausted yours in the test before.)\n\n","markdown_message":"\u003cp\u003eI believe I\u0026#39;ve fixed this. Can you confirm you can\u0026#39;t get a race condition on either sending invites or joining now?   (btw, I\u0026#39;ve sent you more invitations since you exhausted yours in the test before.)\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-08T18:50:47.716Z","updated_at":"2016-02-08T18:50:47.716Z","actor":{"username":"chriscoyne","cleared":false,"url":"/chriscoyne","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":790304,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nthis does not seem to be fixed. Here are two screenshots of my account. First screenshot shows my account details before attempting race conditions, with 3 available invites. The next one shows I successfully invited 8 people using those 3 invites (all the `josipwhtestnew` gmail accounts).\n\nAlso, I do not need any more invitations, since I can cancel and re-claim my current invites.\n\nBest regards,\n\nJosip ","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003ethis does not seem to be fixed. Here are two screenshots of my account. First screenshot shows my account details before attempting race conditions, with 3 available invites. The next one shows I successfully invited 8 people using those 3 invites (all the \u003ccode\u003ejosipwhtestnew\u003c/code\u003e gmail accounts).\u003c/p\u003e\n\n\u003cp\u003eAlso, I do not need any more invitations, since I can cancel and re-claim my current invites.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003c/p\u003e\n\n\u003cp\u003eJosip \u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-09T10:04:14.097Z","updated_at":"2016-02-09T10:04:14.097Z","actor":{"username":"franjkovic","cleared":false,"url":"/franjkovic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/194/1e20cd6e4a20863ffe9f6f0601ab3ed347bc852b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":72740,"filename":"keybase-after.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/072/740/1e29348d9401aea0e501ecd6e8cac01e5c72852b/keybase-after.png?response-content-disposition=attachment%3B%20filename%3D%22keybase-after.png%22%3B%20filename%2A%3DUTF-8%27%27keybase-after.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSC5UFWXL%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T041747Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCwK%2B%2BlMufFx2twThN55FpWvSNFMRcTw6DIMXMwu3SRJgIgbfhKiC5W8N8YFQB0Nj1%2Boe6pAlr8Ti%2FvGEEHHH13JNkqtAMIUxABGgwwMTM2MTkyNzQ4NDkiDKRKppBQcflzJsWylyqRAzVMKZ6jWFrSD2Y9kWok2waN0zNoEyuNoms1kUC37gd2cWniMYOCGZa9pHJ%2BTGOcJDE8mr7X3wJV03PeWNx%2FJ3x1t1adSeplF3kKkxVzwMpsJiOYMPMNaXbK6aN%2FVxaTTjwIHJMTw7ej%2BNad1lrBkNYM8xmTFPzJdlIn3krUMQVcm66POZCl3IpgIriUdvRQsdjWZjnf%2FUXejEcDwlys5fmmpAap4FXWkuE4xPD5JITrqd71Zc4guVr49IYqaJ9P8ZOa39l8Cm9yOfvHOdc%2FHHkeb3dhc64lVpxLQxnIzdRkUBVcVDfLrNaCOxpa9K0SDMt9HK%2B6%2F6SozxEKFb7iD2%2BQkM42Rwtm3vBMeKEUDeFG3yO5gW6KJtirosz7Y3m8DdEylt%2F8air6KKuH0wjD%2B9LfO7%2FWKZCn3h7tRVYtr71OXTcV4jMC7Q6El1VpYoy1%2FUyJLt0VlyMhH1u00hOd2Ed613mjv9Lq0b8iTU4W3vlCcM%2FtjGgBfI2lPMbp3cacOsLTQtiqUw%2FMXKZM7aikuuh%2BML6aqv8FOusBAaUZsZRvtcfsxqJAwQO39V21wLoeubOAIV%2BtvLyfXzwltZABeAGkBPYy8xl5ryQb8Y%2BKG%2FfwUfCGsCxtOppNqsZCDg0JzwPVO8CdiGO1QqRKJpkb23agNpWEIAa8FY4BpDjQUZHUIl4jWVfFWH2sizzpICjQxnSI3JQpi2%2B9GAdI3gAmweVyhKgicRGn9QyAfoRtqO3YWntGA8EeCXAhyWW%2BxebF5JNSGoYhvM72O00zG1YKAYz%2F6ymrbrJmLpZ0WbBqG4d2%2BRi9F0TVfiKq0rdWihYUV%2FstwlGLcPIVuYIDnBH4oA5HYk7pFw%3D%3D\u0026X-Amz-Signature=a362583168c9e50b0918dc5d1fcaf9bd81d5d873e0aca7f42fd4a63a606b348e"},{"id":72739,"filename":"keybase-before.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/072/739/5248e7a658806614b6fb9b625eae4c2d25f22010/keybase-before.png?response-content-disposition=attachment%3B%20filename%3D%22keybase-before.png%22%3B%20filename%2A%3DUTF-8%27%27keybase-before.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSC5UFWXL%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T041747Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCwK%2B%2BlMufFx2twThN55FpWvSNFMRcTw6DIMXMwu3SRJgIgbfhKiC5W8N8YFQB0Nj1%2Boe6pAlr8Ti%2FvGEEHHH13JNkqtAMIUxABGgwwMTM2MTkyNzQ4NDkiDKRKppBQcflzJsWylyqRAzVMKZ6jWFrSD2Y9kWok2waN0zNoEyuNoms1kUC37gd2cWniMYOCGZa9pHJ%2BTGOcJDE8mr7X3wJV03PeWNx%2FJ3x1t1adSeplF3kKkxVzwMpsJiOYMPMNaXbK6aN%2FVxaTTjwIHJMTw7ej%2BNad1lrBkNYM8xmTFPzJdlIn3krUMQVcm66POZCl3IpgIriUdvRQsdjWZjnf%2FUXejEcDwlys5fmmpAap4FXWkuE4xPD5JITrqd71Zc4guVr49IYqaJ9P8ZOa39l8Cm9yOfvHOdc%2FHHkeb3dhc64lVpxLQxnIzdRkUBVcVDfLrNaCOxpa9K0SDMt9HK%2B6%2F6SozxEKFb7iD2%2BQkM42Rwtm3vBMeKEUDeFG3yO5gW6KJtirosz7Y3m8DdEylt%2F8air6KKuH0wjD%2B9LfO7%2FWKZCn3h7tRVYtr71OXTcV4jMC7Q6El1VpYoy1%2FUyJLt0VlyMhH1u00hOd2Ed613mjv9Lq0b8iTU4W3vlCcM%2FtjGgBfI2lPMbp3cacOsLTQtiqUw%2FMXKZM7aikuuh%2BML6aqv8FOusBAaUZsZRvtcfsxqJAwQO39V21wLoeubOAIV%2BtvLyfXzwltZABeAGkBPYy8xl5ryQb8Y%2BKG%2FfwUfCGsCxtOppNqsZCDg0JzwPVO8CdiGO1QqRKJpkb23agNpWEIAa8FY4BpDjQUZHUIl4jWVfFWH2sizzpICjQxnSI3JQpi2%2B9GAdI3gAmweVyhKgicRGn9QyAfoRtqO3YWntGA8EeCXAhyWW%2BxebF5JNSGoYhvM72O00zG1YKAYz%2F6ymrbrJmLpZ0WbBqG4d2%2BRi9F0TVfiKq0rdWihYUV%2FstwlGLcPIVuYIDnBH4oA5HYk7pFw%3D%3D\u0026X-Amz-Signature=feedcd14959e7f62f6431f05af8f3fdd07c4e8639aff9748c5e436716cd50335"}],"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":790674,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Alas! My bug fix had a bug. Can you confirm now?","markdown_message":"\u003cp\u003eAlas! My bug fix had a bug. Can you confirm now?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-09T14:24:31.038Z","updated_at":"2016-02-09T14:24:31.038Z","actor":{"username":"chriscoyne","cleared":false,"url":"/chriscoyne","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":791978,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nstill not fixed. Just re-did my test with one invitation left, managed to invite 6 people. Is there any way I can help you with fixing this? \nThe newly invited emails are `josipnewwh[1,2,3,4,5,7]@gmail.com`.\n\nBest regards,\n\nJosip","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003estill not fixed. Just re-did my test with one invitation left, managed to invite 6 people. Is there any way I can help you with fixing this? \u003cbr\u003e\nThe newly invited emails are \u003ccode\u003ejosipnewwh[1,2,3,4,5,7]@gmail.com\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003c/p\u003e\n\n\u003cp\u003eJosip\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-09T20:24:13.620Z","updated_at":"2016-02-09T20:24:13.620Z","actor":{"username":"franjkovic","cleared":false,"url":"/franjkovic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/194/1e20cd6e4a20863ffe9f6f0601ab3ed347bc852b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":792413,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"hah, I found the problem! Not worth explaining, but my fix exposed a different, unrelated bug. So...2 bugs fixed at once. Can you confirm, finally, that this is fixed? I think we should be good, as I ultimately wrote and tested my own code to cause the race condition.","markdown_message":"\u003cp\u003ehah, I found the problem! Not worth explaining, but my fix exposed a different, unrelated bug. So...2 bugs fixed at once. Can you confirm, finally, that this is fixed? I think we should be good, as I ultimately wrote and tested my own code to cause the race condition.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-10T02:00:51.132Z","updated_at":"2016-02-10T02:00:51.132Z","actor":{"username":"chriscoyne","cleared":false,"url":"/chriscoyne","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":792539,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nConfirming this is now fixed. I am curious what the bug was, since I sometimes had trouble fixing race conditions too - I understand if you do not want to share it. \n\nI now have a total of 16 invitations left on my main account https://keybase.io/josipfranjkovic, perhaps you want to reduce this to the original 3? \n\nBest regards,\n\nJosip","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eConfirming this is now fixed. I am curious what the bug was, since I sometimes had trouble fixing race conditions too - I understand if you do not want to share it. \u003c/p\u003e\n\n\u003cp\u003eI now have a total of 16 invitations left on my main account \u003ca title=\"https://keybase.io/josipfranjkovic\" href=\"/redirect?url=https%3A%2F%2Fkeybase.io%2Fjosipfranjkovic\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://keybase.io/josipfranjkovic\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, perhaps you want to reduce this to the original 3? \u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003c/p\u003e\n\n\u003cp\u003eJosip\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-10T08:51:27.260Z","updated_at":"2016-02-10T08:54:43.745Z","actor":{"username":"franjkovic","cleared":false,"url":"/franjkovic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/194/1e20cd6e4a20863ffe9f6f0601ab3ed347bc852b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":792830,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-02-10T13:32:45.452Z","updated_at":"2016-02-10T13:32:45.452Z","actor":{"url":"/keybase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Keybase"}},"bounty_amount":"350.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"keybase","collaborator":{"username":"franjkovic","url":"/franjkovic"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":792853,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Josip - thanks for your help tracking this down.\n\nWell, the first bug was simply that I needed to create a per-user lock on some steps that didn't fit conveniently into a database transaction. So original buggy code did something like this:\n\n1. look up some stuff about user, including invitation availability\n2. process the request\n\nYou can imagine the race condition.\n\nI changed the code to:\n\n1. acquire (wait for, if necessary) a lock for this specific user's invitation sending\n2. do steps 1 and 2 above\n3. release lock\n\nIt was pretty straightforward. The reason my bug fix didn't work is because...embarrassingly...I had done a refactor of the invitation code a couple months ago and ended up with 2 identical copies of the same function, with the same name. So I was editing code that simply wasn't running. Bleah.\n\nAnyway, that's the story. Thanks!\n\n","markdown_message":"\u003cp\u003eHi Josip - thanks for your help tracking this down.\u003c/p\u003e\n\n\u003cp\u003eWell, the first bug was simply that I needed to create a per-user lock on some steps that didn\u0026#39;t fit conveniently into a database transaction. So original buggy code did something like this:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003elook up some stuff about user, including invitation availability\u003c/li\u003e\n\u003cli\u003eprocess the request\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eYou can imagine the race condition.\u003c/p\u003e\n\n\u003cp\u003eI changed the code to:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eacquire (wait for, if necessary) a lock for this specific user\u0026#39;s invitation sending\u003c/li\u003e\n\u003cli\u003edo steps 1 and 2 above\u003c/li\u003e\n\u003cli\u003erelease lock\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eIt was pretty straightforward. The reason my bug fix didn\u0026#39;t work is because...embarrassingly...I had done a refactor of the invitation code a couple months ago and ended up with 2 identical copies of the same function, with the same name. So I was editing code that simply wasn\u0026#39;t running. Bleah.\u003c/p\u003e\n\n\u003cp\u003eAnyway, that\u0026#39;s the story. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-10T13:37:20.813Z","updated_at":"2016-02-10T13:37:20.813Z","actor":{"username":"chriscoyne","cleared":false,"url":"/chriscoyne","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":793045,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, \n\nthanks for the bounty.\nI must say this is one of most pleasant bug bounty experiences I have ever had - fast response and fix, and the extra step for explanation. Good job!\n\nBest regards,\n\nJosip","markdown_message":"\u003cp\u003eHi, \u003c/p\u003e\n\n\u003cp\u003ethanks for the bounty.\u003cbr\u003e\nI must say this is one of most pleasant bug bounty experiences I have ever had - fast response and fix, and the extra step for explanation. Good job!\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003c/p\u003e\n\n\u003cp\u003eJosip\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-10T15:46:22.813Z","updated_at":"2016-02-10T15:47:32.464Z","actor":{"username":"franjkovic","cleared":false,"url":"/franjkovic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/194/1e20cd6e4a20863ffe9f6f0601ab3ed347bc852b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":793227,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Excellent! Oh, and in answer to your q, you can keep the extra invites.","markdown_message":"\u003cp\u003eExcellent! Oh, and in answer to your q, you can keep the extra invites.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-10T17:55:36.981Z","updated_at":"2016-02-10T17:55:36.981Z","actor":{"username":"chriscoyne","cleared":false,"url":"/chriscoyne","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":904456,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\ncan we change this to resolved / closed? I would like to include this report in a blog post I will publish in ~3 weeks.\n\nBest regards,\n\nJosip","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003ecan we change this to resolved / closed? I would like to include this report in a blog post I will publish in ~3 weeks.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003c/p\u003e\n\n\u003cp\u003eJosip\u003c/p\u003e\n","automated_response":false,"created_at":"2016-04-13T22:23:40.508Z","updated_at":"2016-04-13T22:23:40.508Z","actor":{"username":"franjkovic","cleared":false,"url":"/franjkovic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/194/1e20cd6e4a20863ffe9f6f0601ab3ed347bc852b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":904458,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-04-13T22:24:51.286Z","updated_at":"2016-04-13T22:24:51.286Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"franjkovic","url":"/franjkovic"},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":904459,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry for the lag, we just never closed the loop and pushed the closed button.\n","markdown_message":"\u003cp\u003eSorry for the lag, we just never closed the loop and pushed the closed button.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-04-13T22:25:21.436Z","updated_at":"2016-04-13T22:25:21.436Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1063729,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-11T19:46:57.659Z","updated_at":"2016-07-11T19:46:57.659Z","first_to_agree":true,"actor":{"username":"franjkovic","cleared":false,"url":"/franjkovic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/194/1e20cd6e4a20863ffe9f6f0601ab3ed347bc852b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1117875,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-10T19:47:02.037Z","updated_at":"2016-08-10T19:47:02.037Z","actor":{"url":"/keybase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Keybase"}},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}