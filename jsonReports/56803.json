{"id":56803,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81NjgwMw==","url":"https://hackerone.com/reports/56803","title":"XSS in version history of an HTML file in a shared folder","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2015-04-16T22:53:27.702Z","submitted_at":"2015-04-16T22:53:27.702Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"haquaman","url":"/haquaman","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":461,"url":"https://hackerone.com/dropbox","handle":"dropbox","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/461/76f193964f418c594dd74ae1326cf4d9223f481b_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/461/76f193964f418c594dd74ae1326cf4d9223f481b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Dropbox","twitter_handle":"","website":"https://www.dropbox.com","about":"Your stuff, anywhere"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2015-04-17T15:40:42.116Z","bug_reporter_agreed_on_going_public_at":"2015-04-16T23:31:39.628Z","team_member_agreed_on_going_public_at":"2015-04-17T15:40:41.153Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Note, the shared folder part of this bug isn't necessary for this exploit, but shows a proof of concept on how you can exploit other users.\r\n\r\nThis bug is a [cross site scripting vulnerablity](https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29) (XSS), which allows arbitrary scripts (commonly javascript) supplied by an attacker to be run within the context of the victims browser.\r\n\r\nSteps to reproduce:\r\n\r\n1. Create a dropbox account\r\n2. Create a folder\r\n3. Invite victim to collaborate with new folder ([instructions](https://www.dropbox.com/en/help/19)).\r\n4. Create a file called test.html within the folder with the contents below.\r\n\r\n    \u003chtml\u003e\u003cbody\u003e\u003cscript\u003ealert(document.domain);\u003c/body\u003e\u003c/html\u003e\r\n\r\nFor victim to run the exploit, they need to take the following steps\r\n\r\n1. Accept invitation to collaborate\r\n2. Open shared folder, select the file test.html (not to preview, just to the side of the name, so that you can do next step).\r\n3. Above file listings, the option \"Previous versions\" should be available, click on that\r\n4. Click on the vulnerable version, it should open a URL such as https://dl-web.dropbox.com/get/sharedfoldername/test.html?some unique parameters\r\n5. Observe XSS alert (would be more malicious in practise). Note that the domain is dl-web.dropbox.domain, which is included in the bounty brief as *.dropbox.com\r\n\r\nNote that you don't *need* to share the folder, the original user can see the exploit, but would be considered Self-XSS, so the sharing is needed to make this attack possible on other drop box users.\r\n\r\nNote that any filetype that would be rendered by the browser and can run scripts is fine, such as svg, xhtml, etc.\r\n\r\nIf requested, I can make a screencast and/or screenshots of this vulnerability.\r\n\r\nThank you for your time in reading this report, please let me know if you have any questions or clarifications needed.\r\n\r\nCheers,\r\n\r\nHugh","vulnerability_information_html":"\u003cp\u003eNote, the shared folder part of this bug isn\u0026#39;t necessary for this exploit, but shows a proof of concept on how you can exploit other users.\u003c/p\u003e\n\n\u003cp\u003eThis bug is a \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.owasp.org%2Findex.php%2FCross-site_Scripting_%2528XSS%2529\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ecross site scripting vulnerablity\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (XSS), which allows arbitrary scripts (commonly javascript) supplied by an attacker to be run within the context of the victims browser.\u003c/p\u003e\n\n\u003cp\u003eSteps to reproduce:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eCreate a dropbox account\u003c/li\u003e\n\u003cli\u003eCreate a folder\u003c/li\u003e\n\u003cli\u003eInvite victim to collaborate with new folder (\u003ca href=\"/redirect?url=https%3A%2F%2Fwww.dropbox.com%2Fen%2Fhelp%2F19\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003einstructions\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e).\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCreate a file called test.html within the folder with the contents below.\u003c/p\u003e\n\n\u003cp\u003e\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;\u0026lt;script\u0026gt;alert(document.domain);\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eFor victim to run the exploit, they need to take the following steps\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAccept invitation to collaborate\u003c/li\u003e\n\u003cli\u003eOpen shared folder, select the file test.html (not to preview, just to the side of the name, so that you can do next step).\u003c/li\u003e\n\u003cli\u003eAbove file listings, the option \u0026quot;Previous versions\u0026quot; should be available, click on that\u003c/li\u003e\n\u003cli\u003eClick on the vulnerable version, it should open a URL such as \u003ca title=\"https://dl-web.dropbox.com/get/sharedfoldername/test.html?some\" href=\"/redirect?url=https%3A%2F%2Fdl-web.dropbox.com%2Fget%2Fsharedfoldername%2Ftest.html%3Fsome\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://dl-web.dropbox.com/get/sharedfoldername/test.html?some\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e unique parameters\u003c/li\u003e\n\u003cli\u003eObserve XSS alert (would be more malicious in practise). Note that the domain is dl-web.dropbox.domain, which is included in the bounty brief as *.dropbox.com\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eNote that you don\u0026#39;t \u003cem\u003eneed\u003c/em\u003e to share the folder, the original user can see the exploit, but would be considered Self-XSS, so the sharing is needed to make this attack possible on other drop box users.\u003c/p\u003e\n\n\u003cp\u003eNote that any filetype that would be rendered by the browser and can run scripts is fine, such as svg, xhtml, etc.\u003c/p\u003e\n\n\u003cp\u003eIf requested, I can make a screencast and/or screenshots of this vulnerability.\u003c/p\u003e\n\n\u003cp\u003eThank you for your time in reading this report, please let me know if you have any questions or clarifications needed.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eHugh\u003c/p\u003e\n","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-05-16T23:31:39.936Z","allow_singular_disclosure_after":-177403806.11561504,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":382719,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Hi Hugh\n\nThanks for reporting. Unfortunately, this requires quite a few steps from the attacker to convince the victim and we do not consider this a high enough risk to mitigate. Mitigating this would also break many useful scenarios for the user. While dl-web XSS is in scope, an XSS would need to succeed without requiring the user to click and open it in a separate tab etc.\n\nThanks for the report and I look forward to working with you on more reports.","markdown_message":"\u003cp\u003eHi Hugh\u003c/p\u003e\n\n\u003cp\u003eThanks for reporting. Unfortunately, this requires quite a few steps from the attacker to convince the victim and we do not consider this a high enough risk to mitigate. Mitigating this would also break many useful scenarios for the user. While dl-web XSS is in scope, an XSS would need to succeed without requiring the user to click and open it in a separate tab etc.\u003c/p\u003e\n\n\u003cp\u003eThanks for the report and I look forward to working with you on more reports.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-16T22:58:52.773Z","updated_at":"2015-04-16T22:58:52.773Z","actor":{"username":"devd","cleared":false,"url":"/devd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/376/241e11c4ddebe1e81cd547edaae1532bbed268aa_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":382723,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi devd,\n\nPity about that. I would have thought it could be a reasonable scenario to have an existing shared folder with legitimate content in it, then change then delete (so user would click on previous version thus get XSS).\n\nYou don't need to do anything special to open it in a separate tab also, just a normal click worked for me (on the version history page). I can give a screencast/screenshot to clarify if you think I'm looking at a different place.\n\nIf you truly believe that this is a wont fix, would you be able to update the bounty brief to outline that you won't award bounties on the web-dl domain if they require too many (2, 1 from a legitimate dropbox page) user clicks. Otherwise other researchers may be wasting time looking for things that seem valid by your current bounty then get rejected. If keeping as wont fix, care to disclose?\n\nAny chance of reconsidering, maybe after more than 5 minutes investigation?\n\nCheers,\n\nHugh","markdown_message":"\u003cp\u003eHi devd,\u003c/p\u003e\n\n\u003cp\u003ePity about that. I would have thought it could be a reasonable scenario to have an existing shared folder with legitimate content in it, then change then delete (so user would click on previous version thus get XSS).\u003c/p\u003e\n\n\u003cp\u003eYou don\u0026#39;t need to do anything special to open it in a separate tab also, just a normal click worked for me (on the version history page). I can give a screencast/screenshot to clarify if you think I\u0026#39;m looking at a different place.\u003c/p\u003e\n\n\u003cp\u003eIf you truly believe that this is a wont fix, would you be able to update the bounty brief to outline that you won\u0026#39;t award bounties on the web-dl domain if they require too many (2, 1 from a legitimate dropbox page) user clicks. Otherwise other researchers may be wasting time looking for things that seem valid by your current bounty then get rejected. If keeping as wont fix, care to disclose?\u003c/p\u003e\n\n\u003cp\u003eAny chance of reconsidering, maybe after more than 5 minutes investigation?\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eHugh\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-16T23:06:12.845Z","updated_at":"2015-04-16T23:06:12.845Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":382728,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Good point about updating the brief. I will do that.\n\nWhile it looks like a 5min investigation, this is something that has been reported multiple times in the past and we have investigated and tried a few tricks. It is tricky to implement this without affecting user functionality and given all the steps required, we have classified it as low risk.\n\nSorry about that and I look forward to other reports from you!","markdown_message":"\u003cp\u003eGood point about updating the brief. I will do that.\u003c/p\u003e\n\n\u003cp\u003eWhile it looks like a 5min investigation, this is something that has been reported multiple times in the past and we have investigated and tried a few tricks. It is tricky to implement this without affecting user functionality and given all the steps required, we have classified it as low risk.\u003c/p\u003e\n\n\u003cp\u003eSorry about that and I look forward to other reports from you!\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-16T23:11:09.959Z","updated_at":"2015-04-16T23:11:09.959Z","actor":{"username":"devd","cleared":false,"url":"/devd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/376/241e11c4ddebe1e81cd547edaae1532bbed268aa_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":382737,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"One simple thing I would suggest is to force download (not display) of mimetypes that allow scripts in it (html, xhtml, svg, etc), using a header such as Content-disposition: attachment; filename=test.html\". \n\nOr using a html purifier to strip out the nasties in the preview.\n\nOr just use the iframe sandbox you already use for the normal preview (disallows scripts, and gives following message (in chrome).\n\n    Blocked script execution in 'https://dl-web.dropbox.com/get/....' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.\n\nTbh, sounds like you already have implemented this for the main preview, so doing the same here shouldn't affect user functionality, but I don't know the full system so could be wrong.\n    \nWill be good if you updated the bounty brief, sounds like by not doing that many researchers have already wasted their time if this isn't the first report ;)\n\nCheers,\n\nHugh","markdown_message":"\u003cp\u003eOne simple thing I would suggest is to force download (not display) of mimetypes that allow scripts in it (html, xhtml, svg, etc), using a header such as Content-disposition: attachment; filename=test.html\u0026quot;. \u003c/p\u003e\n\n\u003cp\u003eOr using a html purifier to strip out the nasties in the preview.\u003c/p\u003e\n\n\u003cp\u003eOr just use the iframe sandbox you already use for the normal preview (disallows scripts, and gives following message (in chrome).\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eBlocked script execution in \u0026#39;https://dl-web.dropbox.com/get/....\u0026#39; because the document\u0026#39;s frame is sandboxed and the \u0026#39;allow-scripts\u0026#39; permission is not set.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTbh, sounds like you already have implemented this for the main preview, so doing the same here shouldn\u0026#39;t affect user functionality, but I don\u0026#39;t know the full system so could be wrong.\u003c/p\u003e\n\n\u003cp\u003eWill be good if you updated the bounty brief, sounds like by not doing that many researchers have already wasted their time if this isn\u0026#39;t the first report ;)\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eHugh\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-16T23:19:59.749Z","updated_at":"2015-04-16T23:19:59.749Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":382742,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"yeah, updated the brief already. Forcing downloads disrupt the UX and breaks user expectations. While the risk you outlined exists, the number of steps required (accept share from attacker, manually go and open a malicious html file and view its previous versions), reduce the risk significantly. We will consider other mitigations as we continuously reevaluate risk and our product.","markdown_message":"\u003cp\u003eyeah, updated the brief already. Forcing downloads disrupt the UX and breaks user expectations. While the risk you outlined exists, the number of steps required (accept share from attacker, manually go and open a malicious html file and view its previous versions), reduce the risk significantly. We will consider other mitigations as we continuously reevaluate risk and our product.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-16T23:25:13.503Z","updated_at":"2015-04-16T23:25:13.503Z","actor":{"username":"devd","cleared":false,"url":"/devd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/376/241e11c4ddebe1e81cd547edaae1532bbed268aa_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":382746,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Fair point, will leave that to you.\n\nCare to disclose, so people don't try down the same path?\n\nCheers,\n\nHugh","markdown_message":"\u003cp\u003eFair point, will leave that to you.\u003c/p\u003e\n\n\u003cp\u003eCare to disclose, so people don\u0026#39;t try down the same path?\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eHugh\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-16T23:31:39.667Z","updated_at":"2015-04-16T23:31:39.667Z","first_to_agree":true,"actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":382845,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nJust seeing whether you want to disclose. If you do, may as well accept it now, rather than wait for the 30 day timeout.\n\nCheers,\n\nHugh","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eJust seeing whether you want to disclose. If you do, may as well accept it now, rather than wait for the 30 day timeout.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eHugh\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-17T02:41:50.783Z","updated_at":"2015-04-17T02:41:50.783Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":383238,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"sorry for the delay. got busy with other stuff yesterday and missed this in my dashboard (since it was \"closed\" and got filtered out)","markdown_message":"\u003cp\u003esorry for the delay. got busy with other stuff yesterday and missed this in my dashboard (since it was \u0026quot;closed\u0026quot; and got filtered out)\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-17T15:40:41.566Z","updated_at":"2015-04-17T15:40:41.566Z","actor":{"username":"devd","cleared":false,"url":"/devd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/376/241e11c4ddebe1e81cd547edaae1532bbed268aa_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":383239,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-04-17T15:40:42.156Z","updated_at":"2015-04-17T15:40:42.156Z","actor":{"username":"devd","cleared":false,"url":"/devd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/376/241e11c4ddebe1e81cd547edaae1532bbed268aa_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}