{"id":134299,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzQyOTk=","url":"https://hackerone.com/reports/134299","title":"Attacker can post notes on private MR, snippets, and issues","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-04-25T00:06:12.322Z","submitted_at":"2016-04-25T00:06:12.322Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jobert","url":"/jobert","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-05-03T00:59:52.762Z","bug_reporter_agreed_on_going_public_at":"2016-05-03T00:55:10.689Z","team_member_agreed_on_going_public_at":"2016-05-03T00:59:52.691Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Vulnerability details\nBy sending a specially crafted request to the GitLab API, an attacker can post notes on merge requests, snippets, and issues it doesn't have access to. This could execute additional note hooks that were configured by the project administrator.\n\n# Proof of concept\nAs a victim, create a private project. Within this project, create an issue. For this proof of concept, lets state that the issue has ID 1. As an attacker, create a new project that you have access to. In this PoC, the project has ID 2. By referencing a `noteable_id` (polymorphic relation, can be a MR, snippet, or issue) that doesn't belong to a project the attacker has access to, notes can be created for objects that the attacker isn't authorized to access. Here's a cURL command that references project ID 2 and issue ID 1 (which actually belongs to project ID 1):\n\n```bash\ncurl -X POST --header \"PRIVATE-TOKEN: XXXXXXXXXXXX\" \"http://gitlab-instance/api/v3/projects/2/issues/1/notes\" --data \"body=@all%20please%20fix%20this.\"\n```\n\nThe attacker's private token was used to send this request. It posts a note to the issue with ID 1. This method can also be used to give up and down votes. \n\n```json\n{\n  \"id\":1,\n  \"body\":\"@all please fix this.\",\n  \"attachment\":null,\n  \"author\": {\n    \"name\":\"John Doe\",\n    \"username\":\"john\",\n    \"id\":4,\n    \"state\":\"active\",\n    \"avatar_url\":\"http://www.gravatar.com/avatar/8ffb4b6252fa664afc7aeb9f48d1f196?s=80\\u0026d=identicon\",\n    \"web_url\":\"http://gitlab-instance/u/john\"\n  },\n  \"created_at\":\"2016-04-24T23:40:08.112Z\",\n  \"system\":false,\n  \"noteable_id\":1,\n  \"noteable_type\":\"Issue\",\n  \"upvote\":false,\n  \"downvote\":false\n}\n```\n\n# Impact\nThis vulnerability can be used to scare people because it looks like the unauthorized user has access to the issue, snippet, or merge request. I've looked at the notification services to leak the title of the noteable object, but the ACL checks in that class seem to be okay (it doesn't do anything if the mentioned user doesn't have access to the project).","vulnerability_information_html":"\u003ch1 id=\"vulnerability-details\"\u003eVulnerability details\u003c/h1\u003e\n\n\u003cp\u003eBy sending a specially crafted request to the GitLab API, an attacker can post notes on merge requests, snippets, and issues it doesn\u0026#39;t have access to. This could execute additional note hooks that were configured by the project administrator.\u003c/p\u003e\n\n\u003ch1 id=\"proof-of-concept\"\u003eProof of concept\u003c/h1\u003e\n\n\u003cp\u003eAs a victim, create a private project. Within this project, create an issue. For this proof of concept, lets state that the issue has ID 1. As an attacker, create a new project that you have access to. In this PoC, the project has ID 2. By referencing a \u003ccode\u003enoteable_id\u003c/code\u003e (polymorphic relation, can be a MR, snippet, or issue) that doesn\u0026#39;t belong to a project the attacker has access to, notes can be created for objects that the attacker isn\u0026#39;t authorized to access. Here\u0026#39;s a cURL command that references project ID 2 and issue ID 1 (which actually belongs to project ID 1):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003ecurl \u003cspan class=\"nt\"\u003e-X\u003c/span\u003e POST \u003cspan class=\"nt\"\u003e--header\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;PRIVATE-TOKEN: XXXXXXXXXXXX\u0026quot;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;http://gitlab-instance/api/v3/projects/2/issues/1/notes\u0026quot;\u003c/span\u003e \u003cspan class=\"nt\"\u003e--data\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;body=@all%20please%20fix%20this.\u0026quot;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe attacker\u0026#39;s private token was used to send this request. It posts a note to the issue with ID 1. This method can also be used to give up and down votes. \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;body\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;@all please fix this.\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;attachment\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;author\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;John Doe\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;username\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;john\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;state\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;active\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;avatar_url\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;http://www.gravatar.com/avatar/8ffb4b6252fa664afc7aeb9f48d1f196?s=80\u003c/span\u003e\u003cspan class=\"se\"\u003e\\u\u003c/span\u003e\u003cspan class=\"s2\"\u003e0026d=identicon\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;web_url\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;http://gitlab-instance/u/john\u0026quot;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;created_at\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;2016-04-24T23:40:08.112Z\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;system\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;noteable_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;noteable_type\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Issue\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;upvote\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;downvote\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"impact\"\u003eImpact\u003c/h1\u003e\n\n\u003cp\u003eThis vulnerability can be used to scare people because it looks like the unauthorized user has access to the issue, snippet, or merge request. I\u0026#39;ve looked at the notification services to leak the title of the noteable object, but the ACL checks in that class seem to be okay (it doesn\u0026#39;t do anything if the mentioned user doesn\u0026#39;t have access to the project).\u003c/p\u003e\n","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-06-02T00:55:10.742Z","allow_singular_disclosure_after":-144387028.8341241,"singular_disclosure_allowed":true,"vote_count":5,"voters":["eveeez","spetr0x","dyabla","cryptosector","citizenseven"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":925357,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@jobert Thanks! Posted at https://gitlab.com/gitlab-org/gitlab-ce/issues/15577, confidential, will post updates here, etc. :)","markdown_message":"\u003cp\u003e\u003ca href=\"/jobert\"\u003e@jobert\u003c/a\u003e Thanks! Posted at \u003ca title=\"https://gitlab.com/gitlab-org/gitlab-ce/issues/15577\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-org%2Fgitlab-ce%2Fissues%2F15577\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/gitlab-org/gitlab-ce/issues/15577\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, confidential, will post updates here, etc. :)\u003c/p\u003e\n","automated_response":false,"created_at":"2016-04-25T00:37:40.025Z","updated_at":"2016-04-25T00:37:40.025Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":925358,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2016-04-25T00:38:45.654Z","updated_at":"2016-04-25T00:38:45.654Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":937747,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"@jobert The patches that include a fix for this issue [have been released](https://about.gitlab.com/2016/05/02/cve-2016-4340-patches/) and the [acknowledgements page](https://about.gitlab.com/vulnerability-acknowledgements/) has been updated.\n\nFeel free to request public disclosure for this report if you'd like.\n\nThank you again!","markdown_message":"\u003cp\u003e\u003ca href=\"/jobert\"\u003e@jobert\u003c/a\u003e The patches that include a fix for this issue \u003ca href=\"/redirect?url=https%3A%2F%2Fabout.gitlab.com%2F2016%2F05%2F02%2Fcve-2016-4340-patches%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehave been released\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and the \u003ca href=\"/redirect?url=https%3A%2F%2Fabout.gitlab.com%2Fvulnerability-acknowledgements%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eacknowledgements page\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e has been updated.\u003c/p\u003e\n\n\u003cp\u003eFeel free to request public disclosure for this report if you\u0026#39;d like.\u003c/p\u003e\n\n\u003cp\u003eThank you again!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-05-03T00:52:40.635Z","updated_at":"2016-05-03T00:52:40.635Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jobert","url":"/jobert"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":937768,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-03T00:55:10.711Z","updated_at":"2016-05-03T00:55:10.711Z","first_to_agree":true,"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":937784,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-03T00:59:52.720Z","updated_at":"2016-05-03T00:59:52.720Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":937785,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-03T00:59:52.787Z","updated_at":"2016-05-03T00:59:52.787Z","actor":{"username":"rspeicher","cleared":false,"url":"/rspeicher","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/070/800/771703800f32dcb0c5413919f04f19305041dd58_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}