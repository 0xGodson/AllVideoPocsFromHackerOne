{"id":164916,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjQ5MTY=","url":"https://hackerone.com/reports/164916","title":"Same origin policy bypass on e.mail.ru via Cross-Site Flashing","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-09-01T06:58:16.732Z","submitted_at":"2016-09-01T06:58:16.732Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"opnsec","url":"/opnsec","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/871/17ffe7f89623315912b4a69a6441247262583484_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":65,"url":"https://hackerone.com/mailru","handle":"mailru","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Mail.ru","twitter_handle":"mailru","website":"https://corp.mail.ru","about":"Building the Internet since 1998"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-04-02T11:15:20.853Z","bug_reporter_agreed_on_going_public_at":"2018-03-27T21:31:23.556Z","team_member_agreed_on_going_public_at":"2018-04-02T11:15:20.757Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello Mail.Ru Security Team,\n\nThere is a Cross-Site Flashing vulnerability in e.mail.ru. this vulnerability is similar to XSS except it is Flash script execution. Ref : https://www.owasp.org/index.php/Testing_for_Cross_site_flashing_(OTG-CLIENT-008) This allow an attacker to execute requests to the vulnerable subdomain and read source code in the victim browser (with victims cookie and context), which is a Same origin policy bypass vulnerability that leads to info disclosure, CSRF, account takeover...\n\nPOC link :\nhttp://opnsec.com/mailru/mailrugalleryPOC.html\n\nPOC requirements :\n- Flash must be active\n- You must be connected to e.mail.ru\n- Tested on Windows 8/10 with Firefox 47 and Chrome 52\n\nPOC instructions :\n- Open the POC link\n- Wait a few seconds\n- Your mail.ru info will show down including your email, a CSRF token, and details about one of your inbox email (subject, sender and body in html source)\n\n------\nTechnical details :\n\nThe vulnerable SWF file is https://img.imgsmail.ru/r/foto2/galery.swf\n\nthe actionscript contains \n```\nallowdomain(\"*\")\n```\nwhich allow any attacker to access the galery.swf, and make request on his behalf.\n\nhttps://e.mail.ru/crossdomain.xml contains \n```\n\u003callow-access-from domain=\"img.imgsmail.ru\" secure=\"true\"/\u003e\n```\nThis means that the attacker can make request to any e.mail.ru URL on behalf of https://img.imgsmail.ru/r/foto2/galery.swf and read the source code. \n\nThe attacker can extract private info from the source code like user account details, CSRF tokens, emails ...\n\n------\nAttack scenario\n\nThe attacker can create a webpage similar to the POC and send the link to the victim. When the victim opens the POC, if the victim is connected to e.mail.ru, the attacker gains access to the victims info.\n\n------\nMitigation\n\nTo solve this problem you can either :\n- Remove `allowdomain(\"*\")` from https://img.imgsmail.ru/r/foto2/galery.swf\n- Or Remove https://e.mail.ru/crossdomain.xml\n- Or Move  https://img.imgsmail.ru/r/foto2/galery.swf to another subdomain which is not listed in https://e.mail.ru/crossdomain.xml\n\n\nIf you need more info feel free to contact me.\n\nRegards,\n\nEnguerran @opnsec\n","vulnerability_information_html":"\u003cp\u003eHello Mail.Ru Security Team,\u003c/p\u003e\n\n\u003cp\u003eThere is a Cross-Site Flashing vulnerability in e.mail.ru. this vulnerability is similar to XSS except it is Flash script execution. Ref : \u003ca title=\"https://www.owasp.org/index.php/Testing_for_Cross_site_flashing_(OTG-CLIENT-008)\" href=\"/redirect?url=https%3A%2F%2Fwww.owasp.org%2Findex.php%2FTesting_for_Cross_site_flashing_%28OTG-CLIENT-008%29\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.owasp.org/index.php/Testing_for_Cross_site_flashing_(OTG-CLIENT-008)\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e This allow an attacker to execute requests to the vulnerable subdomain and read source code in the victim browser (with victims cookie and context), which is a Same origin policy bypass vulnerability that leads to info disclosure, CSRF, account takeover...\u003c/p\u003e\n\n\u003cp\u003ePOC link :\u003cbr\u003e\n\u003ca title=\"http://opnsec.com/mailru/mailrugalleryPOC.html\" href=\"/redirect?url=http%3A%2F%2Fopnsec.com%2Fmailru%2FmailrugalleryPOC.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://opnsec.com/mailru/mailrugalleryPOC.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePOC requirements :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eFlash must be active\u003c/li\u003e\n\u003cli\u003eYou must be connected to e.mail.ru\u003c/li\u003e\n\u003cli\u003eTested on Windows 8/10 with Firefox 47 and Chrome 52\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ePOC instructions :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eOpen the POC link\u003c/li\u003e\n\u003cli\u003eWait a few seconds\u003c/li\u003e\n\u003cli\u003eYour mail.ru info will show down including your email, a CSRF token, and details about one of your inbox email (subject, sender and body in html source)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eTechnical details :\u003c/p\u003e\n\n\u003cp\u003eThe vulnerable SWF file is \u003ca title=\"https://img.imgsmail.ru/r/foto2/galery.swf\" href=\"/redirect?url=https%3A%2F%2Fimg.imgsmail.ru%2Fr%2Ffoto2%2Fgalery.swf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://img.imgsmail.ru/r/foto2/galery.swf\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ethe actionscript contains \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eallowdomain(\u0026quot;*\u0026quot;)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewhich allow any attacker to access the galery.swf, and make request on his behalf.\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://e.mail.ru/crossdomain.xml\" href=\"/redirect?url=https%3A%2F%2Fe.mail.ru%2Fcrossdomain.xml\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://e.mail.ru/crossdomain.xml\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e contains \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;allow-access-from domain=\u0026quot;img.imgsmail.ru\u0026quot; secure=\u0026quot;true\u0026quot;/\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis means that the attacker can make request to any e.mail.ru URL on behalf of \u003ca title=\"https://img.imgsmail.ru/r/foto2/galery.swf\" href=\"/redirect?url=https%3A%2F%2Fimg.imgsmail.ru%2Fr%2Ffoto2%2Fgalery.swf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://img.imgsmail.ru/r/foto2/galery.swf\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and read the source code. \u003c/p\u003e\n\n\u003cp\u003eThe attacker can extract private info from the source code like user account details, CSRF tokens, emails ...\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eAttack scenario\u003c/p\u003e\n\n\u003cp\u003eThe attacker can create a webpage similar to the POC and send the link to the victim. When the victim opens the POC, if the victim is connected to e.mail.ru, the attacker gains access to the victims info.\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eMitigation\u003c/p\u003e\n\n\u003cp\u003eTo solve this problem you can either :\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eRemove \u003ccode\u003eallowdomain(\u0026quot;*\u0026quot;)\u003c/code\u003e from \u003ca title=\"https://img.imgsmail.ru/r/foto2/galery.swf\" href=\"/redirect?url=https%3A%2F%2Fimg.imgsmail.ru%2Fr%2Ffoto2%2Fgalery.swf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://img.imgsmail.ru/r/foto2/galery.swf\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eOr Remove \u003ca title=\"https://e.mail.ru/crossdomain.xml\" href=\"/redirect?url=https%3A%2F%2Fe.mail.ru%2Fcrossdomain.xml\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://e.mail.ru/crossdomain.xml\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eOr Move  \u003ca title=\"https://img.imgsmail.ru/r/foto2/galery.swf\" href=\"/redirect?url=https%3A%2F%2Fimg.imgsmail.ru%2Fr%2Ffoto2%2Fgalery.swf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://img.imgsmail.ru/r/foto2/galery.swf\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to another subdomain which is not listed in \u003ca title=\"https://e.mail.ru/crossdomain.xml\" href=\"/redirect?url=https%3A%2F%2Fe.mail.ru%2Fcrossdomain.xml\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://e.mail.ru/crossdomain.xml\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIf you need more info feel free to contact me.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003c/p\u003e\n\n\u003cp\u003eEnguerran \u003ca href=\"/opnsec\"\u003e@opnsec\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"750.0","formatted_bounty":"$750","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-04-26T21:31:23.610Z","allow_singular_disclosure_after":-84438434.69005498,"singular_disclosure_allowed":true,"vote_count":15,"voters":["spam404","sameerphad72","meals","asad0x01_","eveeez","apapedulimu","ifrahiman","luigigubello","cr4xerbik4sh","silv3rpoision","and 5 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1167072,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for reporting your bug to Mail.Ru Group!   We appreciate your time for helping us to make our web services safer.\nWe are currently reviewing your submission and will be back in touch soon.","markdown_message":"\u003cp\u003eThank you for reporting your bug to Mail.Ru Group!   We appreciate your time for helping us to make our web services safer.\u003cbr\u003e\nWe are currently reviewing your submission and will be back in touch soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-01T08:42:13.908Z","updated_at":"2016-09-01T08:42:13.908Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1180459,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hello, \n\nbug bounty reward is transferred to your account. You can set payment options and request payout via\nhttps://hackerone.com/settings/bounties\n\nThanks again,\nwaiting for new bug reports from you.\n\nP.S. we have vulnerable flash removed, and still working to resolve this problem in general.","markdown_message":"\u003cp\u003eHello, \u003c/p\u003e\n\n\u003cp\u003ebug bounty reward is transferred to your account. You can set payment options and request payout via\u003cbr\u003e\n\u003ca title=\"https://hackerone.com/settings/bounties\" href=\"https://hackerone.com/settings/bounties\"\u003ehttps://hackerone.com/settings/bounties\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThanks again,\u003cbr\u003e\nwaiting for new bug reports from you.\u003c/p\u003e\n\n\u003cp\u003eP.S. we have vulnerable flash removed, and still working to resolve this problem in general.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-07T16:45:08.169Z","updated_at":"2016-09-07T16:45:08.169Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Mail.ru"}},"bounty_amount":"750.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"mailru","collaborator":{"username":"opnsec","url":"/opnsec"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1200063,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks !","markdown_message":"\u003cp\u003eThanks !\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-16T09:35:43.983Z","updated_at":"2016-09-16T09:35:43.983Z","actor":{"username":"opnsec","cleared":false,"url":"/opnsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/871/17ffe7f89623315912b4a69a6441247262583484_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1385977,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Your bug has been fixed! \nPlease confirm that you are no longer able to reproduce the issue. ","markdown_message":"\u003cp\u003eYour bug has been fixed! \u003cbr\u003e\nPlease confirm that you are no longer able to reproduce the issue. \u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-26T12:46:24.028Z","updated_at":"2016-12-26T12:46:24.028Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"opnsec","url":"/opnsec"},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1391292,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, the issue is fixed from my side.","markdown_message":"\u003cp\u003eHi, the issue is fixed from my side.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-29T21:34:15.654Z","updated_at":"2016-12-29T21:34:15.654Z","actor":{"username":"opnsec","cleared":false,"url":"/opnsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/871/17ffe7f89623315912b4a69a6441247262583484_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2538258,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-27T21:31:23.576Z","updated_at":"2018-03-27T21:31:23.576Z","first_to_agree":true,"actor":{"username":"opnsec","cleared":false,"url":"/opnsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/871/17ffe7f89623315912b4a69a6441247262583484_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2553882,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-02T11:15:20.785Z","updated_at":"2018-04-02T11:15:20.785Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2553883,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-02T11:15:20.877Z","updated_at":"2018-04-02T11:15:20.877Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":7008,"category":"team","content":"Vulnerable gallery.swf on img.imsmail.ru domain allowed crossite access to few domains in bug bounty scope where img.imgsmail.ru was allowed in crossdomain.xml, including Mail and Cloud.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eVulnerable gallery.swf on img.imsmail.ru domain allowed crossite access to few domains in bug bounty scope where img.imgsmail.ru was allowed in crossdomain.xml, including Mail and Cloud.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}