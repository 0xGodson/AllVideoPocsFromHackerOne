{"id":163815,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjM4MTU=","url":"https://hackerone.com/reports/163815","title":"Lack of CSRF token validation at server side","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2016-08-27T13:55:11.557Z","submitted_at":"2016-08-27T13:55:11.557Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"yodha","url":"/yodha","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/QvxNkq9vw1dK4YQdyHYVSRy3/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1868,"url":"https://hackerone.com/gratipay","handle":"gratipay","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/868/a75c6649c5b4671b3cf44160af884a7da9fd0b67_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/868/a75c6649c5b4671b3cf44160af884a7da9fd0b67_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Gratipay","twitter_handle":"Gratipay","website":"https://gratipay.com/","about":"Gratitude? Gratipay! The easiest way for your company to pay for open source."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-07-10T10:00:17.097Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2016-08-27T23:50:25.594Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Description: Gratipay is not validating csrf token at server side for few requests. So csrf protection is not implemented application wide.\n\nProof of concept (Video):https://drive.google.com/file/d/0B8z7y7DxxQbwUHY4YTduYzMxbnc/view?usp=sharing\n\nRecommended Fix:\nFor CSRF Protection:\n1. Each critical operation request must be accompanied with a \"token\"\n•Token is:\n- Long, Random, not repeated for application lifetime.\n- Unique per session or even per operation\n- Part of URL in GET\n- Hidden Field in POST (forms)\n- Attacker cannot know / predict this token and hence cannot create requests to exploit the operation.","vulnerability_information_html":"\u003cp\u003eDescription: Gratipay is not validating csrf token at server side for few requests. So csrf protection is not implemented application wide.\u003c/p\u003e\n\n\u003cp\u003eProof of concept (Video):\u003ca title=\"https://drive.google.com/file/d/0B8z7y7DxxQbwUHY4YTduYzMxbnc/view?usp=sharing\" href=\"/redirect?url=https%3A%2F%2Fdrive.google.com%2Ffile%2Fd%2F0B8z7y7DxxQbwUHY4YTduYzMxbnc%2Fview%3Fusp%3Dsharing\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://drive.google.com/file/d/0B8z7y7DxxQbwUHY4YTduYzMxbnc/view?usp=sharing\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eRecommended Fix:\u003cbr\u003e\nFor CSRF Protection:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eEach critical operation request must be accompanied with a \u0026quot;token\u0026quot;\n•Token is:\u003c/li\u003e\n\u003cli\u003eLong, Random, not repeated for application lifetime.\u003c/li\u003e\n\u003cli\u003eUnique per session or even per operation\u003c/li\u003e\n\u003cli\u003ePart of URL in GET\u003c/li\u003e\n\u003cli\u003eHidden Field in POST (forms)\u003c/li\u003e\n\u003cli\u003eAttacker cannot know / predict this token and hence cannot create requests to exploit the operation.\u003c/li\u003e\n\u003c/ol\u003e\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":1,"voters":["flex0geek"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1157587,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @yodha,\n\nThanks for this report! However, since you're doing a GET request, we don't validate the presence of an CSRF token, [see our code](https://github.com/gratipay/gratipay.com/blob/master/gratipay/security/csrf.py#L49). Did you found a way to bypass this for POST quests of important actions that are made *via* GET?\n\nThanks for making Gratipay a safer place!","markdown_message":"\u003cp\u003eHi \u003ca href=\"/yodha\"\u003e@yodha\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks for this report! However, since you\u0026#39;re doing a GET request, we don\u0026#39;t validate the presence of an CSRF token, \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fgratipay%2Fgratipay.com%2Fblob%2Fmaster%2Fgratipay%2Fsecurity%2Fcsrf.py%23L49\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003esee our code\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Did you found a way to bypass this for POST quests of important actions that are made \u003cem\u003evia\u003c/em\u003e GET?\u003c/p\u003e\n\n\u003cp\u003eThanks for making Gratipay a safer place!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-27T14:13:57.000Z","updated_at":"2016-08-27T14:13:57.000Z","actor":{"username":"nashe_","cleared":false,"url":"/nashe_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1157598,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nashe_\n\nGenerally applications implement the csrf protection application wide and does not limit it for particular request type. After viewing code, I got that you are only validating token for POST.\n\nI would say its not proper csrf implementation. In future, if you implemented method (POST) and it could be changed to GET due to lack of validation, the csrf will easily take place.\n\nYou could plan this as long term fix and keep the Gratipay secure from any CSRF attacks. Please let me know if require any more information from my side.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/nashe_\"\u003e@nashe_\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eGenerally applications implement the csrf protection application wide and does not limit it for particular request type. After viewing code, I got that you are only validating token for POST.\u003c/p\u003e\n\n\u003cp\u003eI would say its not proper csrf implementation. In future, if you implemented method (POST) and it could be changed to GET due to lack of validation, the csrf will easily take place.\u003c/p\u003e\n\n\u003cp\u003eYou could plan this as long term fix and keep the Gratipay secure from any CSRF attacks. Please let me know if require any more information from my side.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-27T14:25:24.907Z","updated_at":"2016-08-27T14:25:24.907Z","actor":{"username":"yodha","cleared":false,"url":"/yodha","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/QvxNkq9vw1dK4YQdyHYVSRy3/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1158036,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"In OWASP's guide, you can find:\n\n\u003e The ideal solution is to only include the CSRF token in POST requests and modify server-side actions that have state changing affect to only respond to POST requests. This is in fact what the RFC 2616 requires for GET requests. If sensitive server-side actions are guaranteed to only ever respond to POST requests, then there is no need to include the token in GET requests. \n\nIt's exactly what we try to achieve: the GET method should be considered as idempotent for all the actions, making the application more uniform and compliant to modern development standards, as well as removing the need for CSRF tokens on GET requests.\n\nIf you found one sensitive action triggered using GET, don't hesitate to open another report!","markdown_message":"\u003cp\u003eIn OWASP\u0026#39;s guide, you can find:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe ideal solution is to only include the CSRF token in POST requests and modify server-side actions that have state changing affect to only respond to POST requests. This is in fact what the RFC 2616 requires for GET requests. If sensitive server-side actions are guaranteed to only ever respond to POST requests, then there is no need to include the token in GET requests. \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eIt\u0026#39;s exactly what we try to achieve: the GET method should be considered as idempotent for all the actions, making the application more uniform and compliant to modern development standards, as well as removing the need for CSRF tokens on GET requests.\u003c/p\u003e\n\n\u003cp\u003eIf you found one sensitive action triggered using GET, don\u0026#39;t hesitate to open another report!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-27T23:50:20.471Z","updated_at":"2016-08-27T23:50:20.471Z","actor":{"username":"nashe_","cleared":false,"url":"/nashe_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1158037,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-27T23:50:25.627Z","updated_at":"2016-08-27T23:50:25.627Z","first_to_agree":true,"actor":{"username":"nashe_","cleared":false,"url":"/nashe_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1819407,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-10T10:00:17.057Z","updated_at":"2017-07-10T10:00:17.057Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}