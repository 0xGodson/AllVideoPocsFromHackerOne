{"id":423797,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MjM3OTc=","url":"https://hackerone.com/reports/423797","title":"Passive stored XSS at broadcast room","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-10-14T19:44:18.147Z","submitted_at":"2018-10-14T19:44:18.147Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"skavans","url":"/skavans","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":30475,"url":"https://hackerone.com/chaturbate","handle":"chaturbate","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/030/475/178c32f60a890eb06ce5d698d44b3eafa35ccf8c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/030/475/178c32f60a890eb06ce5d698d44b3eafa35ccf8c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Chaturbate","twitter_handle":"chaturbate","website":"https://chaturbate.com","about":"The largest online adult cam site"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-11-06T08:11:21.087Z","bug_reporter_agreed_on_going_public_at":"2018-11-01T12:47:26.946Z","team_member_agreed_on_going_public_at":"2018-11-06T08:11:21.009Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-12-01T12:47:27.011Z","allow_singular_disclosure_after":-65552927.51412216,"singular_disclosure_allowed":true,"vote_count":69,"voters":["secator","foobar7","bogdantcaciuc","spam404","mik317","sameerphad72","johndoe1492","mygf","ateek","michan","and 59 more..."],"severity":{"rating":"high","score":8.9,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"changed","confidentiality":"high","integrity":"high","availability":"low"}},"structured_scope":{"databaseId":11722,"asset_type":"URL","asset_identifier":"https://chaturbate.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3479966,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-15T03:44:20.841Z","updated_at":"2018-10-15T03:44:20.841Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3479967,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-15T03:44:43.730Z","updated_at":"2018-10-15T03:44:43.730Z","actor":{"url":"/chaturbate","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/030/475/178c32f60a890eb06ce5d698d44b3eafa35ccf8c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Chaturbate"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"chaturbate","collaborator":{"username":"skavans","url":"/skavans"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3480129,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-15T05:06:35.993Z","updated_at":"2018-10-15T05:06:35.993Z","actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3485862,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-16T00:46:09.332Z","updated_at":"2018-10-16T00:46:09.332Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"skavans","url":"/skavans"},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3489984,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-16T20:38:45.703Z","updated_at":"2018-10-16T20:38:45.703Z","actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3490044,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-16T20:53:42.082Z","updated_at":"2018-10-16T20:53:42.082Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3490058,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-16T20:56:25.045Z","updated_at":"2018-10-16T20:56:25.045Z","actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3491335,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-17T03:13:38.899Z","updated_at":"2018-10-17T03:13:38.899Z","actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3491448,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-17T04:47:20.126Z","updated_at":"2018-10-17T04:47:20.126Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3491563,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-17T06:03:29.289Z","updated_at":"2018-10-17T06:03:29.289Z","actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3569575,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-01T12:47:26.973Z","updated_at":"2018-11-01T12:47:26.973Z","first_to_agree":true,"actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3591762,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-06T08:11:21.032Z","updated_at":"2018-11-06T08:11:21.032Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3591763,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-06T08:11:21.110Z","updated_at":"2018-11-06T08:11:21.110Z","actor":{"username":"williammmllc","cleared":false,"url":"/williammmllc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"chaturbate","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":11537,"category":"team","content":"The hacker found that a specially crafted app names could insert a small amount of data into an A tag's href in the \"Broadcaster is running these apps: \" chat text. Because of the character limit this required multiple successive clicks on different app names, and in the example utilised the room subject. Due to this and that the broadcaster would be required to use specially crafted apps, the scope of attack is limited. We quickly resolved this issue.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eThe hacker found that a specially crafted app names could insert a small amount of data into an A tag\u0026#39;s href in the \u0026quot;Broadcaster is running these apps: \u0026quot; chat text. Because of the character limit this required multiple successive clicks on different app names, and in the example utilised the room subject. Due to this and that the broadcaster would be required to use specially crafted apps, the scope of attack is limited. We quickly resolved this issue.\u003c/p\u003e\n"},{"id":11538,"category":"researcher","content":"##Summary##\nHey team,\n\nI have discovered the passive stored XSS at broadcast room page.\nThe vulnerable component is the running application link at the chat header.\n\nJS function `start_defchat` contains object with many different parameters and the interesting one is `app_info_json`. This parameter contains information about applications running in the following format:\n```\nAPP1_NAME|APP1_DETAILS_LINK,APP2_NAME|APP2_DETAILS_LINK\n```\nThis parameter is used to construct the chat header part containing the information about broadcaster's running applications. Please look at the screenshot below:\n{F360611}.\nWhen the parameter is injected into the page source, the `|` symbol is unfiltered so an attacker can craft application with malicious name containing this symbol to forge the app link to the javascript protocol one. So crafting the app with name `something|javascript:alert()`, the following `app_info_json` parameter modification becomes possible:\n```\nsomething|javascript:alert()|APP1_DETAILS_LINK,APP2_NAME|APP2_DETAILS_LINK\n```\nIn the case above, the chat header is modified to contain the following DOM element:\n```html\n\u003cp\u003eYou are running these apps: \u003ca href=\"javascript:alert()\" target=\"_blank\"\u003e1\u003c/a\u003e\u003c/p\u003e\n```\n\nThe problem is that the app name length is limited to 32 symbols, that is not enough to craft real world evil XSS-payload. It can be bypassed if the attacker puts the JS-code in some other HTML-element under his control and then just reads and executes it from the evil link. Nevertheless, I could not construct so small payload to even read and execute text of some element. So I have split the payload into two and used two applications to execute it. In this case, the victim should click two links one after another, that decreases the vulnerability risk a little. Though I have add the notification code in my app that writes every 10 seconds that you can earn free tokens if click at both links :)\n\n## Steps To Reproduce:\n\n  1. Change your room title to `alert('XSS by skavans at ' + document.domain)`\n  1. Create and run some dummy app/bot with name `1|javascript:b='#roomtitle';0`\n  1. Create and run second bot with name `2|javascript:eval($(b).text())`\n  1. Start broadcasting and open the room using another account (victim)\n  1. Click at link `1`, then at link `2`. The xss will fire after that.\n\n{F360624}\n\nP.S.: The XSS fires at latest Chrome and Safari under Mac OS and does not work at the latest Firefox because of `target=\"_blank\"` link's attribute. The Firefox opens new page after user clicks at such link so it is impossible to click at the second link.\n\nThe payload is now injected into the following password-protected room:\nhttps://chaturbate.com/b/h1tester1/ (password is `hackerone`).\n\n## Impact\n\nGet full control under victim's account.","can_view?":true,"can_edit?":false,"content_html":"\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003eHey team,\u003c/p\u003e\n\n\u003cp\u003eI have discovered the passive stored XSS at broadcast room page.\u003cbr\u003e\nThe vulnerable component is the running application link at the chat header.\u003c/p\u003e\n\n\u003cp\u003eJS function \u003ccode\u003estart_defchat\u003c/code\u003e contains object with many different parameters and the interesting one is \u003ccode\u003eapp_info_json\u003c/code\u003e. This parameter contains information about applications running in the following format:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eAPP1_NAME|APP1_DETAILS_LINK,APP2_NAME|APP2_DETAILS_LINK\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis parameter is used to construct the chat header part containing the information about broadcaster\u0026#39;s running applications. Please look at the screenshot below:\u003cbr\u003e\n{F360611}.\u003cbr\u003e\nWhen the parameter is injected into the page source, the \u003ccode\u003e|\u003c/code\u003e symbol is unfiltered so an attacker can craft application with malicious name containing this symbol to forge the app link to the javascript protocol one. So crafting the app with name \u003ccode\u003esomething|javascript:alert()\u003c/code\u003e, the following \u003ccode\u003eapp_info_json\u003c/code\u003e parameter modification becomes possible:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003esomething|javascript:alert()|APP1_DETAILS_LINK,APP2_NAME|APP2_DETAILS_LINK\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn the case above, the chat header is modified to contain the following DOM element:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003eYou are running these apps: \u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;javascript:alert()\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003etarget=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;_blank\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e1\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe problem is that the app name length is limited to 32 symbols, that is not enough to craft real world evil XSS-payload. It can be bypassed if the attacker puts the JS-code in some other HTML-element under his control and then just reads and executes it from the evil link. Nevertheless, I could not construct so small payload to even read and execute text of some element. So I have split the payload into two and used two applications to execute it. In this case, the victim should click two links one after another, that decreases the vulnerability risk a little. Though I have add the notification code in my app that writes every 10 seconds that you can earn free tokens if click at both links :)\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eChange your room title to \u003ccode\u003ealert(\u0026#39;XSS by skavans at \u0026#39; + document.domain)\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate and run some dummy app/bot with name \u003ccode\u003e1|javascript:b=\u0026#39;#roomtitle\u0026#39;;0\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eCreate and run second bot with name \u003ccode\u003e2|javascript:eval($(b).text())\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eStart broadcasting and open the room using another account (victim)\u003c/li\u003e\n\u003cli\u003eClick at link \u003ccode\u003e1\u003c/code\u003e, then at link \u003ccode\u003e2\u003c/code\u003e. The xss will fire after that.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e{F360624}\u003c/p\u003e\n\n\u003cp\u003eP.S.: The XSS fires at latest Chrome and Safari under Mac OS and does not work at the latest Firefox because of \u003ccode\u003etarget=\u0026quot;_blank\u0026quot;\u003c/code\u003e link\u0026#39;s attribute. The Firefox opens new page after user clicks at such link so it is impossible to click at the second link.\u003c/p\u003e\n\n\u003cp\u003eThe payload is now injected into the following password-protected room:\u003cbr\u003e\n\u003ca title=\"https://chaturbate.com/b/h1tester1/\" href=\"/redirect?url=https%3A%2F%2Fchaturbate.com%2Fb%2Fh1tester1%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://chaturbate.com/b/h1tester1/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (password is \u003ccode\u003ehackerone\u003c/code\u003e).\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eGet full control under victim\u0026#39;s account.\u003c/p\u003e\n"}]}