{"id":47495,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NzQ5NQ==","url":"https://hackerone.com/reports/47495","title":"Same Origin Policy bypass","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-02-12T00:35:46.540Z","submitted_at":"2015-02-12T00:35:46.540Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zoczus","url":"/zoczus","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":65,"url":"https://hackerone.com/mailru","handle":"mailru","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Mail.ru","twitter_handle":"mailru","website":"https://corp.mail.ru","about":"Building the Internet since 1998"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2015-03-27T14:29:12.748Z","bug_reporter_agreed_on_going_public_at":"2015-02-25T14:29:00.281Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\r\n\r\nAfter small investigation I've probably found something that can be exploited to bypass Same Origin Policy on mail.ru services (specially your main domain and e.mail.ru). \r\n\r\nFirst of all - let's take a look about your crossdomain.xml (both for mail.ru and e.mail.ru):\r\n\r\n\u003ccross-domain-policy\u003e\r\n\u003callow-access-from domain=\"*.files.mail.ru\" to-ports=\"80\"/\u003e\r\n\u003callow-access-from domain=\"img.imgsmail.ru\" to-ports=\"80\"/\u003e\r\n\u003callow-access-from domain=\"win.mail.ru\" to-ports=\"80\"/\u003e\r\n\u003callow-access-from domain=\"e.mail.ru\" to-ports=\"80\"/\u003e\r\n\u003callow-access-from domain=\"*.corp.mail.ru\" to-ports=\"80\"/\u003e\r\n\u003callow-access-from domain=\"img.mail.ru\" to-ports=\"80\"/\u003e\r\n\u003csite-control permitted-cross-domain-policies=\"all\"/\u003e\r\n\u003c/cross-domain-policy\u003e\r\n\r\nAfter time spent on searching useful files I found flash uploader on files.mail.ru which is mentioned in crossdomain. \r\n\r\nFew important things about this Flash file (https://files.mail.ru/uploader9.swf):\r\n\r\n1) It uses Security.allowDomain(\"*\") which is extreamly dangerous\r\n2) It have interesting callback to ajaxCall() method. \r\n\r\nI want to tell you more about ajaxCall() actionscript function - here's snippet: https://gist.github.com/ZoczuS/82ad1e7509dd436a2db9\r\n\r\nYou can see that before request will go on there are few checks - provided URL must starts with http:// schema, must have .mail.ru before first / (to prevent sending requests to other domain). Bypass is simple here - we can use username@hostname notation - http://.mail.ru@lab.ropchain.org/r.php?r=HTTPS://ANY-OTHER-URL.COM ;-) (r.php returns 301 and redirects us where $_GET['r'] tells). \r\n\r\nTo make this attack even simpler - ajaxCall() function have js_callback parameter, where we can handle our Cross-Origin response, and parse it. \r\n\r\nSo the example attack scenario goes like this:\r\n1. Attacker create specially crafted webpage where he embeds uploader9.swf\r\n2. Because of Security.allowDomain('*') we can interact with this file from any domain, so it works. \r\n3. Because ajax() callback we can send requests to any other webpage.\r\n4. Because of crossdomain.xml of mail.ru we can gain full response from mail.ru and pass it to our js_callback (that \"works\" for attacker's origin).\r\n\r\nIn this scenario I'll call https://mail.ru/?json=1\u0026nano=0 that returns sort of informations about logged in user in JSON format. To watch exploit in action - visit this page: https://eip.uid0.pl/mail.php (it requires SSL, sorry for self-signed cert).\r\n\r\nVideo demonstration: https://www.youtube.com/watch?v=iIUlSJ-Wvgk (unlisted one - only me and you have this link)\r\n\r\nThanks for reading it - have a nice day!\r\nJakub Zoczek","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eAfter small investigation I\u0026#39;ve probably found something that can be exploited to bypass Same Origin Policy on mail.ru services (specially your main domain and e.mail.ru). \u003c/p\u003e\n\n\u003cp\u003eFirst of all - let\u0026#39;s take a look about your crossdomain.xml (both for mail.ru and e.mail.ru):\u003c/p\u003e\n\n\u003cp\u003e\u0026lt;cross-domain-policy\u0026gt;\u003cbr\u003e\n\u0026lt;allow-access-from domain=\u0026quot;*.files.mail.ru\u0026quot; to-ports=\u0026quot;80\u0026quot;/\u0026gt;\u003cbr\u003e\n\u0026lt;allow-access-from domain=\u0026quot;img.imgsmail.ru\u0026quot; to-ports=\u0026quot;80\u0026quot;/\u0026gt;\u003cbr\u003e\n\u0026lt;allow-access-from domain=\u0026quot;win.mail.ru\u0026quot; to-ports=\u0026quot;80\u0026quot;/\u0026gt;\u003cbr\u003e\n\u0026lt;allow-access-from domain=\u0026quot;e.mail.ru\u0026quot; to-ports=\u0026quot;80\u0026quot;/\u0026gt;\u003cbr\u003e\n\u0026lt;allow-access-from domain=\u0026quot;*.corp.mail.ru\u0026quot; to-ports=\u0026quot;80\u0026quot;/\u0026gt;\u003cbr\u003e\n\u0026lt;allow-access-from domain=\u0026quot;img.mail.ru\u0026quot; to-ports=\u0026quot;80\u0026quot;/\u0026gt;\u003cbr\u003e\n\u0026lt;site-control permitted-cross-domain-policies=\u0026quot;all\u0026quot;/\u0026gt;\u003cbr\u003e\n\u0026lt;/cross-domain-policy\u0026gt;\u003c/p\u003e\n\n\u003cp\u003eAfter time spent on searching useful files I found flash uploader on files.mail.ru which is mentioned in crossdomain. \u003c/p\u003e\n\n\u003cp\u003eFew important things about this Flash file (\u003ca title=\"https://files.mail.ru/uploader9.swf):\" href=\"/redirect?url=https%3A%2F%2Ffiles.mail.ru%2Fuploader9.swf%29%3A\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://files.mail.ru/uploader9.swf):\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e1) It uses Security.allowDomain(\u0026quot;*\u0026quot;) which is extreamly dangerous\u003cbr\u003e\n2) It have interesting callback to ajaxCall() method. \u003c/p\u003e\n\n\u003cp\u003eI want to tell you more about ajaxCall() actionscript function - here\u0026#39;s snippet: \u003ca title=\"https://gist.github.com/ZoczuS/82ad1e7509dd436a2db9\" href=\"/redirect?url=https%3A%2F%2Fgist.github.com%2FZoczuS%2F82ad1e7509dd436a2db9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gist.github.com/ZoczuS/82ad1e7509dd436a2db9\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eYou can see that before request will go on there are few checks - provided URL must starts with http:// schema, must have .mail.ru before first / (to prevent sending requests to other domain). Bypass is simple here - we can use username@hostname notation - http://\u003ca title=\".mail.ru@lab.ropchain.org\" href=\"mailto:.mail.ru@lab.ropchain.org\" rel=\"nofollow noopener noreferrer\"\u003e.mail.ru@lab.ropchain.org\u003c/a\u003e/r.php?r=\u003ca title=\"https://any-other-url.com\" href=\"/redirect?url=https%3A%2F%2Fany-other-url.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://any-other-url.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e ;-) (r.php returns 301 and redirects us where $_GET[\u0026#39;r\u0026#39;] tells). \u003c/p\u003e\n\n\u003cp\u003eTo make this attack even simpler - ajaxCall() function have js_callback parameter, where we can handle our Cross-Origin response, and parse it. \u003c/p\u003e\n\n\u003cp\u003eSo the example attack scenario goes like this:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAttacker create specially crafted webpage where he embeds uploader9.swf\u003c/li\u003e\n\u003cli\u003eBecause of Security.allowDomain(\u0026#39;*\u0026#39;) we can interact with this file from any domain, so it works. \u003c/li\u003e\n\u003cli\u003eBecause ajax() callback we can send requests to any other webpage.\u003c/li\u003e\n\u003cli\u003eBecause of crossdomain.xml of mail.ru we can gain full response from mail.ru and pass it to our js_callback (that \u0026quot;works\u0026quot; for attacker\u0026#39;s origin).\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eIn this scenario I\u0026#39;ll call \u003ca title=\"https://mail.ru/?json=1\u0026amp;nano=0\" href=\"/redirect?url=https%3A%2F%2Fmail.ru%2F%3Fjson%3D1%26nano%3D0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://mail.ru/?json=1\u0026amp;nano=0\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e that returns sort of informations about logged in user in JSON format. To watch exploit in action - visit this page: \u003ca title=\"https://eip.uid0.pl/mail.php\" href=\"/redirect?url=https%3A%2F%2Feip.uid0.pl%2Fmail.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://eip.uid0.pl/mail.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (it requires SSL, sorry for self-signed cert).\u003c/p\u003e\n\n\u003cp\u003eVideo demonstration: \u003ca title=\"https://www.youtube.com/watch?v=iIUlSJ-Wvgk\" href=\"/redirect?url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DiIUlSJ-Wvgk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.youtube.com/watch?v=iIUlSJ-Wvgk\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (unlisted one - only me and you have this link)\u003c/p\u003e\n\n\u003cp\u003eThanks for reading it - have a nice day!\u003cbr\u003e\nJakub Zoczek\u003c/p\u003e\n","bounty_amount":"600.0","formatted_bounty":"$600","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-03-27T14:29:01.124Z","allow_singular_disclosure_after":-181755292.98140928,"singular_disclosure_allowed":true,"vote_count":4,"voters":["sw33tlie","fantam1","spetr0x","bc4b5f39ded739ad062bffc"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":330951,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for reporting your bug to Mail.Ru Group!   We appreciate your time for helping us to make our web services safer.\n\nI have confirmed your report, and it was escalated. You will be noticed when we prepare a fix, stay in touch.\nBut I must notice, your report is not in a bug bounty program's scope. Please review [bug bounty program rules](https://hackerone.com/mailru).  ","markdown_message":"\u003cp\u003eThank you for reporting your bug to Mail.Ru Group!   We appreciate your time for helping us to make our web services safer.\u003c/p\u003e\n\n\u003cp\u003eI have confirmed your report, and it was escalated. You will be noticed when we prepare a fix, stay in touch.\u003cbr\u003e\nBut I must notice, your report is not in a bug bounty program\u0026#39;s scope. Please review \u003ca href=\"https://hackerone.com/mailru\"\u003ebug bounty program rules\u003c/a\u003e.  \u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-12T14:05:21.546Z","updated_at":"2015-02-12T14:05:21.546Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":330981,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\n\nThanks for fast reply. \n\nIt's strange - I've read your program rules carefully and as far as I know e.mail.ru (your e-mail service) is the critical one that are in scope. As I said in my report - it works for https://mail.ru AND https://e.mail.ru which is in scope. PoC shows only mail.ru one, but in e.mail.ru we are also able to bypass Same Origin Policy. Please, can you explain me why it isn't in scope? \n\nThanks!","markdown_message":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eThanks for fast reply. \u003c/p\u003e\n\n\u003cp\u003eIt\u0026#39;s strange - I\u0026#39;ve read your program rules carefully and as far as I know e.mail.ru (your e-mail service) is the critical one that are in scope. As I said in my report - it works for \u003ca title=\"https://mail.ru\" href=\"/redirect?url=https%3A%2F%2Fmail.ru\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://mail.ru\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e AND \u003ca title=\"https://e.mail.ru\" href=\"/redirect?url=https%3A%2F%2Fe.mail.ru\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://e.mail.ru\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e which is in scope. PoC shows only mail.ru one, but in e.mail.ru we are also able to bypass Same Origin Policy. Please, can you explain me why it isn\u0026#39;t in scope? \u003c/p\u003e\n\n\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-12T14:55:43.783Z","updated_at":"2015-02-12T14:55:43.783Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":330993,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This bug is in files.mail.ru, not in e.mail.ru and impact is same with XSS on any of .mail.ru domains outside the scope.\nIf you can demonstrate access to e.g. user's mail on e.mail.ru I will escalate it and include into scope.","markdown_message":"\u003cp\u003eThis bug is in files.mail.ru, not in e.mail.ru and impact is same with XSS on any of .mail.ru domains outside the scope.\u003cbr\u003e\nIf you can demonstrate access to e.g. user\u0026#39;s mail on e.mail.ru I will escalate it and include into scope.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-12T15:14:34.495Z","updated_at":"2015-02-12T15:14:34.495Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":330996,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ok - but I need more time to prepare exploit code. That's why if you're planing to remove / fix this uploader - please save previous version in some random name like uploader_82df5cbdaae9c4dc5b32f8a12ffc096c.swf for test purposes, to prove you that I'm able to read mails. ;-) Is that ok for you? I won't share this filename with anyone, just want to have still some testing enviorment. ","markdown_message":"\u003cp\u003eOk - but I need more time to prepare exploit code. That\u0026#39;s why if you\u0026#39;re planing to remove / fix this uploader - please save previous version in some random name like uploader_82df5cbdaae9c4dc5b32f8a12ffc096c.swf for test purposes, to prove you that I\u0026#39;m able to read mails. ;-) Is that ok for you? I won\u0026#39;t share this filename with anyone, just want to have still some testing enviorment. \u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-12T15:30:24.469Z","updated_at":"2015-02-12T15:30:24.469Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":331177,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Stay tuned - exploit for reading user e-mails is in progress. I'd probably send you final version today. Thanks!","markdown_message":"\u003cp\u003eStay tuned - exploit for reading user e-mails is in progress. I\u0026#39;d probably send you final version today. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-12T21:21:11.970Z","updated_at":"2015-02-12T21:21:11.970Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":331256,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ok - I've got it. You'd probably need some additional informations about technique I used here (details are in initial report, but few changes was made).\n\nSo... using initial report technique I'm able to make cross-origin requests and gain responses. The main problem was that your HTML content have escaped 0x22 (apostrophe) char. When the content was sent to javascript callback - only 0x22 chars are escaped by flash, but as far as it was escaped before - the double escape happened and we had \\\\\" chars that broke syntax and I was unable to get the e.mail.ru html content. I worked hard all day to make some trick and ES6 (http://en.wikipedia.org/wiki/ECMAScript) supported for example in latest Firefox. In ES6 - we don't need to use 0x22 or 0x27 chars to construct strings - we can use backticks. ;) So the new, full attack scenario to read user's emails is:\n\n1.  We use initial Proof of Concept to get user's email (your API needs it). [index.php]\n2. After gaining e-mail - we pass it to gettoken.php as GET parameter.\n3. We're calling https://e.mail.ru/password/restore/?login=zuezuozuezuo`;//hehe and using gogo` as callback [gettoken.php]\n4. The flash will construct this kind of function call:\n\ngogo`\u003chtml\u003ecotent with escaped apostrophes \\\" and double-escaped apostrophes \\\\\" and it won't break snytax (...) zuezuozuezuo`;//hehe rest of html content\u003c/html\u003e)}catch(e)(...)\n\nUsing this trick we will gain part of html content - but we are able to extract API token from there. \n\n5. After parsing output and gaining token - we pass it (with login stolen before) to getthreads.php\n6. We have API token , user's email and we are able to gain JSON content from https://e.mail.ru/api/v1/threads/status method\n7. We're parsing JSON, get list of thread's subjects and thread ids. \n8. Using any thread ID we are able to pass it to getemail.php\n9. We are making request to https://e.mail.ru/cgi-bin/getmsg  and gaining e-mail content.\n10. Profit. :-)\n\nThe scenario above is available as video demonstration here: https://www.youtube.com/watch?v=4AZyFVVnLE8\n\nI hope now this bug is in scope. ;-) \n\nHave a nice day!\nJZ","markdown_message":"\u003cp\u003eOk - I\u0026#39;ve got it. You\u0026#39;d probably need some additional informations about technique I used here (details are in initial report, but few changes was made).\u003c/p\u003e\n\n\u003cp\u003eSo... using initial report technique I\u0026#39;m able to make cross-origin requests and gain responses. The main problem was that your HTML content have escaped 0x22 (apostrophe) char. When the content was sent to javascript callback - only 0x22 chars are escaped by flash, but as far as it was escaped before - the double escape happened and we had \\\u0026quot; chars that broke syntax and I was unable to get the e.mail.ru html content. I worked hard all day to make some trick and ES6 (\u003ca title=\"http://en.wikipedia.org/wiki/ECMAScript\" href=\"/redirect?url=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FECMAScript\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://en.wikipedia.org/wiki/ECMAScript\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) supported for example in latest Firefox. In ES6 - we don\u0026#39;t need to use 0x22 or 0x27 chars to construct strings - we can use backticks. ;) So the new, full attack scenario to read user\u0026#39;s emails is:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e We use initial Proof of Concept to get user\u0026#39;s email (your API needs it). [index.php]\u003c/li\u003e\n\u003cli\u003eAfter gaining e-mail - we pass it to gettoken.php as GET parameter.\u003c/li\u003e\n\u003cli\u003eWe\u0026#39;re calling \u003ca title=\"https://e.mail.ru/password/restore/?login=zuezuozuezuo%60%3B//hehe\" href=\"/redirect?url=https%3A%2F%2Fe.mail.ru%2Fpassword%2Frestore%2F%3Flogin%3Dzuezuozuezuo%2560%253B%2F%2Fhehe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://e.mail.ru/password/restore/?login=zuezuozuezuo%60%3B//hehe\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and using gogo` as callback [gettoken.php]\u003c/li\u003e\n\u003cli\u003eThe flash will construct this kind of function call:\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003egogo\u003ccode\u003e\u0026lt;html\u0026gt;cotent with escaped apostrophes \\\u0026quot; and double-escaped apostrophes \\\\\u0026quot; and it won\u0026#39;t break snytax (...) zuezuozuezuo\u003c/code\u003e;//hehe rest of html content\u0026lt;/html\u0026gt;)}catch(e)(...)\u003c/p\u003e\n\n\u003cp\u003eUsing this trick we will gain part of html content - but we are able to extract API token from there. \u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAfter parsing output and gaining token - we pass it (with login stolen before) to getthreads.php\u003c/li\u003e\n\u003cli\u003eWe have API token , user\u0026#39;s email and we are able to gain JSON content from \u003ca title=\"https://e.mail.ru/api/v1/threads/status\" href=\"/redirect?url=https%3A%2F%2Fe.mail.ru%2Fapi%2Fv1%2Fthreads%2Fstatus\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://e.mail.ru/api/v1/threads/status\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e method\u003c/li\u003e\n\u003cli\u003eWe\u0026#39;re parsing JSON, get list of thread\u0026#39;s subjects and thread ids. \u003c/li\u003e\n\u003cli\u003eUsing any thread ID we are able to pass it to getemail.php\u003c/li\u003e\n\u003cli\u003eWe are making request to \u003ca title=\"https://e.mail.ru/cgi-bin/getmsg\" href=\"/redirect?url=https%3A%2F%2Fe.mail.ru%2Fcgi-bin%2Fgetmsg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://e.mail.ru/cgi-bin/getmsg\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e  and gaining e-mail content.\u003c/li\u003e\n\u003cli\u003eProfit. :-)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe scenario above is available as video demonstration here: \u003ca title=\"https://www.youtube.com/watch?v=4AZyFVVnLE8\" href=\"/redirect?url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D4AZyFVVnLE8\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.youtube.com/watch?v=4AZyFVVnLE8\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI hope now this bug is in scope. ;-) \u003c/p\u003e\n\n\u003cp\u003eHave a nice day!\u003cbr\u003e\nJZ\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-12T23:05:38.693Z","updated_at":"2015-02-12T23:05:38.693Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":331257,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry for that, but markdown uses backticks (0x60) char to code. \n\nIf anything is not clear for you or you have any questions - feel free to ask me. ","markdown_message":"\u003cp\u003eSorry for that, but markdown uses backticks (0x60) char to code. \u003c/p\u003e\n\n\u003cp\u003eIf anything is not clear for you or you have any questions - feel free to ask me. \u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-12T23:06:31.576Z","updated_at":"2015-02-12T23:06:31.576Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":331308,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"at this point\n\n\u003e We have API token , user's email and we are able to gain JSON content from https://e.mail.ru/api/v1/threads/status method\n\nyou need either to be able to bypass crossorigin policy for AJAX request with XMLHttpRequest or to access http-only ssdc cookie for e.mail.ru domain to request ajax via flash. Have you succeeded with it? Can you demonstrate a PoC?","markdown_message":"\u003cp\u003eat this point\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eWe have API token , user\u0026#39;s email and we are able to gain JSON content from \u003ca title=\"https://e.mail.ru/api/v1/threads/status\" href=\"/redirect?url=https%3A%2F%2Fe.mail.ru%2Fapi%2Fv1%2Fthreads%2Fstatus\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://e.mail.ru/api/v1/threads/status\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e method\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eyou need either to be able to bypass crossorigin policy for AJAX request with XMLHttpRequest or to access http-only ssdc cookie for e.mail.ru domain to request ajax via flash. Have you succeeded with it? Can you demonstrate a PoC?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-13T00:08:58.520Z","updated_at":"2015-02-13T00:08:58.520Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":331312,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Full automated PoC (when working) is showed on video.\n\nThe PoC is constructed in way that we gain some info (like token), redirect to another file with GET param and then send another request, and another. Here are the links:\n\nhttps://eip.uid0.pl/mailru/index.php\nhttps://eip.uid0.pl/mailru/gettoken.php\nhttps://eip.uid0.pl/mailru/getthreads.php\nhttps://eip.uid0.pl/mailru/getemail.php\n\n(the normal php code just insert login, token, and id in some points). \n\nBTW as I already said the PoC is for Firefox only, but it would work in other browsers when ES6 would be enabled everywhere this year ;-) \n\nEvery flash request that I made succeed and flash handled (part or full) content from https://e.mail.ru/ and succesfully forwarded it to my callback in eip.uid0.pl origin. So the final answer is yes - I've succeeded with it. ;) \n\nBest!","markdown_message":"\u003cp\u003eFull automated PoC (when working) is showed on video.\u003c/p\u003e\n\n\u003cp\u003eThe PoC is constructed in way that we gain some info (like token), redirect to another file with GET param and then send another request, and another. Here are the links:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://eip.uid0.pl/mailru/index.php\" href=\"/redirect?url=https%3A%2F%2Feip.uid0.pl%2Fmailru%2Findex.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://eip.uid0.pl/mailru/index.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://eip.uid0.pl/mailru/gettoken.php\" href=\"/redirect?url=https%3A%2F%2Feip.uid0.pl%2Fmailru%2Fgettoken.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://eip.uid0.pl/mailru/gettoken.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://eip.uid0.pl/mailru/getthreads.php\" href=\"/redirect?url=https%3A%2F%2Feip.uid0.pl%2Fmailru%2Fgetthreads.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://eip.uid0.pl/mailru/getthreads.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://eip.uid0.pl/mailru/getemail.php\" href=\"/redirect?url=https%3A%2F%2Feip.uid0.pl%2Fmailru%2Fgetemail.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://eip.uid0.pl/mailru/getemail.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e(the normal php code just insert login, token, and id in some points). \u003c/p\u003e\n\n\u003cp\u003eBTW as I already said the PoC is for Firefox only, but it would work in other browsers when ES6 would be enabled everywhere this year ;-) \u003c/p\u003e\n\n\u003cp\u003eEvery flash request that I made succeed and flash handled (part or full) content from \u003ca title=\"https://e.mail.ru/\" href=\"/redirect?url=https%3A%2F%2Fe.mail.ru%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://e.mail.ru/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and succesfully forwarded it to my callback in eip.uid0.pl origin. So the final answer is yes - I\u0026#39;ve succeeded with it. ;) \u003c/p\u003e\n\n\u003cp\u003eBest!\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-13T00:18:52.372Z","updated_at":"2015-02-13T00:18:52.372Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":331313,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, we'll review it.","markdown_message":"\u003cp\u003eThanks, we\u0026#39;ll review it.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-13T00:21:17.934Z","updated_at":"2015-02-13T00:21:17.934Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":331314,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Great! :) Thanks\nJZ","markdown_message":"\u003cp\u003eGreat! :) Thanks\u003cbr\u003e\nJZ\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-13T00:22:24.649Z","updated_at":"2015-02-13T00:22:24.649Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":332805,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Your bug has been fixed! \nPlease confirm that you are no longer able to reproduce the issue. We will now make a determination on compensation for this bug. Please be patient throughout this process! ","markdown_message":"\u003cp\u003eYour bug has been fixed! \u003cbr\u003e\nPlease confirm that you are no longer able to reproduce the issue. We will now make a determination on compensation for this bug. Please be patient throughout this process! \u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-16T14:33:48.770Z","updated_at":"2015-02-16T14:33:48.770Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"zoczus","url":"/zoczus"},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":332809,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yup - I do confirm that this one is fixed. Thanks! ","markdown_message":"\u003cp\u003eYup - I do confirm that this one is fixed. Thanks! \u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-16T14:40:19.414Z","updated_at":"2015-02-16T14:40:19.414Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":339890,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2015-02-25T13:54:42.698Z","updated_at":"2015-02-25T13:54:42.698Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Mail.ru"}},"bounty_amount":"600.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"mailru","collaborator":{"username":"zoczus","url":"/zoczus"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":339911,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome! Thank you! :) We can probably public disclose now, right? :) ","markdown_message":"\u003cp\u003eAwesome! Thank you! :) We can probably public disclose now, right? :) \u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-25T14:28:55.125Z","updated_at":"2015-02-25T14:28:55.125Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":339912,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-02-25T14:29:00.339Z","updated_at":"2015-02-25T14:29:00.339Z","first_to_agree":true,"actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":340900,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for work. I will confirm disclosure after //mail.ru/crossdomain.xml is also fixed.","markdown_message":"\u003cp\u003eThanks for work. I will confirm disclosure after //mail.ru/crossdomain.xml is also fixed.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-26T16:24:04.456Z","updated_at":"2015-02-26T16:24:04.456Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":364530,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-03-27T14:29:13.305Z","updated_at":"2015-03-27T14:29:13.305Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Mail.ru"}},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}