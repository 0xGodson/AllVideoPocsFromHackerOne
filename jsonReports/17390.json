{"id":17390,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNzM5MA==","url":"https://hackerone.com/reports/17390","title":"Flash Content-Type Sniffing Vulnerability ","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-06-23T22:00:12.795Z","submitted_at":"2014-06-23T22:00:12.795Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"prakharprasad","url":"/prakharprasad","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":230,"url":"https://hackerone.com/uzbey","handle":"uzbey","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/230/31db3ca09aa073798698f713a4c01d0e9faf39aa_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/230/31db3ca09aa073798698f713a4c01d0e9faf39aa_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Uzbey","twitter_handle":"","website":"https://staging.uzbey.com/","about":"The goal of Uzbey is to create the worlds largest selfie to be launched into space. test @jobert"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-07-23T17:50:35.626Z","bug_reporter_agreed_on_going_public_at":"2014-07-23T17:50:35.469Z","team_member_agreed_on_going_public_at":"2014-07-23T12:35:16.227Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\r\n\r\nThere's a **Flash Content-Type Sniffing vulnerability**. Using this vulnerability I can read the client side source code of your website from a different origin (say prakharprasad.com) and then look for potentially sensitive data in those pages for example - CSRF prevention tokens and then successfully mount a side-wide CSRF attack (as I can read the token every time and on every page) or read messages. Once the victim views my page, I can read his `https://staging.uzbey.com/*` webpage source and then extract out the data I need (messages, anti-csrf tokens and what not).\r\n\r\n**Proof-of-Concept**:\r\n\r\n1. Login to your Uzbey account\r\n2. Visit https://demo.prakharprasad.com/uzbey/uzbey.html (and wait for 5 -10 seconds)\r\n3. Now visit https://staging.uzbey.com/messages and you'll see a message has been sent to *admin* saying *DemoHAX :)* \r\n\r\n**How this works?**\r\n\r\n1. My webpage loads an `\u003ciframe\u003e` pointing to https://demo.prakharprasad.com/uzbey/sniff.html\r\n2. `sniff.html` essentially embeds an SWF-file that has been uploaded to my (attacker's) photo gallery with **.jpg** extension - https://staging.uzbey.com/sites/default/files/magic.jpg \r\n3. Once the embedded file run, it sends a **GET** request to `https://staging.uzbey.com/messages/new`and passes the callback to a function called `nice()`within `sniff.html`. The callback data is the source code of the page that was requested with a **GET** earlier.\r\n4. Now`nice()`function parses the page for `form_bulid_id`and `form_token` and then builds up a form to mount the CSRF attack and then submits the form with a **POST** request. \r\n5. **Game over ! :)**\r\n\r\nBasically I used the upload functionality to upload the malicious SWF with **.jpg** extension and then loaded it in an iframe and did my work!\r\n\r\nThanks, \r\n\r\n@prakharprasad","vulnerability_information_html":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eThere\u0026#39;s a \u003cstrong\u003eFlash Content-Type Sniffing vulnerability\u003c/strong\u003e. Using this vulnerability I can read the client side source code of your website from a different origin (say prakharprasad.com) and then look for potentially sensitive data in those pages for example - CSRF prevention tokens and then successfully mount a side-wide CSRF attack (as I can read the token every time and on every page) or read messages. Once the victim views my page, I can read his \u003ccode\u003ehttps://staging.uzbey.com/*\u003c/code\u003e webpage source and then extract out the data I need (messages, anti-csrf tokens and what not).\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eProof-of-Concept\u003c/strong\u003e:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eLogin to your Uzbey account\u003c/li\u003e\n\u003cli\u003eVisit \u003ca title=\"https://demo.prakharprasad.com/uzbey/uzbey.html\" href=\"/redirect?url=https%3A%2F%2Fdemo.prakharprasad.com%2Fuzbey%2Fuzbey.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://demo.prakharprasad.com/uzbey/uzbey.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (and wait for 5 -10 seconds)\u003c/li\u003e\n\u003cli\u003eNow visit \u003ca title=\"https://staging.uzbey.com/messages\" href=\"/redirect?url=https%3A%2F%2Fstaging.uzbey.com%2Fmessages\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://staging.uzbey.com/messages\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and you\u0026#39;ll see a message has been sent to \u003cem\u003eadmin\u003c/em\u003e saying \u003cem\u003eDemoHAX :)\u003c/em\u003e \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003cstrong\u003eHow this works?\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eMy webpage loads an \u003ccode\u003e\u0026lt;iframe\u0026gt;\u003c/code\u003e pointing to \u003ca title=\"https://demo.prakharprasad.com/uzbey/sniff.html\" href=\"/redirect?url=https%3A%2F%2Fdemo.prakharprasad.com%2Fuzbey%2Fsniff.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://demo.prakharprasad.com/uzbey/sniff.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003esniff.html\u003c/code\u003e essentially embeds an SWF-file that has been uploaded to my (attacker\u0026#39;s) photo gallery with \u003cstrong\u003e.jpg\u003c/strong\u003e extension - \u003ca title=\"https://staging.uzbey.com/sites/default/files/magic.jpg\" href=\"/redirect?url=https%3A%2F%2Fstaging.uzbey.com%2Fsites%2Fdefault%2Ffiles%2Fmagic.jpg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://staging.uzbey.com/sites/default/files/magic.jpg\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e \u003c/li\u003e\n\u003cli\u003eOnce the embedded file run, it sends a \u003cstrong\u003eGET\u003c/strong\u003e request to \u003ccode\u003ehttps://staging.uzbey.com/messages/new\u003c/code\u003eand passes the callback to a function called \u003ccode\u003enice()\u003c/code\u003ewithin \u003ccode\u003esniff.html\u003c/code\u003e. The callback data is the source code of the page that was requested with a \u003cstrong\u003eGET\u003c/strong\u003e earlier.\u003c/li\u003e\n\u003cli\u003eNow\u003ccode\u003enice()\u003c/code\u003efunction parses the page for \u003ccode\u003eform_bulid_id\u003c/code\u003eand \u003ccode\u003eform_token\u003c/code\u003e and then builds up a form to mount the CSRF attack and then submits the form with a \u003cstrong\u003ePOST\u003c/strong\u003e request. \u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eGame over ! :)\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eBasically I used the upload functionality to upload the malicious SWF with \u003cstrong\u003e.jpg\u003c/strong\u003e extension and then loaded it in an iframe and did my work!\u003c/p\u003e\n\n\u003cp\u003eThanks, \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"/prakharprasad\"\u003e@prakharprasad\u003c/a\u003e\u003c/p\u003e\n","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-08-22T12:35:16.496Z","allow_singular_disclosure_after":-200506011.22193417,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":78130,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Dude, Nice :)  So what is the fix for this ?","markdown_message":"\u003cp\u003eDude, Nice :)  So what is the fix for this ?\u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-23T22:07:30.404Z","updated_at":"2014-06-23T22:07:30.404Z","actor":{"username":"mlitchfield","cleared":true,"url":"/mlitchfield","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/748/925210b2e90f4053a786099cc4294119a96157a9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":78141,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Great find.  Will definitely get this fixed.","markdown_message":"\u003cp\u003eGreat find.  Will definitely get this fixed.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-23T22:13:38.465Z","updated_at":"2014-06-23T22:13:38.465Z","actor":{"username":"mlitchfield","cleared":true,"url":"/mlitchfield","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/748/925210b2e90f4053a786099cc4294119a96157a9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":78147,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I think adding a `Content-Disposition` header shall do the work.\n\n`Content-Disposition: attachment; filename=\"magic.jpg”`\n\n  OR \n\nManually verify the file structure to check whether the file is a valid JPG/PNG/GIF ","markdown_message":"\u003cp\u003eI think adding a \u003ccode\u003eContent-Disposition\u003c/code\u003e header shall do the work.\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eContent-Disposition: attachment; filename=\u0026quot;magic.jpg”\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eOR \u003c/p\u003e\n\n\u003cp\u003eManually verify the file structure to check whether the file is a valid JPG/PNG/GIF \u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-23T22:18:46.257Z","updated_at":"2014-06-23T22:18:46.257Z","actor":{"username":"prakharprasad","cleared":true,"url":"/prakharprasad","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":78183,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"hey @prakharprasad, you think you could try this on the live site ?  How did you get an image stored at this location - https://staging.uzbey.com/sites/default/files/magic.jpg","markdown_message":"\u003cp\u003ehey \u003ca href=\"/prakharprasad\"\u003e@prakharprasad\u003c/a\u003e, you think you could try this on the live site ?  How did you get an image stored at this location - \u003ca title=\"https://staging.uzbey.com/sites/default/files/magic.jpg\" href=\"/redirect?url=https%3A%2F%2Fstaging.uzbey.com%2Fsites%2Fdefault%2Ffiles%2Fmagic.jpg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://staging.uzbey.com/sites/default/files/magic.jpg\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-23T23:25:24.206Z","updated_at":"2014-06-23T23:25:24.206Z","actor":{"username":"mlitchfield","cleared":true,"url":"/mlitchfield","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/748/925210b2e90f4053a786099cc4294119a96157a9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":78194,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mlitchfiled, I am writing the upload process.I did it in a live system as I don't have backend access:\n\n1. Login to your Uzbey account\n2. Navigate to https://staging.uzbey.com/node/add/other-album (fill Title)\n3. In the **Album Images** select **Choose file** button and select your SWF with spoofed JPG extension and hit **Upload**\n3. Once the upload finishes, just navigate to \n`https://staging.uzbey.com/sites/default/files/\u003cyour-swf-file-spoofed-jpg-extension\u003e`\n\nA demo upload: https://staging.uzbey.com/sites/default/files/I-can-upload.jpg","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mlitchfiled\"\u003e@mlitchfiled\u003c/a\u003e, I am writing the upload process.I did it in a live system as I don\u0026#39;t have backend access:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eLogin to your Uzbey account\u003c/li\u003e\n\u003cli\u003eNavigate to \u003ca title=\"https://staging.uzbey.com/node/add/other-album\" href=\"/redirect?url=https%3A%2F%2Fstaging.uzbey.com%2Fnode%2Fadd%2Fother-album\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://staging.uzbey.com/node/add/other-album\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (fill Title)\u003c/li\u003e\n\u003cli\u003eIn the \u003cstrong\u003eAlbum Images\u003c/strong\u003e select \u003cstrong\u003eChoose file\u003c/strong\u003e button and select your SWF with spoofed JPG extension and hit \u003cstrong\u003eUpload\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eOnce the upload finishes, just navigate to \n\u003ccode\u003ehttps://staging.uzbey.com/sites/default/files/\u0026lt;your-swf-file-spoofed-jpg-extension\u0026gt;\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eA demo upload: \u003ca title=\"https://staging.uzbey.com/sites/default/files/I-can-upload.jpg\" href=\"/redirect?url=https%3A%2F%2Fstaging.uzbey.com%2Fsites%2Fdefault%2Ffiles%2FI-can-upload.jpg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://staging.uzbey.com/sites/default/files/I-can-upload.jpg\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-23T23:50:55.125Z","updated_at":"2014-06-23T23:50:55.125Z","actor":{"username":"prakharprasad","cleared":true,"url":"/prakharprasad","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":78201,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, I just confirmed this on the live site :)  Again great bug.  The /sites/default/files path was confusing me as files should be served from Amazon.  Which they are, but they are also saved in the file system in that path.","markdown_message":"\u003cp\u003eHi, I just confirmed this on the live site :)  Again great bug.  The /sites/default/files path was confusing me as files should be served from Amazon.  Which they are, but they are also saved in the file system in that path.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-06-24T00:04:04.731Z","updated_at":"2014-06-24T00:04:04.731Z","actor":{"username":"mlitchfield","cleared":true,"url":"/mlitchfield","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/748/925210b2e90f4053a786099cc4294119a96157a9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":93788,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This should be fixed on staging.  Please can you confirm.  Thanks","markdown_message":"\u003cp\u003eThis should be fixed on staging.  Please can you confirm.  Thanks\u003c/p\u003e\n","automated_response":false,"created_at":"2014-07-22T20:34:16.333Z","updated_at":"2014-07-22T20:34:16.333Z","actor":{"username":"mlitchfield","cleared":true,"url":"/mlitchfield","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/748/925210b2e90f4053a786099cc4294119a96157a9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"prakharprasad","url":"/prakharprasad"},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":94242,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Looks fixed !","markdown_message":"\u003cp\u003eLooks fixed !\u003c/p\u003e\n","automated_response":false,"created_at":"2014-07-23T07:44:23.123Z","updated_at":"2014-07-23T07:44:23.123Z","actor":{"username":"prakharprasad","cleared":true,"url":"/prakharprasad","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":94344,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-07-23T12:35:16.242Z","updated_at":"2014-07-23T12:35:16.242Z","first_to_agree":true,"actor":{"username":"gazly","cleared":false,"url":"/gazly","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/044/5ffafc17e1db4bb173a124029838a85e1c3d5117_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":94580,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-07-23T17:50:35.485Z","updated_at":"2014-07-23T17:50:35.485Z","actor":{"username":"prakharprasad","cleared":true,"url":"/prakharprasad","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":94581,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-07-23T17:50:35.642Z","updated_at":"2014-07-23T17:50:35.642Z","actor":{"username":"prakharprasad","cleared":true,"url":"/prakharprasad","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"uzbey","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}