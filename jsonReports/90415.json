{"id":90415,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85MDQxNQ==","url":"https://hackerone.com/reports/90415","title":"CSV Excel Macro Injection in Export Response","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-09-25T09:56:40.981Z","submitted_at":"2015-09-25T09:56:40.981Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"alyssa_herrera","url":"/alyssa_herrera","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/PGiKyhRYWCkCp45rkdBZUAvL/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":695,"url":"https://hackerone.com/zaption","handle":"zaption","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/695/b8975893f4c9838f55b4f656bc93528666fa68ba_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/695/b8975893f4c9838f55b4f656bc93528666fa68ba_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Zaption","twitter_handle":"zaption","website":"http://www.zaption.com","about":"Interactive video for learning."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2015-10-01T18:05:37.417Z","bug_reporter_agreed_on_going_public_at":"2015-10-01T17:47:28.100Z","team_member_agreed_on_going_public_at":"2015-10-01T18:05:37.315Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Scenario: An attacker creates a response like =AND(2\u003e1) in a tour that allows open response or discussion.  Then when a user who created this tour clicks analytic and clicks to export responses as csv, he will see TRUE instead of  =AND(1\u003e2) Meaning that cell is now active, and an attacker could make a response  using a malicious function to execute malware on a team member's pc. Since functions aren't escaped, the possibilities of using this can be limitless and can cause a severe impact. One example is having it execute malware on staff's computer as seen below, leveraging cmd to execute commands.\n\nCrude Poc for executing cmd\nuse -2+3+cmd|' /C calc'!D2 and could execute malicious commands through CMD. \nD2 is the cell it's located in.\n\n\nThis can be adapted to other spread sheet views like Libre as well\nAlthough excel has a feature to block this by tell a user that it wants to execute an external script, the team member would believe it's a trusted file coming from a trusted website and you will have a very high chance of this being executed. Seeing that it's generated by your site, they may believe it's an enhance functionality of it to stream line data viewing.\n\nBest way to mitigate this vulnerability is if you append ' to the list of triggers, = , + , - Excel will ignore the ' and just show ='AND(2\u003e1) instead\n\nSource: https://www.owasp.org/index.php/CSV_Excel_Macro_Injection\n\n\n\n","vulnerability_information_html":"\u003cp\u003eScenario: An attacker creates a response like =AND(2\u0026gt;1) in a tour that allows open response or discussion.  Then when a user who created this tour clicks analytic and clicks to export responses as csv, he will see TRUE instead of  =AND(1\u0026gt;2) Meaning that cell is now active, and an attacker could make a response  using a malicious function to execute malware on a team member\u0026#39;s pc. Since functions aren\u0026#39;t escaped, the possibilities of using this can be limitless and can cause a severe impact. One example is having it execute malware on staff\u0026#39;s computer as seen below, leveraging cmd to execute commands.\u003c/p\u003e\n\n\u003cp\u003eCrude Poc for executing cmd\u003cbr\u003e\nuse -2+3+cmd|\u0026#39; /C calc\u0026#39;!D2 and could execute malicious commands through CMD. \u003cbr\u003e\nD2 is the cell it\u0026#39;s located in.\u003c/p\u003e\n\n\u003cp\u003eThis can be adapted to other spread sheet views like Libre as well\u003cbr\u003e\nAlthough excel has a feature to block this by tell a user that it wants to execute an external script, the team member would believe it\u0026#39;s a trusted file coming from a trusted website and you will have a very high chance of this being executed. Seeing that it\u0026#39;s generated by your site, they may believe it\u0026#39;s an enhance functionality of it to stream line data viewing.\u003c/p\u003e\n\n\u003cp\u003eBest way to mitigate this vulnerability is if you append \u0026#39; to the list of triggers, = , + , - Excel will ignore the \u0026#39; and just show =\u0026#39;AND(2\u0026gt;1) instead\u003c/p\u003e\n\n\u003cp\u003eSource: \u003ca title=\"https://www.owasp.org/index.php/CSV_Excel_Macro_Injection\" href=\"/redirect?url=https%3A%2F%2Fwww.owasp.org%2Findex.php%2FCSV_Excel_Macro_Injection\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.owasp.org/index.php/CSV_Excel_Macro_Injection\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-10-31T17:47:28.200Z","allow_singular_disclosure_after":-162912114.203244,"singular_disclosure_allowed":true,"vote_count":2,"voters":["alyssa_herrera","spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":598077,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hello there! It looks like you didn't read our rules and follow them carefully. Please read carefully through our rules and exclusions and take some time to understand them before trying to submit another report.","markdown_message":"\u003cp\u003eHello there! It looks like you didn\u0026#39;t read our rules and follow them carefully. Please read carefully through our rules and exclusions and take some time to understand them before trying to submit another report.\u003c/p\u003e\n","automated_response":true,"created_at":"2015-09-25T09:56:41.520Z","updated_at":"2015-09-25T09:56:41.520Z","actor":{"url":"/zaption","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/695/b8975893f4c9838f55b4f656bc93528666fa68ba_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Zaption"}},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":598079,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"violin\nAdditionally this can be used and leveraged in more sophisticated social engineering attacks against users allowing users to be infected with ease","markdown_message":"\u003cp\u003eviolin\u003cbr\u003e\nAdditionally this can be used and leveraged in more sophisticated social engineering attacks against users allowing users to be infected with ease\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-25T09:57:35.427Z","updated_at":"2015-09-25T09:58:31.477Z","actor":{"username":"alyssa_herrera","cleared":true,"url":"/alyssa_herrera","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PGiKyhRYWCkCp45rkdBZUAvL/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":598104,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\"They both recommend that the user should click no if they do not trust the source of the file. If you had personally generated a spreadsheet from a website you trust, would you trust it? This is not a vulnerability in Excel, but in every website that places active content from untrusted/sanitized sources into spreadsheets and allows user to export . Spreadsheet software could take steps to mitigate some of these attacks, but preventing formula injection is ultimately the responsibility of every application that generates spreadsheets containing user-supplied content.\"\n~ http://www.contextis.com/resources/blog/comma-separated-vulnerabilities/","markdown_message":"\u003cp\u003e\u0026quot;They both recommend that the user should click no if they do not trust the source of the file. If you had personally generated a spreadsheet from a website you trust, would you trust it? This is not a vulnerability in Excel, but in every website that places active content from untrusted/sanitized sources into spreadsheets and allows user to export . Spreadsheet software could take steps to mitigate some of these attacks, but preventing formula injection is ultimately the responsibility of every application that generates spreadsheets containing user-supplied content.\u0026quot;\u003cbr\u003e\n~ \u003ca title=\"http://www.contextis.com/resources/blog/comma-separated-vulnerabilities/\" href=\"/redirect?url=http%3A%2F%2Fwww.contextis.com%2Fresources%2Fblog%2Fcomma-separated-vulnerabilities%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.contextis.com/resources/blog/comma-separated-vulnerabilities/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-25T11:07:15.139Z","updated_at":"2015-09-25T11:07:15.139Z","actor":{"username":"alyssa_herrera","cleared":true,"url":"/alyssa_herrera","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PGiKyhRYWCkCp45rkdBZUAvL/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":601330,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"@psychomantis thanks for the report, and sorry for the slow response. This looks like a real issue and we're currently looking into mitigating it.","markdown_message":"\u003cp\u003e\u003ca href=\"/psychomantis\"\u003e@psychomantis\u003c/a\u003e thanks for the report, and sorry for the slow response. This looks like a real issue and we\u0026#39;re currently looking into mitigating it.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-29T08:58:00.472Z","updated_at":"2015-09-29T08:58:00.472Z","actor":{"username":"cstigler","cleared":false,"url":"/cstigler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/092/bb7e2e9669c2b2acf7be03a3632b7fd3e906932a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":601876,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks if you need any more information, please ask","markdown_message":"\u003cp\u003eThanks if you need any more information, please ask\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-29T18:23:53.355Z","updated_at":"2015-09-29T18:23:53.355Z","actor":{"username":"alyssa_herrera","cleared":true,"url":"/alyssa_herrera","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PGiKyhRYWCkCp45rkdBZUAvL/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":602643,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@psychomantis I believe we've resolved this by appending a space before those characters (if they start a field). Can you please test and make sure you're no longer able to reproduce this?","markdown_message":"\u003cp\u003e\u003ca href=\"/psychomantis\"\u003e@psychomantis\u003c/a\u003e I believe we\u0026#39;ve resolved this by appending a space before those characters (if they start a field). Can you please test and make sure you\u0026#39;re no longer able to reproduce this?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-30T07:03:04.881Z","updated_at":"2015-09-30T07:03:04.881Z","actor":{"username":"cstigler","cleared":false,"url":"/cstigler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/092/bb7e2e9669c2b2acf7be03a3632b7fd3e906932a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":602695,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Nope, can still reproduce it. Yahoo and zendesk implemented the ' in between ='and(2\u003e1) so it wouldn't activate ","markdown_message":"\u003cp\u003eNope, can still reproduce it. Yahoo and zendesk implemented the \u0026#39; in between =\u0026#39;and(2\u0026gt;1) so it wouldn\u0026#39;t activate \u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-30T09:03:06.195Z","updated_at":"2015-09-30T09:03:06.195Z","actor":{"username":"alyssa_herrera","cleared":true,"url":"/alyssa_herrera","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PGiKyhRYWCkCp45rkdBZUAvL/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":603796,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@psychomantis can you please let us know which software/version/workflow you're using to reproduce this? And point us to the exact tour that's producing the bad CSV? We can't reproduce anymore on Excel for Mac 2011, OpenOffice (latest), or LibreOffice (latest) with the space fix. Might be a configuration difference?","markdown_message":"\u003cp\u003e\u003ca href=\"/psychomantis\"\u003e@psychomantis\u003c/a\u003e can you please let us know which software/version/workflow you\u0026#39;re using to reproduce this? And point us to the exact tour that\u0026#39;s producing the bad CSV? We can\u0026#39;t reproduce anymore on Excel for Mac 2011, OpenOffice (latest), or LibreOffice (latest) with the space fix. Might be a configuration difference?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-30T20:01:57.372Z","updated_at":"2015-09-30T20:01:57.372Z","actor":{"username":"cstigler","cleared":false,"url":"/cstigler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/092/bb7e2e9669c2b2acf7be03a3632b7fd3e906932a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":604559,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yeah, it is, just tried it on a different computer and it's not activating anymore","markdown_message":"\u003cp\u003eYeah, it is, just tried it on a different computer and it\u0026#39;s not activating anymore\u003c/p\u003e\n","automated_response":false,"created_at":"2015-10-01T05:16:47.495Z","updated_at":"2015-10-01T05:16:55.751Z","actor":{"username":"alyssa_herrera","cleared":true,"url":"/alyssa_herrera","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PGiKyhRYWCkCp45rkdBZUAvL/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":604667,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@psychomantis thanks for testing. We switched it to an apostrophe to be double-sure it won't trigger anywhere. Can you test one more time and make sure it doesn't trigger on any computer anymore?","markdown_message":"\u003cp\u003e\u003ca href=\"/psychomantis\"\u003e@psychomantis\u003c/a\u003e thanks for testing. We switched it to an apostrophe to be double-sure it won\u0026#39;t trigger anywhere. Can you test one more time and make sure it doesn\u0026#39;t trigger on any computer anymore?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-10-01T06:33:04.723Z","updated_at":"2015-10-01T06:33:04.723Z","actor":{"username":"cstigler","cleared":false,"url":"/cstigler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/092/bb7e2e9669c2b2acf7be03a3632b7fd3e906932a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":604745,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yeah, can't reproduce it on my computer  nor friend's computer now. Thanks","markdown_message":"\u003cp\u003eYeah, can\u0026#39;t reproduce it on my computer  nor friend\u0026#39;s computer now. Thanks\u003c/p\u003e\n","automated_response":false,"created_at":"2015-10-01T07:42:03.332Z","updated_at":"2015-10-01T07:42:03.332Z","actor":{"username":"alyssa_herrera","cleared":true,"url":"/alyssa_herrera","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PGiKyhRYWCkCp45rkdBZUAvL/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":605341,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Great! Thank you so much for the reports and for the testing.","markdown_message":"\u003cp\u003eGreat! Thank you so much for the reports and for the testing.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-10-01T16:59:05.703Z","updated_at":"2015-10-01T16:59:05.703Z","actor":{"username":"cstigler","cleared":false,"url":"/cstigler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/092/bb7e2e9669c2b2acf7be03a3632b7fd3e906932a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"alyssa_herrera","url":"/alyssa_herrera"},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":605343,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2015-10-01T16:59:18.093Z","updated_at":"2015-10-01T16:59:18.093Z","actor":{"url":"/zaption","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/695/b8975893f4c9838f55b4f656bc93528666fa68ba_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Zaption"}},"reporter":{"username":"alyssa_herrera","url":"/alyssa_herrera"},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":605383,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-10-01T17:47:28.124Z","updated_at":"2015-10-01T17:47:28.124Z","first_to_agree":true,"actor":{"username":"alyssa_herrera","cleared":true,"url":"/alyssa_herrera","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/PGiKyhRYWCkCp45rkdBZUAvL/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":605407,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-10-01T18:05:37.343Z","updated_at":"2015-10-01T18:05:37.343Z","actor":{"username":"cstigler","cleared":false,"url":"/cstigler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/092/bb7e2e9669c2b2acf7be03a3632b7fd3e906932a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":605408,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-10-01T18:05:37.442Z","updated_at":"2015-10-01T18:05:37.442Z","actor":{"username":"cstigler","cleared":false,"url":"/cstigler","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/092/bb7e2e9669c2b2acf7be03a3632b7fd3e906932a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zaption","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}