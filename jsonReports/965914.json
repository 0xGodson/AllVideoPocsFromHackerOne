{"id":965914,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NjU5MTQ=","url":"https://hackerone.com/reports/965914","title":"`fs.realpath.native` on darwin may cause buffer overflow","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-08-24T15:18:48.855Z","submitted_at":"2020-08-24T15:18:48.912Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ashi009","url":"/ashi009","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22984,"url":"https://hackerone.com/nodejs","handle":"nodejs","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Node.js","twitter_handle":"nodejs","website":"https://nodejs.org","about":"The Node.js JavaScript Runtime"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2020-8252"],"singular_disclosure_disabled":false,"disclosed_at":"2020-10-17T19:17:19.242Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-09-17T19:17:04.247Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"\u003e NOTE! Thanks for submitting a report! Please replace *all* the [square] sections below with the pertinent details. Remember, the more detail you provide, the easier it is for us to triage and respond quickly, so be sure to take your time filling out the report!\n\n**Summary:** \n\nThe libuv's implementation of realpath is flawed on darwin and may cause buffer overflow.\n\n**Description:** \n\nlibuv's `realpath` implementation determines the buffer size with `pathconf` and fallback to `_POSIX_PATH_MAX` (256) if that fails for any reason (eg. `ENOENT`). However `realpath` requires a buffer of at least `PATH_MAX` (1024) bytes to be used, hence causes the buffer overflow if the resolved path is longer than 256 bytes.\n\n## Steps To Reproduce:\n\n1. `LONG_PATH='/tmp/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/path/254B'`\n1. `SHORT_LINK='/tmp/short'`\n1. `mkdir -p \"${LONG_PATH}\"`\n1. `ln -s \"${LONG_PATH}\" \"${SHORT_LINK}\"`\n1. `node -e \"fs.realpathSync.native('${SHORT_LINK}/file-not-exist')\"`\n\n## Impact: \n\nCause node process to crash.\n\n## Supporting Material/References:\n\n- https://github.com/bazelbuild/rules_nodejs/issues/1958\n- https://github.com/libuv/libuv/issues/2965\n- https://github.com/libuv/libuv/issues/2966\n\n## Impact\n\nGiven that nodejs on darwin are mostly desktop applications and used as developer tools, exploit this is very unlikely to cause more damage than an application crash.","vulnerability_information_html":"\u003cblockquote\u003e\n\u003cp\u003eNOTE! Thanks for submitting a report! Please replace \u003cem\u003eall\u003c/em\u003e the [square] sections below with the pertinent details. Remember, the more detail you provide, the easier it is for us to triage and respond quickly, so be sure to take your time filling out the report!\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e \u003c/p\u003e\n\n\u003cp\u003eThe libuv\u0026#39;s implementation of realpath is flawed on darwin and may cause buffer overflow.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e \u003c/p\u003e\n\n\u003cp\u003elibuv\u0026#39;s \u003ccode\u003erealpath\u003c/code\u003e implementation determines the buffer size with \u003ccode\u003epathconf\u003c/code\u003e and fallback to \u003ccode\u003e_POSIX_PATH_MAX\u003c/code\u003e (256) if that fails for any reason (eg. \u003ccode\u003eENOENT\u003c/code\u003e). However \u003ccode\u003erealpath\u003c/code\u003e requires a buffer of at least \u003ccode\u003ePATH_MAX\u003c/code\u003e (1024) bytes to be used, hence causes the buffer overflow if the resolved path is longer than 256 bytes.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003eLONG_PATH=\u0026#39;/tmp/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/long/path/254B\u0026#39;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eSHORT_LINK=\u0026#39;/tmp/short\u0026#39;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emkdir -p \u0026quot;${LONG_PATH}\u0026quot;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eln -s \u0026quot;${LONG_PATH}\u0026quot; \u0026quot;${SHORT_LINK}\u0026quot;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003enode -e \u0026quot;fs.realpathSync.native(\u0026#39;${SHORT_LINK}/file-not-exist\u0026#39;)\u0026quot;\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact:\u003c/h2\u003e\n\n\u003cp\u003eCause node process to crash.\u003c/p\u003e\n\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca title=\"https://github.com/bazelbuild/rules_nodejs/issues/1958\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fbazelbuild%2Frules_nodejs%2Fissues%2F1958\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/bazelbuild/rules_nodejs/issues/1958\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca title=\"https://github.com/libuv/libuv/issues/2965\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Flibuv%2Flibuv%2Fissues%2F2965\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/libuv/libuv/issues/2965\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca title=\"https://github.com/libuv/libuv/issues/2966\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Flibuv%2Flibuv%2Fissues%2F2966\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/libuv/libuv/issues/2966\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eGiven that nodejs on darwin are mostly desktop applications and used as developer tools, exploit this is very unlikely to cause more damage than an application crash.\u003c/p\u003e\n","weakness":{"id":3,"name":"Classic Buffer Overflow"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-10-17T19:17:04.362Z","allow_singular_disclosure_after":-6263932.016273122,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":666,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/nodejs/node","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":9164410,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@ashi009 would you like attribution when this goes out in a security release and if so could you provide what you'd like in terms of\n\nThank you to X who works at Y for reporting this vulnerability.","markdown_message":"\u003cp\u003e\u003ca href=\"/ashi009\"\u003e@ashi009\u003c/a\u003e would you like attribution when this goes out in a security release and if so could you provide what you\u0026#39;d like in terms of\u003c/p\u003e\n\n\u003cp\u003eThank you to X who works at Y for reporting this vulnerability.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-09-08T21:25:41.903Z","updated_at":"2020-09-08T21:25:41.903Z","actor":{"username":"mhdawson","cleared":false,"url":"/mhdawson","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9220201,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@ashi009 one last ping","markdown_message":"\u003cp\u003e\u003ca href=\"/ashi009\"\u003e@ashi009\u003c/a\u003e one last ping\u003c/p\u003e\n","automated_response":false,"created_at":"2020-09-14T19:42:56.458Z","updated_at":"2020-09-14T19:42:56.458Z","actor":{"username":"mhdawson","cleared":false,"url":"/mhdawson","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9232028,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@mhdawson Sorry for the late reply. Wasn't paying attention to the mail list.\n\nI'd love to.\n\n\u003e Thank you Xiaoyi Shi who works at Tencent for reporting this vulnerability.","markdown_message":"\u003cp\u003e\u003ca href=\"/mhdawson\"\u003e@mhdawson\u003c/a\u003e Sorry for the late reply. Wasn\u0026#39;t paying attention to the mail list.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;d love to.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThank you Xiaoyi Shi who works at Tencent for reporting this vulnerability.\u003c/p\u003e\n\u003c/blockquote\u003e\n","automated_response":false,"created_at":"2020-09-16T00:36:58.400Z","updated_at":"2020-09-16T00:36:58.400Z","actor":{"username":"ashi009","cleared":false,"url":"/ashi009","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9250441,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Resolved in september seucrity release: https://nodejs.org/en/blog/vulnerability/september-2020-security-releases/","markdown_message":"\u003cp\u003eResolved in september seucrity release: \u003ca title=\"https://nodejs.org/en/blog/vulnerability/september-2020-security-releases/\" href=\"/redirect?url=https%3A%2F%2Fnodejs.org%2Fen%2Fblog%2Fvulnerability%2Fseptember-2020-security-releases%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://nodejs.org/en/blog/vulnerability/september-2020-security-releases/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2020-09-17T19:16:34.807Z","updated_at":"2020-09-17T19:16:34.807Z","actor":{"username":"mhdawson","cleared":false,"url":"/mhdawson","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9250444,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2020-09-17T19:16:54.405Z","updated_at":"2020-09-17T19:16:54.405Z","actor":{"username":"mhdawson","cleared":false,"url":"/mhdawson","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"ashi009","url":"/ashi009"},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9250448,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-09-17T19:17:04.286Z","updated_at":"2020-09-17T19:17:04.286Z","first_to_agree":true,"actor":{"username":"mhdawson","cleared":false,"url":"/mhdawson","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9250766,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@ashi009 sorry, I'd already prep'd everything and did not check again for your response.  I've PR'd into the blog post here: https://github.com/nodejs/nodejs.org/pull/3385/files","markdown_message":"\u003cp\u003e\u003ca href=\"/ashi009\"\u003e@ashi009\u003c/a\u003e sorry, I\u0026#39;d already prep\u0026#39;d everything and did not check again for your response.  I\u0026#39;ve PR\u0026#39;d into the blog post here: \u003ca title=\"https://github.com/nodejs/nodejs.org/pull/3385/files\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnodejs%2Fnodejs.org%2Fpull%2F3385%2Ffiles\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nodejs/nodejs.org/pull/3385/files\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2020-09-17T19:21:53.484Z","updated_at":"2020-09-17T19:21:53.484Z","actor":{"username":"mhdawson","cleared":false,"url":"/mhdawson","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9552817,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-17T19:17:19.262Z","updated_at":"2020-10-17T19:17:19.262Z","actor":{"url":"/nodejs","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Node.js"}},"genius_execution_id":null,"team_handle":"nodejs","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}