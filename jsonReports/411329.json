{"id":411329,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MTEzMjk=","url":"https://hackerone.com/reports/411329","title":"code injection, steam chat client","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-09-19T03:54:17.233Z","submitted_at":"2018-09-19T03:54:17.233Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zemnmez","url":"/zemnmez","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/005/901/3bc595305f55caeb2f1b1b1b5bc1f5c82a20dca6_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":23363,"url":"https://hackerone.com/valve","handle":"valve","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/023/363/c78d46a7d0ea39e3a15a7c19c1a48634f2571eb9_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/363/c78d46a7d0ea39e3a15a7c19c1a48634f2571eb9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Valve","twitter_handle":"","website":"https://www.valvesoftware.com","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-01-07T20:01:32.520Z","bug_reporter_agreed_on_going_public_at":"2019-01-03T14:42:48.317Z","team_member_agreed_on_going_public_at":"2019-01-07T20:01:32.390Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The steam chat client allows oEmbed, apparently based on a whitelist. One of the whitelisted oEmbedis codepen. When a codepen is created, it can be sent as a link to another steam user, and the code inside the codepen will execute within the privileged Steam Chat context.\n\nYou can send these codepen links to someone and they'll perform some action when you open them\n\nhttps://codepen.io/zemnmez/pen/mGQvvq this one pops calc.exe\nhttps://codepen.io/zemnmez/pen/eLLYLr  this opens a ton of windows\nhttps://codepen.io/zemnmez/pen/pOQBYa this one opens team fortress 2\n\n## Impact\n\nWhile poking around inside this context I noticed a few things:\n1. `steam://` links are executed in a privileged mode not normally accessible in the steamwebhelper. `steam://`uris are executed immediately, and in most contexts without confirmation.  This codepen, if sent to a user will immediately run Team Fortress 2 when clicked, if installed: https://codepen.io/zemnmez/pen/zJMeYe (you can use the same technique with `runsafe` to nuke a user's settings).\n\nSince there is no confirmation here, I strongly believe with some extra research a game could be opened with command line parameters and no confirmation that results in remote code execution as in [this paper](http://revuln.com/files/ReVuln_Steam_Browser_Protocol_Insecurity.pdf). Anything that otherwise happens with no confirmation, such as play / pausing music and accepting guest passes is controllable by this method.\n\n2. All custom-protocol urls are executed, including windows internal protocol urls. the `jarfile:[FILEPATH] [PARAMS]` form can be used to run any java program on their PC, same with wscript.exe and .js or .vbs files via the `JSEFile:` protocol. In windows, every file format has its own custom protocol which is used internally to execute files of that format.\n\n2. A `SteamClient` API is exposed via the JS VM to the browsing context.  Ordinarily this API is very slim (perhaps for security purposes), but by using `open('chrome-devtools://devtools/bundled/inspector.html')` to open a url that doesn't open in the browser we can spawn a new window with fewer restrictions. From here we can read the user's cursor position, move the window around, make it bigger smaller, paste (though I couldn't get the API to work for this) and generally be a nuisance. I feel very sure there are APIs I can abuse here, but I've had a hard time finding them.","vulnerability_information_html":"\u003cp\u003eThe steam chat client allows oEmbed, apparently based on a whitelist. One of the whitelisted oEmbedis codepen. When a codepen is created, it can be sent as a link to another steam user, and the code inside the codepen will execute within the privileged Steam Chat context.\u003c/p\u003e\n\n\u003cp\u003eYou can send these codepen links to someone and they\u0026#39;ll perform some action when you open them\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://codepen.io/zemnmez/pen/mGQvvq\" href=\"/redirect?url=https%3A%2F%2Fcodepen.io%2Fzemnmez%2Fpen%2FmGQvvq\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://codepen.io/zemnmez/pen/mGQvvq\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e this one pops calc.exe\u003cbr\u003e\n\u003ca title=\"https://codepen.io/zemnmez/pen/eLLYLr\" href=\"/redirect?url=https%3A%2F%2Fcodepen.io%2Fzemnmez%2Fpen%2FeLLYLr\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://codepen.io/zemnmez/pen/eLLYLr\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e  this opens a ton of windows\u003cbr\u003e\n\u003ca title=\"https://codepen.io/zemnmez/pen/pOQBYa\" href=\"/redirect?url=https%3A%2F%2Fcodepen.io%2Fzemnmez%2Fpen%2FpOQBYa\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://codepen.io/zemnmez/pen/pOQBYa\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e this one opens team fortress 2\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eWhile poking around inside this context I noticed a few things:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003esteam://\u003c/code\u003e links are executed in a privileged mode not normally accessible in the steamwebhelper. \u003ccode\u003esteam://\u003c/code\u003euris are executed immediately, and in most contexts without confirmation.  This codepen, if sent to a user will immediately run Team Fortress 2 when clicked, if installed: \u003ca title=\"https://codepen.io/zemnmez/pen/zJMeYe\" href=\"/redirect?url=https%3A%2F%2Fcodepen.io%2Fzemnmez%2Fpen%2FzJMeYe\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://codepen.io/zemnmez/pen/zJMeYe\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (you can use the same technique with \u003ccode\u003erunsafe\u003c/code\u003e to nuke a user\u0026#39;s settings).\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eSince there is no confirmation here, I strongly believe with some extra research a game could be opened with command line parameters and no confirmation that results in remote code execution as in \u003ca href=\"/redirect?url=http%3A%2F%2Frevuln.com%2Ffiles%2FReVuln_Steam_Browser_Protocol_Insecurity.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ethis paper\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Anything that otherwise happens with no confirmation, such as play / pausing music and accepting guest passes is controllable by this method.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eAll custom-protocol urls are executed, including windows internal protocol urls. the \u003ccode\u003ejarfile:[FILEPATH] [PARAMS]\u003c/code\u003e form can be used to run any java program on their PC, same with wscript.exe and .js or .vbs files via the \u003ccode\u003eJSEFile:\u003c/code\u003e protocol. In windows, every file format has its own custom protocol which is used internally to execute files of that format.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eA \u003ccode\u003eSteamClient\u003c/code\u003e API is exposed via the JS VM to the browsing context.  Ordinarily this API is very slim (perhaps for security purposes), but by using \u003ccode\u003eopen(\u0026#39;chrome-devtools://devtools/bundled/inspector.html\u0026#39;)\u003c/code\u003e to open a url that doesn\u0026#39;t open in the browser we can spawn a new window with fewer restrictions. From here we can read the user\u0026#39;s cursor position, move the window around, make it bigger smaller, paste (though I couldn\u0026#39;t get the API to work for this) and generally be a nuisance. I feel very sure there are APIs I can abuse here, but I\u0026#39;ve had a hard time finding them.\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n","bounty_amount":"750.0","formatted_bounty":"$750","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":23,"voters":["njbooher","hexpwn","byq","mvc","sameerphad72","romesful","imran_nazir","theappsec","mygf","bl4ckh4ck5","and 13 more..."],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":{"databaseId":1285,"asset_type":"DOWNLOADABLE_EXECUTABLES","asset_identifier":"steam.exe","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3375819,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"alright. I did some more sleuthing today, and volia! remote code execution:\n\nhttps://codepen.io/zemnmez/pen/pOBVao?editors=1010","markdown_message":"\u003cp\u003ealright. I did some more sleuthing today, and volia! remote code execution:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://codepen.io/zemnmez/pen/pOBVao?editors=1010\" href=\"/redirect?url=https%3A%2F%2Fcodepen.io%2Fzemnmez%2Fpen%2FpOBVao%3Feditors%3D1010\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://codepen.io/zemnmez/pen/pOBVao?editors=1010\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-23T12:44:48.041Z","updated_at":"2018-09-23T12:44:48.041Z","actor":{"username":"zemnmez","cleared":false,"url":"/zemnmez","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/901/3bc595305f55caeb2f1b1b1b5bc1f5c82a20dca6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3383579,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @zemnmez,\n\nThanks for your submission. We are currently reviewing your report and will get back to you once we have additional information to share.\n\nKind regards,\n\n@fidgetspinner","markdown_message":"\u003cp\u003eHi \u003ca href=\"/zemnmez\"\u003e@zemnmez\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks for your submission. We are currently reviewing your report and will get back to you once we have additional information to share.\u003c/p\u003e\n\n\u003cp\u003eKind regards,\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"/fidgetspinner\"\u003e@fidgetspinner\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-25T06:02:22.283Z","updated_at":"2018-09-25T06:02:22.283Z","actor":{"username":"fidgetspinner","cleared":false,"url":"/fidgetspinner","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/239/770/3f9a1c9fcbb39dc86cab06aed16dda92753a5eee_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3417320,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-02T00:14:23.171Z","updated_at":"2018-10-02T00:14:23.171Z","actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3417326,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-02T00:14:58.971Z","updated_at":"2018-10-02T00:14:58.971Z","additional_data":{"old_severity":"High (8.2)","new_severity":"Medium (6.5)","old_severity_id":211752,"new_severity_id":217957},"actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3442225,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-06T00:41:06.354Z","updated_at":"2018-10-06T00:41:06.354Z","additional_data":{"old_severity":"Medium (6.5)","new_severity":"Medium","old_severity_id":217957,"new_severity_id":220623},"actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3442228,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"The higher-severity components of this issue really depend on issue #409850, which is why we've adjusted the severity on this report.","markdown_message":"\u003cp\u003eThe higher-severity components of this issue really depend on issue \u003ca href=\"/reports/409850\"\u003e#409850\u003c/a\u003e, which is why we\u0026#39;ve adjusted the severity on this report.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-06T00:42:08.222Z","updated_at":"2018-10-06T00:42:08.222Z","actor":{"url":"/valve","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/363/c78d46a7d0ea39e3a15a7c19c1a48634f2571eb9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Valve"}},"bounty_amount":"750.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"valve","collaborator":{"username":"zemnmez","url":"/zemnmez"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3442229,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for the report! We have deployed a fix to our production systems. Please let us know if you are still able to reproduce the issue.","markdown_message":"\u003cp\u003eThanks for the report! We have deployed a fix to our production systems. Please let us know if you are still able to reproduce the issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-06T00:42:20.945Z","updated_at":"2018-10-06T00:42:20.945Z","actor":{"username":"jonp","cleared":false,"url":"/jonp","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/203/578/6de63d2fdd8c70309cf4326359d3e816a7633b5c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"zemnmez","url":"/zemnmez"},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3444067,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"thank you so much!! I will take a look soon. i am clearing up my room today","markdown_message":"\u003cp\u003ethank you so much!! I will take a look soon. i am clearing up my room today\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-06T20:25:18.380Z","updated_at":"2018-10-06T20:25:18.380Z","actor":{"username":"zemnmez","cleared":false,"url":"/zemnmez","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/901/3bc595305f55caeb2f1b1b1b5bc1f5c82a20dca6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3444068,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"thank you so much!! I will take a look soon. i am busy today :)","markdown_message":"\u003cp\u003ethank you so much!! I will take a look soon. i am busy today :)\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-06T20:25:36.595Z","updated_at":"2018-10-06T20:25:36.595Z","actor":{"username":"zemnmez","cleared":false,"url":"/zemnmez","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/901/3bc595305f55caeb2f1b1b1b5bc1f5c82a20dca6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3920045,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-01-03T14:42:48.350Z","updated_at":"2019-01-03T14:42:48.350Z","first_to_agree":true,"actor":{"username":"zemnmez","cleared":false,"url":"/zemnmez","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/005/901/3bc595305f55caeb2f1b1b1b5bc1f5c82a20dca6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3938316,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-01-07T20:01:32.436Z","updated_at":"2019-01-07T20:01:32.436Z","actor":{"username":"spacecore","cleared":false,"url":"/spacecore","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/HEZj9dxuvXmEYBRfi6xzVDpD/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3938317,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-01-07T20:01:32.548Z","updated_at":"2019-01-07T20:01:32.548Z","actor":{"username":"spacecore","cleared":false,"url":"/spacecore","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/HEZj9dxuvXmEYBRfi6xzVDpD/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}