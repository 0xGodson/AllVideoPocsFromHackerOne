{"id":538800,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81Mzg4MDA=","url":"https://hackerone.com/reports/538800","title":"Account takeover by changing email","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2019-04-15T19:54:17.948Z","submitted_at":"2019-04-15T19:54:17.948Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"tomoh","url":"/tomoh","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":134,"url":"https://hackerone.com/khanacademy","handle":"khanacademy","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/134/e62a822e39ad039f23a0b89bfaaaf7bf97c5f11f_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/134/e62a822e39ad039f23a0b89bfaaaf7bf97c5f11f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Khan Academy","twitter_handle":"","website":"https://www.khanacademy.org/","about":"Start learning now. Completely free, forever."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-05-17T03:35:49.134Z","bug_reporter_agreed_on_going_public_at":"2019-04-17T03:35:46.827Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The endpoint `/signup/email` allows users to change their email before they confirm their account email. This endpoint is not protected from CSRF. Thus, any account that is not yet \"confirmed\" is vulnerable to account takeover using the following steps:\n1. Attacker obtains new email address not associated with a KA account.\n2. Attacker then lures a new KA user to visit a URL linking to a page that sends a `POST` request to `/signup/email` with the POST body : `casing=camel\u0026email=ATTACKER_EMAIL`.\n3. The email change will go through and the attacker would then be able to take over the unconfirmed account using password reset.\n4. The original user would not be able to reclaim account since the original email is now not associated with any KA account.\n\n## Impact\n\nAttackers would be able to takeover any unconfirmed account on Khan Academy. And since unconfirmed users can participate in most activities on the website, this could lead to leakage of personal info. Since this ATO does not require any knowledge of the user's email address or KAID, it would become possible to launch large scale attacks by posting malicious links on forums or other places on the internet that KA users would visit.","vulnerability_information_html":"\u003cp\u003eThe endpoint \u003ccode\u003e/signup/email\u003c/code\u003e allows users to change their email before they confirm their account email. This endpoint is not protected from CSRF. Thus, any account that is not yet \u0026quot;confirmed\u0026quot; is vulnerable to account takeover using the following steps:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAttacker obtains new email address not associated with a KA account.\u003c/li\u003e\n\u003cli\u003eAttacker then lures a new KA user to visit a URL linking to a page that sends a \u003ccode\u003ePOST\u003c/code\u003e request to \u003ccode\u003e/signup/email\u003c/code\u003e with the POST body : \u003ccode\u003ecasing=camel\u0026amp;email=ATTACKER_EMAIL\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe email change will go through and the attacker would then be able to take over the unconfirmed account using password reset.\u003c/li\u003e\n\u003cli\u003eThe original user would not be able to reclaim account since the original email is now not associated with any KA account.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAttackers would be able to takeover any unconfirmed account on Khan Academy. And since unconfirmed users can participate in most activities on the website, this could lead to leakage of personal info. Since this ATO does not require any knowledge of the user\u0026#39;s email address or KAID, it would become possible to launch large scale attacks by posting malicious links on forums or other places on the internet that KA users would visit.\u003c/p\u003e\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-05-17T03:35:46.885Z","allow_singular_disclosure_after":-51158431.0147347,"singular_disclosure_allowed":true,"vote_count":71,"voters":["spaceraccoon","luisk2","mik317","sameerphad72","yashrs","dhakal_ananda","mygf","aeswagyewgyes","kingragnar","eveeez","and 61 more..."],"severity":{"rating":"critical","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":4567919,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hey @tomoh,\n\nGood find on this one. We've been looking at it and should be able to get a fix out ASAP. This is code that's only used in rare cases (I'm curious how you found this API?), but security through obscurity is not our motto :)\n\nbest,\nDave","markdown_message":"\u003cp\u003eHey \u003ca href=\"/tomoh\"\u003e@tomoh\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eGood find on this one. We\u0026#39;ve been looking at it and should be able to get a fix out ASAP. This is code that\u0026#39;s only used in rare cases (I\u0026#39;m curious how you found this API?), but security through obscurity is not our motto :)\u003c/p\u003e\n\n\u003cp\u003ebest,\u003cbr\u003e\nDave\u003c/p\u003e\n","automated_response":false,"created_at":"2019-04-15T21:55:40.512Z","updated_at":"2019-04-15T21:55:40.512Z","actor":{"username":"drosile","cleared":false,"url":"/drosile","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Q4ceVVjALdR4FtiZDBdehawK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4568931,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @drosile,\nThanks for the fast response! I found this endpoint when testing the \"Invite student by email\" functionality. There was an option to change the account email after the student signs up. It's not shown to all new accounts, but nonetheless works for all unconfirmed accounts.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/drosile\"\u003e@drosile\u003c/a\u003e,\u003cbr\u003e\nThanks for the fast response! I found this endpoint when testing the \u0026quot;Invite student by email\u0026quot; functionality. There was an option to change the account email after the student signs up. It\u0026#39;s not shown to all new accounts, but nonetheless works for all unconfirmed accounts.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-04-16T03:23:59.329Z","updated_at":"2019-04-16T03:23:59.329Z","actor":{"username":"tomoh","cleared":false,"url":"/tomoh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4579446,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @tomoh,\n\nI was able to roll out a fix for this one tonight. Could you double check it for me? Thanks again for your report!\n\nbest,\nDave","markdown_message":"\u003cp\u003eHey \u003ca href=\"/tomoh\"\u003e@tomoh\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eI was able to roll out a fix for this one tonight. Could you double check it for me? Thanks again for your report!\u003c/p\u003e\n\n\u003cp\u003ebest,\u003cbr\u003e\nDave\u003c/p\u003e\n","automated_response":false,"created_at":"2019-04-17T01:39:18.613Z","updated_at":"2019-04-17T01:39:18.613Z","actor":{"username":"drosile","cleared":false,"url":"/drosile","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Q4ceVVjALdR4FtiZDBdehawK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"tomoh","url":"/tomoh"},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4579639,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, this is fixed!","markdown_message":"\u003cp\u003eYes, this is fixed!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-04-17T03:35:27.294Z","updated_at":"2019-04-17T03:35:27.294Z","actor":{"username":"tomoh","cleared":false,"url":"/tomoh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4579640,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-17T03:35:46.853Z","updated_at":"2019-04-17T03:35:46.853Z","first_to_agree":true,"actor":{"username":"tomoh","cleared":false,"url":"/tomoh","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4863413,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-05-17T03:35:49.155Z","updated_at":"2019-05-17T03:35:49.155Z","actor":{"url":"/khanacademy","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/134/e62a822e39ad039f23a0b89bfaaaf7bf97c5f11f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Khan Academy"}},"genius_execution_id":null,"team_handle":"khanacademy","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}