{"id":226896,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjY4OTY=","url":"https://hackerone.com/reports/226896","title":"Nextcloud Server Remote Command Execution","state":"Closed","substate":"not-applicable","severity_rating":"high","readable_substate":"N/A","created_at":"2017-05-08T14:12:27.054Z","submitted_at":"2017-05-08T14:12:27.054Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sniperpex","url":"/sniperpex","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/031/539/7a8fda8df50f7759dccaf81642706dae5f0543bc_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-05-10T09:02:11.391Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-05-10T09:00:02.778Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hy NextCloud Security Team i found a critical vulnerability (RCE) :\n\nNextcloud Server 11.0.2 is affected by a critical vulnerability, which gives to the attacker complete permission to run a system command. \n\nThe root cause is insufficient validation of arguments to the exec function.\n\nVulnerable Code (498 - 525) /lib/private/legacy/helper.php:\n===================\npublic static function findBinaryPath($program) {\n\t\t$memcache = \\OC::$server-\u003egetMemCacheFactory()-\u003ecreate('findBinaryPath');\n\t\tif ($memcache-\u003ehasKey($program)) {\n\t\t\treturn $memcache-\u003eget($program);\n\t\t}\n\t\t$result = null;\n\t\tif (self::is_function_enabled('exec')) {\n\t\t\t$exeSniffer = new ExecutableFinder();\n\t\t\t// Returns null if nothing is found\n\t\t\t$result = $exeSniffer-\u003efind($program); \n\t\t\tif (empty($result)) {\n\t\t\t\t$paths = getenv('PATH');\n\t\t\t\tif (empty($paths)) {\n\t\t\t\t\t$paths = '/usr/local/bin /usr/bin /opt/bin /bin';\n\t\t\t\t} else {\n\t\t\t\t\t$paths = str_replace(':',' ',getenv('PATH'));\n\t\t\t\t}\n\t\t\t\t$command = 'find ' . $paths . ' -name ' . escapeshellarg($program) . ' 2\u003e /dev/null';\n\t\t\t\texec($command, $output, $returnCode);\n\t\t\t\tif (count($output) \u003e 0) {\n\t\t\t\t\t$result = escapeshellcmd($output[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// store the value for 5 minutes\n\t\t$memcache-\u003eset($program, $result, 300);\n\t\treturn $result;\n\t}","vulnerability_information_html":"\u003cp\u003eHy NextCloud Security Team i found a critical vulnerability (RCE) :\u003c/p\u003e\n\n\u003cp\u003eNextcloud Server 11.0.2 is affected by a critical vulnerability, which gives to the attacker complete permission to run a system command. \u003c/p\u003e\n\n\u003cp\u003eThe root cause is insufficient validation of arguments to the exec function.\u003c/p\u003e\n\n\u003ch1 id=\"vulnerable-code-498-525-lib-private-legacy-helper-php\"\u003eVulnerable Code (498 - 525) /lib/private/legacy/helper.php:\u003c/h1\u003e\n\n\u003cp\u003epublic static function findBinaryPath($program) {\u003cbr\u003e\n        $memcache = \\OC::$server-\u0026gt;getMemCacheFactory()-\u0026gt;create(\u0026#39;findBinaryPath\u0026#39;);\u003cbr\u003e\n        if ($memcache-\u0026gt;hasKey($program)) {\u003cbr\u003e\n            return $memcache-\u0026gt;get($program);\u003cbr\u003e\n        }\u003cbr\u003e\n        $result = null;\u003cbr\u003e\n        if (self::is_function_enabled(\u0026#39;exec\u0026#39;)) {\u003cbr\u003e\n            $exeSniffer = new ExecutableFinder();\u003cbr\u003e\n            // Returns null if nothing is found\u003cbr\u003e\n            $result = $exeSniffer-\u0026gt;find($program); \u003cbr\u003e\n            if (empty($result)) {\u003cbr\u003e\n                $paths = getenv(\u0026#39;PATH\u0026#39;);\u003cbr\u003e\n                if (empty($paths)) {\u003cbr\u003e\n                    $paths = \u0026#39;/usr/local/bin /usr/bin /opt/bin /bin\u0026#39;;\u003cbr\u003e\n                } else {\u003cbr\u003e\n                    $paths = str_replace(\u0026#39;:\u0026#39;,\u0026#39; \u0026#39;,getenv(\u0026#39;PATH\u0026#39;));\u003cbr\u003e\n                }\u003cbr\u003e\n                $command = \u0026#39;find \u0026#39; . $paths . \u0026#39; -name \u0026#39; . escapeshellarg($program) . \u0026#39; 2\u0026gt; /dev/null\u0026#39;;\u003cbr\u003e\n                exec($command, $output, $returnCode);\u003cbr\u003e\n                if (count($output) \u0026gt; 0) {\u003cbr\u003e\n                    $result = escapeshellcmd($output[0]);\u003cbr\u003e\n                }\u003cbr\u003e\n            }\u003cbr\u003e\n        }\u003cbr\u003e\n        // store the value for 5 minutes\u003cbr\u003e\n        $memcache-\u0026gt;set($program, $result, 300);\u003cbr\u003e\n        return $result;\u003cbr\u003e\n    }\u003c/p\u003e\n","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":3,"voters":["spetr0x","hi_man","sniperpex"],"severity":{"rating":"high","score":7.0,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"low","availability":"low"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1660338,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","markdown_message":"\u003cp\u003eThanks a lot for reporting this potential issue back to us!\u003c/p\u003e\n\n\u003cp\u003eOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we\u0026#39;d like to ask you to not disclose this issue to any other party.\u003c/p\u003e\n","automated_response":true,"created_at":"2017-05-08T14:12:27.208Z","updated_at":"2017-05-08T14:12:27.208Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1660342,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Please provide some more information on how this is exploitable. `findBinaryPath` seems only to be called with trusted hard-coded input.","markdown_message":"\u003cp\u003ePlease provide some more information on how this is exploitable. \u003ccode\u003efindBinaryPath\u003c/code\u003e seems only to be called with trusted hard-coded input.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-08T14:13:30.904Z","updated_at":"2017-05-08T14:13:30.904Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1660351,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"In this two line :\n\n$command = 'find ' . $paths . ' -name ' . escapeshellarg($program) . ' 2\u003e /dev/null';\nexec($command, $output, $returnCode);\n\nthe variable command contain a command to execute the find command and in the second line we have \"exec\" function and this function like:\n\nsystem() -\npassthru() -\n\nand you use exec($command ......) and if we change the content of $command to (id or ls or ....) the system will execute the command ","markdown_message":"\u003cp\u003eIn this two line :\u003c/p\u003e\n\n\u003cp\u003e$command = \u0026#39;find \u0026#39; . $paths . \u0026#39; -name \u0026#39; . escapeshellarg($program) . \u0026#39; 2\u0026gt; /dev/null\u0026#39;;\u003cbr\u003e\nexec($command, $output, $returnCode);\u003c/p\u003e\n\n\u003cp\u003ethe variable command contain a command to execute the find command and in the second line we have \u0026quot;exec\u0026quot; function and this function like:\u003c/p\u003e\n\n\u003cp\u003esystem() -\u003cbr\u003e\npassthru() -\u003c/p\u003e\n\n\u003cp\u003eand you use exec($command ......) and if we change the content of $command to (id or ls or ....) the system will execute the command \u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-08T14:19:21.076Z","updated_at":"2017-05-08T14:19:21.076Z","actor":{"username":"sniperpex","cleared":false,"url":"/sniperpex","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/031/539/7a8fda8df50f7759dccaf81642706dae5f0543bc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1660499,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"As stated above `findBinaryPath` is only called with trusted hard-coded input. Unless you can show a valid proof of concept here we consider this not applicable.","markdown_message":"\u003cp\u003eAs stated above \u003ccode\u003efindBinaryPath\u003c/code\u003e is only called with trusted hard-coded input. Unless you can show a valid proof of concept here we consider this not applicable.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-08T15:01:26.827Z","updated_at":"2017-05-08T15:01:26.827Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1665237,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"CVE Validate it:   CVE-2017-6959","markdown_message":"\u003cp\u003eCVE Validate it:   CVE-2017-6959\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-10T08:37:26.063Z","updated_at":"2017-05-10T08:37:26.063Z","actor":{"username":"sniperpex","cleared":false,"url":"/sniperpex","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/031/539/7a8fda8df50f7759dccaf81642706dae5f0543bc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1665249,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"While I appreciate your enthusiasm I'd like to note again that the code is only called with hard-coded values and trusted input. Until now you have failed to provide us with a proof of concept for this issue.\n\nThe fact that a function can take input and actually evaluates it is by itself not a security risk unless user input is passed to this function. Which we fail to see here looking at https://github.com/search?q=user%3Anextcloud+findBinaryPath\u0026type=Code\u0026utf8=%E2%9C%93\n\nWe hereby dispute the CVE, please let us know at which CNA you have requested it so that we can reach out to them.","markdown_message":"\u003cp\u003eWhile I appreciate your enthusiasm I\u0026#39;d like to note again that the code is only called with hard-coded values and trusted input. Until now you have failed to provide us with a proof of concept for this issue.\u003c/p\u003e\n\n\u003cp\u003eThe fact that a function can take input and actually evaluates it is by itself not a security risk unless user input is passed to this function. Which we fail to see here looking at \u003ca title=\"https://github.com/search?q=user%3Anextcloud+findBinaryPath\u0026amp;type=Code\u0026amp;utf8=%E2%9C%93\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fsearch%3Fq%3Duser%253Anextcloud%2BfindBinaryPath%26type%3DCode%26utf8%3D%25E2%259C%2593\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/search?q=user%3Anextcloud+findBinaryPath\u0026amp;type=Code\u0026amp;utf8=%E2%9C%93\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWe hereby dispute the CVE, please let us know at which CNA you have requested it so that we can reach out to them.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-10T08:42:01.419Z","updated_at":"2017-05-10T08:42:01.419Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1665266,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-10T09:00:02.789Z","updated_at":"2017-05-10T09:00:02.789Z","first_to_agree":true,"actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1665268,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-10T09:02:11.364Z","updated_at":"2017-05-10T09:02:11.364Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1669203,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The CVE has been rejected now as per http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-6959.","markdown_message":"\u003cp\u003eThe CVE has been rejected now as per \u003ca title=\"http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-6959\" href=\"/redirect?url=http%3A%2F%2Fwww.cve.mitre.org%2Fcgi-bin%2Fcvename.cgi%3Fname%3D2017-6959\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-6959\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-11T23:15:36.296Z","updated_at":"2017-05-11T23:15:44.442Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":3993,"category":"team","content":"While we appreciate the reporter's enthusiasm we'd like to note that the code is only called with hard-coded values and trusted input. Until now the reporter has failed to provide us with a proof of concept for this issue.\n\nThe fact that a function can take input and actually evaluates it is by itself not a security risk unless user input is passed to this function. Which we fail to see here looking at https://github.com/search?q=user%3Anextcloud+findBinaryPath\u0026type=Code\u0026utf8=%E2%9C%93\n\nAs the reporter claimed to have requested a CVE identifier for this issue ([CVE-2017-6959](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-6959)) we have publicly disclosed this issue to dispute this CVE.\n\n------\n\n**Update:** [The CVE has been rejected.](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-6959)","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eWhile we appreciate the reporter\u0026#39;s enthusiasm we\u0026#39;d like to note that the code is only called with hard-coded values and trusted input. Until now the reporter has failed to provide us with a proof of concept for this issue.\u003c/p\u003e\n\n\u003cp\u003eThe fact that a function can take input and actually evaluates it is by itself not a security risk unless user input is passed to this function. Which we fail to see here looking at \u003ca title=\"https://github.com/search?q=user%3Anextcloud+findBinaryPath\u0026amp;type=Code\u0026amp;utf8=%E2%9C%93\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fsearch%3Fq%3Duser%253Anextcloud%2BfindBinaryPath%26type%3DCode%26utf8%3D%25E2%259C%2593\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/search?q=user%3Anextcloud+findBinaryPath\u0026amp;type=Code\u0026amp;utf8=%E2%9C%93\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAs the reporter claimed to have requested a CVE identifier for this issue (\u003ca href=\"/redirect?url=http%3A%2F%2Fwww.cve.mitre.org%2Fcgi-bin%2Fcvename.cgi%3Fname%3D2017-6959\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCVE-2017-6959\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) we have publicly disclosed this issue to dispute this CVE.\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003e\u003cstrong\u003eUpdate:\u003c/strong\u003e \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.cve.mitre.org%2Fcgi-bin%2Fcvename.cgi%3Fname%3D2017-6959\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eThe CVE has been rejected.\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}