{"id":186352,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODYzNTI=","url":"https://hackerone.com/reports/186352","title":"Fetching binaries (for software installation) over HTTP without verification (RCE as ROOT by MITM)","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-11-29T12:22:47.340Z","submitted_at":"2016-11-29T12:22:47.340Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"e3amn2l","url":"/e3amn2l","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":18,"url":"https://hackerone.com/phabricator","handle":"phabricator","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Phabricator","twitter_handle":"phabricator","website":"http://phacility.com/phabricator/","about":"Phabricator is a collection of open source web applications that help software companies build better software."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-29T20:19:52.031Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2016-11-29T20:19:32.831Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"From: https://secure.phabricator.com/book/phabricator/article/installation_guide/\n\u003e Installing Required Components\nIf you are installing on Ubuntu or an RedHat derivative, there are install scripts available which should handle most of the things discussed in this document for you:\nRedHat Derivatives: install_rhel-derivs.sh\nUbuntu: install_ubuntu.sh\n\nThe install_rhel-derivs.sh file download binaries over plain HTTP and run/install them using sudo without verification (checksum / GPG), thus:\n\n* active MITM attacker can modify the binaries with malicious code.\n* malformed target server infrastructure can deliver malicious code (server hacked/DNS hijacked/etc..)\n\nThe malicious code will run under ROOT.\n\nfor example in 1, a downloaded file over HTTP will be run as php using sudo (the script won't run without root/sudo rights)\nhttps://github.com/phacility/phabricator/blob/master/scripts/install/install_rhel-derivs.sh#L49-L58\n\u003eecho \"ERROR: You must be able to sudo to run this script, or run it as root.\";\n\n1\\. https://github.com/phacility/phabricator/blob/master/scripts/install/install_rhel-derivs.sh#L95\n```\n  echo \"Attempting to install PEAR\"\n  wget http://pear.php.net/go-pear.phar\n  $SUDO php go-pear.phar \u0026\u0026 $SUDO pecl install apc\n```\n\n2\\. https://github.com/phacility/phabricator/blob/master/scripts/install/install_rhel-derivs.sh#L68-L70\n```\n    echo \"It doesn't look like you have the EPEL repo enabled. We are to add it\"\n    echo \"for you, so that we can install git.\"\n    $SUDO rpm -Uvh http://download.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm\n```\n\nfix:\n\n1\\. use https:// instead of http:// (the used URLs support HTTPS)\n2\\. implement verification (sha256 on static files, such as if specific version is used) \u0026 GPG on dynamic files (verify signatures of signed files, such as downloading latest version of software).\n\nmisc: safe word \"mongoose\" or mongoose to indicate that I read the rules.","vulnerability_information_html":"\u003cp\u003eFrom: \u003ca title=\"https://secure.phabricator.com/book/phabricator/article/installation_guide/\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2Fbook%2Fphabricator%2Farticle%2Finstallation_guide%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/book/phabricator/article/installation_guide/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eInstalling Required Components\u003cbr\u003e\nIf you are installing on Ubuntu or an RedHat derivative, there are install scripts available which should handle most of the things discussed in this document for you:\u003cbr\u003e\nRedHat Derivatives: install_rhel-derivs.sh\u003cbr\u003e\nUbuntu: install_ubuntu.sh\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe install_rhel-derivs.sh file download binaries over plain HTTP and run/install them using sudo without verification (checksum / GPG), thus:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eactive MITM attacker can modify the binaries with malicious code.\u003c/li\u003e\n\u003cli\u003emalformed target server infrastructure can deliver malicious code (server hacked/DNS hijacked/etc..)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe malicious code will run under ROOT.\u003c/p\u003e\n\n\u003cp\u003efor example in 1, a downloaded file over HTTP will be run as php using sudo (the script won\u0026#39;t run without root/sudo rights)\u003cbr\u003e\n\u003ca title=\"https://github.com/phacility/phabricator/blob/master/scripts/install/install_rhel-derivs.sh#L49-L58\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fphacility%2Fphabricator%2Fblob%2Fmaster%2Fscripts%2Finstall%2Finstall_rhel-derivs.sh%23L49-L58\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/phacility/phabricator/blob/master/scripts/install/install_rhel-derivs.sh#L49-L58\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eecho \u0026quot;ERROR: You must be able to sudo to run this script, or run it as root.\u0026quot;;\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e1. \u003ca title=\"https://github.com/phacility/phabricator/blob/master/scripts/install/install_rhel-derivs.sh#L95\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fphacility%2Fphabricator%2Fblob%2Fmaster%2Fscripts%2Finstall%2Finstall_rhel-derivs.sh%23L95\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/phacility/phabricator/blob/master/scripts/install/install_rhel-derivs.sh#L95\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e  echo \u0026quot;Attempting to install PEAR\u0026quot;\n  wget http://pear.php.net/go-pear.phar\n  $SUDO php go-pear.phar \u0026amp;\u0026amp; $SUDO pecl install apc\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e2. \u003ca title=\"https://github.com/phacility/phabricator/blob/master/scripts/install/install_rhel-derivs.sh#L68-L70\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fphacility%2Fphabricator%2Fblob%2Fmaster%2Fscripts%2Finstall%2Finstall_rhel-derivs.sh%23L68-L70\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/phacility/phabricator/blob/master/scripts/install/install_rhel-derivs.sh#L68-L70\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e    echo \u0026quot;It doesn\u0026#39;t look like you have the EPEL repo enabled. We are to add it\u0026quot;\n    echo \u0026quot;for you, so that we can install git.\u0026quot;\n    $SUDO rpm -Uvh http://download.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003efix:\u003c/p\u003e\n\n\u003cp\u003e1. use https:// instead of http:// (the used URLs support HTTPS)\u003cbr\u003e\n2. implement verification (sha256 on static files, such as if specific version is used) \u0026amp; GPG on dynamic files (verify signatures of signed files, such as downloading latest version of software).\u003c/p\u003e\n\n\u003cp\u003emisc: safe word \u0026quot;mongoose\u0026quot; or mongoose to indicate that I read the rules.\u003c/p\u003e\n","bounty_amount":"300.0","formatted_bounty":"$300","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-12-29T20:19:32.869Z","allow_singular_disclosure_after":-126174490.21534447,"singular_disclosure_allowed":true,"vote_count":7,"voters":["secator","pekafat","mpz","khalidamin","japz","spetr0x","lordganesha"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1325924,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, we'll fix this. (I don't think we can reasonably pin the versions of these to use checksumming without creating giant headaches for everyone forever, but using `HTTPS` instead of `HTTP` is straightforward.)","markdown_message":"\u003cp\u003eThanks, we\u0026#39;ll fix this. (I don\u0026#39;t think we can reasonably pin the versions of these to use checksumming without creating giant headaches for everyone forever, but using \u003ccode\u003eHTTPS\u003c/code\u003e instead of \u003ccode\u003eHTTP\u003c/code\u003e is straightforward.)\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-29T12:36:21.493Z","updated_at":"2016-11-29T12:36:21.493Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1325947,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The http://download.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm looks like static file (as it use specific version 5-4) thus you can use sha256 checksum for it (when you will update the URL, the checksum will be updated also)\nregarding http://pear.php.net/go-pear.phar it's probably not signed (didn't found .asc file) you can ask them to sign the above file and verify it using the public key (will work until they change the public key used, then you will change the public key in the code).\nDo the above if possible after changing the URLs to HTTPS.","markdown_message":"\u003cp\u003eThe \u003ca title=\"http://download.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm\" href=\"/redirect?url=http%3A%2F%2Fdownload.fedoraproject.org%2Fpub%2Fepel%2F5%2Fi386%2Fepel-release-5-4.noarch.rpm\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://download.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e looks like static file (as it use specific version 5-4) thus you can use sha256 checksum for it (when you will update the URL, the checksum will be updated also)\u003cbr\u003e\nregarding \u003ca title=\"http://pear.php.net/go-pear.phar\" href=\"/redirect?url=http%3A%2F%2Fpear.php.net%2Fgo-pear.phar\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://pear.php.net/go-pear.phar\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e it\u0026#39;s probably not signed (didn\u0026#39;t found .asc file) you can ask them to sign the above file and verify it using the public key (will work until they change the public key used, then you will change the public key in the code).\u003cbr\u003e\nDo the above if possible after changing the URLs to HTTPS.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-29T12:44:09.132Z","updated_at":"2016-11-29T12:47:40.543Z","actor":{"username":"e3amn2l","cleared":false,"url":"/e3amn2l","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1327495,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This is now resolved in the upstream:\n\nhttps://secure.phabricator.com/rP2d7abfd9fa9a95e78f97bb5b8b1e6d3899ef3f3e\n\nThanks for the report! Let us know if you run into anything else.","markdown_message":"\u003cp\u003eThis is now resolved in the upstream:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://secure.phabricator.com/rP2d7abfd9fa9a95e78f97bb5b8b1e6d3899ef3f3e\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2FrP2d7abfd9fa9a95e78f97bb5b8b1e6d3899ef3f3e\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/rP2d7abfd9fa9a95e78f97bb5b8b1e6d3899ef3f3e\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThanks for the report! Let us know if you run into anything else.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-29T20:16:14.077Z","updated_at":"2016-11-29T20:16:14.077Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"e3amn2l","url":"/e3amn2l"},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1327513,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"In assessing an award for this report, I am primarily considering that this attack is realistically difficult to mount and requires other security compromises: you must MITM the network or compromise DNS, specifically target the attack, and have a narrow attack window during an initial Phabricator install.","markdown_message":"\u003cp\u003eIn assessing an award for this report, I am primarily considering that this attack is realistically difficult to mount and requires other security compromises: you must MITM the network or compromise DNS, specifically target the attack, and have a narrow attack window during an initial Phabricator install.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-29T20:18:58.510Z","updated_at":"2016-11-29T20:18:58.510Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Phabricator"}},"bounty_amount":"300.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"phabricator","collaborator":{"username":"e3amn2l","url":"/e3amn2l"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1327518,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"This change and the rationale for it are already publicly available because Phabricator is open source, so this issue can be disclosed at any time.","markdown_message":"\u003cp\u003eThis change and the rationale for it are already publicly available because Phabricator is open source, so this issue can be disclosed at any time.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-29T20:19:32.845Z","updated_at":"2016-11-29T20:19:32.845Z","first_to_agree":true,"actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1391142,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-29T20:19:52.056Z","updated_at":"2016-12-29T20:19:52.056Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Phabricator"}},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}