{"id":152692,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTI2OTI=","url":"https://hackerone.com/reports/152692","title":"Persistent Cross-Site Scripting in WooCommerce WordPress plugin","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-07-20T21:40:12.449Z","submitted_at":"2016-07-20T21:40:12.449Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"beurtschipper","url":"/beurtschipper","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/625/dd7df1c933e04d0149bf0b5760a04212cf881c70_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":111,"url":"https://hackerone.com/automattic","handle":"automattic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/111/7f89e1ea233f92916202521a069fdbfe9eced339_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/111/7f89e1ea233f92916202521a069fdbfe9eced339_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Automattic","twitter_handle":"","website":"https://automattic.com","about":"WordPress.com, VaultPress, Akismet, Gravatar, WooCommerce, Polldaddy, Tumblr and more!"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-11-16T19:22:31.176Z","bug_reporter_agreed_on_going_public_at":"2017-10-17T19:22:15.704Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\n\nI've discovered a persistent Cross-Site Scripting vulnerability in the WooCommerce. Yesterday I created a support ticket on the website, but today someone told me about the bug bounty program, so here we go. \n\nThe vulnerability was discovered during a month long security project to find vulnerabilities in WordPress plugins. For more information about the project see:\nhttps://sumofpwn.nl\nMy advisory can be found in the attachment in text format. If there are any questions please let me know, I'm happy to help.\n\nWith kind regards,\n\nSipke","vulnerability_information_html":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve discovered a persistent Cross-Site Scripting vulnerability in the WooCommerce. Yesterday I created a support ticket on the website, but today someone told me about the bug bounty program, so here we go. \u003c/p\u003e\n\n\u003cp\u003eThe vulnerability was discovered during a month long security project to find vulnerabilities in WordPress plugins. For more information about the project see:\u003cbr\u003e\n\u003ca title=\"https://sumofpwn.nl\" href=\"/redirect?url=https%3A%2F%2Fsumofpwn.nl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://sumofpwn.nl\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nMy advisory can be found in the attachment in text format. If there are any questions please let me know, I\u0026#39;m happy to help.\u003c/p\u003e\n\n\u003cp\u003eWith kind regards,\u003c/p\u003e\n\n\u003cp\u003eSipke\u003c/p\u003e\n","bounty_amount":"75.0","formatted_bounty":"$75","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":106245,"file_name":"Persistent_Cross-Site_Scripting_in_WooCommerce.txt","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/106/245/79cd8f9236bc9da02ad2515c7816f5f58a161421/Persistent_Cross-Site_Scripting_in_WooCommerce.txt?response-content-disposition=attachment%3B%20filename%3D%22Persistent_Cross-Site_Scripting_in_WooCommerce.txt%22%3B%20filename%2A%3DUTF-8%27%27Persistent_Cross-Site_Scripting_in_WooCommerce.txt\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYENXQUKC%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T043359Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHXwr%2Bz%2B7j54GXjIZDeFjE7V4KhtcLVpveDKyRp%2FgHMpAiEA%2FzBLaI4tlPUnNvgzY0X8n68OkDDLSfCBmjTZSd2A%2BM8qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDOLyu53NKIhzdiDnLyqRA1YiznmwUquOZL6cfEwHlrCEbfV1uip5mxrCKpzmpc9DKyYejzEqNMg8%2Fo1XQZiQbQ9Mn8QGMjtqUBvpzsRmfLsdw4KO6Yix26%2Foq9H6jcEfUIX3EyFaY0ofGk42HT5lnakJ%2FUAtv5lyqirA3laDcoq6u60WpxBZh0jLi92Ajs9kGkzDbgWJPXMK2%2FlVglZWa%2BjQNhDftrEqJh4ZV%2FIwfbcJ6s89eju9B4Xkun1IUiVjrUtA5LTMlkDAEwqtGdl3pucepUSB2hZBvbqUfgiT65T%2BpLDNg0LFqEXPPPqqyrYG3%2BqTXIZxR1FfbdXOQjx1UoPwboCHOwSOpOKGaPs6TEM2o6Sg2U%2BGvuy3dMdtNBCfH4SIfBdeUa84eWUftCR4OwBiC0F1Cl6iPIZXa92zkJSAVTz9swPvr%2BghYLYGIjX%2F8jqVGlADsLB1sl%2BqlNRFkwYrvTDOWwnYmDuvQmmhpAQ6Mg%2Fp05v07WKHRsbG%2BAUzVJ3M02i0HIdWCGKjqKXgGZi%2FLBrHUEV9bzaVWmpeFEE3MObUqv8FOusBMEus3670kEKa62xVKQkID%2Fav5Xylzf384wPv9i4fBKmwghqKR67wSDPkErUtnTlN6wJNos0uBd5jibop6zjPh%2BDMaeI%2Bt4z0CbNpMS83WKn2xS%2FvSK0QFyg217PkDWCKklNPmbumtDteHdU2qRRX%2BQwVoTBmoRFgs97OyKXEz2rc7ZIcHuDnAibsNVPNZEuX9m%2B04KKBBkwdIr0sY3zEiVHvTVxPYBSsKfBPuZwzi6W3T3aq%2BF9l860FnFBaV964%2BlbASqZkuTd4cEZ8C2GJad6RyY164GfHgpKnmQ6aYbLhiDTz0xF3adlmhg%3D%3D\u0026X-Amz-Signature=01a61e9cd43aea2d63f398581ea82a65a1d2b2f3c360289e03144433efe99a8b","file_size":5362,"type":"text/plain"}],"allow_singular_disclosure_at":"2017-11-16T19:22:15.757Z","allow_singular_disclosure_after":-98356303.65660329,"singular_disclosure_allowed":true,"vote_count":5,"voters":["eveeez","khizer47","muhaddix","nigba","dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1080467,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi there,\n\nThanks for the report. Upon inspection it seems that this function was intended to allow image upload when the URL does not contain the file name which is common with some feeds, e.g. image.php?image=10\n\nTo work around this, we can validate a whitelist of allowed image types both before and after filename generation from the file's headers. You can see my commit to do this here:\n\nhttps://github.com/woothemes/woocommerce/commit/4f5896d90836e9e1b0f5b2fdad50810fab270da3\n\nCan you confirm this satisfies your report?\n\nThis would only be exploitable by someone with API access so doesn't seem high risk. To upload HTML files you'd also need to be considered an admin user for unfiltered uploads, so 3rd parties using API keys wouldn't be able to upload HTML via the API.\n\nRegardless, this will go out with our next fix release (2.6.4) which should be released within the next 2-3 weeks when ready.\n\nThanks\n\n","markdown_message":"\u003cp\u003eHi there,\u003c/p\u003e\n\n\u003cp\u003eThanks for the report. Upon inspection it seems that this function was intended to allow image upload when the URL does not contain the file name which is common with some feeds, e.g. image.php?image=10\u003c/p\u003e\n\n\u003cp\u003eTo work around this, we can validate a whitelist of allowed image types both before and after filename generation from the file\u0026#39;s headers. You can see my commit to do this here:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://github.com/woothemes/woocommerce/commit/4f5896d90836e9e1b0f5b2fdad50810fab270da3\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fwoothemes%2Fwoocommerce%2Fcommit%2F4f5896d90836e9e1b0f5b2fdad50810fab270da3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/woothemes/woocommerce/commit/4f5896d90836e9e1b0f5b2fdad50810fab270da3\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCan you confirm this satisfies your report?\u003c/p\u003e\n\n\u003cp\u003eThis would only be exploitable by someone with API access so doesn\u0026#39;t seem high risk. To upload HTML files you\u0026#39;d also need to be considered an admin user for unfiltered uploads, so 3rd parties using API keys wouldn\u0026#39;t be able to upload HTML via the API.\u003c/p\u003e\n\n\u003cp\u003eRegardless, this will go out with our next fix release (2.6.4) which should be released within the next 2-3 weeks when ready.\u003c/p\u003e\n\n\u003cp\u003eThanks\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-21T15:47:04.818Z","updated_at":"2016-07-21T15:47:04.818Z","actor":{"username":"mikejolley","cleared":false,"url":"/mikejolley","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1080685,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello Mike,\n\nThe code commit looks well and I think this will solve the problem. Thank you for solving it. :)\n\nI agree that this isn't a high risk issue, because the change of it getting exploited is low. I consider it low to medium, because of the amount of WooCommerce installations/plugins and the impact on individual installations. \n\nWhat is not clear to me is why 3rd parties can't make a WordPress installation vulnerable to this attack. Isn't it possible for an admin to give an API key with unfiltered upload rights to a third party or a plugin?\n\nWith kind regards,\n\nSipke","markdown_message":"\u003cp\u003eHello Mike,\u003c/p\u003e\n\n\u003cp\u003eThe code commit looks well and I think this will solve the problem. Thank you for solving it. :)\u003c/p\u003e\n\n\u003cp\u003eI agree that this isn\u0026#39;t a high risk issue, because the change of it getting exploited is low. I consider it low to medium, because of the amount of WooCommerce installations/plugins and the impact on individual installations. \u003c/p\u003e\n\n\u003cp\u003eWhat is not clear to me is why 3rd parties can\u0026#39;t make a WordPress installation vulnerable to this attack. Isn\u0026#39;t it possible for an admin to give an API key with unfiltered upload rights to a third party or a plugin?\u003c/p\u003e\n\n\u003cp\u003eWith kind regards,\u003c/p\u003e\n\n\u003cp\u003eSipke\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-21T17:26:48.448Z","updated_at":"2016-07-21T17:26:48.448Z","actor":{"username":"beurtschipper","cleared":false,"url":"/beurtschipper","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/625/dd7df1c933e04d0149bf0b5760a04212cf881c70_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1082245,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I don't think so - the 3rd party won't be 'logged in', they will just have API access with their valid credentials.","markdown_message":"\u003cp\u003eI don\u0026#39;t think so - the 3rd party won\u0026#39;t be \u0026#39;logged in\u0026#39;, they will just have API access with their valid credentials.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-22T13:47:02.283Z","updated_at":"2016-07-22T13:47:02.283Z","actor":{"username":"mikejolley","cleared":false,"url":"/mikejolley","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1082323,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"For this POC I created an API key with Read/Write permissions. If the owner of the API key has the right permissions then the API key will have so as well.","markdown_message":"\u003cp\u003eFor this POC I created an API key with Read/Write permissions. If the owner of the API key has the right permissions then the API key will have so as well.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-22T14:21:58.641Z","updated_at":"2016-07-22T14:21:58.641Z","actor":{"username":"beurtschipper","cleared":false,"url":"/beurtschipper","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/625/dd7df1c933e04d0149bf0b5760a04212cf881c70_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1084431,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As an addition: the right needed to upload html files is not *unfiltered_upload* but *unfiltered_html*, which is enabled for super admins, admins and editors.","markdown_message":"\u003cp\u003eAs an addition: the right needed to upload html files is not \u003cem\u003eunfiltered_upload\u003c/em\u003e but \u003cem\u003eunfiltered_html\u003c/em\u003e, which is enabled for super admins, admins and editors.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-24T13:13:22.284Z","updated_at":"2016-07-24T13:13:22.284Z","actor":{"username":"beurtschipper","cleared":false,"url":"/beurtschipper","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/625/dd7df1c933e04d0149bf0b5760a04212cf881c70_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1094932,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello,\n\nCan I get an update of the status of this?\n\nWith kind regards,\n\nSipke","markdown_message":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eCan I get an update of the status of this?\u003c/p\u003e\n\n\u003cp\u003eWith kind regards,\u003c/p\u003e\n\n\u003cp\u003eSipke\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-29T11:09:09.350Z","updated_at":"2016-07-29T11:09:09.350Z","actor":{"username":"beurtschipper","cleared":false,"url":"/beurtschipper","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/625/dd7df1c933e04d0149bf0b5760a04212cf881c70_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1101771,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi. Thanks again for the report. This issue was fixed in the 2.6.4 release -- https://wordpress.org/plugins/woocommerce/changelog/.","markdown_message":"\u003cp\u003eHi. Thanks again for the report. This issue was fixed in the 2.6.4 release -- \u003ca title=\"https://wordpress.org/plugins/woocommerce/changelog/\" href=\"/redirect?url=https%3A%2F%2Fwordpress.org%2Fplugins%2Fwoocommerce%2Fchangelog%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://wordpress.org/plugins/woocommerce/changelog/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-02T09:13:08.722Z","updated_at":"2016-08-02T09:13:08.722Z","actor":{"username":"xknown","cleared":false,"url":"/xknown","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"beurtschipper","url":"/beurtschipper"},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1101774,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-02T09:13:16.763Z","updated_at":"2016-08-02T09:13:16.763Z","actor":{"url":"/automattic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/111/7f89e1ea233f92916202521a069fdbfe9eced339_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Automattic"}},"bounty_amount":"75.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"automattic","collaborator":{"username":"beurtschipper","url":"/beurtschipper"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2073569,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-17T19:22:15.725Z","updated_at":"2017-10-17T19:22:15.725Z","first_to_agree":true,"actor":{"username":"beurtschipper","cleared":false,"url":"/beurtschipper","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/625/dd7df1c933e04d0149bf0b5760a04212cf881c70_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2163355,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-16T19:22:31.195Z","updated_at":"2017-11-16T19:22:31.195Z","actor":{"url":"/automattic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/111/7f89e1ea233f92916202521a069fdbfe9eced339_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Automattic"}},"genius_execution_id":null,"team_handle":"automattic","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}