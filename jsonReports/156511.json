{"id":156511,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTY1MTE=","url":"https://hackerone.com/reports/156511","title":"Incorrect logic in MySQL \u0026 MariaDB protocol leads to remote SSRF/Remote file read","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-08-04T14:18:37.287Z","submitted_at":"2016-08-04T14:18:37.287Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"squashbroom","url":"/squashbroom","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":20,"url":"https://hackerone.com/internet","handle":"internet","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"The Internet","twitter_handle":null,"website":"","about":"Hack all the things."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-11-12T23:49:32.705Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2019-10-13T23:49:31.946Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Overview\nWrong logic in realization of LOAD DATA LOCAL INFILE function leads to remote attacker can read files from server. Problem exists in many MySQL-drivers and frameworks, on many programming languages, like Python, Java, PHP etc.\n\nFor exploitation this vulnerability we need to connect to our special MySQL server (A) from \"attacking\" remote server (B).\nFor example:\n- I found phpMyAdmin interface with connect to any server ability (AllowArbitraryServer option in config) on server B.\n- Next I'm run special-MySQL server on my A host.\n- Then connect through phpMyAdmin to host A\n- After successful connection I can see content of /etc/passwd file from host B in log file on host A\n\n## Details\nFor testing purposes take latest MySQL server, client and tcpdump\n- Start server on local machine\n- Run tcpdump\n- Connect to local MySQL through native mysql-console client\n- Run LOAD DATA LOCAL INFILE '/etc/passwd' INTO TABLE pwn FIELDS TERMINATED BY '\\n'\n- Bye\n\nLook inside packet dump file for LOCAL DATA INFILE query works:\n- Client connect initialize.\n- Server answers with greeting packet (protocol thread id, version, type of mysql authentication etc.)\n- Next authentication packet (username, password, dbs)\n- Next packet from client with query LOAD DATA LOCAL INFILE...\n- Now here is strange packet from server. Call it `FB`-packet: `0c 00 00 01 fb 2f 65 74 63 2f 70 61 73 73 77 64`\n\n`0c` - size\n`000001` - packet No\n`fb` - packet type\n`2f6574632f706173737764` - filename (/etc/passwd)\n\nThere is problem looks like: server says to client what file he needs to read.\nWe need to create special MySQL server which do authorization with any data and then send FB packet with remote filename as payload. That's it.\n\nIn attach image successfully exploitation another MySQL administration interface - Adminer\n\nExploit: https://github.com/allyshka/Rogue-MySql-Server/blob/master/rogue_mysql_server.py\nSee also: http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/\n","vulnerability_information_html":"\u003ch2 id=\"overview\"\u003eOverview\u003c/h2\u003e\n\n\u003cp\u003eWrong logic in realization of LOAD DATA LOCAL INFILE function leads to remote attacker can read files from server. Problem exists in many MySQL-drivers and frameworks, on many programming languages, like Python, Java, PHP etc.\u003c/p\u003e\n\n\u003cp\u003eFor exploitation this vulnerability we need to connect to our special MySQL server (A) from \u0026quot;attacking\u0026quot; remote server (B).\u003cbr\u003e\nFor example:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eI found phpMyAdmin interface with connect to any server ability (AllowArbitraryServer option in config) on server B.\u003c/li\u003e\n\u003cli\u003eNext I\u0026#39;m run special-MySQL server on my A host.\u003c/li\u003e\n\u003cli\u003eThen connect through phpMyAdmin to host A\u003c/li\u003e\n\u003cli\u003eAfter successful connection I can see content of /etc/passwd file from host B in log file on host A\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"details\"\u003eDetails\u003c/h2\u003e\n\n\u003cp\u003eFor testing purposes take latest MySQL server, client and tcpdump\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eStart server on local machine\u003c/li\u003e\n\u003cli\u003eRun tcpdump\u003c/li\u003e\n\u003cli\u003eConnect to local MySQL through native mysql-console client\u003c/li\u003e\n\u003cli\u003eRun LOAD DATA LOCAL INFILE \u0026#39;/etc/passwd\u0026#39; INTO TABLE pwn FIELDS TERMINATED BY \u0026#39;\\n\u0026#39;\u003c/li\u003e\n\u003cli\u003eBye\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eLook inside packet dump file for LOCAL DATA INFILE query works:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eClient connect initialize.\u003c/li\u003e\n\u003cli\u003eServer answers with greeting packet (protocol thread id, version, type of mysql authentication etc.)\u003c/li\u003e\n\u003cli\u003eNext authentication packet (username, password, dbs)\u003c/li\u003e\n\u003cli\u003eNext packet from client with query LOAD DATA LOCAL INFILE...\u003c/li\u003e\n\u003cli\u003eNow here is strange packet from server. Call it \u003ccode\u003eFB\u003c/code\u003e-packet: \u003ccode\u003e0c 00 00 01 fb 2f 65 74 63 2f 70 61 73 73 77 64\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ccode\u003e0c\u003c/code\u003e - size\u003cbr\u003e\n\u003ccode\u003e000001\u003c/code\u003e - packet No\u003cbr\u003e\n\u003ccode\u003efb\u003c/code\u003e - packet type\u003cbr\u003e\n\u003ccode\u003e2f6574632f706173737764\u003c/code\u003e - filename (/etc/passwd)\u003c/p\u003e\n\n\u003cp\u003eThere is problem looks like: server says to client what file he needs to read.\u003cbr\u003e\nWe need to create special MySQL server which do authorization with any data and then send FB packet with remote filename as payload. That\u0026#39;s it.\u003c/p\u003e\n\n\u003cp\u003eIn attach image successfully exploitation another MySQL administration interface - Adminer\u003c/p\u003e\n\n\u003cp\u003eExploit: \u003ca title=\"https://github.com/allyshka/Rogue-MySql-Server/blob/master/rogue_mysql_server.py\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fallyshka%2FRogue-MySql-Server%2Fblob%2Fmaster%2Frogue_mysql_server.py\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/allyshka/Rogue-MySql-Server/blob/master/rogue_mysql_server.py\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nSee also: \u003ca title=\"http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/\" href=\"/redirect?url=http%3A%2F%2Frussiansecurity.expert%2F2016%2F04%2F20%2Fmysql-connect-file-read%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://russiansecurity.expert/2016/04/20/mysql-connect-file-read/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":109632,"file_name":"adminerread.jpg","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/109/632/59706950a0eaa959a1073fb3eb511b88964f978d/adminerread.jpg?response-content-disposition=attachment%3B%20filename%3D%22adminerread.jpg%22%3B%20filename%2A%3DUTF-8%27%27adminerread.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZT5T356C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T043519Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBcsqzm4YMyykC8pKAfuq22D6bSOUdyHaa8fIa4mUQhAAiEAiwPORMjouAw3a3uzUTZC%2BINQcpZp97MOQsVELFW4zLYqtAMIUBABGgwwMTM2MTkyNzQ4NDkiDKDiVMmiMU9V%2FMrmWyqRA4sIGIrOpHyvVZfmW2jMtAM8T%2B3ge7R5BW4DZ%2F780qW3KhtUb%2BlN4eJRg5WRaAT1yVb84a%2FkYNxsJD%2FuSvAe1wqOnVhU6s2QkIgwao%2BmXWZI5Gv75IeDf5AKwwqIEXhO%2BTfJ7qch1s5pk6yRn5dlzyaRdvpwfit2B%2BnXtVL4Ks0Z%2BsF2L1Sb9lQIKC%2FyiIIKOMM1XnEe09NuSw7Xf8Y6UOJpBJj7jLlVUmTMlaXhg0X5owu1jllReuJ1Ofketv8kjZlScgELVQhqeic8VvMdQFPk7uIxbwdUxI2D8U0mLOURF82HqwOSOvz3AjdFiUL5rInys31EjL5eLGhJJbviiWW1U6yAdtVgX5Dl9fG5sndUapgZ6tOzi5c%2FKiIqcs6TFB7V%2Ba94pbfE0ADF3Y25zJTundlOhWYZvSXJ2UVXh75JBOJYxsTgwZ5UgbsU6QjjUdK4ipM4ELoinryh%2FjoKyVb8ZjECBbMYtE22GC3vCLw7DmthiFcvoOPlRvKlah04sJNQ7b9KklIYWOG8BUX0xWhiMIC6qf8FOusB8i%2B4NEipXflNQqWCERI653SNHefieJr6qXk8vUjlyfvLnR2tXIQ%2FWyHufZZf0Rg4hKv79dttIkGWWsjFWimwSTHN9mTNskp6X9ZC4gvqOEnXuOZx%2Bxs2%2BUbYrNxuALH8x%2F%2FpM%2Fh0c4yBQF6OpSWOrWsdl5H%2BUIYyT8bSyRmCqToj58jXSS6GdhErBYuWCR9lbvOawRSwbxWyEGwvrNZPVRFC6gFj0nD1QwcZcdcCocD0zhQwtFu6F4LHGlpDLS8voy4%2BpFMo9RuKO1foe47wef9OHTulwBbLQCigHgaQeH2Lh7CupMWFI4rneA%3D%3D\u0026X-Amz-Signature=dc69cbaab2bad9013c25aae1dd482df255bdecf9bb3ec1030a2ff29bf9c0a2d5","file_size":113447,"type":"image/jpeg"}],"allow_singular_disclosure_at":"2019-11-12T23:49:32.026Z","allow_singular_disclosure_after":-35613947.929833755,"singular_disclosure_allowed":true,"vote_count":3,"voters":["mashoud1122","base_64","spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1111893,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Are you the person who originally wrote http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/? Can you clarify what you feel the risk is here from a security perspective (ie: if you connect to a malicious MySQL server it can try to exfiltrate files from your system)? What has the response from Oracle and other maintainers been?","markdown_message":"\u003cp\u003eAre you the person who originally wrote \u003ca title=\"http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/\" href=\"/redirect?url=http%3A%2F%2Frussiansecurity.expert%2F2016%2F04%2F20%2Fmysql-connect-file-read%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://russiansecurity.expert/2016/04/20/mysql-connect-file-read/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e? Can you clarify what you feel the risk is here from a security perspective (ie: if you connect to a malicious MySQL server it can try to exfiltrate files from your system)? What has the response from Oracle and other maintainers been?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-08T06:52:23.220Z","updated_at":"2016-08-08T06:52:23.220Z","actor":{"username":"neal","cleared":false,"url":"/neal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/072/0076b718b83dae590e6fd3d0749144c76d2044cd_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1112140,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"I am not. The person who originally wrote this post is https://hackerone.com/iamsecurity\nThis problem can help attacker read files and surfing local network through mysql server.\nYes, if you connect to malicious MySQL server it can read files from your system.\nThe problem can help to bypass some security configurations like **open_basedir** and **safe_mode** in PHP.\nSome systems and web services support import from remote mysql server and this vulnerability can helps attacker to compromise sensitive information from that systems.\nThere are many web hosting support that functionality.\n\nThis problem was found about 3 years ago and for now Oracle doesn't fix it. I'm duplicate this report information to them and waiting for answer from it's security team.\nPHP add checks for wrong answers to MySQL queries and **MYSQL_ATTR_LOCAL_INFILE** option in PDO driver which prevent successfully exploitation.","markdown_message":"\u003cp\u003eI am not. The person who originally wrote this post is \u003ca title=\"https://hackerone.com/iamsecurity\" href=\"https://hackerone.com/iamsecurity\"\u003ehttps://hackerone.com/iamsecurity\u003c/a\u003e\u003cbr\u003e\nThis problem can help attacker read files and surfing local network through mysql server.\u003cbr\u003e\nYes, if you connect to malicious MySQL server it can read files from your system.\u003cbr\u003e\nThe problem can help to bypass some security configurations like \u003cstrong\u003eopen_basedir\u003c/strong\u003e and \u003cstrong\u003esafe_mode\u003c/strong\u003e in PHP.\u003cbr\u003e\nSome systems and web services support import from remote mysql server and this vulnerability can helps attacker to compromise sensitive information from that systems.\u003cbr\u003e\nThere are many web hosting support that functionality.\u003c/p\u003e\n\n\u003cp\u003eThis problem was found about 3 years ago and for now Oracle doesn\u0026#39;t fix it. I\u0026#39;m duplicate this report information to them and waiting for answer from it\u0026#39;s security team.\u003cbr\u003e\nPHP add checks for wrong answers to MySQL queries and \u003cstrong\u003eMYSQL_ATTR_LOCAL_INFILE\u003c/strong\u003e option in PDO driver which prevent successfully exploitation.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-08T09:10:00.846Z","updated_at":"2016-08-08T09:10:00.846Z","actor":{"username":"squashbroom","cleared":false,"url":"/squashbroom","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1709731,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Thank you for your work on this finding and apologies for our belated response. Unfortunately, it doesn't quite meet the criteria for inclusion in this program given the exploitation constraints and available mitigations.","markdown_message":"\u003cp\u003eThank you for your work on this finding and apologies for our belated response. Unfortunately, it doesn\u0026#39;t quite meet the criteria for inclusion in this program given the exploitation constraints and available mitigations.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-30T14:52:06.393Z","updated_at":"2017-05-30T14:52:06.393Z","actor":{"url":"/internet","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"The Internet"}},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1709732,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-30T14:52:11.593Z","updated_at":"2017-05-30T14:52:11.593Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"squashbroom","url":"/squashbroom"},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6028954,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-13T23:49:31.962Z","updated_at":"2019-10-13T23:49:31.962Z","first_to_agree":true,"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6293067,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-12T23:49:32.718Z","updated_at":"2019-11-12T23:49:32.718Z","actor":{"url":"/internet","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"The Internet"}},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}