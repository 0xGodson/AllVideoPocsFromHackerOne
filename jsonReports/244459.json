{"id":244459,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNDQ0NTk=","url":"https://hackerone.com/reports/244459","title":"Apache HTTP Request Parsing Whitespace Defects","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-06-29T17:41:22.337Z","submitted_at":"2017-06-29T17:41:22.337Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"regilero","url":"/regilero","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":26,"url":"https://hackerone.com/ibb-apache","handle":"ibb-apache","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/026/1019d58a547964cedd75cda5809332316a7e381c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/026/1019d58a547964cedd75cda5809332316a7e381c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Apache httpd (IBB)","twitter_handle":"","website":"http://apache.org/security","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":["CVE-2016-8743"],"singular_disclosure_disabled":false,"disclosed_at":"2017-07-11T14:39:47.164Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-07-11T12:53:00.816Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":86,"name":"HTTP Request Smuggling"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-08-10T12:53:00.869Z","allow_singular_disclosure_after":-106848981.20378964,"singular_disclosure_allowed":true,"vote_count":10,"voters":["bl4de","brodie_codie","eveeez","atestpk","zerotoone","japz","jaimin","arice","p3rs0n_0f_1nt3rn3t","wanderson21jeh"],"severity":{"rating":"medium","score":4.0,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"none","integrity":"low","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1824544,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-11T12:52:49.125Z","updated_at":"2017-07-11T12:52:49.125Z","actor":{"url":"/ibb-apache","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/026/1019d58a547964cedd75cda5809332316a7e381c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Apache httpd (IBB)"}},"bounty_amount":"1500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"ibb-apache","collaborator":{"username":"regilero","url":"/regilero"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1824545,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-11T12:52:56.038Z","updated_at":"2017-07-11T12:52:56.038Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"regilero","url":"/regilero"},"genius_execution_id":null,"team_handle":"ibb-apache","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1824547,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-11T12:53:00.836Z","updated_at":"2017-07-11T12:53:00.836Z","first_to_agree":true,"actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-apache","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1824599,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-11T13:08:45.807Z","updated_at":"2017-07-11T13:08:45.807Z","actor":{"username":"regilero","cleared":false,"url":"/regilero","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-apache","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1824847,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-11T14:05:11.842Z","updated_at":"2017-07-11T14:05:11.842Z","cve_ids":["CVE-2016-8743"],"actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-apache","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1824848,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-11T14:05:25.269Z","updated_at":"2017-07-11T14:05:25.269Z","additional_data":{},"actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-apache","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1824850,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-11T14:05:55.432Z","updated_at":"2017-07-11T14:05:55.432Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-apache","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1824909,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-11T14:36:40.507Z","updated_at":"2017-07-11T14:36:40.507Z","actor":{"username":"regilero","cleared":false,"url":"/regilero","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-apache","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1824915,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2017-07-11T14:39:47.126Z","updated_at":"2017-07-11T14:39:47.126Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-apache","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":4781,"category":"team","content":"Apache HTTP Server, prior to release 2.4.25, accepted a broad pattern of unusual whitespace patterns from the user-agent, including bare CR, FF, VTAB in parsing the request line and request header lines, as well as HTAB in parsing the request line. Any bare CR present in request lines was treated as whitespace and remained in the request field member \"the_request\", while a bare CR in the request header field name would be honored as whitespace, and a bare CR in the request header field value was retained the input headers array. Implied additional whitespace was accepted in the request line and prior to the ':' delimiter of any request header lines.\n\nRFC7230 Section 3.5 calls out some of these whitespace exceptions, and section 3.2.3 eliminated and clarified the role of implied whitespace in the grammer of this specification. Section 3.1.1 requires exactly one single SP between the method and request-target, and between the request-target and HTTP-version, followed immediately by a CRLF sequence. None of these fields permit any (unencoded) CTL character whatsoever. Section 3.2.4 explicitly disallowed any whitespace from the request header field prior to the ':' character, while Section 3.2 disallows all CTL characters in the request header line other than the HTAB character as whitespace.\n\nThese defects represent a security concern when httpd is participating in any chain of proxies or interacting with back-end application servers, either through mod_proxy or using conventional CGI mechanisms. In each case where one agent accepts such CTL characters and does not treat them as whitespace, there is the possiblity in a proxy chain of generating two responses from a server behind the uncautious proxy agent. In a sequence of two requests, this results in request A to the first proxy being interpreted as requests A + A' by the backend server, and if requests A and B were submitted to the first proxy in a keepalive connection, the proxy may interpret response A' as the response to request B, polluting the cache or potentially serving the A' content to a different downstream user-agent.\n\nThese defects are addressed with the release of Apache HTTP Server 2.4.25 and coordinated by a new directive;\n\n- [HttpProtocolOptions Strict](http://httpd.apache.org/docs/2.4/mod/core.html#httpprotocoloptions)\n\nwhich is the default behavior of 2.4.25 and later. By toggling from 'Strict' behavior to 'Unsafe' behavior, some of the restrictions may be relaxed to allow some invalid HTTP/1.1 clients to communicate with the server, but this will reintroduce the possibility of the problems described in this assessment. Note that relaxing the behavior to 'Unsafe' will still not permit raw CTLs other than HTAB (where permitted), but will allow other RFC requirements to not be enforced, such as exactly two SP characters in the request line.\n\nAcknowledgements: We would like to thank David Dennerline at IBM Security's X-Force Researchers as well as Régis Leroy for each reporting this issue.\n\nReported to security team: 10th February 2016\nIssue public: 20th December 2016\nUpdate Released: 20th December 2016\n\nAffects: 2.4.23, 2.4.20, 2.4.18, 2.4.17, 2.4.16, 2.4.12, 2.4.10, 2.4.9, 2.4.7, 2.4.6, 2.4.4, 2.4.3, 2.4.2, 2.4.1, 2.2.31, 2.2.29, 2.2.27, 2.2.26, 2.2.25, 2.2.24, 2.2.23, 2.2.22, 2.2.21, 2.2.20, 2.2.19, 2.2.18, 2.2.17, 2.2.16, 2.2.15, 2.2.14, 2.2.13, 2.2.12, 2.2.11, 2.2.10, 2.2.9, 2.2.8, 2.2.6, 2.2.5, 2.2.4, 2.2.3, 2.2.2, 2.2.0","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eApache HTTP Server, prior to release 2.4.25, accepted a broad pattern of unusual whitespace patterns from the user-agent, including bare CR, FF, VTAB in parsing the request line and request header lines, as well as HTAB in parsing the request line. Any bare CR present in request lines was treated as whitespace and remained in the request field member \u0026quot;the_request\u0026quot;, while a bare CR in the request header field name would be honored as whitespace, and a bare CR in the request header field value was retained the input headers array. Implied additional whitespace was accepted in the request line and prior to the \u0026#39;:\u0026#39; delimiter of any request header lines.\u003c/p\u003e\n\n\u003cp\u003eRFC7230 Section 3.5 calls out some of these whitespace exceptions, and section 3.2.3 eliminated and clarified the role of implied whitespace in the grammer of this specification. Section 3.1.1 requires exactly one single SP between the method and request-target, and between the request-target and HTTP-version, followed immediately by a CRLF sequence. None of these fields permit any (unencoded) CTL character whatsoever. Section 3.2.4 explicitly disallowed any whitespace from the request header field prior to the \u0026#39;:\u0026#39; character, while Section 3.2 disallows all CTL characters in the request header line other than the HTAB character as whitespace.\u003c/p\u003e\n\n\u003cp\u003eThese defects represent a security concern when httpd is participating in any chain of proxies or interacting with back-end application servers, either through mod_proxy or using conventional CGI mechanisms. In each case where one agent accepts such CTL characters and does not treat them as whitespace, there is the possiblity in a proxy chain of generating two responses from a server behind the uncautious proxy agent. In a sequence of two requests, this results in request A to the first proxy being interpreted as requests A + A\u0026#39; by the backend server, and if requests A and B were submitted to the first proxy in a keepalive connection, the proxy may interpret response A\u0026#39; as the response to request B, polluting the cache or potentially serving the A\u0026#39; content to a different downstream user-agent.\u003c/p\u003e\n\n\u003cp\u003eThese defects are addressed with the release of Apache HTTP Server 2.4.25 and coordinated by a new directive;\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/redirect?url=http%3A%2F%2Fhttpd.apache.org%2Fdocs%2F2.4%2Fmod%2Fcore.html%23httpprotocoloptions\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eHttpProtocolOptions Strict\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ewhich is the default behavior of 2.4.25 and later. By toggling from \u0026#39;Strict\u0026#39; behavior to \u0026#39;Unsafe\u0026#39; behavior, some of the restrictions may be relaxed to allow some invalid HTTP/1.1 clients to communicate with the server, but this will reintroduce the possibility of the problems described in this assessment. Note that relaxing the behavior to \u0026#39;Unsafe\u0026#39; will still not permit raw CTLs other than HTAB (where permitted), but will allow other RFC requirements to not be enforced, such as exactly two SP characters in the request line.\u003c/p\u003e\n\n\u003cp\u003eAcknowledgements: We would like to thank David Dennerline at IBM Security\u0026#39;s X-Force Researchers as well as Régis Leroy for each reporting this issue.\u003c/p\u003e\n\n\u003cp\u003eReported to security team: 10th February 2016\u003cbr\u003e\nIssue public: 20th December 2016\u003cbr\u003e\nUpdate Released: 20th December 2016\u003c/p\u003e\n\n\u003cp\u003eAffects: 2.4.23, 2.4.20, 2.4.18, 2.4.17, 2.4.16, 2.4.12, 2.4.10, 2.4.9, 2.4.7, 2.4.6, 2.4.4, 2.4.3, 2.4.2, 2.4.1, 2.2.31, 2.2.29, 2.2.27, 2.2.26, 2.2.25, 2.2.24, 2.2.23, 2.2.22, 2.2.21, 2.2.20, 2.2.19, 2.2.18, 2.2.17, 2.2.16, 2.2.15, 2.2.14, 2.2.13, 2.2.12, 2.2.11, 2.2.10, 2.2.9, 2.2.8, 2.2.6, 2.2.5, 2.2.4, 2.2.3, 2.2.2, 2.2.0\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}