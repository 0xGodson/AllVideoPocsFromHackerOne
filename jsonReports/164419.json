{"id":164419,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjQ0MTk=","url":"https://hackerone.com/reports/164419","title":"Non-secure requests are not automatically upgraded to HTTPS","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2016-08-30T12:48:54.189Z","submitted_at":"2016-08-30T12:48:54.189Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"shankar","url":"/shankar","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/012/917/e43880a28e13cb13c69b9a702b08189577ca6f17_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1601,"url":"https://hackerone.com/legalrobot","handle":"legalrobot","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/601/0f164c3d9618b04b006b859517ff032ec57ab42a_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/601/0f164c3d9618b04b006b859517ff032ec57ab42a_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Legal Robot","twitter_handle":"LegalRobot","website":"https://www.legalrobot.com","about":"Automated legal document review using artificial intelligence"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-12-19T04:14:57.839Z","bug_reporter_agreed_on_going_public_at":"2017-12-19T04:14:57.781Z","team_member_agreed_on_going_public_at":"2017-08-26T23:27:00.486Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Non-secure requests to legalrobot.com/ (e.g. http://www.legalrobot.com/) are not automatically upgraded to HTTPS. This is not something you would notice when you use the latest version of modern web browsers such as Google Chrome or Firefox, because legalrobot.com is HSTS preloaded. When a domain is preloaded, non-secure requests for these domains are internally upgraded to HTTPS. However, there are still browsers that either haven't implemented HSTS preload lists, or don't have legalrobot.com on their HSTS preload lists (yet).\n\nTake for example Safari on iOS, which doesn't have legalrobot.com in its HSTS preload list. When you open http://legalrobot.com in Safari and head over to the 'Sign in' page you will see that the connection is not upgraded to HTTPS. Moreover, if you enter your username and password, and hit 'Sign in', the form is sent in the clear over a non-secure connection.\n\nSince non-secure requests aren't upgraded to HTTPS, the user will never receive instructions (via the Strict-Transport-Security header) to set the HSTS \"cookie\" for 'legalrobot.com. Which means a secure connection is not enforce until the first time the requests a resource over HTTPS, because that response will include theStrict-Transport-Security` header.\n\nSteps to reproduce\n\ncURL\n\nSend a HEAD request to http://legalrobot.com: curl -I http://legalrobot.com.\nYou will see that the server does not instruct the client to upgrade the connection to HTTPS. The server responds with a 200 OK status code instead of 301 status code with the response header Location set to https://legalrobot.com.\n\nFirefox\n\nClear the Site Preferences: Click History --\u003e Clear Recent History..., select Everything, tickSite Preferences, and hit Clear Now. This is to ensure Firefox forgets about an HSTS settings for legalrobot.com.\nTurn off the use of the HSTS preload list. Set network.stricttransportsecurity.preloadlistto false on the about:config page.\nOpen http://legalrobot.com.\nYou will see that the non-secure connection is not upgraded to HTTPS.\n\nGranted, it is kind of hard to exploit this vulnerability, because, first of all, it requires an attacker to be in a privileged network (he/she needs to be able to see what's going over the wire). Then the attacker would need to trick the victim into opening http://legalrobot.com in a browser that doesn't have legalrobot.com HSTS preloaded and which doesn't have any HSTS cookies for legalrobot.com from a previous secure visit to legalrobot.com. When all these conditions are met, an attacker could for example steal the victim's HackerOne credentials, or inject some malicious scripts into any page. This is possible because the connection is never upgraded, and the site allows forms such as the login form to be posted to a non-secure endpoint (see the screenshot attached to this report).\n\nMitigation\n\nNon-secure connections need to be upgraded to HTTPS as soon as possible using a permanent redirect. But since the website allowed me to send my username and password in the clear over a non-secure connection, I was also thinking that you would probably want to prevent forms from being posted to non-secure origins. One possibility is to enforce the client to only send AJAX requests to secure origins using the Content Security Policy connect-src directive.","vulnerability_information_html":"\u003cp\u003eNon-secure requests to legalrobot.com/ (e.g. \u003ca title=\"http://www.legalrobot.com/\" href=\"/redirect?url=http%3A%2F%2Fwww.legalrobot.com%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.legalrobot.com/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) are not automatically upgraded to HTTPS. This is not something you would notice when you use the latest version of modern web browsers such as Google Chrome or Firefox, because legalrobot.com is HSTS preloaded. When a domain is preloaded, non-secure requests for these domains are internally upgraded to HTTPS. However, there are still browsers that either haven\u0026#39;t implemented HSTS preload lists, or don\u0026#39;t have legalrobot.com on their HSTS preload lists (yet).\u003c/p\u003e\n\n\u003cp\u003eTake for example Safari on iOS, which doesn\u0026#39;t have legalrobot.com in its HSTS preload list. When you open \u003ca title=\"http://legalrobot.com\" href=\"/redirect?url=http%3A%2F%2Flegalrobot.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://legalrobot.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e in Safari and head over to the \u0026#39;Sign in\u0026#39; page you will see that the connection is not upgraded to HTTPS. Moreover, if you enter your username and password, and hit \u0026#39;Sign in\u0026#39;, the form is sent in the clear over a non-secure connection.\u003c/p\u003e\n\n\u003cp\u003eSince non-secure requests aren\u0026#39;t upgraded to HTTPS, the user will never receive instructions (via the Strict-Transport-Security header) to set the HSTS \u0026quot;cookie\u0026quot; for \u0026#39;legalrobot.com. Which means a secure connection is not enforce until the first time the requests a resource over HTTPS, because that response will include theStrict-Transport-Security` header.\u003c/p\u003e\n\n\u003cp\u003eSteps to reproduce\u003c/p\u003e\n\n\u003cp\u003ecURL\u003c/p\u003e\n\n\u003cp\u003eSend a HEAD request to \u003ca title=\"http://legalrobot.com\" href=\"/redirect?url=http%3A%2F%2Flegalrobot.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://legalrobot.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e curl -I \u003ca title=\"http://legalrobot.com\" href=\"/redirect?url=http%3A%2F%2Flegalrobot.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://legalrobot.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003cbr\u003e\nYou will see that the server does not instruct the client to upgrade the connection to HTTPS. The server responds with a 200 OK status code instead of 301 status code with the response header Location set to \u003ca title=\"https://legalrobot.com\" href=\"/redirect?url=https%3A%2F%2Flegalrobot.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://legalrobot.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eFirefox\u003c/p\u003e\n\n\u003cp\u003eClear the Site Preferences: Click History --\u0026gt; Clear Recent History..., select Everything, tickSite Preferences, and hit Clear Now. This is to ensure Firefox forgets about an HSTS settings for legalrobot.com.\u003cbr\u003e\nTurn off the use of the HSTS preload list. Set network.stricttransportsecurity.preloadlistto false on the about:config page.\u003cbr\u003e\nOpen \u003ca title=\"http://legalrobot.com\" href=\"/redirect?url=http%3A%2F%2Flegalrobot.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://legalrobot.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003cbr\u003e\nYou will see that the non-secure connection is not upgraded to HTTPS.\u003c/p\u003e\n\n\u003cp\u003eGranted, it is kind of hard to exploit this vulnerability, because, first of all, it requires an attacker to be in a privileged network (he/she needs to be able to see what\u0026#39;s going over the wire). Then the attacker would need to trick the victim into opening \u003ca title=\"http://legalrobot.com\" href=\"/redirect?url=http%3A%2F%2Flegalrobot.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://legalrobot.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e in a browser that doesn\u0026#39;t have legalrobot.com HSTS preloaded and which doesn\u0026#39;t have any HSTS cookies for legalrobot.com from a previous secure visit to legalrobot.com. When all these conditions are met, an attacker could for example steal the victim\u0026#39;s HackerOne credentials, or inject some malicious scripts into any page. This is possible because the connection is never upgraded, and the site allows forms such as the login form to be posted to a non-secure endpoint (see the screenshot attached to this report).\u003c/p\u003e\n\n\u003cp\u003eMitigation\u003c/p\u003e\n\n\u003cp\u003eNon-secure connections need to be upgraded to HTTPS as soon as possible using a permanent redirect. But since the website allowed me to send my username and password in the clear over a non-secure connection, I was also thinking that you would probably want to prevent forms from being posted to non-secure origins. One possibility is to enforce the client to only send AJAX requests to secure origins using the Content Security Policy connect-src directive.\u003c/p\u003e\n","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1163769,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is very close but doesn't seem to be an exact duplicate of #163677 - in that report, the https site yielded a 200 (which was correct) on https, but the reporter intended to test over http-only (which seems to be what you have reported). Since the time #163677 was files, we have added nginx in front of our static S3 website, which makes me think there could be something here because of the configuration change.\n\nHowever, when I try to reproduce with curl, I get the following responses:\n\t\n\t$ curl -I http://legalrobot.com\n\tHTTP/1.1 301 Moved Permanently\n\tDate: Wed, 31 Aug 2016 00:37:24 GMT\n\tConnection: keep-alive\n\tSet-Cookie: __cfduid=d970a75770fb9bedef0b7039908fa885a1472603844; expires=Thu, 31-Aug-17 00:37:24 GMT; path=/; domain=.legalrobot.com; HttpOnly\n\tLocation: https://legalrobot.com/\n\tX-Content-Type-Options: nosniff\n\tServer: cloudflare-nginx\n\tCF-RAY: 2dac69ebb0680663-SJC\n\n\t$ curl -I http://www.legalrobot.com\n\tHTTP/1.1 301 Moved Permanently\n\tDate: Wed, 31 Aug 2016 00:37:33 GMT\n\tConnection: keep-alive\n\tSet-Cookie: __cfduid=db0ce27656a517a8a6657b53d3cb13f201472603853; expires=Thu, 31-Aug-17 00:37:33 GMT; path=/; domain=.legalrobot.com; HttpOnly\n\tLocation: https://www.legalrobot.com/\n\tX-Content-Type-Options: nosniff\n\tServer: cloudflare-nginx\n\tCF-RAY: 2dac6a277ee6283a-SJC\n\nEither way, the impact should be low - there are no sensitive assets on the domain apex, or its mirror on www.legalrobot.com (i.e. there's nothing to log in to).\n\nCan you verify if your requests still show 200's or if you show 301's like my reproduction?","markdown_message":"\u003cp\u003eThis is very close but doesn\u0026#39;t seem to be an exact duplicate of \u003ca href=\"/reports/163677\"\u003e#163677\u003c/a\u003e - in that report, the https site yielded a 200 (which was correct) on https, but the reporter intended to test over http-only (which seems to be what you have reported). Since the time \u003ca href=\"/reports/163677\"\u003e#163677\u003c/a\u003e was files, we have added nginx in front of our static S3 website, which makes me think there could be something here because of the configuration change.\u003c/p\u003e\n\n\u003cp\u003eHowever, when I try to reproduce with curl, I get the following responses:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ curl -I http://legalrobot.com\nHTTP/1.1 301 Moved Permanently\nDate: Wed, 31 Aug 2016 00:37:24 GMT\nConnection: keep-alive\nSet-Cookie: __cfduid=d970a75770fb9bedef0b7039908fa885a1472603844; expires=Thu, 31-Aug-17 00:37:24 GMT; path=/; domain=.legalrobot.com; HttpOnly\nLocation: https://legalrobot.com/\nX-Content-Type-Options: nosniff\nServer: cloudflare-nginx\nCF-RAY: 2dac69ebb0680663-SJC\n\n$ curl -I http://www.legalrobot.com\nHTTP/1.1 301 Moved Permanently\nDate: Wed, 31 Aug 2016 00:37:33 GMT\nConnection: keep-alive\nSet-Cookie: __cfduid=db0ce27656a517a8a6657b53d3cb13f201472603853; expires=Thu, 31-Aug-17 00:37:33 GMT; path=/; domain=.legalrobot.com; HttpOnly\nLocation: https://www.legalrobot.com/\nX-Content-Type-Options: nosniff\nServer: cloudflare-nginx\nCF-RAY: 2dac6a277ee6283a-SJC\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eEither way, the impact should be low - there are no sensitive assets on the domain apex, or its mirror on \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.legalrobot.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.legalrobot.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (i.e. there\u0026#39;s nothing to log in to).\u003c/p\u003e\n\n\u003cp\u003eCan you verify if your requests still show 200\u0026#39;s or if you show 301\u0026#39;s like my reproduction?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-31T00:43:53.117Z","updated_at":"2016-08-31T00:43:53.117Z","actor":{"username":"danrubins","cleared":false,"url":"/danrubins","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/222/c1d0d51f40e0c570e2153b6801fe54c997c757f0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1164044,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"It shows as \n\ncurl -I http://www.legalrobot.com\nHTTP/1.1 301 Moved Permanently\nDate: Wed, 31 Aug 2016 06:32:23 GMT\nConnection: keep-alive\nSet-Cookie: __cfduid=d49a110016265e88d566494e626510e891472625143; expires=Thu, 3\n1-Aug-17 06:32:23 GMT; path=/; domain=.legalrobot.com; HttpOnly\nLocation: https://www.legalrobot.com/\nX-Content-Type-Options: nosniff\nServer: cloudflare-nginx\nCF-RAY: 2dae71ed9e652dd3-BOM\n","markdown_message":"\u003cp\u003eIt shows as \u003c/p\u003e\n\n\u003cp\u003ecurl -I \u003ca title=\"http://www.legalrobot.com\" href=\"/redirect?url=http%3A%2F%2Fwww.legalrobot.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.legalrobot.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nHTTP/1.1 301 Moved Permanently\u003cbr\u003e\nDate: Wed, 31 Aug 2016 06:32:23 GMT\u003cbr\u003e\nConnection: keep-alive\u003cbr\u003e\nSet-Cookie: __cfduid=d49a110016265e88d566494e626510e891472625143; expires=Thu, 3\u003cbr\u003e\n1-Aug-17 06:32:23 GMT; path=/; domain=.legalrobot.com; HttpOnly\u003cbr\u003e\nLocation: \u003ca title=\"https://www.legalrobot.com/\" href=\"/redirect?url=https%3A%2F%2Fwww.legalrobot.com%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.legalrobot.com/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nX-Content-Type-Options: nosniff\u003cbr\u003e\nServer: cloudflare-nginx\u003cbr\u003e\nCF-RAY: 2dae71ed9e652dd3-BOM\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-31T06:34:53.392Z","updated_at":"2016-08-31T06:34:53.392Z","actor":{"username":"shankar","cleared":false,"url":"/shankar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/917/e43880a28e13cb13c69b9a702b08189577ca6f17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1174743,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Closing as informative since our reproduction correctly showed 301 responses.","markdown_message":"\u003cp\u003eClosing as informative since our reproduction correctly showed 301 responses.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-05T17:13:46.750Z","updated_at":"2016-09-05T17:13:46.750Z","actor":{"username":"danrubins","cleared":false,"url":"/danrubins","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/222/c1d0d51f40e0c570e2153b6801fe54c997c757f0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1957576,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-26T23:27:00.502Z","updated_at":"2017-08-26T23:27:00.502Z","first_to_agree":true,"actor":{"username":"danrubins","cleared":false,"url":"/danrubins","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/222/c1d0d51f40e0c570e2153b6801fe54c997c757f0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2233540,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-12-19T04:14:57.804Z","updated_at":"2017-12-19T04:14:57.804Z","actor":{"username":"shankar","cleared":false,"url":"/shankar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/917/e43880a28e13cb13c69b9a702b08189577ca6f17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2233541,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-12-19T04:14:57.861Z","updated_at":"2017-12-19T04:14:57.861Z","actor":{"username":"shankar","cleared":false,"url":"/shankar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/917/e43880a28e13cb13c69b9a702b08189577ca6f17_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}