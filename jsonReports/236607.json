{"id":236607,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMzY2MDc=","url":"https://hackerone.com/reports/236607","title":"Remote Code Execution in the Import Channel function","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-06-05T15:17:34.888Z","submitted_at":"2017-06-05T15:17:34.888Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"strukt","url":"/strukt","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":265,"url":"https://hackerone.com/expressionengine","handle":"expressionengine","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/265/25251ba4ab1d0b0304a6c3d197fba5c833c6003e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/265/25251ba4ab1d0b0304a6c3d197fba5c833c6003e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"ExpressionEngine","twitter_handle":"eecms","website":"https://expressionengine.com/","about":"ExpressionEngine is a robust and flexible open-source Content Management System."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-04-04T16:36:38.276Z","bug_reporter_agreed_on_going_public_at":"2018-04-04T16:12:09.563Z","team_member_agreed_on_going_public_at":"2018-04-04T16:36:38.201Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\n\nAdministrators are allow to import channels by visiting http://HOST/PATH_TO_EE/admin.php?/cp/channels/sets and uploading .zip archives that contain the information about the channels to be imported. The archives are then extracted into temporary directories, which are kept in the `/system/user/cache/cset/` directory. The problem is that, if the archive doesn't have all the required files for the import to be successful, the extracted files remain in their folders and an error is thrown to the administrator stating that a file doesn't exist in the archive.\n\nThis allows an administrator to upload .php scripts to the server, which is not allowed by default in ExpressionEngine as far as I can see.\n\n###Steps to reproduce:\n1- Download the attached .zip archive and browse to http://HOST/PATH_TO_EE/admin.php?/cp/channels/sets\n2- Try to upload the zip file you just downloaded as the imported channel\n3- Navigate to http://HOST/PATH_TO_EE/system/user/cache/cset/, which will show a directory listing of all the temporary directories, this is a problem by itself\n4- If this is your first time trying this, you should find a single directory, click the directory's name and then click the test.php file and edit the URL in the address bar by adding \"?cmd=whoami\" to the URL\n5- Notice that the command has executed and that the information is returned in the page\n\nRegards,","vulnerability_information_html":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eAdministrators are allow to import channels by visiting \u003ca title=\"http://host/PATH_TO_EE/admin.php?/cp/channels/sets\" href=\"/redirect?url=http%3A%2F%2Fhost%2FPATH_TO_EE%2Fadmin.php%3F%2Fcp%2Fchannels%2Fsets\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://host/PATH_TO_EE/admin.php?/cp/channels/sets\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and uploading .zip archives that contain the information about the channels to be imported. The archives are then extracted into temporary directories, which are kept in the \u003ccode\u003e/system/user/cache/cset/\u003c/code\u003e directory. The problem is that, if the archive doesn\u0026#39;t have all the required files for the import to be successful, the extracted files remain in their folders and an error is thrown to the administrator stating that a file doesn\u0026#39;t exist in the archive.\u003c/p\u003e\n\n\u003cp\u003eThis allows an administrator to upload .php scripts to the server, which is not allowed by default in ExpressionEngine as far as I can see.\u003c/p\u003e\n\n\u003ch3 id=\"steps-to-reproduce\"\u003eSteps to reproduce:\u003c/h3\u003e\n\n\u003cp\u003e1- Download the attached .zip archive and browse to \u003ca title=\"http://host/PATH_TO_EE/admin.php?/cp/channels/sets\" href=\"/redirect?url=http%3A%2F%2Fhost%2FPATH_TO_EE%2Fadmin.php%3F%2Fcp%2Fchannels%2Fsets\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://host/PATH_TO_EE/admin.php?/cp/channels/sets\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n2- Try to upload the zip file you just downloaded as the imported channel\u003cbr\u003e\n3- Navigate to \u003ca title=\"http://host/PATH_TO_EE/system/user/cache/cset/\" href=\"/redirect?url=http%3A%2F%2Fhost%2FPATH_TO_EE%2Fsystem%2Fuser%2Fcache%2Fcset%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://host/PATH_TO_EE/system/user/cache/cset/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, which will show a directory listing of all the temporary directories, this is a problem by itself\u003cbr\u003e\n4- If this is your first time trying this, you should find a single directory, click the directory\u0026#39;s name and then click the test.php file and edit the URL in the address bar by adding \u0026quot;?cmd=whoami\u0026quot; to the URL\u003cbr\u003e\n5- Notice that the command has executed and that the information is returned in the page\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003c/p\u003e\n","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":7,"voters":["sp1d3rs","eveeez","apapedulimu","hassham","tortberre","saiinfosec","japz"],"severity":{"rating":"medium","score":5.7,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"high","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1730559,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Excuse me, I forgot to attach the zip archive.","markdown_message":"\u003cp\u003eExcuse me, I forgot to attach the zip archive.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-05T15:19:52.764Z","updated_at":"2017-06-05T15:19:52.764Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":191348,"filename":"test.zip","type":"application/zip","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/191/348/55250ab0d4fb378154cd7e57d8a9f391b49094fe/test.zip?response-content-disposition=attachment%3B%20filename%3D%22test.zip%22%3B%20filename%2A%3DUTF-8%27%27test.zip\u0026response-content-type=application%2Fzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQW2BAZGD3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050656Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDf7CC1janFXxWWF6QZ1Z6X6%2F6j0WDhv4gDyzEWu%2BScUAIhAOhgsmE64VangXFyIz5AGmDMLeT8sYG2vBQ4PwiaYS%2FZKrQDCFUQARoMMDEzNjE5Mjc0ODQ5Igy754oCq3nK3vWmRbMqkQM98qKdRlMDTd4bBwR4jJMppOWz7EU3ySwJK1geVZm7GvrSHyp8wAx03nVbAIisdh9q5SCYJs%2FJTXi%2Fsm9znfJcHgIy1DUYcyZol0zQmN4hQAlOUZZ6AJANKMjzew6Gbci4hpgZqkt7kMNinONmzU36EDiWMOc0y0LBIMMe8ckWdal2vM1amkx9g4%2B7jkxStLKe4Ry%2FVeqOEFeDj5B3%2Fim8atXFDPnaA6ZctYC0kADebiu9zFF1dQsSdkzsLG93dLAMR0ARXm0vun9nbqpp5oxDQafvSrdE7oDp0yem%2B391K5yvQ%2FVkTdyMd797ooD1IAYqUdwlX0lVblqv9ErzI2EUbOnFhO5widZFoU8s5JQDxyTzDlNAHHPnQpU8XD7uIRyR%2Bh43I9VvsEn1pERJ2rOM57I1PkAM8vesvdhiNkLY7KsmmB1q5drdmKxzSDeK5uPJY%2F7b6ZdCcYzDgNfX18d6h0A0FHbvXn7qPH9NQWGUsNXamCikRs9AA%2BK%2BzqwxI%2FlZdCdkUBJNbFqefOmuHA6y4DCuw6r%2FBTrqAZ4iBH5JOWBgJ5BPglFYT1gWFkwyMqq8gmMxb5SeS%2FjunuR9x9HhadmGfzTt7avXh7ra%2BbCbT8G5EBTHekw5tLrBpYwkzmLiedzIpJ4pJqrAXmk%2B6qfKdpUFGOfE%2FoOdzhIkM32hFOTOwwCcLwfUCOQXCXHweJlGlDZdV%2FgvnAv5llJv80AS6mRncqu5cTdZ6kwskL6mtLuZx022Hs9iVQEhZVcVFVxWNFIMlrPZufuNWFtnv13RkAoiqYOJgDn3UWRAP9lucn7OMZs0NyqKFy1iLho2FCO%2BegcGHVqDf%2FVxOtLAlnkhjmFRxg%3D%3D\u0026X-Amz-Signature=a2ea111567c2e1f5e05d27a323d9a8b53ee29f26283da5d186a9ef7dc6addb8d"}],"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1744533,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any news about this and the other new reports ?","markdown_message":"\u003cp\u003eAny news about this and the other new reports ?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-09T14:49:39.716Z","updated_at":"2017-06-09T14:49:39.716Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1744770,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @strukt, sorry for the delay, many of us were out this week and are just getting back today.\n\nThank you for reporting this, yes looks like there were a few oversights! I've just made the following changes:\n\n1. We won't even extract the archive if we see there's a PHP file inside.\n2. The cset directory is now created with an index.html file to prevent indexes.\n3. Files are now properly cleaned up after import success/failure.\n\nI think that should take care of everything. I'll look at your other reports today as well.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/strukt\"\u003e@strukt\u003c/a\u003e, sorry for the delay, many of us were out this week and are just getting back today.\u003c/p\u003e\n\n\u003cp\u003eThank you for reporting this, yes looks like there were a few oversights! I\u0026#39;ve just made the following changes:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eWe won\u0026#39;t even extract the archive if we see there\u0026#39;s a PHP file inside.\u003c/li\u003e\n\u003cli\u003eThe cset directory is now created with an index.html file to prevent indexes.\u003c/li\u003e\n\u003cli\u003eFiles are now properly cleaned up after import success/failure.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eI think that should take care of everything. I\u0026#39;ll look at your other reports today as well.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-09T16:33:47.254Z","updated_at":"2017-06-09T16:33:47.254Z","actor":{"username":"kevincupp","cleared":false,"url":"/kevincupp","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1744836,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@kevincupp Thank you very much, yes these changes seem to fix the issue.","markdown_message":"\u003cp\u003e\u003ca href=\"/kevincupp\"\u003e@kevincupp\u003c/a\u003e Thank you very much, yes these changes seem to fix the issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-09T16:57:23.681Z","updated_at":"2017-06-09T16:57:23.681Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1761516,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Fixed in 3.5.8","markdown_message":"\u003cp\u003eFixed in 3.5.8\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-16T17:26:46.650Z","updated_at":"2017-06-16T17:26:46.650Z","actor":{"username":"kevincupp","cleared":false,"url":"/kevincupp","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"strukt","url":"/strukt"},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2565052,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-04T16:12:09.602Z","updated_at":"2018-04-04T16:12:09.602Z","first_to_agree":true,"actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2565109,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-04T16:35:12.628Z","updated_at":"2018-04-04T16:35:12.628Z","additional_data":{"old_severity":"Critical","new_severity":"Medium (5.7)","old_severity_id":48259,"new_severity_id":135782},"actor":{"username":"djones","cleared":false,"url":"/djones","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2565111,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-04T16:36:38.222Z","updated_at":"2018-04-04T16:36:38.222Z","actor":{"username":"kevincupp","cleared":false,"url":"/kevincupp","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2565112,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-04T16:36:38.296Z","updated_at":"2018-04-04T16:36:38.296Z","actor":{"username":"kevincupp","cleared":false,"url":"/kevincupp","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}