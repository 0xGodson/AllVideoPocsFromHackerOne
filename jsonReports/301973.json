{"id":301973,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDE5NzM=","url":"https://hackerone.com/reports/301973","title":"Airship: Persistent XSS via Comment","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-01-03T13:49:01.314Z","submitted_at":"2018-01-03T13:49:01.314Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"foobar7","url":"/foobar7","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8539,"url":"https://hackerone.com/paragonie","handle":"paragonie","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/539/72f76fed45e5220b47ba2f679371ebf9ccb19c70_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/539/72f76fed45e5220b47ba2f679371ebf9ccb19c70_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Paragon Initiative Enterprises","twitter_handle":"ParagonIE","website":"https://github.com/paragonie","about":"Cryptography and Application Security Consultants - We Produce Various Open Source Libraries"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-04-24T08:47:31.661Z","bug_reporter_agreed_on_going_public_at":"2018-04-24T08:47:31.590Z","team_member_agreed_on_going_public_at":"2018-04-20T18:13:03.871Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Affected: Airship 2.0.0 (commit 15bdc0d)\n\nCVSS\n----\n\nMedium 6.1 https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N\n\nDescription\n-----------\n\nThe \"name\" field of a comment on a blog post is vulnerable to persistent XSS. \n\nWhen replying to a comment, the comment name is inserted into the DOM without encoding, leading to persistent XSS. \n\nBy default, comments are open to anonymous users, although that can be disabled by an administrator.\n\nMitigating Factors\n---------------------------\n\nThere are a couple of mitigating factors. \n\nAirship uses a CSP per default, which makes exploitation more difficult. The CSP can be disabled by an administrator though, and there may be attack possibilities even with the default CSP.\n\nThe attacked user has to actively click on \"reply\" for the payload to execute, meaning an attacker has to entice the user to do so.\n\nFinally, the payload is shown in plaintext in the username field, which might make the attacked user suspicious. An attacker can try to hide it by using an overly long or complicated name. \n\nDetails\n-------\n\nThe vulnerability exists in file `/static/Hull/comments.js?`, specifically these lines where the author name is read out of the DOM and inserted into it again without proper encoding:\n\n\twindow.replyTo = function(commentId, author) {\n\t\t$(\"#reply-to\").html(\n\t\t    \"\u003cdiv class='blog-comment-label form-column'\u003e\u003c/div\u003e\u003cdiv class='form-comment-field form-column'\u003e\" +\n\t\t    \"\u003cinput type='hidden' name='reply_to' value='\" + commentId + \"' /\u003e\" +\n\t\t        \"Replying to \" + author + \" (Comment #\" + commentId + \")\" +\n\t\t    \"\u003c/div\u003e\"\n\t\t);\n\t};\n\nPOC\n---\n\n0. Under bridge/admin/settings, check \"allow unsafe inline\" under javascript.\n1. Leave a comment on a blog post. As name, use:\n\t'\"\u003e\u003cimg src=no onerror=alert(1)\u003e\n2. Click on \"Reply\". The name will be read out via javascript and inserted into the DOM.\n\n## Impact\n\nWith a successful exploitation, an attacker can among other perform arbitrary actions in the name of the attacked user, such as adding a new administrator, and thus gain full access to the application.","vulnerability_information_html":"\u003cp\u003eAffected: Airship 2.0.0 (commit 15bdc0d)\u003c/p\u003e\n\n\u003ch2 id=\"cvss\"\u003eCVSS\u003c/h2\u003e\n\n\u003cp\u003eMedium 6.1 \u003ca title=\"https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N\" href=\"/redirect?url=https%3A%2F%2Fwww.first.org%2Fcvss%2Fcalculator%2F3.0%23CVSS%3A3.0%2FAV%3AN%2FAC%3AL%2FPR%3AN%2FUI%3AR%2FS%3AC%2FC%3AL%2FI%3AL%2FA%3AN\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"description\"\u003eDescription\u003c/h2\u003e\n\n\u003cp\u003eThe \u0026quot;name\u0026quot; field of a comment on a blog post is vulnerable to persistent XSS. \u003c/p\u003e\n\n\u003cp\u003eWhen replying to a comment, the comment name is inserted into the DOM without encoding, leading to persistent XSS. \u003c/p\u003e\n\n\u003cp\u003eBy default, comments are open to anonymous users, although that can be disabled by an administrator.\u003c/p\u003e\n\n\u003ch2 id=\"mitigating-factors\"\u003eMitigating Factors\u003c/h2\u003e\n\n\u003cp\u003eThere are a couple of mitigating factors. \u003c/p\u003e\n\n\u003cp\u003eAirship uses a CSP per default, which makes exploitation more difficult. The CSP can be disabled by an administrator though, and there may be attack possibilities even with the default CSP.\u003c/p\u003e\n\n\u003cp\u003eThe attacked user has to actively click on \u0026quot;reply\u0026quot; for the payload to execute, meaning an attacker has to entice the user to do so.\u003c/p\u003e\n\n\u003cp\u003eFinally, the payload is shown in plaintext in the username field, which might make the attacked user suspicious. An attacker can try to hide it by using an overly long or complicated name. \u003c/p\u003e\n\n\u003ch2 id=\"details\"\u003eDetails\u003c/h2\u003e\n\n\u003cp\u003eThe vulnerability exists in file \u003ccode\u003e/static/Hull/comments.js?\u003c/code\u003e, specifically these lines where the author name is read out of the DOM and inserted into it again without proper encoding:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ewindow.replyTo = function(commentId, author) {\n    $(\u0026quot;#reply-to\u0026quot;).html(\n        \u0026quot;\u0026lt;div class=\u0026#39;blog-comment-label form-column\u0026#39;\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026#39;form-comment-field form-column\u0026#39;\u0026gt;\u0026quot; +\n        \u0026quot;\u0026lt;input type=\u0026#39;hidden\u0026#39; name=\u0026#39;reply_to\u0026#39; value=\u0026#39;\u0026quot; + commentId + \u0026quot;\u0026#39; /\u0026gt;\u0026quot; +\n            \u0026quot;Replying to \u0026quot; + author + \u0026quot; (Comment #\u0026quot; + commentId + \u0026quot;)\u0026quot; +\n        \u0026quot;\u0026lt;/div\u0026gt;\u0026quot;\n    );\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"poc\"\u003ePOC\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eUnder bridge/admin/settings, check \u0026quot;allow unsafe inline\u0026quot; under javascript.\u003c/li\u003e\n\u003cli\u003eLeave a comment on a blog post. As name, use:\n\u0026#39;\u0026quot;\u0026gt;\u0026lt;img src=no onerror=alert(1)\u0026gt;\u003c/li\u003e\n\u003cli\u003eClick on \u0026quot;Reply\u0026quot;. The name will be read out via javascript and inserted into the DOM.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eWith a successful exploitation, an attacker can among other perform arbitrary actions in the name of the attacked user, such as adding a new administrator, and thus gain full access to the application.\u003c/p\u003e\n","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":251081,"file_name":"persistent_xss.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/251/081/2cc3fc622d964aeee940965b136efa28361ef7cb/persistent_xss.png?response-content-disposition=attachment%3B%20filename%3D%22persistent_xss.png%22%3B%20filename%2A%3DUTF-8%27%27persistent_xss.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ3BIZ4JTU%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052929Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDCqQsLMvYqK8Fn0GTGiLsXz5M8tY4soJZygdoXv5QEQAIgCyKzbKJdYVXE7%2F2vaqKKjTCLEh%2Fh%2BJKa%2B0XuR0hsEFUqtAMIUhABGgwwMTM2MTkyNzQ4NDkiDLR6kgVshwHIKyeb6iqRA2MFJpPkZrhx3t6AejIGud%2FxGIWTN2PoGCZioXicg1VZZgMq5uaPSAxNNXocaSomclyhf%2B4rJe2NLnNAFrXhEGbulvXBmkmO3c%2BD1qqEXyp6qcE41xoYCshBNytJdSH%2BZLTkpaCox4H3NJ6CH%2Bfflh7STpyLJOhPOuoFBY2ARN4mLdeBNYSs61C8zzgM1WQDBhFMxgMb7vKIJ1dmuPynnD4cKxw%2FWKOaq4NfJudL5XP2lTarTb4xTPf3vkoagtHONFoVfop3fmgabccyD5073szNTxXapdwAVZzs9R7zo8NryIyGlYETmxKma4s0cUHjxtmLxK48pLT0PIi7RZmyxoES3J9QTPpynp9iBtI5QalJxwB2tncxj9MMn9FCqJ1bzmYGaodAVxgE3jvslHp5jSM%2Fa1ljSf8SmNJrP91wkWRf4uVZMFej6WQDf8glru%2BoEB1%2FYut3mcF783rDVabhOcofZMw%2BHz6ACFg0WnuWtpGqDpIcX0PQQ%2FoYL%2BmsAiBEElGWlx6CHhWkYkEEJRUVb4ZXMK38qf8FOusBe7etUydbe6JZ8fKykaXtOPxCu8iTA%2FElzyhp13PbtTDj33DNPynSKOmKukTuY24fr3DCAPr5hsRSqBR1%2Ba8d9PI2IvIU4Avj2sJzGWzPQZqC0yDuDhW7b1Hlw1obEAxs3X5bDEbon1OT%2FNhVXLOjpX6Tgp0e%2FX9uw%2FNELi9ZDp%2F4R20Hnj3eXjNGpomDVtKhE43xUUHq1cwYK5VNgPoPIFeCXGybJOtMWcGWoFDEfI0CPBvkCnoRsX0aaemkRB8e4CYE0aYJNO%2BizSsaZzOxO9oeciDAN9toV%2BloBz7WYCb61lChRw6E6vCQyg%3D%3D\u0026X-Amz-Signature=3573660d48ed2736b17560452c7ca4da3a12cbd2513db11617f75a55d7b2c82d","file_size":86454,"type":"image/png"}],"allow_singular_disclosure_at":"2018-05-20T18:13:03.968Z","allow_singular_disclosure_after":-82379785.28181428,"singular_disclosure_allowed":true,"vote_count":4,"voters":["gamliel","eveeez","apapedulimu","666reda"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2258360,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey, thanks for taking the time to look at CMS Airship. I do want to draw your attention to an excerpt from our HackerOne program description.\n\n\u003e IMPORTANT: CMS AIRSHIP BEFORE VERSION 2 IS NO LONGER ELIGIBLE.\n\nVersion 2 hasn't been released yet.","markdown_message":"\u003cp\u003eHey, thanks for taking the time to look at CMS Airship. I do want to draw your attention to an excerpt from our HackerOne program description.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eIMPORTANT: CMS AIRSHIP BEFORE VERSION 2 IS NO LONGER ELIGIBLE.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eVersion 2 hasn\u0026#39;t been released yet.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-03T14:07:30.063Z","updated_at":"2018-01-03T14:07:30.063Z","actor":{"username":"paragonie-scott","cleared":false,"url":"/paragonie-scott","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/441/089de22b2f1b80a1e57a2792318dede5cbad81db_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2258589,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,  thank you for the quick reply. \n\nI did see the note, but understood it to mean that the 1.4.x branches are out of scope, and that the master 2.x branch is in scope. Thanks for the clarification.\n","markdown_message":"\u003cp\u003eHi,  thank you for the quick reply. \u003c/p\u003e\n\n\u003cp\u003eI did see the note, but understood it to mean that the 1.4.x branches are out of scope, and that the master 2.x branch is in scope. Thanks for the clarification.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-03T14:39:28.314Z","updated_at":"2018-01-03T14:39:28.314Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2319371,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I think we never really discussed how this report should be handled now, and just leaving it open doesn't seem ideal.\n\nOne option would be for you to resolve the issue and once it is fixed close the report as resolved. \n\nAnother option would be to close as \"n/a\", although I feel that that would be a bit unfair, as the program description wasn't clear imho (just a suggestion: you might want to remove the \"BEFORE VERSION 2\" part - it suggests that version 2 is in scope - , and optionally add that after version two is officially released in the future, it will be eligible again). \n\nFinally, closing as \"informational\" doesn't seem correct. If you don't want to close as \"resolved\" (after it's fixed) or \"n/a\", just let me know and I will self-close. ","markdown_message":"\u003cp\u003eI think we never really discussed how this report should be handled now, and just leaving it open doesn\u0026#39;t seem ideal.\u003c/p\u003e\n\n\u003cp\u003eOne option would be for you to resolve the issue and once it is fixed close the report as resolved. \u003c/p\u003e\n\n\u003cp\u003eAnother option would be to close as \u0026quot;n/a\u0026quot;, although I feel that that would be a bit unfair, as the program description wasn\u0026#39;t clear imho (just a suggestion: you might want to remove the \u0026quot;BEFORE VERSION 2\u0026quot; part - it suggests that version 2 is in scope - , and optionally add that after version two is officially released in the future, it will be eligible again). \u003c/p\u003e\n\n\u003cp\u003eFinally, closing as \u0026quot;informational\u0026quot; doesn\u0026#39;t seem correct. If you don\u0026#39;t want to close as \u0026quot;resolved\u0026quot; (after it\u0026#39;s fixed) or \u0026quot;n/a\u0026quot;, just let me know and I will self-close. \u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-25T22:45:32.807Z","updated_at":"2018-01-25T22:46:16.193Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2648381,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This should've been fixed in https://github.com/paragonie/airship/commit/9596534a8b389768ab125cac0352150c3fc415b5.\n\nSorry for the scope not being clearer when you reported this.","markdown_message":"\u003cp\u003eThis should\u0026#39;ve been fixed in \u003ca title=\"https://github.com/paragonie/airship/commit/9596534a8b389768ab125cac0352150c3fc415b5\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fparagonie%2Fairship%2Fcommit%2F9596534a8b389768ab125cac0352150c3fc415b5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/paragonie/airship/commit/9596534a8b389768ab125cac0352150c3fc415b5\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eSorry for the scope not being clearer when you reported this.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-20T17:27:40.953Z","updated_at":"2018-04-20T17:27:40.953Z","actor":{"username":"paragonie-scott","cleared":false,"url":"/paragonie-scott","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/441/089de22b2f1b80a1e57a2792318dede5cbad81db_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2648382,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Out of scope since v2 isn't released yet.","markdown_message":"\u003cp\u003eOut of scope since v2 isn\u0026#39;t released yet.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-20T17:27:57.991Z","updated_at":"2018-04-20T17:27:57.991Z","actor":{"url":"/paragonie","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/539/72f76fed45e5220b47ba2f679371ebf9ccb19c70_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Paragon Initiative Enterprises"}},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2648582,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-20T18:13:03.911Z","updated_at":"2018-04-20T18:13:03.911Z","first_to_agree":true,"actor":{"username":"paragonie-scott","cleared":false,"url":"/paragonie-scott","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/441/089de22b2f1b80a1e57a2792318dede5cbad81db_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2658478,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-24T08:47:31.618Z","updated_at":"2018-04-24T08:47:31.618Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2658479,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-24T08:47:31.689Z","updated_at":"2018-04-24T08:47:31.689Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"paragonie","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}