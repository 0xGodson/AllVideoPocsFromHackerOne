{"id":263902,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNjM5MDI=","url":"https://hackerone.com/reports/263902","title":"{REDACTED}.data.gov subdomain takeover.","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2017-08-28T09:01:43.185Z","submitted_at":"2017-08-28T09:01:43.185Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"edoverflow","url":"/edoverflow","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":21499,"url":"https://hackerone.com/tts","handle":"tts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/021/499/a8abb6c9702d454ed2bcfa55bb077ac2e49988b9_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/499/a8abb6c9702d454ed2bcfa55bb077ac2e49988b9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"TTS Bug Bounty","twitter_handle":"gsa_tts","website":"https://18f.gsa.gov","about":"The First Civilian Agency Public Bug Bounty Program"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-09-06T14:44:04.619Z","bug_reporter_agreed_on_going_public_at":"2017-08-31T09:25:14.945Z","team_member_agreed_on_going_public_at":"2017-09-06T14:44:04.571Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-09-30T09:25:15.037Z","allow_singular_disclosure_after":-102455471.80628446,"singular_disclosure_allowed":true,"vote_count":24,"voters":["tomnomnom","sp1d3rs","rijalrojan","streaak","gerben_javado","yumi","cuso4","gamliel","eveeez","r3y","and 14 more..."],"severity":{"rating":"high","score":7.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"low","availability":"low"}},"structured_scope":{"databaseId":1008,"asset_type":"URL","asset_identifier":"https://data.gov","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1959361,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-28T11:03:08.191Z","updated_at":"2017-08-28T11:03:08.191Z","actor":{"username":"rubikcube","cleared":false,"url":"/rubikcube","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/112/037/07ab876d3c8a79046085764c245ca1793dcf1d57_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":1962786,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-29T12:40:11.756Z","updated_at":"2017-08-29T12:40:11.756Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1962787,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-29T12:41:21.420Z","updated_at":"2017-08-29T12:41:21.420Z","actor":{"username":"joystick","cleared":false,"url":"/joystick","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/167/228/0840eb314aa099d9369d475d9ef9ba6299e83822_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1962788,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-29T12:41:54.466Z","updated_at":"2017-08-29T12:41:54.466Z","actor":{"username":"joystick","cleared":false,"url":"/joystick","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/167/228/0840eb314aa099d9369d475d9ef9ba6299e83822_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1962818,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-29T12:57:29.795Z","updated_at":"2017-08-29T12:57:29.795Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1962839,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-29T13:06:58.618Z","updated_at":"2017-08-29T13:06:58.618Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1967913,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-31T04:27:22.504Z","updated_at":"2017-08-31T04:27:22.504Z","actor":{"username":"wslack","cleared":false,"url":"/wslack","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/177/495/0f325c9db6586788cf1fd586777192815ef1d496_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"edoverflow","url":"/edoverflow"},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1968255,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-31T09:25:14.982Z","updated_at":"2017-08-31T09:25:14.982Z","first_to_agree":true,"actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1978526,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-05T22:28:36.775Z","updated_at":"2017-09-05T22:28:36.775Z","actor":{"username":"jkm","cleared":false,"url":"/jkm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/172/876/892cc8dda2c24d00e8e963b81dd9ab51a0bc784c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979121,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-06T07:48:26.947Z","updated_at":"2017-09-06T07:48:26.947Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979795,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-06T14:43:50.863Z","updated_at":"2017-09-06T14:43:50.863Z","actor":{"url":"/tts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/499/a8abb6c9702d454ed2bcfa55bb077ac2e49988b9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"TTS Bug Bounty"}},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979796,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-06T14:44:04.597Z","updated_at":"2017-09-06T14:44:04.597Z","actor":{"username":"jkm","cleared":false,"url":"/jkm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/172/876/892cc8dda2c24d00e8e963b81dd9ab51a0bc784c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979797,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-06T14:44:04.645Z","updated_at":"2017-09-06T14:44:04.645Z","actor":{"username":"jkm","cleared":false,"url":"/jkm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/172/876/892cc8dda2c24d00e8e963b81dd9ab51a0bc784c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979798,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-06T14:44:37.333Z","updated_at":"2017-09-06T14:44:37.333Z","additional_data":{},"actor":{"username":"jkm","cleared":false,"url":"/jkm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/172/876/892cc8dda2c24d00e8e963b81dd9ab51a0bc784c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979867,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-06T15:13:15.987Z","updated_at":"2017-09-06T15:13:15.987Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979988,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-06T15:51:03.221Z","updated_at":"2017-09-06T15:51:03.221Z","actor":{"username":"jkm","cleared":false,"url":"/jkm","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/172/876/892cc8dda2c24d00e8e963b81dd9ab51a0bc784c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1979994,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2017-09-06T15:53:24.444Z","updated_at":"2017-09-06T15:53:24.444Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"tts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":5275,"category":"team","content":"@edio discovered a number of related subdomain takeover attacks against some subdomains of data.gov. \n \nTechnically, these domains are out of scope for our [Vulnerability Disclosure Policy](https://github.com/18F/vulnerability-disclosure-policy/blob/master/vulnerability-disclosure-policy.md). We want to remind hackers to please limit their testing to domains explicitly listed in that scope (which is repeated on [our HackerOne program page](https://hackerone.com/tts) for convenience). This is for your own safety: we want to be sure that everyone's on the same page about your activities being authorized.\n\nThat said, this was a legitimate vulnerability, which we fixed, and we're disclosing details because they may be useful to other folks who operate services like ours.\n\nWe couldn't just remove the DNS entries, since those are used for internal purposes with agency CNAMEs. However, there were other ways we were able to resolve this by routing requests for unknown domains differently, and now serve 404s for these subdomains.\n\nA few more details about the cause and solutions:\n\n* For the subdomain in question, this was caused by a combination of how were routing requests to unknown domains and how we served static websites.\n* The basic issue was that our servers used our `{REDACTED}.data.gov` domain as a fallback for any unknown domain requests routed to us. So if a request came in for particular subdomains, we would end up treating it sort of like a request to `https://{REDACTED}.data.gov`. Since we proxied our home page requests to the same host where `{REDACTED}.data.gov`'s static site is currently hosted, and we passed along the original HTTP Host header for these unknown domains, it meant that the host would respond as if that unknown domain had been accessed directly on that host. As demonstrated, users could then to serve up content on these other domains.\n* So all that being said, the fix was actually straightforward, since it just involved disabling using the `{REDACTED}.data.gov` website as a fallback for unknown domains. This should mean that the only requests we forward now are actually ones for the `{REDACTED}.data.gov` domain.\n\nThanks for the find, @edio - we really appreciate it!\n\n[See also #263542, which was an independent discovery of the same issue on a different subdomain.]\n","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003ca href=\"/edio\"\u003e@edio\u003c/a\u003e discovered a number of related subdomain takeover attacks against some subdomains of data.gov. \u003c/p\u003e\n\n\u003cp\u003eTechnically, these domains are out of scope for our \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2F18F%2Fvulnerability-disclosure-policy%2Fblob%2Fmaster%2Fvulnerability-disclosure-policy.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eVulnerability Disclosure Policy\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. We want to remind hackers to please limit their testing to domains explicitly listed in that scope (which is repeated on \u003ca href=\"https://hackerone.com/tts\"\u003eour HackerOne program page\u003c/a\u003e for convenience). This is for your own safety: we want to be sure that everyone\u0026#39;s on the same page about your activities being authorized.\u003c/p\u003e\n\n\u003cp\u003eThat said, this was a legitimate vulnerability, which we fixed, and we\u0026#39;re disclosing details because they may be useful to other folks who operate services like ours.\u003c/p\u003e\n\n\u003cp\u003eWe couldn\u0026#39;t just remove the DNS entries, since those are used for internal purposes with agency CNAMEs. However, there were other ways we were able to resolve this by routing requests for unknown domains differently, and now serve 404s for these subdomains.\u003c/p\u003e\n\n\u003cp\u003eA few more details about the cause and solutions:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eFor the subdomain in question, this was caused by a combination of how were routing requests to unknown domains and how we served static websites.\u003c/li\u003e\n\u003cli\u003eThe basic issue was that our servers used our \u003ccode\u003e{REDACTED}.data.gov\u003c/code\u003e domain as a fallback for any unknown domain requests routed to us. So if a request came in for particular subdomains, we would end up treating it sort of like a request to \u003ccode\u003ehttps://{REDACTED}.data.gov\u003c/code\u003e. Since we proxied our home page requests to the same host where \u003ccode\u003e{REDACTED}.data.gov\u003c/code\u003e\u0026#39;s static site is currently hosted, and we passed along the original HTTP Host header for these unknown domains, it meant that the host would respond as if that unknown domain had been accessed directly on that host. As demonstrated, users could then to serve up content on these other domains.\u003c/li\u003e\n\u003cli\u003eSo all that being said, the fix was actually straightforward, since it just involved disabling using the \u003ccode\u003e{REDACTED}.data.gov\u003c/code\u003e website as a fallback for unknown domains. This should mean that the only requests we forward now are actually ones for the \u003ccode\u003e{REDACTED}.data.gov\u003c/code\u003e domain.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThanks for the find, \u003ca href=\"/edio\"\u003e@edio\u003c/a\u003e - we really appreciate it!\u003c/p\u003e\n\n\u003cp\u003e[See also \u003ca href=\"/reports/263542\"\u003e#263542\u003c/a\u003e, which was an independent discovery of the same issue on a different subdomain.]\u003c/p\u003e\n"},{"id":5283,"category":"researcher","content":"Using a combination of tools and techniques described in https://edoverflow.com/2017/github-recon/, I was able to take control of 7 different subdomains linked to {REDACTED}.data.gov.\n\nWorking with the TTS was a pleasure, thanks to their fast responses and quick resolution times. On top of that, they took the extra time to explain the root cause to me so I could better understand what was happening. Once again, thank you to the TTS and I look forward to working with them again in the future!","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eUsing a combination of tools and techniques described in \u003ca title=\"https://edoverflow.com/2017/github-recon/\" href=\"/redirect?url=https%3A%2F%2Fedoverflow.com%2F2017%2Fgithub-recon%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://edoverflow.com/2017/github-recon/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, I was able to take control of 7 different subdomains linked to {REDACTED}.data.gov.\u003c/p\u003e\n\n\u003cp\u003eWorking with the TTS was a pleasure, thanks to their fast responses and quick resolution times. On top of that, they took the extra time to explain the root cause to me so I could better understand what was happening. Once again, thank you to the TTS and I look forward to working with them again in the future!\u003c/p\u003e\n"}]}