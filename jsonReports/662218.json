{"id":662218,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NjIyMTg=","url":"https://hackerone.com/reports/662218","title":"Talk - Leak of password-protected room name via already existent resource addition","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2019-07-28T11:34:30.410Z","submitted_at":"2019-07-28T11:34:30.410Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"foobar7","url":"/foobar7","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2019-15620"],"singular_disclosure_disabled":false,"disclosed_at":"2020-03-01T13:18:20.583Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-01-31T13:18:14.484Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"CVSS\n----\n\nMedium 4.3 [CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)\n\nDescription\n-----------\n\nAffected: Talk / Spreed 6.0.3\n\nThe name of shared but password-protected rooms leaks to low-privileged authenticated users. \n\nAn attacker does not need to guess room IDs, but can simply iterate over IDs to gather all names of all affected rooms.\n\nPOC\n---\n\nSetup:\n\n- Add a password-protected room: Talk -\u003e New conversation -\u003e enter a name -\u003e Share link -\u003e set password\n- Add a project: Projects -\u003e Add a project -\u003e select a file\n\nAttack with a low-privileged user: \n\n- Build the following request (eg by going to Projects -\u003e Add project -\u003e select a file in a project the user has access to):\n\n        POST /nextcloud/nextcloud/ocs/v2.php/collaboration/resources/collections/21?format=json HTTP/1.1\n        Host: 192.168.0.104\n        User-Agent: [...]\n        Accept: application/json, text/plain, */*\n        Accept-Language: en-US,en;q=0.5\n        Accept-Encoding: gzip, deflate\n        Content-Type: application/json;charset=utf-8\n        requesttoken: [...]\n        Content-Length: 43\n        Connection: close\n        Cookie: [...]\n\n        {\"resourceType\":\"file\",\"resourceId\":\"1619\"}\n\n`16` is the ID of the password-protected room that the user does not have access to. `1626` is the ID of a file that was shared under the \"projects\" tab in that room. It is required that the file is already shared, but IDs are iterative and can easily be bruteforced.\n\nThe response will contain the room name \u0026 ID and the name of the shared file:\n\n    HTTP/1.1 200 OK\n    [...]\n\n    {\"ocs\":{\"meta\":{\"status\":\"ok\",\"statuscode\":200,\"message\":\"OK\"},\"data\":{\"id\":21,\"name\":\"privateprivateprivate\",\"resources\":[{\"type\":\"file\",\"id\":\"1619\",\"name\":\"aaaa.txt\",\"path\":\"files\\/aaaa.txt\",\"link\":\"http:\\/\\/192.168.0.104\\/nextcloud\\/nextcloud\\/index.php\\/f\\/1619\",\"mimetype\":\"text\\/plain\",\"preview-available\":true},{\"type\":\"room\",\"id\":\"w3die6ou\",\"name\":\"privateprivateprivate\",\"call-type\":\"public\",\"iconUrl\":\"http:\\/\\/192.168.0.104\\/nextcloud\\/nextcloud\\/apps\\/spreed\\/img\\/app-dark.svg\",\"link\":\"http:\\/\\/192.168.0.104\\/nextcloud\\/nextcloud\\/index.php\\/call\\/w3die6ou\"}]}}}\n\n## Impact\n\nleak of all password-protected room names to low-privileged attacker","vulnerability_information_html":"\u003ch2 id=\"cvss\"\u003eCVSS\u003c/h2\u003e\n\n\u003cp\u003eMedium 4.3 \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.first.org%2Fcvss%2Fcalculator%2F3.0%23CVSS%3A3.0%2FAV%3AN%2FAC%3AL%2FPR%3AL%2FUI%3AN%2FS%3AU%2FC%3AL%2FI%3AN%2FA%3AN\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"description\"\u003eDescription\u003c/h2\u003e\n\n\u003cp\u003eAffected: Talk / Spreed 6.0.3\u003c/p\u003e\n\n\u003cp\u003eThe name of shared but password-protected rooms leaks to low-privileged authenticated users. \u003c/p\u003e\n\n\u003cp\u003eAn attacker does not need to guess room IDs, but can simply iterate over IDs to gather all names of all affected rooms.\u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePOC\u003c/h2\u003e\n\n\u003cp\u003eSetup:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAdd a password-protected room: Talk -\u0026gt; New conversation -\u0026gt; enter a name -\u0026gt; Share link -\u0026gt; set password\u003c/li\u003e\n\u003cli\u003eAdd a project: Projects -\u0026gt; Add a project -\u0026gt; select a file\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAttack with a low-privileged user: \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eBuild the following request (eg by going to Projects -\u0026gt; Add project -\u0026gt; select a file in a project the user has access to):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /nextcloud/nextcloud/ocs/v2.php/collaboration/resources/collections/21?format=json HTTP/1.1\nHost: 192.168.0.104\nUser-Agent: [...]\nAccept: application/json, text/plain, */*\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nContent-Type: application/json;charset=utf-8\nrequesttoken: [...]\nContent-Length: 43\nConnection: close\nCookie: [...]\n\n{\u0026quot;resourceType\u0026quot;:\u0026quot;file\u0026quot;,\u0026quot;resourceId\u0026quot;:\u0026quot;1619\u0026quot;}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ccode\u003e16\u003c/code\u003e is the ID of the password-protected room that the user does not have access to. \u003ccode\u003e1626\u003c/code\u003e is the ID of a file that was shared under the \u0026quot;projects\u0026quot; tab in that room. It is required that the file is already shared, but IDs are iterative and can easily be bruteforced.\u003c/p\u003e\n\n\u003cp\u003eThe response will contain the room name \u0026amp; ID and the name of the shared file:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK\n[...]\n\n{\u0026quot;ocs\u0026quot;:{\u0026quot;meta\u0026quot;:{\u0026quot;status\u0026quot;:\u0026quot;ok\u0026quot;,\u0026quot;statuscode\u0026quot;:200,\u0026quot;message\u0026quot;:\u0026quot;OK\u0026quot;},\u0026quot;data\u0026quot;:{\u0026quot;id\u0026quot;:21,\u0026quot;name\u0026quot;:\u0026quot;privateprivateprivate\u0026quot;,\u0026quot;resources\u0026quot;:[{\u0026quot;type\u0026quot;:\u0026quot;file\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;1619\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;aaaa.txt\u0026quot;,\u0026quot;path\u0026quot;:\u0026quot;files\\/aaaa.txt\u0026quot;,\u0026quot;link\u0026quot;:\u0026quot;http:\\/\\/192.168.0.104\\/nextcloud\\/nextcloud\\/index.php\\/f\\/1619\u0026quot;,\u0026quot;mimetype\u0026quot;:\u0026quot;text\\/plain\u0026quot;,\u0026quot;preview-available\u0026quot;:true},{\u0026quot;type\u0026quot;:\u0026quot;room\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;w3die6ou\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;privateprivateprivate\u0026quot;,\u0026quot;call-type\u0026quot;:\u0026quot;public\u0026quot;,\u0026quot;iconUrl\u0026quot;:\u0026quot;http:\\/\\/192.168.0.104\\/nextcloud\\/nextcloud\\/apps\\/spreed\\/img\\/app-dark.svg\u0026quot;,\u0026quot;link\u0026quot;:\u0026quot;http:\\/\\/192.168.0.104\\/nextcloud\\/nextcloud\\/index.php\\/call\\/w3die6ou\u0026quot;}]}}}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eleak of all password-protected room names to low-privileged attacker\u003c/p\u003e\n","bounty_amount":"150.0","formatted_bounty":"$150","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-03-01T13:18:14.589Z","allow_singular_disclosure_after":-26154995.531897362,"singular_disclosure_allowed":true,"vote_count":5,"voters":["a_d_a_m","mygf","cryptographer","favorlee","kotiyeleswaram"],"severity":{"rating":"low","score":2.7,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"high","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":14804,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/spreed","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":5448060,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","markdown_message":"\u003cp\u003eThanks a lot for reporting this potential issue back to us!\u003c/p\u003e\n\n\u003cp\u003eOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we\u0026#39;d like to ask you to not disclose this issue to any other party.\u003c/p\u003e\n","automated_response":true,"created_at":"2019-07-28T11:34:30.925Z","updated_at":"2019-07-28T11:34:30.925Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5448146,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I'm having trouble reproducing this reliably (I'm probably overlooking some prerequisite).\n\nBut this seems to be a systemic issue across the projects component. I have identified at least two other ways in which *all* private and/or password-protected room names leak to a low-privileged user and which can be reproduced reliably. \n\nWithout having looked at the source in-depth, how conversation projects work seems to be roughly as following:\n\n- when a new project is added to a conversation, a new `collections` resource is created and given the name of the room\n- if anything that is already accessible with lower permissions is linked to this collection, the collection is assigned those permissions\n\nThus, the room name leaks. Two examples:\n\nTalk - Leak of private room name to linked public rooms\n=================================\n\nCVSS\n----\n\nMedium 5.3 [CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)\n\nPOC\n---\n\nSetup:\n\n- Add a public room: Talk -\u003e New conversation -\u003e enter a name, select public\n- Add a private room: Talk -\u003e New conversation -\u003e enter a name. No need to share the room, though this will also work with a shared, password-protected room.\n- Add a project to the private room: Projects -\u003e Add a project -\u003e Link to a conversation -\u003e select a public conversation\n\nAttack:\n\n- open the public room and go to projects. The name of the private room will be displayed in the web interface\n\nTalk - Leak of private room name if public resource is linked\n=================================\n\nCVSS\n----\n\nMedium 4.3 [CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)\n\nPOC\n---\n\nSetup:\n\n- Add a public file / a file a lower-privileged user can access\n- Add a private room: Talk -\u003e New conversation -\u003e enter a name. No need to share the room, though this will also work with a shared, password-protected room.\n- Add a project to the private room: Projects -\u003e Add a project -\u003e Link to a file -\u003e select the public file\n\nAttack:\n\n- perform the following request with a lower-privileged user without access to the room:\n\n        GET /nextcloud/nextcloud/ocs/v2.php/collaboration/resources/collections/64?format=json HTTP/1.1\n        Host: 192.168.0.104\n        User-Agent: [./..]\n        Accept: application/json, text/plain, */*\n        Accept-Language: en-US,en;q=0.5\n        Accept-Encoding: gzip, deflate\n        requesttoken: [...]\n        Connection: close\n        Cookie: [...]\n\nWhere `64` is the ID of the collection. Any collection that belongs to a private room, but which links to a public file can be leaked here. The response will contain the name of the private room.\n\nThis means that a low-privileged attacker can easily iterate over all IDs and gather all room names of all private and/or password-protected rooms that link to any file the attacker has read access to.","markdown_message":"\u003cp\u003eI\u0026#39;m having trouble reproducing this reliably (I\u0026#39;m probably overlooking some prerequisite).\u003c/p\u003e\n\n\u003cp\u003eBut this seems to be a systemic issue across the projects component. I have identified at least two other ways in which \u003cem\u003eall\u003c/em\u003e private and/or password-protected room names leak to a low-privileged user and which can be reproduced reliably. \u003c/p\u003e\n\n\u003cp\u003eWithout having looked at the source in-depth, how conversation projects work seems to be roughly as following:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ewhen a new project is added to a conversation, a new \u003ccode\u003ecollections\u003c/code\u003e resource is created and given the name of the room\u003c/li\u003e\n\u003cli\u003eif anything that is already accessible with lower permissions is linked to this collection, the collection is assigned those permissions\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThus, the room name leaks. Two examples:\u003c/p\u003e\n\n\u003ch1 id=\"talk-leak-of-private-room-name-to-linked-public-rooms\"\u003eTalk - Leak of private room name to linked public rooms\u003c/h1\u003e\n\n\u003ch2 id=\"cvss\"\u003eCVSS\u003c/h2\u003e\n\n\u003cp\u003eMedium 5.3 \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.first.org%2Fcvss%2Fcalculator%2F3.0%23CVSS%3A3.0%2FAV%3AN%2FAC%3AL%2FPR%3AN%2FUI%3AN%2FS%3AU%2FC%3AL%2FI%3AN%2FA%3AN\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePOC\u003c/h2\u003e\n\n\u003cp\u003eSetup:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAdd a public room: Talk -\u0026gt; New conversation -\u0026gt; enter a name, select public\u003c/li\u003e\n\u003cli\u003eAdd a private room: Talk -\u0026gt; New conversation -\u0026gt; enter a name. No need to share the room, though this will also work with a shared, password-protected room.\u003c/li\u003e\n\u003cli\u003eAdd a project to the private room: Projects -\u0026gt; Add a project -\u0026gt; Link to a conversation -\u0026gt; select a public conversation\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAttack:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eopen the public room and go to projects. The name of the private room will be displayed in the web interface\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1 id=\"talk-leak-of-private-room-name-if-public-resource-is-linked\"\u003eTalk - Leak of private room name if public resource is linked\u003c/h1\u003e\n\n\u003ch2 id=\"cvss\"\u003eCVSS\u003c/h2\u003e\n\n\u003cp\u003eMedium 4.3 \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.first.org%2Fcvss%2Fcalculator%2F3.0%23CVSS%3A3.0%2FAV%3AN%2FAC%3AL%2FPR%3AL%2FUI%3AN%2FS%3AU%2FC%3AL%2FI%3AN%2FA%3AN\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePOC\u003c/h2\u003e\n\n\u003cp\u003eSetup:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAdd a public file / a file a lower-privileged user can access\u003c/li\u003e\n\u003cli\u003eAdd a private room: Talk -\u0026gt; New conversation -\u0026gt; enter a name. No need to share the room, though this will also work with a shared, password-protected room.\u003c/li\u003e\n\u003cli\u003eAdd a project to the private room: Projects -\u0026gt; Add a project -\u0026gt; Link to a file -\u0026gt; select the public file\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAttack:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eperform the following request with a lower-privileged user without access to the room:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eGET /nextcloud/nextcloud/ocs/v2.php/collaboration/resources/collections/64?format=json HTTP/1.1\nHost: 192.168.0.104\nUser-Agent: [./..]\nAccept: application/json, text/plain, */*\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nrequesttoken: [...]\nConnection: close\nCookie: [...]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWhere \u003ccode\u003e64\u003c/code\u003e is the ID of the collection. Any collection that belongs to a private room, but which links to a public file can be leaked here. The response will contain the name of the private room.\u003c/p\u003e\n\n\u003cp\u003eThis means that a low-privileged attacker can easily iterate over all IDs and gather all room names of all private and/or password-protected rooms that link to any file the attacker has read access to.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-28T12:28:35.045Z","updated_at":"2019-07-28T12:28:35.045Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5453067,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for your report, I will look into it.","markdown_message":"\u003cp\u003eThanks for your report, I will look into it.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-29T13:36:43.646Z","updated_at":"2019-07-29T13:36:43.646Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5453579,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Temporary fix:\n```diff\ndiff --git a/lib/Collaboration/Resources/ConversationProvider.php b/lib/Collaboration/Resources/ConversationProvider.php\nindex 54903432..cb561c20 100644\n--- a/lib/Collaboration/Resources/ConversationProvider.php\n+++ b/lib/Collaboration/Resources/ConversationProvider.php\n@@ -22,8 +22,10 @@ declare(strict_types=1);\n \n namespace OCA\\Spreed\\Collaboration\\Resources;\n \n+use OCA\\Spreed\\Exceptions\\ParticipantNotFoundException;\n use OCA\\Spreed\\Exceptions\\RoomNotFoundException;\n use OCA\\Spreed\\Manager;\n+use OCA\\Spreed\\Participant;\n use OCA\\Spreed\\Room;\n use OCP\\Collaboration\\Resources\\IProvider;\n use OCP\\Collaboration\\Resources\\IResource;\n@@ -76,14 +78,25 @@ class ConversationProvider implements IProvider {\n        }\n \n        public function canAccessResource(IResource $resource, IUser $user = null): bool {\n+               $userId = $user instanceof IUser ? $user-\u003egetUID() : null;\n                try {\n                        $room = $this-\u003emanager-\u003egetRoomForParticipantByToken(\n                                $resource-\u003egetId(),\n-                               $user instanceof IUser ? $user-\u003egetUID() : null\n+                               $userId\n                        );\n-                       return $user instanceof IUser || $room-\u003egetType() === Room::PUBLIC_CALL;\n+\n+                       if ($userId === null) {\n+                               return $room-\u003egetType() === Room::PUBLIC_CALL \u0026\u0026 !$room-\u003ehasPassword();\n+                       }\n+\n+                       // Logged in users need to have a regular participant,\n+                       // before they can do anything with the room.\n+                       $participant = $room-\u003egetParticipant($user-\u003egetUID());\n+                       return $participant-\u003egetParticipantType() !== Participant::USER_SELF_JOINED;\n                } catch (RoomNotFoundException $e) {\n                        throw new ResourceException('Conversation not found');\n+               } catch (ParticipantNotFoundException $e) {\n+                       throw new ResourceException('Conversation not found');\n                }\n        }\n \n```\n\nProblems with this patch:\n* oc_collres_accesscache needs to be purged on update\n\nCan you confirm this?","markdown_message":"\u003cp\u003eTemporary fix:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gh\"\u003ediff --git a/lib/Collaboration/Resources/ConversationProvider.php b/lib/Collaboration/Resources/ConversationProvider.php\nindex 54903432..cb561c20 100644\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- a/lib/Collaboration/Resources/ConversationProvider.php\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/lib/Collaboration/Resources/ConversationProvider.php\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -22,8 +22,10 @@\u003c/span\u003e declare(strict_types=1);\n\n namespace OCA\\Spreed\\Collaboration\\Resources;\n\n+use OCA\\Spreed\\Exceptions\\ParticipantNotFoundException;\n use OCA\\Spreed\\Exceptions\\RoomNotFoundException;\n use OCA\\Spreed\\Manager;\n\u003cspan class=\"gi\"\u003e+use OCA\\Spreed\\Participant;\n\u003c/span\u003e use OCA\\Spreed\\Room;\n use OCP\\Collaboration\\Resources\\IProvider;\n use OCP\\Collaboration\\Resources\\IResource;\n\u003cspan class=\"p\"\u003e@@ -76,14 +78,25 @@\u003c/span\u003e class ConversationProvider implements IProvider {\n        }\n\n        public function canAccessResource(IResource $resource, IUser $user = null): bool {\n\u003cspan class=\"gi\"\u003e+               $userId = $user instanceof IUser ? $user-\u0026gt;getUID() : null;\n\u003c/span\u003e                try {\n                        $room = $this-\u0026gt;manager-\u0026gt;getRoomForParticipantByToken(\n                                $resource-\u0026gt;getId(),\n\u003cspan class=\"gd\"\u003e-                               $user instanceof IUser ? $user-\u0026gt;getUID() : null\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+                               $userId\n\u003c/span\u003e                        );\n\u003cspan class=\"gd\"\u003e-                       return $user instanceof IUser || $room-\u0026gt;getType() === Room::PUBLIC_CALL;\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+\n+                       if ($userId === null) {\n+                               return $room-\u0026gt;getType() === Room::PUBLIC_CALL \u0026amp;\u0026amp; !$room-\u0026gt;hasPassword();\n+                       }\n+\n+                       // Logged in users need to have a regular participant,\n+                       // before they can do anything with the room.\n+                       $participant = $room-\u0026gt;getParticipant($user-\u0026gt;getUID());\n+                       return $participant-\u0026gt;getParticipantType() !== Participant::USER_SELF_JOINED;\n\u003c/span\u003e                } catch (RoomNotFoundException $e) {\n                        throw new ResourceException(\u0026#39;Conversation not found\u0026#39;);\n\u003cspan class=\"gi\"\u003e+               } catch (ParticipantNotFoundException $e) {\n+                       throw new ResourceException(\u0026#39;Conversation not found\u0026#39;);\n\u003c/span\u003e                }\n        }\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eProblems with this patch:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eoc_collres_accesscache needs to be purged on update\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eCan you confirm this?\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-29T14:46:20.805Z","updated_at":"2019-07-29T14:46:20.805Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5461230,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@nickvergessen I don't have the time to check this in-depth right now, but I'll look into it on the weekend.","markdown_message":"\u003cp\u003e\u003ca href=\"/nickvergessen\"\u003e@nickvergessen\u003c/a\u003e I don\u0026#39;t have the time to check this in-depth right now, but I\u0026#39;ll look into it on the weekend.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-30T11:47:28.373Z","updated_at":"2019-07-30T11:47:28.373Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5493985,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nickvergessen ,\n\nI'm not sure if this fixes the root of the problem. I can still reproduce the POCs (even after running `truncate table oc_collres_accesscache;`)\n\nAnother example where the room name leaks:\n\n- Create a file with user A (admin) \u0026 share with user B (attacker)\n- Share the file with a private room that user B cannot access (Details -\u003e Sharing -\u003e Add a project -\u003e Link to a conversation)\n- Visit the following URL with user B:\n\n        GET /nextcloud/nextcloud/ocs/v2.php/collaboration/resources/file/2565?format=json HTTP/1.1\n        Host: 192.168.0.104\n\n        {\"ocs\":{\"meta\":{\"status\":\"ok\",\"statuscode\":200,\"message\":\"OK\"},\"data\":[{\"id\":224,\"name\":\"secretconversation title\",\"resources\":\n\nBest,\nFoobar7","markdown_message":"\u003cp\u003eHi \u003ca href=\"/nickvergessen\"\u003e@nickvergessen\u003c/a\u003e ,\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m not sure if this fixes the root of the problem. I can still reproduce the POCs (even after running \u003ccode\u003etruncate table oc_collres_accesscache;\u003c/code\u003e)\u003c/p\u003e\n\n\u003cp\u003eAnother example where the room name leaks:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eCreate a file with user A (admin) \u0026amp; share with user B (attacker)\u003c/li\u003e\n\u003cli\u003eShare the file with a private room that user B cannot access (Details -\u0026gt; Sharing -\u0026gt; Add a project -\u0026gt; Link to a conversation)\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eVisit the following URL with user B:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eGET /nextcloud/nextcloud/ocs/v2.php/collaboration/resources/file/2565?format=json HTTP/1.1\nHost: 192.168.0.104\n\n{\u0026quot;ocs\u0026quot;:{\u0026quot;meta\u0026quot;:{\u0026quot;status\u0026quot;:\u0026quot;ok\u0026quot;,\u0026quot;statuscode\u0026quot;:200,\u0026quot;message\u0026quot;:\u0026quot;OK\u0026quot;},\u0026quot;data\u0026quot;:[{\u0026quot;id\u0026quot;:224,\u0026quot;name\u0026quot;:\u0026quot;secretconversation title\u0026quot;,\u0026quot;resources\u0026quot;:\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nFoobar7\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-03T12:42:47.115Z","updated_at":"2019-08-03T12:42:47.115Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5613984,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"curl -k https://nextcloud17.local/ocs/v2.php/collaboration/resources/file/324?format=json -H \"OCS-APIRequest: true\" -u test1:123456\n```json\n{\n  \"ocs\": {\n    \"meta\": {\n      \"status\": \"ok\",\n      \"statuscode\": 200,\n      \"message\": \"OK\"\n    },\n    \"data\": [\n      {\n        \"id\": 7,\n        \"name\": \"locales.json\",\n        \"resources\": [\n          {\n            \"type\": \"file\",\n            \"id\": \"324\",\n            \"name\": \"locales.json\",\n            \"path\": \"\",\n            \"link\": \"https:\\/\\/nextcloud17.local\\/index.php\\/f\\/324\",\n            \"mimetype\": \"application\\/json\",\n            \"preview-available\": false\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nFor me the room is not listed anymore.\n\nThe room name is only leaked as resource collection name, when you go to the room and create the project there by linking it to the file. This is not really preventable.\n\nAlso our long term vision is anyway that a project with an item you have access to will grant you the same permissions for all other items in this project.\n\nFor now I think this is okay, because at least you can not iterate over all projects anymore, to gather a list of all public shared talk conversations.","markdown_message":"\u003cp\u003ecurl -k \u003ca title=\"https://nextcloud17.local/ocs/v2.php/collaboration/resources/file/324?format=json\" href=\"/redirect?url=https%3A%2F%2Fnextcloud17.local%2Focs%2Fv2.php%2Fcollaboration%2Fresources%2Ffile%2F324%3Fformat%3Djson\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://nextcloud17.local/ocs/v2.php/collaboration/resources/file/324?format=json\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e -H \u0026quot;OCS-APIRequest: true\u0026quot; -u test1:123456\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;ocs\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;meta\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;status\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;ok\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;statuscode\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;message\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;OK\u0026quot;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;data\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;locales.json\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;resources\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n          \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;type\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;file\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;324\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;locales.json\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;path\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;link\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;https:\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/\\/\u003c/span\u003e\u003cspan class=\"s2\"\u003enextcloud17.local\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/\u003c/span\u003e\u003cspan class=\"s2\"\u003eindex.php\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/\u003c/span\u003e\u003cspan class=\"s2\"\u003ef\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/\u003c/span\u003e\u003cspan class=\"s2\"\u003e324\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;mimetype\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;application\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/\u003c/span\u003e\u003cspan class=\"s2\"\u003ejson\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;preview-available\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"w\"\u003e\n          \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFor me the room is not listed anymore.\u003c/p\u003e\n\n\u003cp\u003eThe room name is only leaked as resource collection name, when you go to the room and create the project there by linking it to the file. This is not really preventable.\u003c/p\u003e\n\n\u003cp\u003eAlso our long term vision is anyway that a project with an item you have access to will grant you the same permissions for all other items in this project.\u003c/p\u003e\n\n\u003cp\u003eFor now I think this is okay, because at least you can not iterate over all projects anymore, to gather a list of all public shared talk conversations.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-20T09:06:45.929Z","updated_at":"2019-08-20T09:06:45.929Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5614003,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah, I also just noticed that the final fix we applied is a bit different then the diff I posted above:\nhttps://github.com/nextcloud/spreed/commit/e6070d272a85ab4b2cff258718e593d12f489025#diff-7fb7b53dfe69f1c9d42252ccab43fbb9","markdown_message":"\u003cp\u003eAh, I also just noticed that the final fix we applied is a bit different then the diff I posted above:\u003cbr\u003e\n\u003ca title=\"https://github.com/nextcloud/spreed/commit/e6070d272a85ab4b2cff258718e593d12f489025#diff-7fb7b53dfe69f1c9d42252ccab43fbb9\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fspreed%2Fcommit%2Fe6070d272a85ab4b2cff258718e593d12f489025%23diff-7fb7b53dfe69f1c9d42252ccab43fbb9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/spreed/commit/e6070d272a85ab4b2cff258718e593d12f489025#diff-7fb7b53dfe69f1c9d42252ccab43fbb9\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-20T09:09:47.641Z","updated_at":"2019-08-20T09:09:47.641Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5614004,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved in our latest maintenance releases and we're working on the advisories at the moment.\n\nPlease let us know how you'd like to be credited in our official advisory. We require the following information:\n\n- Name / Pseudonym\n- Email address (optional)\n- Website (optional)\n- Company (optional)\n","markdown_message":"\u003cp\u003eThanks a lot for your report again. This has been resolved in our latest maintenance releases and we\u0026#39;re working on the advisories at the moment.\u003c/p\u003e\n\n\u003cp\u003ePlease let us know how you\u0026#39;d like to be credited in our official advisory. We require the following information:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eName / Pseudonym\u003c/li\u003e\n\u003cli\u003eEmail address (optional)\u003c/li\u003e\n\u003cli\u003eWebsite (optional)\u003c/li\u003e\n\u003cli\u003eCompany (optional)\u003c/li\u003e\n\u003c/ul\u003e\n","automated_response":false,"created_at":"2019-08-20T09:10:02.064Z","updated_at":"2019-08-20T09:10:02.064Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5617003,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-20T13:58:05.801Z","updated_at":"2019-08-20T13:58:05.801Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"bounty_amount":"150.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"foobar7","url":"/foobar7"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5617006,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-20T13:58:21.106Z","updated_at":"2019-08-20T13:58:21.106Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5617581,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @nickvergessen,\n\n\u003e The room name is only leaked as resource collection name, when you go to the room and create the project there by linking it to the file. This is not really preventable.\n\n\u003e Also our long term vision is anyway that a project with an item you have access to will grant you the same permissions for all other items in this project.\n\n\u003e For now I think this is okay, because at least you can not iterate over all projects anymore, to gather a list of all public shared talk conversations.\n\nI'm not so sure about this. I don't think a user sharing a public file to a private discussion would expect that this will leak the private discussion title to all users that have access to the file. \n\nI could think of two potential solutions here:\n\n- (at least if it's a private conversation) ask the user to name the project themselves and make it clear that this name may be shared with anyone who has access to any resource in the project.\n- only show projects to a user if the user has access to all elements in the project\n\n(Silently) giving a user access to all items in a project once they have access to one item doesn't seem ideal. If you plan on making an explicit permission model for projects, that could be a different thing, but I'm not sure it would necessarily solve this problem. \n\nBest,\nFoobar7\n\nPS: You can credit me as Tim Coen (https://security-consulting.icu/)\nPPS: Thanks for the bounty and the swag! I noticed that I haven't actually received the previous swag for #428010 though. Do you know if that went out already?","markdown_message":"\u003cp\u003eHi \u003ca href=\"/nickvergessen\"\u003e@nickvergessen\u003c/a\u003e,\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe room name is only leaked as resource collection name, when you go to the room and create the project there by linking it to the file. This is not really preventable.\u003c/p\u003e\n\n\u003cp\u003eAlso our long term vision is anyway that a project with an item you have access to will grant you the same permissions for all other items in this project.\u003c/p\u003e\n\n\u003cp\u003eFor now I think this is okay, because at least you can not iterate over all projects anymore, to gather a list of all public shared talk conversations.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI\u0026#39;m not so sure about this. I don\u0026#39;t think a user sharing a public file to a private discussion would expect that this will leak the private discussion title to all users that have access to the file. \u003c/p\u003e\n\n\u003cp\u003eI could think of two potential solutions here:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e(at least if it\u0026#39;s a private conversation) ask the user to name the project themselves and make it clear that this name may be shared with anyone who has access to any resource in the project.\u003c/li\u003e\n\u003cli\u003eonly show projects to a user if the user has access to all elements in the project\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e(Silently) giving a user access to all items in a project once they have access to one item doesn\u0026#39;t seem ideal. If you plan on making an explicit permission model for projects, that could be a different thing, but I\u0026#39;m not sure it would necessarily solve this problem. \u003c/p\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nFoobar7\u003c/p\u003e\n\n\u003cp\u003ePS: You can credit me as Tim Coen (\u003ca title=\"https://security-consulting.icu/\" href=\"/redirect?url=https%3A%2F%2Fsecurity-consulting.icu%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://security-consulting.icu/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e)\u003cbr\u003e\nPPS: Thanks for the bounty and the swag! I noticed that I haven\u0026#39;t actually received the previous swag for \u003ca href=\"/reports/428010\"\u003e#428010\u003c/a\u003e though. Do you know if that went out already?\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-20T15:10:24.357Z","updated_at":"2019-08-20T15:10:24.357Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5623770,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Right, that makes a bit sense and we opted for solution 2:\nhttps://github.com/nextcloud/server/pull/16820\n\nWe used non alerting title and description on the pull request, so this can go into 17beta3 which is due to tomorrow, although the next maintenance release for 16 is still ~2-3 weeks away.","markdown_message":"\u003cp\u003eRight, that makes a bit sense and we opted for solution 2:\u003cbr\u003e\n\u003ca title=\"https://github.com/nextcloud/server/pull/16820\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fserver%2Fpull%2F16820\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/server/pull/16820\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWe used non alerting title and description on the pull request, so this can go into 17beta3 which is due to tomorrow, although the next maintenance release for 16 is still ~2-3 weeks away.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-21T07:21:40.167Z","updated_at":"2019-08-21T07:21:40.167Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5623779,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Regarding swag, I heard we are currently out of tshirts. But our conference is in september and I guess we will get a new set printed for that anyway and you should then receive it.","markdown_message":"\u003cp\u003eRegarding swag, I heard we are currently out of tshirts. But our conference is in september and I guess we will get a new set printed for that anyway and you should then receive it.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-21T07:22:30.925Z","updated_at":"2019-08-21T07:22:30.925Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5623793,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e (Silently) giving a user access to all items in a project once they have access to one item doesn't seem ideal. If you plan on making an explicit permission model for projects, that could be a different thing, \n\nwell that is exactly the plan. But that is (as said) a long vision goal, so fo rnow we can make it a bit more strict.","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003e(Silently) giving a user access to all items in a project once they have access to one item doesn\u0026#39;t seem ideal. If you plan on making an explicit permission model for projects, that could be a different thing, \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ewell that is exactly the plan. But that is (as said) a long vision goal, so fo rnow we can make it a bit more strict.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-21T07:25:09.163Z","updated_at":"2019-08-21T07:25:09.163Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6932424,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-31T13:18:14.502Z","updated_at":"2020-01-31T13:18:14.502Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6933061,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-31T14:52:07.241Z","updated_at":"2020-01-31T14:52:07.241Z","additional_data":{"old_severity":"Medium","new_severity":"Low (2.7)","old_severity_id":479522,"new_severity_id":622370},"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7188410,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-03-01T13:18:20.602Z","updated_at":"2020-03-01T13:18:20.602Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}