{"id":820146,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84MjAxNDY=","url":"https://hackerone.com/reports/820146","title":"PHPUnit is included in groupfolders release package potentially causing RCE","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2020-03-16T13:33:19.649Z","submitted_at":"2020-03-16T13:33:19.649Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ledfan","url":"/ledfan","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/YCdhvsskxFm7D6whnyeL4L5J/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-06-25T14:17:32.830Z","bug_reporter_agreed_on_going_public_at":"2020-06-25T14:17:32.786Z","team_member_agreed_on_going_public_at":"2020-06-25T12:15:28.953Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The groupfolders tarball contains the phpunit code in the vendor directory (https://github.com/nextcloud/groupfolders/releases/download/v6.0.2/groupfolders.tar.gz) .\nAs discussed on https://thephp.cc/news/2020/02/phpunit-a-security-risk this really is a potential security risk.\nThe phpunit code contains a file called `eval-stdin.php` which evaluates the contents of `php://stdin`.\nNote that the same issue was discovered in PrestaShop which according to thephp.cc claims:\n\n```\nI was contacted by the vendor of PrestaShop, an Open Source E-Commerce software, on January 6, 2020. They informed me that eval-stdin.php can be exploited for remote code execution when PHPUnit is publicly available on the web server and FastCGI is used to integrate PHP with that web server.\n```\n\nI was not able to exploit this using different FastCGI configurations. However, again according to phpcc:\n\n```\nAn HTTP post payload can only be accessed via the php://stdin stream if PHP is used by the web server via CGI or FastCGI. I was not sure if php://stdin really behaves like this, so I reached out to PHP core developers. Joe Watkins and Christoph M. Becker were able to confirm that php://stdin behaves like this and that its implementation is based on the specifications for CGI and FastCGI, which mandate access to the request payload via the standard input stream.\n```\n\nIf the Nextcloud is configured so that the url still contains `index.php` I was able to access the `eval-stdin.php` file without authentication.\nNote that the following apps also include the phpunit package:\n - https://apps.nextcloud.com/apps/carnet\n - https://apps.nextcloud.com/apps/discoursesso\n - https://apps.nextcloud.com/apps/extract\n\n## Impact\n\nAccording to the PHP core developers and PrestaShop the `eval-stdin.php` makes it possible to perform RCE.\nMy research shows that in at least certain circumstances (i.e., index.php is not rewritten) the `eval-stdin.php` file is accessible.","vulnerability_information_html":"\u003cp\u003eThe groupfolders tarball contains the phpunit code in the vendor directory (\u003ca title=\"https://github.com/nextcloud/groupfolders/releases/download/v6.0.2/groupfolders.tar.gz\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fgroupfolders%2Freleases%2Fdownload%2Fv6.0.2%2Fgroupfolders.tar.gz\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/groupfolders/releases/download/v6.0.2/groupfolders.tar.gz\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) .\u003cbr\u003e\nAs discussed on \u003ca title=\"https://thephp.cc/news/2020/02/phpunit-a-security-risk\" href=\"/redirect?url=https%3A%2F%2Fthephp.cc%2Fnews%2F2020%2F02%2Fphpunit-a-security-risk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://thephp.cc/news/2020/02/phpunit-a-security-risk\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e this really is a potential security risk.\u003cbr\u003e\nThe phpunit code contains a file called \u003ccode\u003eeval-stdin.php\u003c/code\u003e which evaluates the contents of \u003ccode\u003ephp://stdin\u003c/code\u003e.\u003cbr\u003e\nNote that the same issue was discovered in PrestaShop which according to thephp.cc claims:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eI was contacted by the vendor of PrestaShop, an Open Source E-Commerce software, on January 6, 2020. They informed me that eval-stdin.php can be exploited for remote code execution when PHPUnit is publicly available on the web server and FastCGI is used to integrate PHP with that web server.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI was not able to exploit this using different FastCGI configurations. However, again according to phpcc:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eAn HTTP post payload can only be accessed via the php://stdin stream if PHP is used by the web server via CGI or FastCGI. I was not sure if php://stdin really behaves like this, so I reached out to PHP core developers. Joe Watkins and Christoph M. Becker were able to confirm that php://stdin behaves like this and that its implementation is based on the specifications for CGI and FastCGI, which mandate access to the request payload via the standard input stream.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf the Nextcloud is configured so that the url still contains \u003ccode\u003eindex.php\u003c/code\u003e I was able to access the \u003ccode\u003eeval-stdin.php\u003c/code\u003e file without authentication.\u003cbr\u003e\nNote that the following apps also include the phpunit package:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca title=\"https://apps.nextcloud.com/apps/carnet\" href=\"/redirect?url=https%3A%2F%2Fapps.nextcloud.com%2Fapps%2Fcarnet\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://apps.nextcloud.com/apps/carnet\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca title=\"https://apps.nextcloud.com/apps/discoursesso\" href=\"/redirect?url=https%3A%2F%2Fapps.nextcloud.com%2Fapps%2Fdiscoursesso\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://apps.nextcloud.com/apps/discoursesso\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca title=\"https://apps.nextcloud.com/apps/extract\" href=\"/redirect?url=https%3A%2F%2Fapps.nextcloud.com%2Fapps%2Fextract\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://apps.nextcloud.com/apps/extract\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAccording to the PHP core developers and PrestaShop the \u003ccode\u003eeval-stdin.php\u003c/code\u003e makes it possible to perform RCE.\u003cbr\u003e\nMy research shows that in at least certain circumstances (i.e., index.php is not rewritten) the \u003ccode\u003eeval-stdin.php\u003c/code\u003e file is accessible.\u003c/p\u003e\n","bounty_amount":"100.0","formatted_bounty":"$100","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-07-25T12:15:29.039Z","allow_singular_disclosure_after":-13545745.281714138,"singular_disclosure_allowed":true,"vote_count":9,"voters":["a_d_a_m","brahim_boufakri01","mygf","sa1tama0","cryptographer","rupeshsahay","theklash77","love07oj","helius"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":7329338,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","markdown_message":"\u003cp\u003eThanks a lot for reporting this potential issue back to us!\u003c/p\u003e\n\n\u003cp\u003eOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we\u0026#39;d like to ask you to not disclose this issue to any other party.\u003c/p\u003e\n","automated_response":true,"created_at":"2020-03-16T13:33:19.956Z","updated_at":"2020-03-16T13:33:19.956Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7329735,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for your report.\n\ncarnet, discoursesso and extract authors will be contacted.\n\nFor the groufolders app an employee has been notified","markdown_message":"\u003cp\u003eThanks for your report.\u003c/p\u003e\n\n\u003cp\u003ecarnet, discoursesso and extract authors will be contacted.\u003c/p\u003e\n\n\u003cp\u003eFor the groufolders app an employee has been notified\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-16T13:48:26.195Z","updated_at":"2020-03-16T13:48:26.195Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7340415,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for the report again. A new release 6.0.3 of groupfolders is available as of yesterday evening and we made sure that vendor files are excluded in future releases.","markdown_message":"\u003cp\u003eThanks a lot for the report again. A new release 6.0.3 of groupfolders is available as of yesterday evening and we made sure that vendor files are excluded in future releases.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-17T07:25:05.605Z","updated_at":"2020-03-17T07:25:05.605Z","actor":{"username":"juliushaertl","cleared":false,"url":"/juliushaertl","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/104/133/d1cc5303ea1d3ba8d34637b3406a0c134e5c4f4e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7340498,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved in our latest maintenance release.","markdown_message":"\u003cp\u003eThanks a lot for your report again. This has been resolved in our latest maintenance release.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-17T07:39:47.059Z","updated_at":"2020-03-17T07:39:47.059Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ledfan","url":"/ledfan"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7340509,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Not eligible for a bounty as the app(s) is(are) not in scope.\n\nYou already have a Shirt I think? If not let us now and you get some Swag","markdown_message":"\u003cp\u003eNot eligible for a bounty as the app(s) is(are) not in scope.\u003c/p\u003e\n\n\u003cp\u003eYou already have a Shirt I think? If not let us now and you get some Swag\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-17T07:40:57.556Z","updated_at":"2020-03-17T07:40:57.556Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7340780,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the quick fix! It's too bad of the bounty, but I understand.  :)\nI indeed already have some swag. \n\nWill you do an impact analysis about this issue? If the core PHP developers are right that this can be exploited when using (Fast)CGI this is really a big issue. \nIf you want, I can try to contact them and ask in which configurations this occurs and report back.\n\n","markdown_message":"\u003cp\u003eThank you for the quick fix! It\u0026#39;s too bad of the bounty, but I understand.  :)\u003cbr\u003e\nI indeed already have some swag. \u003c/p\u003e\n\n\u003cp\u003eWill you do an impact analysis about this issue? If the core PHP developers are right that this can be exploited when using (Fast)CGI this is really a big issue. \u003cbr\u003e\nIf you want, I can try to contact them and ask in which configurations this occurs and report back.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-17T08:18:44.799Z","updated_at":"2020-03-17T08:18:44.799Z","actor":{"username":"ledfan","cleared":false,"url":"/ledfan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YCdhvsskxFm7D6whnyeL4L5J/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7341686,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","markdown_message":"","automated_response":false,"created_at":"2020-03-17T09:55:10.180Z","updated_at":"2020-03-17T09:55:10.180Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7341690,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again.","markdown_message":"\u003cp\u003eThanks a lot for your report again.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-17T09:55:21.970Z","updated_at":"2020-03-17T09:55:21.970Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ledfan","url":"/ledfan"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7341696,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"We decided to give you a bonus, although it is in theory not eligible for a bounty.","markdown_message":"\u003cp\u003eWe decided to give you a bonus, although it is in theory not eligible for a bounty.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-03-17T09:56:08.535Z","updated_at":"2020-03-17T09:56:08.535Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"100.0","genius_execution_id":null,"team_handle":"nextcloud","collaborator":{"username":"ledfan","url":"/ledfan"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8405579,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"All apps have been updated in the maintime or the releases withdrawn","markdown_message":"\u003cp\u003eAll apps have been updated in the maintime or the releases withdrawn\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-25T12:15:28.969Z","updated_at":"2020-06-25T12:15:28.969Z","first_to_agree":true,"actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8406938,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-25T14:17:32.803Z","updated_at":"2020-06-25T14:17:32.803Z","actor":{"username":"ledfan","cleared":false,"url":"/ledfan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YCdhvsskxFm7D6whnyeL4L5J/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8406939,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-25T14:17:32.849Z","updated_at":"2020-06-25T14:17:32.849Z","actor":{"username":"ledfan","cleared":false,"url":"/ledfan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YCdhvsskxFm7D6whnyeL4L5J/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}