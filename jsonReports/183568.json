{"id":183568,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODM1Njg=","url":"https://hackerone.com/reports/183568","title":"[Buddypress] Arbitrary File Deletion through bp_avatar_set","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-11-20T06:36:56.932Z","submitted_at":"2016-11-20T06:36:56.932Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mopman","url":"/mopman","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/012/220/8dcf3a0b05d59213207f4e2544f53991202f9f2a_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":55,"url":"https://hackerone.com/wordpress","handle":"wordpress","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"WordPress","twitter_handle":"wordpress","website":"https://wordpress.org/","about":"Beautiful sites of any kind."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-08-22T18:04:10.313Z","bug_reporter_agreed_on_going_public_at":"2017-08-22T07:33:08.447Z","team_member_agreed_on_going_public_at":"2017-08-22T18:04:10.250Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\nThe bp_avatar_set action in BuddyPress when cropping avatars allows an attacker to arbitrarily delete a file the webserver can delete through the 'original_file' parameter.\n\nFor example:\n\n* Create a user on a Buddypress-powered Wordpress instance (any user is OK, doesn't need to be admin, just needs to have the ability to change it's own avatar in the Buddypress profile which is normal).\n* Navigate to the avatar change URL for example /members/\u003cusername\u003e/profile/change-avatar/ on my install.\n* Click the button to upload an image and select any valid image. Allow the first request which uploads this image to submit as normal.\n* Select the crop button, but do not allow the request to complete (I used Burp and enabled intercept mode). Modify the request to change the original_file parameter to point to a file you wish to delete, traversing up with ../.. if needed. So for example where my legitimate param was:\n\noriginal_file=http%3A%2F%2Flocalhost%2F~sam%2Fwordpress%2Fwp-content%2Fuploads%2Favatars%2F2%2Fmy_ugly_face.jpg\n\nChange to:\n\noriginal_file=http%3A%2F%2Flocalhost%2F~sam%2Fwordpress%2Fwp-content%2Fuploads%2Favatars%2F2%2F../../../../../wp-config.php\n\nRemember it will be in a numbered folder probably, so you need one more .. than expected from the URL. You can upload an image for real to see how the path ends up for guidance on this if you're an attacker and don't know the folder structure.\n\nThe wp-config.php file will be deleted when unlink() is called and the blog will then be unavailable, of course, in this case.\n\nThis path needs to be somehow validated such that it can only delete uploaded avatars (constraining to the upload directory would still allow you to delete, say, other users avatars, or other uploaded files, which would still make me sad :()\n\nLet me know if you have any trouble reproducing or need any further info - I think I explained OK, but it is very late here. ;)\n\no/","vulnerability_information_html":"\u003cp\u003eHi,\u003cbr\u003e\nThe bp_avatar_set action in BuddyPress when cropping avatars allows an attacker to arbitrarily delete a file the webserver can delete through the \u0026#39;original_file\u0026#39; parameter.\u003c/p\u003e\n\n\u003cp\u003eFor example:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eCreate a user on a Buddypress-powered Wordpress instance (any user is OK, doesn\u0026#39;t need to be admin, just needs to have the ability to change it\u0026#39;s own avatar in the Buddypress profile which is normal).\u003c/li\u003e\n\u003cli\u003eNavigate to the avatar change URL for example /members/\u0026lt;username\u0026gt;/profile/change-avatar/ on my install.\u003c/li\u003e\n\u003cli\u003eClick the button to upload an image and select any valid image. Allow the first request which uploads this image to submit as normal.\u003c/li\u003e\n\u003cli\u003eSelect the crop button, but do not allow the request to complete (I used Burp and enabled intercept mode). Modify the request to change the original_file parameter to point to a file you wish to delete, traversing up with ../.. if needed. So for example where my legitimate param was:\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eoriginal_file=http%3A%2F%2Flocalhost%2F~sam%2Fwordpress%2Fwp-content%2Fuploads%2Favatars%2F2%2Fmy_ugly_face.jpg\u003c/p\u003e\n\n\u003cp\u003eChange to:\u003c/p\u003e\n\n\u003cp\u003eoriginal_file=http%3A%2F%2Flocalhost%2F~sam%2Fwordpress%2Fwp-content%2Fuploads%2Favatars%2F2%2F../../../../../wp-config.php\u003c/p\u003e\n\n\u003cp\u003eRemember it will be in a numbered folder probably, so you need one more .. than expected from the URL. You can upload an image for real to see how the path ends up for guidance on this if you\u0026#39;re an attacker and don\u0026#39;t know the folder structure.\u003c/p\u003e\n\n\u003cp\u003eThe wp-config.php file will be deleted when unlink() is called and the blog will then be unavailable, of course, in this case.\u003c/p\u003e\n\n\u003cp\u003eThis path needs to be somehow validated such that it can only delete uploaded avatars (constraining to the upload directory would still allow you to delete, say, other users avatars, or other uploaded files, which would still make me sad :()\u003c/p\u003e\n\n\u003cp\u003eLet me know if you have any trouble reproducing or need any further info - I think I explained OK, but it is very late here. ;)\u003c/p\u003e\n\n\u003cp\u003eo/\u003c/p\u003e\n","bounty_amount":"350.0","formatted_bounty":"$350","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-09-21T07:33:08.539Z","allow_singular_disclosure_after":-103238002.15520316,"singular_disclosure_allowed":true,"vote_count":8,"voters":["flamezzz","bl4de","bogdantcaciuc","cuso4","eveeez","japz","seafood","p3rs0n_0f_1nt3rn3t"],"severity":{"rating":"high","score":7.7,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"changed","confidentiality":"none","integrity":"none","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1310676,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the report - we'll forward this issue to the BuddyPress team immediately.","markdown_message":"\u003cp\u003eThanks for the report - we\u0026#39;ll forward this issue to the BuddyPress team immediately.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-21T20:25:49.721Z","updated_at":"2016-11-21T20:25:49.721Z","actor":{"username":"vortfu","cleared":false,"url":"/vortfu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/982/1ef285fb263d30f189dc6a8038e1d5c46086e9d9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1310816,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-21T21:08:58.966Z","updated_at":"2016-11-21T21:08:58.966Z","actor":{"username":"jjj","cleared":false,"url":"/jjj","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/063/b21324cc7d9861888c1ddd4fa345cda6612361ff_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1310859,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @mopman, thanks again for reporting this here.\n\nI'll be looking into this. We'll need to very specifically limit file deletion access to only the 1 that's currently being interacted with.","markdown_message":"\u003cp\u003eHey \u003ca href=\"/mopman\"\u003e@mopman\u003c/a\u003e, thanks again for reporting this here.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ll be looking into this. We\u0026#39;ll need to very specifically limit file deletion access to only the 1 that\u0026#39;s currently being interacted with.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-21T21:20:39.498Z","updated_at":"2016-11-21T21:20:39.498Z","actor":{"username":"jjj","cleared":false,"url":"/jjj","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/063/b21324cc7d9861888c1ddd4fa345cda6612361ff_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1314712,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-23T09:04:59.250Z","updated_at":"2016-11-23T09:04:59.250Z","actor":{"username":"xknown","cleared":false,"url":"/xknown","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1377665,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mopman, thanks for your patience while we worked this out on our end.\n\nWe are going to start pushing fixes into each major branch, ranging from trunk (2.8) back to 2.2. How would you like to be credited publicly for identifying and responsibly disclosing this to us? This includes commit messages and any blog posts that outline the situation and subsequent releases.\n\nTalk soon,\n\n-JJJ","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mopman\"\u003e@mopman\u003c/a\u003e, thanks for your patience while we worked this out on our end.\u003c/p\u003e\n\n\u003cp\u003eWe are going to start pushing fixes into each major branch, ranging from trunk (2.8) back to 2.2. How would you like to be credited publicly for identifying and responsibly disclosing this to us? This includes commit messages and any blog posts that outline the situation and subsequent releases.\u003c/p\u003e\n\n\u003cp\u003eTalk soon,\u003c/p\u003e\n\n\u003cp\u003e-JJJ\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-20T19:22:45.211Z","updated_at":"2016-12-20T19:22:45.211Z","actor":{"username":"jjj","cleared":false,"url":"/jjj","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/063/b21324cc7d9861888c1ddd4fa345cda6612361ff_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1431155,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey everyone,\n\nBuddyPress 2.7.4 went out on December 23 to resolve this, and we also repackaged new versions all the way back to 2.2.\n\nhttps://buddypress.org/2016/12/buddypress-2-7-4-security-release/\n\nThanks again @mopman for letting us know about this here.\n\n-JJJ\n","markdown_message":"\u003cp\u003eHey everyone,\u003c/p\u003e\n\n\u003cp\u003eBuddyPress 2.7.4 went out on December 23 to resolve this, and we also repackaged new versions all the way back to 2.2.\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://buddypress.org/2016/12/buddypress-2-7-4-security-release/\" href=\"/redirect?url=https%3A%2F%2Fbuddypress.org%2F2016%2F12%2Fbuddypress-2-7-4-security-release%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://buddypress.org/2016/12/buddypress-2-7-4-security-release/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThanks again \u003ca href=\"/mopman\"\u003e@mopman\u003c/a\u003e for letting us know about this here.\u003c/p\u003e\n\n\u003cp\u003e-JJJ\u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-19T20:29:11.953Z","updated_at":"2017-01-19T20:29:11.953Z","actor":{"username":"jjj","cleared":false,"url":"/jjj","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/063/b21324cc7d9861888c1ddd4fa345cda6612361ff_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"mopman","url":"/mopman"},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1525641,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-07T22:46:00.757Z","updated_at":"2017-03-07T22:46:00.757Z","actor":{"url":"/wordpress","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/055/f114d1d31f904e3b903cd99a6cf566bb531f8401_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"WordPress"}},"bounty_amount":"350.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"wordpress","collaborator":{"username":"mopman","url":"/mopman"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1525700,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the bounty guys, and glad to see this got resolved.","markdown_message":"\u003cp\u003eThanks for the bounty guys, and glad to see this got resolved.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-07T23:07:02.215Z","updated_at":"2017-03-07T23:07:02.215Z","actor":{"username":"mopman","cleared":false,"url":"/mopman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/220/8dcf3a0b05d59213207f4e2544f53991202f9f2a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1945530,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-22T07:33:08.484Z","updated_at":"2017-08-22T07:33:08.484Z","first_to_agree":true,"actor":{"username":"mopman","cleared":false,"url":"/mopman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/220/8dcf3a0b05d59213207f4e2544f53991202f9f2a_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1946879,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks again for the report, @mopman.","markdown_message":"\u003cp\u003eThanks again for the report, \u003ca href=\"/mopman\"\u003e@mopman\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-22T18:04:10.266Z","updated_at":"2017-08-22T18:04:10.266Z","actor":{"username":"boonebgorges","cleared":false,"url":"/boonebgorges","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1946880,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-22T18:04:10.328Z","updated_at":"2017-08-22T18:04:10.328Z","actor":{"username":"boonebgorges","cleared":false,"url":"/boonebgorges","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"wordpress","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}