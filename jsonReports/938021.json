{"id":938021,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85MzgwMjE=","url":"https://hackerone.com/reports/938021","title":"Availing Zomato gold by using a random third-party `wallet_id`","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2020-07-23T10:24:08.814Z","submitted_at":"2020-07-23T10:24:08.814Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"pandaaaa","url":"/pandaaaa","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/312/498/8470ddbbff50e9161c5f5884a8bcaff890350102_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2943,"url":"https://hackerone.com/zomato","handle":"zomato","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Zomato","twitter_handle":"Zomato","website":"https://www.zomato.com","about":"The fastest way to search for great places to eat at and order from around you. Serving 24 countries worldwide."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-07T19:42:51.400Z","bug_reporter_agreed_on_going_public_at":"2020-07-27T10:15:22.400Z","team_member_agreed_on_going_public_at":"2020-08-07T19:42:51.278Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":65,"name":"Business Logic Errors"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":95,"voters":["r3b00t_","virenpawar","secator","ninetynine","mygf","leonishan","samet","aryan2808","trazer","avileox","and 85 more..."],"severity":{"rating":"critical","score":9.3,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"low","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":383,"asset_type":"URL","asset_identifier":"*.zomato.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8717325,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T10:26:19.198Z","updated_at":"2020-07-23T10:26:19.198Z","actor":{"username":"pandaaaa","cleared":false,"url":"/pandaaaa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/312/498/8470ddbbff50e9161c5f5884a8bcaff890350102_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8718368,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T11:17:39.305Z","updated_at":"2020-07-23T11:17:39.305Z","actor":{"username":"prateek_0490-zomato","cleared":false,"url":"/prateek_0490-zomato","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CL56d6XwY4TN3eHc73df8AEU/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8718444,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T11:24:28.827Z","updated_at":"2020-07-23T11:24:28.827Z","additional_data":{},"actor":{"username":"prateek_0490-zomato","cleared":false,"url":"/prateek_0490-zomato","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CL56d6XwY4TN3eHc73df8AEU/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8718471,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T11:26:21.186Z","updated_at":"2020-07-23T11:26:21.186Z","actor":{"username":"pandaaaa","cleared":false,"url":"/pandaaaa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/312/498/8470ddbbff50e9161c5f5884a8bcaff890350102_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8718524,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T11:31:50.488Z","updated_at":"2020-07-23T11:31:50.488Z","actor":{"username":"biryani-is-lob","cleared":false,"url":"/biryani-is-lob","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/sYPtN4bJVr35fXwTxNPhuBtp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8718652,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T11:42:45.891Z","updated_at":"2020-07-23T11:42:45.891Z","actor":{"url":"/zomato","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Zomato"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"zomato","collaborator":{"username":"pandaaaa","url":"/pandaaaa"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8721306,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T13:19:52.570Z","updated_at":"2020-07-23T13:19:52.570Z","actor":{"username":"prateek_0490-zomato","cleared":false,"url":"/prateek_0490-zomato","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CL56d6XwY4TN3eHc73df8AEU/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8722365,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T14:30:04.238Z","updated_at":"2020-07-23T14:33:54.827Z","actor":{"username":"pandaaaa","cleared":false,"url":"/pandaaaa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/312/498/8470ddbbff50e9161c5f5884a8bcaff890350102_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8723209,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T14:54:26.338Z","updated_at":"2020-07-23T14:54:26.338Z","actor":{"username":"prateek_0490-zomato","cleared":false,"url":"/prateek_0490-zomato","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CL56d6XwY4TN3eHc73df8AEU/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8724143,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-23T15:56:43.566Z","updated_at":"2020-07-23T15:56:43.566Z","actor":{"username":"pandaaaa","cleared":false,"url":"/pandaaaa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/312/498/8470ddbbff50e9161c5f5884a8bcaff890350102_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8760171,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-27T04:17:42.341Z","updated_at":"2020-07-27T04:17:42.341Z","actor":{"username":"biryani-is-lob","cleared":false,"url":"/biryani-is-lob","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/sYPtN4bJVr35fXwTxNPhuBtp/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"pandaaaa","url":"/pandaaaa"},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8763245,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-27T10:15:22.435Z","updated_at":"2020-07-27T10:15:22.435Z","first_to_agree":true,"actor":{"username":"pandaaaa","cleared":false,"url":"/pandaaaa","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/312/498/8470ddbbff50e9161c5f5884a8bcaff890350102_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8871842,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-07T07:11:12.215Z","updated_at":"2020-08-07T07:11:12.215Z","actor":{"username":"prateek_0490-zomato","cleared":false,"url":"/prateek_0490-zomato","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CL56d6XwY4TN3eHc73df8AEU/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8872041,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-07T07:48:27.904Z","updated_at":"2020-08-07T07:48:27.904Z","additional_data":{},"actor":{"username":"prateek_0490-zomato","cleared":false,"url":"/prateek_0490-zomato","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CL56d6XwY4TN3eHc73df8AEU/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8878881,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-07T19:42:51.318Z","updated_at":"2020-08-07T19:42:51.318Z","actor":{"username":"prateek_0490-zomato","cleared":false,"url":"/prateek_0490-zomato","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CL56d6XwY4TN3eHc73df8AEU/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8878882,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-07T19:42:51.461Z","updated_at":"2020-08-07T19:42:51.461Z","actor":{"username":"prateek_0490-zomato","cleared":false,"url":"/prateek_0490-zomato","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CL56d6XwY4TN3eHc73df8AEU/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":23947,"category":"team","content":"We received a report from @pandaaaa wherein he demonstrated a way to avail Zomato Gold membership using random Zomato User's wallet. The report was triaged and rewarded with critical severity with a `CVSS score of 9.3`. \n\nIt was considered critical since a random user's wallet could have been used for unauthorized membership purchases. This was only possible on third party wallets with `status - active` flag.\n\n| Timeline | Action |\n|---|---|\n| Thu, 23 July 2020, 15:54 IST | @pandaaaa submitted a report with high severity |\n| Thu, 23 July 2020, 16:08 IST | Investigation started, the team started analysing the issue |\n| Thu, 23 July 2020, 16:47 IST | First contact on Report |\n| Thu, 23 July 2020, 16:51 IST | Security Team reproduced the issue |\n| Thu, 23 July 2020, 16:54 IST | Internal ticket logged and assigned to the Engineering Team |\n| Thu, 23 July 2020, 16:54 IST | Severity upgraded from high to critical (9.3 CVSS) by Security team |\n| Thu, 23 July 2020, 17:01 IST | Report triaged |\n| Thu, 23 July 2020, 17:12 IST | Bounty rewarded to @pandaaaa  |\n| Thu, 23 July 2020, 18:11 IST | Fix deployed on production |\n| Thu, 23 July 2020, 18:49 IST | Re-test requested from @pandaaaa to validate the fix |\n| Thu, 23 July 2020, 20:03 IST | The researcher confirmed the fix |\n\n**Response time for this report:**\n\n- Investigation started within ***14 minutes***\n- Reproduced within ***59 minutes***\n- Triaged within ***1 hour, 7 minutes***\n- Rewarded within ***1 hour, 12 minutes***\n- Fixed within ***2 hours, 17 minutes***\n\n### Background\n\nIn Zomato, each user has multiple payment types, one of such payment type is third-party wallets. While purchasing Gold, the user can select the Payment method, if a user selects wallets as payment type, the user can select any of the wallets and the wallet is passed on to the backend, here, there was no check to associate `wallet id` with the user id, so it was possible to use other user's `wallet id`.\n\n### Root cause Analysis\n\n**This was introduced because of a recent code change that went live 13 hours ago.**\n\n- Zomato allows users to avail Gold membership which is being handled by this particular request `https://www.zomato.com/php/pk_handler.php`.\n\n- To successfully purchase the membership, a series of calls are needed to be processed in a particular order. \n\n- In the First call, user phone number and membership price is sent\n\n```rb\ncase=getpaymentsdataphone=XXXXXXXcart_value=999.00service_type=REDonline_payments_flag=1country_id=X\n```\nit then returns all the payment methods available and the last payment method used for a user. \n\n- For the relevance of this report, only payment methods of `wallet_type` as `third_party_wallet` and `status` as `active` are needed. \n\n```rb\n{  \"wallet_id\": 8XXXXXXX3,  \"balance\": 0.01,  \"currency\": \"INR\",  \"user_id\": \"14XXXXX2\",  \"entity_id\": \"14XXXX2\",  \"entity_type\": \"user\",  \"country_id\": 1,  \"status\": \"active\",  \"vault\": \"paytm\",  \"storage_state\": \"retained\",  \"reference_id\": XXXXXXXXX,  \"phone\": \"XXXXXXXXX\",  \"email\": \"XXXXXXXXX@gmail.com\",  \"expires\": XXXXXXXXX,  \"balance_display\": \"₹0.01\",  \"max_recharge_amount\": XXXXXXXXXX,  \"wallet_type\": \"third_party_wallet\",  \"img_url\": \"https://b.zmtcdn.com/payments/wallet-logos/paytm.png\",  \"display_text\": \"Paytm\",  \"recharge_available\": 1}\n```\n\n- On the next call, Payment type selected is used to perform the actual transaction on `https://www.zomato.com/php/red/desktop_payments_handler.php`\n\n```rb\npayment_method_id=8XXXXXX1payment_method_type=walletphone=XXXXXXXXXXXXXXXXXcartValue=999.00voucher_code=action=paymentis_renewal=0user_id=1XXXXX2tnc_accepted=false\n```\nwhich returns\n\n```rb\n{  \"status\": \"success\",  \"track_id\": \"ZRD-XXXXXXXXXXXX\",  \"response_message\": \"Capture Successful\",  \"message\": \"\",  \"code\": 0,  \"subscription_id\": XXXXXXX,  \"amount\": 999,  \"city_id\": 1,  \"upgrade_plan_flag\": 0,  \"restart_subscription_flag\": 0,  \"transaction_id\": XXXXXXXXX,  \"thankyou_page_type\": \"thankyou_inactive\",  \"text\": \"You are now a Zomato Gold member\",  \"redirect_url\": \"https://www.zomato.com/gold/payment-success?subscription_id=XXXXXX\u0026user_id=XXXXXXXX\u0026is_first_time=1\u0026order_id=XXXXXXX\"}\n```\n\n- There was no check while performing the transaction to validate if the `wallet id` actually belonged to the user who initiated the call.\n\n### Remediation\n\n- Since it could have allowed to use any random user's `wallet_id` to purchase a Gold membership, the first thing we did was to investigate and see if it was abused since the introduction of this vulnerability.\n\n- **We found no evidence of it being abused** apart from `2 transactions` wherein both of them were test transactions to actually validate/test the issue, one was from @pandaaaa and the other one was from our internal team.\n\n- Our engineers immediately patched the issue and the patch was pushed to production within 2 hours and 17 mins` from the report.\n\nThanks, @pandaaaa for helping us keep @zomato secure.\n\nZomato Security Team","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eWe received a report from \u003ca href=\"/pandaaaa\"\u003e@pandaaaa\u003c/a\u003e wherein he demonstrated a way to avail Zomato Gold membership using random Zomato User\u0026#39;s wallet. The report was triaged and rewarded with critical severity with a \u003ccode\u003eCVSS score of 9.3\u003c/code\u003e. \u003c/p\u003e\n\n\u003cp\u003eIt was considered critical since a random user\u0026#39;s wallet could have been used for unauthorized membership purchases. This was only possible on third party wallets with \u003ccode\u003estatus - active\u003c/code\u003e flag.\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eTimeline\u003c/th\u003e\n\u003cth\u003eAction\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 15:54 IST\u003c/td\u003e\n\u003ctd\u003e\n\u003ca href=\"/pandaaaa\"\u003e@pandaaaa\u003c/a\u003e submitted a report with high severity\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 16:08 IST\u003c/td\u003e\n\u003ctd\u003eInvestigation started, the team started analysing the issue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 16:47 IST\u003c/td\u003e\n\u003ctd\u003eFirst contact on Report\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 16:51 IST\u003c/td\u003e\n\u003ctd\u003eSecurity Team reproduced the issue\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 16:54 IST\u003c/td\u003e\n\u003ctd\u003eInternal ticket logged and assigned to the Engineering Team\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 16:54 IST\u003c/td\u003e\n\u003ctd\u003eSeverity upgraded from high to critical (9.3 CVSS) by Security team\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 17:01 IST\u003c/td\u003e\n\u003ctd\u003eReport triaged\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 17:12 IST\u003c/td\u003e\n\u003ctd\u003eBounty rewarded to \u003ca href=\"/pandaaaa\"\u003e@pandaaaa\u003c/a\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 18:11 IST\u003c/td\u003e\n\u003ctd\u003eFix deployed on production\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 18:49 IST\u003c/td\u003e\n\u003ctd\u003eRe-test requested from \u003ca href=\"/pandaaaa\"\u003e@pandaaaa\u003c/a\u003e to validate the fix\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eThu, 23 July 2020, 20:03 IST\u003c/td\u003e\n\u003ctd\u003eThe researcher confirmed the fix\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e\u003cstrong\u003eResponse time for this report:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eInvestigation started within \u003cstrong\u003e\u003cem\u003e14 minutes\u003c/em\u003e\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eReproduced within \u003cstrong\u003e\u003cem\u003e59 minutes\u003c/em\u003e\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eTriaged within \u003cstrong\u003e\u003cem\u003e1 hour, 7 minutes\u003c/em\u003e\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eRewarded within \u003cstrong\u003e\u003cem\u003e1 hour, 12 minutes\u003c/em\u003e\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eFixed within \u003cstrong\u003e\u003cem\u003e2 hours, 17 minutes\u003c/em\u003e\u003c/strong\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"background\"\u003eBackground\u003c/h3\u003e\n\n\u003cp\u003eIn Zomato, each user has multiple payment types, one of such payment type is third-party wallets. While purchasing Gold, the user can select the Payment method, if a user selects wallets as payment type, the user can select any of the wallets and the wallet is passed on to the backend, here, there was no check to associate \u003ccode\u003ewallet id\u003c/code\u003e with the user id, so it was possible to use other user\u0026#39;s \u003ccode\u003ewallet id\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch3 id=\"root-cause-analysis\"\u003eRoot cause Analysis\u003c/h3\u003e\n\n\u003cp\u003e\u003cstrong\u003eThis was introduced because of a recent code change that went live 13 hours ago.\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eZomato allows users to avail Gold membership which is being handled by this particular request \u003ccode\u003ehttps://www.zomato.com/php/pk_handler.php\u003c/code\u003e.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eTo successfully purchase the membership, a series of calls are needed to be processed in a particular order. \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eIn the First call, user phone number and membership price is sent\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003egetpaymentsdataphone\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"no\"\u003eXXXXXXXcart_value\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e999.00\u003c/span\u003e\u003cspan class=\"n\"\u003eservice_type\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"no\"\u003eREDonline_payments_flag\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"n\"\u003ecountry_id\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"no\"\u003eX\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eit then returns all the payment methods available and the last payment method used for a user. \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eFor the relevance of this report, only payment methods of \u003ccode\u003ewallet_type\u003c/code\u003e as \u003ccode\u003ethird_party_wallet\u003c/code\u003e and \u003ccode\u003estatus\u003c/code\u003e as \u003ccode\u003eactive\u003c/code\u003e are needed. \u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;wallet_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"no\"\u003eXXXXXXX3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;balance\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.01\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;currency\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;INR\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;user_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;14XXXXX2\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;entity_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;14XXXX2\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;entity_type\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;user\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;country_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;status\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;active\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;vault\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;paytm\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;storage_state\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;retained\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;reference_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003eXXXXXXXXX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;phone\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;XXXXXXXXX\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;email\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;XXXXXXXXX@gmail.com\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;expires\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003eXXXXXXXXX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;balance_display\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;₹0.01\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;max_recharge_amount\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003eXXXXXXXXXX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;wallet_type\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;third_party_wallet\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;img_url\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;https://b.zmtcdn.com/payments/wallet-logos/paytm.png\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;display_text\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;Paytm\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;recharge_available\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eOn the next call, Payment type selected is used to perform the actual transaction on \u003ccode\u003ehttps://www.zomato.com/php/red/desktop_payments_handler.php\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003epayment_method_id\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"no\"\u003eXXXXXX1payment_method_type\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ewalletphone\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"no\"\u003eXXXXXXXXXXXXXXXXXcartValue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e999.00\u003c/span\u003e\u003cspan class=\"n\"\u003evoucher_code\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003epaymentis_renewal\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"n\"\u003euser_id\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"no\"\u003eXXXXX2tnc_accepted\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"kp\"\u003efalse\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewhich returns\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;status\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;success\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;track_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;ZRD-XXXXXXXXXXXX\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;response_message\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;Capture Successful\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;message\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;code\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;subscription_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003eXXXXXXX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;amount\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e999\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;city_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;upgrade_plan_flag\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;restart_subscription_flag\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;transaction_id\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003eXXXXXXXXX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;thankyou_page_type\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;thankyou_inactive\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;text\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;You are now a Zomato Gold member\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"err\"\u003e \u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;redirect_url\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;https://www.zomato.com/gold/payment-success?subscription_id=XXXXXX\u0026amp;user_id=XXXXXXXX\u0026amp;is_first_time=1\u0026amp;order_id=XXXXXXX\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eThere was no check while performing the transaction to validate if the \u003ccode\u003ewallet id\u003c/code\u003e actually belonged to the user who initiated the call.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"remediation\"\u003eRemediation\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eSince it could have allowed to use any random user\u0026#39;s \u003ccode\u003ewallet_id\u003c/code\u003e to purchase a Gold membership, the first thing we did was to investigate and see if it was abused since the introduction of this vulnerability.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003cstrong\u003eWe found no evidence of it being abused\u003c/strong\u003e apart from \u003ccode\u003e2 transactions\u003c/code\u003e wherein both of them were test transactions to actually validate/test the issue, one was from \u003ca href=\"/pandaaaa\"\u003e@pandaaaa\u003c/a\u003e and the other one was from our internal team.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eOur engineers immediately patched the issue and the patch was pushed to production within 2 hours and 17 mins` from the report.\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThanks, @pandaaaa for helping us keep @zomato secure.\u003c/p\u003e\n\n\u003cp\u003eZomato Security Team\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}