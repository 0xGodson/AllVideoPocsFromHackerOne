{"id":422043,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MjIwNDM=","url":"https://hackerone.com/reports/422043","title":"H1514 DOMXSS on Embedded SDK via Shopify.API.setWindowLocation abusing cookie Stuffing","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-10-10T09:31:18.935Z","submitted_at":"2018-10-10T09:31:18.935Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"filedescriptor","url":"/filedescriptor","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-04-17T14:40:38.473Z","bug_reporter_agreed_on_going_public_at":"2019-04-17T04:29:44.483Z","team_member_agreed_on_going_public_at":"2019-04-17T14:40:38.226Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi Team!\n\nI'm reporting a rather unusual DOMXSS that allows an attacker to perform a XSS attack on any Shopify apps that use the Embedded SDK. To exploit this, several techniques were chained together: Cookie Stuffing -\u003e Login CSRF -\u003e (Not Open) Redirect -\u003e DOMXSS.\n\n#Details\nInspired by #381192, I decided to check all pages to see if there's any broken origin validation. The results were frustrating since they all seemed to be done properly. However I noticed embedded apps did it in a way that it verifies if the coming origin is the logged-in store. Say if I am an admin on foobar.myshopify.com, then an embedded app will check if in-coming messages originate from https://foobar.myshopify.com. I went ahead to look up some [documentations](https://help.shopify.com/en/api/embedded-apps/embedded-app-sdk/initialization), confirming this is by design (`shopOrigin`):\n\n```javascript\nShopifyApp.init({\n  shopOrigin: 'https://CURRENT_LOGGED_IN_SHOP.myshopify.com'\n[...]\n```\n\nNow this is interesting because by design we can execute any JavaScript on our own stores. That means, I can iframe an embedded app on my store, then post any message to it and it will accept it. So I quickly beautify the SDK source code to see if there's any interesting event. Checking common DOMXSS sinks I found that it registers the `Shopify.API.setWindowLocation` event that navigates to a said destination.\n\nhttps://cdn.shopify.com/s/assets/external/app.js\n```javascript\ne.setWindowLocation = function(e) {\n    return window.location = e\n}, e.bindWindowLocation = function() {\n    return _Shopify.Messenger.addHandler(\"Shopify.API.setWindowLocation\", function(e) {\n        return function(t, n) {\n            return e.setWindowLocation(n)\n        }\n    }(this))\n}\n```\n\nBy navigate to a *javascript:* pseudo URL it can lead to XSS. This can be verified by opening any embedded apps and execute the following code in the DevTools' console\n```javascript\n$$('iframe')[0].contentWindow.postMessage('{\"message\":\"Shopify.API.setWindowLocation\",\"data\":\"javascript:alert(document.domain);0[0]\"}','*')\n```\n{F358299}\n\n**However this XSS is almost useless** because the embedded app is authenticated as us, the attacker. When we try to exploit it on a victim it won't work because they are not logged into our store. So you could say this is, a self DOMXSS. Well, almost. \n\nWhat if we use Login CSRF to force a victim to be logged into our store? After the victim is logged in to our store, we can then instruct user's browser to log into the embedded app as us by navigating to `/admin/oauth/authorize`. Then the current logged in store will be ours. I came up with an idea to stuff the session cookies using JavaScript.\n\nThe session cookies consist of `_secure_admin_session_id` and `_master_udr`. While I could simply write `_secure_admin_session_id` with `docuemnt.cookie` API, I realized a problem with `_master_udr`. Unlike `_secure_admin_session_id`, `_master_udr` is scoped to `.myshopify.com`. If we triy to write our `_master_udr`, then this will happen:\n\n```http\nGET https://canvasfoobar.myshopify.com/admin/oauth/authorize?client_id=d25e45407e508f96409c2dd796e9bd95\u0026redirect_uri=https%3A%2F%2Fscript-editor.shopifycloud.com%2Fauth%2Fshopify%2Fcallback\u0026response_type=code\u0026scope=write_scripts%2Cread_products%2Cread_customers\u0026state=a HTTP/1.1\nHost: canvasfoobar.myshopify.com\nCookie: _master_udr=LEGIT; _master_udr=EVIL; _secure_admin_session_id=EVIL\n```\n\nThe legitimate `_master_udr` will override our evil one and the server will refuse to authenticate as us. There is a trick fortunately. \n\n\u003e“Cookies with longer paths are listed before cookies with shorter paths.” –RFC 6265\n\nBy setting a cookie with a very specific (`/admin/oauth` in this case) we can outrun the original one. The code that we will use to force a login will be:\n\n```javascript\ndocument.cookie = '_secure_admin_session_id=EVIL;path=/admin/oauth';\ndocument.cookie = '_master_udr=EVIL;path=/admin/oauth';\n```\n\nAnother problem is even after all this, the victim will be logged into the embedded app **as us**. That means, all actions only affect our store. \n\nTo solve this we can simply relog in the victim to the embedded app. Since the victim is still logged in their store, we can navigate the victim to https://victim.myshopify.com/admin/oauth/authorize to trigger the auth flow for the embedded app. The drawback is we need to know which store the victim is logged in as. Luckily https://www.shopify.com/path will redirect to the last logged in store of a user, therefore navigating to https://www.shopify.com/admin/oauth/authorize will lead them to https://victim.myshopify.com/admin/oauth/authorize.\n\nEventually we have our XSS running on the embedded app's domain running with the victim's session.\n\n#Steps to Reproduce\n\nIn the PoC, Script Editor will be used as an example.\n\n1. Be logged into your store as an admin and have [Script Editor](https://apps.shopify.com/script-editor) installed\n2. Navigate to https://canvasfoobar.myshopify.com/products/canary\n3. After the iframe turns grey, click it\n4. After a while, a fake modal dialog will show up and a *New Script* will be created\n\nI'm also attaching a video demo.\n\n#Fix\n\nI recommend fixing this issue by validating the URL for `Shopify.API.setWindowLocation`. The other small issues are by design so they are hard to fix.\n\n## Impact\n\nPerform unauthorized actions on a store admin on any embedded apps.","vulnerability_information_html":"\u003cp\u003eHi Team!\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m reporting a rather unusual DOMXSS that allows an attacker to perform a XSS attack on any Shopify apps that use the Embedded SDK. To exploit this, several techniques were chained together: Cookie Stuffing -\u0026gt; Login CSRF -\u0026gt; (Not Open) Redirect -\u0026gt; DOMXSS.\u003c/p\u003e\n\n\u003ch1 id=\"details\"\u003eDetails\u003c/h1\u003e\n\n\u003cp\u003eInspired by \u003ca href=\"/reports/381192\"\u003e#381192\u003c/a\u003e, I decided to check all pages to see if there\u0026#39;s any broken origin validation. The results were frustrating since they all seemed to be done properly. However I noticed embedded apps did it in a way that it verifies if the coming origin is the logged-in store. Say if I am an admin on foobar.myshopify.com, then an embedded app will check if in-coming messages originate from \u003ca title=\"https://foobar.myshopify.com\" href=\"/redirect?url=https%3A%2F%2Ffoobar.myshopify.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://foobar.myshopify.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. I went ahead to look up some \u003ca href=\"/redirect?url=https%3A%2F%2Fhelp.shopify.com%2Fen%2Fapi%2Fembedded-apps%2Fembedded-app-sdk%2Finitialization\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003edocumentations\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, confirming this is by design (\u003ccode\u003eshopOrigin\u003c/code\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eShopifyApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eshopOrigin\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003ehttps://CURRENT_LOGGED_IN_SHOP.myshopify.com\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e[...]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow this is interesting because by design we can execute any JavaScript on our own stores. That means, I can iframe an embedded app on my store, then post any message to it and it will accept it. So I quickly beautify the SDK source code to see if there\u0026#39;s any interesting event. Checking common DOMXSS sinks I found that it registers the \u003ccode\u003eShopify.API.setWindowLocation\u003c/code\u003e event that navigates to a said destination.\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://cdn.shopify.com/s/assets/external/app.js\" href=\"/redirect?url=https%3A%2F%2Fcdn.shopify.com%2Fs%2Fassets%2Fexternal%2Fapp.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://cdn.shopify.com/s/assets/external/app.js\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetWindowLocation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elocation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\n\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebindWindowLocation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003e_Shopify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eMessenger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eShopify.API.setWindowLocation\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetWindowLocation\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBy navigate to a \u003cem\u003ejavascript:\u003c/em\u003e pseudo URL it can lead to XSS. This can be verified by opening any embedded apps and execute the following code in the DevTools\u0026#39; console\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003e$$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003eiframe\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003econtentWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e{\u0026quot;message\u0026quot;:\u0026quot;Shopify.API.setWindowLocation\u0026quot;,\u0026quot;data\u0026quot;:\u0026quot;javascript:alert(document.domain);0[0]\u0026quot;}\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e*\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screen_Shot_2018-10-10_at_2.58.16_PM.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/358/299/9053ddf265ccf985ec5ce584ce4e23d8e61e7c40/Screen_Shot_2018-10-10_at_2.58.16_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-10-10_at_2.58.16_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-10-10_at_2.58.16_PM.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQTYNHLLAI%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T055539Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHZ%2BW3HUv1n%2B6aR51XKyQUoltUs4dpenL8C5Ngq%2FaRRRAiEAmfsKW6s44zslbtLbjio7lyByPFrM4HhkqWc4BlKqI%2FsqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDEk2ujSH9wgIeNJFfSqRA5L87pajd4uBiMOahwiQWY9MCcYfdnrcw1IGaRg5TpxW7DR87N3npEJ347tYQoNG4qvz83ZIfPJaoV16%2BHSbvgHCloy0L2IJebFkXavQ%2FqP76i9C%2Fflz0T%2FAY7BQexVBAB81BDbhmxnE9q9peEXcv7DxPs6yUKcdy540RKUrN7uslxSA7j3G9JiTuJ6qb2%2F4wYsuXqZAjjjsCgg1mXnpWD2MBpvjLmy20fnWfTyEpbZx69BhUOjIiXGUwMwyU3vIR8mTDDVd0lLxGqVwqo7wgDElekHdTEW3qhMPXMlt6DlI6yj8Gdba%2FBl9Vc01EccnsQcPWyVJry%2FS5ynL9DMtJAAAFirbxDGfh3YyQKCitVKKFFQ%2BXcUVp%2FSwwBBOTy19C2elhYtpl6vcpcY0%2FpxhMV%2FLT11lv%2FW2w21ED7vsm1c%2FDgyMyGhcc5jxtzWgSuplAxsWTwQc5B1WrLELk6MdDLXcvxB6lqSlYR3jek%2FEqa3e3t%2FxycmED7JcchnTpltDpgBiVe4qfO%2B85c9LeAT9plTAMKDqqv8FOusBsw37kCqQM4gZ7GwocFGWO%2Bb%2BbNa2dgEi%2Fv9cXsb1AOYUnwz%2B%2FyPyUSoTx0mdn2JtBFbkLI2hWmV1Y9Plg4ywi43mIKFY5BXMieUzgwCaeF0glcm8O%2F5kugCvuf01QuIauHjpwGSFMitZi1h52iDxD6TQNrXkM8ak7hW52tsH0VpvrBIvM3fFeRl4cr81y%2FuM3ueoyxszwreZZnbZK4WIuk8LU9YhohKDj6BRCCLOA1ZWZip14mKPOWPa8WaAzVovmI9BYDR0AxC4M%2FMywNMPj4r12n4DpTYCcHFvsA18GtoCtKML64R8uPhkQw%3D%3D\u0026amp;X-Amz-Signature=757e133540ffc5711917266737c631308b25180674231513dbc361e2451e6b84\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/358/299/9053ddf265ccf985ec5ce584ce4e23d8e61e7c40/Screen_Shot_2018-10-10_at_2.58.16_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-10-10_at_2.58.16_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-10-10_at_2.58.16_PM.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQTYNHLLAI%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T055539Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHZ%2BW3HUv1n%2B6aR51XKyQUoltUs4dpenL8C5Ngq%2FaRRRAiEAmfsKW6s44zslbtLbjio7lyByPFrM4HhkqWc4BlKqI%2FsqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDEk2ujSH9wgIeNJFfSqRA5L87pajd4uBiMOahwiQWY9MCcYfdnrcw1IGaRg5TpxW7DR87N3npEJ347tYQoNG4qvz83ZIfPJaoV16%2BHSbvgHCloy0L2IJebFkXavQ%2FqP76i9C%2Fflz0T%2FAY7BQexVBAB81BDbhmxnE9q9peEXcv7DxPs6yUKcdy540RKUrN7uslxSA7j3G9JiTuJ6qb2%2F4wYsuXqZAjjjsCgg1mXnpWD2MBpvjLmy20fnWfTyEpbZx69BhUOjIiXGUwMwyU3vIR8mTDDVd0lLxGqVwqo7wgDElekHdTEW3qhMPXMlt6DlI6yj8Gdba%2FBl9Vc01EccnsQcPWyVJry%2FS5ynL9DMtJAAAFirbxDGfh3YyQKCitVKKFFQ%2BXcUVp%2FSwwBBOTy19C2elhYtpl6vcpcY0%2FpxhMV%2FLT11lv%2FW2w21ED7vsm1c%2FDgyMyGhcc5jxtzWgSuplAxsWTwQc5B1WrLELk6MdDLXcvxB6lqSlYR3jek%2FEqa3e3t%2FxycmED7JcchnTpltDpgBiVe4qfO%2B85c9LeAT9plTAMKDqqv8FOusBsw37kCqQM4gZ7GwocFGWO%2Bb%2BbNa2dgEi%2Fv9cXsb1AOYUnwz%2B%2FyPyUSoTx0mdn2JtBFbkLI2hWmV1Y9Plg4ywi43mIKFY5BXMieUzgwCaeF0glcm8O%2F5kugCvuf01QuIauHjpwGSFMitZi1h52iDxD6TQNrXkM8ak7hW52tsH0VpvrBIvM3fFeRl4cr81y%2FuM3ueoyxszwreZZnbZK4WIuk8LU9YhohKDj6BRCCLOA1ZWZip14mKPOWPa8WaAzVovmI9BYDR0AxC4M%2FMywNMPj4r12n4DpTYCcHFvsA18GtoCtKML64R8uPhkQw%3D%3D\u0026amp;X-Amz-Signature=757e133540ffc5711917266737c631308b25180674231513dbc361e2451e6b84\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eHowever this XSS is almost useless\u003c/strong\u003e because the embedded app is authenticated as us, the attacker. When we try to exploit it on a victim it won\u0026#39;t work because they are not logged into our store. So you could say this is, a self DOMXSS. Well, almost. \u003c/p\u003e\n\n\u003cp\u003eWhat if we use Login CSRF to force a victim to be logged into our store? After the victim is logged in to our store, we can then instruct user\u0026#39;s browser to log into the embedded app as us by navigating to \u003ccode\u003e/admin/oauth/authorize\u003c/code\u003e. Then the current logged in store will be ours. I came up with an idea to stuff the session cookies using JavaScript.\u003c/p\u003e\n\n\u003cp\u003eThe session cookies consist of \u003ccode\u003e_secure_admin_session_id\u003c/code\u003e and \u003ccode\u003e_master_udr\u003c/code\u003e. While I could simply write \u003ccode\u003e_secure_admin_session_id\u003c/code\u003e with \u003ccode\u003edocuemnt.cookie\u003c/code\u003e API, I realized a problem with \u003ccode\u003e_master_udr\u003c/code\u003e. Unlike \u003ccode\u003e_secure_admin_session_id\u003c/code\u003e, \u003ccode\u003e_master_udr\u003c/code\u003e is scoped to \u003ccode\u003e.myshopify.com\u003c/code\u003e. If we triy to write our \u003ccode\u003e_master_udr\u003c/code\u003e, then this will happen:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight http\"\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003eGET\u003c/span\u003e \u003cspan class=\"nn\"\u003ehttps://canvasfoobar.myshopify.com/admin/oauth/authorize?client_id=d25e45407e508f96409c2dd796e9bd95\u0026amp;redirect_uri=https%3A%2F%2Fscript-editor.shopifycloud.com%2Fauth%2Fshopify%2Fcallback\u0026amp;response_type=code\u0026amp;scope=write_scripts%2Cread_products%2Cread_customers\u0026amp;state=a\u003c/span\u003e \u003cspan class=\"k\"\u003eHTTP\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e1.1\u003c/span\u003e\n\u003cspan class=\"na\"\u003eHost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecanvasfoobar.myshopify.com\u003c/span\u003e\n\u003cspan class=\"na\"\u003eCookie\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e_master_udr=LEGIT; _master_udr=EVIL; _secure_admin_session_id=EVIL\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe legitimate \u003ccode\u003e_master_udr\u003c/code\u003e will override our evil one and the server will refuse to authenticate as us. There is a trick fortunately. \u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e“Cookies with longer paths are listed before cookies with shorter paths.” –RFC 6265\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eBy setting a cookie with a very specific (\u003ccode\u003e/admin/oauth\u003c/code\u003e in this case) we can outrun the original one. The code that we will use to force a login will be:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecookie\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e_secure_admin_session_id=EVIL;path=/admin/oauth\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecookie\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e_master_udr=EVIL;path=/admin/oauth\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnother problem is even after all this, the victim will be logged into the embedded app \u003cstrong\u003eas us\u003c/strong\u003e. That means, all actions only affect our store. \u003c/p\u003e\n\n\u003cp\u003eTo solve this we can simply relog in the victim to the embedded app. Since the victim is still logged in their store, we can navigate the victim to \u003ca title=\"https://victim.myshopify.com/admin/oauth/authorize\" href=\"/redirect?url=https%3A%2F%2Fvictim.myshopify.com%2Fadmin%2Foauth%2Fauthorize\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://victim.myshopify.com/admin/oauth/authorize\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to trigger the auth flow for the embedded app. The drawback is we need to know which store the victim is logged in as. Luckily \u003ca title=\"https://www.shopify.com/path\" href=\"/redirect?url=https%3A%2F%2Fwww.shopify.com%2Fpath\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.shopify.com/path\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e will redirect to the last logged in store of a user, therefore navigating to \u003ca title=\"https://www.shopify.com/admin/oauth/authorize\" href=\"/redirect?url=https%3A%2F%2Fwww.shopify.com%2Fadmin%2Foauth%2Fauthorize\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.shopify.com/admin/oauth/authorize\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e will lead them to \u003ca title=\"https://victim.myshopify.com/admin/oauth/authorize\" href=\"/redirect?url=https%3A%2F%2Fvictim.myshopify.com%2Fadmin%2Foauth%2Fauthorize\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://victim.myshopify.com/admin/oauth/authorize\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eEventually we have our XSS running on the embedded app\u0026#39;s domain running with the victim\u0026#39;s session.\u003c/p\u003e\n\n\u003ch1 id=\"steps-to-reproduce\"\u003eSteps to Reproduce\u003c/h1\u003e\n\n\u003cp\u003eIn the PoC, Script Editor will be used as an example.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eBe logged into your store as an admin and have \u003ca href=\"/redirect?url=https%3A%2F%2Fapps.shopify.com%2Fscript-editor\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eScript Editor\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e installed\u003c/li\u003e\n\u003cli\u003eNavigate to \u003ca title=\"https://canvasfoobar.myshopify.com/products/canary\" href=\"/redirect?url=https%3A%2F%2Fcanvasfoobar.myshopify.com%2Fproducts%2Fcanary\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://canvasfoobar.myshopify.com/products/canary\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eAfter the iframe turns grey, click it\u003c/li\u003e\n\u003cli\u003eAfter a while, a fake modal dialog will show up and a \u003cem\u003eNew Script\u003c/em\u003e will be created\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eI\u0026#39;m also attaching a video demo.\u003c/p\u003e\n\n\u003ch1 id=\"fix\"\u003eFix\u003c/h1\u003e\n\n\u003cp\u003eI recommend fixing this issue by validating the URL for \u003ccode\u003eShopify.API.setWindowLocation\u003c/code\u003e. The other small issues are by design so they are hard to fix.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003ePerform unauthorized actions on a store admin on any embedded apps.\u003c/p\u003e\n","bounty_amount":"5000.0","formatted_bounty":"$5,000","weakness":{"id":63,"name":"Cross-site Scripting (XSS) - DOM"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":358299,"file_name":"Screen_Shot_2018-10-10_at_2.58.16_PM.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/358/299/9053ddf265ccf985ec5ce584ce4e23d8e61e7c40/Screen_Shot_2018-10-10_at_2.58.16_PM.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2018-10-10_at_2.58.16_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2018-10-10_at_2.58.16_PM.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTYNHLLAI%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055539Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHZ%2BW3HUv1n%2B6aR51XKyQUoltUs4dpenL8C5Ngq%2FaRRRAiEAmfsKW6s44zslbtLbjio7lyByPFrM4HhkqWc4BlKqI%2FsqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDEk2ujSH9wgIeNJFfSqRA5L87pajd4uBiMOahwiQWY9MCcYfdnrcw1IGaRg5TpxW7DR87N3npEJ347tYQoNG4qvz83ZIfPJaoV16%2BHSbvgHCloy0L2IJebFkXavQ%2FqP76i9C%2Fflz0T%2FAY7BQexVBAB81BDbhmxnE9q9peEXcv7DxPs6yUKcdy540RKUrN7uslxSA7j3G9JiTuJ6qb2%2F4wYsuXqZAjjjsCgg1mXnpWD2MBpvjLmy20fnWfTyEpbZx69BhUOjIiXGUwMwyU3vIR8mTDDVd0lLxGqVwqo7wgDElekHdTEW3qhMPXMlt6DlI6yj8Gdba%2FBl9Vc01EccnsQcPWyVJry%2FS5ynL9DMtJAAAFirbxDGfh3YyQKCitVKKFFQ%2BXcUVp%2FSwwBBOTy19C2elhYtpl6vcpcY0%2FpxhMV%2FLT11lv%2FW2w21ED7vsm1c%2FDgyMyGhcc5jxtzWgSuplAxsWTwQc5B1WrLELk6MdDLXcvxB6lqSlYR3jek%2FEqa3e3t%2FxycmED7JcchnTpltDpgBiVe4qfO%2B85c9LeAT9plTAMKDqqv8FOusBsw37kCqQM4gZ7GwocFGWO%2Bb%2BbNa2dgEi%2Fv9cXsb1AOYUnwz%2B%2FyPyUSoTx0mdn2JtBFbkLI2hWmV1Y9Plg4ywi43mIKFY5BXMieUzgwCaeF0glcm8O%2F5kugCvuf01QuIauHjpwGSFMitZi1h52iDxD6TQNrXkM8ak7hW52tsH0VpvrBIvM3fFeRl4cr81y%2FuM3ueoyxszwreZZnbZK4WIuk8LU9YhohKDj6BRCCLOA1ZWZip14mKPOWPa8WaAzVovmI9BYDR0AxC4M%2FMywNMPj4r12n4DpTYCcHFvsA18GtoCtKML64R8uPhkQw%3D%3D\u0026X-Amz-Signature=757e133540ffc5711917266737c631308b25180674231513dbc361e2451e6b84","file_size":620672,"type":"image/png"},{"id":358371,"file_name":"shopify-embedded-sdk-xss.mov","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/358/371/636ea233f743e0a375d6ccde40d2abdc68eb2083/shopify-embedded-sdk-xss.mov?response-content-disposition=attachment%3B%20filename%3D%22shopify-embedded-sdk-xss.mov%22%3B%20filename%2A%3DUTF-8%27%27shopify-embedded-sdk-xss.mov\u0026response-content-type=video%2Fquicktime\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTYNHLLAI%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T055539Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHZ%2BW3HUv1n%2B6aR51XKyQUoltUs4dpenL8C5Ngq%2FaRRRAiEAmfsKW6s44zslbtLbjio7lyByPFrM4HhkqWc4BlKqI%2FsqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDEk2ujSH9wgIeNJFfSqRA5L87pajd4uBiMOahwiQWY9MCcYfdnrcw1IGaRg5TpxW7DR87N3npEJ347tYQoNG4qvz83ZIfPJaoV16%2BHSbvgHCloy0L2IJebFkXavQ%2FqP76i9C%2Fflz0T%2FAY7BQexVBAB81BDbhmxnE9q9peEXcv7DxPs6yUKcdy540RKUrN7uslxSA7j3G9JiTuJ6qb2%2F4wYsuXqZAjjjsCgg1mXnpWD2MBpvjLmy20fnWfTyEpbZx69BhUOjIiXGUwMwyU3vIR8mTDDVd0lLxGqVwqo7wgDElekHdTEW3qhMPXMlt6DlI6yj8Gdba%2FBl9Vc01EccnsQcPWyVJry%2FS5ynL9DMtJAAAFirbxDGfh3YyQKCitVKKFFQ%2BXcUVp%2FSwwBBOTy19C2elhYtpl6vcpcY0%2FpxhMV%2FLT11lv%2FW2w21ED7vsm1c%2FDgyMyGhcc5jxtzWgSuplAxsWTwQc5B1WrLELk6MdDLXcvxB6lqSlYR3jek%2FEqa3e3t%2FxycmED7JcchnTpltDpgBiVe4qfO%2B85c9LeAT9plTAMKDqqv8FOusBsw37kCqQM4gZ7GwocFGWO%2Bb%2BbNa2dgEi%2Fv9cXsb1AOYUnwz%2B%2FyPyUSoTx0mdn2JtBFbkLI2hWmV1Y9Plg4ywi43mIKFY5BXMieUzgwCaeF0glcm8O%2F5kugCvuf01QuIauHjpwGSFMitZi1h52iDxD6TQNrXkM8ak7hW52tsH0VpvrBIvM3fFeRl4cr81y%2FuM3ueoyxszwreZZnbZK4WIuk8LU9YhohKDj6BRCCLOA1ZWZip14mKPOWPa8WaAzVovmI9BYDR0AxC4M%2FMywNMPj4r12n4DpTYCcHFvsA18GtoCtKML64R8uPhkQw%3D%3D\u0026X-Amz-Signature=cac26d2a729bc9196dc8d02d4cdd4e3c91707aee17c7a2abe834f10df943206f","file_size":18042055,"type":"video/quicktime"}],"allow_singular_disclosure_at":null,"vote_count":180,"voters":["overjt","yxw21","bulbu1play3r","pomme","str0k1rch","apogiatzis","inhibitor181","bl4de","kedrisch-4-t","nightranger","and 170 more..."],"severity":{"rating":"high","score":8.1,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":413,"asset_type":"URL","asset_identifier":"your-store.myshopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3459792,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Note: You need to refresh the page to see the added script reflected.","markdown_message":"\u003cp\u003eNote: You need to refresh the page to see the added script reflected.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-10T09:33:48.623Z","updated_at":"2018-10-10T09:33:48.623Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3459903,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"To avoid confusion, user interaction and the modal dialog are unnecessary. They are to show the steps and what can be done (interacting with victim's admin panel) and is easier for constructing a PoC.","markdown_message":"\u003cp\u003eTo avoid confusion, user interaction and the modal dialog are unnecessary. They are to show the steps and what can be done (interacting with victim\u0026#39;s admin panel) and is easier for constructing a PoC.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-10T10:01:11.127Z","updated_at":"2018-10-10T10:01:11.127Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3475757,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-13T16:12:28.142Z","updated_at":"2018-10-13T16:12:28.142Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"2500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"filedescriptor","url":"/filedescriptor"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3475759,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @filedescriptor!\nThank you for your report, and the great demonstration of impact from this bug. Since this issue allows attacking legitimate users of embedded apps, we have decided to award $2500 for this issue.","markdown_message":"\u003cp\u003eHey \u003ca href=\"/filedescriptor\"\u003e@filedescriptor\u003c/a\u003e!\u003cbr\u003e\nThank you for your report, and the great demonstration of impact from this bug. Since this issue allows attacking legitimate users of embedded apps, we have decided to award $2500 for this issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-13T16:12:58.145Z","updated_at":"2018-10-13T16:12:58.145Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3475763,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-13T16:13:58.925Z","updated_at":"2018-10-13T16:13:58.925Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3477013,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-14T01:31:49.393Z","updated_at":"2018-10-14T01:31:49.393Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"2500.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"filedescriptor","url":"/filedescriptor"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3712225,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-26T20:58:29.971Z","updated_at":"2018-11-26T20:58:29.971Z","additional_data":{"old_severity":null,"new_severity":"High (8.1)","old_severity_id":null,"new_severity_id":249995},"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4578559,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @filedescriptor!\nApologies for the wait with resolving this report. We have deployed a fix that restricts `SetWindowLocation` to http/https, so you should no longer be able to reproduce this issue. Thanks again for the great find and the detailed report. We're looking forward to more reports from you!","markdown_message":"\u003cp\u003eHey \u003ca href=\"/filedescriptor\"\u003e@filedescriptor\u003c/a\u003e!\u003cbr\u003e\nApologies for the wait with resolving this report. We have deployed a fix that restricts \u003ccode\u003eSetWindowLocation\u003c/code\u003e to http/https, so you should no longer be able to reproduce this issue. Thanks again for the great find and the detailed report. We\u0026#39;re looking forward to more reports from you!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-04-16T21:37:03.454Z","updated_at":"2019-04-16T21:37:03.454Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4579738,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-17T04:29:44.501Z","updated_at":"2019-04-17T04:29:44.501Z","first_to_agree":true,"actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4584446,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-17T14:40:38.280Z","updated_at":"2019-04-17T14:40:38.280Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4584448,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-17T14:40:38.516Z","updated_at":"2019-04-17T14:40:38.516Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":7147448,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-25T14:53:36.780Z","updated_at":"2020-02-25T14:53:36.780Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"your-store.myshopify.com","genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":11055,"category":"team","content":"During H1-514, @filedescriptor reported an XSS issue in our Embedded App SDK that allowed for attacking legitimate apps through our platform, due to a missing protocol check on the Shopify.API.setWindowLocation. Since this issue would have allowed realistic attacks against apps using the Embedded App SDK, we decided to award $2500 for this issue. As part of the event, @filedescriptor was also awarded a bonus of $2500 for chaining multiple bugs.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eDuring H1-514, \u003ca href=\"/filedescriptor\"\u003e@filedescriptor\u003c/a\u003e reported an XSS issue in our Embedded App SDK that allowed for attacking legitimate apps through our platform, due to a missing protocol check on the Shopify.API.setWindowLocation. Since this issue would have allowed realistic attacks against apps using the Embedded App SDK, we decided to award $2500 for this issue. As part of the event, \u003ca href=\"/filedescriptor\"\u003e@filedescriptor\u003c/a\u003e was also awarded a bonus of $2500 for chaining multiple bugs.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}