{"id":281336,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yODEzMzY=","url":"https://hackerone.com/reports/281336","title":"Negative size in tar header causes infinite loop","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2017-10-21T03:56:09.259Z","submitted_at":"2017-10-21T03:56:09.259Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"plover","url":"/plover","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8212,"url":"https://hackerone.com/rubygems","handle":"rubygems","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"RubyGems","twitter_handle":"rubygems_status","website":"https://rubygems.org","about":"RubyGems.org is the Ruby community’s gem hosting service."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-03-01T05:47:32.276Z","bug_reporter_agreed_on_going_public_at":"2018-02-18T04:53:49.327Z","team_member_agreed_on_going_public_at":"2018-03-01T05:47:32.186Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Proof of concept\n\nThe attached file loop.gem causes an infinite loop in any command that tries to iterate over the entries in the tar container.\n```\ngem install loop.gem\ngem unpack loop.gem\ngem specification loop.gem\n```\n\n# Summary\n\n[`Gem::Package::TarHeader.from`](https://github.com/rubygems/rubygems/blob/v2.6.14/lib/rubygems/package/tar_header.rb#L97-L124) uses [`oct`](https://ruby-doc.org/core-2.4.2/String.html#method-i-oct) to parse fields in the tar header. `oct` does more than just parse octal digits, for example it permits these unexpected syntaxes:\n- sign characters:\n  - `\"+012345\".oct # 5349`\n  - `\"-012345\".oct # -5349`\n- radix prefixes:\n  - `\"0x12abc\".oct # 76476`\n  - `\"0b10000\".oct # 16`\n- silently ignoring errors:\n  - `\"123,456\".oct # 83`\n  - `\"nothing\".oct # 0`\n\nThe ability to encode negative values enables a DoS (infinite loop) in the tar reader. The proof-of-concept loop.gem has a size field of `-0000001000\\x00`, or −512. The negative size causes [`Gem::Package::TarReader.each`](https://github.com/rubygems/rubygems/blob/v2.6.14/lib/rubygems/package/tar_reader.rb#L52) to seek *backwards* after reading the header, so it reads the same header over and over.\n\nI suppose one could cause a lot of CPU usage on the rubygems.org server by uploading copies of loop.gem, but I didn't try it.\n\n# Remediation\n\nInstead of doing the conversion using `oct`, there could be a special-purpose function that validates its input better. It might be enough to check that the string matches `/\\A[0-7]+\\z/` before calling `oct`.\n\nThe attached patch file adds a test that `Gem::Package::TarHeader.from` rejects various bogus syntax.\n","vulnerability_information_html":"\u003ch1 id=\"proof-of-concept\"\u003eProof of concept\u003c/h1\u003e\n\n\u003cp\u003eThe attached file loop.gem causes an infinite loop in any command that tries to iterate over the entries in the tar container.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003egem install loop.gem\ngem unpack loop.gem\ngem specification loop.gem\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"summary\"\u003eSummary\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Frubygems%2Frubygems%2Fblob%2Fv2.6.14%2Flib%2Frubygems%2Fpackage%2Ftar_header.rb%23L97-L124\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e\u003ccode\u003eGem::Package::TarHeader.from\u003c/code\u003e\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e uses \u003ca href=\"/redirect?url=https%3A%2F%2Fruby-doc.org%2Fcore-2.4.2%2FString.html%23method-i-oct\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e\u003ccode\u003eoct\u003c/code\u003e\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to parse fields in the tar header. \u003ccode\u003eoct\u003c/code\u003e does more than just parse octal digits, for example it permits these unexpected syntaxes:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003esign characters:\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e\u0026quot;+012345\u0026quot;.oct # 5349\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026quot;-012345\u0026quot;.oct # -5349\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eradix prefixes:\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e\u0026quot;0x12abc\u0026quot;.oct # 76476\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026quot;0b10000\u0026quot;.oct # 16\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003esilently ignoring errors:\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e\u0026quot;123,456\u0026quot;.oct # 83\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e\u0026quot;nothing\u0026quot;.oct # 0\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe ability to encode negative values enables a DoS (infinite loop) in the tar reader. The proof-of-concept loop.gem has a size field of \u003ccode\u003e-0000001000\\x00\u003c/code\u003e, or −512. The negative size causes \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Frubygems%2Frubygems%2Fblob%2Fv2.6.14%2Flib%2Frubygems%2Fpackage%2Ftar_reader.rb%23L52\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e\u003ccode\u003eGem::Package::TarReader.each\u003c/code\u003e\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to seek \u003cem\u003ebackwards\u003c/em\u003e after reading the header, so it reads the same header over and over.\u003c/p\u003e\n\n\u003cp\u003eI suppose one could cause a lot of CPU usage on the rubygems.org server by uploading copies of loop.gem, but I didn\u0026#39;t try it.\u003c/p\u003e\n\n\u003ch1 id=\"remediation\"\u003eRemediation\u003c/h1\u003e\n\n\u003cp\u003eInstead of doing the conversion using \u003ccode\u003eoct\u003c/code\u003e, there could be a special-purpose function that validates its input better. It might be enough to check that the string matches \u003ccode\u003e/\\A[0-7]+\\z/\u003c/code\u003e before calling \u003ccode\u003eoct\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe attached patch file adds a test that \u003ccode\u003eGem::Package::TarHeader.from\u003c/code\u003e rejects various bogus syntax.\u003c/p\u003e\n","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":231296,"file_name":"loop.gem","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/231/296/b1b95f412814ad8eba0bce747653e11109cec4f6/loop.gem?response-content-disposition=attachment%3B%20filename%3D%22loop.gem%22%3B%20filename%2A%3DUTF-8%27%27loop.gem\u0026response-content-type=application%2Fx-tar\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052224Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=c9e188f54b59f959dfea9f21c0eba9db49ad3e725e509f093156177f2aa79af6","file_size":512,"type":"application/x-tar"},{"id":231297,"file_name":"0001-Test-that-Gem-Package-TarHeader.from-refuses-to-pars.patch","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/231/297/fa9ef1fef061e719a298c689d5c9730193127923/0001-Test-that-Gem-Package-TarHeader.from-refuses-to-pars.patch?response-content-disposition=attachment%3B%20filename%3D%220001-Test-that-Gem-Package-TarHeader.from-refuses-to-pars.patch%22%3B%20filename%2A%3DUTF-8%27%270001-Test-that-Gem-Package-TarHeader.from-refuses-to-pars.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052224Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=0989e50b8a43a6020853f6198fdfc2a9a62f40e4ce1d056f81cb8f536847e619","file_size":1411,"type":"text/x-diff"}],"allow_singular_disclosure_at":"2018-03-20T04:53:49.416Z","allow_singular_disclosure_after":-87697715.19340333,"singular_disclosure_allowed":true,"vote_count":7,"voters":["eveeez","apapedulimu","japz","sumit7","666reda","geotester","03813136"],"severity":{"rating":"low","author_type":"User"},"structured_scope":{"databaseId":2043,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/rubygems/rubygems","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2090857,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for submitting this report to RubyGems. Our team will review and investigate the issue. Please note that only issues in the rubygems library are eligible for our bug bounty program.","markdown_message":"\u003cp\u003eThanks for submitting this report to RubyGems. Our team will review and investigate the issue. Please note that only issues in the rubygems library are eligible for our bug bounty program.\u003c/p\u003e\n","automated_response":true,"created_at":"2017-10-21T03:56:09.539Z","updated_at":"2017-10-21T03:56:09.539Z","actor":{"url":"/rubygems","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"RubyGems"}},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2093668,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@plover thanks for reporting this!  One of us will come up with a patch and propose it here for you to review.  Thank you!","markdown_message":"\u003cp\u003e\u003ca href=\"/plover\"\u003e@plover\u003c/a\u003e thanks for reporting this!  One of us will come up with a patch and propose it here for you to review.  Thank you!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-10-22T22:48:12.590Z","updated_at":"2017-10-22T22:48:12.590Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2095716,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@plover I think the attached patch should do the trick, if you'd care to review it? Thanks for the test case :)","markdown_message":"\u003cp\u003e\u003ca href=\"/plover\"\u003e@plover\u003c/a\u003e I think the attached patch should do the trick, if you\u0026#39;d care to review it? Thanks for the test case :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-10-23T15:47:16.104Z","updated_at":"2017-10-23T15:47:16.104Z","actor":{"username":"segiddins","cleared":false,"url":"/segiddins","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":231981,"filename":"fix.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/231/981/8b79e5485ba8e354cf4de4d2e81d83042ff56f1f/fix.patch?response-content-disposition=attachment%3B%20filename%3D%22fix.patch%22%3B%20filename%2A%3DUTF-8%27%27fix.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052224Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=631d1a6ea22b52ef95123de5d9b8d8c3cfad9c7aaec2e18540f3a31dfd3d1a0f"}],"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2096196,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The `strict_oct` fix looks good to me.\n\nIt might be a good idea to add an additional check for `size \u003e= 0` in [`Gem::Package::TarReader.each`](https://github.com/rubygems/rubygems/blob/v2.6.14/lib/rubygems/package/tar_reader.rb#L52), on top of the check for correct octal syntax. The reason I suggest that is that it seems that tar also supports a twos'-complement binary encoding for fields, which can also encode negative values. `TarHeader` doesn't support that encoding, but if it were added in the future, then the code could become vulnerable again. I only found out about the binary encoding when I was looking at how Go's archive/tar package works: https://github.com/golang/go/blob/083338cb976763e7a77e787827b24228fbaa7bf3/src/archive/tar/strconv.go#L93\n\nI'm attaching a modified test case that separately tests each kind of bad syntax. The test code I included before would pass if *any* of the bad cases was caught; this patch requires *all* the bad cases to be caught. It might be worth further adapting the test case so that it tests every octal field (as it is, it only tests the size).","markdown_message":"\u003cp\u003eThe \u003ccode\u003estrict_oct\u003c/code\u003e fix looks good to me.\u003c/p\u003e\n\n\u003cp\u003eIt might be a good idea to add an additional check for \u003ccode\u003esize \u0026gt;= 0\u003c/code\u003e in \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Frubygems%2Frubygems%2Fblob%2Fv2.6.14%2Flib%2Frubygems%2Fpackage%2Ftar_reader.rb%23L52\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e\u003ccode\u003eGem::Package::TarReader.each\u003c/code\u003e\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, on top of the check for correct octal syntax. The reason I suggest that is that it seems that tar also supports a twos\u0026#39;-complement binary encoding for fields, which can also encode negative values. \u003ccode\u003eTarHeader\u003c/code\u003e doesn\u0026#39;t support that encoding, but if it were added in the future, then the code could become vulnerable again. I only found out about the binary encoding when I was looking at how Go\u0026#39;s archive/tar package works: \u003ca title=\"https://github.com/golang/go/blob/083338cb976763e7a77e787827b24228fbaa7bf3/src/archive/tar/strconv.go#L93\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fblob%2F083338cb976763e7a77e787827b24228fbaa7bf3%2Fsrc%2Farchive%2Ftar%2Fstrconv.go%23L93\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/golang/go/blob/083338cb976763e7a77e787827b24228fbaa7bf3/src/archive/tar/strconv.go#L93\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m attaching a modified test case that separately tests each kind of bad syntax. The test code I included before would pass if \u003cem\u003eany\u003c/em\u003e of the bad cases was caught; this patch requires \u003cem\u003eall\u003c/em\u003e the bad cases to be caught. It might be worth further adapting the test case so that it tests every octal field (as it is, it only tests the size).\u003c/p\u003e\n","automated_response":false,"created_at":"2017-10-23T17:59:42.607Z","updated_at":"2017-10-23T17:59:42.607Z","actor":{"username":"plover","cleared":false,"url":"/plover","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":232032,"filename":"fix2.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/232/032/2825102fb2d69fa48b6e53b097e2efa1fdd7e914/fix2.patch?response-content-disposition=attachment%3B%20filename%3D%22fix2.patch%22%3B%20filename%2A%3DUTF-8%27%27fix2.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052224Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=e26ce069bb001f458bfa84dcba019248f5e36822ba18899727357b3adc373b64"}],"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2295276,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-18T15:08:19.099Z","updated_at":"2018-01-18T15:08:19.099Z","actor":{"username":"dwradcliffe","cleared":false,"url":"/dwradcliffe","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/082/355/821154e381fe27d2273bc54a18049a3a87e1591d_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2373631,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks! going to queue this up for our next security release","markdown_message":"\u003cp\u003eThanks! going to queue this up for our next security release\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-12T05:50:43.475Z","updated_at":"2018-02-12T05:50:43.475Z","actor":{"username":"segiddins","cleared":false,"url":"/segiddins","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2373641,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This patch actually breaks a bunch of tests -- I think we might need to allow the entirely nul padded case to continue to be interpreted as 0","markdown_message":"\u003cp\u003eThis patch actually breaks a bunch of tests -- I think we might need to allow the entirely nul padded case to continue to be interpreted as 0\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-12T05:57:24.443Z","updated_at":"2018-02-12T05:57:24.443Z","actor":{"username":"segiddins","cleared":false,"url":"/segiddins","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2395718,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This bug was fixed in RubyGems 2.7.6\n\nhttp://blog.rubygems.org/2018/02/15/2.7.6-released.html\n\nThanks!","markdown_message":"\u003cp\u003eThis bug was fixed in RubyGems 2.7.6\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"http://blog.rubygems.org/2018/02/15/2.7.6-released.html\" href=\"/redirect?url=http%3A%2F%2Fblog.rubygems.org%2F2018%2F02%2F15%2F2.7.6-released.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://blog.rubygems.org/2018/02/15/2.7.6-released.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-18T04:40:20.501Z","updated_at":"2018-02-18T04:40:20.501Z","actor":{"username":"claudijd","cleared":false,"url":"/claudijd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/131/3c373767fbd4f34648ab754b0f692fb718bfb8e5_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"plover","url":"/plover"},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2395719,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-18T04:40:28.151Z","updated_at":"2018-02-18T04:40:28.151Z","actor":{"url":"/rubygems","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/212/e65eca09896d23bc029c08d3147a79a48ec1ee2f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"RubyGems"}},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2395734,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-18T04:53:49.371Z","updated_at":"2018-02-18T04:53:49.371Z","first_to_agree":true,"actor":{"username":"plover","cleared":false,"url":"/plover","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2395873,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Credit for this bug also goes to Nathan Malkin (nmalkin). We were working as a team.","markdown_message":"\u003cp\u003eCredit for this bug also goes to Nathan Malkin (nmalkin). We were working as a team.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-18T06:33:21.781Z","updated_at":"2018-02-18T06:33:21.781Z","actor":{"username":"plover","cleared":false,"url":"/plover","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2445048,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@plover for credit modifications, since it's an open source blog, you can send PR requests to our blog, similar to how I did [here](https://github.com/rubygems/rubygems.github.io/pull/31)","markdown_message":"\u003cp\u003e\u003ca href=\"/plover\"\u003e@plover\u003c/a\u003e for credit modifications, since it\u0026#39;s an open source blog, you can send PR requests to our blog, similar to how I did \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Frubygems%2Frubygems.github.io%2Fpull%2F31\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehere\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-03-01T05:46:27.283Z","updated_at":"2018-03-01T05:46:27.283Z","actor":{"username":"claudijd","cleared":false,"url":"/claudijd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/131/3c373767fbd4f34648ab754b0f692fb718bfb8e5_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2445049,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-01T05:47:32.224Z","updated_at":"2018-03-01T05:47:32.224Z","actor":{"username":"claudijd","cleared":false,"url":"/claudijd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/131/3c373767fbd4f34648ab754b0f692fb718bfb8e5_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2445050,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-01T05:47:32.306Z","updated_at":"2018-03-01T05:47:32.306Z","actor":{"username":"claudijd","cleared":false,"url":"/claudijd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/131/3c373767fbd4f34648ab754b0f692fb718bfb8e5_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rubygems","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}