{"id":1065403,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDY1NDAz","url":"https://hackerone.com/reports/1065403","title":"Java: QL Query Detector for JHipster Generated CVE-2019-16303","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-12-23T18:42:39.279Z","submitted_at":"2020-12-23T18:42:39.271Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jlleitschuh","url":"/jlleitschuh","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/388/267/887b2ef55debfc7b243bdf563d314329cf750468_original.JPG/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":45140,"url":"https://hackerone.com/github-security-lab","handle":"github-security-lab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/nE5ZXynECGkNTp3JXDoVJdMD/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/nE5ZXynECGkNTp3JXDoVJdMD/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"api_only","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"GitHub Security Lab","twitter_handle":"ghsecuritylab","website":"https://securitylab.github.com","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":true,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-12-23T18:46:20.605Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-12-23T18:46:13.967Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"This bug was reported directly to GitHub Security Lab.","vulnerability_information_html":"\u003cp\u003eThis bug was reported directly to GitHub Security Lab.\u003c/p\u003e\n","bounty_amount":"1800.0","formatted_bounty":"$1,800","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2021-01-22T18:46:14.035Z","allow_singular_disclosure_after":2125890.652563984,"singular_disclosure_allowed":false,"vote_count":1,"voters":["mygf"],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":10191640,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":true,"created_at":"2020-12-23T18:42:39.279Z","updated_at":"2020-12-23T18:42:39.279Z","actor":{"username":"xrc","cleared":false,"url":"/xrc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"jlleitschuh","url":"/jlleitschuh"},"genius_execution_id":null,"team_handle":"github-security-lab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":10193316,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":true,"created_at":"2020-12-23T18:42:39.339Z","updated_at":"2020-12-23T18:42:39.339Z","actor":{"url":"/github-security-lab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/nE5ZXynECGkNTp3JXDoVJdMD/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"GitHub Security Lab"}},"bounty_amount":"1800.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"github-security-lab","collaborator":{"username":"jlleitschuh","url":"/jlleitschuh"},"actor_is_team_member":true,"actor_is_concealed_member":true},{"id":10191685,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-12-23T18:46:13.977Z","updated_at":"2020-12-23T18:46:13.977Z","first_to_agree":true,"actor":{"username":"xcorail","cleared":false,"url":"/xcorail","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/kjmuFCd99F4AumWDUtToLki6/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"github-security-lab","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":10191687,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2020-12-23T18:46:20.537Z","updated_at":"2020-12-23T18:46:20.537Z","actor":{"username":"xcorail","cleared":false,"url":"/xcorail","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/kjmuFCd99F4AumWDUtToLki6/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"github-security-lab","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":26001,"category":"team","content":"https://github.com/github/securitylab/issues/180","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003ca title=\"https://github.com/github/securitylab/issues/180\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fgithub%2Fsecuritylab%2Fissues%2F180\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/github/securitylab/issues/180\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n"},{"id":26006,"category":"researcher","content":"# Discovery\n\nIn September of 2019 I was looking through GitHub's open source projects for uses of insecure random number generation in security sensitive locations.\n\nWhat I quickly discovered was interesting and confusing. I kept finding uses of `RandomStringUtils.randomAlphanumeric` from the apache commons library in use in the exact same way across thousands of projects on GitHub.\n\n```java\n     /** \n      * Generate a password. \n      * \n      * @return the generated password. \n      */ \n     public static String generatePassword() { \n         return RandomStringUtils.randomAlphanumeric(DEF_COUNT); \n     } \n  \n     /** \n      * Generate an activation key. \n      * \n      * @return the generated activation key. \n      */ \n     public static String generateActivationKey() { \n         return RandomStringUtils.randomNumeric(DEF_COUNT); \n     } \n  \n     /** \n      * Generate a reset key. \n      * \n      * @return the generated reset key. \n      */ \n     public static String generateResetKey() { \n         return RandomStringUtils.randomNumeric(DEF_COUNT); \n     } \n```\n\nThe problem with this code is that `RandomStringUtils` relies upon an insecure random number generator for it's source of randomness. Thus, if an attacker is able to determine one password reset key, they can determine what other randomness the server will also generate.\n\nI tracked down the source of this vulnerability to a code generation project called [JHipster Generator](https://www.jhipster.tech/). After reporting this vulnerability to them, the JHipster team awarded me a [$500 bounty for my vulnerability disclosure](https://github.com/jhipster/generator-jhipster/issues/10401). This was and continues to be the first and only time that a fully open source project not actively maintained by a parent company has awarded me directly for my open source security research. \n\nFor that vulnerability, a CVE was assigned and the vulnerability was disclosed.\n\n# Enter CodeQL and the GitHub Security Lab\n\nGitHub acquires Semmle in September of 2019 and soon after announces the beginning of this BB program.\n\nSince a code generator created this vulnerability, writing a CodeQL query to detect this vulnerability didn't seem all that difficult. It was something that was kicking around my head for a while but took me until earlier this year to finally get around to writing the query. The query and accompanying PR for this submission can be found on [GitHub here](https://github.com/github/codeql/pull/4312).\n\n\n# Part 1 or 2\n\nThis story continues on this [second hacker one report ](https://hackerone.com/reports/1065402).","can_view?":true,"can_edit?":false,"content_html":"\u003ch1 id=\"discovery\"\u003eDiscovery\u003c/h1\u003e\n\n\u003cp\u003eIn September of 2019 I was looking through GitHub\u0026#39;s open source projects for uses of insecure random number generation in security sensitive locations.\u003c/p\u003e\n\n\u003cp\u003eWhat I quickly discovered was interesting and confusing. I kept finding uses of \u003ccode\u003eRandomStringUtils.randomAlphanumeric\u003c/code\u003e from the apache commons library in use in the exact same way across thousands of projects on GitHub.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight java\"\u003e\u003ccode\u003e     \u003cspan class=\"cm\"\u003e/** \n      * Generate a password. \n      * \n      * @return the generated password. \n      */\u003c/span\u003e \n     \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003egeneratePassword\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \n         \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nc\"\u003eRandomStringUtils\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003erandomAlphanumeric\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003eDEF_COUNT\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e \n     \u003cspan class=\"o\"\u003e}\u003c/span\u003e \n\n     \u003cspan class=\"cm\"\u003e/** \n      * Generate an activation key. \n      * \n      * @return the generated activation key. \n      */\u003c/span\u003e \n     \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003egenerateActivationKey\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \n         \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nc\"\u003eRandomStringUtils\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003erandomNumeric\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003eDEF_COUNT\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e \n     \u003cspan class=\"o\"\u003e}\u003c/span\u003e \n\n     \u003cspan class=\"cm\"\u003e/** \n      * Generate a reset key. \n      * \n      * @return the generated reset key. \n      */\u003c/span\u003e \n     \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"nc\"\u003eString\u003c/span\u003e \u003cspan class=\"nf\"\u003egenerateResetKey\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \n         \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nc\"\u003eRandomStringUtils\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003erandomNumeric\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"no\"\u003eDEF_COUNT\u003c/span\u003e\u003cspan class=\"o\"\u003e);\u003c/span\u003e \n     \u003cspan class=\"o\"\u003e}\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe problem with this code is that \u003ccode\u003eRandomStringUtils\u003c/code\u003e relies upon an insecure random number generator for it\u0026#39;s source of randomness. Thus, if an attacker is able to determine one password reset key, they can determine what other randomness the server will also generate.\u003c/p\u003e\n\n\u003cp\u003eI tracked down the source of this vulnerability to a code generation project called \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.jhipster.tech%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eJHipster Generator\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. After reporting this vulnerability to them, the JHipster team awarded me a \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fjhipster%2Fgenerator-jhipster%2Fissues%2F10401\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e$500 bounty for my vulnerability disclosure\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. This was and continues to be the first and only time that a fully open source project not actively maintained by a parent company has awarded me directly for my open source security research. \u003c/p\u003e\n\n\u003cp\u003eFor that vulnerability, a CVE was assigned and the vulnerability was disclosed.\u003c/p\u003e\n\n\u003ch1 id=\"enter-codeql-and-the-github-security-lab\"\u003eEnter CodeQL and the GitHub Security Lab\u003c/h1\u003e\n\n\u003cp\u003eGitHub acquires Semmle in September of 2019 and soon after announces the beginning of this BB program.\u003c/p\u003e\n\n\u003cp\u003eSince a code generator created this vulnerability, writing a CodeQL query to detect this vulnerability didn\u0026#39;t seem all that difficult. It was something that was kicking around my head for a while but took me until earlier this year to finally get around to writing the query. The query and accompanying PR for this submission can be found on \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fgithub%2Fcodeql%2Fpull%2F4312\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eGitHub here\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch1 id=\"part-1-or-2\"\u003ePart 1 or 2\u003c/h1\u003e\n\n\u003cp\u003eThis story continues on this \u003ca href=\"https://hackerone.com/reports/1065402\"\u003esecond hacker one report \u003c/a\u003e.\u003c/p\u003e\n"}]}