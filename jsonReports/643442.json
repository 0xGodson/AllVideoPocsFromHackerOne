{"id":643442,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NDM0NDI=","url":"https://hackerone.com/reports/643442","title":"Unauthenticated reflected XSS in preview_as_user function","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-07-15T11:36:41.063Z","submitted_at":"2019-07-15T11:36:41.063Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"arcturian","url":"/arcturian","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/502/029/7422c9472644e5ade6fadead0d7b424181def48d_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":60,"url":"https://hackerone.com/concrete5","handle":"concrete5","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/060/c549a89ab4a3550cb9bfdeba1bee6d77e2019c7e_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/060/c549a89ab4a3550cb9bfdeba1bee6d77e2019c7e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"concrete5","twitter_handle":"concrete5","website":"https://www.concrete5.org","about":"A simple and powerful content management system."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-12-06T15:48:41.839Z","bug_reporter_agreed_on_going_public_at":"2019-11-06T15:48:39.645Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"An unauthenticated, reflected cross-site-scripting attack is possible due to the unsanitised `cID` parameter in the preview_as_user functionality.\n\nExample URL: `https://LOCAL-CONCRETE-INSTALL/ccm/system/panels/page/preview_as_user/preview?cID=%22%3E%3C/iframe%3E%3Cscript%3Ealert(1)%3C/script%3E%3C!--`\n\nThe error is in the `concrete/views/panels/page/preview_as/frame.php` file, line 4:\n```\n[..]\nsrc=\"\u003c?= URL::to('/ccm/system/panels/page/preview_as_user/render') . '?\u0026cID=' . Request::request('cID') ?\u003e\n[..]\n```\n\nSolutions would be to either cast this value to an int with `intval()`, or pass the value through `htmlentities()` before rendering it. Or both!\n\n## Impact\n\nAn attacker could steal cookies or perform actions on other users behalf.","vulnerability_information_html":"\u003cp\u003eAn unauthenticated, reflected cross-site-scripting attack is possible due to the unsanitised \u003ccode\u003ecID\u003c/code\u003e parameter in the preview_as_user functionality.\u003c/p\u003e\n\n\u003cp\u003eExample URL: \u003ccode\u003ehttps://LOCAL-CONCRETE-INSTALL/ccm/system/panels/page/preview_as_user/preview?cID=%22%3E%3C/iframe%3E%3Cscript%3Ealert(1)%3C/script%3E%3C!--\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eThe error is in the \u003ccode\u003econcrete/views/panels/page/preview_as/frame.php\u003c/code\u003e file, line 4:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[..]\nsrc=\u0026quot;\u0026lt;?= URL::to(\u0026#39;/ccm/system/panels/page/preview_as_user/render\u0026#39;) . \u0026#39;?\u0026amp;cID=\u0026#39; . Request::request(\u0026#39;cID\u0026#39;) ?\u0026gt;\n[..]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSolutions would be to either cast this value to an int with \u003ccode\u003eintval()\u003c/code\u003e, or pass the value through \u003ccode\u003ehtmlentities()\u003c/code\u003e before rendering it. Or both!\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAn attacker could steal cookies or perform actions on other users behalf.\u003c/p\u003e\n","weakness":{"id":61,"name":"Cross-site Scripting (XSS) - Reflected"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":529520,"file_name":"xss-example.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/529/520/ab327b7f2bac0cc2926afdb0d4b66b350ea5ef97/xss-example.PNG?response-content-disposition=attachment%3B%20filename%3D%22xss-example.PNG%22%3B%20filename%2A%3DUTF-8%27%27xss-example.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQYCKXWVJV%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T063306Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDA49PdtQjNwsmxuqXkUfx4reZ7FOIjOQweezWE1XNVvgIhAIx4Xhhh4XlvyIhDJdSEbmB96vDM5LCgXwGSfRM7F1iGKrQDCFUQARoMMDEzNjE5Mjc0ODQ5Igyn15lTDq2bI47AdVUqkQNMLcSRNdoLgSjMqfZWfS2MON26yye1i89YSblnHhNnmmD%2BCvb9yhqbaahpmKHBn3USgduRumLTV9NLIU7btFJI3aDtP%2FlWAUoPbX2QxPMxkJvic1ajY8aoF%2BnP%2Fk5UKukHF6D5Is0Fl3Ml%2BqRxmX1yWQTr3H8jccJZ6aCDwhBSY3iZbIjaXYPaWMislYIuYKKUaLL%2F%2FYtKvtqaU%2FJGIKdF0f6x2tCHDbPS827MCNRm0untsD%2FJzgKRNU1mRAA87%2BCkBpJKyJTehTat9%2F%2FN1nYNPFuZPiPZaAFHHLfjwSlmUUMt%2FjoBjH%2Fcyea8UZK0pA5Axz%2Fm0f%2B7vbWepdX7D%2BvGEghnkHR0Oe7JTNRrWnUe20hFtN2VX6fIFqm9o3ZNb5%2BD8rX67vlWEUKhs5kSGlyl9lGQ8eFTM41lWO%2F5Cj6DFNQF7PQ4bl85VypcyQ6hS%2FKzmgaXGJwEUyiknMXmQ%2BRjTRRFvw0kG2TaqDSXcr%2FcdXxN5FVFJsxMfo%2BqrTaGgGf8R88RwwIpSqqo0RKqA2Xh0TCcz6r%2FBTrqAUDBHv70zc1wQG84KmYipl4mNsyVGxUMZh3CsgQjwXY%2Fv6h62iMoRu%2F5MESZoXSTR0hNz9M95%2Fn2q%2BB8n8cjdZLS9WuYTCTYcrPyBfvG6lGVHQJ%2FCFMt0nOaRJepHaeOrZ8ixXpq%2FKU9YvFEk83zuOnTYxYm5hwxl37Sww%2FXZJHw2r23uHUmo8TMaZnWQj29AdMGqkOeoWqYjNS4Q3K3et0tfgVM4UMSCi28eH0lBYtC56QeRUk3j%2Brsw4LY0o%2FlP7RXyGFceiJ7fG0HRIst91IOe7KULe4yg3%2FgRBW2zW4bXrpvrkp3CnURtw%3D%3D\u0026X-Amz-Signature=eb57d93bf11e2fe33b94e8ed4ef1c1dc72029eae40ec7c34a6dedb0e56a49396","file_size":23264,"type":"image/png"}],"allow_singular_disclosure_at":"2019-12-06T15:48:39.720Z","allow_singular_disclosure_after":-33576266.663472295,"singular_disclosure_allowed":true,"vote_count":12,"voters":["bl4de","nessun00x","cryptographer","armansameer","zinkytinky","yoflow","paus","k8seb","rapttor","herlock-momo","and 2 more..."],"severity":{"rating":"medium","score":4.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":13099,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/concrete5/concrete5","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":5322523,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"**This report has been automatically set to \"needs more info\"** because it does not adhere to the rules listed [on our project page](https://hackerone.com/concrete5). Please go over these rules and resubmit following the directions.\r\n\r\nIf you've read and complied with all of the rules, please email security@concrete5.org so that this issue may be reopened.","markdown_message":"\u003cp\u003e\u003cstrong\u003eThis report has been automatically set to \u0026quot;needs more info\u0026quot;\u003c/strong\u003e because it does not adhere to the rules listed \u003ca href=\"https://hackerone.com/concrete5\"\u003eon our project page\u003c/a\u003e. Please go over these rules and resubmit following the directions.\u003c/p\u003e\n\n\u003cp\u003eIf you\u0026#39;ve read and complied with all of the rules, please email \u003ca title=\"security@concrete5.org\" href=\"mailto:security@concrete5.org\" rel=\"nofollow noopener noreferrer\"\u003esecurity@concrete5.org\u003c/a\u003e so that this issue may be reopened.\u003c/p\u003e\n","automated_response":true,"created_at":"2019-07-15T11:36:41.700Z","updated_at":"2019-07-15T11:36:41.700Z","actor":{"url":"/concrete5","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/060/c549a89ab4a3550cb9bfdeba1bee6d77e2019c7e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"concrete5"}},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5322536,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Also: crayons","markdown_message":"\u003cp\u003eAlso: crayons\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-15T11:39:02.893Z","updated_at":"2019-07-15T11:39:02.893Z","actor":{"username":"arcturian","cleared":false,"url":"/arcturian","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/502/029/7422c9472644e5ade6fadead0d7b424181def48d_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5351722,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2019-07-17T17:35:30.654Z","updated_at":"2019-07-17T17:35:30.654Z","actor":{"username":"korvin","cleared":false,"url":"/korvin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yi9xvfnDmjKpKA1reqNSwGct/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5351728,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"A patch for this bug has been merged into the development branch of concrete5 and will be available in the next version of concrete5.\n\nIf you'd like to verify, you can see @takuro's fix here: https://github.com/concrete5/concrete5/pull/7999\n\nThank you for bringing this to our attention!","markdown_message":"\u003cp\u003eA patch for this bug has been merged into the development branch of concrete5 and will be available in the next version of concrete5.\u003c/p\u003e\n\n\u003cp\u003eIf you\u0026#39;d like to verify, you can see \u003ca href=\"/takuro\"\u003e@takuro\u003c/a\u003e\u0026#39;s fix here: \u003ca title=\"https://github.com/concrete5/concrete5/pull/7999\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fconcrete5%2Fconcrete5%2Fpull%2F7999\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/concrete5/concrete5/pull/7999\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThank you for bringing this to our attention!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-17T17:36:03.229Z","updated_at":"2019-07-17T17:36:03.229Z","actor":{"username":"korvin","cleared":false,"url":"/korvin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yi9xvfnDmjKpKA1reqNSwGct/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"arcturian","url":"/arcturian"},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5418195,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Are you okay for us to publicly disclose this, after the new version has been released?\n\nOr would you rather us wait a short while to allow users to upgrade?","markdown_message":"\u003cp\u003eAre you okay for us to publicly disclose this, after the new version has been released?\u003c/p\u003e\n\n\u003cp\u003eOr would you rather us wait a short while to allow users to upgrade?\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-24T14:27:46.285Z","updated_at":"2019-07-24T14:27:46.285Z","first_to_agree":true,"actor":{"username":"arcturian","cleared":false,"url":"/arcturian","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/502/029/7422c9472644e5ade6fadead0d7b424181def48d_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5640541,"is_internal":false,"editable":false,"type":"Activities::CancelledDisclosureRequest","message":"Hi @arcturian, \nLet's wait until the new version is release to disclose this vulnerability.\n\nBest wishes,\nKorvin","markdown_message":"\u003cp\u003eHi \u003ca href=\"/arcturian\"\u003e@arcturian\u003c/a\u003e, \u003cbr\u003e\nLet\u0026#39;s wait until the new version is release to disclose this vulnerability.\u003c/p\u003e\n\n\u003cp\u003eBest wishes,\u003cbr\u003e\nKorvin\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-22T16:14:04.781Z","updated_at":"2019-08-22T16:14:04.781Z","actor":{"username":"korvin","cleared":false,"url":"/korvin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/yi9xvfnDmjKpKA1reqNSwGct/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6232287,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hello @korvin ,\n\nAs the latest release version is now 8.5.2, which has been out for over a month, may we now disclose this?\n\nBest regards,\n-Rory","markdown_message":"\u003cp\u003eHello \u003ca href=\"/korvin\"\u003e@korvin\u003c/a\u003e ,\u003c/p\u003e\n\n\u003cp\u003eAs the latest release version is now 8.5.2, which has been out for over a month, may we now disclose this?\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\n-Rory\u003c/p\u003e\n","automated_response":false,"created_at":"2019-11-06T15:48:39.666Z","updated_at":"2019-11-06T15:48:39.666Z","first_to_agree":true,"actor":{"username":"arcturian","cleared":false,"url":"/arcturian","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/502/029/7422c9472644e5ade6fadead0d7b424181def48d_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6484756,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-06T15:48:41.873Z","updated_at":"2019-12-06T15:48:41.873Z","actor":{"url":"/concrete5","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/060/c549a89ab4a3550cb9bfdeba1bee6d77e2019c7e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"concrete5"}},"genius_execution_id":null,"team_handle":"concrete5","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":17224,"category":"researcher","content":"Manual code audit and a lot of grepping through source code. Discovered by restricting the scope to features available to an unauthenticated user.\n\nTools: vim, ripgrep","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eManual code audit and a lot of grepping through source code. Discovered by restricting the scope to features available to an unauthenticated user.\u003c/p\u003e\n\n\u003cp\u003eTools: vim, ripgrep\u003c/p\u003e\n"}]}