{"id":3596,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNTk2","url":"https://hackerone.com/reports/3596","title":"OAuth access_token stealing in Phabricator","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-03-10T12:03:49.078Z","submitted_at":"2014-03-10T12:03:49.078Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"krangbuster","url":"/krangbuster","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/003/495/375adba2f29a55536eac05aedcef905aad42ff64_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":18,"url":"https://hackerone.com/phabricator","handle":"phabricator","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Phabricator","twitter_handle":"phabricator","website":"http://phacility.com/phabricator/","about":"Phabricator is a collection of open source web applications that help software companies build better software."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-04-11T14:23:15.622Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2014-03-12T14:34:14.479Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\r\n\r\nI found that an attacker is able to steal access_tokens of facebook users via Phabricator App (184510521580034).\r\n\r\nwhen users login to phabricator, they can choose to login via Facebook (https://secure.phabricator.com/login/) attaching pic, In this case an attacker is able to exploit this behavior to steal facebook access_tokens via phabricator app.\r\n\r\nFull Reproduce, Exploit:\r\n\r\n1. Create a blog on phabricator https://secure.phabricator.com/phame/blog/new/\r\nand provide a custom domain, in this case: files.nirgoldshlager.com\r\n\r\n2. send a malicious link to the victim: https://www.facebook.com/dialog/oauth?client_id=184510521580034\u0026response_type=token\u0026redirect_uri=https://secure.phabricator.com/phame/live/47/ , Click Continue\r\n\r\nwhen the victim will click continue, his access token will be send to my malicious server, saved in a log file under: http://files.nirgoldshlager.com\r\n\r\nPoC Video:\r\n\r\nhttps://drive.google.com/file/d/0B2-5ltUODX1LWHV6R3gxSFAwNzQ/edit?usp=sharing\r\n","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eI found that an attacker is able to steal access_tokens of facebook users via Phabricator App (184510521580034).\u003c/p\u003e\n\n\u003cp\u003ewhen users login to phabricator, they can choose to login via Facebook (\u003ca title=\"https://secure.phabricator.com/login/\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2Flogin%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/login/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) attaching pic, In this case an attacker is able to exploit this behavior to steal facebook access_tokens via phabricator app.\u003c/p\u003e\n\n\u003cp\u003eFull Reproduce, Exploit:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eCreate a blog on phabricator \u003ca title=\"https://secure.phabricator.com/phame/blog/new/\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2Fphame%2Fblog%2Fnew%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/phame/blog/new/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nand provide a custom domain, in this case: files.nirgoldshlager.com\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003esend a malicious link to the victim: \u003ca title=\"https://www.facebook.com/dialog/oauth?client_id=184510521580034\u0026amp;response_type=token\u0026amp;redirect_uri=https://secure.phabricator.com/phame/live/47/\" href=\"/redirect?url=https%3A%2F%2Fwww.facebook.com%2Fdialog%2Foauth%3Fclient_id%3D184510521580034%26response_type%3Dtoken%26redirect_uri%3Dhttps%3A%2F%2Fsecure.phabricator.com%2Fphame%2Flive%2F47%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.facebook.com/dialog/oauth?client_id=184510521580034\u0026amp;response_type=token\u0026amp;redirect_uri=https://secure.phabricator.com/phame/live/47/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e , Click Continue\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003ewhen the victim will click continue, his access token will be send to my malicious server, saved in a log file under: \u003ca title=\"http://files.nirgoldshlager.com\" href=\"/redirect?url=http%3A%2F%2Ffiles.nirgoldshlager.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://files.nirgoldshlager.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePoC Video:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://drive.google.com/file/d/0B2-5ltUODX1LWHV6R3gxSFAwNzQ/edit?usp=sharing\" href=\"/redirect?url=https%3A%2F%2Fdrive.google.com%2Ffile%2Fd%2F0B2-5ltUODX1LWHV6R3gxSFAwNzQ%2Fedit%3Fusp%3Dsharing\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://drive.google.com/file/d/0B2-5ltUODX1LWHV6R3gxSFAwNzQ/edit?usp=sharing\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"450.0","formatted_bounty":"$450","weakness":{"id":53,"name":"Open Redirect"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":4207,"file_name":"loginviafacebook.jpg","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/004/207/b20351f991d93b5a0182edb6ac0b6ba090621240/loginviafacebook.jpg?response-content-disposition=attachment%3B%20filename%3D%22loginviafacebook.jpg%22%3B%20filename%2A%3DUTF-8%27%27loginviafacebook.jpg\u0026response-content-type=image%2Fjpeg\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTYNHLLAI%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T054250Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHZ%2BW3HUv1n%2B6aR51XKyQUoltUs4dpenL8C5Ngq%2FaRRRAiEAmfsKW6s44zslbtLbjio7lyByPFrM4HhkqWc4BlKqI%2FsqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDEk2ujSH9wgIeNJFfSqRA5L87pajd4uBiMOahwiQWY9MCcYfdnrcw1IGaRg5TpxW7DR87N3npEJ347tYQoNG4qvz83ZIfPJaoV16%2BHSbvgHCloy0L2IJebFkXavQ%2FqP76i9C%2Fflz0T%2FAY7BQexVBAB81BDbhmxnE9q9peEXcv7DxPs6yUKcdy540RKUrN7uslxSA7j3G9JiTuJ6qb2%2F4wYsuXqZAjjjsCgg1mXnpWD2MBpvjLmy20fnWfTyEpbZx69BhUOjIiXGUwMwyU3vIR8mTDDVd0lLxGqVwqo7wgDElekHdTEW3qhMPXMlt6DlI6yj8Gdba%2FBl9Vc01EccnsQcPWyVJry%2FS5ynL9DMtJAAAFirbxDGfh3YyQKCitVKKFFQ%2BXcUVp%2FSwwBBOTy19C2elhYtpl6vcpcY0%2FpxhMV%2FLT11lv%2FW2w21ED7vsm1c%2FDgyMyGhcc5jxtzWgSuplAxsWTwQc5B1WrLELk6MdDLXcvxB6lqSlYR3jek%2FEqa3e3t%2FxycmED7JcchnTpltDpgBiVe4qfO%2B85c9LeAT9plTAMKDqqv8FOusBsw37kCqQM4gZ7GwocFGWO%2Bb%2BbNa2dgEi%2Fv9cXsb1AOYUnwz%2B%2FyPyUSoTx0mdn2JtBFbkLI2hWmV1Y9Plg4ywi43mIKFY5BXMieUzgwCaeF0glcm8O%2F5kugCvuf01QuIauHjpwGSFMitZi1h52iDxD6TQNrXkM8ak7hW52tsH0VpvrBIvM3fFeRl4cr81y%2FuM3ueoyxszwreZZnbZK4WIuk8LU9YhohKDj6BRCCLOA1ZWZip14mKPOWPa8WaAzVovmI9BYDR0AxC4M%2FMywNMPj4r12n4DpTYCcHFvsA18GtoCtKML64R8uPhkQw%3D%3D\u0026X-Amz-Signature=d95ba615e82281de8d1bd120d3a0c7f7aa4d17fca6308c3cd4c5dd1492019ae2","file_size":199867,"type":"image/jpeg"}],"allow_singular_disclosure_at":"2014-04-11T13:23:13.149Z","allow_singular_disclosure_after":-211997977.36536625,"singular_disclosure_allowed":true,"vote_count":3,"voters":["fantam1","japz","satyamdixit"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":14798,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"To clarify, the log file in question is logging HTTP referrers? I don't see a way to get the redirect to work with normal GET parameters. Am I misunderstanding that part of the attack?\n\nI have some offsite meetings this morning so I may not get a chance to fix this until later today.","markdown_message":"\u003cp\u003eTo clarify, the log file in question is logging HTTP referrers? I don\u0026#39;t see a way to get the redirect to work with normal GET parameters. Am I misunderstanding that part of the attack?\u003c/p\u003e\n\n\u003cp\u003eI have some offsite meetings this morning so I may not get a chance to fix this until later today.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-10T14:05:38.730Z","updated_at":"2014-03-10T14:05:38.730Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":14801,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Evan,\n\nAbout the log script,  it's not via http referrers, it works with combination of javascript code with server side logger,\n\nBTW, \n\nthe data file ( leaked access tokens) stored in:\n\n http://files.nirgoldshlager.com/log.txt,\n\nSo if you want to reproduce:\n\nclick on the malicious link, + Continue:\n\nhttps://www.facebook.com/dialog/oauth?client_id=184510521580034\u0026response_type=token\u0026redirect_uri=https://secure.phabricator.com/phame/live/47/\n\nthen you will see your access_token in my log file under http://files.nirgoldshlager.com/log.txt\n\n\nBest,\n\nNir\n","markdown_message":"\u003cp\u003eHi Evan,\u003c/p\u003e\n\n\u003cp\u003eAbout the log script,  it\u0026#39;s not via http referrers, it works with combination of javascript code with server side logger,\u003c/p\u003e\n\n\u003cp\u003eBTW, \u003c/p\u003e\n\n\u003cp\u003ethe data file ( leaked access tokens) stored in:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"http://files.nirgoldshlager.com/log.txt\" href=\"/redirect?url=http%3A%2F%2Ffiles.nirgoldshlager.com%2Flog.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://files.nirgoldshlager.com/log.txt\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eSo if you want to reproduce:\u003c/p\u003e\n\n\u003cp\u003eclick on the malicious link, + Continue:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://www.facebook.com/dialog/oauth?client_id=184510521580034\u0026amp;response_type=token\u0026amp;redirect_uri=https://secure.phabricator.com/phame/live/47/\" href=\"/redirect?url=https%3A%2F%2Fwww.facebook.com%2Fdialog%2Foauth%3Fclient_id%3D184510521580034%26response_type%3Dtoken%26redirect_uri%3Dhttps%3A%2F%2Fsecure.phabricator.com%2Fphame%2Flive%2F47%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.facebook.com/dialog/oauth?client_id=184510521580034\u0026amp;response_type=token\u0026amp;redirect_uri=https://secure.phabricator.com/phame/live/47/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ethen you will see your access_token in my log file under \u003ca title=\"http://files.nirgoldshlager.com/log.txt\" href=\"/redirect?url=http%3A%2F%2Ffiles.nirgoldshlager.com%2Flog.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://files.nirgoldshlager.com/log.txt\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eBest,\u003c/p\u003e\n\n\u003cp\u003eNir\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-10T14:23:21.094Z","updated_at":"2014-03-10T14:23:21.094Z","actor":{"username":"krangbuster","cleared":false,"url":"/krangbuster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/495/375adba2f29a55536eac05aedcef905aad42ff64_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":14805,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah, okay, I think I understand. I was confused at first because this does not work in Safari, which is my primary browser.\n\nSpecifically, what's happening is:\n\n  - The form with no \"action\" attribute preserves the anchor.\n  - Most browsers preserve the anchor after a 302 (Safari does not, but Firefox does).\n  - The attacker can read the anchor information once the victim arrives at his site.\n\nIs that right?\n\nI'm going to make these changes:\n\n  - Stop using implicit `action` on forms. It looks like `action=\"#\"` works as a safe alternative, although it would be nice to generate forms explicitly with the correct URI. We never expect the anchor to survive a POST.\n  - Get rid of the 302 to arbitrary external URIs after POST in Phame. I assumed this was safe because we CSRF it, but there's no reason this needs to exist.","markdown_message":"\u003cp\u003eAh, okay, I think I understand. I was confused at first because this does not work in Safari, which is my primary browser.\u003c/p\u003e\n\n\u003cp\u003eSpecifically, what\u0026#39;s happening is:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe form with no \u0026quot;action\u0026quot; attribute preserves the anchor.\u003c/li\u003e\n\u003cli\u003eMost browsers preserve the anchor after a 302 (Safari does not, but Firefox does).\u003c/li\u003e\n\u003cli\u003eThe attacker can read the anchor information once the victim arrives at his site.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIs that right?\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m going to make these changes:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eStop using implicit \u003ccode\u003eaction\u003c/code\u003e on forms. It looks like \u003ccode\u003eaction=\u0026quot;#\u0026quot;\u003c/code\u003e works as a safe alternative, although it would be nice to generate forms explicitly with the correct URI. We never expect the anchor to survive a POST.\u003c/li\u003e\n\u003cli\u003eGet rid of the 302 to arbitrary external URIs after POST in Phame. I assumed this was safe because we CSRF it, but there\u0026#39;s no reason this needs to exist.\u003c/li\u003e\n\u003c/ul\u003e\n","automated_response":false,"created_at":"2014-03-10T14:49:38.508Z","updated_at":"2014-03-10T14:49:38.508Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":14813,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I think this prevents the attack, although I'd like to do more to mitigate similar attacks before considering this resolved:\n\nhttps://secure.phabricator.com/D8481","markdown_message":"\u003cp\u003eI think this prevents the attack, although I\u0026#39;d like to do more to mitigate similar attacks before considering this resolved:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://secure.phabricator.com/D8481\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2FD8481\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/D8481\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-10T15:18:27.649Z","updated_at":"2014-03-10T15:18:27.649Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":14816,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Great,\n\nThis attack works with Chrome, Firefox, You use safari?, I'm guess you are a mac fun :),\n\nabout your solution, it should work, but I think the best solution is to make  a whitelist on phabricator facebook redirect_uri,\n\nthis could be done via https://developers.facebook.com/x/apps/184510521580034/settings/advanced/\n\nyou should see  Valid OAuth redirect URIs in advanced settings, just make sure you provide the right redirect_uri endpoint, after that, an attacker will not be able to manipulate the redirect_uri to a non endpoint url.","markdown_message":"\u003cp\u003eGreat,\u003c/p\u003e\n\n\u003cp\u003eThis attack works with Chrome, Firefox, You use safari?, I\u0026#39;m guess you are a mac fun :),\u003c/p\u003e\n\n\u003cp\u003eabout your solution, it should work, but I think the best solution is to make  a whitelist on phabricator facebook redirect_uri,\u003c/p\u003e\n\n\u003cp\u003ethis could be done via \u003ca title=\"https://developers.facebook.com/x/apps/184510521580034/settings/advanced/\" href=\"/redirect?url=https%3A%2F%2Fdevelopers.facebook.com%2Fx%2Fapps%2F184510521580034%2Fsettings%2Fadvanced%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://developers.facebook.com/x/apps/184510521580034/settings/advanced/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eyou should see  Valid OAuth redirect URIs in advanced settings, just make sure you provide the right redirect_uri endpoint, after that, an attacker will not be able to manipulate the redirect_uri to a non endpoint url.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-10T15:23:27.959Z","updated_at":"2014-03-10T15:23:27.959Z","actor":{"username":"krangbuster","cleared":false,"url":"/krangbuster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/495/375adba2f29a55536eac05aedcef905aad42ff64_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":14818,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yeah -- we can do that ourselves (and I will), but I think there's no way we can get all installs of Phabricator to do that, and I think there's no way to check it with an API to see if they've done it or not, and not all OAuth2 providers have that option, so I still want to build more general-purpose mitigations against this.","markdown_message":"\u003cp\u003eYeah -- we can do that ourselves (and I will), but I think there\u0026#39;s no way we can get all installs of Phabricator to do that, and I think there\u0026#39;s no way to check it with an API to see if they\u0026#39;ve done it or not, and not all OAuth2 providers have that option, so I still want to build more general-purpose mitigations against this.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-10T15:29:43.657Z","updated_at":"2014-03-10T15:29:43.657Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":14819,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sure, I understand,\n\n\nThanks Evan!","markdown_message":"\u003cp\u003eSure, I understand,\u003c/p\u003e\n\n\u003cp\u003eThanks Evan!\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-10T15:33:32.043Z","updated_at":"2014-03-10T15:33:32.043Z","actor":{"username":"krangbuster","cleared":false,"url":"/krangbuster","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/495/375adba2f29a55536eac05aedcef905aad42ff64_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":15948,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This should be fixed in HEAD:\n\nhttps://secure.phabricator.com/rP5854de8c1c475913765cb0d6c836a0f692a146cc\n\nI've filed this to follow up with further mitigations:\n\nhttps://secure.phabricator.com/T4593","markdown_message":"\u003cp\u003eThis should be fixed in HEAD:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://secure.phabricator.com/rP5854de8c1c475913765cb0d6c836a0f692a146cc\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2FrP5854de8c1c475913765cb0d6c836a0f692a146cc\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/rP5854de8c1c475913765cb0d6c836a0f692a146cc\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve filed this to follow up with further mitigations:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://secure.phabricator.com/T4593\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2FT4593\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/T4593\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-12T14:23:13.237Z","updated_at":"2014-03-12T14:23:13.237Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"krangbuster","url":"/krangbuster"},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":15949,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"In setting an award amount, I'm considering these factors:\n\n  - This is a clever attack which exploited issues I was not previously aware of (e.g. anchors surviving POST, anchor reattachment after 302).\n  - Stealing OAuth tokens is severe and allows an attacker to do a lot of damage.\n\nHowever, the attack is mitigated by these factors:\n\n  - Primarily, the attacker must have access to create a Phame blog and set a custom domain. This requires they have an account, and that \"Beta\" applications be enabled on an install. You can not execute this attack blind against an install you don't already have significant access to.\n  - The victim must click through an unusual dialog.\n  - The attack only affects some authentication providers.\n  - The victim must be logged in, and either already connected or must click through an approval dialog.\n  - The attack works in most browsers, but not all of them.","markdown_message":"\u003cp\u003eIn setting an award amount, I\u0026#39;m considering these factors:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThis is a clever attack which exploited issues I was not previously aware of (e.g. anchors surviving POST, anchor reattachment after 302).\u003c/li\u003e\n\u003cli\u003eStealing OAuth tokens is severe and allows an attacker to do a lot of damage.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eHowever, the attack is mitigated by these factors:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePrimarily, the attacker must have access to create a Phame blog and set a custom domain. This requires they have an account, and that \u0026quot;Beta\u0026quot; applications be enabled on an install. You can not execute this attack blind against an install you don\u0026#39;t already have significant access to.\u003c/li\u003e\n\u003cli\u003eThe victim must click through an unusual dialog.\u003c/li\u003e\n\u003cli\u003eThe attack only affects some authentication providers.\u003c/li\u003e\n\u003cli\u003eThe victim must be logged in, and either already connected or must click through an approval dialog.\u003c/li\u003e\n\u003cli\u003eThe attack works in most browsers, but not all of them.\u003c/li\u003e\n\u003c/ul\u003e\n","automated_response":false,"created_at":"2014-03-12T14:29:26.925Z","updated_at":"2014-03-12T14:29:26.925Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Phabricator"}},"bounty_amount":"450.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"phabricator","collaborator":{"username":"krangbuster","url":"/krangbuster"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":15952,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"This can be disclosed at any time.","markdown_message":"\u003cp\u003eThis can be disclosed at any time.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-03-12T14:34:14.493Z","updated_at":"2014-03-12T14:34:14.493Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":28809,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-04-11T14:23:16.037Z","updated_at":"2014-04-11T14:23:16.037Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Phabricator"}},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}