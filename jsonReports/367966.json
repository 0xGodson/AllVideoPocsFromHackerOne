{"id":367966,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNjc5NjY=","url":"https://hackerone.com/reports/367966","title":"FileUpload Plugin: CSRF (delete all attached files)","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-06-18T08:46:01.666Z","submitted_at":"2018-06-18T08:46:01.666Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"foobar7","url":"/foobar7","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17443,"url":"https://hackerone.com/vanilla","handle":"vanilla","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Vanilla","twitter_handle":"vanilla","website":"http://vanillaforums.com","about":"Vanilla is a powerfully simple discussion forum you can easily customize to make as unique as your community."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-04-06T11:19:07.200Z","bug_reporter_agreed_on_going_public_at":"2019-03-07T11:18:55.128Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Description\n------------\n\nThe current version (1.9.1) of the official [FileUpload](https://github.com/vanilla/addons/tree/master/plugins/FileUpload) plugin is vulnerable to CSRF. A successful attack allows the removal of files the attacked user has the permission to delete. Administrators for example have the permission to delete all attached files.\n\nAs the request to delete files is GET based, and as users can post image tags, an attacker does not need to get a user to visit an attacker-controlled website. Instead, it is enough if a user views the post of a user.\n\nPOC\n---\n\nCreate a new post or comment with the following content (where `localhost` represents the domain which hosts vanilla):\n\n\t\u003cimg src=\"http://localhost/vanilla-core-2-6/plugin/fileupload/delete/1?DeliveryType=VIEW\u0026DeliveryMethod=JSON\" alt=\"test\"\u003e\n\t\u003cimg src=\"http://localhost/vanilla-core-2-6/plugin/fileupload/delete/2?DeliveryType=VIEW\u0026DeliveryMethod=JSON\" alt=\"test\"\u003e\n\t\u003cimg src=\"http://localhost/vanilla-core-2-6/plugin/fileupload/delete/3?DeliveryType=VIEW\u0026DeliveryMethod=JSON\" alt=\"test\"\u003e\n\t[...]\n\t\u003cimg src=\"http://localhost/vanilla-core-2-6/plugin/fileupload/delete/999?DeliveryType=VIEW\u0026DeliveryMethod=JSON\" alt=\"test\"\u003e\n\nOnce a user views the post, the file(s) with the specified id will be deleted. The attack can target files 1 to n - where n is the most recent id - , and will successfully delete all files if an administrator views the post.\n\nSolution\n--------\n\nThe same TransientKey mechanism that protects other requests against CSRF can be used.\n\n## Impact\n\nDeletion of all images","vulnerability_information_html":"\u003ch2 id=\"description\"\u003eDescription\u003c/h2\u003e\n\n\u003cp\u003eThe current version (1.9.1) of the official \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fvanilla%2Faddons%2Ftree%2Fmaster%2Fplugins%2FFileUpload\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eFileUpload\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e plugin is vulnerable to CSRF. A successful attack allows the removal of files the attacked user has the permission to delete. Administrators for example have the permission to delete all attached files.\u003c/p\u003e\n\n\u003cp\u003eAs the request to delete files is GET based, and as users can post image tags, an attacker does not need to get a user to visit an attacker-controlled website. Instead, it is enough if a user views the post of a user.\u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePOC\u003c/h2\u003e\n\n\u003cp\u003eCreate a new post or comment with the following content (where \u003ccode\u003elocalhost\u003c/code\u003e represents the domain which hosts vanilla):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;img src=\u0026quot;http://localhost/vanilla-core-2-6/plugin/fileupload/delete/1?DeliveryType=VIEW\u0026amp;DeliveryMethod=JSON\u0026quot; alt=\u0026quot;test\u0026quot;\u0026gt;\n\u0026lt;img src=\u0026quot;http://localhost/vanilla-core-2-6/plugin/fileupload/delete/2?DeliveryType=VIEW\u0026amp;DeliveryMethod=JSON\u0026quot; alt=\u0026quot;test\u0026quot;\u0026gt;\n\u0026lt;img src=\u0026quot;http://localhost/vanilla-core-2-6/plugin/fileupload/delete/3?DeliveryType=VIEW\u0026amp;DeliveryMethod=JSON\u0026quot; alt=\u0026quot;test\u0026quot;\u0026gt;\n[...]\n\u0026lt;img src=\u0026quot;http://localhost/vanilla-core-2-6/plugin/fileupload/delete/999?DeliveryType=VIEW\u0026amp;DeliveryMethod=JSON\u0026quot; alt=\u0026quot;test\u0026quot;\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOnce a user views the post, the file(s) with the specified id will be deleted. The attack can target files 1 to n - where n is the most recent id - , and will successfully delete all files if an administrator views the post.\u003c/p\u003e\n\n\u003ch2 id=\"solution\"\u003eSolution\u003c/h2\u003e\n\n\u003cp\u003eThe same TransientKey mechanism that protects other requests against CSRF can be used.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eDeletion of all images\u003c/p\u003e\n","bounty_amount":"300.0","formatted_bounty":"$300","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-04-06T11:18:55.190Z","allow_singular_disclosure_after":-54671146.99441062,"singular_disclosure_allowed":true,"vote_count":23,"voters":["sameerphad72","ninetynine","mygf","eveeez","an0nym0us","hassanshahid","khizer47","silv3rpoision","termi1","cryptographer","and 13 more..."],"severity":{"rating":"high","score":7.5,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"unchanged","confidentiality":"none","integrity":"none","availability":"high"}},"structured_scope":{"databaseId":2101,"asset_type":"URL","asset_identifier":"*.vanillaforums.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2907789,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi there. This report has been assigned to a developer who will review and provide his feedback.\nThank you.","markdown_message":"\u003cp\u003eHi there. This report has been assigned to a developer who will review and provide his feedback.\u003cbr\u003e\nThank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-19T15:35:25.517Z","updated_at":"2018-06-19T15:35:25.517Z","actor":{"username":"dexterr","cleared":false,"url":"/dexterr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/201/201/11a7da9d5256f50a86acdf6a8f3366252baee73e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2908609,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"This report has been triaged as legitimate exploit and is now triaged.\nThank you.","markdown_message":"\u003cp\u003eThis report has been triaged as legitimate exploit and is now triaged.\u003cbr\u003e\nThank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-19T19:12:53.867Z","updated_at":"2018-06-19T19:12:53.867Z","actor":{"username":"dexterr","cleared":false,"url":"/dexterr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/201/201/11a7da9d5256f50a86acdf6a8f3366252baee73e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3053290,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-16T19:57:20.580Z","updated_at":"2018-07-16T19:57:20.580Z","additional_data":{"old_severity":null,"new_severity":"High (7.5)","old_severity_id":null,"new_severity_id":183581},"actor":{"username":"linc","cleared":false,"url":"/linc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/136/045/6328894ce30b4f6b0e176d2a721ce5ea9849d135_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3053291,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-16T19:57:29.657Z","updated_at":"2018-07-16T19:57:29.657Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"bounty_amount":"300.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"vanilla","collaborator":{"username":"foobar7","url":"/foobar7"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3835451,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @dexterr,\n\nit's been a while, and I wanted to check in with you to make sure that the issue wasn't forgotten. Do you have an update on this, or on my other open reports ([#369018](https://hackerone.com/reports/369018), [#384938](https://hackerone.com/reports/384938), [#384938](https://hackerone.com/reports/384938), [#384951](https://hackerone.com/reports/384951), [#402452](https://hackerone.com/reports/402452), [#413842](https://hackerone.com/reports/413842), [#413828](https://hackerone.com/reports/413828))?\n\nBest,\nFoobar7","markdown_message":"\u003cp\u003eHi \u003ca href=\"/dexterr\"\u003e@dexterr\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eit\u0026#39;s been a while, and I wanted to check in with you to make sure that the issue wasn\u0026#39;t forgotten. Do you have an update on this, or on my other open reports (\u003ca href=\"https://hackerone.com/reports/369018\"\u003e#369018\u003c/a\u003e, \u003ca href=\"https://hackerone.com/reports/384938\"\u003e#384938\u003c/a\u003e, \u003ca href=\"https://hackerone.com/reports/384938\"\u003e#384938\u003c/a\u003e, \u003ca href=\"https://hackerone.com/reports/384951\"\u003e#384951\u003c/a\u003e, \u003ca href=\"https://hackerone.com/reports/402452\"\u003e#402452\u003c/a\u003e, \u003ca href=\"https://hackerone.com/reports/413842\"\u003e#413842\u003c/a\u003e, \u003ca href=\"https://hackerone.com/reports/413828\"\u003e#413828\u003c/a\u003e)?\u003c/p\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nFoobar7\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-16T20:29:30.873Z","updated_at":"2018-12-16T20:29:30.873Z","actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4124268,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-11T00:33:53.712Z","updated_at":"2019-02-11T00:33:53.712Z","actor":{"username":"linc","cleared":false,"url":"/linc","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/136/045/6328894ce30b4f6b0e176d2a721ce5ea9849d135_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"foobar7","url":"/foobar7"},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4274692,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-03-07T11:18:55.161Z","updated_at":"2019-03-07T11:18:55.161Z","first_to_agree":true,"actor":{"username":"foobar7","cleared":true,"url":"/foobar7","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/197/817/efb62be6777043aba724654aa495ebeccabb9e72_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4497906,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-06T11:19:07.216Z","updated_at":"2019-04-06T11:19:07.216Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}