{"id":217610,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTc2MTA=","url":"https://hackerone.com/reports/217610","title":"kh_put_iv SEGFAULT - mruby 1.2.0","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-04-01T07:14:38.590Z","submitted_at":"2017-04-01T07:14:38.590Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ilsani","url":"/ilsani","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-04-13T22:45:37.586Z","bug_reporter_agreed_on_going_public_at":"2017-04-13T22:45:37.555Z","team_member_agreed_on_going_public_at":"2017-04-13T21:27:25.939Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"mruby v. 1.2.0 crashes in `kh_put_iv` function in `variable.c` file with a crafted input. I'm examining the bug in order to better understand the root cause of the issue.\n\nTest platform:\nLinux 4.2.0-1 SMP Debian 4.2.3-2 x86_64\n\nStacktrace:\n```\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x000000000045329c in kh_put_iv (mrb=0x2744c10, h=0x2f2f3a7370747468, key=671, ret=0x0)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:292\n292     KHASH_DEFINE(iv, mrb_sym, mrb_value, TRUE, kh_int_hash_func, kh_int_hash_equal)\n(gdb) backtrace \n#0  0x000000000045329c in kh_put_iv (mrb=0x2744c10, h=0x2f2f3a7370747468, key=671, ret=0x0)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:292\n#1  0x0000000000459117 in iv_put (mrb=0x2744c10, t=0x2f2f3a7370747468, sym=671, val=...)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:310\n#2  mrb_mod_cv_set (mrb=\u003coptimized out\u003e, c=\u003coptimized out\u003e, sym=\u003coptimized out\u003e, v=...)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:838\n#3  0x000000000050e1e1 in mrb_vm_exec (mrb=\u003coptimized out\u003e, proc=\u003coptimized out\u003e, pc=\u003coptimized out\u003e)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/vm.c:979\n#4  0x000000000051f5bb in mrb_vm_run (proc=0x2746ef0, self=..., stack_keep=8, mrb=\u003coptimized out\u003e)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/vm.c:823\n#5  mrb_top_run (mrb=0x2744c10, proc=0x2746ef0, self=..., stack_keep=\u003coptimized out\u003e)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/vm.c:2614\n#6  0x00000000004d4f93 in mrb_load_exec (mrb=0x2744c10, p=\u003coptimized out\u003e, c=0x0)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/mrbgems/mruby-compiler/core/parse.y:5760\n#7  0x0000000000400c85 in main () at runtest.c:23\n(gdb) exploitable \n__main__:99: UserWarning: GDB v7.11 may not support required Python API\nDescription: Possible stack corruption\nShort description: PossibleStackCorruption (7/22)\nHash: 5696db2f9fc8b1e9b330173ee7ddc787.2627e5d3f14472e2e24f2d46a9038356\nExploitability Classification: EXPLOITABLE\nExplanation: GDB generated an error while unwinding the stack and/or the stack contained return addresses that were not mapped in the inferior's process address space and/or the stack pointer is pointing to a location outside the default stack region. These conditions likely indicate stack corruption, which is generally considered exploitable.\nOther tags: AccessViolation (21/22)\n\n```\n\nAttachment [1] is the crafted input.","vulnerability_information_html":"\u003cp\u003emruby v. 1.2.0 crashes in \u003ccode\u003ekh_put_iv\u003c/code\u003e function in \u003ccode\u003evariable.c\u003c/code\u003e file with a crafted input. I\u0026#39;m examining the bug in order to better understand the root cause of the issue.\u003c/p\u003e\n\n\u003cp\u003eTest platform:\u003cbr\u003e\nLinux 4.2.0-1 SMP Debian 4.2.3-2 x86_64\u003c/p\u003e\n\n\u003cp\u003eStacktrace:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x000000000045329c in kh_put_iv (mrb=0x2744c10, h=0x2f2f3a7370747468, key=671, ret=0x0)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:292\n292     KHASH_DEFINE(iv, mrb_sym, mrb_value, TRUE, kh_int_hash_func, kh_int_hash_equal)\n(gdb) backtrace \n#0  0x000000000045329c in kh_put_iv (mrb=0x2744c10, h=0x2f2f3a7370747468, key=671, ret=0x0)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:292\n#1  0x0000000000459117 in iv_put (mrb=0x2744c10, t=0x2f2f3a7370747468, sym=671, val=...)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:310\n#2  mrb_mod_cv_set (mrb=\u0026lt;optimized out\u0026gt;, c=\u0026lt;optimized out\u0026gt;, sym=\u0026lt;optimized out\u0026gt;, v=...)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/variable.c:838\n#3  0x000000000050e1e1 in mrb_vm_exec (mrb=\u0026lt;optimized out\u0026gt;, proc=\u0026lt;optimized out\u0026gt;, pc=\u0026lt;optimized out\u0026gt;)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/vm.c:979\n#4  0x000000000051f5bb in mrb_vm_run (proc=0x2746ef0, self=..., stack_keep=8, mrb=\u0026lt;optimized out\u0026gt;)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/vm.c:823\n#5  mrb_top_run (mrb=0x2744c10, proc=0x2746ef0, self=..., stack_keep=\u0026lt;optimized out\u0026gt;)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/src/vm.c:2614\n#6  0x00000000004d4f93 in mrb_load_exec (mrb=0x2744c10, p=\u0026lt;optimized out\u0026gt;, c=0x0)\n    at /home/msani/wrk/security/code-review/shopify/mruby/src/mruby/mrbgems/mruby-compiler/core/parse.y:5760\n#7  0x0000000000400c85 in main () at runtest.c:23\n(gdb) exploitable \n__main__:99: UserWarning: GDB v7.11 may not support required Python API\nDescription: Possible stack corruption\nShort description: PossibleStackCorruption (7/22)\nHash: 5696db2f9fc8b1e9b330173ee7ddc787.2627e5d3f14472e2e24f2d46a9038356\nExploitability Classification: EXPLOITABLE\nExplanation: GDB generated an error while unwinding the stack and/or the stack contained return addresses that were not mapped in the inferior\u0026#39;s process address space and/or the stack pointer is pointing to a location outside the default stack region. These conditions likely indicate stack corruption, which is generally considered exploitable.\nOther tags: AccessViolation (21/22)\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAttachment [1] is the crafted input.\u003c/p\u003e\n","bounty_amount":"800.0","formatted_bounty":"$800","weakness":{"id":2,"name":"Memory Corruption - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":172696,"file_name":"input.txt","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/172/696/921460591414a3e09c204cab6df709aa0445c15f/input.txt?response-content-disposition=attachment%3B%20filename%3D%22input.txt%22%3B%20filename%2A%3DUTF-8%27%27input.txt\u0026response-content-type=text%2Fx-c%2B%2B\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ3ORU3ZNE%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T045904Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBDRduU%2FQiKN2Hy3Cc%2BFdvYldnR%2BI9yQ0JWu5Nd0q2n7AiBT09NYT9NM%2FNa1T7X7mPFfQEFunNsAbPoVngTqyDCvlCq0AwhSEAEaDDAxMzYxOTI3NDg0OSIMjho0%2F2dG4425KWNaKpEDfRP2JVIKEZKe%2Fu1DRJDnMt1hodmiYRHSHxVJXvZvnhQp68RTbgsA5dtRAFzhCl2p7oJWn2DfsUhN61oqH1cme2ydNbTr6cDG5AkVoiUMnjHvkMPTgbPahrduPs%2FdXuwFoyZMuPeBtzUlpjssIk0BfcIUtph2FGwzCuy6d0CQhdl914kkFpuTBp69z2htWslZiifdNkKWK0DIJcK%2FrSurcsk8WEaPiZ7tEJAcfYZS4SddR8orMY%2BhEfGsLc5RSVBGXY0UW6zTNw%2BYg82wPCY1Z9kgrjwVLQPpVTje3rfzRO3UEDh0xbd54m7t%2FSL0yItTAuaGshQmPLuW6S%2F5KOdoWWnwCmkruRqE1ZKMsnSko5gBnNELay%2BWeukQAQ6EyIB%2FWB06%2F%2FaYfBiWUzjgZyKRGg99IBpEO3zShFTod3huOdptlvO4PfWBvrB4632o9feKKn5CXqJUOE%2BTT%2BgjHEdWRLP2W3GZAibuc%2FbOIfOwee7%2Bn9cOimwp8NVS4U08VlgiSfhcWXonWb3aOkvnOfX46QkwoP6p%2FwU67AFSjWFI11fWgLkInKyx6Dx9AePw1c4qVefioOdfVonnQ3dNW7fXwjlRC5F1185jkAwhyCARy9%2F7sIPFHaI%2FEID5osYCwdvVwv0O6pPIknWS%2FVG7rXxUIgYk0xp3ln2eURcIkz%2F20YEsL73kMrgQLn%2BEd3AiGH%2F9wW5PEZOVPNqagqBYtUSWzNl9%2BrKCkhyVg8k79SdRjUkvdYLXtvxU1m6oAu2IjxFOCgwXqn1jFH1Lloh4Gp%2Fkq68ckYZB67%2B%2FdOzejM9ofYNi%2BpJRLwSwwu22w857sj9E%2BbC8Ei9i7KZOZGBCWe81d9lycwAH6Q%3D%3D\u0026X-Amz-Signature=14b50796dfda66a225941e97eadb05d095aa9ed28deaab2fd3c40df4fbc96bf4","file_size":301,"type":"text/x-c++"}],"allow_singular_disclosure_at":"2017-05-13T21:27:25.981Z","allow_singular_disclosure_after":-114507098.6409962,"singular_disclosure_allowed":true,"vote_count":3,"voters":["eveeez","t-4-y-m","spetr0x"],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1577155,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the large volume of reports we have received, it may take us up to two weeks to respond. Thank you for your patience!","markdown_message":"\u003cp\u003eThank you for reporting this bug! This is an automated response to let you know that we\u0026#39;ve received your issue, and we\u0026#39;ll process it as soon as possible.\u003c/p\u003e\n\n\u003cp\u003eDue to the large volume of reports we have received, it may take us up to two weeks to respond. Thank you for your patience!\u003c/p\u003e\n","automated_response":true,"created_at":"2017-04-01T07:14:38.778Z","updated_at":"2017-04-01T07:14:38.778Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1582790,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We've reproduced the crash and opened an issue upstream: https://github.com/mruby/mruby/issues/3587","markdown_message":"\u003cp\u003eThank you for your report. We\u0026#39;ve reproduced the crash and opened an issue upstream: \u003ca title=\"https://github.com/mruby/mruby/issues/3587\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fissues%2F3587\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/issues/3587\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-04-04T13:09:38.607Z","updated_at":"2017-04-04T13:09:38.607Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1602571,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. This issue was fixed upstream in https://github.com/mruby/mruby/commit/9094415acfff11b4590f156eb44cf24483a6fb00.\n\nOur next round of bounty decisions will take place in approximately one week, so we'll be in touch with you again soon.","markdown_message":"\u003cp\u003eThanks again for your report. This issue was fixed upstream in \u003ca title=\"https://github.com/mruby/mruby/commit/9094415acfff11b4590f156eb44cf24483a6fb00\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fcommit%2F9094415acfff11b4590f156eb44cf24483a6fb00\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/commit/9094415acfff11b4590f156eb44cf24483a6fb00\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eOur next round of bounty decisions will take place in approximately one week, so we\u0026#39;ll be in touch with you again soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-04-10T15:48:06.140Z","updated_at":"2017-04-10T15:48:06.140Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ilsani","url":"/ilsani"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1606057,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify and the MRuby project!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify and the MRuby project!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-04-11T22:37:00.097Z","updated_at":"2017-04-11T22:37:00.097Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"ilsani","url":"/ilsani"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1610609,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-04-13T21:27:25.959Z","updated_at":"2017-04-13T21:27:25.959Z","first_to_agree":true,"actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1610807,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-04-13T22:45:37.569Z","updated_at":"2017-04-13T22:45:37.569Z","actor":{"username":"ilsani","cleared":false,"url":"/ilsani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1610808,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-04-13T22:45:37.601Z","updated_at":"2017-04-13T22:45:37.601Z","actor":{"username":"ilsani","cleared":false,"url":"/ilsani","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/034/984/3b77bc02e946405c4f4f77b7b678907d81f1946c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}