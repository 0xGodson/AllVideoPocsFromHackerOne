{"id":56828,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81NjgyOA==","url":"https://hackerone.com/reports/56828","title":"SSRF vulnerablity in app webhooks","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-04-17T02:37:51.483Z","submitted_at":"2015-04-17T02:37:51.483Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"haquaman","url":"/haquaman","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":461,"url":"https://hackerone.com/dropbox","handle":"dropbox","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/461/76f193964f418c594dd74ae1326cf4d9223f481b_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/461/76f193964f418c594dd74ae1326cf4d9223f481b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Dropbox","twitter_handle":"","website":"https://www.dropbox.com","about":"Your stuff, anywhere"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2015-04-23T23:52:45.539Z","bug_reporter_agreed_on_going_public_at":"2015-04-23T23:45:29.341Z","team_member_agreed_on_going_public_at":"2015-04-23T23:52:45.096Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Server Side Request Forgery (SSRF) is a vulnerabilty which allows an attacker to make web requests from the context of the server host machine to arbitrary URL's. This vulnerability can allow the attacker to access resources internal to the network, which would otherwise be inaccessible.\r\n\r\nThis vulnerablity also allows the use of another attack, a Cross Site Port Attack (XSPA), which allows an attacker to basically do a port scan from the context of the server host.\r\n\r\nThis vulnerablity lies in the webhooks functionality of a dropbox developer app and already has basic protection of this, as shown by the following  error message:\r\n\r\n    Webhooks doesn't support localhost as Dropbox can't contact your local server. Please use an internet accessible URI.\r\n\r\nAfter some testing, I have found that the webhook allow IP6 addresses through, allowing me to determine that there is an ssh server running on either the webhook machine, or the outgoing web proxy machine. This server has the following version:\r\n\r\n    SSH-2.0-OpenSSH_5.9p1 Debian-5ubuntu1.1\r\n\r\nThe webhook URL used to gain this information was ```http://[::1]:22/```, which produces the following output:\r\n\r\n``` \r\nError: Incorrect response to challenge. We didn't receive the expected response vLU7VauagR860z2P2sNTZkSNFJvdjt3zJ-qfZP1yIGU. See the actual response body we received below.\r\n\r\nRequest:\r\nGET http://[::1]:22/?challenge=vLU7VauagR860z2P2sNTZkSNFJvdjt3zJ-qfZP1yIGU\r\n\r\nResponse:\r\nHTTP/1.1 200 OK\r\nServer: squid/3.1.19\r\nConnection: close\r\nX-Transformed-From: HTTP/0.9\r\nDate: Fri, 17 Apr 2015 02:23:10 GMT\r\nMime-Version: 1.0\r\n\r\nResponse Body (First 256 bytes):\r\nSSH-2.0-OpenSSH_5.9p1 Debian-5ubuntu1.1\\r\\nProtocol mismatch.\\n\r\n```\r\n\r\nAnother URL that gives same result is ```http://testing6.allthethings.co.nz:22/``` where ```testing6.allthethings.co.nz``` is a domain that only has a AAAA record pointing to ::1 (localhost)\r\n\r\nI've tested using HTTP redirects (302's), but they fail, and domains that point to IPv4 localhost (```testing.allthethings.co.nz```) which also fail.\r\n\r\nWith this vulnerability, I am able to gain information about the local system, and potentially machines in neighbor networks to that machine. I can also send GET requests to a service running on any port on a system accessible to this machine. This could potentially cause damage to those internal applications. For examples of applications that may be vulnerable, please check out [this reference](https://docs.google.com/document/d/1v1TkWZtrhzRLy0bYXBcdLUedXGb9njTNIJXa3u9akHM/edit) which is now a bit outdated, but shows that there is a non zero amount of applications that may be vulnerable.\r\n\r\nNote that I could spend more time trying to figure out what applications there may be that are vulnerable on your internal network, but I feel this would go outside the intended scope of the bounty brief.\r\n\r\nLet me know if you need any more clarification or if you have questions. I'm happy to provide a screencast and/or screenshots of the vulnerability if needed.\r\n\r\nCheers,\r\n\r\nHugh\r\n    ","vulnerability_information_html":"\u003cp\u003eServer Side Request Forgery (SSRF) is a vulnerabilty which allows an attacker to make web requests from the context of the server host machine to arbitrary URL\u0026#39;s. This vulnerability can allow the attacker to access resources internal to the network, which would otherwise be inaccessible.\u003c/p\u003e\n\n\u003cp\u003eThis vulnerablity also allows the use of another attack, a Cross Site Port Attack (XSPA), which allows an attacker to basically do a port scan from the context of the server host.\u003c/p\u003e\n\n\u003cp\u003eThis vulnerablity lies in the webhooks functionality of a dropbox developer app and already has basic protection of this, as shown by the following  error message:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eWebhooks doesn\u0026#39;t support localhost as Dropbox can\u0026#39;t contact your local server. Please use an internet accessible URI.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter some testing, I have found that the webhook allow IP6 addresses through, allowing me to determine that there is an ssh server running on either the webhook machine, or the outgoing web proxy machine. This server has the following version:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eSSH-2.0-OpenSSH_5.9p1 Debian-5ubuntu1.1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe webhook URL used to gain this information was \u003ccode\u003ehttp://[::1]:22/\u003c/code\u003e, which produces the following output:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eError: Incorrect response to challenge. We didn\u0026#39;t receive the expected response vLU7VauagR860z2P2sNTZkSNFJvdjt3zJ-qfZP1yIGU. See the actual response body we received below.\n\nRequest:\nGET http://[::1]:22/?challenge=vLU7VauagR860z2P2sNTZkSNFJvdjt3zJ-qfZP1yIGU\n\nResponse:\nHTTP/1.1 200 OK\nServer: squid/3.1.19\nConnection: close\nX-Transformed-From: HTTP/0.9\nDate: Fri, 17 Apr 2015 02:23:10 GMT\nMime-Version: 1.0\n\nResponse Body (First 256 bytes):\nSSH-2.0-OpenSSH_5.9p1 Debian-5ubuntu1.1\\r\\nProtocol mismatch.\\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnother URL that gives same result is \u003ccode\u003ehttp://testing6.allthethings.co.nz:22/\u003c/code\u003e where \u003ccode\u003etesting6.allthethings.co.nz\u003c/code\u003e is a domain that only has a AAAA record pointing to ::1 (localhost)\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve tested using HTTP redirects (302\u0026#39;s), but they fail, and domains that point to IPv4 localhost (\u003ccode\u003etesting.allthethings.co.nz\u003c/code\u003e) which also fail.\u003c/p\u003e\n\n\u003cp\u003eWith this vulnerability, I am able to gain information about the local system, and potentially machines in neighbor networks to that machine. I can also send GET requests to a service running on any port on a system accessible to this machine. This could potentially cause damage to those internal applications. For examples of applications that may be vulnerable, please check out \u003ca href=\"/redirect?url=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1v1TkWZtrhzRLy0bYXBcdLUedXGb9njTNIJXa3u9akHM%2Fedit\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ethis reference\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e which is now a bit outdated, but shows that there is a non zero amount of applications that may be vulnerable.\u003c/p\u003e\n\n\u003cp\u003eNote that I could spend more time trying to figure out what applications there may be that are vulnerable on your internal network, but I feel this would go outside the intended scope of the bounty brief.\u003c/p\u003e\n\n\u003cp\u003eLet me know if you need any more clarification or if you have questions. I\u0026#39;m happy to provide a screencast and/or screenshots of the vulnerability if needed.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eHugh\u003c/p\u003e\n","bounty_amount":"512.0","formatted_bounty":"$512","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-05-23T23:45:29.672Z","allow_singular_disclosure_after":-176798179.35878474,"singular_disclosure_allowed":true,"vote_count":6,"voters":["fantam1","omarelfarsaoui","khleymu_da","spetr0x","ph41ynx","aholtrop"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":383256,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi,\n\nThanks for reaching out to us. We are looking at this right now. We take security very seriously and, for obvious reasons, would greatly appreciate it if you would allow our team a chance to address your report before you share this information with others.\n\nWe'll update you as soon as we can with our findings and any resolution. In the meantime, please feel free to follow up with me directly if you have any questions or would like to report additional findings.\n\nBest,\nDev","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThanks for reaching out to us. We are looking at this right now. We take security very seriously and, for obvious reasons, would greatly appreciate it if you would allow our team a chance to address your report before you share this information with others.\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;ll update you as soon as we can with our findings and any resolution. In the meantime, please feel free to follow up with me directly if you have any questions or would like to report additional findings.\u003c/p\u003e\n\n\u003cp\u003eBest,\u003cbr\u003e\nDev\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-17T15:50:55.073Z","updated_at":"2015-04-17T15:50:55.073Z","actor":{"username":"devd","cleared":false,"url":"/devd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/012/376/241e11c4ddebe1e81cd547edaae1532bbed268aa_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":388699,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thank you for your report, our security team has addressed the issue you raised. \n\nCan you please verify the fix too?\n\nThanks!\nTodd","markdown_message":"\u003cp\u003eThank you for your report, our security team has addressed the issue you raised. \u003c/p\u003e\n\n\u003cp\u003eCan you please verify the fix too?\u003c/p\u003e\n\n\u003cp\u003eThanks!\u003cbr\u003e\nTodd\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-23T22:41:08.709Z","updated_at":"2015-04-23T22:41:08.709Z","actor":{"url":"/dropbox","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/461/76f193964f418c594dd74ae1326cf4d9223f481b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Dropbox"}},"bounty_amount":"512.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"dropbox","collaborator":{"username":"haquaman","url":"/haquaman"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":388747,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nVerified this as fixed. Get the same responses for all my test URL's now.\n\nCheers,\n\nHugh","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eVerified this as fixed. Get the same responses for all my test URL\u0026#39;s now.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eHugh\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-23T23:26:15.822Z","updated_at":"2015-04-23T23:26:15.822Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":388759,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2015-04-23T23:42:34.005Z","updated_at":"2015-04-23T23:42:34.005Z","actor":{"username":"teisenbe","cleared":false,"url":"/teisenbe","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"haquaman","url":"/haquaman"},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":388762,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Care to disclose?","markdown_message":"\u003cp\u003eCare to disclose?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-23T23:45:29.411Z","updated_at":"2015-04-23T23:45:29.411Z","first_to_agree":true,"actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":388769,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-04-23T23:52:45.147Z","updated_at":"2015-04-23T23:52:45.147Z","actor":{"username":"teisenbe","cleared":false,"url":"/teisenbe","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":388770,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-04-23T23:52:45.567Z","updated_at":"2015-04-23T23:52:45.567Z","actor":{"username":"teisenbe","cleared":false,"url":"/teisenbe","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"dropbox","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}