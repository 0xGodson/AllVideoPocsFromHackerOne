{"id":259555,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNTk1NTU=","url":"https://hackerone.com/reports/259555","title":"heap-buffer-overflow (WRITE of size 8) in Perl_pp_reverse()","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2017-08-13T22:06:14.989Z","submitted_at":"2017-08-13T22:06:14.989Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"geeknik","url":"/geeknik","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":30,"url":"https://hackerone.com/ibb-perl","handle":"ibb-perl","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/030/06e86a090af9d395cec5535eea83b90c72274566_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/030/06e86a090af9d395cec5535eea83b90c72274566_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Perl (IBB)","twitter_handle":"","website":"http://www.perl.org","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-05-07T18:54:04.232Z","bug_reporter_agreed_on_going_public_at":"2018-04-14T18:49:19.273Z","team_member_agreed_on_going_public_at":"2018-05-07T18:54:04.124Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"[Reported to the Perl security mailing list on 11 June 2017](https://rt.perl.org/Ticket/Display.html?id=131555).\nFixed pushed to git on [13 June 2017](https://github.com/Perl/perl5/commit/d5d91c1e89a7882099b788fe66dfd438c0eb0a9e). No advisory.\n\n```\n==376==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x619000009a80 at pc 0xd1b9c4 bp 0x7ffd21892230 sp 0x7ffd21892228\nWRITE of size 8 at 0x619000009a80 thread T0\n    #0 0xd1b9c3 in Perl_pp_reverse /root/perl/pp.c:5740\n    #1 0x926e76 in Perl_runops_debug /root/perl/dump.c:2451\n    #2 0x59f02a in S_run_body /root/perl/perl.c:2543\n    #3 0x59f02a in perl_run /root/perl/perl.c:2471\n    #4 0x43506d in main /root/perl/perlmain.c:123\n    #5 0x7f474413cb44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n    #6 0x436015 (/root/perl/perl+0x436015)\n\n0x619000009a80 is located 0 bytes to the right of 1024-byte region [0x619000009680,0x619000009a80)\nallocated by thread T0 here:\n    #0 0x7f474528e73f in malloc (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x5473f)\n    #1 0x962c71 in Perl_safesysmalloc /root/perl/util.c:153\n\nSUMMARY: AddressSanitizer: heap-buffer-overflow /root/perl/pp.c:5740 Perl_pp_reverse\n```\n\n**What is happening?**\n`Scalar context reverse doesn't extend the stack before pushing the result. This is safe unless reverse doesn't have an argument (when it defaults to $_).`\n\nThe following code can trigger it:\n```\n    $_ = \"\";\n    for my $i (1..1000) {\n        () = (1..$i, scalar reverse);\n    }\n```\n\n**Is this a security bug?**\nMaybe. Dave Mitchell, one of the main Perl devs says this: `\"The attacker would need to find some code that uses argless reverse() in scalar context, where reverse() is called when the args stack is exactly full. In this case, the address of the reverse op's target SV will be written to the 4 or 8 bytes following the malloced stack block. The attacker can't control what is written.\"`\n","vulnerability_information_html":"\u003cp\u003e\u003ca href=\"/redirect?url=https%3A%2F%2Frt.perl.org%2FTicket%2FDisplay.html%3Fid%3D131555\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eReported to the Perl security mailing list on 11 June 2017\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003cbr\u003e\nFixed pushed to git on \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FPerl%2Fperl5%2Fcommit%2Fd5d91c1e89a7882099b788fe66dfd438c0eb0a9e\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e13 June 2017\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. No advisory.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e==376==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x619000009a80 at pc 0xd1b9c4 bp 0x7ffd21892230 sp 0x7ffd21892228\nWRITE of size 8 at 0x619000009a80 thread T0\n    #0 0xd1b9c3 in Perl_pp_reverse /root/perl/pp.c:5740\n    #1 0x926e76 in Perl_runops_debug /root/perl/dump.c:2451\n    #2 0x59f02a in S_run_body /root/perl/perl.c:2543\n    #3 0x59f02a in perl_run /root/perl/perl.c:2471\n    #4 0x43506d in main /root/perl/perlmain.c:123\n    #5 0x7f474413cb44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n    #6 0x436015 (/root/perl/perl+0x436015)\n\n0x619000009a80 is located 0 bytes to the right of 1024-byte region [0x619000009680,0x619000009a80)\nallocated by thread T0 here:\n    #0 0x7f474528e73f in malloc (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x5473f)\n    #1 0x962c71 in Perl_safesysmalloc /root/perl/util.c:153\n\nSUMMARY: AddressSanitizer: heap-buffer-overflow /root/perl/pp.c:5740 Perl_pp_reverse\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eWhat is happening?\u003c/strong\u003e\u003cbr\u003e\n\u003ccode\u003eScalar context reverse doesn\u0026#39;t extend the stack before pushing the result. This is safe unless reverse doesn\u0026#39;t have an argument (when it defaults to $_).\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eThe following code can trigger it:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e    $_ = \u0026quot;\u0026quot;;\n    for my $i (1..1000) {\n        () = (1..$i, scalar reverse);\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eIs this a security bug?\u003c/strong\u003e\u003cbr\u003e\nMaybe. Dave Mitchell, one of the main Perl devs says this: \u003ccode\u003e\u0026quot;The attacker would need to find some code that uses argless reverse() in scalar context, where reverse() is called when the args stack is exactly full. In this case, the address of the reverse op\u0026#39;s target SV will be written to the 4 or 8 bytes following the malloced stack block. The attacker can\u0026#39;t control what is written.\u0026quot;\u003c/code\u003e\u003c/p\u003e\n","weakness":{"id":5,"name":"Heap Overflow"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-05-14T18:49:19.590Z","allow_singular_disclosure_after":-82895106.97920258,"singular_disclosure_allowed":true,"vote_count":7,"voters":["eveeez","geeknik","apapedulimu","an0nym0us","japz","danielbrownk31","gwedd"],"severity":{"rating":"low","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1944457,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-21T19:24:16.681Z","updated_at":"2017-08-21T19:24:16.681Z","additional_data":{"old_severity":null,"new_severity":"Low","old_severity_id":null,"new_severity_id":69680},"actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-perl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1944465,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"Hey Brian,\n\nThe exploitation scenario here strikes me as rather extreme. Unless I'm missing something, I don't think this makes the minimum bar for the project here.\n\nThanks,\nAlex","markdown_message":"\u003cp\u003eHey Brian,\u003c/p\u003e\n\n\u003cp\u003eThe exploitation scenario here strikes me as rather extreme. Unless I\u0026#39;m missing something, I don\u0026#39;t think this makes the minimum bar for the project here.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\nAlex\u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-21T19:25:42.152Z","updated_at":"2017-08-21T19:25:42.152Z","actor":{"url":"/ibb-perl","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/030/06e86a090af9d395cec5535eea83b90c72274566_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Perl (IBB)"}},"genius_execution_id":null,"team_handle":"ibb-perl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1944466,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-21T19:25:47.084Z","updated_at":"2017-08-21T19:25:47.084Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"geeknik","url":"/geeknik"},"genius_execution_id":null,"team_handle":"ibb-perl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2610213,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-14T18:49:19.418Z","updated_at":"2018-04-14T18:49:19.418Z","first_to_agree":true,"actor":{"username":"geeknik","cleared":true,"url":"/geeknik","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/7xfGZCKCxUuGLYGfuUZM3XyY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-perl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2710129,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-07T18:54:04.160Z","updated_at":"2018-05-07T18:54:04.160Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-perl","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2710130,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-07T18:54:04.261Z","updated_at":"2018-05-07T18:54:04.261Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-perl","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}