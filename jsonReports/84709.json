{"id":84709,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NDcwOQ==","url":"https://hackerone.com/reports/84709","title":"[API ISSUE] agents can Create agents even after they are disabled ! ","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-08-25T19:41:28.508Z","submitted_at":"2015-08-25T19:41:28.508Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"defmax","url":"/defmax","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/759/d9f0b9418825e2418954f2cf260e32fe003c3593_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":205,"url":"https://hackerone.com/zendesk","handle":"zendesk","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/205/1f7838d9b4201d122e0a7fbacc8ff3e90f57fa0c_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/205/1f7838d9b4201d122e0a7fbacc8ff3e90f57fa0c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Zendesk","twitter_handle":"","website":"https://www.zendesk.com","about":"Zendesk is a leading cloud-based customer service software solution. Over 100,000 customer accounts use Zendesk to increase customer satisfaction."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2015-09-10T01:23:51.084Z","bug_reporter_agreed_on_going_public_at":"2015-09-09T16:51:49.181Z","team_member_agreed_on_going_public_at":"2015-09-10T01:23:50.751Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hey guys \r\n\r\n####Description :\r\nThe Owner of the Zopim dashboard account has an ability to Create agents and disable then, while disabling the an agent , it restricts him to access him to login to the dash board (this is ohk ) but you are not expiring the access_tokens . if access_tokens are reused we could gain access to the account again ! \r\n\r\nThink of a situation where an Owner creates an agent and gives administration access, when the Owner comes to know that its attacker profile , he just disables it !  but disabling the account doesnt seems secure here , the account can be used via `access_token`\r\n\r\n####Steps to Reproduce !\r\n\r\n+ Login to Owner account and Create an agent with administrator privilages \r\n+ Now Open another browser and login to agent account \r\n+ Create an client in agent account and Do the authorization and get down the `access_token`\r\n+ Now go to Owner account and `disable` the agent\r\n+ Now use this request \r\n\r\n```\r\ncurl https://www.zopim.com/api/v2/agents \\\r\n  -d '{\r\n        \"email\": \"attacker@attacker.com\", \\\r\n        \"password\": \"secretpassword\", \\\r\n        \"first_name\": \"attacker\", \\\r\n        \"last_name\": \"Anon\", \\\r\n        \"display_name\": \"Mr Robot\", \\\r\n        \"enabled\": 1, \\\r\n        \"im_server_id\": \"smith\", \\\r\n      }' \\\r\n  -v  \\\r\n  -X POST -H \"Authorization: Bearer `access_token_here`\"\r\n```\r\n+\r\n+ You could create an account ! \r\n\r\n\r\n####Simple Steps To verify \r\n\r\n+ Login to  Agent account and Open this \r\n   \u003e\u003e https://victim2-80.terminal.com/zopadmin.html\r\n+ Now Click on \" Done have access_token? Click Here\"\r\n+ IT will prompt \"Allow Or Deny \"  , Click on Allow\r\n+ Now it will show you the \"Access Token \", Copy it \r\n+ Now open Owner account and disable agent account \r\n+ Now go here again \u003e\u003e https://victim2-80.terminal.com/zopadmin.html\r\n+ And give access_token there and Click on Submit \r\n+ An account will be created with email = lol@gmail.com  \u0026 password=csrfcsrf\r\n\r\n####Video POC :\r\n\r\nhttps://www.youtube.com/watch?v=wZQTlmE0Lz8\u0026feature=youtu.be \r\n\r\n(Sorry for low clarity :p )\r\n\r\n####Remediation :\r\nJust expire the `access_tokens` when the account is disabled like you do when you \"delete\" the account \r\n\r\n\r\nLet me know if you need anything \r\n\r\n\r\nRegards\r\nN B ","vulnerability_information_html":"\u003cp\u003eHey guys \u003c/p\u003e\n\n\u003ch4 id=\"description\"\u003eDescription :\u003c/h4\u003e\n\n\u003cp\u003eThe Owner of the Zopim dashboard account has an ability to Create agents and disable then, while disabling the an agent , it restricts him to access him to login to the dash board (this is ohk ) but you are not expiring the access_tokens . if access_tokens are reused we could gain access to the account again ! \u003c/p\u003e\n\n\u003cp\u003eThink of a situation where an Owner creates an agent and gives administration access, when the Owner comes to know that its attacker profile , he just disables it !  but disabling the account doesnt seems secure here , the account can be used via \u003ccode\u003eaccess_token\u003c/code\u003e\u003c/p\u003e\n\n\u003ch4 id=\"steps-to-reproduce\"\u003eSteps to Reproduce !\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eLogin to Owner account and Create an agent with administrator privilages \u003c/li\u003e\n\u003cli\u003eNow Open another browser and login to agent account \u003c/li\u003e\n\u003cli\u003eCreate an client in agent account and Do the authorization and get down the \u003ccode\u003eaccess_token\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eNow go to Owner account and \u003ccode\u003edisable\u003c/code\u003e the agent\u003c/li\u003e\n\u003cli\u003eNow use this request \u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ecurl https://www.zopim.com/api/v2/agents \\\n  -d \u0026#39;{\n        \u0026quot;email\u0026quot;: \u0026quot;attacker@attacker.com\u0026quot;, \\\n        \u0026quot;password\u0026quot;: \u0026quot;secretpassword\u0026quot;, \\\n        \u0026quot;first_name\u0026quot;: \u0026quot;attacker\u0026quot;, \\\n        \u0026quot;last_name\u0026quot;: \u0026quot;Anon\u0026quot;, \\\n        \u0026quot;display_name\u0026quot;: \u0026quot;Mr Robot\u0026quot;, \\\n        \u0026quot;enabled\u0026quot;: 1, \\\n        \u0026quot;im_server_id\u0026quot;: \u0026quot;smith\u0026quot;, \\\n      }\u0026#39; \\\n  -v  \\\n  -X POST -H \u0026quot;Authorization: Bearer `access_token_here`\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e+\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eYou could create an account ! \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4 id=\"simple-steps-to-verify\"\u003eSimple Steps To verify\u003c/h4\u003e\n\n\u003cul\u003e\n\u003cli\u003eLogin to  Agent account and Open this \n\u0026gt;\u0026gt; \u003ca title=\"https://victim2-80.terminal.com/zopadmin.html\" href=\"/redirect?url=https%3A%2F%2Fvictim2-80.terminal.com%2Fzopadmin.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://victim2-80.terminal.com/zopadmin.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eNow Click on \u0026quot; Done have access_token? Click Here\u0026quot;\u003c/li\u003e\n\u003cli\u003eIT will prompt \u0026quot;Allow Or Deny \u0026quot;  , Click on Allow\u003c/li\u003e\n\u003cli\u003eNow it will show you the \u0026quot;Access Token \u0026quot;, Copy it \u003c/li\u003e\n\u003cli\u003eNow open Owner account and disable agent account \u003c/li\u003e\n\u003cli\u003eNow go here again \u0026gt;\u0026gt; \u003ca title=\"https://victim2-80.terminal.com/zopadmin.html\" href=\"/redirect?url=https%3A%2F%2Fvictim2-80.terminal.com%2Fzopadmin.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://victim2-80.terminal.com/zopadmin.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eAnd give access_token there and Click on Submit \u003c/li\u003e\n\u003cli\u003eAn account will be created with email = \u003ca title=\"lol@gmail.com\" href=\"mailto:lol@gmail.com\" rel=\"nofollow noopener noreferrer\"\u003elol@gmail.com\u003c/a\u003e  \u0026amp; password=csrfcsrf\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch4 id=\"video-poc\"\u003eVideo POC :\u003c/h4\u003e\n\n\u003cp\u003e\u003ca title=\"https://www.youtube.com/watch?v=wZQTlmE0Lz8\u0026amp;feature=youtu.be\" href=\"/redirect?url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DwZQTlmE0Lz8%26feature%3Dyoutu.be\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.youtube.com/watch?v=wZQTlmE0Lz8\u0026amp;feature=youtu.be\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003e(Sorry for low clarity :p )\u003c/p\u003e\n\n\u003ch4 id=\"remediation\"\u003eRemediation :\u003c/h4\u003e\n\n\u003cp\u003eJust expire the \u003ccode\u003eaccess_tokens\u003c/code\u003e when the account is disabled like you do when you \u0026quot;delete\u0026quot; the account \u003c/p\u003e\n\n\u003cp\u003eLet me know if you need anything \u003c/p\u003e\n\n\u003cp\u003eRegards\u003cbr\u003e\nN B \u003c/p\u003e\n","bounty_amount":"100.0","formatted_bounty":"$100","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-10-09T16:51:49.562Z","allow_singular_disclosure_after":-164815757.6851499,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":563297,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @harshafriend4all,\n\nThank you for reporting this issue. The Zendesk Security Team will begin investigating the details of your report immediately. If the issue is verified as a security vulnerability, we will contact you with a timeline for remediation and the amount awarded for the submitted issue.\n\nRegards,\n[Zendesk Security](https://www.zendesk.com/product/features/zendesk-security/)","markdown_message":"\u003cp\u003eHello \u003ca href=\"/harshafriend4all\"\u003e@harshafriend4all\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for reporting this issue. The Zendesk Security Team will begin investigating the details of your report immediately. If the issue is verified as a security vulnerability, we will contact you with a timeline for remediation and the amount awarded for the submitted issue.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\n\u003ca href=\"/redirect?url=https%3A%2F%2Fwww.zendesk.com%2Fproduct%2Ffeatures%2Fzendesk-security%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eZendesk Security\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2015-08-26T01:07:44.010Z","updated_at":"2015-08-26T01:07:44.010Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":566132,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hello @harshafriend4all,\n\nCongratulations! Your submitted vulnerability has been validated and is in process for remediation. \n\nI also wanted to take a moment to explain that the only an administrator is able use the specified endpoint. For a successful exploit (to establish persistence), the attacker will have to have steal an admin's credentials or be an insider threat with a disabled  privilege account. \n\nLastly, you will be awarded $100 and publicly thanked for the responsible disclosure on our Hall of Fame. \n\nRegards,\n[Zendesk Security](https://www.zendesk.com/product/features/zendesk-security/)","markdown_message":"\u003cp\u003eHello \u003ca href=\"/harshafriend4all\"\u003e@harshafriend4all\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eCongratulations! Your submitted vulnerability has been validated and is in process for remediation. \u003c/p\u003e\n\n\u003cp\u003eI also wanted to take a moment to explain that the only an administrator is able use the specified endpoint. For a successful exploit (to establish persistence), the attacker will have to have steal an admin\u0026#39;s credentials or be an insider threat with a disabled  privilege account. \u003c/p\u003e\n\n\u003cp\u003eLastly, you will be awarded $100 and publicly thanked for the responsible disclosure on our Hall of Fame. \u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\n\u003ca href=\"/redirect?url=https%3A%2F%2Fwww.zendesk.com%2Fproduct%2Ffeatures%2Fzendesk-security%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eZendesk Security\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2015-08-27T19:18:54.603Z","updated_at":"2015-08-27T19:18:54.603Z","actor":{"url":"/zendesk","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/205/1f7838d9b4201d122e0a7fbacc8ff3e90f57fa0c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Zendesk"}},"bounty_amount":"100.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"zendesk","collaborator":{"username":"defmax","url":"/defmax"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":566133,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2015-08-27T19:19:10.701Z","updated_at":"2015-08-27T19:19:10.701Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":581638,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @harshafriend4all,\n\nYour submitted issue has been remediated. Can you also verify the fix before we resolve this bug?\n\nRegards,\n[Zendesk Security](https://www.zendesk.com/product/features/zendesk-security/)","markdown_message":"\u003cp\u003eHello \u003ca href=\"/harshafriend4all\"\u003e@harshafriend4all\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eYour submitted issue has been remediated. Can you also verify the fix before we resolve this bug?\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\n\u003ca href=\"/redirect?url=https%3A%2F%2Fwww.zendesk.com%2Fproduct%2Ffeatures%2Fzendesk-security%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eZendesk Security\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-08T17:45:43.692Z","updated_at":"2015-09-08T17:45:43.692Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":581929,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@noops43 \n\nYup this has been fixed, thats a quick fix :) ","markdown_message":"\u003cp\u003e\u003ca href=\"/noops43\"\u003e@noops43\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003eYup this has been fixed, thats a quick fix :) \u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-08T20:39:34.253Z","updated_at":"2015-09-08T20:39:34.253Z","actor":{"username":"defmax","cleared":false,"url":"/defmax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/759/d9f0b9418825e2418954f2cf260e32fe003c3593_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":581932,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you for participating in the Zendesk Bug Bounty program. Please feel free to reach out if you have any questions or concerns.\n\nRegards,\n[Zendesk Security](https://www.zendesk.com/product/features/zendesk-security/)","markdown_message":"\u003cp\u003eThank you for participating in the Zendesk Bug Bounty program. Please feel free to reach out if you have any questions or concerns.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\n\u003ca href=\"/redirect?url=https%3A%2F%2Fwww.zendesk.com%2Fproduct%2Ffeatures%2Fzendesk-security%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eZendesk Security\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-08T20:40:30.863Z","updated_at":"2015-09-08T20:40:30.863Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"defmax","url":"/defmax"},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":582816,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Would you mind disclosing it ? :)","markdown_message":"\u003cp\u003eWould you mind disclosing it ? :)\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-09T16:51:49.240Z","updated_at":"2015-09-09T16:52:23.673Z","first_to_agree":true,"actor":{"username":"defmax","cleared":false,"url":"/defmax","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/759/d9f0b9418825e2418954f2cf260e32fe003c3593_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":583434,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-09-10T01:23:50.779Z","updated_at":"2015-09-10T01:23:50.779Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":583435,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-09-10T01:23:51.111Z","updated_at":"2015-09-10T01:23:51.111Z","actor":{"username":"noops43","cleared":false,"url":"/noops43","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"zendesk","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}