{"id":136454,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzY0NTQ=","url":"https://hackerone.com/reports/136454","title":"User credentials leak and arbitrary local file read/leak due to same-origin-policy violation","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-05-05T12:20:49.997Z","submitted_at":"2016-05-05T12:20:49.997Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bjornruytenberg","url":"/bjornruytenberg","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":46,"url":"https://hackerone.com/ibb-flash","handle":"ibb-flash","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/046/1483b151cc84e0ff54b32196809ca3bf945812f2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/046/1483b151cc84e0ff54b32196809ca3bf945812f2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Flash (IBB)","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-11-12T09:41:37.845Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2019-10-13T09:41:36.417Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Vulnerability details\n=====================\nA vulnerability exists in Flash Player that allows violating the same-origin-policy. An attacker can read sensitive local files and communicate with remote servers. As a result, this allows uploading the content of these local files to an attacker-controlled remote server. In addition, this vulnerability enables an attacker to obtain a user's Windows logon credentials.\n\nOn February 15, I submitted this vulnerability to Mozilla and Adobe.\n\nOn February 16, this vulnerability was confirmed by Jeromie Clark of Adobe.\n\nOn April 26, I received an update from Adobe PSIRT. To mitigate the vulnerability, Adobe will introduce a new feature in Flash Player that will further restrict local filesystem access. This feature will be enabled by default. Adobe expects this feature will be available in Flash Player in Fall 2016.\n\nI understand it is customary issues are resolved and publicly acknowledged before submission to ibb-flash. However, as indicated above, a solution is not expected to arrive before Fall 2016. Considering this is a long time from now, I would like to ask whether my report can be considered for a bug bounty at this time.\n\nShould you decide to take my report into consideration at this time, I can provide a full advisory, including working PoCs for every affected host environment.\n\n\n\nCase IDs\n--------\n**Adobe**: PSIRT-5019\n**Mozilla BMO**: 1248487 / ADBE 4118316\n\n**References at Adobe familiar with this case**:\nJeromie Clark, \u003cjeclark@adobe.com\u003e\nPeleus Uhley, \u003cpuhley@adobe.com\u003e\n\n\n\nAffected host browsers\n----------------------\nAll current versions of:\n- Firefox\n- Chrome\n- Internet Explorer (8 and up)\n- Edge\n- Microsoft Office 2010, 2013 and 2016\n\n\n\nTested with\n-----------\n- Flash Player 20.0.0.306 and up\n- Windows XP, Windows 7, Windows 8.1, and Windows 10. All Windows and IE/Edge updates available to date were applied.","vulnerability_information_html":"\u003ch1 id=\"vulnerability-details\"\u003eVulnerability details\u003c/h1\u003e\n\n\u003cp\u003eA vulnerability exists in Flash Player that allows violating the same-origin-policy. An attacker can read sensitive local files and communicate with remote servers. As a result, this allows uploading the content of these local files to an attacker-controlled remote server. In addition, this vulnerability enables an attacker to obtain a user\u0026#39;s Windows logon credentials.\u003c/p\u003e\n\n\u003cp\u003eOn February 15, I submitted this vulnerability to Mozilla and Adobe.\u003c/p\u003e\n\n\u003cp\u003eOn February 16, this vulnerability was confirmed by Jeromie Clark of Adobe.\u003c/p\u003e\n\n\u003cp\u003eOn April 26, I received an update from Adobe PSIRT. To mitigate the vulnerability, Adobe will introduce a new feature in Flash Player that will further restrict local filesystem access. This feature will be enabled by default. Adobe expects this feature will be available in Flash Player in Fall 2016.\u003c/p\u003e\n\n\u003cp\u003eI understand it is customary issues are resolved and publicly acknowledged before submission to ibb-flash. However, as indicated above, a solution is not expected to arrive before Fall 2016. Considering this is a long time from now, I would like to ask whether my report can be considered for a bug bounty at this time.\u003c/p\u003e\n\n\u003cp\u003eShould you decide to take my report into consideration at this time, I can provide a full advisory, including working PoCs for every affected host environment.\u003c/p\u003e\n\n\u003ch2 id=\"case-ids\"\u003eCase IDs\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003eAdobe\u003c/strong\u003e: PSIRT-5019\u003cbr\u003e\n\u003cstrong\u003eMozilla BMO\u003c/strong\u003e: 1248487 / ADBE 4118316\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eReferences at Adobe familiar with this case\u003c/strong\u003e:\u003cbr\u003e\nJeromie Clark, \u003ca title=\"jeclark@adobe.com\" href=\"mailto:jeclark@adobe.com\" rel=\"nofollow noopener noreferrer\"\u003ejeclark@adobe.com\u003c/a\u003e\u003cbr\u003e\nPeleus Uhley, \u003ca title=\"puhley@adobe.com\" href=\"mailto:puhley@adobe.com\" rel=\"nofollow noopener noreferrer\"\u003epuhley@adobe.com\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"affected-host-browsers\"\u003eAffected host browsers\u003c/h2\u003e\n\n\u003cp\u003eAll current versions of:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eFirefox\u003c/li\u003e\n\u003cli\u003eChrome\u003c/li\u003e\n\u003cli\u003eInternet Explorer (8 and up)\u003c/li\u003e\n\u003cli\u003eEdge\u003c/li\u003e\n\u003cli\u003eMicrosoft Office 2010, 2013 and 2016\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"tested-with\"\u003eTested with\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eFlash Player 20.0.0.306 and up\u003c/li\u003e\n\u003cli\u003eWindows XP, Windows 7, Windows 8.1, and Windows 10. All Windows and IE/Edge updates available to date were applied.\u003c/li\u003e\n\u003c/ul\u003e\n","bounty_amount":"3000.0","formatted_bounty":"$3,000","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-11-12T09:41:36.490Z","allow_singular_disclosure_after":-35664291.29439399,"singular_disclosure_allowed":true,"vote_count":2,"voters":["sameerphad72","demonia"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":984963,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any news on this please?","markdown_message":"\u003cp\u003eAny news on this please?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-05-26T13:12:44.287Z","updated_at":"2016-05-26T13:12:44.287Z","actor":{"username":"bjornruytenberg","cleared":false,"url":"/bjornruytenberg","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1009489,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I would really appreciate a response. Thank you.","markdown_message":"\u003cp\u003eI would really appreciate a response. Thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-06-11T17:12:23.485Z","updated_at":"2016-06-11T17:12:23.485Z","actor":{"username":"bjornruytenberg","cleared":false,"url":"/bjornruytenberg","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1035877,"is_internal":false,"editable":false,"type":"Activities::HackerRequestedMediation","message":"On May 5th I submitted a report to ibb-flash. As I received no reply, on May 26th, and again on June 11th, I asked whether there is any news on my report. However, to date (June 24th), I have not received any reply at all.\n\nI would highly appreciate a response on my report. Thank you.","markdown_message":"\u003cp\u003eOn May 5th I submitted a report to ibb-flash. As I received no reply, on May 26th, and again on June 11th, I asked whether there is any news on my report. However, to date (June 24th), I have not received any reply at all.\u003c/p\u003e\n\n\u003cp\u003eI would highly appreciate a response on my report. Thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-06-24T18:26:41.803Z","updated_at":"2016-06-24T18:26:41.803Z","actor":{"username":"bjornruytenberg","cleared":false,"url":"/bjornruytenberg","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1055185,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @bjrnnl -\n\nApologies for the delay. This is an unusual case. We haven't awarded bounties in the past without full visibility into the issue, and it's unlikely that we'll be able to make an exception as the panel should not be in possession of working PoCs for unresolved vulnerabilities. We're checking with Adobe PSIRT on if it's possible to make a bounty assessment here without divulging exploit information.\n\nThanks,\nAlex","markdown_message":"\u003cp\u003eHi \u003ca href=\"/bjrnnl\"\u003e@bjrnnl\u003c/a\u003e -\u003c/p\u003e\n\n\u003cp\u003eApologies for the delay. This is an unusual case. We haven\u0026#39;t awarded bounties in the past without full visibility into the issue, and it\u0026#39;s unlikely that we\u0026#39;ll be able to make an exception as the panel should not be in possession of working PoCs for unresolved vulnerabilities. We\u0026#39;re checking with Adobe PSIRT on if it\u0026#39;s possible to make a bounty assessment here without divulging exploit information.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\nAlex\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-06T08:50:47.030Z","updated_at":"2016-07-06T08:50:47.030Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1127510,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Dear Mr Rice,\n\nThanks for your message. I realise this is an unusual case and appreciate your efforts to find additional ways to obtain information necessary for bounty assessment.\n\nUnfortunately, however, I have to note another six weeks have passed, and three and a half months in total since I submitted my report to ibb-flash. In my opinion this is quite a long time.\n\nIf Adobe PSIRT has provided the necessary information by now, can you indicate when you expect the panel to reach a decision?\n\nIf not, is there anything I can do to speed up this process?\n\nBest regards,\nBjörn Ruytenberg","markdown_message":"\u003cp\u003eDear Mr Rice,\u003c/p\u003e\n\n\u003cp\u003eThanks for your message. I realise this is an unusual case and appreciate your efforts to find additional ways to obtain information necessary for bounty assessment.\u003c/p\u003e\n\n\u003cp\u003eUnfortunately, however, I have to note another six weeks have passed, and three and a half months in total since I submitted my report to ibb-flash. In my opinion this is quite a long time.\u003c/p\u003e\n\n\u003cp\u003eIf Adobe PSIRT has provided the necessary information by now, can you indicate when you expect the panel to reach a decision?\u003c/p\u003e\n\n\u003cp\u003eIf not, is there anything I can do to speed up this process?\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nBjörn Ruytenberg\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-15T18:10:38.774Z","updated_at":"2016-08-15T18:10:38.774Z","actor":{"username":"bjornruytenberg","cleared":false,"url":"/bjornruytenberg","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1232110,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I have just been informed by Adobe PSIRT this security vulnerability has been resolved in the most recent version of Flash Player (23.0.0.162).\n\nDetails can be found at:\nhttps://helpx.adobe.com/security/products/flash-player/apsb16-29.html\n\nI have noticed ibb-flash no longer awards bounties. However, seeing as I submitted this report five months ago, I assume my submission will still be processed.\n\nI am looking forward to your response.","markdown_message":"\u003cp\u003eI have just been informed by Adobe PSIRT this security vulnerability has been resolved in the most recent version of Flash Player (23.0.0.162).\u003c/p\u003e\n\n\u003cp\u003eDetails can be found at:\u003cbr\u003e\n\u003ca title=\"https://helpx.adobe.com/security/products/flash-player/apsb16-29.html\" href=\"/redirect?url=https%3A%2F%2Fhelpx.adobe.com%2Fsecurity%2Fproducts%2Fflash-player%2Fapsb16-29.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://helpx.adobe.com/security/products/flash-player/apsb16-29.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI have noticed ibb-flash no longer awards bounties. However, seeing as I submitted this report five months ago, I assume my submission will still be processed.\u003c/p\u003e\n\n\u003cp\u003eI am looking forward to your response.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-10-04T20:24:00.795Z","updated_at":"2016-10-04T20:24:00.795Z","actor":{"username":"bjornruytenberg","cleared":false,"url":"/bjornruytenberg","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1232513,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Please find below my original report:\n\n\n\nWindows user credentials leak and arbitrary local file read/leak due to same-origin-policy violation\n====================\n\nWhen opening a local SWF file, the SWF is intended to run in the default Flash Player sandbox, which is 'local-with-filesystem'. From Adobe:\n\u003e\"For security purposes, Flash Player places all local SWF files and assets in the local-with-file-system sandbox, by default. From this sandbox, SWF files can read local files (by using the URLLoader class, for example), but they cannot communicate with the network in any way. This assures the user that local data cannot be leaked out to the network or otherwise inappropriately shared.\" ([Adobe AS3 Developers Guide](http://help.adobe.com/en_US/as3/dev/WS5b3ccc516d4fbf351e63e3d118a9b90204-7e3f.html))\n\nHowever, a security vulnerability exists that allows bypassing this sandbox. Using the file:// URI this allows reading local files and communicating with SMB servers. As a result, this allows uploading the content of these local files to an arbitrary remote SMB server, and leaking the Windows account credentials of the user running the Flash Player process.\n\n\nAffected host environments\n---------------------\n\nAll current versions of:\n\n    Firefox\n    Chrome\n    Internet Explorer (8 and up)\n    Edge\n    Microsoft Office 2010, 2013 and 2016\n\n\t\nTested with\n---------------------\n    Flash Player 20.0.0.306 and up\n    Windows XP, Windows 7, Windows 8.1, and Windows 10. All Windows and IE/Edge updates available to date were applied.\n\n\n\nProof of Concept\n---------------------\n\nThe PoC consists of two versions:\n\tpoc_browsers.zip: contains the PoC for the affected host browsers.\n\tpoc_msoffice.zip: contains the PoC for the affected versions of Microsoft Office.\n\t\n\t\n### Steps to reproduce - Browsers\n\n1. Extract poc_browsers.zip somewhere. The ZIP contains two files, \"poc.html\" and \"poc.swf\".\n2. Open \"poc.html\" in Firefox\n3. Observe that the PoC does the following:\n- Opens file:///C:/Windows/System32/drivers/etc/hosts and reads the file\n- Takes the url file://///192.168.1.100/, appends it with the first 90 bytes of the file above, then makes the SMB request\n\nAs follows from the above the PoC connects to 192.168.1.100. Make sure a Windows machine with an active SMB server is running on that IP. Then use Wireshark to observe that indeed the request is made and received at the target machine. Alternatively, run smbtrap on the target machine (see below for more info).\n\nThe content of the Windows hosts file is printed in the Flash applet. Afterwards, it makes Windows connect to an SMB server that runs on 192.168.1.100.\n- By doing this, Windows exposes the credentials of the currently logged on user to the SMB server. This includes the username as well as an NTLM hash of the user's password. However, this hash can be easily bruteforced, allowing an attacker to retrieve the password. Please see the attached screenshot (smbtrap_win10_winxp.png) in which I use smbtrap to demonstrate this.\n- Having the ability to connect to an SMB server is sufficient to leak the content of an arbitrary local file. This can be done by simply appending the content of the file to the requested URL, like so: \"file://///192.168.1.100/file_content_here/\". These requests can be sniffed by the attacker on the targeted machine, allowing the attacker to retrieve the content of the local file.\n\n\n### Steps to reproduce - Microsoft Office\n\n1. Extract poc_msoffice.zip somewhere. The ZIP contains two files: \"poc.docx\" and \"poc.xlsx\".\n2. Open these files in Word or Excel, respectively.\nNote that the PoC consists of one file; the SWF is embedded inside the Office document.\n3. Observe that the PoC does the following:\n- Opens file:///C:/Windows/System32/drivers/etc/hosts and reads the file\n- Takes the url file://///192.168.2.106/, appends it with the first 90 bytes of the file above, then makes the SMB request\n\n\n### Additional remarks\n- Browser PoC: the SWF could potentially be embedded into the HTML file by means of a data URI. Similar to the Office PoC, having a single file would enable an attacker to distribute it more easily.\n- There are some restrictions on the SMB URL's length. If it is too long, the SMB request will not be completed. For demonstration purposes, this PoC reads and transmits only the first 90 bytes of the Windows hosts file. However, by splitting a file in parts and making a series of SMB requests, one for each part, the entire content of a file can be transferred.\n\nThe attached poc_screenshots.zip contains the following:\n- browser_win10.png, browser_win7.png: Shows the browser PoC on Firefox, Windows 10 and Windows 7.\n- office2013_win81.png: Shows the PoC on Microsoft Office 2013.\n- smbtrap_win10_winxp.png: Smbtrap output for Windows 10 and Windows XP.\n- wireshark_trace.png: Screenshot of a wireshark trace that shows the SMB requests, including one in which a part of the Windows hosts file was sent.\n\n\nReferences\n---------------------\nSmbtrap - https://github.com/CylanceSPEAR/SMBTrap","markdown_message":"\u003cp\u003ePlease find below my original report:\u003c/p\u003e\n\n\u003ch1 id=\"windows-user-credentials-leak-and-arbitrary-local-file-read-leak-due-to-same-origin-policy-violation\"\u003eWindows user credentials leak and arbitrary local file read/leak due to same-origin-policy violation\u003c/h1\u003e\n\n\u003cp\u003eWhen opening a local SWF file, the SWF is intended to run in the default Flash Player sandbox, which is \u0026#39;local-with-filesystem\u0026#39;. From Adobe:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u0026quot;For security purposes, Flash Player places all local SWF files and assets in the local-with-file-system sandbox, by default. From this sandbox, SWF files can read local files (by using the URLLoader class, for example), but they cannot communicate with the network in any way. This assures the user that local data cannot be leaked out to the network or otherwise inappropriately shared.\u0026quot; (\u003ca href=\"/redirect?url=http%3A%2F%2Fhelp.adobe.com%2Fen_US%2Fas3%2Fdev%2FWS5b3ccc516d4fbf351e63e3d118a9b90204-7e3f.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eAdobe AS3 Developers Guide\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eHowever, a security vulnerability exists that allows bypassing this sandbox. Using the file:// URI this allows reading local files and communicating with SMB servers. As a result, this allows uploading the content of these local files to an arbitrary remote SMB server, and leaking the Windows account credentials of the user running the Flash Player process.\u003c/p\u003e\n\n\u003ch2 id=\"affected-host-environments\"\u003eAffected host environments\u003c/h2\u003e\n\n\u003cp\u003eAll current versions of:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eFirefox\nChrome\nInternet Explorer (8 and up)\nEdge\nMicrosoft Office 2010, 2013 and 2016\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"tested-with\"\u003eTested with\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eFlash Player 20.0.0.306 and up\nWindows XP, Windows 7, Windows 8.1, and Windows 10. All Windows and IE/Edge updates available to date were applied.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"proof-of-concept\"\u003eProof of Concept\u003c/h2\u003e\n\n\u003cp\u003eThe PoC consists of two versions:\u003cbr\u003e\n    poc_browsers.zip: contains the PoC for the affected host browsers.\u003cbr\u003e\n    poc_msoffice.zip: contains the PoC for the affected versions of Microsoft Office.\u003c/p\u003e\n\n\u003ch3 id=\"steps-to-reproduce-browsers\"\u003eSteps to reproduce - Browsers\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003eExtract poc_browsers.zip somewhere. The ZIP contains two files, \u0026quot;poc.html\u0026quot; and \u0026quot;poc.swf\u0026quot;.\u003c/li\u003e\n\u003cli\u003eOpen \u0026quot;poc.html\u0026quot; in Firefox\u003c/li\u003e\n\u003cli\u003eObserve that the PoC does the following:\u003c/li\u003e\n\u003cli\u003eOpens file:///C:/Windows/System32/drivers/etc/hosts and reads the file\u003c/li\u003e\n\u003cli\u003eTakes the url file://///192.168.1.100/, appends it with the first 90 bytes of the file above, then makes the SMB request\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAs follows from the above the PoC connects to 192.168.1.100. Make sure a Windows machine with an active SMB server is running on that IP. Then use Wireshark to observe that indeed the request is made and received at the target machine. Alternatively, run smbtrap on the target machine (see below for more info).\u003c/p\u003e\n\n\u003cp\u003eThe content of the Windows hosts file is printed in the Flash applet. Afterwards, it makes Windows connect to an SMB server that runs on 192.168.1.100.\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBy doing this, Windows exposes the credentials of the currently logged on user to the SMB server. This includes the username as well as an NTLM hash of the user\u0026#39;s password. However, this hash can be easily bruteforced, allowing an attacker to retrieve the password. Please see the attached screenshot (smbtrap_win10_winxp.png) in which I use smbtrap to demonstrate this.\u003c/li\u003e\n\u003cli\u003eHaving the ability to connect to an SMB server is sufficient to leak the content of an arbitrary local file. This can be done by simply appending the content of the file to the requested URL, like so: \u0026quot;file://///192.168.1.100/file_content_here/\u0026quot;. These requests can be sniffed by the attacker on the targeted machine, allowing the attacker to retrieve the content of the local file.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3 id=\"steps-to-reproduce-microsoft-office\"\u003eSteps to reproduce - Microsoft Office\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003eExtract poc_msoffice.zip somewhere. The ZIP contains two files: \u0026quot;poc.docx\u0026quot; and \u0026quot;poc.xlsx\u0026quot;.\u003c/li\u003e\n\u003cli\u003eOpen these files in Word or Excel, respectively.\nNote that the PoC consists of one file; the SWF is embedded inside the Office document.\u003c/li\u003e\n\u003cli\u003eObserve that the PoC does the following:\u003c/li\u003e\n\u003cli\u003eOpens file:///C:/Windows/System32/drivers/etc/hosts and reads the file\u003c/li\u003e\n\u003cli\u003eTakes the url file://///192.168.2.106/, appends it with the first 90 bytes of the file above, then makes the SMB request\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3 id=\"additional-remarks\"\u003eAdditional remarks\u003c/h3\u003e\n\n\u003cul\u003e\n\u003cli\u003eBrowser PoC: the SWF could potentially be embedded into the HTML file by means of a data URI. Similar to the Office PoC, having a single file would enable an attacker to distribute it more easily.\u003c/li\u003e\n\u003cli\u003eThere are some restrictions on the SMB URL\u0026#39;s length. If it is too long, the SMB request will not be completed. For demonstration purposes, this PoC reads and transmits only the first 90 bytes of the Windows hosts file. However, by splitting a file in parts and making a series of SMB requests, one for each part, the entire content of a file can be transferred.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe attached poc_screenshots.zip contains the following:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ebrowser_win10.png, browser_win7.png: Shows the browser PoC on Firefox, Windows 10 and Windows 7.\u003c/li\u003e\n\u003cli\u003eoffice2013_win81.png: Shows the PoC on Microsoft Office 2013.\u003c/li\u003e\n\u003cli\u003esmbtrap_win10_winxp.png: Smbtrap output for Windows 10 and Windows XP.\u003c/li\u003e\n\u003cli\u003ewireshark_trace.png: Screenshot of a wireshark trace that shows the SMB requests, including one in which a part of the Windows hosts file was sent.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"references\"\u003eReferences\u003c/h2\u003e\n\n\u003cp\u003eSmbtrap - \u003ca title=\"https://github.com/CylanceSPEAR/SMBTrap\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FCylanceSPEAR%2FSMBTrap\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/CylanceSPEAR/SMBTrap\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2016-10-05T00:24:28.156Z","updated_at":"2016-10-05T00:24:28.156Z","actor":{"username":"bjornruytenberg","cleared":false,"url":"/bjornruytenberg","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":125683,"filename":"poc_screenshots.zip","type":"application/zip","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/125/683/3f945adf0bfd031ff5e2f9b1d479fd8db98ddea1/poc_screenshots.zip?response-content-disposition=attachment%3B%20filename%3D%22poc_screenshots.zip%22%3B%20filename%2A%3DUTF-8%27%27poc_screenshots.zip\u0026response-content-type=application%2Fzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXIKMJWH3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T042628Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHST0svsvt2laJhuwhvtFHhDNQQ1aKmdn3kMewysqUdFAiEAulql%2B612sAbGAOHB%2F14rmdeeoxU5d8%2BAmcu4RPg%2BHwYqtAMIUhABGgwwMTM2MTkyNzQ4NDkiDCOZXQ8CegoYVtnSUSqRAzpFu%2FKSCAPO9FvY239VSQoXSErgwDzOUTpVgc827sUNqeCED0HHoCoUKyy9kO1lyu0kSFcQXf%2BvW4%2FHwxvZX6%2BphIjx2iPQX6fNNwXKcgYQYxZ8Yx%2BGm7ZXLO%2Bu7Mdu4Fn%2B9TpJQODzePG4VEMMVtb0e6FjQNUF4kQegXC133f3aM6cYX7uAbjyFy7JY7I765EFvdZteqLx2HbWaDGqldcnvslHjs3kmodLKwk9H0Ue0DoWQaLX8Vd2A0w%2FRaO%2FD7%2FQ8PGTn1qam8KaVgzORyAVZ6DxjOPjltRKnxLgyDYBYkhJ4QrBrnmUJPgQMGGWlKZ9SGJYACF0xI0BTQYivNwVfXoTMKUGwE35iziKLaZ5lyBmkqGem%2B%2FfByDZktR%2BpZGSBgSAr1UOE7ov9eb7NhNIuMzcYuOJ1sDR5pR5AlZ4GHJ8eFAlsbYZ1%2B%2F1eXzICdlYRCTp7FQRaLOJji%2BGrr7%2BDGcfEbEP64XGp9sIHjMhhaQcRwVNC6OPA5jdwFCmOnkfeeCoszPtP9ulj%2BvRBs4QMJSFqv8FOusBWzRAvPHoeI1kjG3%2Bj8jYuqVFp2PPU1q0JXR0Ajo08RGvNLJbNpVdip6BBBoiu8PCrCZDZIOwjGA3KcL5o1c4azKc2WVxPog81MB%2FMbDqzX0ad%2FLlmri78RdsSnSIX3Tn18ZdjfTGjol%2FjXedojL6GsI5pB1YlY0EqbQvBnSvbUvPa2Yr7haLR%2FQ%2FG8J8lEfc9mqMV9Imaj1ospS%2BNuCXAlVOb%2F0ya3%2BR4cs2EQotvOugeHotyPJlDfJL6Pqjp0Z9ECJu9QNa4Vn1w2ANPlIUFD2oD6RnsM%2BFR3kpEUChJsMjzZDlljBwhF14Ww%3D%3D\u0026X-Amz-Signature=f93b35b417fb23b808e749647c76da67c3df2b2526715267c8c9ea961b70ffe6"},{"id":125682,"filename":"poc_msoffice.zip","type":"application/zip","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/125/682/8751af3e836aaeb3008860f26094c87f264ca28e/poc_msoffice.zip?response-content-disposition=attachment%3B%20filename%3D%22poc_msoffice.zip%22%3B%20filename%2A%3DUTF-8%27%27poc_msoffice.zip\u0026response-content-type=application%2Fzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXIKMJWH3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T042628Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHST0svsvt2laJhuwhvtFHhDNQQ1aKmdn3kMewysqUdFAiEAulql%2B612sAbGAOHB%2F14rmdeeoxU5d8%2BAmcu4RPg%2BHwYqtAMIUhABGgwwMTM2MTkyNzQ4NDkiDCOZXQ8CegoYVtnSUSqRAzpFu%2FKSCAPO9FvY239VSQoXSErgwDzOUTpVgc827sUNqeCED0HHoCoUKyy9kO1lyu0kSFcQXf%2BvW4%2FHwxvZX6%2BphIjx2iPQX6fNNwXKcgYQYxZ8Yx%2BGm7ZXLO%2Bu7Mdu4Fn%2B9TpJQODzePG4VEMMVtb0e6FjQNUF4kQegXC133f3aM6cYX7uAbjyFy7JY7I765EFvdZteqLx2HbWaDGqldcnvslHjs3kmodLKwk9H0Ue0DoWQaLX8Vd2A0w%2FRaO%2FD7%2FQ8PGTn1qam8KaVgzORyAVZ6DxjOPjltRKnxLgyDYBYkhJ4QrBrnmUJPgQMGGWlKZ9SGJYACF0xI0BTQYivNwVfXoTMKUGwE35iziKLaZ5lyBmkqGem%2B%2FfByDZktR%2BpZGSBgSAr1UOE7ov9eb7NhNIuMzcYuOJ1sDR5pR5AlZ4GHJ8eFAlsbYZ1%2B%2F1eXzICdlYRCTp7FQRaLOJji%2BGrr7%2BDGcfEbEP64XGp9sIHjMhhaQcRwVNC6OPA5jdwFCmOnkfeeCoszPtP9ulj%2BvRBs4QMJSFqv8FOusBWzRAvPHoeI1kjG3%2Bj8jYuqVFp2PPU1q0JXR0Ajo08RGvNLJbNpVdip6BBBoiu8PCrCZDZIOwjGA3KcL5o1c4azKc2WVxPog81MB%2FMbDqzX0ad%2FLlmri78RdsSnSIX3Tn18ZdjfTGjol%2FjXedojL6GsI5pB1YlY0EqbQvBnSvbUvPa2Yr7haLR%2FQ%2FG8J8lEfc9mqMV9Imaj1ospS%2BNuCXAlVOb%2F0ya3%2BR4cs2EQotvOugeHotyPJlDfJL6Pqjp0Z9ECJu9QNa4Vn1w2ANPlIUFD2oD6RnsM%2BFR3kpEUChJsMjzZDlljBwhF14Ww%3D%3D\u0026X-Amz-Signature=2e1b9ab0e6705ee7d773078d564e793e91fec46e6841acfac59d1c96ace56084"},{"id":125681,"filename":"poc_browser.zip","type":"application/zip","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/125/681/38caac05b1eb1d3d793b7422178d867212851837/poc_browser.zip?response-content-disposition=attachment%3B%20filename%3D%22poc_browser.zip%22%3B%20filename%2A%3DUTF-8%27%27poc_browser.zip\u0026response-content-type=application%2Fzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXIKMJWH3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T042628Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHST0svsvt2laJhuwhvtFHhDNQQ1aKmdn3kMewysqUdFAiEAulql%2B612sAbGAOHB%2F14rmdeeoxU5d8%2BAmcu4RPg%2BHwYqtAMIUhABGgwwMTM2MTkyNzQ4NDkiDCOZXQ8CegoYVtnSUSqRAzpFu%2FKSCAPO9FvY239VSQoXSErgwDzOUTpVgc827sUNqeCED0HHoCoUKyy9kO1lyu0kSFcQXf%2BvW4%2FHwxvZX6%2BphIjx2iPQX6fNNwXKcgYQYxZ8Yx%2BGm7ZXLO%2Bu7Mdu4Fn%2B9TpJQODzePG4VEMMVtb0e6FjQNUF4kQegXC133f3aM6cYX7uAbjyFy7JY7I765EFvdZteqLx2HbWaDGqldcnvslHjs3kmodLKwk9H0Ue0DoWQaLX8Vd2A0w%2FRaO%2FD7%2FQ8PGTn1qam8KaVgzORyAVZ6DxjOPjltRKnxLgyDYBYkhJ4QrBrnmUJPgQMGGWlKZ9SGJYACF0xI0BTQYivNwVfXoTMKUGwE35iziKLaZ5lyBmkqGem%2B%2FfByDZktR%2BpZGSBgSAr1UOE7ov9eb7NhNIuMzcYuOJ1sDR5pR5AlZ4GHJ8eFAlsbYZ1%2B%2F1eXzICdlYRCTp7FQRaLOJji%2BGrr7%2BDGcfEbEP64XGp9sIHjMhhaQcRwVNC6OPA5jdwFCmOnkfeeCoszPtP9ulj%2BvRBs4QMJSFqv8FOusBWzRAvPHoeI1kjG3%2Bj8jYuqVFp2PPU1q0JXR0Ajo08RGvNLJbNpVdip6BBBoiu8PCrCZDZIOwjGA3KcL5o1c4azKc2WVxPog81MB%2FMbDqzX0ad%2FLlmri78RdsSnSIX3Tn18ZdjfTGjol%2FjXedojL6GsI5pB1YlY0EqbQvBnSvbUvPa2Yr7haLR%2FQ%2FG8J8lEfc9mqMV9Imaj1ospS%2BNuCXAlVOb%2F0ya3%2BR4cs2EQotvOugeHotyPJlDfJL6Pqjp0Z9ECJu9QNa4Vn1w2ANPlIUFD2oD6RnsM%2BFR3kpEUChJsMjzZDlljBwhF14Ww%3D%3D\u0026X-Amz-Signature=caf9ba434b0a371b7e5fcab3f4316fcc3365dff61bc8d2f1cbe9e5c878349205"}],"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1273053,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-10-28T16:13:06.119Z","updated_at":"2016-10-28T16:13:06.119Z","actor":{"url":"/ibb-flash","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/046/1483b151cc84e0ff54b32196809ca3bf945812f2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Flash (IBB)"}},"bounty_amount":"3000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"ibb-flash","collaborator":{"username":"bjornruytenberg","url":"/bjornruytenberg"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1273054,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-10-28T16:13:14.737Z","updated_at":"2016-10-28T16:13:14.737Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"bjornruytenberg","url":"/bjornruytenberg"},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6026581,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-13T09:41:36.432Z","updated_at":"2019-10-13T09:41:36.432Z","first_to_agree":true,"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6285883,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-12T09:41:37.866Z","updated_at":"2019-11-12T09:41:37.866Z","actor":{"url":"/ibb-flash","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/046/1483b151cc84e0ff54b32196809ca3bf945812f2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Flash (IBB)"}},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}