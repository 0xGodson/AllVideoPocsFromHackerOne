{"id":809,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84MDk=","url":"https://hackerone.com/reports/809","title":"Improperly implemented password recovery link functionality","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-01-27T20:49:36.770Z","submitted_at":"2014-01-27T20:49:36.770Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"dawidczagan","url":"/dawidczagan","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/213/b21bcd2c35e03d6e74c0f09d4fc55148249f121e_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":18,"url":"https://hackerone.com/phabricator","handle":"phabricator","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Phabricator","twitter_handle":"phabricator","website":"http://phacility.com/phabricator/","about":"Phabricator is a collection of open source web applications that help software companies build better software."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-02-27T00:54:55.437Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2014-01-28T00:57:58.908Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I took a look at live install of Phabricator (https://secure.phabricator.com/) and noticed, that the user gets automatically logged in after clicking the password recovery link (this link is sent to the user's mail). This authentication takes place before the user is asked to enter a new password twice. This can be used be the attacker to log in a user to the attacker's account - the attacker generates a password recovery link to his account, sends it to the user and the user becomes logged in to the attacker's account, when he clicks the link delivered by the attacker.","vulnerability_information_html":"\u003cp\u003eI took a look at live install of Phabricator (\u003ca title=\"https://secure.phabricator.com/\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) and noticed, that the user gets automatically logged in after clicking the password recovery link (this link is sent to the user\u0026#39;s mail). This authentication takes place before the user is asked to enter a new password twice. This can be used be the attacker to log in a user to the attacker\u0026#39;s account - the attacker generates a password recovery link to his account, sends it to the user and the user becomes logged in to the attacker\u0026#39;s account, when he clicks the link delivered by the attacker.\u003c/p\u003e\n","bounty_amount":"300.0","formatted_bounty":"$300","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-02-27T00:54:52.639Z","allow_singular_disclosure_after":-215762507.23225033,"singular_disclosure_allowed":true,"vote_count":5,"voters":["mrtuxracer","r3y","ameerpornillos","cryptographer","spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":4382,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks! I think the severity here is low, but this workflow definitely has some issues.\n\nWe can't always prompt for a new password before logging in because there may be no password provider (that is, an install may not allow users to login with passwords at all). However:\n\n1) We should prevent you from recovering an account if you're already logged in.\n2) We should prompt you to confirm the login and CSRF the action.\n\nDoes that cover it? Anything else that I'm missing?\n\nI'll work on getting this patched, although one of my usual reviewers is on vacation this week so it may take a little longer than usual to get reviewed/deployed.","markdown_message":"\u003cp\u003eThanks! I think the severity here is low, but this workflow definitely has some issues.\u003c/p\u003e\n\n\u003cp\u003eWe can\u0026#39;t always prompt for a new password before logging in because there may be no password provider (that is, an install may not allow users to login with passwords at all). However:\u003c/p\u003e\n\n\u003cp\u003e1) We should prevent you from recovering an account if you\u0026#39;re already logged in.\u003cbr\u003e\n2) We should prompt you to confirm the login and CSRF the action.\u003c/p\u003e\n\n\u003cp\u003eDoes that cover it? Anything else that I\u0026#39;m missing?\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ll work on getting this patched, although one of my usual reviewers is on vacation this week so it may take a little longer than usual to get reviewed/deployed.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-01-27T20:58:34.057Z","updated_at":"2014-01-27T20:58:34.057Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4385,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"When a user wants to reset a password - send him a link with a long and unpredictable token. Make this link valid for short period of time. When the token has already been used, make this link invalid.. The user enters new password twice (add a CSRF token to the form). When successfully done, the user gets an information that the password has been changed (no need to disclose the login of the user), Don't automatically log in a user - the user should provide a username and a new password to log in.","markdown_message":"\u003cp\u003eWhen a user wants to reset a password - send him a link with a long and unpredictable token. Make this link valid for short period of time. When the token has already been used, make this link invalid.. The user enters new password twice (add a CSRF token to the form). When successfully done, the user gets an information that the password has been changed (no need to disclose the login of the user), Don\u0026#39;t automatically log in a user - the user should provide a username and a new password to log in.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-01-27T21:25:50.712Z","updated_at":"2014-01-27T21:25:50.712Z","actor":{"username":"dawidczagan","cleared":false,"url":"/dawidczagan","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/213/b21bcd2c35e03d6e74c0f09d4fc55148249f121e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4386,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This should be resolved by:\n\nhttps://secure.phabricator.com/D8079\n\nI'll commit it in a few hours if btrahan hasn't had a chance to look at it by then.\n\nWe can not require the user to enter a new password in order to login because installs may not support password authentication. Instead, we now require them to click a CSRF'd form button which says \"Login (user@domain.com)\".","markdown_message":"\u003cp\u003eThis should be resolved by:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://secure.phabricator.com/D8079\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2FD8079\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/D8079\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ll commit it in a few hours if btrahan hasn\u0026#39;t had a chance to look at it by then.\u003c/p\u003e\n\n\u003cp\u003eWe can not require the user to enter a new password in order to login because installs may not support password authentication. Instead, we now require them to click a CSRF\u0026#39;d form button which says \u0026quot;Login (\u003ca title=\"user@domain.com\" href=\"mailto:user@domain.com\" rel=\"nofollow noopener noreferrer\"\u003euser@domain.com\u003c/a\u003e)\u0026quot;.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-01-27T21:30:09.897Z","updated_at":"2014-01-27T21:30:09.897Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4396,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This should now be fixed in HEAD:\n\nhttps://secure.phabricator.com/rP152f05aebed00c486fcc32430f3a46c76470c188","markdown_message":"\u003cp\u003eThis should now be fixed in HEAD:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://secure.phabricator.com/rP152f05aebed00c486fcc32430f3a46c76470c188\" href=\"/redirect?url=https%3A%2F%2Fsecure.phabricator.com%2FrP152f05aebed00c486fcc32430f3a46c76470c188\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://secure.phabricator.com/rP152f05aebed00c486fcc32430f3a46c76470c188\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2014-01-28T00:54:52.724Z","updated_at":"2014-01-28T00:54:52.724Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"dawidczagan","url":"/dawidczagan"},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4397,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"I'm assessing this as a low-severity issue because it's only a stepping stone to more complex attacks, those attacks are theoretical, it must be targeted, the attacker must be able to register accounts, the reset links expire, and the UI is full of feedback about which account you're logged in as.","markdown_message":"\u003cp\u003eI\u0026#39;m assessing this as a low-severity issue because it\u0026#39;s only a stepping stone to more complex attacks, those attacks are theoretical, it must be targeted, the attacker must be able to register accounts, the reset links expire, and the UI is full of feedback about which account you\u0026#39;re logged in as.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-01-28T00:57:40.790Z","updated_at":"2014-01-28T00:57:40.790Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Phabricator"}},"bounty_amount":"300.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"phabricator","collaborator":{"username":"dawidczagan","url":"/dawidczagan"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4398,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"This can be publicly disclosed at any time, it's already public in the commit history.","markdown_message":"\u003cp\u003eThis can be publicly disclosed at any time, it\u0026#39;s already public in the commit history.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-01-28T00:57:58.919Z","updated_at":"2014-01-28T00:57:58.919Z","actor":{"username":"epriestley","cleared":false,"url":"/epriestley","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/043/3ebca5250ea5abd54b49ccc9d69c636af4585b2e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9662,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-02-27T00:54:55.452Z","updated_at":"2014-02-27T00:54:55.452Z","actor":{"url":"/phabricator","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/018/61446f7e6f0684c8c9f7c36c918b7ecd58183588_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Phabricator"}},"genius_execution_id":null,"team_handle":"phabricator","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}