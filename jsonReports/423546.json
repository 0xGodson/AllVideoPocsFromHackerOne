{"id":423546,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MjM1NDY=","url":"https://hackerone.com/reports/423546","title":"H1514 Wholesale customer without checkout permission can complete purchases","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-10-13T22:40:37.218Z","submitted_at":"2018-10-13T22:40:37.218Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"cablej","url":"/cablej","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/042/859/7fdafea90092a305ae2cb6cec7d43461783abf0c_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-04-10T20:24:25.101Z","bug_reporter_agreed_on_going_public_at":"2019-04-10T20:24:24.982Z","team_member_agreed_on_going_public_at":"2019-04-10T18:18:34.668Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\n\nBy default, Shopify Wholesale customers are prevented from immediately checking out:\n\n{F360280}\n\nInstead, a store admin must approve each order before the customer can pay.\n\nThis restriction can be bypassed, allowing a customer to check out orders without prior approval. This also bypasses any maximum checkout amount that a store can set.\n\n## Steps To Reproduce:\n\n  1. As a Wholesale owner, ensure that a customer is disallowed from immediately checking out at https://your-store.myshopify.com/admin/apps/wholesale/admin/shops/x/accounts.\n  1. As the customer, visit the Wholesale shop and fill your cart with products.\n  1. Observe that the UI forces the user to submit a purchase order:\n\n    {F360285}\n\n  1. To bypass this restriction, intercept the request to `PUT /purchase_orders/submit` to submit the purchase order and change the url to `/purchase_orders/update_checkout`.\n  1. Observe that executing the request will allow the customer to proceed through the checkout flow and place the order:\n\n{F360296}\n\n## Impact\n\nThis allows a customer to bypass manual approval restrictions for a Wholesale store and immediately check out.","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eBy default, Shopify Wholesale customers are prevented from immediately checking out:\u003c/p\u003e\n\n\u003cp\u003e{F360280}\u003c/p\u003e\n\n\u003cp\u003eInstead, a store admin must approve each order before the customer can pay.\u003c/p\u003e\n\n\u003cp\u003eThis restriction can be bypassed, allowing a customer to check out orders without prior approval. This also bypasses any maximum checkout amount that a store can set.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eAs a Wholesale owner, ensure that a customer is disallowed from immediately checking out at \u003ca title=\"https://your-store.myshopify.com/admin/apps/wholesale/admin/shops/x/accounts\" href=\"/redirect?url=https%3A%2F%2Fyour-store.myshopify.com%2Fadmin%2Fapps%2Fwholesale%2Fadmin%2Fshops%2Fx%2Faccounts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://your-store.myshopify.com/admin/apps/wholesale/admin/shops/x/accounts\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eAs the customer, visit the Wholesale shop and fill your cart with products.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eObserve that the UI forces the user to submit a purchase order:\u003c/p\u003e\n\n\u003cp\u003e{F360285}\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eTo bypass this restriction, intercept the request to \u003ccode\u003ePUT /purchase_orders/submit\u003c/code\u003e to submit the purchase order and change the url to \u003ccode\u003e/purchase_orders/update_checkout\u003c/code\u003e.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eObserve that executing the request will allow the customer to proceed through the checkout flow and place the order:\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e{F360296}\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThis allows a customer to bypass manual approval restrictions for a Wholesale store and immediately check out.\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":7,"voters":["mygf","cr4xerbik4sh","pwnie","cryptographer","noobhax","417c","shopify-peteryaworski"],"severity":{"rating":"medium","score":5.3,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"low","availability":"none"}},"structured_scope":{"databaseId":37198,"asset_type":"OTHER","asset_identifier":"Shopify Developed Apps","max_severity":"medium"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3476877,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @cablej,\nthanks for the report! Unfortunately, I don't think we'll have time to follow up on this tonight but will follow up with you next week.","markdown_message":"\u003cp\u003eHey \u003ca href=\"/cablej\"\u003e@cablej\u003c/a\u003e,\u003cbr\u003e\nthanks for the report! Unfortunately, I don\u0026#39;t think we\u0026#39;ll have time to follow up on this tonight but will follow up with you next week.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-13T23:55:26.774Z","updated_at":"2018-10-13T23:55:26.774Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3498659,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hey @cablej!\nThank you for your report. We have reproduced this issue and our engineering team is investigating. We'll be in touch with you soon about a bounty for this issue.","markdown_message":"\u003cp\u003eHey \u003ca href=\"/cablej\"\u003e@cablej\u003c/a\u003e!\u003cbr\u003e\nThank you for your report. We have reproduced this issue and our engineering team is investigating. We\u0026#39;ll be in touch with you soon about a bounty for this issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-18T14:41:36.177Z","updated_at":"2018-10-18T14:41:36.177Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3511218,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi @cablej, we're awarding an initial 500$ for this report and we will determine the final amount once the issue is resolved.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/cablej\"\u003e@cablej\u003c/a\u003e, we\u0026#39;re awarding an initial 500$ for this report and we will determine the final amount once the issue is resolved.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-21T20:52:02.676Z","updated_at":"2018-10-21T20:52:02.676Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"cablej","url":"/cablej"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3712267,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-26T21:08:31.042Z","updated_at":"2018-11-26T21:08:31.042Z","additional_data":{"old_severity":null,"new_severity":"Medium (5.3)","old_severity_id":null,"new_severity_id":250004},"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4012496,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @cablej,\nThanks again for your report! We have deployed a fix for this issue, and customers without wholesale checkout enabled should now be properly limited to purchase orders. This issue falls on the lower impact end of the Circumvention of user permission model for Category A. We feel that the $500 already awarded is appropriate for this issue, given that you need to be a registered customer on the wholesale store.\nThanks again for the good find, and we look forward to more reports from you!","markdown_message":"\u003cp\u003eHey \u003ca href=\"/cablej\"\u003e@cablej\u003c/a\u003e,\u003cbr\u003e\nThanks again for your report! We have deployed a fix for this issue, and customers without wholesale checkout enabled should now be properly limited to purchase orders. This issue falls on the lower impact end of the Circumvention of user permission model for Category A. We feel that the $500 already awarded is appropriate for this issue, given that you need to be a registered customer on the wholesale store.\u003cbr\u003e\nThanks again for the good find, and we look forward to more reports from you!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-01-21T17:05:26.606Z","updated_at":"2019-01-21T17:05:26.606Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"cablej","url":"/cablej"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4461932,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-03T20:25:53.719Z","updated_at":"2019-04-03T20:25:53.719Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4462424,"is_internal":false,"editable":false,"type":"Activities::CancelledDisclosureRequest","message":"Not sure if your email is public @cablej so I'm going to request the attachment be removed first","markdown_message":"\u003cp\u003eNot sure if your email is public \u003ca href=\"/cablej\"\u003e@cablej\u003c/a\u003e so I\u0026#39;m going to request the attachment be removed first\u003c/p\u003e\n","automated_response":false,"created_at":"2019-04-03T20:29:28.813Z","updated_at":"2019-04-03T20:29:28.813Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4532149,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-10T18:18:34.701Z","updated_at":"2019-04-10T18:18:34.701Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4532764,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-10T20:24:25.019Z","updated_at":"2019-04-10T20:24:25.019Z","actor":{"username":"cablej","cleared":true,"url":"/cablej","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/042/859/7fdafea90092a305ae2cb6cec7d43461783abf0c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4532765,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-04-10T20:24:25.122Z","updated_at":"2019-04-10T20:24:25.122Z","actor":{"username":"cablej","cleared":true,"url":"/cablej","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/042/859/7fdafea90092a305ae2cb6cec7d43461783abf0c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7146668,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-25T14:30:17.500Z","updated_at":"2020-02-25T14:30:17.500Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"Shopify Developed Apps","genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":13808,"category":"team","content":"The Wholesale Channel provides a configuration option to disable checkout, so that purchase orders must be reviewed by shop staff. @cablej reported that even with checkout disabled, it was possible for a customer to trigger a regular checkout flow by making a request to  /purchase_orders/update_checkout. This was fixed by checking the customer permission before allowing the use of any checkout-related endpoints for purchase orders.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eThe Wholesale Channel provides a configuration option to disable checkout, so that purchase orders must be reviewed by shop staff. \u003ca href=\"/cablej\"\u003e@cablej\u003c/a\u003e reported that even with checkout disabled, it was possible for a customer to trigger a regular checkout flow by making a request to  /purchase_orders/update_checkout. This was fixed by checking the customer permission before allowing the use of any checkout-related endpoints for purchase orders.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}