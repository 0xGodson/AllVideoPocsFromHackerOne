{"id":83971,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84Mzk3MQ==","url":"https://hackerone.com/reports/83971","title":"test1.owncloud.com: Web Server HTTP Trace/Track Method Support Cross-Site Tracing Vulnerability","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-08-22T03:29:56.202Z","submitted_at":"2015-08-22T03:29:56.202Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"ashesh","url":"/ashesh","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/003/791/220e701eb9be549162dfdb1da9b1a1b72ee2dd08_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":3059,"url":"https://hackerone.com/owncloud","handle":"owncloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/003/059/d31dc64427bbbf2e428a0b0b97bce59b98d2ba0d_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/059/d31dc64427bbbf2e428a0b0b97bce59b98d2ba0d_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"ownCloud","twitter_handle":"ownCloud","website":"https://www.owncloud.com","about":"ownCloud GmbH is the company behind the ownCloud Project - the most downloaded open source project for data and file sync, share and view."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-02-01T17:14:25.839Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2016-01-02T17:14:12.780Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"DOMAIN: test1.owncloud.com\r\nPORT: 443\r\n\r\n**THREAT:**\r\nThe Web server was detected that supports the HTTP TRACE method. This method allows debugging and connection trace analysis for connections from the client to the Web server. Per the HTTP specification, when this method is used, the Web server echoes back the information sent to it by the client unmodified and unfiltered. Microsoft IIS web server uses an alias TRACK for this method, and is functionally the same.\r\nA vulnerability related to this method was discovered. A malicious, active component in a Web page can send Trace requests to a Web server that supports this Trace method. Usually, browser security disallows access to Web sites outside of the present site's domain. Although unlikely and difficult to achieve, it's possible, in the presence of other browser vulnerabilities, for the active HTML content to make external requests to arbitrary Web servers beyond the hosting Web server. Since the chosen Web server then echoes back the client request unfiltered, the response also includes cookie-based or Web-based (if logged on) authentication credentials that the browser automatically sent to the specified Web application on the specified Web server.\r\nThe significance of the Trace capability in this vulnerability is that the active component in the page visited by the victim user has no direct access to this authentication information, but gets it after the target Web server echoes it back as its Trace response.\r\nSince this vulnerability exists as a support for a method required by the HTTP protocol specification, most common Web servers are vulnerable.\r\nThe exact method(s) supported, Trace and/or Track, and their responses are in the Results section below.\r\nTrack / Trace are required to be disabled to be PCI compliance.\r\n\r\n\r\n**IMPACT:**\r\nIf this vulnerability is successfully exploited, users of the Web server may lose their authentication credentials for the server and/or for the Web applications hosted by the server to an attacker. This may be the case even if the Web applications are not vulnerable to cross site scripting attacks due to input validation errors.\r\n\r\n**SOLUTION:**\r\nSolutions for some of the common Web servers are supplied below. For other Web servers, please check your vendor's documentation.\r\nApache: Recent Apache versions have a Rewrite module that allows HTTP requests to be rewritten or handled in a specific way. Compile the Apache server with the mod_rewrite module. You might need to uncomment the 'AddModule' and 'LoadModule' directives in the httpd.conf configuration file. Add the following lines for each virtualhost in your configuration file (Please note that, by default, Rewrite configurations are not inherited. This means that you need to have Rewrite directives for each virtual host in which you wish to use it):\r\n\r\n    \u003cIfModule mod_rewrite.c\u003e\r\n    RewriteEngine on\r\n    RewriteCond %{REQUEST_METHOD} ^TRACE\r\n    RewriteRule .* - [F]\r\n    \u003c/IfModule\u003e\r\n\r\nWith this configuration, Apache catches all TRACE requests, and replies with a page reporting the request as forbidden. None of the original request's contents are echoed back.\r\nA slightly tighter fix is to use:\r\n\r\n    \u003cIfModule mod_rewrite.c\u003e\r\n    RewriteEngine on\r\n    RewriteCond %{REQUEST_METHOD} !^(GET|POST|HEAD)$\r\n    RewriteRule .* - [F]\r\n    \u003c/IfModule\u003e\r\n\r\nPlease note that RewriteEngine can be processor intensive and may impact the web server performance. The trace method can also be controlled by use of the TraceEnable directive. \r\nIn the httpd.conf add or modify:\r\n    TraceEnable Off    \r\n\r\nMicrosoft IIS: Microsoft released URLScan, which can be used to screen all incoming requests based on customized rulesets. URLScan can be used to sanitize or disable the TRACE requests from the clients. Note that IIS aliases 'TRACK' to 'TRACE'. Therefore, if URLScan is used to specfically block the TRACE method, the TRACK method should also be added to the filter.\r\nURLScan uses the 'urlscan.ini' configuration file, usually in \\System32\\InetSrv\\URLScan directory. In that, we have two sections - AllowVerbs and DenyVerbs. The former is used if the UseAllowVerbs variable is set to 1, else (if its set to 0), the DenyVerbs are used. Clearly, either can be used, depending on whether we want a Default-Deny-Explicit-Allow or a Default-Allow-Explicit-Deny policy. To disallow TRACE and TRACK methods through URLScan, first remove 'TRACK', 'TRACE' methods from the 'AllowVerbs' section and add them to the 'DenyVerbs' section. With this, URLScan will disallow all 'TRACE' and 'TRACK' methods, and generate an error page for all requests using that method. To enable the changes, restart the 'World Wide Web Publishing Service' from the 'Services' Control Panel item.\r\n\r\nRESULTS:\r\n\r\n    TRACE /QUALYS12680.html HTTP/1.1\r\n    Host: test1.owncloud.com:443\r\n    \r\n    \r\n    \r\n    HTTP/1.1 200 OK\r\n    Date: Fri, 21 Aug 2015 10:57:04 GMT\r\n    Server: Apache/2.2.22 (Linux/SUSE)\r\n    Connection: close\r\n    Transfer-Encoding: chunked\r\n    Content-Type: message/http\r\n    \r\n    TRACE /QUALYS12680.html HTTP/1.1\r\n    Host: test1.owncloud.com:443\r\n    Connection: Keep-Alive","vulnerability_information_html":"\u003cp\u003eDOMAIN: test1.owncloud.com\u003cbr\u003e\nPORT: 443\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eTHREAT:\u003c/strong\u003e\u003cbr\u003e\nThe Web server was detected that supports the HTTP TRACE method. This method allows debugging and connection trace analysis for connections from the client to the Web server. Per the HTTP specification, when this method is used, the Web server echoes back the information sent to it by the client unmodified and unfiltered. Microsoft IIS web server uses an alias TRACK for this method, and is functionally the same.\u003cbr\u003e\nA vulnerability related to this method was discovered. A malicious, active component in a Web page can send Trace requests to a Web server that supports this Trace method. Usually, browser security disallows access to Web sites outside of the present site\u0026#39;s domain. Although unlikely and difficult to achieve, it\u0026#39;s possible, in the presence of other browser vulnerabilities, for the active HTML content to make external requests to arbitrary Web servers beyond the hosting Web server. Since the chosen Web server then echoes back the client request unfiltered, the response also includes cookie-based or Web-based (if logged on) authentication credentials that the browser automatically sent to the specified Web application on the specified Web server.\u003cbr\u003e\nThe significance of the Trace capability in this vulnerability is that the active component in the page visited by the victim user has no direct access to this authentication information, but gets it after the target Web server echoes it back as its Trace response.\u003cbr\u003e\nSince this vulnerability exists as a support for a method required by the HTTP protocol specification, most common Web servers are vulnerable.\u003cbr\u003e\nThe exact method(s) supported, Trace and/or Track, and their responses are in the Results section below.\u003cbr\u003e\nTrack / Trace are required to be disabled to be PCI compliance.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eIMPACT:\u003c/strong\u003e\u003cbr\u003e\nIf this vulnerability is successfully exploited, users of the Web server may lose their authentication credentials for the server and/or for the Web applications hosted by the server to an attacker. This may be the case even if the Web applications are not vulnerable to cross site scripting attacks due to input validation errors.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSOLUTION:\u003c/strong\u003e\u003cbr\u003e\nSolutions for some of the common Web servers are supplied below. For other Web servers, please check your vendor\u0026#39;s documentation.\u003cbr\u003e\nApache: Recent Apache versions have a Rewrite module that allows HTTP requests to be rewritten or handled in a specific way. Compile the Apache server with the mod_rewrite module. You might need to uncomment the \u0026#39;AddModule\u0026#39; and \u0026#39;LoadModule\u0026#39; directives in the httpd.conf configuration file. Add the following lines for each virtualhost in your configuration file (Please note that, by default, Rewrite configurations are not inherited. This means that you need to have Rewrite directives for each virtual host in which you wish to use it):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;IfModule mod_rewrite.c\u0026gt;\nRewriteEngine on\nRewriteCond %{REQUEST_METHOD} ^TRACE\nRewriteRule .* - [F]\n\u0026lt;/IfModule\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWith this configuration, Apache catches all TRACE requests, and replies with a page reporting the request as forbidden. None of the original request\u0026#39;s contents are echoed back.\u003cbr\u003e\nA slightly tighter fix is to use:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;IfModule mod_rewrite.c\u0026gt;\nRewriteEngine on\nRewriteCond %{REQUEST_METHOD} !^(GET|POST|HEAD)$\nRewriteRule .* - [F]\n\u0026lt;/IfModule\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ePlease note that RewriteEngine can be processor intensive and may impact the web server performance. The trace method can also be controlled by use of the TraceEnable directive. \u003cbr\u003e\nIn the httpd.conf add or modify:\u003cbr\u003e\n    TraceEnable Off    \u003c/p\u003e\n\n\u003cp\u003eMicrosoft IIS: Microsoft released URLScan, which can be used to screen all incoming requests based on customized rulesets. URLScan can be used to sanitize or disable the TRACE requests from the clients. Note that IIS aliases \u0026#39;TRACK\u0026#39; to \u0026#39;TRACE\u0026#39;. Therefore, if URLScan is used to specfically block the TRACE method, the TRACK method should also be added to the filter.\u003cbr\u003e\nURLScan uses the \u0026#39;urlscan.ini\u0026#39; configuration file, usually in \\System32\\InetSrv\\URLScan directory. In that, we have two sections - AllowVerbs and DenyVerbs. The former is used if the UseAllowVerbs variable is set to 1, else (if its set to 0), the DenyVerbs are used. Clearly, either can be used, depending on whether we want a Default-Deny-Explicit-Allow or a Default-Allow-Explicit-Deny policy. To disallow TRACE and TRACK methods through URLScan, first remove \u0026#39;TRACK\u0026#39;, \u0026#39;TRACE\u0026#39; methods from the \u0026#39;AllowVerbs\u0026#39; section and add them to the \u0026#39;DenyVerbs\u0026#39; section. With this, URLScan will disallow all \u0026#39;TRACE\u0026#39; and \u0026#39;TRACK\u0026#39; methods, and generate an error page for all requests using that method. To enable the changes, restart the \u0026#39;World Wide Web Publishing Service\u0026#39; from the \u0026#39;Services\u0026#39; Control Panel item.\u003c/p\u003e\n\n\u003cp\u003eRESULTS:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eTRACE /QUALYS12680.html HTTP/1.1\nHost: test1.owncloud.com:443\n\n\n\nHTTP/1.1 200 OK\nDate: Fri, 21 Aug 2015 10:57:04 GMT\nServer: Apache/2.2.22 (Linux/SUSE)\nConnection: close\nTransfer-Encoding: chunked\nContent-Type: message/http\n\nTRACE /QUALYS12680.html HTTP/1.1\nHost: test1.owncloud.com:443\nConnection: Keep-Alive\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-02-01T17:14:12.877Z","allow_singular_disclosure_after":-154878363.64932403,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":558358,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks for reporting this potential issue back to us.\n\nGenerally speaking having the HTTP TRACE method enabled is not implying an imminent exploitable security risk anymore nowadays as modern web browsers are not vulnerable against vectors such as Cross-Site-Tracing.\n\nHowever, as the TRACE method is not required on this server I have escalated this to the sysadmin team to disable it.","markdown_message":"\u003cp\u003eThanks for reporting this potential issue back to us.\u003c/p\u003e\n\n\u003cp\u003eGenerally speaking having the HTTP TRACE method enabled is not implying an imminent exploitable security risk anymore nowadays as modern web browsers are not vulnerable against vectors such as Cross-Site-Tracing.\u003c/p\u003e\n\n\u003cp\u003eHowever, as the TRACE method is not required on this server I have escalated this to the sysadmin team to disable it.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-08-22T07:09:05.007Z","updated_at":"2015-08-22T07:09:05.007Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"owncloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":606182,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any Updates on this issue?","markdown_message":"\u003cp\u003eAny Updates on this issue?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-10-02T02:13:50.424Z","updated_at":"2015-10-02T02:13:50.424Z","actor":{"username":"ashesh","cleared":false,"url":"/ashesh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/791/220e701eb9be549162dfdb1da9b1a1b72ee2dd08_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"owncloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":738288,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We have meanwhile shutdown this server and thus this issue has been resolved.","markdown_message":"\u003cp\u003eWe have meanwhile shutdown this server and thus this issue has been resolved.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-02T17:14:02.387Z","updated_at":"2016-01-02T17:14:02.387Z","actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"ashesh","url":"/ashesh"},"genius_execution_id":null,"team_handle":"owncloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":738289,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2016-01-02T17:14:09.071Z","updated_at":"2016-01-02T17:14:09.071Z","actor":{"url":"/owncloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/059/d31dc64427bbbf2e428a0b0b97bce59b98d2ba0d_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"ownCloud"}},"genius_execution_id":null,"team_handle":"owncloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":738290,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-01-02T17:14:12.816Z","updated_at":"2016-01-02T17:14:12.816Z","first_to_agree":true,"actor":{"username":"lukasreschke","cleared":false,"url":"/lukasreschke","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/891/e7fea4d5383dc07d1fe767b02f3bda2bc7639c63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"owncloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":779526,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-02-01T17:14:25.884Z","updated_at":"2016-02-01T17:14:25.884Z","actor":{"url":"/owncloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/059/d31dc64427bbbf2e428a0b0b97bce59b98d2ba0d_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"ownCloud"}},"genius_execution_id":null,"team_handle":"owncloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}