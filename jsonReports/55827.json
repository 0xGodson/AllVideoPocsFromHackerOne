{"id":55827,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81NTgyNw==","url":"https://hackerone.com/reports/55827","title":"iframes considered harmful","state":"Closed","substate":"informative","readable_substate":"Informative","created_at":"2015-04-11T03:14:20.722Z","submitted_at":"2015-04-11T03:14:20.722Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"androm3da","url":"/androm3da","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":104,"url":"https://hackerone.com/coinbase","handle":"coinbase","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Coinbase","twitter_handle":"","website":"https://coinbase.com/security","about":"Creating an open financial system for the world"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2015-12-01T14:06:59.994Z","bug_reporter_agreed_on_going_public_at":"2015-11-29T06:53:14.785Z","team_member_agreed_on_going_public_at":"2015-12-01T14:06:59.699Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The Coinbase API offers an iframe payment option.  iframes are attractive because they allow Coinbase's customers to give the illusion that the Bitcoin transaction is embedded entirely within the customer's website.  But customers can (and do) refer to that iframe on insecure connections.  Hijacking a transaction that's executed this way is not at all difficult.\r\n\r\nOne prominent customer (The United Way) hosts an iframe in just this fashion:\r\nhttp://www.unitedway.org/pages/donate-bitcoin-to-united-way\r\n\r\nI'd recommend the following suggestions:\r\n\r\n**Bar this use of iframes altogether, by deleting the feature from the API.**\r\n\r\nOR\r\n\r\n**Refuse to serve up the requested iframe content if the HTTP_REFERER  header is set** (return 403 or similar).  This would be effective for customers designing new Coinbase-API-iframe features because all of their testing/experimentation would fail if connected insecurely.  This depends on User Agents accepting the advice in RFC 2616: \"Clients SHOULD NOT include a referer header field in a (non-secure) HTTP request if the referring page was transferred with a secure protocol\", most of which do.  \r\n\r\nThis option leaves some risk that a customer might test this feature using a browser designed or configured to never offer the referer header.  Also, it does not directly solve the problem for existing customers.\r\n\r\n## Is this a Coinbase vulnerability?\r\nGiven that the misconfiguration/error appears to originate at Coinbase's customers' sites, how can Coinbase be held responsible?  Among trust systems, errors often occur at the interface between different realms.  This case is a classic example.  \"39,000 Businesses Trust Coinbase To Integrate Bitcoin Payments\" and they'd be disappointed to learn that some businesses lost money while they were using Coinbase to clear their bitcoin transactions.\r\n\r\nIt's a shame that some web developers wouldn't see the risk in having their financial-transaction-page communicated insecurely.  But indeed, some just don't see that risk.  Coinbase's API documentation makes no explicit indication about how Coinbase customers must secure their connection with their downstream customers, in order to protect those references to Coinbase.  And Coinbase's customers may think that the fees that they pay for transactions are such that they shouldn't need to secure their own websites.\r\n\r\n## Sample exploit\r\nAttached is `coinbase_iframe_exploit/intercept_cb.py`, a mitmproxy script, and `coinbase_iframe_exploit/cb.html`, the content to be injected in lieu of a legitimate iframe reference to Coinbase.\r\n\r\nUsing this script and mitmproxy I can hijack a donation page and accept donations to my bitcoin address instead.  I tested this on The United Way and it was effective, I saw my address instead of Coinbase's.  The testing was executed with mitmproxy local to my laptop exclusively.\r\n\r\n## Your move\r\nLeaders lead.  While it may sound scary to drop a feature that the competition has had for a while, it's what I think Coinbase needs to do in order to “be the trusted brand in the space.\"","vulnerability_information_html":"\u003cp\u003eThe Coinbase API offers an iframe payment option.  iframes are attractive because they allow Coinbase\u0026#39;s customers to give the illusion that the Bitcoin transaction is embedded entirely within the customer\u0026#39;s website.  But customers can (and do) refer to that iframe on insecure connections.  Hijacking a transaction that\u0026#39;s executed this way is not at all difficult.\u003c/p\u003e\n\n\u003cp\u003eOne prominent customer (The United Way) hosts an iframe in just this fashion:\u003cbr\u003e\n\u003ca title=\"http://www.unitedway.org/pages/donate-bitcoin-to-united-way\" href=\"/redirect?url=http%3A%2F%2Fwww.unitedway.org%2Fpages%2Fdonate-bitcoin-to-united-way\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.unitedway.org/pages/donate-bitcoin-to-united-way\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;d recommend the following suggestions:\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eBar this use of iframes altogether, by deleting the feature from the API.\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eOR\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eRefuse to serve up the requested iframe content if the HTTP_REFERER  header is set\u003c/strong\u003e (return 403 or similar).  This would be effective for customers designing new Coinbase-API-iframe features because all of their testing/experimentation would fail if connected insecurely.  This depends on User Agents accepting the advice in RFC 2616: \u0026quot;Clients SHOULD NOT include a referer header field in a (non-secure) HTTP request if the referring page was transferred with a secure protocol\u0026quot;, most of which do.  \u003c/p\u003e\n\n\u003cp\u003eThis option leaves some risk that a customer might test this feature using a browser designed or configured to never offer the referer header.  Also, it does not directly solve the problem for existing customers.\u003c/p\u003e\n\n\u003ch2 id=\"is-this-a-coinbase-vulnerability\"\u003eIs this a Coinbase vulnerability?\u003c/h2\u003e\n\n\u003cp\u003eGiven that the misconfiguration/error appears to originate at Coinbase\u0026#39;s customers\u0026#39; sites, how can Coinbase be held responsible?  Among trust systems, errors often occur at the interface between different realms.  This case is a classic example.  \u0026quot;39,000 Businesses Trust Coinbase To Integrate Bitcoin Payments\u0026quot; and they\u0026#39;d be disappointed to learn that some businesses lost money while they were using Coinbase to clear their bitcoin transactions.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026#39;s a shame that some web developers wouldn\u0026#39;t see the risk in having their financial-transaction-page communicated insecurely.  But indeed, some just don\u0026#39;t see that risk.  Coinbase\u0026#39;s API documentation makes no explicit indication about how Coinbase customers must secure their connection with their downstream customers, in order to protect those references to Coinbase.  And Coinbase\u0026#39;s customers may think that the fees that they pay for transactions are such that they shouldn\u0026#39;t need to secure their own websites.\u003c/p\u003e\n\n\u003ch2 id=\"sample-exploit\"\u003eSample exploit\u003c/h2\u003e\n\n\u003cp\u003eAttached is \u003ccode\u003ecoinbase_iframe_exploit/intercept_cb.py\u003c/code\u003e, a mitmproxy script, and \u003ccode\u003ecoinbase_iframe_exploit/cb.html\u003c/code\u003e, the content to be injected in lieu of a legitimate iframe reference to Coinbase.\u003c/p\u003e\n\n\u003cp\u003eUsing this script and mitmproxy I can hijack a donation page and accept donations to my bitcoin address instead.  I tested this on The United Way and it was effective, I saw my address instead of Coinbase\u0026#39;s.  The testing was executed with mitmproxy local to my laptop exclusively.\u003c/p\u003e\n\n\u003ch2 id=\"your-move\"\u003eYour move\u003c/h2\u003e\n\n\u003cp\u003eLeaders lead.  While it may sound scary to drop a feature that the competition has had for a while, it\u0026#39;s what I think Coinbase needs to do in order to “be the trusted brand in the space.\u0026quot;\u003c/p\u003e\n","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-12-29T06:53:15.082Z","allow_singular_disclosure_after":-157850821.98877254,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":388752,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Where is the attach files? Please provide a proof of concept and more technical details about the vulnerability, the impact of this vulnerability and any suggested fixes for this vulnerability. Including screenshots or a short video can be worth a thousand words.","markdown_message":"\u003cp\u003eWhere is the attach files? Please provide a proof of concept and more technical details about the vulnerability, the impact of this vulnerability and any suggested fixes for this vulnerability. Including screenshots or a short video can be worth a thousand words.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-04-23T23:30:13.790Z","updated_at":"2015-04-23T23:30:13.790Z","actor":{"username":"rfang","cleared":false,"url":"/rfang","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/018/716/b9797de3662a05a8bf3e58525115c4e391bb998d_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":388838,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hmm, that's odd, I can't quite say why they hadn't been uploaded before.\n\nWell, they're uploaded now.  Sorry about that.\n\nI thought I've made the impact and suggested fixes pretty clear above, but I can summarize:\n\n**Impact**\n* Hijacked transaction, redirected funds to attacker\n\n**Suggestions to fix**\n* Bar iframes\n* Refuse to serve when `Referer` http header is set","markdown_message":"\u003cp\u003eHmm, that\u0026#39;s odd, I can\u0026#39;t quite say why they hadn\u0026#39;t been uploaded before.\u003c/p\u003e\n\n\u003cp\u003eWell, they\u0026#39;re uploaded now.  Sorry about that.\u003c/p\u003e\n\n\u003cp\u003eI thought I\u0026#39;ve made the impact and suggested fixes pretty clear above, but I can summarize:\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eImpact\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eHijacked transaction, redirected funds to attacker\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003eSuggestions to fix\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBar iframes\u003c/li\u003e\n\u003cli\u003eRefuse to serve when \u003ccode\u003eReferer\u003c/code\u003e http header is set\u003c/li\u003e\n\u003c/ul\u003e\n","automated_response":false,"created_at":"2015-04-24T03:29:49.389Z","updated_at":"2015-04-24T03:29:49.389Z","actor":{"username":"androm3da","cleared":false,"url":"/androm3da","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":35867,"filename":"coinbase_iframe_exploit.tar.bz2","type":"application/x-bzip2","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/035/867/db82273d09ecf4aee90eee977fe503fab759cde4/coinbase_iframe_exploit.tar.bz2?response-content-disposition=attachment%3B%20filename%3D%22coinbase_iframe_exploit.tar.bz2%22%3B%20filename%2A%3DUTF-8%27%27coinbase_iframe_exploit.tar.bz2\u0026response-content-type=application%2Fx-bzip2\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ3Q6GNRX4%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T062017Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIB%2F4DOSXz4Uk7JQqVyIKOhXYFqWTxcD44Z3HdHcn0dvKAiEA3PYdLzeI5Kv3E9WFbSVqd%2BUBlw0212Xg7H3tNiixN5gqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDIUObNP5fEX8bJXBsSqRA%2BL7Z0plmhSxsMHnrb83ftPuhWkgvNoQbpQ66ErJF8Tab4HbvnqeuplpQgE7hhKtqBYOEsdafEq0r9zNmqA7m92b%2BxDq63GNbNVm2hS%2FrGlDOjkNPC4s9Y9jvsKbOyEaodYyGTaNp7nXzoPtsVsXWu3VzjV5rY1%2FOniQ2%2B1s8ySEdTjZaRHk8P%2FwXbNfsl1hT2TAe2rleD%2BZ%2BVAaUzHyFNU%2F1mQkQNOozyUs%2B0kWyLXo4oDuk2v6G%2B%2B%2BOffGDFiu%2F5vFGTwCcw9LcpG50TBnwx2MYUfVFlGDhzFRqqeFnE8%2BVLdMRhVxgbXYhePjinuq12WCpDVAhCJNj8IR3wEJ1%2FQoonHq3u3s4Fjef1%2Bw%2BXtypskg56dqBrrGLe95zM0RechJC4u4kZN3x7RKFnUe%2BQTgA2fsU4g%2FeYbY51bNGPKZw3ELWdMZpvEwvawS7vQJcERLBBN%2FFBpdyPI7tU9GTieNVwCAMdziMkUN3bUc%2BsG8%2BbAIpsp1R0fqA4Zzh1fBBmHnAwvAA0nggtgLe0MkU7v1MNiFq%2F8FOusBRvYvRZdkMedUg2M4tNHIP5rUiGXbyy3g4wRqI3QxmX%2FtfXzpLdSUg3BMdPDmPj8jrIy0bzAIMzEhANIb5ri2Nz0%2FfFqmnJ3rjk8e005Fnv5uK088J0m7HFCYIe7hgj40pmM5UNmkGs30hxAnycAlyRaDL94ttdw5SqAS%2FW4MMrRVIliym5o9kruL0SoyWZC0kQciksSypgYXswzm%2BAeZve49Cnzr6ikwTN3S7tncfj0WMJznDG890QvBL3O7QjntIQ6Hf9oANAQjphy38wZSi3%2FB45i5bX5Kr2E9NKFLEy5UWui5G%2BmfVfaVyg%3D%3D\u0026X-Amz-Signature=5893b11a20887c16a6621dc70b75a815601cde2c1ebe7a060b093865a373e6e0"}],"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":399457,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Correct me if I'm wrong but removing support for iframes wouldn't protect against this sort of phishing, since injecting a fake (Coinbase/BitPay/straight bitcoin address) iframe into a merchant's checkout flow doesn't depend on Coinbase actually supporting iframes.","markdown_message":"\u003cp\u003eCorrect me if I\u0026#39;m wrong but removing support for iframes wouldn\u0026#39;t protect against this sort of phishing, since injecting a fake (Coinbase/BitPay/straight bitcoin address) iframe into a merchant\u0026#39;s checkout flow doesn\u0026#39;t depend on Coinbase actually supporting iframes.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-05-01T18:42:41.555Z","updated_at":"2015-05-01T18:42:41.555Z","actor":{"username":"coinbase2","cleared":false,"url":"/coinbase2","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":402587,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"We haven't seen any significant abuse of this type and I don't think removing support for iframes is tenable from a business perspective. Marking as wontfix. Please let us know if you come across any other security problems.","markdown_message":"\u003cp\u003eWe haven\u0026#39;t seen any significant abuse of this type and I don\u0026#39;t think removing support for iframes is tenable from a business perspective. Marking as wontfix. Please let us know if you come across any other security problems.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-05-05T18:53:53.620Z","updated_at":"2015-05-05T18:53:53.620Z","actor":{"username":"coinbase2","cleared":false,"url":"/coinbase2","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":701788,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"I think I understand what you're saying about business impact but it seems like too great a risk to go undisclosed.  Did you consider the second option? Refusing to serve the iframe when `Referer` is not set?  It raises the bar ever-so-slightly in that it should force your customers to consider https protection of the iframe reference itself.\n\nHow would you know if the abuse were taking place?  For charity Coinbase customers like United Way who expect no quid-pro-quo style transaction, there'd be no easy way to audit this.","markdown_message":"\u003cp\u003eI think I understand what you\u0026#39;re saying about business impact but it seems like too great a risk to go undisclosed.  Did you consider the second option? Refusing to serve the iframe when \u003ccode\u003eReferer\u003c/code\u003e is not set?  It raises the bar ever-so-slightly in that it should force your customers to consider https protection of the iframe reference itself.\u003c/p\u003e\n\n\u003cp\u003eHow would you know if the abuse were taking place?  For charity Coinbase customers like United Way who expect no quid-pro-quo style transaction, there\u0026#39;d be no easy way to audit this.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-11-29T06:53:14.835Z","updated_at":"2015-11-29T06:53:14.835Z","first_to_agree":true,"actor":{"username":"androm3da","cleared":false,"url":"/androm3da","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":704243,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is beyond the scope of our security program. Merchants are responsible for serving their sites over a secure and authenticated connection. If they fail to do so, there is nothing we can do to protect victims from viewing falsified content up to and including payment forms (whether those are real Coinbase iframes, phishing Coinbase iframes, PayPal, Stripe, or whatever).\n","markdown_message":"\u003cp\u003eThis is beyond the scope of our security program. Merchants are responsible for serving their sites over a secure and authenticated connection. If they fail to do so, there is nothing we can do to protect victims from viewing falsified content up to and including payment forms (whether those are real Coinbase iframes, phishing Coinbase iframes, PayPal, Stripe, or whatever).\u003c/p\u003e\n","automated_response":false,"created_at":"2015-12-01T14:01:20.928Z","updated_at":"2015-12-01T14:01:20.928Z","actor":{"username":"coinbase2","cleared":false,"url":"/coinbase2","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":704250,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-12-01T14:06:59.738Z","updated_at":"2015-12-01T14:06:59.738Z","actor":{"username":"coinbase2","cleared":false,"url":"/coinbase2","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":704251,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-12-01T14:07:00.025Z","updated_at":"2015-12-01T14:07:00.025Z","actor":{"username":"coinbase2","cleared":false,"url":"/coinbase2","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}