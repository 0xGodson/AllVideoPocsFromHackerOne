{"id":158482,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTg0ODI=","url":"https://hackerone.com/reports/158482","title":"Host Header poisoning on gratipay.com","state":"Closed","substate":"duplicate","readable_substate":"Duplicate","created_at":"2016-08-11T14:45:22.032Z","submitted_at":"2016-08-11T14:45:22.032Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"aaron_costello","url":"/aaron_costello","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/89cpgLpC5JjJB9H6NtWYW3wJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1868,"url":"https://hackerone.com/gratipay","handle":"gratipay","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/868/a75c6649c5b4671b3cf44160af884a7da9fd0b67_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/868/a75c6649c5b4671b3cf44160af884a7da9fd0b67_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Gratipay","twitter_handle":"Gratipay","website":"https://gratipay.com/","about":"Gratitude? Gratipay! The easiest way for your company to pay for open source."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-08-21T13:32:31.677Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2016-08-12T23:10:31.812Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"There is a host header poisoning vulnerability on gratipay.com that allows an attacker to cause a 301 redirect and poison the browser DNS cache to cause all further requests to gratipay.com to be redirected to the attacker's site.\n\nPoC Request:\n```\nGET https://gratipay.com/ HTTP/1.1\nHost: heroku.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:47.0) Gecko/20100101 Firefox/47.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nCookie: csrf_token=oglKUTprcTt6gQkxpCMEz6UAj0HXxgez; suppress-welcome=; session=eeee68e176604dc2bdb36d1766755ea0\nConnection: keep-alive\n```\n\nResponse:\n```\nHTTP/1.1 301 Moved Permanently\nServer: Cowboy\nDate: Thu, 11 Aug 2016 14:38:17 GMT\nConnection: keep-alive\nStrict-Transport-Security: max-age=31536000\nLocation: https://www.heroku.com/\nContent-Type: text/html\nContent-Length: 0\nVia: 1.1 vegur\n```\n\nThings to note:\n1. Tested on Firefox, Host header manipulated with the Live HTTP Headers and Tamper Data addons\n2. The attacker must create a malicious Heroku app to redirect to, in the PoC i have just chosen heroku.com\n","vulnerability_information_html":"\u003cp\u003eThere is a host header poisoning vulnerability on gratipay.com that allows an attacker to cause a 301 redirect and poison the browser DNS cache to cause all further requests to gratipay.com to be redirected to the attacker\u0026#39;s site.\u003c/p\u003e\n\n\u003cp\u003ePoC Request:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eGET https://gratipay.com/ HTTP/1.1\nHost: heroku.com\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:47.0) Gecko/20100101 Firefox/47.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nCookie: csrf_token=oglKUTprcTt6gQkxpCMEz6UAj0HXxgez; suppress-welcome=; session=eeee68e176604dc2bdb36d1766755ea0\nConnection: keep-alive\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eResponse:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 301 Moved Permanently\nServer: Cowboy\nDate: Thu, 11 Aug 2016 14:38:17 GMT\nConnection: keep-alive\nStrict-Transport-Security: max-age=31536000\nLocation: https://www.heroku.com/\nContent-Type: text/html\nContent-Length: 0\nVia: 1.1 vegur\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThings to note:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eTested on Firefox, Host header manipulated with the Live HTTP Headers and Tamper Data addons\u003c/li\u003e\n\u003cli\u003eThe attacker must create a malicious Heroku app to redirect to, in the PoC i have just chosen heroku.com\u003c/li\u003e\n\u003c/ol\u003e\n","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":157465,"original_report_url":"https://hackerone.com/reports/157465","attachments":[],"allow_singular_disclosure_at":null,"vote_count":1,"voters":["666reda"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1119719,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @aaron_costello,\n\nThanks for your report. Unfortunately, it seems to be a duplicate of #157465. I'll ask you some questions to ensure that it's effectively the case:\n\n- Your example mention `GET https://gratipay.com/ HTTP/1.1`. It seems to be defined as the *absolute-form* in the [RFC7230](https://tools.ietf.org/html/rfc7230#section-5.3.2) but it's not a common writing. Did you made a mistake here?\n- Since you need to craft this request and force the vicitm's browser to send it (SOP, etc), I don't see how you can \"poison browser DNS cache\" (I'll talk about this in the next point).\n- How is the DNS cache related to the attack you described? As far I know, Heroku uses the `Host` header to identify to which application route the request, so creating a fake Heroku application is not needed.\n- Did you found a functionality of gratipay.com which can be tricked into one malicious behaviour when using a wrong `Host` header? Like a cache?\n\nIf you can edit your first message, please remove the informations that are unique to you, like your session token—we tend to ask for the disclosure of all the reports we receive in order to be as transparent as possible. If you can't edit it anymore, please renew your session on the website to be sure that nothing can happen. Thanks :-)","markdown_message":"\u003cp\u003eHi \u003ca href=\"/aaron_costello\"\u003e@aaron_costello\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThanks for your report. Unfortunately, it seems to be a duplicate of \u003ca href=\"/reports/157465\"\u003e#157465\u003c/a\u003e. I\u0026#39;ll ask you some questions to ensure that it\u0026#39;s effectively the case:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eYour example mention \u003ccode\u003eGET https://gratipay.com/ HTTP/1.1\u003c/code\u003e. It seems to be defined as the \u003cem\u003eabsolute-form\u003c/em\u003e in the \u003ca href=\"/redirect?url=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc7230%23section-5.3.2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eRFC7230\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e but it\u0026#39;s not a common writing. Did you made a mistake here?\u003c/li\u003e\n\u003cli\u003eSince you need to craft this request and force the vicitm\u0026#39;s browser to send it (SOP, etc), I don\u0026#39;t see how you can \u0026quot;poison browser DNS cache\u0026quot; (I\u0026#39;ll talk about this in the next point).\u003c/li\u003e\n\u003cli\u003eHow is the DNS cache related to the attack you described? As far I know, Heroku uses the \u003ccode\u003eHost\u003c/code\u003e header to identify to which application route the request, so creating a fake Heroku application is not needed.\u003c/li\u003e\n\u003cli\u003eDid you found a functionality of gratipay.com which can be tricked into one malicious behaviour when using a wrong \u003ccode\u003eHost\u003c/code\u003e header? Like a cache?\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIf you can edit your first message, please remove the informations that are unique to you, like your session token—we tend to ask for the disclosure of all the reports we receive in order to be as transparent as possible. If you can\u0026#39;t edit it anymore, please renew your session on the website to be sure that nothing can happen. Thanks :-)\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-11T16:49:40.891Z","updated_at":"2016-08-11T16:49:40.891Z","actor":{"username":"nashe_","cleared":false,"url":"/nashe_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1120457,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here are some reference reports of the same vulnerability on different sites:\n\nHost Injection in whisper: https://hackerone.com/reports/94637\nHost Injections in irccloud: https://hackerone.com/reports/13286 https://hackerone.com/reports/7357\n\nI cannot edit the post but I will be sure to void my session thank you for notifying me. If this has already been reported, feel free to report it as a duplicate. Thanks.","markdown_message":"\u003cp\u003eHere are some reference reports of the same vulnerability on different sites:\u003c/p\u003e\n\n\u003cp\u003eHost Injection in whisper: \u003ca title=\"https://hackerone.com/reports/94637\" href=\"https://hackerone.com/reports/94637\"\u003ehttps://hackerone.com/reports/94637\u003c/a\u003e\u003cbr\u003e\nHost Injections in irccloud: \u003ca title=\"https://hackerone.com/reports/13286\" href=\"https://hackerone.com/reports/13286\"\u003ehttps://hackerone.com/reports/13286\u003c/a\u003e \u003ca title=\"https://hackerone.com/reports/7357\" href=\"https://hackerone.com/reports/7357\"\u003ehttps://hackerone.com/reports/7357\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI cannot edit the post but I will be sure to void my session thank you for notifying me. If this has already been reported, feel free to report it as a duplicate. Thanks.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-11T21:26:02.481Z","updated_at":"2016-08-11T21:26:02.481Z","actor":{"username":"aaron_costello","cleared":true,"url":"/aaron_costello","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/89cpgLpC5JjJB9H6NtWYW3wJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1120490,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If you can answer my 4 questions, it would be easier for me to don't misunderstand your report!","markdown_message":"\u003cp\u003eIf you can answer my 4 questions, it would be easier for me to don\u0026#39;t misunderstand your report!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-11T21:40:40.253Z","updated_at":"2016-08-11T21:40:40.253Z","actor":{"username":"nashe_","cleared":false,"url":"/nashe_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1121278,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"1. I did not make a mistake, but it will work anyway regardless of form.\n2. If the request is modified with the malicious host header, the browser will interpret the 301 result and thus poison the DNS cache of the browser.\n3.  A fake Heroku Application is needed. Try and use my PoC without a heroku app on the domain and it won't work.\n4. I haven't looked at the code itself.\n\nPlease read the reports I had mentioned in the last post, it is the exact same vulnerability.","markdown_message":"\u003col\u003e\n\u003cli\u003eI did not make a mistake, but it will work anyway regardless of form.\u003c/li\u003e\n\u003cli\u003eIf the request is modified with the malicious host header, the browser will interpret the 301 result and thus poison the DNS cache of the browser.\u003c/li\u003e\n\u003cli\u003e A fake Heroku Application is needed. Try and use my PoC without a heroku app on the domain and it won\u0026#39;t work.\u003c/li\u003e\n\u003cli\u003eI haven\u0026#39;t looked at the code itself.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003ePlease read the reports I had mentioned in the last post, it is the exact same vulnerability.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-12T07:34:23.307Z","updated_at":"2016-08-12T07:34:23.307Z","actor":{"username":"aaron_costello","cleared":true,"url":"/aaron_costello","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/89cpgLpC5JjJB9H6NtWYW3wJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1124326,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"1. OK :-)\n2. But I don't see any way to force this \"modification\" without already having control of the system. I agree that you can poison a cache server and alter the behaviour of the application this way, but I don't get how you can do it for a browser. A PoC would be welcome because I think you're wrong there (mixing the notions of browser cache, DNS cache and cache server?).\n3. Since you alter the `Host` header by yourself, so yes, any website hosted to Heroku will be \"vulnerable\"… The host field is used to route the request to the right vhost, so no magic here.\n4. :-(\n\nI'm closing as \"Duplicate\" since I don't have enough information to conclude it's a different report and I don't even think this is a risk we need to mitigate because we never use this value for anything (hardcoded host) and don't have any cache server in front of our service.","markdown_message":"\u003col\u003e\n\u003cli\u003eOK :-)\u003c/li\u003e\n\u003cli\u003eBut I don\u0026#39;t see any way to force this \u0026quot;modification\u0026quot; without already having control of the system. I agree that you can poison a cache server and alter the behaviour of the application this way, but I don\u0026#39;t get how you can do it for a browser. A PoC would be welcome because I think you\u0026#39;re wrong there (mixing the notions of browser cache, DNS cache and cache server?).\u003c/li\u003e\n\u003cli\u003eSince you alter the \u003ccode\u003eHost\u003c/code\u003e header by yourself, so yes, any website hosted to Heroku will be \u0026quot;vulnerable\u0026quot;… The host field is used to route the request to the right vhost, so no magic here.\u003c/li\u003e\n\u003cli\u003e:-(\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eI\u0026#39;m closing as \u0026quot;Duplicate\u0026quot; since I don\u0026#39;t have enough information to conclude it\u0026#39;s a different report and I don\u0026#39;t even think this is a risk we need to mitigate because we never use this value for anything (hardcoded host) and don\u0026#39;t have any cache server in front of our service.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-12T23:10:17.050Z","updated_at":"2016-08-12T23:10:17.050Z","original_report_id":157465,"actor":{"username":"nashe_","cleared":false,"url":"/nashe_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1124327,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-12T23:10:31.854Z","updated_at":"2016-08-12T23:10:31.854Z","first_to_agree":true,"actor":{"username":"nashe_","cleared":false,"url":"/nashe_","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1943376,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-21T13:32:31.637Z","updated_at":"2017-08-21T13:32:31.637Z","actor":{"username":"edio","cleared":false,"url":"/edio","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/193/501/c186a057285438756d4c4d27cbf3b8965cf1f51b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gratipay","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}