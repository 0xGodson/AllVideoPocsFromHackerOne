{"id":172837,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNzI4Mzc=","url":"https://hackerone.com/reports/172837","title":"password less login token expiration issue","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-09-29T07:28:23.083Z","submitted_at":"2016-09-29T07:28:23.083Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"satishb3","url":"/satishb3","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/170/fc657d5dfd17ac30235e5687c8b2d9b461e0f64e_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-10-19T15:44:17.559Z","bug_reporter_agreed_on_going_public_at":"2016-10-19T15:44:17.508Z","team_member_agreed_on_going_public_at":"2016-10-19T15:38:13.114Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"1. Log into Shopify iOS app as Alice and grab the token.\n2. Send the below request to generate the password less login token (The token expires after a single use. So don't use the token).\n\n    Request:\n    POST /admin/api/graphql HTTP/1.1\n    Host: seclearn.myshopify.com\n    Content-Type: application/graphql\n    Connection: close\n    X-Shopify-Access-Token: f263fb8c544a4cb965d63635a2e1c772\n    Accept: application/json\n    User-Agent: Shopify Mobile/iPhone OS/5.0 (iPhone6,2/com.jadedpixel.shopify)\n    Content-Length: 66\n    Accept-Language: en-us\n    Accept-Encoding: gzip, deflate\n\n    mutation{adminPasswordlessLogin(input:{}){passwordlessLoginToken}}\n\n    Response:\n    {\"data\":{\"adminPasswordlessLogin\":{\"passwordlessLoginToken\":\"bd7ffa6c5bf2969fa15753f8fb8cb427-1475133135\"}}}\n\n3. From desktop browser, login as Alice and revoke access to Shopify iOS app. It is revoking the access token but password less login token still works. \n\n    Replace the above login token in the below URL and it logs you in.\nhttps://seclearn.myshopify.com/admin?login_token=bd7ffa6c5bf2969fa15753f8fb8cb427-1475133135\n\nAttack scenario:\n1. User gave access to an app.\n2. App used the request and kept an unused login token. \n3. User revoked access to the app.\n4. App can still use the unused login token and access user's data.","vulnerability_information_html":"\u003col\u003e\n\u003cli\u003eLog into Shopify iOS app as Alice and grab the token.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSend the below request to generate the password less login token (The token expires after a single use. So don\u0026#39;t use the token).\u003c/p\u003e\n\n\u003cp\u003eRequest:\u003cbr\u003e\nPOST /admin/api/graphql HTTP/1.1\u003cbr\u003e\nHost: seclearn.myshopify.com\u003cbr\u003e\nContent-Type: application/graphql\u003cbr\u003e\nConnection: close\u003cbr\u003e\nX-Shopify-Access-Token: f263fb8c544a4cb965d63635a2e1c772\u003cbr\u003e\nAccept: application/json\u003cbr\u003e\nUser-Agent: Shopify Mobile/iPhone OS/5.0 (iPhone6,2/com.jadedpixel.shopify)\u003cbr\u003e\nContent-Length: 66\u003cbr\u003e\nAccept-Language: en-us\u003cbr\u003e\nAccept-Encoding: gzip, deflate\u003c/p\u003e\n\n\u003cp\u003emutation{adminPasswordlessLogin(input:{}){passwordlessLoginToken}}\u003c/p\u003e\n\n\u003cp\u003eResponse:\u003cbr\u003e\n{\u0026quot;data\u0026quot;:{\u0026quot;adminPasswordlessLogin\u0026quot;:{\u0026quot;passwordlessLoginToken\u0026quot;:\u0026quot;bd7ffa6c5bf2969fa15753f8fb8cb427-1475133135\u0026quot;}}}\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eFrom desktop browser, login as Alice and revoke access to Shopify iOS app. It is revoking the access token but password less login token still works. \u003c/p\u003e\n\n\u003cp\u003eReplace the above login token in the below URL and it logs you in.\u003cbr\u003e\n\u003ca title=\"https://seclearn.myshopify.com/admin?login_token=bd7ffa6c5bf2969fa15753f8fb8cb427-1475133135\" href=\"/redirect?url=https%3A%2F%2Fseclearn.myshopify.com%2Fadmin%3Flogin_token%3Dbd7ffa6c5bf2969fa15753f8fb8cb427-1475133135\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://seclearn.myshopify.com/admin?login_token=bd7ffa6c5bf2969fa15753f8fb8cb427-1475133135\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAttack scenario:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eUser gave access to an app.\u003c/li\u003e\n\u003cli\u003eApp used the request and kept an unused login token. \u003c/li\u003e\n\u003cli\u003eUser revoked access to the app.\u003c/li\u003e\n\u003cli\u003eApp can still use the unused login token and access user\u0026#39;s data.\u003c/li\u003e\n\u003c/ol\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":6,"voters":["yaworsk","eveeez","jbbbkj","sumit7","spetr0x","gopalsingh112"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1223105,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\r\n\r\nOur team is busy triaging and fixing HackerOne reports, and it may take us up to 1 week (or more) to triage any given issue. Don't worry, we'll get to yours!\r\n\r\nWhile you are waiting, you can read over our list of non applicable issues listed on our program page: https://hackerone.com/shopify. Make sure your issue isn't listed!","markdown_message":"\u003cp\u003eThank you for reporting this bug! This is an automated response to let you know that we\u0026#39;ve received your issue, and we\u0026#39;ll process it as soon as possible.\u003c/p\u003e\n\n\u003cp\u003eOur team is busy triaging and fixing HackerOne reports, and it may take us up to 1 week (or more) to triage any given issue. Don\u0026#39;t worry, we\u0026#39;ll get to yours!\u003c/p\u003e\n\n\u003cp\u003eWhile you are waiting, you can read over our list of non applicable issues listed on our program page: \u003ca title=\"https://hackerone.com/shopify\" href=\"https://hackerone.com/shopify\"\u003ehttps://hackerone.com/shopify\u003c/a\u003e. Make sure your issue isn\u0026#39;t listed!\u003c/p\u003e\n","automated_response":true,"created_at":"2016-09-29T07:28:23.454Z","updated_at":"2016-09-29T07:28:23.454Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1223208,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Another attack scenario, \n\n1. User logged into iOS app on an iPhone.\n2. User lost the phone. \n3. Attacker, who found the phone generated the login token using the above request.\n4. User realized that his phone is lost and used the desktop website to logout from all the devices. It logout from all the devices but does not expire the previously generated login token.\n5. Attacker uses the login token and login again.\n\nFix: \nExpire the all the login tokens associated with an access token, when the access token is expired.","markdown_message":"\u003cp\u003eAnother attack scenario, \u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eUser logged into iOS app on an iPhone.\u003c/li\u003e\n\u003cli\u003eUser lost the phone. \u003c/li\u003e\n\u003cli\u003eAttacker, who found the phone generated the login token using the above request.\u003c/li\u003e\n\u003cli\u003eUser realized that his phone is lost and used the desktop website to logout from all the devices. It logout from all the devices but does not expire the previously generated login token.\u003c/li\u003e\n\u003cli\u003eAttacker uses the login token and login again.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eFix: \u003cbr\u003e\nExpire the all the login tokens associated with an access token, when the access token is expired.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-29T09:14:42.093Z","updated_at":"2016-09-29T09:14:42.093Z","actor":{"username":"satishb3","cleared":true,"url":"/satishb3","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/170/fc657d5dfd17ac30235e5687c8b2d9b461e0f64e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1235687,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. Our engineering team is investigating the issue.","markdown_message":"\u003cp\u003eThank you for your report. Our engineering team is investigating the issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-10-06T15:18:26.250Z","updated_at":"2016-10-06T15:18:26.250Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1244758,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Passwordless login tokens were only intended to be valid for five minutes, which we consider to be a short enough validity period that a revocation mechanism is not required. However, there was a bug which resulted in a much longer validity period. We have corrected this issue, so passwordless login tokens now expire quickly, as intended.\n\nOur next round of bounty decisions will take place within two weeks, so we will be in touch with you again soon.","markdown_message":"\u003cp\u003ePasswordless login tokens were only intended to be valid for five minutes, which we consider to be a short enough validity period that a revocation mechanism is not required. However, there was a bug which resulted in a much longer validity period. We have corrected this issue, so passwordless login tokens now expire quickly, as intended.\u003c/p\u003e\n\n\u003cp\u003eOur next round of bounty decisions will take place within two weeks, so we will be in touch with you again soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-10-12T20:19:05.254Z","updated_at":"2016-10-12T20:19:05.254Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"satishb3","url":"/satishb3"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1244759,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-10-12T20:19:45.106Z","updated_at":"2018-02-28T13:10:48.370Z","additional_data":{"added_weaknesses":[{"id":27,"name":"Improper Authentication - Generic"}],"removed_weaknesses":[{"id":57,"name":"Violation of Secure Design Principles"}]},"actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1255940,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-10-19T15:38:08.308Z","updated_at":"2016-10-19T15:38:08.308Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"satishb3","url":"/satishb3"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1255942,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-10-19T15:38:13.131Z","updated_at":"2016-10-19T15:38:13.131Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1255953,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-10-19T15:44:17.530Z","updated_at":"2016-10-19T15:44:17.530Z","actor":{"username":"satishb3","cleared":true,"url":"/satishb3","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/170/fc657d5dfd17ac30235e5687c8b2d9b461e0f64e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1255954,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-10-19T15:44:17.579Z","updated_at":"2016-10-19T15:44:17.579Z","actor":{"username":"satishb3","cleared":true,"url":"/satishb3","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/170/fc657d5dfd17ac30235e5687c8b2d9b461e0f64e_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}