{"id":20671,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDY3MQ==","url":"https://hackerone.com/reports/20671","title":"integer overflow in 'buffer' type allows reading memory","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-06-23T09:15:00.000Z","submitted_at":"2014-06-23T09:15:00.000Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"removed","url":"/removed","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":27,"url":"https://hackerone.com/ibb-python","handle":"ibb-python","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/027/c46b79d4c73a7b34d61a717ed19ae719a0b67b2e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/027/c46b79d4c73a7b34d61a717ed19ae719a0b67b2e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Python (IBB)","twitter_handle":"","website":"http://www.python.org/news/security","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-06-24T03:01:40.000Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2014-06-24T03:01:40.000Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"https://mail.python.org/pipermail/python-bugs-list/2014-June/244955.html\n","vulnerability_information_html":"\u003cp\u003e\u003ca title=\"https://mail.python.org/pipermail/python-bugs-list/2014-June/244955.html\" href=\"/redirect?url=https%3A%2F%2Fmail.python.org%2Fpipermail%2Fpython-bugs-list%2F2014-June%2F244955.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://mail.python.org/pipermail/python-bugs-list/2014-June/244955.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"1500.0","formatted_bounty":"$1,500","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":91793,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2014-07-19T00:00:40.487Z","updated_at":"2014-07-19T00:00:40.487Z","actor":{"url":"/ibb-python","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/027/c46b79d4c73a7b34d61a717ed19ae719a0b67b2e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Python (IBB)"}},"bounty_amount":"1500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"ibb-python","collaborator":{"username":"removed","url":"/removed"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":96706,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The report to security@python.org follows:\n\nLet me first say thanks for all of your support for this language. When perl had reached 5.8, I felt kind of abandoned as perl began the Perl6 chapter of it's life. At this point, I felt abandoned. I didn't know what language to keep developing in. (I almost went back to C99 exclusively! Those were rough times!) It was at this point that I remembered modifying the menus for this tool called the Quake Army Knife (QuArK). And it was since then that I had decided to migrate across the peninsula to Python. It has changed my life as it has probably changed all of us.\n\nhttps://hackerone.com/reports/12297\n\nSo I guess I saw this report, and it kind of surprised me. \"Kind of\" being an understatement even. But I figured I should do my part, as I've been an opensource leech for almost 15 years now.\n\nSo, here's another bug that can do similar things. I've only checked for it in the Python 2.x series because I'm pretty lame and my Vim instance isn't currently built against 3.x. :((\n\n------- 8\u003c --- snip here --- 8\u003c -------\n\nSo, if you look in Objects/bufferobject.c, there's this function called buffer_from_object. I'm sure you're pretty familiar with it. It contains a missing check that I was using for a bit so that I didn't have to use ctypes to read from my current process' memory. I had poked around to see if I could turn it into something used to \"write\" to arbitrary memory, but I didn't find anything that sets the readonly flag to True (except if you have access to an awesome external binary module called _ctypes. If you have access to ctypes though, you've already won.)\n\nSo the buffer object is used to convert from something that supports the buffer protocol into an object that can be used to read/write to that original object. \n\nHere's it's prototype:\nObjects/bufferobject.c:130\nstatic PyObject *\nbuffer_from_object(PyObject *base, Py_ssize_t size, Py_ssize_t offset, int readonly)\n\nAnd here's the code we care about:\nObjects/bufferobject.c:139\n        /* another buffer, refer to the base object */\n        PyBufferObject *b = (PyBufferObject *)base;\n        if (b-\u003eb_size != Py_END_OF_BUFFER) {\n            Py_ssize_t base_size = b-\u003eb_size - offset;\n            if (base_size \u003c 0)\n                base_size = 0;\n            if (size == Py_END_OF_BUFFER || size \u003e base_size)\n                size = base_size;\n        }\n        offset += b-\u003eb_offset;\n        base = b-\u003eb_base;\n\nSo the bug is related to the offset variable. The buffer_from_object function will take the \"b_offset\" field from the original object and add the parameter \"offset\" to it. This will then get passed to the buffer_from_memory function. Since there's no check, you can specify any offset you'd like.\n\nNow we'll need to find what python objects actually implement a buffer interface that will call buffer_from_object. From grepping and things, I've discovered you can use a memoryview or a bytearray. Unfortunately, none of these set the readonly argument to True. The only object that can do this is a ctypes instance. This means that all we can do is read from memory which is not as much fun as one would hope.\n\nHere's some example python code that triggers the bug:\na = bytearray('hola mundo')\nb = buffer(a, 0x7fffffff, 0x7fffffff)\nprint repr(b[:0xfeed]),\"the\",repr(b[-0xdead:])\n\nIf credit is necessary can you credit:\nChris Foster (sr20dett93@gmail.com)\n\nAnd my account on hackerone.com is : https://hackerone.com/arizvisa\n\nI had sent an email to them last night to ask them how they tie \ntogether with vulnerabilities reported to the vendor, but they haven't responded yet.\n\nIf you guys have any questions, or would like more work..feel free to hit me up.\n\nPeace.","markdown_message":"\u003cp\u003eThe report to \u003ca title=\"security@python.org\" href=\"mailto:security@python.org\" rel=\"nofollow noopener noreferrer\"\u003esecurity@python.org\u003c/a\u003e follows:\u003c/p\u003e\n\n\u003cp\u003eLet me first say thanks for all of your support for this language. When perl had reached 5.8, I felt kind of abandoned as perl began the Perl6 chapter of it\u0026#39;s life. At this point, I felt abandoned. I didn\u0026#39;t know what language to keep developing in. (I almost went back to C99 exclusively! Those were rough times!) It was at this point that I remembered modifying the menus for this tool called the Quake Army Knife (QuArK). And it was since then that I had decided to migrate across the peninsula to Python. It has changed my life as it has probably changed all of us.\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://hackerone.com/reports/12297\" href=\"https://hackerone.com/reports/12297\"\u003ehttps://hackerone.com/reports/12297\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSo I guess I saw this report, and it kind of surprised me. \u0026quot;Kind of\u0026quot; being an understatement even. But I figured I should do my part, as I\u0026#39;ve been an opensource leech for almost 15 years now.\u003c/p\u003e\n\n\u003cp\u003eSo, here\u0026#39;s another bug that can do similar things. I\u0026#39;ve only checked for it in the Python 2.x series because I\u0026#39;m pretty lame and my Vim instance isn\u0026#39;t currently built against 3.x. :((\u003c/p\u003e\n\n\u003cp\u003e------- 8\u0026lt; --- snip here --- 8\u0026lt; -------\u003c/p\u003e\n\n\u003cp\u003eSo, if you look in Objects/bufferobject.c, there\u0026#39;s this function called buffer_from_object. I\u0026#39;m sure you\u0026#39;re pretty familiar with it. It contains a missing check that I was using for a bit so that I didn\u0026#39;t have to use ctypes to read from my current process\u0026#39; memory. I had poked around to see if I could turn it into something used to \u0026quot;write\u0026quot; to arbitrary memory, but I didn\u0026#39;t find anything that sets the readonly flag to True (except if you have access to an awesome external binary module called _ctypes. If you have access to ctypes though, you\u0026#39;ve already won.)\u003c/p\u003e\n\n\u003cp\u003eSo the buffer object is used to convert from something that supports the buffer protocol into an object that can be used to read/write to that original object. \u003c/p\u003e\n\n\u003cp\u003eHere\u0026#39;s it\u0026#39;s prototype:\u003cbr\u003e\nObjects/bufferobject.c:130\u003cbr\u003e\nstatic PyObject *\u003cbr\u003e\nbuffer_from_object(PyObject *base, Py_ssize_t size, Py_ssize_t offset, int readonly)\u003c/p\u003e\n\n\u003cp\u003eAnd here\u0026#39;s the code we care about:\u003cbr\u003e\nObjects/bufferobject.c:139\u003cbr\u003e\n        /* another buffer, refer to the base object */\u003cbr\u003e\n        PyBufferObject *b = (PyBufferObject *)base;\u003cbr\u003e\n        if (b-\u0026gt;b_size != Py_END_OF_BUFFER) {\u003cbr\u003e\n            Py_ssize_t base_size = b-\u0026gt;b_size - offset;\u003cbr\u003e\n            if (base_size \u0026lt; 0)\u003cbr\u003e\n                base_size = 0;\u003cbr\u003e\n            if (size == Py_END_OF_BUFFER || size \u0026gt; base_size)\u003cbr\u003e\n                size = base_size;\u003cbr\u003e\n        }\u003cbr\u003e\n        offset += b-\u0026gt;b_offset;\u003cbr\u003e\n        base = b-\u0026gt;b_base;\u003c/p\u003e\n\n\u003cp\u003eSo the bug is related to the offset variable. The buffer_from_object function will take the \u0026quot;b_offset\u0026quot; field from the original object and add the parameter \u0026quot;offset\u0026quot; to it. This will then get passed to the buffer_from_memory function. Since there\u0026#39;s no check, you can specify any offset you\u0026#39;d like.\u003c/p\u003e\n\n\u003cp\u003eNow we\u0026#39;ll need to find what python objects actually implement a buffer interface that will call buffer_from_object. From grepping and things, I\u0026#39;ve discovered you can use a memoryview or a bytearray. Unfortunately, none of these set the readonly argument to True. The only object that can do this is a ctypes instance. This means that all we can do is read from memory which is not as much fun as one would hope.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026#39;s some example python code that triggers the bug:\u003cbr\u003e\na = bytearray(\u0026#39;hola mundo\u0026#39;)\u003cbr\u003e\nb = buffer(a, 0x7fffffff, 0x7fffffff)\u003cbr\u003e\nprint repr(b[:0xfeed]),\u0026quot;the\u0026quot;,repr(b[-0xdead:])\u003c/p\u003e\n\n\u003cp\u003eIf credit is necessary can you credit:\u003cbr\u003e\nChris Foster (\u003ca title=\"sr20dett93@gmail.com\" href=\"mailto:sr20dett93@gmail.com\" rel=\"nofollow noopener noreferrer\"\u003esr20dett93@gmail.com\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003eAnd my account on hackerone.com is : \u003ca title=\"https://hackerone.com/arizvisa\" href=\"https://hackerone.com/arizvisa\"\u003ehttps://hackerone.com/arizvisa\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI had sent an email to them last night to ask them how they tie \u003cbr\u003e\ntogether with vulnerabilities reported to the vendor, but they haven\u0026#39;t responded yet.\u003c/p\u003e\n\n\u003cp\u003eIf you guys have any questions, or would like more work..feel free to hit me up.\u003c/p\u003e\n\n\u003cp\u003ePeace.\u003c/p\u003e\n","automated_response":false,"created_at":"2014-07-27T08:33:17.277Z","updated_at":"2014-07-27T08:35:53.628Z","actor":{"username":"removed","cleared":false,"url":"/removed","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-python","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":138463,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Chris Foster is now out of jail thanks to this submission. He now has 6 months of mandatory rehab and then he's free again. ","markdown_message":"\u003cp\u003eChris Foster is now out of jail thanks to this submission. He now has 6 months of mandatory rehab and then he\u0026#39;s free again. \u003c/p\u003e\n","automated_response":false,"created_at":"2014-10-08T04:37:09.778Z","updated_at":"2014-10-08T04:37:09.778Z","actor":{"username":"removed","cleared":false,"url":"/removed","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ibb-python","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1196154,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":null,"markdown_message":"","automated_response":false,"created_at":"2014-10-08T04:37:09.778Z","updated_at":"2016-09-15T13:29:22.437Z","actor":{"url":"/ibb-python","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/027/c46b79d4c73a7b34d61a717ed19ae719a0b67b2e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Python (IBB)"}},"reporter":{"username":"removed","url":"/removed"},"genius_execution_id":null,"team_handle":"ibb-python","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}