{"id":797159,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83OTcxNTk=","url":"https://hackerone.com/reports/797159","title":"PHP builded for Windows with TS support does not resolve relalative paths with drive letter correctly","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-02-15T11:05:39.461Z","submitted_at":"2020-02-15T11:05:39.461Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"vorismi3","url":"/vorismi3","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":29,"url":"https://hackerone.com/ibb-php","handle":"ibb-php","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"PHP (IBB)","twitter_handle":"","website":"http://www.php.net","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-11-09T01:47:33.238Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-10-10T01:47:28.412Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Currently PHP process Windows paths like `C:Users` as if they were absolute. But they are not and PHP builded with TS (thread-safe support) currently points to root drive location instead of the current directory. This gives the attaker unlimited access to the root drive if a) the path is resolved/normalized by the app before used b) permissions are denied (but on Windows the system files are almost always accessible)\n\nReported to PHP:\nhttps://bugs.php.net/bug.php?id=78939\nhttps://github.com/php/php-src/pull/5001\n\n## Impact\n\nAttaker can get access to all files on the same drive if the path is validated by some middleware correctly but PHP then points to bad location.\n\nExample scenario:\n- PHP pwd: `C:/Web/uploads`\n- path: `C:secret_data.txt`\n- apps checks if the path is within pwd - yes, it is, correct resolved location should be `C:/Web/uploads/secret_data.txt`\n- but PHP accesses `C:/secret_data.txt`\n\nIf app can write with user supplied path, the path can be handcrafted to point to location like `C:\\Users\\\u003cUSER\u003e\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup` and inject malicious file to be started when the user logs in.","vulnerability_information_html":"\u003cp\u003eCurrently PHP process Windows paths like \u003ccode\u003eC:Users\u003c/code\u003e as if they were absolute. But they are not and PHP builded with TS (thread-safe support) currently points to root drive location instead of the current directory. This gives the attaker unlimited access to the root drive if a) the path is resolved/normalized by the app before used b) permissions are denied (but on Windows the system files are almost always accessible)\u003c/p\u003e\n\n\u003cp\u003eReported to PHP:\u003cbr\u003e\n\u003ca title=\"https://bugs.php.net/bug.php?id=78939\" href=\"/redirect?url=https%3A%2F%2Fbugs.php.net%2Fbug.php%3Fid%3D78939\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://bugs.php.net/bug.php?id=78939\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://github.com/php/php-src/pull/5001\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fpull%2F5001\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/php/php-src/pull/5001\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAttaker can get access to all files on the same drive if the path is validated by some middleware correctly but PHP then points to bad location.\u003c/p\u003e\n\n\u003cp\u003eExample scenario:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePHP pwd: \u003ccode\u003eC:/Web/uploads\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003epath: \u003ccode\u003eC:secret_data.txt\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eapps checks if the path is within pwd - yes, it is, correct resolved location should be \u003ccode\u003eC:/Web/uploads/secret_data.txt\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003ebut PHP accesses \u003ccode\u003eC:/secret_data.txt\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIf app can write with user supplied path, the path can be handcrafted to point to location like \u003ccode\u003eC:\\Users\\\u0026lt;USER\u0026gt;\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\u003c/code\u003e and inject malicious file to be started when the user logs in.\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":19,"name":"Path Traversal"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-11-09T01:47:28.494Z","allow_singular_disclosure_after":-4338433.727469667,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"severity":{"rating":"medium","score":6.8,"author_type":"User","metrics":{"attack_vector":"local","attack_complexity":"low","privileges_required":"low","user_interaction":"required","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"low"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":7062503,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @vorismi3,\n\nThank you for your submission. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\n\nKind regards,\n@nochnoidozor","markdown_message":"\u003cp\u003eHi \u003ca href=\"/vorismi3\"\u003e@vorismi3\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for your submission. Your report is currently being reviewed and the HackerOne triage team will get back to you once there is additional information to share.\u003c/p\u003e\n\n\u003cp\u003eKind regards,\u003cbr\u003e\n\u003ca href=\"/nochnoidozor\"\u003e@nochnoidozor\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2020-02-16T05:06:27.191Z","updated_at":"2020-02-16T05:06:27.191Z","actor":{"username":"nochnoidozor","cleared":false,"url":"/nochnoidozor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7062506,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hi @vorismi3,\n\nhas a public advisory been released? From the bug thread and also the pull request it seems unclear if this has been recognized as an issue that needs remediation or not.\n\nRegards,\n@nochnoidozor ","markdown_message":"\u003cp\u003eHi \u003ca href=\"/vorismi3\"\u003e@vorismi3\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003ehas a public advisory been released? From the bug thread and also the pull request it seems unclear if this has been recognized as an issue that needs remediation or not.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\n\u003ca href=\"/nochnoidozor\"\u003e@nochnoidozor\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2020-02-16T05:08:00.011Z","updated_at":"2020-02-16T05:08:00.011Z","actor":{"username":"nochnoidozor","cleared":false,"url":"/nochnoidozor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7064014,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hi @nochnoidozor , the issue has been verified and the PHP will be fixed soon. There are very few PHP developers for Windows, a few days before the core developers desided that the support for relative paths with drive letter in PHP WIndows will be completely removed. Some popular libs for PHP, like Symfony - see https://github.com/symfony/symfony/pull/34915, that were using paths like `C:something` instead `C:/something` were already fixed in past two months.\n\nCan you - based on the PHP bug report - verify, that different path can be accesed and/or written and check the severity classification questions here? Does this issue meet the conditions for a bounty?","markdown_message":"\u003cp\u003eHi \u003ca href=\"/nochnoidozor\"\u003e@nochnoidozor\u003c/a\u003e , the issue has been verified and the PHP will be fixed soon. There are very few PHP developers for Windows, a few days before the core developers desided that the support for relative paths with drive letter in PHP WIndows will be completely removed. Some popular libs for PHP, like Symfony - see \u003ca title=\"https://github.com/symfony/symfony/pull/34915\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fsymfony%2Fsymfony%2Fpull%2F34915\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/symfony/symfony/pull/34915\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, that were using paths like \u003ccode\u003eC:something\u003c/code\u003e instead \u003ccode\u003eC:/something\u003c/code\u003e were already fixed in past two months.\u003c/p\u003e\n\n\u003cp\u003eCan you - based on the PHP bug report - verify, that different path can be accesed and/or written and check the severity classification questions here? Does this issue meet the conditions for a bounty?\u003c/p\u003e\n","automated_response":false,"created_at":"2020-02-16T09:59:41.657Z","updated_at":"2020-02-16T09:59:41.657Z","actor":{"username":"vorismi3","cleared":false,"url":"/vorismi3","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7079619,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello @vorismi3,\n\nThank you for your submission! We were able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\n\nRegards,\n@nochnoidozor","markdown_message":"\u003cp\u003eHello \u003ca href=\"/vorismi3\"\u003e@vorismi3\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for your submission! We were able to validate your report, and have submitted it to the appropriate remediation team for review. They will let us know the final ruling on this report, and when/if a fix will be implemented. Please note that the status and severity are subject to change.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\n\u003ca href=\"/nochnoidozor\"\u003e@nochnoidozor\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2020-02-18T13:16:33.402Z","updated_at":"2020-02-18T13:16:33.402Z","actor":{"username":"nochnoidozor","cleared":false,"url":"/nochnoidozor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":true,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":9478499,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-10T00:40:17.126Z","updated_at":"2020-10-10T00:40:17.126Z","actor":{"url":"/ibb-php","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"PHP (IBB)"}},"bounty_amount":"500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"ibb-php","collaborator":{"username":"vorismi3","url":"/vorismi3"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9478501,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hello @vorismi3,\n\nOn behalf of the Internet Bug Bounty Panel, thank you for your continued patience on this report. The IBB requires that all in-scope open source projects be mutually engaged with us to ensure there is a good experience for all. Unfortunately, we have not been able to maintain that relationship with the upstream PHP community, and as a result, HackerOne and the IBB Panel have collectively agreed to shut down the program indefinitely.\n\nIn an effort to reward researchers for their hard work and patience thus far, the IBB panel has elected to pay bounties to all valid reports without PHP’s input. Bounty amounts are decided on based on the PHP policy and severity assigned on the accompanying CVE. \n\nAs an act of good faith, we will also close this report as Resolved.\n\nThank you for helping keep the internet safe and secure!\n-The Internet Bug Bounty Panel \n","markdown_message":"\u003cp\u003eHello \u003ca href=\"/vorismi3\"\u003e@vorismi3\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eOn behalf of the Internet Bug Bounty Panel, thank you for your continued patience on this report. The IBB requires that all in-scope open source projects be mutually engaged with us to ensure there is a good experience for all. Unfortunately, we have not been able to maintain that relationship with the upstream PHP community, and as a result, HackerOne and the IBB Panel have collectively agreed to shut down the program indefinitely.\u003c/p\u003e\n\n\u003cp\u003eIn an effort to reward researchers for their hard work and patience thus far, the IBB panel has elected to pay bounties to all valid reports without PHP’s input. Bounty amounts are decided on based on the PHP policy and severity assigned on the accompanying CVE. \u003c/p\u003e\n\n\u003cp\u003eAs an act of good faith, we will also close this report as Resolved.\u003c/p\u003e\n\n\u003cp\u003eThank you for helping keep the internet safe and secure!\u003cbr\u003e\n-The Internet Bug Bounty Panel \u003c/p\u003e\n","automated_response":false,"created_at":"2020-10-10T00:40:32.048Z","updated_at":"2020-10-10T00:40:32.048Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"vorismi3","url":"/vorismi3"},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9478690,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-10-10T01:47:28.426Z","updated_at":"2020-10-10T01:47:28.426Z","first_to_agree":true,"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9762796,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-11-09T01:47:33.257Z","updated_at":"2020-11-09T01:47:33.257Z","actor":{"url":"/ibb-php","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"PHP (IBB)"}},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}