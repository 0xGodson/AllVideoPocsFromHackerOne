{"id":341634,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNDE2MzQ=","url":"https://hackerone.com/reports/341634","title":"Invalid URL parsing '#'","state":"Closed","substate":"informative","severity_rating":"none","readable_substate":"Informative","created_at":"2018-04-21T19:23:14.376Z","submitted_at":"2018-04-21T19:23:14.376Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mrtc0","url":"/mrtc0","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/032/422/a10092a587db82187ae49dcf0208b12393547ae2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":7724,"url":"https://hackerone.com/ruby","handle":"ruby","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/724/bb067434deef370d6a0b16c2cbbc030b57c75e92_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Ruby","twitter_handle":"","website":"https://www.ruby-lang.org","about":"A Programmer's Best Friend"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-05-01T14:47:21.018Z","bug_reporter_agreed_on_going_public_at":"2018-05-01T14:47:20.924Z","team_member_agreed_on_going_public_at":"2018-04-25T06:00:28.700Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"`URI` is not correctly parsed when \"#\" is included in the URL.\nTherefore, could instead be tricked into connecting to a different host. \n\n### PoC\n\n```bash\n$ ruby --version\nruby 2.4.1p111 (2017-03-22 revision 58053) [x86_64-darwin16]\n```\n\n```ruby\nrequire 'uri'\nuri = URI(\"http://www.example.com#@test.evil.com/test\")\n# =\u003e #\u003cURI::HTTP http://www.example.com.evil.com/test\u003e\np uri.hostname\n# =\u003e \"www.example.com.evil.com\"\n```\n\nBut, does not happen if use single quotes,  like this.\n\n```ruby\nuri = URI.parse('http://www.example.com#@evil.com/test')\np uri.hostname\n# =\u003e www.example.com\n```\n\nHowever, in RFC 3986 it is defined that after \"#\" it is interpreted as a fragment.\nTherefore, this behavior is contrary to the user's intuition and easy to overlook.\n\n## Impact\n\nThe user may connect to an unintended host.","vulnerability_information_html":"\u003cp\u003e\u003ccode\u003eURI\u003c/code\u003e is not correctly parsed when \u0026quot;#\u0026quot; is included in the URL.\u003cbr\u003e\nTherefore, could instead be tricked into connecting to a different host. \u003c/p\u003e\n\n\u003ch3 id=\"poc\"\u003ePoC\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003eruby \u003cspan class=\"nt\"\u003e--version\u003c/span\u003e\nruby 2.4.1p111 \u003cspan class=\"o\"\u003e(\u003c/span\u003e2017-03-22 revision 58053\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003ex86_64-darwin16]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003erequire\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;uri\u0026#39;\u003c/span\u003e\n\u003cspan class=\"n\"\u003euri\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eURI\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;http://www.example.com\u003c/span\u003e\u003cspan class=\"si\"\u003e#@test\u003c/span\u003e\u003cspan class=\"s2\"\u003e.evil.com/test\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# =\u0026gt; #\u0026lt;URI::HTTP http://www.example.com.evil.com/test\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ehostname\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# =\u0026gt; \u0026quot;www.example.com.evil.com\u0026quot;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBut, does not happen if use single quotes,  like this.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"no\"\u003eURI\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eparse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;http://www.example.com#@evil.com/test\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ehostname\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# =\u0026gt; www.example.com\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHowever, in RFC 3986 it is defined that after \u0026quot;#\u0026quot; it is interpreted as a fragment.\u003cbr\u003e\nTherefore, this behavior is contrary to the user\u0026#39;s intuition and easy to overlook.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThe user may connect to an unintended host.\u003c/p\u003e\n","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":0,"voters":[],"severity":{"rating":"none","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2652104,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"JFYI it's string literal who eats the # character, not URI.\n\n```ruby\np \"http://www.example.com#@test.evil.com/test\"\n# =\u003e \"http://www.example.com.evil.com/test\"\n```\n\nHere, `#@test` is replaced with the contents of instance variable `@test`, which is empty.\n\nI don't think this is a security issue.  To _abuse_ this, a programmer should be explicitly malicious.","markdown_message":"\u003cp\u003eJFYI it\u0026#39;s string literal who eats the # character, not URI.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight ruby\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003ep\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;http://www.example.com\u003c/span\u003e\u003cspan class=\"si\"\u003e#@test\u003c/span\u003e\u003cspan class=\"s2\"\u003e.evil.com/test\u0026quot;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# =\u0026gt; \u0026quot;http://www.example.com.evil.com/test\u0026quot;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHere, \u003ccode\u003e#@test\u003c/code\u003e is replaced with the contents of instance variable \u003ccode\u003e@test\u003c/code\u003e, which is empty.\u003c/p\u003e\n\n\u003cp\u003eI don\u0026#39;t think this is a security issue.  To \u003cu\u003eabuse\u003c/u\u003e this, a programmer should be explicitly malicious.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-23T00:38:24.598Z","updated_at":"2018-04-23T00:38:24.598Z","actor":{"username":"shyouhei","cleared":false,"url":"/shyouhei","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2652181,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-23T02:15:06.161Z","updated_at":"2018-04-23T02:15:06.161Z","additional_data":{"old_severity":"Medium","new_severity":"None","old_severity_id":143807,"new_severity_id":144000},"actor":{"username":"nobu","cleared":false,"url":"/nobu","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/083/585/0d7081d0d147b05e9630bb56974707efae6d6721_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2658124,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"It's intentional behavior, not a vulnerability.","markdown_message":"\u003cp\u003eIt\u0026#39;s intentional behavior, not a vulnerability.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-24T07:43:11.376Z","updated_at":"2018-04-24T07:43:11.376Z","actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2662199,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-04-25T06:00:28.721Z","updated_at":"2018-04-25T06:00:28.721Z","first_to_agree":true,"actor":{"username":"hsbt","cleared":false,"url":"/hsbt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/051/808/c3eeedf7f0d1a3c3eead4e0106bbcc4441e0d9f5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2686685,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-01T14:47:20.943Z","updated_at":"2018-05-01T14:47:20.943Z","actor":{"username":"mrtc0","cleared":false,"url":"/mrtc0","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/032/422/a10092a587db82187ae49dcf0208b12393547ae2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2686686,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-01T14:47:21.036Z","updated_at":"2018-05-01T14:47:21.036Z","actor":{"username":"mrtc0","cleared":false,"url":"/mrtc0","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/032/422/a10092a587db82187ae49dcf0208b12393547ae2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ruby","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}