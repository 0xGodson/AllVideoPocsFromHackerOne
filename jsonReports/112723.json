{"id":112723,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTI3MjM=","url":"https://hackerone.com/reports/112723","title":"PHP-FPM fpm_log.c memory leak and buffer overflow","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-01-25T17:19:21.537Z","submitted_at":"2016-01-25T17:19:21.537Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"imrerad","url":"/imrerad","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":29,"url":"https://hackerone.com/ibb-php","handle":"ibb-php","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"PHP (IBB)","twitter_handle":"","website":"http://www.php.net","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-11-12T09:38:12.882Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2019-10-13T09:38:01.114Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The FastCGI Process Manager (FPM) SAPI of PHP was vulnerable to memory leak and buffer overflow in the access logging feature.\n\nPHP-FPM offers customization of the access log lines based on format string variables which can be specified with the access.format option of the FPM configuration file.\nThe log lines were compiled in php-fpm.c. The %{something}e fields were processed at line 237:\n\nlen2 = snprintf(b, FPM_LOG_BUFFER - len, \"%s\", env ? env : \"-\");\n\nThen later in the code:\nlen += len2;\n...\n    if (!test \u0026\u0026 strlen(buffer) \u003e 0) {\n         buffer[len] = '\\n';\n        write(fpm_log_fd, buffer, len + 1);\n    }\n\nIn case the string being appended to the access log line buffer was longer than the remaining space, the len variable became longer than the buffer (FPM_LOG_BUFFER) size, because snprintf returns the number of characters (excluding the terminating null byte) which would have been written to the final string if enough space had been available. Then the PHP engine performed an out-of-boundaries read and also wrote a \\n character outside of the allocated memory.\n\nThe fix is available with the commit\nhttp://git.php.net/?p=php-src.git;a=commit;h=2721a0148649e07ed74468f097a28899741eb58f\nThe fixed versions of PHP are: 5.5.31, 5.6.17 and 7.0.2.\n\nMore information (public security advisory):\nhttp://www.search-lab.hu/about-us/news/111-some-unusual-vulnerabilities-in-the-php-engine","vulnerability_information_html":"\u003cp\u003eThe FastCGI Process Manager (FPM) SAPI of PHP was vulnerable to memory leak and buffer overflow in the access logging feature.\u003c/p\u003e\n\n\u003cp\u003ePHP-FPM offers customization of the access log lines based on format string variables which can be specified with the access.format option of the FPM configuration file.\u003cbr\u003e\nThe log lines were compiled in php-fpm.c. The %{something}e fields were processed at line 237:\u003c/p\u003e\n\n\u003cp\u003elen2 = snprintf(b, FPM_LOG_BUFFER - len, \u0026quot;%s\u0026quot;, env ? env : \u0026quot;-\u0026quot;);\u003c/p\u003e\n\n\u003cp\u003eThen later in the code:\u003cbr\u003e\nlen += len2;\u003cbr\u003e\n...\u003cbr\u003e\n    if (!test \u0026amp;\u0026amp; strlen(buffer) \u0026gt; 0) {\u003cbr\u003e\n         buffer[len] = \u0026#39;\\n\u0026#39;;\u003cbr\u003e\n        write(fpm_log_fd, buffer, len + 1);\u003cbr\u003e\n    }\u003c/p\u003e\n\n\u003cp\u003eIn case the string being appended to the access log line buffer was longer than the remaining space, the len variable became longer than the buffer (FPM_LOG_BUFFER) size, because snprintf returns the number of characters (excluding the terminating null byte) which would have been written to the final string if enough space had been available. Then the PHP engine performed an out-of-boundaries read and also wrote a \\n character outside of the allocated memory.\u003c/p\u003e\n\n\u003cp\u003eThe fix is available with the commit\u003cbr\u003e\n\u003ca title=\"http://git.php.net/?p=php-src.git%3Ba=commit%3Bh=2721a0148649e07ed74468f097a28899741eb58f\" href=\"/redirect?url=http%3A%2F%2Fgit.php.net%2F%3Fp%3Dphp-src.git%253Ba%3Dcommit%253Bh%3D2721a0148649e07ed74468f097a28899741eb58f\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://git.php.net/?p=php-src.git%3Ba=commit%3Bh=2721a0148649e07ed74468f097a28899741eb58f\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nThe fixed versions of PHP are: 5.5.31, 5.6.17 and 7.0.2.\u003c/p\u003e\n\n\u003cp\u003eMore information (public security advisory):\u003cbr\u003e\n\u003ca title=\"http://www.search-lab.hu/about-us/news/111-some-unusual-vulnerabilities-in-the-php-engine\" href=\"/redirect?url=http%3A%2F%2Fwww.search-lab.hu%2Fabout-us%2Fnews%2F111-some-unusual-vulnerabilities-in-the-php-engine\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.search-lab.hu/about-us/news/111-some-unusual-vulnerabilities-in-the-php-engine\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-11-12T09:38:01.218Z","allow_singular_disclosure_after":-35663932.97323581,"singular_disclosure_allowed":true,"vote_count":1,"voters":["dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":935022,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-01T00:14:43.220Z","updated_at":"2016-05-01T00:14:43.220Z","actor":{"url":"/ibb-php","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"PHP (IBB)"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"ibb-php","collaborator":{"username":"imrerad","url":"/imrerad"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":935023,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-01T00:14:50.207Z","updated_at":"2016-05-01T00:14:50.207Z","actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"reporter":{"username":"imrerad","url":"/imrerad"},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6026471,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-13T09:38:01.128Z","updated_at":"2019-10-13T09:38:01.128Z","first_to_agree":true,"actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6285862,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-12T09:38:12.897Z","updated_at":"2019-11-12T09:38:12.897Z","actor":{"url":"/ibb-php","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/029/99087dbbdf52fc3ce3acbf16aa33a5c4f5e2c111_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"PHP (IBB)"}},"genius_execution_id":null,"team_handle":"ibb-php","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}