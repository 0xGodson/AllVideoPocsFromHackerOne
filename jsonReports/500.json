{"id":500,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81MDA=","url":"https://hackerone.com/reports/500","title":"OpenSSH: Memory corruption in AES-GCM support","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2013-11-07T00:00:00.000Z","submitted_at":"2013-11-07T00:00:00.000Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"markus","url":"/markus","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":20,"url":"https://hackerone.com/internet","handle":"internet","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"The Internet","twitter_handle":null,"website":"","about":"Hack all the things."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2013-4548"],"singular_disclosure_disabled":false,"disclosed_at":"2013-11-07T00:00:00.000Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2013-11-07T00:00:00.000Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"1. Vulnerability\n\n    A memory corruption vulnerability exists in the post- authentication sshd process when an AES-GCM cipher (aes128-gcm@openssh.com or aes256-gcm@openssh.com) is selected during kex exchange.\n\n    If exploited, this vulnerability might permit code execution with the privileges of the authenticated user and may therefore allow bypassing restricted shell/command configurations.\n\n2. Affected configurations\n\n    OpenSSH 6.2 and OpenSSH 6.3 when built against an OpenSSL that supports AES-GCM.\n\n3. Mitigation\n\n    Disable AES-GCM in the server configuration. The following sshd_config option will disable AES-GCM while leaving other ciphers active:\n\n    Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc\n\n4. Details\n\n    When using AES-GCM, sshd was not initialising a Message Authentication Code (MAC) context that is unused when the cipher mode offers authentication itself. This context contains some callback pointers, including a cleanup callback that was still being invoked during a rekeying operation.  As such, the address being called was derived from previous heap contents.\n\n    This vulnerability is mitigated by the difficulty of pre-loading the heap with a useful callback address and by any platform address-space layout randomisation applied to sshd and the shared libraries it depends upon.\n\n5. Credit\n\n    This issue was identified by Markus Friedl (an OpenSSH developer) on November 7th, 2013.\n\n6. Fix\n\n    OpenSSH 6.4 contains a fix for this vulnerability. Users who prefer to continue to use OpenSSH 6.2 or 6.3 may apply this patch:\n\n```\nIndex: monitor_wrap.c\n===================================================================\nRCS file: /cvs/src/usr.bin/ssh/monitor_wrap.c,v\nretrieving revision 1.76\ndiff -u -p -u -r1.76 monitor_wrap.c\n--- monitor_wrap.c\t17 May 2013 00:13:13 -0000\t1.76\n+++ monitor_wrap.c\t6 Nov 2013 16:31:26 -0000\n@@ -469,7 +469,7 @@ mm_newkeys_from_blob(u_char *blob, int b\n \tbuffer_init(\u0026b);\n \tbuffer_append(\u0026b, blob, blen);\n \n-\tnewkey = xmalloc(sizeof(*newkey));\n+\tnewkey = xcalloc(1, sizeof(*newkey));\n \tenc = \u0026newkey-\u003eenc;\n \tmac = \u0026newkey-\u003emac;\n \tcomp = \u0026newkey-\u003ecomp;\n```\n\nThis document may be found at: http://www.openssh.com/txt/gcmrekey.adv\n\n","vulnerability_information_html":"\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eVulnerability\u003c/p\u003e\n\n\u003cp\u003eA memory corruption vulnerability exists in the post- authentication sshd process when an AES-GCM cipher (\u003ca title=\"aes128-gcm@openssh.com\" href=\"mailto:aes128-gcm@openssh.com\" rel=\"nofollow noopener noreferrer\"\u003eaes128-gcm@openssh.com\u003c/a\u003e or \u003ca title=\"aes256-gcm@openssh.com\" href=\"mailto:aes256-gcm@openssh.com\" rel=\"nofollow noopener noreferrer\"\u003eaes256-gcm@openssh.com\u003c/a\u003e) is selected during kex exchange.\u003c/p\u003e\n\n\u003cp\u003eIf exploited, this vulnerability might permit code execution with the privileges of the authenticated user and may therefore allow bypassing restricted shell/command configurations.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAffected configurations\u003c/p\u003e\n\n\u003cp\u003eOpenSSH 6.2 and OpenSSH 6.3 when built against an OpenSSL that supports AES-GCM.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMitigation\u003c/p\u003e\n\n\u003cp\u003eDisable AES-GCM in the server configuration. The following sshd_config option will disable AES-GCM while leaving other ciphers active:\u003c/p\u003e\n\n\u003cp\u003eCiphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eDetails\u003c/p\u003e\n\n\u003cp\u003eWhen using AES-GCM, sshd was not initialising a Message Authentication Code (MAC) context that is unused when the cipher mode offers authentication itself. This context contains some callback pointers, including a cleanup callback that was still being invoked during a rekeying operation.  As such, the address being called was derived from previous heap contents.\u003c/p\u003e\n\n\u003cp\u003eThis vulnerability is mitigated by the difficulty of pre-loading the heap with a useful callback address and by any platform address-space layout randomisation applied to sshd and the shared libraries it depends upon.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCredit\u003c/p\u003e\n\n\u003cp\u003eThis issue was identified by Markus Friedl (an OpenSSH developer) on November 7th, 2013.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eFix\u003c/p\u003e\n\n\u003cp\u003eOpenSSH 6.4 contains a fix for this vulnerability. Users who prefer to continue to use OpenSSH 6.2 or 6.3 may apply this patch:\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gh\"\u003eIndex: monitor_wrap.c\n===================================================================\n\u003c/span\u003e\u003cspan class=\"p\"\u003eRCS file: /cvs/src/usr.bin/ssh/monitor_wrap.c,v\nretrieving revision 1.76\n\u003c/span\u003e\u003cspan class=\"gh\"\u003ediff -u -p -u -r1.76 monitor_wrap.c\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- monitor_wrap.c  17 May 2013 00:13:13 -0000  1.76\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ monitor_wrap.c  6 Nov 2013 16:31:26 -0000\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -469,7 +469,7 @@\u003c/span\u003e mm_newkeys_from_blob(u_char *blob, int b\n    buffer_init(\u0026amp;b);\n    buffer_append(\u0026amp;b, blob, blen);\n\n-   newkey = xmalloc(sizeof(*newkey));\n\u003cspan class=\"gi\"\u003e+   newkey = xcalloc(1, sizeof(*newkey));\n\u003c/span\u003e    enc = \u0026amp;newkey-\u0026gt;enc;\n    mac = \u0026amp;newkey-\u0026gt;mac;\n    comp = \u0026amp;newkey-\u0026gt;comp;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis document may be found at: \u003ca title=\"http://www.openssh.com/txt/gcmrekey.adv\" href=\"/redirect?url=http%3A%2F%2Fwww.openssh.com%2Ftxt%2Fgcmrekey.adv\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.openssh.com/txt/gcmrekey.adv\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"1500.0","formatted_bounty":"$1,500","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2013-11-07T00:00:00.000Z","allow_singular_disclosure_after":-225439763.75424674,"singular_disclosure_allowed":true,"vote_count":5,"voters":["kekkegenkai","sw33tlie","codeanddecode","spetr0x","dnz"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3042,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":null,"markdown_message":"","automated_response":false,"created_at":"2013-11-07T00:00:00.000Z","updated_at":"2013-11-07T00:00:00.000Z","actor":{"url":"/internet","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"The Internet"}},"reporter":{"username":"markus","url":"/markus"},"genius_execution_id":null,"team_handle":"internet","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3043,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":null,"markdown_message":"","automated_response":false,"created_at":"2013-12-04T09:08:53.244Z","updated_at":"2013-12-04T09:08:53.244Z","actor":{"url":"/internet","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/e3e1c58882b2645d9108ec102731a354cbf5852e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"The Internet"}},"bounty_amount":"1500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"internet","collaborator":{"username":"markus","url":"/markus"},"actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}