{"id":85624,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NTYyNA==","url":"https://hackerone.com/reports/85624","title":"Highly wormable clickjacking in player card","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-08-30T06:43:37.878Z","submitted_at":"2015-08-30T06:43:37.878Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"filedescriptor","url":"/filedescriptor","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":61,"url":"https://hackerone.com/twitter","handle":"twitter","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Twitter","twitter_handle":"twittersecurity","website":"https://twitter.com","about":"Twitter helps you create and share ideas and information instantly, without barriers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-05-17T23:11:28.495Z","bug_reporter_agreed_on_going_public_at":"2018-05-14T13:56:16.370Z","team_member_agreed_on_going_public_at":"2018-05-17T23:11:28.388Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\r\nI would like to report an issue where player card is vulnerable to clickjacking in certain browsers. This may result in something similar to XSS worm and many other critical damages.\r\n\r\n##Details\r\nTwitter Player Card allows a website to embed a custom player(html) into an iframe in a tweet. There are currently 2-3 security features in place to defend clickjacking on Twitter:\r\n1. ```X-Frame-Options: SAMEORIGIN``` covering the whole twitter.com domain\r\n2. ```Content-Security-Policy: frame-ancestors 'self'``` ditto\r\n3. JS-based frame-buster in some pages (but not all)\r\n\r\nFor (1), SAMEORIGIN only checks if the embedded frame is on the same origin of the top window. For example, attacker can do something like twitter.com -\u003e attacker.com -\u003e twitter.com to evade it. More details can been seen from here: https://bugzilla.mozilla.org/show_bug.cgi?id=725490 \r\nFor (2), this is the only way to correctly prevent framing from other websites (it performs the check against the ancestor list). However this is a CSP2 directive so not all browsers support it. For example, Safari and IE do not support it.\r\nFor (3), using the sandbox attribute of iframe can disable JS of a frame, hence anti-frame-buster\r\n\r\nSince Player Card is shown on a Tweet (on twitter.com), attacker can embed an iframe which embeds a Twitter page so that attacker can overlay it with \"bait\" content to lure victims to click on it.\r\n\r\nThe impact is huge because of the following facts:\r\n* The card displays directly on the user's timeline, making the attack less suspicious to normal clickjacking\r\n* The click is very subtle that victims cannot notice what's happened behind the scene\r\n* Wormable because attacker can make victims tweet arbitrary content to spread it\r\n* Can perform click-based critical actions, like follow, retweet, favorite... etc\r\n* If sent as promoted tweet, it can target even more victims, also player is directly expanded\r\n\r\n##Repo step\r\n1. Clone the Player Card started bundle here: https://github.com/twitterdev/cards\r\n2. Change the card's property *twitter:player* to a custom HTML file\r\n3. In the HTML file, embed iframe to a Twitter page, e.g. ```\u003ciframe src=\"//twitter.com\"\u003e\u003c/iframe\u003e```\r\n4. Post the link in a Tweet (make sure the domain is white-listed)\r\n5. Expand the tweet in Safari or IE, it will show that a Twitter page is embedded\r\n\r\nDocumentation of Player Card: https://dev.twitter.com/cards/types/player\r\n\r\n##PoC\r\n\r\nhttps://twitter.com/AttackerCanvas/status/637859735501279232 (**Open with Safari or IE**)\r\n\r\nVideo demo: https://vimeo.com/137725491 (password: click)\r\n\r\nThe PoC demonstrates how the attack can be conducted. There will be a fake video to lure victims to click to play it. After clicking the victim will automatically post a tweet with content \"Pwn3d!\".","vulnerability_information_html":"\u003cp\u003eHi,\u003cbr\u003e\nI would like to report an issue where player card is vulnerable to clickjacking in certain browsers. This may result in something similar to XSS worm and many other critical damages.\u003c/p\u003e\n\n\u003ch2 id=\"details\"\u003eDetails\u003c/h2\u003e\n\n\u003cp\u003eTwitter Player Card allows a website to embed a custom player(html) into an iframe in a tweet. There are currently 2-3 security features in place to defend clickjacking on Twitter:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003ccode\u003eX-Frame-Options: SAMEORIGIN\u003c/code\u003e covering the whole twitter.com domain\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eContent-Security-Policy: frame-ancestors \u0026#39;self\u0026#39;\u003c/code\u003e ditto\u003c/li\u003e\n\u003cli\u003eJS-based frame-buster in some pages (but not all)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eFor (1), SAMEORIGIN only checks if the embedded frame is on the same origin of the top window. For example, attacker can do something like twitter.com -\u0026gt; attacker.com -\u0026gt; twitter.com to evade it. More details can been seen from here: \u003ca title=\"https://bugzilla.mozilla.org/show_bug.cgi?id=725490\" href=\"/redirect?url=https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D725490\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://bugzilla.mozilla.org/show_bug.cgi?id=725490\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e \u003cbr\u003e\nFor (2), this is the only way to correctly prevent framing from other websites (it performs the check against the ancestor list). However this is a CSP2 directive so not all browsers support it. For example, Safari and IE do not support it.\u003cbr\u003e\nFor (3), using the sandbox attribute of iframe can disable JS of a frame, hence anti-frame-buster\u003c/p\u003e\n\n\u003cp\u003eSince Player Card is shown on a Tweet (on twitter.com), attacker can embed an iframe which embeds a Twitter page so that attacker can overlay it with \u0026quot;bait\u0026quot; content to lure victims to click on it.\u003c/p\u003e\n\n\u003cp\u003eThe impact is huge because of the following facts:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe card displays directly on the user\u0026#39;s timeline, making the attack less suspicious to normal clickjacking\u003c/li\u003e\n\u003cli\u003eThe click is very subtle that victims cannot notice what\u0026#39;s happened behind the scene\u003c/li\u003e\n\u003cli\u003eWormable because attacker can make victims tweet arbitrary content to spread it\u003c/li\u003e\n\u003cli\u003eCan perform click-based critical actions, like follow, retweet, favorite... etc\u003c/li\u003e\n\u003cli\u003eIf sent as promoted tweet, it can target even more victims, also player is directly expanded\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"repo-step\"\u003eRepo step\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eClone the Player Card started bundle here: \u003ca title=\"https://github.com/twitterdev/cards\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Ftwitterdev%2Fcards\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/twitterdev/cards\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eChange the card\u0026#39;s property \u003cem\u003etwitter:player\u003c/em\u003e to a custom HTML file\u003c/li\u003e\n\u003cli\u003eIn the HTML file, embed iframe to a Twitter page, e.g. \u003ccode\u003e\u0026lt;iframe src=\u0026quot;//twitter.com\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003ePost the link in a Tweet (make sure the domain is white-listed)\u003c/li\u003e\n\u003cli\u003eExpand the tweet in Safari or IE, it will show that a Twitter page is embedded\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eDocumentation of Player Card: \u003ca title=\"https://dev.twitter.com/cards/types/player\" href=\"/redirect?url=https%3A%2F%2Fdev.twitter.com%2Fcards%2Ftypes%2Fplayer\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://dev.twitter.com/cards/types/player\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"poc\"\u003ePoC\u003c/h2\u003e\n\n\u003cp\u003e\u003ca title=\"https://twitter.com/AttackerCanvas/status/637859735501279232\" href=\"/redirect?url=https%3A%2F%2Ftwitter.com%2FAttackerCanvas%2Fstatus%2F637859735501279232\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://twitter.com/AttackerCanvas/status/637859735501279232\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (\u003cstrong\u003eOpen with Safari or IE\u003c/strong\u003e)\u003c/p\u003e\n\n\u003cp\u003eVideo demo: \u003ca title=\"https://vimeo.com/137725491\" href=\"/redirect?url=https%3A%2F%2Fvimeo.com%2F137725491\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://vimeo.com/137725491\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (password: click)\u003c/p\u003e\n\n\u003cp\u003eThe PoC demonstrates how the attack can be conducted. There will be a fake video to lure victims to click to play it. After clicking the victim will automatically post a tweet with content \u0026quot;Pwn3d!\u0026quot;.\u003c/p\u003e\n","bounty_amount":"5040.0","formatted_bounty":"$5,040","weakness":{"id":74,"name":"UI Redressing (Clickjacking)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-06-13T13:56:16.444Z","allow_singular_disclosure_after":-80327157.59362914,"singular_disclosure_allowed":true,"vote_count":127,"voters":["test0x00","jokebookservice1","natanalves01001","sp1d3rs","kapytein","europa","mvc","jobert","hunter","bull","and 117 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":568346,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The fix is very tricky here considering the usage of Player Card. For example using the sandbox attribute will break all player cards because plugins are also disabled. One workaround is to insert a JS snippet in all twitter page to check the frame ancestors, but then attackers can still use the sandbox attribute to disable the JS. The ultimate fix would be to change the way Player Card behaves.\n\nOh by the way TweetDeck is also affected but the PoC may need adjustments.","markdown_message":"\u003cp\u003eThe fix is very tricky here considering the usage of Player Card. For example using the sandbox attribute will break all player cards because plugins are also disabled. One workaround is to insert a JS snippet in all twitter page to check the frame ancestors, but then attackers can still use the sandbox attribute to disable the JS. The ultimate fix would be to change the way Player Card behaves.\u003c/p\u003e\n\n\u003cp\u003eOh by the way TweetDeck is also affected but the PoC may need adjustments.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-08-30T07:05:40.231Z","updated_at":"2015-08-30T07:07:28.854Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":576050,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here is a more delicate and stealthy PoC with maximum damage:\nhttps://twitter.com/AttackerCanvas/status/639465287629144064\nVideo demo: https://vimeo.com/138212863 (password: app)\n\nVictim will see it as a normal embedded YouTube video, and it can be interacted properly (click to play). Victims will definitely not notice anything. Behind the scene the victim is actually clicking on the Authorize button on a fake app with full read, write permission, so that attacker can gain long-term control over the victim. Besides it is easy to fake an legitimate app (like Twitter for iPhone), so even victims notice there is a new app that has access to his/her account he/she would not be able to distinguish it.","markdown_message":"\u003cp\u003eHere is a more delicate and stealthy PoC with maximum damage:\u003cbr\u003e\n\u003ca title=\"https://twitter.com/AttackerCanvas/status/639465287629144064\" href=\"/redirect?url=https%3A%2F%2Ftwitter.com%2FAttackerCanvas%2Fstatus%2F639465287629144064\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://twitter.com/AttackerCanvas/status/639465287629144064\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nVideo demo: \u003ca title=\"https://vimeo.com/138212863\" href=\"/redirect?url=https%3A%2F%2Fvimeo.com%2F138212863\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://vimeo.com/138212863\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (password: app)\u003c/p\u003e\n\n\u003cp\u003eVictim will see it as a normal embedded YouTube video, and it can be interacted properly (click to play). Victims will definitely not notice anything. Behind the scene the victim is actually clicking on the Authorize button on a fake app with full read, write permission, so that attacker can gain long-term control over the victim. Besides it is easy to fake an legitimate app (like Twitter for iPhone), so even victims notice there is a new app that has access to his/her account he/she would not be able to distinguish it.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-03T16:12:53.330Z","updated_at":"2015-09-03T16:14:00.435Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":576176,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\n\nThank you for helping keep Twitter secure!","markdown_message":"\u003cp\u003eThank you for your report. We believe it may be a valid security issue and will investigate it further. It could take some time to find and update the root cause for an issue, so we thank you for your patience.\u003c/p\u003e\n\n\u003cp\u003eThank you for helping keep Twitter secure!\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-03T17:17:27.097Z","updated_at":"2015-09-03T17:17:27.097Z","actor":{"username":"bfd","cleared":false,"url":"/bfd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/639/cb4711f9ee63746ad25d3c68fdef609f4ea84711_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":585403,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks again. As mentioned we’ll keep you updated as we investigate further. As a reminder, please remember to keep the details of this report private until we have fully investigated and addressed the issue.","markdown_message":"\u003cp\u003eThanks again. As mentioned we’ll keep you updated as we investigate further. As a reminder, please remember to keep the details of this report private until we have fully investigated and addressed the issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-09-11T17:35:14.315Z","updated_at":"2015-09-11T17:35:14.315Z","actor":{"url":"/twitter","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/061/85a63a443f017ad8353de4f68ebf52fdd61c345a_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Twitter"}},"bounty_amount":"5040.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"twitter","collaborator":{"username":"filedescriptor","url":"/filedescriptor"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1069018,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We consider this issue to be fixed now. Can you please confirm?\n\nThank you for helping keep Twitter secure!","markdown_message":"\u003cp\u003eWe consider this issue to be fixed now. Can you please confirm?\u003c/p\u003e\n\n\u003cp\u003eThank you for helping keep Twitter secure!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-14T15:53:42.643Z","updated_at":"2016-07-14T15:53:42.643Z","actor":{"username":"bfd","cleared":false,"url":"/bfd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/639/cb4711f9ee63746ad25d3c68fdef609f4ea84711_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"filedescriptor","url":"/filedescriptor"},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1074590,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here's what I observe:\n1. Player card now requires a click to open \n2. New applications for player cards now use iframe sandbox by default\n\nI wouldn't say the fix is perfect but given that it's a mitigation for the specifications this should be sufficient.","markdown_message":"\u003cp\u003eHere\u0026#39;s what I observe:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003ePlayer card now requires a click to open \u003c/li\u003e\n\u003cli\u003eNew applications for player cards now use iframe sandbox by default\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eI wouldn\u0026#39;t say the fix is perfect but given that it\u0026#39;s a mitigation for the specifications this should be sufficient.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-18T19:42:18.427Z","updated_at":"2016-07-18T19:42:18.427Z","actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2739512,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-14T13:56:16.401Z","updated_at":"2018-05-14T13:56:16.401Z","first_to_agree":true,"actor":{"username":"filedescriptor","cleared":true,"url":"/filedescriptor","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2759261,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Approved","markdown_message":"\u003cp\u003eApproved\u003c/p\u003e\n","automated_response":false,"created_at":"2018-05-17T23:11:28.416Z","updated_at":"2018-05-17T23:11:28.416Z","actor":{"username":"aarun","cleared":false,"url":"/aarun","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/166/486/bcf774a6460ff9e33545235af9344be33732008d_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2759262,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-17T23:11:28.527Z","updated_at":"2018-05-17T23:11:28.527Z","actor":{"username":"aarun","cleared":false,"url":"/aarun","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/166/486/bcf774a6460ff9e33545235af9344be33732008d_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"twitter","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":7460,"category":"researcher","content":"https://blog.innerht.ml/google-yolo/","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003ca title=\"https://blog.innerht.ml/google-yolo/\" href=\"/redirect?url=https%3A%2F%2Fblog.innerht.ml%2Fgoogle-yolo%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://blog.innerht.ml/google-yolo/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n"}]}