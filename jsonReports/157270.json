{"id":157270,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTcyNzA=","url":"https://hackerone.com/reports/157270","title":"CSRF vulnerability that allows an attacker to purge plugin metric data","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-08-06T22:47:20.418Z","submitted_at":"2016-08-06T22:47:20.418Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"martijn","url":"/martijn","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17011,"url":"https://hackerone.com/newrelic","handle":"newrelic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"New Relic","twitter_handle":"newrelic","website":"https://newrelic.com","about":"New Relic's Coordinated Disclosure Program"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-05T08:48:08.879Z","bug_reporter_agreed_on_going_public_at":"2016-11-05T08:48:07.990Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"# Vulnerability details\nA (seemingly) minor CSRF vulnerability exists in the endpoint that purges plugin metric data. When an admin visits the Agent overview of its account, it will show a button for each plugin that allows the admin to purge the data. This button links to a `GET` requests that is vulnerable to a CSRF attack.\n\n# Proof of concept\nThe attack is not super likely to be successfully pulled off, given the fact that the attacker needs to know the account ID and the plugin ID. However, in theory, it's possible and guessable, since the IDs are auto incrementing. To get the combination of both correct with a brute force attach is pretty low in my mind, but it could be interesting to abuse this in a more targeted attack (for example when a \"normal user\" tricks another user into visiting a certain link that purges the cache).\n\nTo reproduce the issue, sign in as an account admin. Make sure the account has a plugin installed. Now go to https://rpm.newrelic.com/accounts/411552/agents, where `411552` is the account ID. Copy the agent ID from the \"Purge metric data\" and append it to the agent URL: https://rpm.newrelic.com/accounts/411552/agents/12345. Now prepare the exploit:\n\n```\n\u003cimg src=\"https://rpm.newrelic.com/accounts/411552/agents/12345\" /\u003e\n```\n\nStore the code example above in a file and serve it to the victim. It'll fire a `GET` request as the person that is currently signed into rpm.newrelic.com. If that user has access to the account and agent ID, it'll purge the metric data for that agent without any interaction (besides visiting the rogue site) of the victim.","vulnerability_information_html":"\u003ch1 id=\"vulnerability-details\"\u003eVulnerability details\u003c/h1\u003e\n\n\u003cp\u003eA (seemingly) minor CSRF vulnerability exists in the endpoint that purges plugin metric data. When an admin visits the Agent overview of its account, it will show a button for each plugin that allows the admin to purge the data. This button links to a \u003ccode\u003eGET\u003c/code\u003e requests that is vulnerable to a CSRF attack.\u003c/p\u003e\n\n\u003ch1 id=\"proof-of-concept\"\u003eProof of concept\u003c/h1\u003e\n\n\u003cp\u003eThe attack is not super likely to be successfully pulled off, given the fact that the attacker needs to know the account ID and the plugin ID. However, in theory, it\u0026#39;s possible and guessable, since the IDs are auto incrementing. To get the combination of both correct with a brute force attach is pretty low in my mind, but it could be interesting to abuse this in a more targeted attack (for example when a \u0026quot;normal user\u0026quot; tricks another user into visiting a certain link that purges the cache).\u003c/p\u003e\n\n\u003cp\u003eTo reproduce the issue, sign in as an account admin. Make sure the account has a plugin installed. Now go to \u003ca title=\"https://rpm.newrelic.com/accounts/411552/agents\" href=\"/redirect?url=https%3A%2F%2Frpm.newrelic.com%2Faccounts%2F411552%2Fagents\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://rpm.newrelic.com/accounts/411552/agents\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, where \u003ccode\u003e411552\u003c/code\u003e is the account ID. Copy the agent ID from the \u0026quot;Purge metric data\u0026quot; and append it to the agent URL: \u003ca title=\"https://rpm.newrelic.com/accounts/411552/agents/12345\" href=\"/redirect?url=https%3A%2F%2Frpm.newrelic.com%2Faccounts%2F411552%2Fagents%2F12345\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://rpm.newrelic.com/accounts/411552/agents/12345\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Now prepare the exploit:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;img src=\u0026quot;https://rpm.newrelic.com/accounts/411552/agents/12345\u0026quot; /\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eStore the code example above in a file and serve it to the victim. It\u0026#39;ll fire a \u003ccode\u003eGET\u003c/code\u003e request as the person that is currently signed into rpm.newrelic.com. If that user has access to the account and agent ID, it\u0026#39;ll purge the metric data for that agent without any interaction (besides visiting the rogue site) of the victim.\u003c/p\u003e\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-12-05T08:48:08.016Z","allow_singular_disclosure_after":-128288841.93313599,"singular_disclosure_allowed":true,"vote_count":7,"voters":["michiel","eveeez","leet-boy","japz","sumit7","spetr0x","martijn"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1113593,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-08T21:28:37.259Z","updated_at":"2016-08-08T21:28:37.259Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1113618,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Martijn,\n\nThank you for the detailed and pragmatic report. We agree that would be pretty difficult to exploit but think we should fix it anyway. We've created a ticket for the responsible engineering team and they'll begin addressing the issue according to our vulnerability rating system. \n\nWe'll update this ticket when the issue has been addressed for you to verify the fix.\n\nCheers,\nMatthew","markdown_message":"\u003cp\u003eHi Martijn,\u003c/p\u003e\n\n\u003cp\u003eThank you for the detailed and pragmatic report. We agree that would be pretty difficult to exploit but think we should fix it anyway. We\u0026#39;ve created a ticket for the responsible engineering team and they\u0026#39;ll begin addressing the issue according to our vulnerability rating system. \u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;ll update this ticket when the issue has been addressed for you to verify the fix.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nMatthew\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-08T21:38:40.989Z","updated_at":"2016-08-08T21:38:40.989Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1114080,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Awesome, thanks for the quick reply! ","markdown_message":"\u003cp\u003eAwesome, thanks for the quick reply! \u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-09T04:05:28.300Z","updated_at":"2016-08-09T04:05:28.300Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1118238,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Martijn,\n\nWe're unable to reproduce this issue. The steps we follow were:\n- Used an agent w/ a plugin to generate metric data (ensuring that data indeed showed up in the application)\n- Created an html file containing \u003cimg src=\"https://rpm.newrelic.com/accounts/\u003cacctID\u003e/agents/\u003cpluginID\u003e\"/\u003e\n- Loaded the html file in a browser\n\nHowever, we did not see any change with the metric data for that account/plugin. Can you provide some more detail (network captures, etc), for us to diagnose this issue further.\n\nThank you,\nMatthew","markdown_message":"\u003cp\u003eHi Martijn,\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;re unable to reproduce this issue. The steps we follow were:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eUsed an agent w/ a plugin to generate metric data (ensuring that data indeed showed up in the application)\u003c/li\u003e\n\u003cli\u003eCreated an html file containing \u0026lt;img src=\u0026quot;https://rpm.newrelic.com/accounts/\u0026lt;acctID\u0026gt;/agents/\u0026lt;pluginID\u0026gt;\u0026quot;/\u0026gt;\u003c/li\u003e\n\u003cli\u003eLoaded the html file in a browser\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eHowever, we did not see any change with the metric data for that account/plugin. Can you provide some more detail (network captures, etc), for us to diagnose this issue further.\u003c/p\u003e\n\n\u003cp\u003eThank you,\u003cbr\u003e\nMatthew\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-10T22:25:14.497Z","updated_at":"2016-08-10T22:25:14.497Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1121102,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mlapworth - sorry about that. I screwed up on the PoC. The correct URL for the `src` attribute has to be `https://rpm.newrelic.com/accounts/411552/agents/12345/purge_metrics`. My bad! Let me know if that works.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mlapworth\"\u003e@mlapworth\u003c/a\u003e - sorry about that. I screwed up on the PoC. The correct URL for the \u003ccode\u003esrc\u003c/code\u003e attribute has to be \u003ccode\u003ehttps://rpm.newrelic.com/accounts/411552/agents/12345/purge_metrics\u003c/code\u003e. My bad! Let me know if that works.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-12T04:46:29.870Z","updated_at":"2016-08-12T04:46:29.870Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1123302,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks Martijn. We'll re-test now and let you know how it goes.","markdown_message":"\u003cp\u003eThanks Martijn. We\u0026#39;ll re-test now and let you know how it goes.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-12T15:37:24.567Z","updated_at":"2016-08-12T15:37:24.567Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1169339,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @mlapworth, did you verify the issue. Let me know if you need any help.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/mlapworth\"\u003e@mlapworth\u003c/a\u003e, did you verify the issue. Let me know if you need any help.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-02T09:50:32.200Z","updated_at":"2016-09-02T09:50:32.200Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1180192,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Martijn, we have successfully reproduced the issue. I have created a task with the engineering team responsible for that functionality and they're working on it according to our vulnerability rating system. I'll update this ticket once we've engineered a fix so you can re-test.\n\nSorry for the slow response!\n\nCheers,\nMatthew","markdown_message":"\u003cp\u003eHi Martijn, we have successfully reproduced the issue. I have created a task with the engineering team responsible for that functionality and they\u0026#39;re working on it according to our vulnerability rating system. I\u0026#39;ll update this ticket once we\u0026#39;ve engineered a fix so you can re-test.\u003c/p\u003e\n\n\u003cp\u003eSorry for the slow response!\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nMatthew\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-07T15:02:50.432Z","updated_at":"2016-09-07T15:02:50.432Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1180202,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem, happy to hear you were able to reproduce the issue.","markdown_message":"\u003cp\u003eNo problem, happy to hear you were able to reproduce the issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-09-07T15:06:15.093Z","updated_at":"2016-09-07T15:06:15.093Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1281236,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Martijn,\n\nThe fix for this issue has been deployed to production. Can you verify the fix?\n\nThank you,\nMatthew\n","markdown_message":"\u003cp\u003eHi Martijn,\u003c/p\u003e\n\n\u003cp\u003eThe fix for this issue has been deployed to production. Can you verify the fix?\u003c/p\u003e\n\n\u003cp\u003eThank you,\u003cbr\u003e\nMatthew\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-02T21:34:57.866Z","updated_at":"2016-11-02T21:34:57.866Z","actor":{"username":"mlapworth","cleared":false,"url":"/mlapworth","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/037/133/217dcc39c148da22068b3c64788e88e89c7cfe21_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1282205,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update. I can confirm this is fixed. It now fires a `POST` request.","markdown_message":"\u003cp\u003eThanks for the update. I can confirm this is fixed. It now fires a \u003ccode\u003ePOST\u003c/code\u003e request.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-03T12:44:18.324Z","updated_at":"2016-11-03T12:44:18.324Z","actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1285360,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for reporting the issue Martijn ! We appreciate your help in keeping New Relic secure ! ","markdown_message":"\u003cp\u003eThanks for reporting the issue Martijn ! We appreciate your help in keeping New Relic secure ! \u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-04T22:39:03.083Z","updated_at":"2016-11-04T22:39:03.083Z","actor":{"username":"imelven","cleared":false,"url":"/imelven","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/153/809e507ea6cd7c5c120920d1d4ce70336974d422_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"martijn","url":"/martijn"},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1285727,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-05T08:48:08.003Z","updated_at":"2016-11-05T08:48:08.003Z","first_to_agree":true,"actor":{"username":"martijn","cleared":false,"url":"/martijn","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5sJxxikBF7fwfkWs531JPtef/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1340775,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-05T08:48:08.895Z","updated_at":"2016-12-05T08:48:08.895Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"New Relic"}},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2694217,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2018-05-03T03:28:31.641Z","updated_at":"2018-05-03T03:28:31.641Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"New Relic"}},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}