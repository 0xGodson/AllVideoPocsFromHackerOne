{"id":181879,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODE4Nzk=","url":"https://hackerone.com/reports/181879","title":"Struct type confusion RCE","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2016-11-13T07:21:17.397Z","submitted_at":"2016-11-13T07:21:17.397Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"charliesome","url":"/charliesome","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/738/78470971e95623d272226b011823c8590ffe6cf3_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-17T01:03:22.530Z","bug_reporter_agreed_on_going_public_at":"2016-12-17T01:03:22.483Z","team_member_agreed_on_going_public_at":"2016-12-16T19:51:59.578Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Heya!\n\nI've been poking at mruby a bit more and I've found a vulnerability that allows an attacker to take control of the instruction pointer.\n\nI've attached a proof of concept script that when run in mruby will jump to `0x0000133713371337` and segfault.\n\nWhile the proof of concept script just jumps to an attacker controlled address and crashes, it would almost certainly be possible to achieve full remote code execution, especially given an arbitrary read/write primitive (which is easily created using the same techniques as in the proof of concept)\n\nThe proof of concept script has detailed annotations throughout about how it works, but I'm also happy to clarify anything if need be :)\n\nCheers,\n\nCharlie","vulnerability_information_html":"\u003cp\u003eHeya!\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve been poking at mruby a bit more and I\u0026#39;ve found a vulnerability that allows an attacker to take control of the instruction pointer.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve attached a proof of concept script that when run in mruby will jump to \u003ccode\u003e0x0000133713371337\u003c/code\u003e and segfault.\u003c/p\u003e\n\n\u003cp\u003eWhile the proof of concept script just jumps to an attacker controlled address and crashes, it would almost certainly be possible to achieve full remote code execution, especially given an arbitrary read/write primitive (which is easily created using the same techniques as in the proof of concept)\u003c/p\u003e\n\n\u003cp\u003eThe proof of concept script has detailed annotations throughout about how it works, but I\u0026#39;m also happy to clarify anything if need be :)\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eCharlie\u003c/p\u003e\n","bounty_amount":"18000.0","formatted_bounty":"$18,000","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":134429,"file_name":"mruby-rce-poc.rb","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/134/429/004005d8a8d5af2fa65c308e5a5c0ae3b3910825/mruby-rce-poc.rb?response-content-disposition=attachment%3B%20filename%3D%22mruby-rce-poc.rb%22%3B%20filename%2A%3DUTF-8%27%27mruby-rce-poc.rb\u0026response-content-type=text%2Fx-c\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSUJSTWNA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044548Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDC4LZo82wc2eCvBFlhjwE027CwJoHB88%2BMK2v03JEf7AIgTsNTuR7XI5zLkpcU%2F192zliPMALv25wXWHyoW56mHW0qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDDQxd6Ep%2FudaJolhjiqRA%2FV9m3Q5qTHiEf%2B0F56QxIa0FX4xcw3kyVQ754zuEWG6%2FFHm5u50c%2FkjIZTK4iokf%2F5bg8%2F9lzPcfaf%2FlyMeeuZQiIR66c8Q0ZynlQYFFg39COCCRcmQH0rk4Py7SioeZK1WX50szdnMCAEBM0%2FYGIJRFlpJYz5%2BF7cuCEDZDVFz70QPaeLM9Aq2Hp0OWlaD%2BlKU2Ya8oXmKGTVLeV6xTf66mRdzvW8I4qKgZpByKnAcip5WWnkttPjUxPiLaEeZ%2BClnUyHZas2bB1iPmPH0rQXcKWbTOq%2BJJm8xX%2FgqtqSgjGTmncJVZJxe0UaRUPXS%2BxPh0KYERT9Te4D5sREOcmaPJ0lojWm5AuNIxK3S30FeTamdldG5jOgcjm7r6e2HjWcB7yfe4%2BCsYd2eVLbbXk95jZRHQohr%2B7Z9YEqq00TUANe07BXm%2FKoAPBMy0bYQHYmVJaGS31XhmN6DRKUn5mwwU6NQ87eIymigu48swQSaSOa0S3Ve15n99tYKCLxw%2FqcLrXK9DmAPRXyB2cTH85tpMJ7Qqv8FOusB0TY7T%2F8PPlS9Pw17cj5sLPnZSdHFb4OJ7xNuArhvZUxC%2FDdQIpfgbN40hDHy3r94ejzq63ULcWroBoxExSJ8F%2BIqLrT2jEE%2BHYV9rJ3uN20mlrWN07M1wfpVQeu7mZyiWu%2BTKEOjyLznji7d3Efn7A1SwzF%2FWi11RcA9%2BGeNTFCiOeyJRV4JWopx6NNi8TVr6hBraJmZeqXIUCIj4yW%2BvdbZ%2F7b%2BDWNq1S8BMna3Htt9r6lmeANRYdDH%2BkiA2F6n7nJrrrNm3hF7NHjHy1GdUin3XffXKseDfHdRNqxNelH1SrChi2zziLtHrQ%3D%3D\u0026X-Amz-Signature=9fa9b4df4f18d86559e7c84f33fde4ea92cfc74cb4db7c7593913432efa16129","file_size":6826,"type":"text/x-c"}],"allow_singular_disclosure_at":"2017-01-15T19:51:59.618Z","allow_singular_disclosure_after":-124707229.04876053,"singular_disclosure_allowed":true,"vote_count":6,"voters":["mpz","eveeez","spetr0x","scept1c","elakrimi","no-longer-with-company"],"severity":{"rating":"critical","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1296850,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"As a further proof of concept I've hacked up an arbitrary read/write primitive, which I've attached.\n\nThe demonstration uses `puts` so it won't work in mruby-engine, but it will work in mruby itself. Of course the fundamental primitive _will_ work in mruby-engine.\n\nWith this arbitrary read/write primitive it's certainly possible to start playing with internal data structures of not just mruby but the host MRI VM as well, enabling full remote code execution and potential disclosure of sensitive data.","markdown_message":"\u003cp\u003eAs a further proof of concept I\u0026#39;ve hacked up an arbitrary read/write primitive, which I\u0026#39;ve attached.\u003c/p\u003e\n\n\u003cp\u003eThe demonstration uses \u003ccode\u003eputs\u003c/code\u003e so it won\u0026#39;t work in mruby-engine, but it will work in mruby itself. Of course the fundamental primitive \u003cu\u003ewill\u003c/u\u003e work in mruby-engine.\u003c/p\u003e\n\n\u003cp\u003eWith this arbitrary read/write primitive it\u0026#39;s certainly possible to start playing with internal data structures of not just mruby but the host MRI VM as well, enabling full remote code execution and potential disclosure of sensitive data.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-13T08:14:50.509Z","updated_at":"2016-11-13T08:14:50.509Z","actor":{"username":"charliesome","cleared":false,"url":"/charliesome","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/738/78470971e95623d272226b011823c8590ffe6cf3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":134430,"filename":"mruby-read-write-primitive.rb","type":"text/x-ruby","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/134/430/9ede1a28e259c2d96a2a0c58b456375336cf4993/mruby-read-write-primitive.rb?response-content-disposition=attachment%3B%20filename%3D%22mruby-read-write-primitive.rb%22%3B%20filename%2A%3DUTF-8%27%27mruby-read-write-primitive.rb\u0026response-content-type=text%2Fx-ruby\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSUJSTWNA%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044548Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDC4LZo82wc2eCvBFlhjwE027CwJoHB88%2BMK2v03JEf7AIgTsNTuR7XI5zLkpcU%2F192zliPMALv25wXWHyoW56mHW0qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDDQxd6Ep%2FudaJolhjiqRA%2FV9m3Q5qTHiEf%2B0F56QxIa0FX4xcw3kyVQ754zuEWG6%2FFHm5u50c%2FkjIZTK4iokf%2F5bg8%2F9lzPcfaf%2FlyMeeuZQiIR66c8Q0ZynlQYFFg39COCCRcmQH0rk4Py7SioeZK1WX50szdnMCAEBM0%2FYGIJRFlpJYz5%2BF7cuCEDZDVFz70QPaeLM9Aq2Hp0OWlaD%2BlKU2Ya8oXmKGTVLeV6xTf66mRdzvW8I4qKgZpByKnAcip5WWnkttPjUxPiLaEeZ%2BClnUyHZas2bB1iPmPH0rQXcKWbTOq%2BJJm8xX%2FgqtqSgjGTmncJVZJxe0UaRUPXS%2BxPh0KYERT9Te4D5sREOcmaPJ0lojWm5AuNIxK3S30FeTamdldG5jOgcjm7r6e2HjWcB7yfe4%2BCsYd2eVLbbXk95jZRHQohr%2B7Z9YEqq00TUANe07BXm%2FKoAPBMy0bYQHYmVJaGS31XhmN6DRKUn5mwwU6NQ87eIymigu48swQSaSOa0S3Ve15n99tYKCLxw%2FqcLrXK9DmAPRXyB2cTH85tpMJ7Qqv8FOusB0TY7T%2F8PPlS9Pw17cj5sLPnZSdHFb4OJ7xNuArhvZUxC%2FDdQIpfgbN40hDHy3r94ejzq63ULcWroBoxExSJ8F%2BIqLrT2jEE%2BHYV9rJ3uN20mlrWN07M1wfpVQeu7mZyiWu%2BTKEOjyLznji7d3Efn7A1SwzF%2FWi11RcA9%2BGeNTFCiOeyJRV4JWopx6NNi8TVr6hBraJmZeqXIUCIj4yW%2BvdbZ%2F7b%2BDWNq1S8BMna3Htt9r6lmeANRYdDH%2BkiA2F6n7nJrrrNm3hF7NHjHy1GdUin3XffXKseDfHdRNqxNelH1SrChi2zziLtHrQ%3D%3D\u0026X-Amz-Signature=d71aa241ebb5fdd25fcb0f6e9794cb687fa68087eab63b58acda502c64ed03d2"}],"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1298737,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-14T17:51:51.335Z","updated_at":"2016-11-14T17:51:51.335Z","additional_data":{"old_severity":null,"new_severity":"High","old_severity_id":null,"new_severity_id":7508},"actor":{"username":"bvdbijl","cleared":false,"url":"/bvdbijl","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1299553,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report! We've reproduced the issue, and our engineering team is investigating.","markdown_message":"\u003cp\u003eThank you for your report! We\u0026#39;ve reproduced the issue, and our engineering team is investigating.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-14T23:47:32.992Z","updated_at":"2016-11-14T23:47:32.992Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1299554,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-14T23:47:38.330Z","updated_at":"2016-11-14T23:47:38.330Z","additional_data":{"old_severity":"High","new_severity":"Critical","old_severity_id":7508,"new_severity_id":7578},"actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1307399,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @charliesome, once again thanks for the great report and proof of concept! We've deployed a fix for this in our production environment as of earlier today.\n\nAs I've mentioned on your other issues, I'm marking this issue as resolved now but we still need to fix this bug upstream before we can assess the impact \u0026 determine a final bounty amount. This may take a few weeks since we received a large number of valid issues and we want to calibrate our payouts across all of them.","markdown_message":"\u003cp\u003eHey \u003ca href=\"/charliesome\"\u003e@charliesome\u003c/a\u003e, once again thanks for the great report and proof of concept! We\u0026#39;ve deployed a fix for this in our production environment as of earlier today.\u003c/p\u003e\n\n\u003cp\u003eAs I\u0026#39;ve mentioned on your other issues, I\u0026#39;m marking this issue as resolved now but we still need to fix this bug upstream before we can assess the impact \u0026amp; determine a final bounty amount. This may take a few weeks since we received a large number of valid issues and we want to calibrate our payouts across all of them.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-18T20:38:20.541Z","updated_at":"2016-11-18T20:38:20.541Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"charliesome","url":"/charliesome"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370033,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify Scripts and the mruby project!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify Scripts and the mruby project!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-16T19:51:53.890Z","updated_at":"2016-12-16T19:51:53.890Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"18000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"charliesome","url":"/charliesome"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370034,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T19:51:59.597Z","updated_at":"2016-12-16T19:51:59.597Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370644,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-17T01:03:22.505Z","updated_at":"2016-12-17T01:03:22.505Z","actor":{"username":"charliesome","cleared":false,"url":"/charliesome","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/738/78470971e95623d272226b011823c8590ffe6cf3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1370645,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-17T01:03:22.546Z","updated_at":"2016-12-17T01:03:22.546Z","actor":{"username":"charliesome","cleared":false,"url":"/charliesome","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/738/78470971e95623d272226b011823c8590ffe6cf3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}