{"id":300305,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDAzMDU=","url":"https://hackerone.com/reports/300305","title":"Ability to bypass partner email confirmation to take over any store given an employee email","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2017-12-24T08:47:29.068Z","submitted_at":"2017-12-24T08:47:29.068Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"cache-money","url":"/cache-money","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/075/736/f78da6d0fa17c4d39be1f8088656c23763451dc2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-02-07T13:28:31.959Z","bug_reporter_agreed_on_going_public_at":"2018-02-07T13:28:31.813Z","team_member_agreed_on_going_public_at":"2018-02-02T21:45:37.463Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I told Pete I would take a look at Spotify, hi Pete.\n\n**Summary**\nIt's possible to take over any store account through partners given an employee email address. This is possible because I found a way to confirm arbitrary emails. I don't know the Shopify ecosystem well enough to know the other ramifications of such a bug.\n\nOn #270981 you wrote:\n\u003e The intention was that, when a partner already had a valid user account on the store, their collaborator account request could be accepted automatically, with the user account converted into a collaborator account.\n\nI tested that functionality and confirmed how it works. I realized that if you can somehow create a partner account with a business email that matched that of an employee, you would be able to take over their employee account, then convert it to a collaborator. The problem is that business accounts need emails to be validated, but this can be bypassed with a race condition.\n\nThe bug works by hitting the email validation endpoint for an email you own, at the same time as changing your email to a victim's. It might take a few tries, but eventually your email will be changed and be validated due to not (properly) using a DB transaction.\n\n**Steps to reproduce**\n1. Create a store account and invite an employee.\n2. Accept the employee invite (maybe not necessary I didn't test).\n3. Login to or create a partner account as the attacker.\n4. Go to your partner settings page `https://partners.shopify.com/[ID]/settings` and change your email to something you own.\n5. Check your email and grab the confirmation link, but don't visit it yet.\n6. Go back to your partner account and change your email to that of the store employee from step 2, but intercept the request to not let it through yet.\n7. Now the tricky part. The \"change email\" takes anywhere from 1,100 - 2,500 ms to load so you need to take that into account. But let the request go through, wait for some milliseconds, then in another tab visit that email confirmation link from step 5.\n8. If done correctly you will now have confirmed an email you do not own.\n9. Visit `https://partners.shopify.com/[ID]/managed_stores`, add the store, and you now have access.\n\nAs proof, look at the email for partner account `698396`. It will be confirmed `cache@hackerone.com`, which I obviously would never be able to validate otherwise.\n\nThanks,\n-- Tanner\n\n## Impact\n\nAbility to take over stores, and possibly perform any other action that relies on a validated email as a security measure.","vulnerability_information_html":"\u003cp\u003eI told Pete I would take a look at Spotify, hi Pete.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e\u003cbr\u003e\nIt\u0026#39;s possible to take over any store account through partners given an employee email address. This is possible because I found a way to confirm arbitrary emails. I don\u0026#39;t know the Shopify ecosystem well enough to know the other ramifications of such a bug.\u003c/p\u003e\n\n\u003cp\u003eOn \u003ca href=\"/reports/270981\"\u003e#270981\u003c/a\u003e you wrote:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe intention was that, when a partner already had a valid user account on the store, their collaborator account request could be accepted automatically, with the user account converted into a collaborator account.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI tested that functionality and confirmed how it works. I realized that if you can somehow create a partner account with a business email that matched that of an employee, you would be able to take over their employee account, then convert it to a collaborator. The problem is that business accounts need emails to be validated, but this can be bypassed with a race condition.\u003c/p\u003e\n\n\u003cp\u003eThe bug works by hitting the email validation endpoint for an email you own, at the same time as changing your email to a victim\u0026#39;s. It might take a few tries, but eventually your email will be changed and be validated due to not (properly) using a DB transaction.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSteps to reproduce\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eCreate a store account and invite an employee.\u003c/li\u003e\n\u003cli\u003eAccept the employee invite (maybe not necessary I didn\u0026#39;t test).\u003c/li\u003e\n\u003cli\u003eLogin to or create a partner account as the attacker.\u003c/li\u003e\n\u003cli\u003eGo to your partner settings page \u003ccode\u003ehttps://partners.shopify.com/[ID]/settings\u003c/code\u003e and change your email to something you own.\u003c/li\u003e\n\u003cli\u003eCheck your email and grab the confirmation link, but don\u0026#39;t visit it yet.\u003c/li\u003e\n\u003cli\u003eGo back to your partner account and change your email to that of the store employee from step 2, but intercept the request to not let it through yet.\u003c/li\u003e\n\u003cli\u003eNow the tricky part. The \u0026quot;change email\u0026quot; takes anywhere from 1,100 - 2,500 ms to load so you need to take that into account. But let the request go through, wait for some milliseconds, then in another tab visit that email confirmation link from step 5.\u003c/li\u003e\n\u003cli\u003eIf done correctly you will now have confirmed an email you do not own.\u003c/li\u003e\n\u003cli\u003eVisit \u003ccode\u003ehttps://partners.shopify.com/[ID]/managed_stores\u003c/code\u003e, add the store, and you now have access.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eAs proof, look at the email for partner account \u003ccode\u003e698396\u003c/code\u003e. It will be confirmed \u003ccode\u003ecache@hackerone.com\u003c/code\u003e, which I obviously would never be able to validate otherwise.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n-- Tanner\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAbility to take over stores, and possibly perform any other action that relies on a validated email as a security measure.\u003c/p\u003e\n","bounty_amount":"15250.0","formatted_bounty":"$15,250","weakness":{"id":105,"name":"Time-of-check Time-of-use (TOCTOU) Race Condition"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":212,"voters":["jin","irvinlim","rc0r","totalsx","jokebookservice1","thaivu","arneswinnen","sp1d3rs","jensec","jr0ch17","and 202 more..."],"severity":{"rating":"critical","score":10.0,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"none"}},"structured_scope":{"databaseId":422,"asset_type":"URL","asset_identifier":"partners.shopify.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2244842,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the holiday period, it may take us up to 3 weeks to triage any given issue. Don't worry, we'll get to yours!\n\nWhile you are waiting, you can read over our list of non applicable issues listed on our program page: https://hackerone.com/shopify. Make sure your issue isn't listed!","markdown_message":"\u003cp\u003eThank you for reporting this bug! This is an automated response to let you know that we\u0026#39;ve received your issue, and we\u0026#39;ll process it as soon as possible.\u003c/p\u003e\n\n\u003cp\u003eDue to the holiday period, it may take us up to 3 weeks to triage any given issue. Don\u0026#39;t worry, we\u0026#39;ll get to yours!\u003c/p\u003e\n\n\u003cp\u003eWhile you are waiting, you can read over our list of non applicable issues listed on our program page: \u003ca title=\"https://hackerone.com/shopify\" href=\"https://hackerone.com/shopify\"\u003ehttps://hackerone.com/shopify\u003c/a\u003e. Make sure your issue isn\u0026#39;t listed!\u003c/p\u003e\n","automated_response":true,"created_at":"2017-12-24T08:47:29.352Z","updated_at":"2017-12-24T08:47:29.352Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2244995,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hey Tanner, welcome to the Shopify program! Thanks for the report, our engineering team is investigating this now.","markdown_message":"\u003cp\u003eHey Tanner, welcome to the Shopify program! Thanks for the report, our engineering team is investigating this now.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-24T13:49:22.214Z","updated_at":"2017-12-24T13:49:22.214Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2245255,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks again for the report @cache-money! We appreciate you taking the time to improve the security of Shopify rather than Spotify :) \n\nWe shipped a temporary fix to address this today which disables automatically converting accounts. If you're able to bypass it, we'd love to know, otherwise we'll follow up on this first thing in January.\n\nThanks again - happy holidays!\npete","markdown_message":"\u003cp\u003eThanks again for the report \u003ca href=\"/cache-money\"\u003e@cache-money\u003c/a\u003e! We appreciate you taking the time to improve the security of Shopify rather than Spotify :) \u003c/p\u003e\n\n\u003cp\u003eWe shipped a temporary fix to address this today which disables automatically converting accounts. If you\u0026#39;re able to bypass it, we\u0026#39;d love to know, otherwise we\u0026#39;ll follow up on this first thing in January.\u003c/p\u003e\n\n\u003cp\u003eThanks again - happy holidays!\u003cbr\u003e\npete\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-24T21:09:31.915Z","updated_at":"2017-12-24T21:09:31.915Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2245271,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"That was quick, 12 hours to report and temp fix!\n\nThat functionality seems to be working properly, accounts are no longer converted. I'll comment if I find another use for a confirmed email.\n\nHappy holidays and apologies for dropping this on Christmas Eve.\n\nThanks,\n-- Tanner","markdown_message":"\u003cp\u003eThat was quick, 12 hours to report and temp fix!\u003c/p\u003e\n\n\u003cp\u003eThat functionality seems to be working properly, accounts are no longer converted. I\u0026#39;ll comment if I find another use for a confirmed email.\u003c/p\u003e\n\n\u003cp\u003eHappy holidays and apologies for dropping this on Christmas Eve.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n-- Tanner\u003c/p\u003e\n","automated_response":false,"created_at":"2017-12-24T22:06:21.326Z","updated_at":"2017-12-24T22:06:21.326Z","actor":{"username":"cache-money","cleared":true,"url":"/cache-money","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/075/736/f78da6d0fa17c4d39be1f8088656c23763451dc2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2265204,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey Tanner, happy new year. Just wanted to update you so you knew where we were at and that we haven't forgotten about you. We pushed another change to remove collaborator auto conversions so administrators have to approve all requests. I'm hoping we'll close the report as resolved soon.\n\nAgain, if you can break the new change or still execute the race condition, we'd love to hear about it.\n\nThanks for your patience.\nPete","markdown_message":"\u003cp\u003eHey Tanner, happy new year. Just wanted to update you so you knew where we were at and that we haven\u0026#39;t forgotten about you. We pushed another change to remove collaborator auto conversions so administrators have to approve all requests. I\u0026#39;m hoping we\u0026#39;ll close the report as resolved soon.\u003c/p\u003e\n\n\u003cp\u003eAgain, if you can break the new change or still execute the race condition, we\u0026#39;d love to hear about it.\u003c/p\u003e\n\n\u003cp\u003eThanks for your patience.\u003cbr\u003e\nPete\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-05T19:26:13.022Z","updated_at":"2018-01-05T19:26:13.022Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2266744,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Happy new year and thanks for the update, @shopify-peteryaworski! I'm still able to execute the race condition but it's certainly much more difficult. It probably took over 30 tries but I was able to get it to work twice. The first time I thought I accidentally confirmed the email myself which is why I then started testing again with an email I do not have access to.\n\nCheck partner account `699617` and notice there is a confirmed email of `cachemoney@hackerone.com`.\n\nThanks,\n-- Tanner","markdown_message":"\u003cp\u003eHappy new year and thanks for the update, \u003ca href=\"/shopify-peteryaworski\"\u003e@shopify-peteryaworski\u003c/a\u003e! I\u0026#39;m still able to execute the race condition but it\u0026#39;s certainly much more difficult. It probably took over 30 tries but I was able to get it to work twice. The first time I thought I accidentally confirmed the email myself which is why I then started testing again with an email I do not have access to.\u003c/p\u003e\n\n\u003cp\u003eCheck partner account \u003ccode\u003e699617\u003c/code\u003e and notice there is a confirmed email of \u003ccode\u003ecachemoney@hackerone.com\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n-- Tanner\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-06T01:32:54.278Z","updated_at":"2018-01-06T01:32:54.278Z","actor":{"username":"cache-money","cleared":true,"url":"/cache-money","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/075/736/f78da6d0fa17c4d39be1f8088656c23763451dc2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2268788,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I tested the approval and it seems to work as intended. The minor problems I see are:\n\n1. The staff user's account gets disabled immediately when you send the request and could potentially cause disruption.\n2. Even if the store owner decides to \"reject\" the request, the staff user account gets completely deleted from the store.\n3. I can request access with different permissions than the staff account currently has. The administrator has no insight into the previous permissions the account had before the conversion request, so extra permissions can be \"slipped in\" and probably go unnoticed.\n\nThanks,\n-- Tanner\n","markdown_message":"\u003cp\u003eI tested the approval and it seems to work as intended. The minor problems I see are:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThe staff user\u0026#39;s account gets disabled immediately when you send the request and could potentially cause disruption.\u003c/li\u003e\n\u003cli\u003eEven if the store owner decides to \u0026quot;reject\u0026quot; the request, the staff user account gets completely deleted from the store.\u003c/li\u003e\n\u003cli\u003eI can request access with different permissions than the staff account currently has. The administrator has no insight into the previous permissions the account had before the conversion request, so extra permissions can be \u0026quot;slipped in\u0026quot; and probably go unnoticed.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n-- Tanner\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-08T01:05:38.955Z","updated_at":"2018-01-08T01:05:38.955Z","actor":{"username":"cache-money","cleared":true,"url":"/cache-money","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/075/736/f78da6d0fa17c4d39be1f8088656c23763451dc2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2272657,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @cache-money, thanks for race condition confirmation again and the added considerations. We're ok with those since the process is intended to be initiated from the partner with an existing relationship. We pushed another change this morning targeting the race condition and I'll be testing again but if you're able to still exploited it, we'd love to know.\n\nThanks again for your help and for having reporting this to us.\nPete","markdown_message":"\u003cp\u003eHey \u003ca href=\"/cache-money\"\u003e@cache-money\u003c/a\u003e, thanks for race condition confirmation again and the added considerations. We\u0026#39;re ok with those since the process is intended to be initiated from the partner with an existing relationship. We pushed another change this morning targeting the race condition and I\u0026#39;ll be testing again but if you\u0026#39;re able to still exploited it, we\u0026#39;d love to know.\u003c/p\u003e\n\n\u003cp\u003eThanks again for your help and for having reporting this to us.\u003cbr\u003e\nPete\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-09T16:05:45.629Z","updated_at":"2018-01-09T16:06:04.198Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2276776,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This looks fixed, I can't replicate after 100 trials. Thanks,\n-- Tanner","markdown_message":"\u003cp\u003eThis looks fixed, I can\u0026#39;t replicate after 100 trials. Thanks,\u003cbr\u003e\n-- Tanner\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-11T06:21:09.297Z","updated_at":"2018-01-11T06:21:09.297Z","actor":{"username":"cache-money","cleared":true,"url":"/cache-money","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/075/736/f78da6d0fa17c4d39be1f8088656c23763451dc2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2278249,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-11T17:22:29.456Z","updated_at":"2018-01-11T17:22:29.456Z","additional_data":{"old_severity":null,"new_severity":"Critical","old_severity_id":null,"new_severity_id":107241},"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2278250,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hey @cache-money, thanks again for your report. We believe this issue to be resolved now - thank you for your added help testing the code changes and awesome work discovering this.\n\nOur next round of bounty decisions should happen next week so you should hear from us soon.","markdown_message":"\u003cp\u003eHey \u003ca href=\"/cache-money\"\u003e@cache-money\u003c/a\u003e, thanks again for your report. We believe this issue to be resolved now - thank you for your added help testing the code changes and awesome work discovering this.\u003c/p\u003e\n\n\u003cp\u003eOur next round of bounty decisions should happen next week so you should hear from us soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-11T17:22:34.078Z","updated_at":"2018-01-11T17:22:34.078Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"cache-money","url":"/cache-money"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2315037,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @shopify-peteryaworski, I was wondering if there was an update on this.\n\nThanks,\n-- Tanner","markdown_message":"\u003cp\u003eHi \u003ca href=\"/shopify-peteryaworski\"\u003e@shopify-peteryaworski\u003c/a\u003e, I was wondering if there was an update on this.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\n-- Tanner\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-25T00:19:59.807Z","updated_at":"2018-01-25T00:19:59.807Z","actor":{"username":"cache-money","cleared":true,"url":"/cache-money","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/075/736/f78da6d0fa17c4d39be1f8088656c23763451dc2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2317451,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @cache-money, sorry for the delay, unfortunately no update right now but it shouldn't be too much longer. Thanks for your patience.\n\nPete","markdown_message":"\u003cp\u003eHey \u003ca href=\"/cache-money\"\u003e@cache-money\u003c/a\u003e, sorry for the delay, unfortunately no update right now but it shouldn\u0026#39;t be too much longer. Thanks for your patience.\u003c/p\u003e\n\n\u003cp\u003ePete\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-25T16:35:21.191Z","updated_at":"2018-01-25T16:35:21.191Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2346690,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-02T21:42:14.508Z","updated_at":"2018-02-02T21:42:14.508Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"15000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"cache-money","url":"/cache-money"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2346694,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-02T21:43:36.159Z","updated_at":"2018-02-02T21:43:36.159Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"250.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"cache-money","url":"/cache-money"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2346695,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks again for your great work @cache-money. For reference, we awarded a 15k bounty as this would have allowed a Partner to access a store if the store had a staff account associated with the email address the Partner verified using the race condition you discovered. We added a $250 bonus for your help verifying the fix.","markdown_message":"\u003cp\u003eThanks again for your great work \u003ca href=\"/cache-money\"\u003e@cache-money\u003c/a\u003e. For reference, we awarded a 15k bounty as this would have allowed a Partner to access a store if the store had a staff account associated with the email address the Partner verified using the race condition you discovered. We added a $250 bonus for your help verifying the fix.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-02T21:44:13.994Z","updated_at":"2018-02-02T21:44:13.994Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2346705,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-02T21:45:37.514Z","updated_at":"2018-02-02T21:45:37.514Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2358773,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks for the huge bounty!!","markdown_message":"\u003cp\u003eThanks for the huge bounty!!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-07T13:28:31.856Z","updated_at":"2018-02-07T13:28:31.856Z","actor":{"username":"cache-money","cleared":true,"url":"/cache-money","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/075/736/f78da6d0fa17c4d39be1f8088656c23763451dc2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2358774,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-07T13:28:31.999Z","updated_at":"2018-02-07T13:28:31.999Z","actor":{"username":"cache-money","cleared":true,"url":"/cache-money","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/075/736/f78da6d0fa17c4d39be1f8088656c23763451dc2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2889926,"is_internal":false,"editable":false,"type":"Activities::ReportVulnerabilityTypesUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-15T18:16:45.596Z","updated_at":"2018-06-15T18:16:45.596Z","additional_data":{"added_weaknesses":[{"id":105,"name":"Time-of-check Time-of-use (TOCTOU) Race Condition"}],"removed_weaknesses":[{"id":65,"name":"Business Logic Errors"}]},"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2889927,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-15T18:17:03.628Z","updated_at":"2018-06-15T18:17:03.628Z","additional_data":{"old_severity":"Critical","new_severity":"Critical (10.0)","old_severity_id":107241,"new_severity_id":168636},"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":6525,"category":"team","content":"@cache-money reported it was possible to bypass the email verification process in our Partners Dashboard. Doing so would have allowed a Partner to request access to a store under an email address the Partner did not own. If the store had a staff account associated with that email address, the staff account would have been automatically converted to a \"collaborator\" account and added to the Partner's dashboard without any merchant interaction. \n\nWe tracked down the bug to a race condition in the logic for changing and verifying email addresses. We fixed it by locking the database record during those actions and requiring store administrators to approve all collaborator requests.\n","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003ca href=\"/cache-money\"\u003e@cache-money\u003c/a\u003e reported it was possible to bypass the email verification process in our Partners Dashboard. Doing so would have allowed a Partner to request access to a store under an email address the Partner did not own. If the store had a staff account associated with that email address, the staff account would have been automatically converted to a \u0026quot;collaborator\u0026quot; account and added to the Partner\u0026#39;s dashboard without any merchant interaction. \u003c/p\u003e\n\n\u003cp\u003eWe tracked down the bug to a race condition in the logic for changing and verifying email addresses. We fixed it by locking the database record during those actions and requiring store administrators to approve all collaborator requests.\u003c/p\u003e\n"},{"id":6532,"category":"researcher","content":"After reading Shopify's summary from #270981 a few of times I was able to replicate the intended behavior. Seeing how it worked, I realized the core behavior to investigate was the automatic conversion aspect of it. In order for the conversion to work, you needed to confirm a store employee's email on a partner account. From there you could add the store on the partner account as a \"managed store\", which will then perform the automatic conversion and give you collaborator access. The bug existed in the email confirmation, which allowed me to confirm arbitrary emails under my partner account via race condition.\n\nThe bug was filed on Christmas Eve, and within 12 hours the Shopify team rolled out a fix to address the immediate issue. It was a pleasure to work with a team that takes security as seriously as they do.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eAfter reading Shopify\u0026#39;s summary from \u003ca href=\"/reports/270981\"\u003e#270981\u003c/a\u003e a few of times I was able to replicate the intended behavior. Seeing how it worked, I realized the core behavior to investigate was the automatic conversion aspect of it. In order for the conversion to work, you needed to confirm a store employee\u0026#39;s email on a partner account. From there you could add the store on the partner account as a \u0026quot;managed store\u0026quot;, which will then perform the automatic conversion and give you collaborator access. The bug existed in the email confirmation, which allowed me to confirm arbitrary emails under my partner account via race condition.\u003c/p\u003e\n\n\u003cp\u003eThe bug was filed on Christmas Eve, and within 12 hours the Shopify team rolled out a fix to address the immediate issue. It was a pleasure to work with a team that takes security as seriously as they do.\u003c/p\u003e\n"}]}