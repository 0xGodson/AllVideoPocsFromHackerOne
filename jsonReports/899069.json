{"id":899069,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84OTkwNjk=","url":"https://hackerone.com/reports/899069","title":"Untrusted users able to run pending migrations in production","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2020-06-15T22:43:10.080Z","submitted_at":"2020-06-15T22:43:10.080Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"tenderlove","url":"/tenderlove","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22,"url":"https://hackerone.com/rails","handle":"rails","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Ruby on Rails","twitter_handle":null,"website":"http://rubyonrails.org/security","about":"Web development that doesn't hurt."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":["CVE-2020-8185"],"singular_disclosure_disabled":false,"disclosed_at":"2020-07-24T20:07:32.367Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2020-06-24T20:07:05.888Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Untrusted users able to run pending migrations in production\n\nThere is a vulnerability in versions of Rails prior to 6.0.3.2 that allowed\nan untrusted user to run any pending migrations on a Rails app running in\nproduction.\n\nThis vulnerability has been assigned the CVE identifier CVE-2020-XXXX.\n\nVersions Affected:  6.0.0 \u003c rails \u003c 6.0.3.2\nNot affected:       Applications with `config.action_dispatch.show_exceptions = false` (this is not a default setting in production)\nFixed Versions:     rails \u003e= 6.0.3.2\n\n\nReleases\n--------\n\nThe new release (6.0.3.2) is available in the regular locations.\n\nWorkarounds\n-----------\n\nUntil such time as the patch can be applied, application developers should\ndisable the ActionDispatch middleware in their production environment via\na line such as this one in their config/environment/production.rb:\n\nconfig.middleware.delete ActionDispatch::ActionableExceptions\n\nPatches\n-------\n\nAs mentioned, we are releasing the following patch for the 6.0 release\nseries:\n\n* 0001-6.0.3.1-Only-allow-ActionableErrors-if-show_detailed_excepti.patch\n\n\nCredits\n-------\n\nThis issue was discovered independently by Rafael França and Benoit Côté-Jodoin. \nThe patch above was provided by Rafael.\n\n## Impact\n\nUsing this issue, an attacker would be able to execute any migrations that \nare pending for a Rails app running in production mode. It is important to\nnote that an attacker is limited to running migrations the application \ndeveloper has already defined in their application and ones that have not\nalready ran.","vulnerability_information_html":"\u003cp\u003eUntrusted users able to run pending migrations in production\u003c/p\u003e\n\n\u003cp\u003eThere is a vulnerability in versions of Rails prior to 6.0.3.2 that allowed\u003cbr\u003e\nan untrusted user to run any pending migrations on a Rails app running in\u003cbr\u003e\nproduction.\u003c/p\u003e\n\n\u003cp\u003eThis vulnerability has been assigned the CVE identifier CVE-2020-XXXX.\u003c/p\u003e\n\n\u003cp\u003eVersions Affected:  6.0.0 \u0026lt; rails \u0026lt; 6.0.3.2\u003cbr\u003e\nNot affected:       Applications with \u003ccode\u003econfig.action_dispatch.show_exceptions = false\u003c/code\u003e (this is not a default setting in production)\u003cbr\u003e\nFixed Versions:     rails \u0026gt;= 6.0.3.2\u003c/p\u003e\n\n\u003ch2 id=\"releases\"\u003eReleases\u003c/h2\u003e\n\n\u003cp\u003eThe new release (6.0.3.2) is available in the regular locations.\u003c/p\u003e\n\n\u003ch2 id=\"workarounds\"\u003eWorkarounds\u003c/h2\u003e\n\n\u003cp\u003eUntil such time as the patch can be applied, application developers should\u003cbr\u003e\ndisable the ActionDispatch middleware in their production environment via\u003cbr\u003e\na line such as this one in their config/environment/production.rb:\u003c/p\u003e\n\n\u003cp\u003econfig.middleware.delete ActionDispatch::ActionableExceptions\u003c/p\u003e\n\n\u003ch2 id=\"patches\"\u003ePatches\u003c/h2\u003e\n\n\u003cp\u003eAs mentioned, we are releasing the following patch for the 6.0 release\u003cbr\u003e\nseries:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e0001-6.0.3.1-Only-allow-ActionableErrors-if-show_detailed_excepti.patch\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"credits\"\u003eCredits\u003c/h2\u003e\n\n\u003cp\u003eThis issue was discovered independently by Rafael França and Benoit Côté-Jodoin. \u003cbr\u003e\nThe patch above was provided by Rafael.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eUsing this issue, an attacker would be able to execute any migrations that \u003cbr\u003e\nare pending for a Rails app running in production mode. It is important to\u003cbr\u003e\nnote that an attacker is limited to running migrations the application \u003cbr\u003e\ndeveloper has already defined in their application and ones that have not\u003cbr\u003e\nalready ran.\u003c/p\u003e\n","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":869417,"file_name":"0001-6.0.3.1-Only-allow-ActionableErrors-if-show_detailed_excepti.patch","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/jLFinEEY24crLxi8YnjUuyCp?response-content-disposition=attachment%3B%20filename%3D%220001-6.0.3.1-Only-allow-ActionableErrors-if-show_detailed_excepti.patch%22%3B%20filename%2A%3DUTF-8%27%270001-6.0.3.1-Only-allow-ActionableErrors-if-show_detailed_excepti.patch\u0026response-content-type=text%2Fx-patch\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQR2ZO7R4K%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T070839Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGl53Fw9OoAeZDdXqNqIaPWdVjolNnalaCHAwbXpszPSAiEAwdHCK3x2n8ED7sSzsn1sTIqS3bguKd2LFUdH90SxxboqtAMIVhABGgwwMTM2MTkyNzQ4NDkiDFnQ3ZZHIU4UMAvXOCqRA3wF0%2FhaPHMfYMs5a29VvIgRVY2eUJjhO2ZyE9nrbvBw99qQYURMnfpjG6qzK9RhUhaxnystL8FSjs1I9wVhv7kK6fGlwNHgR0S%2FwzzOYB4EaUAuHPPjDIaplYQHDQfhD3Jzk627x6y1whtGyRm1%2FbLU%2FMLC%2FEl2Y0VF3B2XYbmjMyMbEo%2F3JA2NhxILkWnIEx9Dc5OuLgUgvtMmXd8zqzlhwWk%2Fkbzt%2FA4PPw5G1805sqkgAV2ZtRMBvyI%2FHqrdrdjVcpE0L%2Fb3v3BTHE1AxOXymRI68r5QkUXAwvQReRh0UHKevdP2OKVlaJqNW4QPWf8V9sf08LOD6%2FIWFP2z6T0Ge7kmECxaLuqLfuqbJATPZaoduqk5WANfTo41R4vwOd0PfkzuCu4ENGZautDQdqCTqc5v4f3nC%2FmEA3lzVbD2GfnKNN5i6QTsolJiL8iHwoY3qRGnqUpWe6styqCssbnT2On6kImCyLv8PqTQIgD5tzKTZ%2Bk7rSp%2FUGyNQ%2Fzf7CwFfbirN8%2BZ0cy8FDVRQPOIMNrtqv8FOusBG5VJhuS959dYt8SgxT1B5qInUKkmqkB9xSwqpRIrJhHLlMpiW9hAt%2BdMLFZZhmn8J5%2BdfXBiq%2FwOuwlyUwREyyNiqFLd5q%2F2oDa1jv2FMMsir1my4yAqcT0R%2BuM9KWMCRIN%2F27CpS4%2BgKGfRpQrYqZnwFoh5vyTAfyKuQbQpvNQ5z0%2F7hQPQ1Fud3gWbMbKSBMyuMEkDvn42ZK0k1WvIYPRa53VXsGPwtTo7PZ2laExqLJsXRcULDGCx08GryRt%2B5IBSaDHktFU1HTGALrwf1yRufEBKHtOimqOWitGuYxfwQnKZ1ht%2BjmX2WQ%3D%3D\u0026X-Amz-Signature=8e52310a02b12c6a2f5907ce3ef2e72174e0cd772e887b21128031a5c71f1bae","file_size":2728,"type":"text/x-patch"}],"allow_singular_disclosure_at":"2020-07-24T20:07:05.969Z","allow_singular_disclosure_after":-13604493.080472192,"singular_disclosure_allowed":true,"vote_count":2,"voters":["mygf","1nvok3r1729"],"severity":{"rating":"medium","score":6.5,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"none","integrity":"low","availability":"low"}},"structured_scope":{"databaseId":160,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/rails/rails","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":8300428,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I marked this as denial of service because running a pending migration _shouldn't_ hurt anyone if the migration is in production, but it could cause a DoS","markdown_message":"\u003cp\u003eI marked this as denial of service because running a pending migration \u003cu\u003eshouldn\u0026#39;t\u003c/u\u003e hurt anyone if the migration is in production, but it could cause a DoS\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-15T22:44:12.009Z","updated_at":"2020-06-15T22:44:12.009Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8300471,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Also I've uploaded the patch we'll use.","markdown_message":"\u003cp\u003eAlso I\u0026#39;ve uploaded the patch we\u0026#39;ll use.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-15T22:44:31.776Z","updated_at":"2020-06-15T22:44:31.776Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8321559,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"This is shipped.  Closing with informative because I don't want to give myself hacker points for something I didn't discover.","markdown_message":"\u003cp\u003eThis is shipped.  Closing with informative because I don\u0026#39;t want to give myself hacker points for something I didn\u0026#39;t discover.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-06-17T15:27:21.559Z","updated_at":"2020-06-17T15:27:21.559Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8399495,"is_internal":false,"editable":false,"type":"Activities::BugReopened","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-24T20:01:49.563Z","updated_at":"2020-06-24T20:01:49.563Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8399498,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-24T20:02:02.898Z","updated_at":"2020-06-24T20:02:02.898Z","actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"tenderlove","url":"/tenderlove"},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8399529,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-06-24T20:07:05.914Z","updated_at":"2020-06-24T20:07:05.914Z","first_to_agree":true,"actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8747164,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-07-24T20:07:37.641Z","updated_at":"2020-07-24T20:07:37.641Z","actor":{"url":"/rails","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Ruby on Rails"}},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}