{"id":583184,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81ODMxODQ=","url":"https://hackerone.com/reports/583184","title":"Arbitrary File Write as SYSTEM from unprivileged user","state":"Closed","substate":"informative","severity_rating":"high","readable_substate":"Informative","created_at":"2019-05-17T03:05:33.141Z","submitted_at":"2019-05-17T03:05:33.141Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"b0yd","url":"/b0yd","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/043/557/07c3a32ae7fbe2182a4e7bb3f7db3edb1181d73c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":23363,"url":"https://hackerone.com/valve","handle":"valve","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/023/363/c78d46a7d0ea39e3a15a7c19c1a48634f2571eb9_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/363/c78d46a7d0ea39e3a15a7c19c1a48634f2571eb9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Valve","twitter_handle":"","website":"https://www.valvesoftware.com","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-01-15T19:35:12.674Z","bug_reporter_agreed_on_going_public_at":"2019-11-29T15:50:55.676Z","team_member_agreed_on_going_public_at":"2020-01-15T19:35:12.569Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"1250.0","formatted_bounty":"$1,250","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":68,"voters":["miszczyk","njbooher","mvc","danila","bl4de","spam404","johndoe1492","romesful","b0yd","holyfield","and 58 more..."],"severity":{"rating":"high","score":7.8,"author_type":"User","metrics":{"attack_vector":"local","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":1290,"asset_type":"DOWNLOADABLE_EXECUTABLES","asset_identifier":"*.exe","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":4867030,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"","markdown_message":"","automated_response":false,"created_at":"2019-05-17T14:22:46.846Z","updated_at":"2019-05-17T14:22:46.846Z","actor":{"username":"pieceoftoast","cleared":false,"url":"/pieceoftoast","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/304/250/1d56f264cfce92a8f88b8424ce9dc273ab4bcd63_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4867093,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-05-17T14:35:58.774Z","updated_at":"2019-05-17T14:38:40.813Z","actor":{"username":"b0yd","cleared":true,"url":"/b0yd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/557/07c3a32ae7fbe2182a4e7bb3f7db3edb1181d73c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6433896,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-29T15:50:55.705Z","updated_at":"2019-11-29T15:50:55.705Z","first_to_agree":true,"actor":{"username":"b0yd","cleared":true,"url":"/b0yd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/557/07c3a32ae7fbe2182a4e7bb3f7db3edb1181d73c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6722326,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-09T01:45:41.929Z","updated_at":"2020-01-09T01:45:41.929Z","actor":{"username":"mikela","cleared":false,"url":"/mikela","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6722329,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-09T01:46:04.214Z","updated_at":"2020-01-09T01:46:04.214Z","actor":{"url":"/valve","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/023/363/c78d46a7d0ea39e3a15a7c19c1a48634f2571eb9_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Valve"}},"bounty_amount":"1250.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"valve","collaborator":{"username":"b0yd","url":"/b0yd"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6749420,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-12T22:16:19.762Z","updated_at":"2020-01-12T22:16:19.762Z","actor":{"username":"b0yd","cleared":true,"url":"/b0yd","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/043/557/07c3a32ae7fbe2182a4e7bb3f7db3edb1181d73c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6780585,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-15T19:35:12.590Z","updated_at":"2020-01-15T19:35:12.590Z","actor":{"username":"mikela","cleared":false,"url":"/mikela","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6780586,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-01-15T19:35:12.694Z","updated_at":"2020-01-15T19:35:12.694Z","actor":{"username":"mikela","cleared":false,"url":"/mikela","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"valve","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":19735,"category":"team","content":"### Note: This report was reviewed and updated after a correction to program scope.\n \n \n \nVulnerability\n========\n\nThe Steam Client installs a \"Steam Client Service\" that runs as SYSTEM to update the steam application. This service executes from C:\\Program Files (x86)\\Common\\Steam where permissions are properly set to only allow modification from SYSTEM or the Administrators group.\n\nIf the service encounters an error, it writes to the log file C:\\Program Files (x86)\\Steam\\logs\\service_log.txt. This is a problem because this particular folder, and the parent folder, have permissions set to \"Full Control\" to any unprivileged user. A regular user can also trigger an error when the service starts by modifying or deleting the \"C:\\Program Files (x86)\\Steam\\bin\\steamservice.dll\"\nfile that an unprivileged user also has \"Full Control\" of.\n\nIt also just so happens that the permissions for the \"Steam Client Service\" allow for starting and stopping by unprivileged users, which facilitates for easy triggering of the exploit.\n\nTo exploit this vulnerability, an unprivileged user can create a [symlink](https://github.com/googleprojectzero/symboliclink-testing-tools/tree/master/CreateSymlink) between the \"C:\\Program Files (x86)\\Steam\\logs\\service_log.txt\" file and any destination file that SYSTEM can write to. Next they would modify, move, or delete the \"C:\\Program Files (x86)\\Steam\\bin\\steamservice.dll\" to trigger an error message to be written. Finally they would start the \"Steam Client Service\" service to force the file write. The following video demonstrates writing to C:\\Windows\\System32\\evil.dll and also C:\\Windows\\System32\\drivers\\pci.sys\nto break the box.\n\nFix\n===\n\nThe primary fix for this vulnerability would be to move the log file for the \"Steam Client Service\" to a directory with proper permissions set, C:\\Program Files (x86)\\Common\\Steam, would be a viable option. If the service is making any other privileged writes in the C:\\Program Files (x86)\\Steam folder, they would need to be addressed as well.\n\nReferences\n=======\n\nhttps://offsec.provadys.com/intro-to-file-operation-abuse-on-Windows.html\n\nImpact\n=====\n\nA unprivileged user can write to any file on the file system with SYSTEM privileges.","can_view?":true,"can_edit?":false,"content_html":"\u003ch3 id=\"note-this-report-was-reviewed-and-updated-after-a-correction-to-program-scope\"\u003eNote: This report was reviewed and updated after a correction to program scope.\u003c/h3\u003e\n\n\u003ch1 id=\"vulnerability\"\u003eVulnerability\u003c/h1\u003e\n\n\u003cp\u003eThe Steam Client installs a \u0026quot;Steam Client Service\u0026quot; that runs as SYSTEM to update the steam application. This service executes from C:\\Program Files (x86)\\Common\\Steam where permissions are properly set to only allow modification from SYSTEM or the Administrators group.\u003c/p\u003e\n\n\u003cp\u003eIf the service encounters an error, it writes to the log file C:\\Program Files (x86)\\Steam\\logs\\service_log.txt. This is a problem because this particular folder, and the parent folder, have permissions set to \u0026quot;Full Control\u0026quot; to any unprivileged user. A regular user can also trigger an error when the service starts by modifying or deleting the \u0026quot;C:\\Program Files (x86)\\Steam\\bin\\steamservice.dll\u0026quot;\u003cbr\u003e\nfile that an unprivileged user also has \u0026quot;Full Control\u0026quot; of.\u003c/p\u003e\n\n\u003cp\u003eIt also just so happens that the permissions for the \u0026quot;Steam Client Service\u0026quot; allow for starting and stopping by unprivileged users, which facilitates for easy triggering of the exploit.\u003c/p\u003e\n\n\u003cp\u003eTo exploit this vulnerability, an unprivileged user can create a \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fgoogleprojectzero%2Fsymboliclink-testing-tools%2Ftree%2Fmaster%2FCreateSymlink\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003esymlink\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e between the \u0026quot;C:\\Program Files (x86)\\Steam\\logs\\service_log.txt\u0026quot; file and any destination file that SYSTEM can write to. Next they would modify, move, or delete the \u0026quot;C:\\Program Files (x86)\\Steam\\bin\\steamservice.dll\u0026quot; to trigger an error message to be written. Finally they would start the \u0026quot;Steam Client Service\u0026quot; service to force the file write. The following video demonstrates writing to C:\\Windows\\System32\\evil.dll and also C:\\Windows\\System32\\drivers\\pci.sys\u003cbr\u003e\nto break the box.\u003c/p\u003e\n\n\u003ch1 id=\"fix\"\u003eFix\u003c/h1\u003e\n\n\u003cp\u003eThe primary fix for this vulnerability would be to move the log file for the \u0026quot;Steam Client Service\u0026quot; to a directory with proper permissions set, C:\\Program Files (x86)\\Common\\Steam, would be a viable option. If the service is making any other privileged writes in the C:\\Program Files (x86)\\Steam folder, they would need to be addressed as well.\u003c/p\u003e\n\n\u003ch1 id=\"references\"\u003eReferences\u003c/h1\u003e\n\n\u003cp\u003e\u003ca title=\"https://offsec.provadys.com/intro-to-file-operation-abuse-on-Windows.html\" href=\"/redirect?url=https%3A%2F%2Foffsec.provadys.com%2Fintro-to-file-operation-abuse-on-Windows.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://offsec.provadys.com/intro-to-file-operation-abuse-on-Windows.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1 id=\"impact\"\u003eImpact\u003c/h1\u003e\n\n\u003cp\u003eA unprivileged user can write to any file on the file system with SYSTEM privileges.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}