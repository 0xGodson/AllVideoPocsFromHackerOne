{"id":311948,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMTE5NDg=","url":"https://hackerone.com/reports/311948","title":"Stored XSS (client-side, using cookie poisoning) on the pornhubpremium.com","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-02-03T16:19:28.254Z","submitted_at":"2018-02-03T16:19:28.254Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"sp1d3rs","url":"/sp1d3rs","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":952,"url":"https://hackerone.com/pornhub","handle":"pornhub","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/952/77ffeabeff6e89172004356249a1de19b6a45424_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/952/77ffeabeff6e89172004356249a1de19b6a45424_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Pornhub","twitter_handle":"Pornhub","website":"https://pornhub.com","about":"The premiere destination for adult entertainment"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-03-27T18:12:51.280Z","bug_reporter_agreed_on_going_public_at":"2018-03-27T16:36:21.728Z","team_member_agreed_on_going_public_at":"2018-03-27T18:12:51.186Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"250.0","formatted_bounty":"$250","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-04-26T16:36:21.789Z","allow_singular_disclosure_after":-84459362.52463333,"singular_disclosure_allowed":true,"vote_count":40,"voters":["smsecurity","europa","foobar7","muon4","ramsexy","rreiss","syntax-error","michan","agentprovocateur","brodie_codie","and 30 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2347987,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-03T16:22:37.128Z","updated_at":"2018-02-03T16:22:37.128Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"pornhub","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2356450,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-06T19:06:41.200Z","updated_at":"2018-02-06T19:06:41.200Z","actor":{"username":"dsimmons","cleared":false,"url":"/dsimmons","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"pornhub","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2356670,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-06T20:23:03.671Z","updated_at":"2018-02-06T20:23:03.671Z","actor":{"url":"/pornhub","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/952/77ffeabeff6e89172004356249a1de19b6a45424_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Pornhub"}},"bounty_amount":"250.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"pornhub","collaborator":{"username":"sp1d3rs","url":"/sp1d3rs"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2356689,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-06T20:34:01.580Z","updated_at":"2018-02-06T20:34:01.580Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"pornhub","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2523958,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-23T17:21:58.184Z","updated_at":"2018-03-23T17:21:58.184Z","actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"pornhub","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2536824,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-27T16:27:47.419Z","updated_at":"2018-03-27T16:27:47.419Z","actor":{"username":"dsimmons","cleared":false,"url":"/dsimmons","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"sp1d3rs","url":"/sp1d3rs"},"genius_execution_id":null,"team_handle":"pornhub","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2536892,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-27T16:36:21.756Z","updated_at":"2018-03-27T16:36:21.756Z","first_to_agree":true,"actor":{"username":"sp1d3rs","cleared":true,"url":"/sp1d3rs","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"pornhub","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2537583,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-27T18:12:51.216Z","updated_at":"2018-03-27T18:12:51.216Z","actor":{"username":"dsimmons","cleared":false,"url":"/dsimmons","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"pornhub","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2537584,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-03-27T18:12:51.308Z","updated_at":"2018-03-27T18:12:51.308Z","actor":{"username":"dsimmons","cleared":false,"url":"/dsimmons","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"pornhub","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":6968,"category":"team","content":"The researcher discovered that a parameter's value was stored in a cookie and that cookie's value was echoed in certain pages. The researcher was successful in providing an XSS payload as this parameter's value and having it execute.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eThe researcher discovered that a parameter\u0026#39;s value was stored in a cookie and that cookie\u0026#39;s value was echoed in certain pages. The researcher was successful in providing an XSS payload as this parameter\u0026#39;s value and having it execute.\u003c/p\u003e\n"},{"id":6928,"category":"researcher","content":"DOM XSS through cookie. Discovered by manual inspection of JS code and cookies.\nSteps of discovery:\n1) Checked the JS code for unsafe DOM operations.\n2) After this I found that it's possible to reflect `ats` cookie without sanitization, I had to find some endpoint or CRLFi, that would allow arbitrary cookie setting. I went the fast way, and used Google Dork `allinurl:ats site:pornhubpremium.com` to find potential endpoints, which contain URL parameter named `ats` (often it is possible to set cookie via params, and param name usually equals to the cookie name). Google showed me some URLs. \n3) Placed XSS payload as `ats` parameter value of the discovered URL, setting of the malicious cookie was successful.\n4) Visited endpoint with cookie reflection to confirm XSS issue.\n5) It worked. Simple popup was demonstrated, since the program has strict bounty table for such issues.\n\n**POC (all browsers)**\n1) Visit the link:\nhttps://www.pornhubpremium.com/premium_signup?atc=1\u0026ats=zzz%22%3E%3Csvg/onload=alert(document.domain)%3E\u0026join=1\u0026login=1\u0026segment=straight\n2) XSS payload will be stored in the cookies.\n3) Now just visit the \nhttps://www.pornhubpremium.com/premium_signup?login=1\nXSS will be executed. It will execute each time user visits this login page.\n\nThanks to the team for the quick triage and the bounty!","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eDOM XSS through cookie. Discovered by manual inspection of JS code and cookies.\u003cbr\u003e\nSteps of discovery:\u003cbr\u003e\n1) Checked the JS code for unsafe DOM operations.\u003cbr\u003e\n2) After this I found that it\u0026#39;s possible to reflect \u003ccode\u003eats\u003c/code\u003e cookie without sanitization, I had to find some endpoint or CRLFi, that would allow arbitrary cookie setting. I went the fast way, and used Google Dork \u003ccode\u003eallinurl:ats site:pornhubpremium.com\u003c/code\u003e to find potential endpoints, which contain URL parameter named \u003ccode\u003eats\u003c/code\u003e (often it is possible to set cookie via params, and param name usually equals to the cookie name). Google showed me some URLs. \u003cbr\u003e\n3) Placed XSS payload as \u003ccode\u003eats\u003c/code\u003e parameter value of the discovered URL, setting of the malicious cookie was successful.\u003cbr\u003e\n4) Visited endpoint with cookie reflection to confirm XSS issue.\u003cbr\u003e\n5) It worked. Simple popup was demonstrated, since the program has strict bounty table for such issues.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003ePOC (all browsers)\u003c/strong\u003e\u003cbr\u003e\n1) Visit the link:\u003cbr\u003e\n\u003ca title=\"https://www.pornhubpremium.com/premium_signup?atc=1\u0026amp;ats=zzz%22%3E%3Csvg/onload=alert(document.domain)%3E\u0026amp;join=1\u0026amp;login=1\u0026amp;segment=straight\" href=\"/redirect?url=https%3A%2F%2Fwww.pornhubpremium.com%2Fpremium_signup%3Fatc%3D1%26ats%3Dzzz%2522%253E%253Csvg%2Fonload%3Dalert%28document.domain%29%253E%26join%3D1%26login%3D1%26segment%3Dstraight\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.pornhubpremium.com/premium_signup?atc=1\u0026amp;ats=zzz%22%3E%3Csvg/onload=alert(document.domain)%3E\u0026amp;join=1\u0026amp;login=1\u0026amp;segment=straight\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n2) XSS payload will be stored in the cookies.\u003cbr\u003e\n3) Now just visit the \u003cbr\u003e\n\u003ca title=\"https://www.pornhubpremium.com/premium_signup?login=1\" href=\"/redirect?url=https%3A%2F%2Fwww.pornhubpremium.com%2Fpremium_signup%3Flogin%3D1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.pornhubpremium.com/premium_signup?login=1\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\nXSS will be executed. It will execute each time user visits this login page.\u003c/p\u003e\n\n\u003cp\u003eThanks to the team for the quick triage and the bounty!\u003c/p\u003e\n"}]}