{"id":47012,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NzAxMg==","url":"https://hackerone.com/reports/47012","title":"Adobe Flash Player Out-of-Bound Access Vulnerability","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-02-07T14:50:18.485Z","submitted_at":"2015-02-07T14:50:18.485Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"hhj4ck","url":"/hhj4ck","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":46,"url":"https://hackerone.com/ibb-flash","handle":"ibb-flash","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/046/1483b151cc84e0ff54b32196809ca3bf945812f2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/046/1483b151cc84e0ff54b32196809ca3bf945812f2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Flash (IBB)","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2015-03-25T19:39:25.200Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2015-02-23T19:39:17.571Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"I. Summary\r\nAdobe Flash Player is prone to a vulnerability which leads to Out-of-Bound memory access memory via carefully crafted regular expression. An attacker can exploit this issue to defeat ASLR protection or even execute arbitrary code in the context of affected application (Internet Explorer, EXCEL...).\r\n------------------------------------------------------------------\r\nII. Description\r\nAdobe Flash is a multimedia and software platform used for authoring of vector graphics, animation, games and rich Internet applications (RIAs) that can be viewed, played and executed in Adobe Flash Player. \r\n\r\nWhen constructing a RegExpObject, most part of memory was applied from the heap. While heap overflow may also happen as it is with CVE-2013-0634, CVE-2014-0559, the matching result is stored on the stack. A fixed size int ovector[99] is defined to store the matching index numbers of the target string. A simple line of ActionScript could lead to a crash caused by reading inaccessable memory:\r\n\r\n\"Venus\".match(\"(((((((((((((((((((((((((((((((((((((((((((((((((?P\u003cG2\u003e)))))))))))))))))))))))))))))))))))))))))))))))))\"); \r\n\r\nFor the given regular expression above, ovector[99] will be filled with zeros. Then Flash Player managed to construct an Array containing the matching result recognized by AS3. Since there is a named group G2, the Array will also contain a string index entry (G2) that is filled with substring of the target string. The start address of the substring is calculated as follow: start address of target string + ovector[nameIndex*2]. The length of the substring is calulated as:  ovector[nameIndex*2+1] - ovector[nameIndex*2].\r\n\r\nThe problem is that nameIndex equals to the number of left brackets inside the given regular expression. As the number of left brackets is fully controlled, ovector[nameIndex*2+1] is able to read values out of the stack memory ovector. Flash took mitigations where it checks if the nameIndex is larger than 49, ignoring the fact that nameIndex can be 49 itself. When nameIndex equals to 49, nameIndex*2+1 equals to 99, ovector[nameIndex*2+1] will point to stack memory out of bound. Normally, ovector[nameIndex*2+1] points to the saved EIP under windows and it is a very large value for length field.\r\n\r\nThis may result in returning a string with a fake length field with enormous value to the AS3 interface. Advanced Heap Fengshui techniques may even allow an attacker build workable exploit via such string to access arbitrary memory.\r\n\r\npoc and its source code are attached.\r\n------------------------------------------------------------------\r\nIII. Impact\r\nOut-of-Bound Access\r\n------------------------------------------------------------------\r\nIV. Reference\r\nIt has got assigned as CVE-2015-0330.\r\nhttps://helpx.adobe.com/security/products/flash-player/apsb15-04.html\r\nhttps://code.google.com/p/chromium/issues/detail?id=450198\r\n------------------------------------------------------------------\r\nV. Credit\r\nWen Guanxing from Venustech ADLAB is credited for this vulnerability.","vulnerability_information_html":"\u003cp\u003eI. Summary\u003c/p\u003e\n\n\u003ch2 id=\"adobe-flash-player-is-prone-to-a-vulnerability-which-leads-to-out-of-bound-memory-access-memory-via-carefully-crafted-regular-expression-an-attacker-can-exploit-this-issue-to-defeat-aslr-protection-or-even-execute-arbitrary-code-in-the-context-of-affected-application-internet-explorer-excel\"\u003eAdobe Flash Player is prone to a vulnerability which leads to Out-of-Bound memory access memory via carefully crafted regular expression. An attacker can exploit this issue to defeat ASLR protection or even execute arbitrary code in the context of affected application (Internet Explorer, EXCEL...).\u003c/h2\u003e\n\n\u003cp\u003eII. Description\u003cbr\u003e\nAdobe Flash is a multimedia and software platform used for authoring of vector graphics, animation, games and rich Internet applications (RIAs) that can be viewed, played and executed in Adobe Flash Player. \u003c/p\u003e\n\n\u003cp\u003eWhen constructing a RegExpObject, most part of memory was applied from the heap. While heap overflow may also happen as it is with CVE-2013-0634, CVE-2014-0559, the matching result is stored on the stack. A fixed size int ovector[99] is defined to store the matching index numbers of the target string. A simple line of ActionScript could lead to a crash caused by reading inaccessable memory:\u003c/p\u003e\n\n\u003cp\u003e\u0026quot;Venus\u0026quot;.match(\u0026quot;(((((((((((((((((((((((((((((((((((((((((((((((((?P\u0026lt;G2\u0026gt;)))))))))))))))))))))))))))))))))))))))))))))))))\u0026quot;); \u003c/p\u003e\n\n\u003cp\u003eFor the given regular expression above, ovector[99] will be filled with zeros. Then Flash Player managed to construct an Array containing the matching result recognized by AS3. Since there is a named group G2, the Array will also contain a string index entry (G2) that is filled with substring of the target string. The start address of the substring is calculated as follow: start address of target string + ovector[nameIndex*2]. The length of the substring is calulated as:  ovector[nameIndex*2+1] - ovector[nameIndex*2].\u003c/p\u003e\n\n\u003cp\u003eThe problem is that nameIndex equals to the number of left brackets inside the given regular expression. As the number of left brackets is fully controlled, ovector[nameIndex*2+1] is able to read values out of the stack memory ovector. Flash took mitigations where it checks if the nameIndex is larger than 49, ignoring the fact that nameIndex can be 49 itself. When nameIndex equals to 49, nameIndex*2+1 equals to 99, ovector[nameIndex*2+1] will point to stack memory out of bound. Normally, ovector[nameIndex*2+1] points to the saved EIP under windows and it is a very large value for length field.\u003c/p\u003e\n\n\u003cp\u003eThis may result in returning a string with a fake length field with enormous value to the AS3 interface. Advanced Heap Fengshui techniques may even allow an attacker build workable exploit via such string to access arbitrary memory.\u003c/p\u003e\n\n\u003ch2 id=\"poc-and-its-source-code-are-attached\"\u003epoc and its source code are attached.\u003c/h2\u003e\n\n\u003cp\u003eIII. Impact\u003c/p\u003e\n\n\u003ch2 id=\"out-of-bound-access\"\u003eOut-of-Bound Access\u003c/h2\u003e\n\n\u003cp\u003eIV. Reference\u003cbr\u003e\nIt has got assigned as CVE-2015-0330.\u003cbr\u003e\n\u003ca title=\"https://helpx.adobe.com/security/products/flash-player/apsb15-04.html\" href=\"/redirect?url=https%3A%2F%2Fhelpx.adobe.com%2Fsecurity%2Fproducts%2Fflash-player%2Fapsb15-04.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://helpx.adobe.com/security/products/flash-player/apsb15-04.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"https-code-google-com-p-chromium-issues-detail-id-450198\"\u003e\u003ca title=\"https://code.google.com/p/chromium/issues/detail?id=450198\" href=\"/redirect?url=https%3A%2F%2Fcode.google.com%2Fp%2Fchromium%2Fissues%2Fdetail%3Fid%3D450198\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://code.google.com/p/chromium/issues/detail?id=450198\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/h2\u003e\n\n\u003cp\u003eV. Credit\u003cbr\u003e\nWen Guanxing from Venustech ADLAB is credited for this vulnerability.\u003c/p\u003e\n","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":2,"name":"Memory Corruption - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":28844,"file_name":"poc.fla","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/028/844/9de80a9cbcd9aadba840a2dc11f18ca4436acfc3/poc.fla?response-content-disposition=attachment%3B%20filename%3D%22poc.fla%22%3B%20filename%2A%3DUTF-8%27%27poc.fla\u0026response-content-type=application%2Fzip\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSC5UFWXL%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T060235Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCwK%2B%2BlMufFx2twThN55FpWvSNFMRcTw6DIMXMwu3SRJgIgbfhKiC5W8N8YFQB0Nj1%2Boe6pAlr8Ti%2FvGEEHHH13JNkqtAMIUxABGgwwMTM2MTkyNzQ4NDkiDKRKppBQcflzJsWylyqRAzVMKZ6jWFrSD2Y9kWok2waN0zNoEyuNoms1kUC37gd2cWniMYOCGZa9pHJ%2BTGOcJDE8mr7X3wJV03PeWNx%2FJ3x1t1adSeplF3kKkxVzwMpsJiOYMPMNaXbK6aN%2FVxaTTjwIHJMTw7ej%2BNad1lrBkNYM8xmTFPzJdlIn3krUMQVcm66POZCl3IpgIriUdvRQsdjWZjnf%2FUXejEcDwlys5fmmpAap4FXWkuE4xPD5JITrqd71Zc4guVr49IYqaJ9P8ZOa39l8Cm9yOfvHOdc%2FHHkeb3dhc64lVpxLQxnIzdRkUBVcVDfLrNaCOxpa9K0SDMt9HK%2B6%2F6SozxEKFb7iD2%2BQkM42Rwtm3vBMeKEUDeFG3yO5gW6KJtirosz7Y3m8DdEylt%2F8air6KKuH0wjD%2B9LfO7%2FWKZCn3h7tRVYtr71OXTcV4jMC7Q6El1VpYoy1%2FUyJLt0VlyMhH1u00hOd2Ed613mjv9Lq0b8iTU4W3vlCcM%2FtjGgBfI2lPMbp3cacOsLTQtiqUw%2FMXKZM7aikuuh%2BML6aqv8FOusBAaUZsZRvtcfsxqJAwQO39V21wLoeubOAIV%2BtvLyfXzwltZABeAGkBPYy8xl5ryQb8Y%2BKG%2FfwUfCGsCxtOppNqsZCDg0JzwPVO8CdiGO1QqRKJpkb23agNpWEIAa8FY4BpDjQUZHUIl4jWVfFWH2sizzpICjQxnSI3JQpi2%2B9GAdI3gAmweVyhKgicRGn9QyAfoRtqO3YWntGA8EeCXAhyWW%2BxebF5JNSGoYhvM72O00zG1YKAYz%2F6ymrbrJmLpZ0WbBqG4d2%2BRi9F0TVfiKq0rdWihYUV%2FstwlGLcPIVuYIDnBH4oA5HYk7pFw%3D%3D\u0026X-Amz-Signature=15487cb4dc973cb568dbd08cc54a64e9d898079d1d193cf31b89f022dcf5df46","file_size":4950,"type":"application/zip"},{"id":28845,"file_name":"poc.swf","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/028/845/d3d14d2f85f5cb98d10e86d9ad6d4937e599f0d0/poc.swf?response-content-disposition=attachment%3B%20filename%3D%22poc.swf%22%3B%20filename%2A%3DUTF-8%27%27poc.swf\u0026response-content-type=application%2Foctet-stream\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQSC5UFWXL%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T060235Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCwK%2B%2BlMufFx2twThN55FpWvSNFMRcTw6DIMXMwu3SRJgIgbfhKiC5W8N8YFQB0Nj1%2Boe6pAlr8Ti%2FvGEEHHH13JNkqtAMIUxABGgwwMTM2MTkyNzQ4NDkiDKRKppBQcflzJsWylyqRAzVMKZ6jWFrSD2Y9kWok2waN0zNoEyuNoms1kUC37gd2cWniMYOCGZa9pHJ%2BTGOcJDE8mr7X3wJV03PeWNx%2FJ3x1t1adSeplF3kKkxVzwMpsJiOYMPMNaXbK6aN%2FVxaTTjwIHJMTw7ej%2BNad1lrBkNYM8xmTFPzJdlIn3krUMQVcm66POZCl3IpgIriUdvRQsdjWZjnf%2FUXejEcDwlys5fmmpAap4FXWkuE4xPD5JITrqd71Zc4guVr49IYqaJ9P8ZOa39l8Cm9yOfvHOdc%2FHHkeb3dhc64lVpxLQxnIzdRkUBVcVDfLrNaCOxpa9K0SDMt9HK%2B6%2F6SozxEKFb7iD2%2BQkM42Rwtm3vBMeKEUDeFG3yO5gW6KJtirosz7Y3m8DdEylt%2F8air6KKuH0wjD%2B9LfO7%2FWKZCn3h7tRVYtr71OXTcV4jMC7Q6El1VpYoy1%2FUyJLt0VlyMhH1u00hOd2Ed613mjv9Lq0b8iTU4W3vlCcM%2FtjGgBfI2lPMbp3cacOsLTQtiqUw%2FMXKZM7aikuuh%2BML6aqv8FOusBAaUZsZRvtcfsxqJAwQO39V21wLoeubOAIV%2BtvLyfXzwltZABeAGkBPYy8xl5ryQb8Y%2BKG%2FfwUfCGsCxtOppNqsZCDg0JzwPVO8CdiGO1QqRKJpkb23agNpWEIAa8FY4BpDjQUZHUIl4jWVfFWH2sizzpICjQxnSI3JQpi2%2B9GAdI3gAmweVyhKgicRGn9QyAfoRtqO3YWntGA8EeCXAhyWW%2BxebF5JNSGoYhvM72O00zG1YKAYz%2F6ymrbrJmLpZ0WbBqG4d2%2BRi9F0TVfiKq0rdWihYUV%2FstwlGLcPIVuYIDnBH4oA5HYk7pFw%3D%3D\u0026X-Amz-Signature=f17146f007810628db0885febf741bb9a479578e5dd68fc4f4b52fc3d07effef","file_size":918,"type":"application/x-shockwave-flash"}],"allow_singular_disclosure_at":"2015-03-25T19:39:17.796Z","allow_singular_disclosure_after":-181909397.4138364,"singular_disclosure_allowed":true,"vote_count":0,"voters":[],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":338542,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2015-02-23T19:17:23.987Z","updated_at":"2015-02-23T19:17:23.987Z","actor":{"username":"scarybeasts","cleared":false,"url":"/scarybeasts","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/058/5f780e75fda778da7bfdf8d13d681cdab514715a_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"hhj4ck","url":"/hhj4ck"},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":338544,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks, $2,000 bounty.","markdown_message":"\u003cp\u003eThanks, $2,000 bounty.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-02-23T19:18:47.887Z","updated_at":"2015-02-23T19:18:47.887Z","actor":{"url":"/ibb-flash","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/046/1483b151cc84e0ff54b32196809ca3bf945812f2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Flash (IBB)"}},"bounty_amount":"2000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"ibb-flash","collaborator":{"username":"hhj4ck","url":"/hhj4ck"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":338572,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-02-23T19:39:17.607Z","updated_at":"2015-02-23T19:39:17.607Z","first_to_agree":true,"actor":{"username":"arice","cleared":false,"url":"/arice","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":363005,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-03-25T19:39:25.254Z","updated_at":"2015-03-25T19:39:25.254Z","actor":{"url":"/ibb-flash","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/046/1483b151cc84e0ff54b32196809ca3bf945812f2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Flash (IBB)"}},"genius_execution_id":null,"team_handle":"ibb-flash","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}