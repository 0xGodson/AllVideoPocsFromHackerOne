{"id":10554,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDU1NA==","url":"https://hackerone.com/reports/10554","title":"Bypassing 2FA for BTC transfers","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2014-05-01T19:58:58.192Z","submitted_at":"2014-05-01T19:58:58.192Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"michiel","url":"/michiel","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":104,"url":"https://hackerone.com/coinbase","handle":"coinbase","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Coinbase","twitter_handle":"","website":"https://coinbase.com/security","about":"Creating an open financial system for the world"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2014-09-25T06:48:37.171Z","bug_reporter_agreed_on_going_public_at":"2014-08-26T06:48:31.666Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Under advanced settings, users have the ability to protect their wallet by requiring two-factor confirmation when sending bitcoins. Personally, I have configured my account with the most secure option, which requires two factor confirmation when sending any amount of bitcoins. However, a flaw exists that allows an attacker with access to the account to bypass the two-factor authentication step that is required upon sending.\r\n\r\nThe vulnerability exists in the transfer feature that allows you to transfer funds between all wallets under the same account (internal transfer). This feature is only visually available when you have at least two wallets, but it is not necessary to have two wallets to exploit this vulnerability. Just makes the process a bit easier.\r\n\r\n# Easy repro steps\r\n- Enable the account security setting that requires you to enter a valid two-factor code when transferring *any* amount of bitcoins.\r\n- Create a second wallet and go to *Manage Accounts* (https://coinbase.com/accounts).\r\n- Click the *Transfer* button and select the wallet you want to send money from.\r\n- Under *To* select one of the other wallets on the account (this doesn't actually matter).\r\n- Pick an amount and hit the *Transfer* button. Make sure to intercept this request! Use Burp Suite for instance. The request should look similar to this:\r\n\r\n```\r\nPOST /accounts/transfer_money HTTP/1.1\r\nHost: coinbase.com\r\n[...]\r\n\r\n----------422668630\r\nContent-Disposition: form-data; name=\"transaction[from]\"\r\n\r\n51cf4e552f31a99ce200001b\r\n----------422668630\r\nContent-Disposition: form-data; name=\"transaction[to]\"\r\n\r\n53440a8092adb7d95000001d\r\n----------422668630\r\nContent-Disposition: form-data; name=\"transaction[amount]\"\r\n\r\n0.1\r\n----------422668630\r\nContent-Disposition: form-data; name=\"transaction[notes]\"\r\n\r\nBypassin' 2FA.\r\n----------422668630--\r\n```\r\n\r\n- Change the `transaction[to]` parameter to the Mongo BSON ID of the wallet you want to transfer the BTCs to. This can be any wallet ID outside the account you were initiating an internal transfer for. It is fairly easy to find the ID of a wallet, for example, it can be found in the DOM:\r\n\r\n```html\r\n\u003cli\u003e\r\n  \u003ca href=\"\" class=\"account-wallet active\" data-wallet-id=\"53440a8092adb7d95000001d\"\u003e\r\n    \u003cstrong\u003eMy Wallet\u003c/strong\u003e \u003cspan\u003e1.00 BTC\u003c/span\u003e\r\n  \u003c/a\u003e\r\n\u003c/li\u003e\r\n```\r\n\r\n- Forward the request. The money is now transferred to the Coinbase wallet associated with the ID specified under `transaction[to]`. No two-factor code was entered.","vulnerability_information_html":"\u003cp\u003eUnder advanced settings, users have the ability to protect their wallet by requiring two-factor confirmation when sending bitcoins. Personally, I have configured my account with the most secure option, which requires two factor confirmation when sending any amount of bitcoins. However, a flaw exists that allows an attacker with access to the account to bypass the two-factor authentication step that is required upon sending.\u003c/p\u003e\n\n\u003cp\u003eThe vulnerability exists in the transfer feature that allows you to transfer funds between all wallets under the same account (internal transfer). This feature is only visually available when you have at least two wallets, but it is not necessary to have two wallets to exploit this vulnerability. Just makes the process a bit easier.\u003c/p\u003e\n\n\u003ch1 id=\"easy-repro-steps\"\u003eEasy repro steps\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eEnable the account security setting that requires you to enter a valid two-factor code when transferring \u003cem\u003eany\u003c/em\u003e amount of bitcoins.\u003c/li\u003e\n\u003cli\u003eCreate a second wallet and go to \u003cem\u003eManage Accounts\u003c/em\u003e (\u003ca title=\"https://coinbase.com/accounts\" href=\"/redirect?url=https%3A%2F%2Fcoinbase.com%2Faccounts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://coinbase.com/accounts\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e).\u003c/li\u003e\n\u003cli\u003eClick the \u003cem\u003eTransfer\u003c/em\u003e button and select the wallet you want to send money from.\u003c/li\u003e\n\u003cli\u003eUnder \u003cem\u003eTo\u003c/em\u003e select one of the other wallets on the account (this doesn\u0026#39;t actually matter).\u003c/li\u003e\n\u003cli\u003ePick an amount and hit the \u003cem\u003eTransfer\u003c/em\u003e button. Make sure to intercept this request! Use Burp Suite for instance. The request should look similar to this:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /accounts/transfer_money HTTP/1.1\nHost: coinbase.com\n[...]\n\n----------422668630\nContent-Disposition: form-data; name=\u0026quot;transaction[from]\u0026quot;\n\n51cf4e552f31a99ce200001b\n----------422668630\nContent-Disposition: form-data; name=\u0026quot;transaction[to]\u0026quot;\n\n53440a8092adb7d95000001d\n----------422668630\nContent-Disposition: form-data; name=\u0026quot;transaction[amount]\u0026quot;\n\n0.1\n----------422668630\nContent-Disposition: form-data; name=\u0026quot;transaction[notes]\u0026quot;\n\nBypassin\u0026#39; 2FA.\n----------422668630--\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eChange the \u003ccode\u003etransaction[to]\u003c/code\u003e parameter to the Mongo BSON ID of the wallet you want to transfer the BTCs to. This can be any wallet ID outside the account you were initiating an internal transfer for. It is fairly easy to find the ID of a wallet, for example, it can be found in the DOM:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;li\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eclass=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;account-wallet active\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003edata-wallet-id=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;53440a8092adb7d95000001d\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;strong\u0026gt;\u003c/span\u003eMy Wallet\u003cspan class=\"nt\"\u003e\u0026lt;/strong\u0026gt;\u003c/span\u003e \u003cspan class=\"nt\"\u003e\u0026lt;span\u0026gt;\u003c/span\u003e1.00 BTC\u003cspan class=\"nt\"\u003e\u0026lt;/span\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/li\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003eForward the request. The money is now transferred to the Coinbase wallet associated with the ID specified under \u003ccode\u003etransaction[to]\u003c/code\u003e. No two-factor code was entered.\u003c/li\u003e\n\u003c/ul\u003e\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2014-09-25T06:48:31.950Z","allow_singular_disclosure_after":-197587539.90474874,"singular_disclosure_allowed":true,"vote_count":10,"voters":["sw33tlie","michiel","yashrs","eveeez","fantam1","silv3rpoision","japz","spetr0x","injector404","gopalsingh112"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":45429,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi - Looking at this now. ","markdown_message":"\u003cp\u003eHi - Looking at this now. \u003c/p\u003e\n","automated_response":false,"created_at":"2014-05-07T02:50:34.349Z","updated_at":"2014-05-07T02:50:34.349Z","actor":{"username":"magoo","cleared":false,"url":"/magoo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/044/c5a0272bf5bace329125da5217384d22c444edb3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":45430,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2014-05-07T02:50:41.103Z","updated_at":"2014-05-07T02:50:41.103Z","actor":{"username":"magoo","cleared":false,"url":"/magoo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/044/c5a0272bf5bace329125da5217384d22c444edb3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":46460,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"Hi - Can you confirm the fix?","markdown_message":"\u003cp\u003eHi - Can you confirm the fix?\u003c/p\u003e\n","automated_response":false,"created_at":"2014-05-07T21:33:30.740Z","updated_at":"2014-05-07T21:33:30.740Z","actor":{"username":"magoo","cleared":false,"url":"/magoo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/044/c5a0272bf5bace329125da5217384d22c444edb3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":47063,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"Hey @magoo, I can confirm this bug has been fixed. Cool!","markdown_message":"\u003cp\u003eHey \u003ca href=\"/magoo\"\u003e@magoo\u003c/a\u003e, I can confirm this bug has been fixed. Cool!\u003c/p\u003e\n","automated_response":false,"created_at":"2014-05-08T16:16:56.460Z","updated_at":"2014-05-08T16:16:56.460Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":47790,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2014-05-09T04:06:43.417Z","updated_at":"2014-05-09T04:06:43.417Z","actor":{"username":"magoo","cleared":false,"url":"/magoo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/044/c5a0272bf5bace329125da5217384d22c444edb3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"michiel","url":"/michiel"},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":47791,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2014-05-09T04:06:51.968Z","updated_at":"2014-05-09T04:06:51.968Z","actor":{"url":"/coinbase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Coinbase"}},"bounty_amount":"1000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"coinbase","collaborator":{"username":"michiel","url":"/michiel"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":115515,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-08-26T06:48:31.681Z","updated_at":"2014-08-26T06:48:31.681Z","actor":{"username":"michiel","cleared":true,"url":"/michiel","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/007/439427fb81f710e5e16246ede1828613d46bb79e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":131966,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2014-09-25T06:48:37.626Z","updated_at":"2014-09-25T06:48:37.626Z","actor":{"url":"/coinbase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/104/b151e01a4adbf5ad9067fc30fb2dfe5d5997fa5c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Coinbase"}},"genius_execution_id":null,"team_handle":"coinbase","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}