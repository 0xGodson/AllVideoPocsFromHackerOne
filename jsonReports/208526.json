{"id":208526,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDg1MjY=","url":"https://hackerone.com/reports/208526","title":"Null pointer dereference in mark_context_stack","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2017-02-24T02:09:01.817Z","submitted_at":"2017-02-24T02:09:01.817Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"dgaletic","url":"/dgaletic","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-03-14T21:12:54.560Z","bug_reporter_agreed_on_going_public_at":"2017-03-14T21:12:54.504Z","team_member_agreed_on_going_public_at":"2017-03-14T21:10:45.000Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"The following code causes a segfault in mruby and mruby-engine:\n\n    class A \u003c def to_str\n        0 and s@e---\u003e{}\n        rescue \"\"\n        end\n    end\n\nmruby crashes due to a null pointer dereference in `mark_context_stack` (gc.c:554):\n\n    553│     if (!mrb_immediate_p(v)) {\n    554├\u003e      if (mrb_basic_ptr(v)-\u003ett == MRB_TT_FREE) {\n    555│         c-\u003estbase[i] = mrb_nil_value();\n\n(gdb) print v\n$1 = {value = {f = 0, p = 0x0, i = 0, sym = 0}, tt = 7013872}\n(gdb) print mrb_basic_ptr(v)\n$2 = (struct RBasic *) 0x0\n\nmruby-engine appears to crash one line earlier, when returning from `mrb_immediate_p` (boxing_word.h:90):\n\n     89│   }\n     90├\u003e  return o.value.bp-\u003ett;\n     91│ }\n     \nIn this case, the variable `v` (the `o` parameter of `mrb_immediate_p`, which itself shows as optimized out on the test platform) was:\n\n(gdb) print v\n$1 = {value = {p = 0x100000002, {i_flag = 0, i = 2147483649}, {sym_flag = 2, sym = 1}, \nbp = 0x100000002, fp = 0x100000002, vp = 0x100000002}, w = 4294967298}\n\n \nTest platform:\nLinux Mint 17.3 (Cinnamon 64-bit), built with gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.3)\n\nmruby-engine SHA:  09be20e67888b20bebf9b0588bc3cbec7f55325f\nmruby (submodule) SHA: a9f7b41219810fdbe0cffa872051cd091fc070ac\n\nThank you,\nDinko Galetic\nDenis Kasak ","vulnerability_information_html":"\u003cp\u003eThe following code causes a segfault in mruby and mruby-engine:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eclass A \u0026lt; def to_str\n    0 and s@e---\u0026gt;{}\n    rescue \u0026quot;\u0026quot;\n    end\nend\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003emruby crashes due to a null pointer dereference in \u003ccode\u003emark_context_stack\u003c/code\u003e (gc.c:554):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e553│     if (!mrb_immediate_p(v)) {\n554├\u0026gt;      if (mrb_basic_ptr(v)-\u0026gt;tt == MRB_TT_FREE) {\n555│         c-\u0026gt;stbase[i] = mrb_nil_value();\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e(gdb) print v\u003cbr\u003e\n$1 = {value = {f = 0, p = 0x0, i = 0, sym = 0}, tt = 7013872}\u003cbr\u003e\n(gdb) print mrb_basic_ptr(v)\u003cbr\u003e\n$2 = (struct RBasic *) 0x0\u003c/p\u003e\n\n\u003cp\u003emruby-engine appears to crash one line earlier, when returning from \u003ccode\u003emrb_immediate_p\u003c/code\u003e (boxing_word.h:90):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e 89│   }\n 90├\u0026gt;  return o.value.bp-\u0026gt;tt;\n 91│ }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn this case, the variable \u003ccode\u003ev\u003c/code\u003e (the \u003ccode\u003eo\u003c/code\u003e parameter of \u003ccode\u003emrb_immediate_p\u003c/code\u003e, which itself shows as optimized out on the test platform) was:\u003c/p\u003e\n\n\u003cp\u003e(gdb) print v\u003cbr\u003e\n$1 = {value = {p = 0x100000002, {i_flag = 0, i = 2147483649}, {sym_flag = 2, sym = 1}, \u003cbr\u003e\nbp = 0x100000002, fp = 0x100000002, vp = 0x100000002}, w = 4294967298}\u003c/p\u003e\n\n\u003cp\u003eTest platform:\u003cbr\u003e\nLinux Mint 17.3 (Cinnamon 64-bit), built with gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.3)\u003c/p\u003e\n\n\u003cp\u003emruby-engine SHA:  09be20e67888b20bebf9b0588bc3cbec7f55325f\u003cbr\u003e\nmruby (submodule) SHA: a9f7b41219810fdbe0cffa872051cd091fc070ac\u003c/p\u003e\n\n\u003cp\u003eThank you,\u003cbr\u003e\nDinko Galetic\u003cbr\u003e\nDenis Kasak \u003c/p\u003e\n","bounty_amount":"800.0","formatted_bounty":"$800","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-04-13T21:10:45.053Z","allow_singular_disclosure_after":-117099913.16650088,"singular_disclosure_allowed":true,"vote_count":2,"voters":["eveeez","spetr0x"],"severity":{"rating":"low","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1502594,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for reporting this bug! This is an automated response to let you know that we've received your issue, and we'll process it as soon as possible.\n\nDue to the large volume of reports we have received, it may take us up to three weeks to respond. Thank you for your patience!","markdown_message":"\u003cp\u003eThank you for reporting this bug! This is an automated response to let you know that we\u0026#39;ve received your issue, and we\u0026#39;ll process it as soon as possible.\u003c/p\u003e\n\n\u003cp\u003eDue to the large volume of reports we have received, it may take us up to three weeks to respond. Thank you for your patience!\u003c/p\u003e\n","automated_response":true,"created_at":"2017-02-24T02:12:33.858Z","updated_at":"2017-02-24T02:12:33.858Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1525153,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We've reproduced the crash, and opened an issue upstream: https://github.com/mruby/mruby/issues/3487","markdown_message":"\u003cp\u003eThank you for your report. We\u0026#39;ve reproduced the crash, and opened an issue upstream: \u003ca title=\"https://github.com/mruby/mruby/issues/3487\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fissues%2F3487\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/issues/3487\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-07T19:16:31.725Z","updated_at":"2017-03-07T19:16:31.725Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1540157,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. This issue was addressed in the following upstream commits:\n\nhttps://github.com/mruby/mruby/commit/000c68da97ec0bfbd93e3969a2eef21081569a72\nhttps://github.com/mruby/mruby/commit/26169f9e25788caf2781a92087f489e5e5fdc0c9\nhttps://github.com/mruby/mruby/commit/92f5becabe9db34e51fa917f3095b1f90869a1a5\nhttps://github.com/mruby/mruby/commit/916b8ed5c8b6f7a0b6532604a42dc7c9584426f1\n\nOur next round of bounty decisions will take place within two weeks, so we'll be in touch with you again soon.","markdown_message":"\u003cp\u003eThanks again for your report. This issue was addressed in the following upstream commits:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://github.com/mruby/mruby/commit/000c68da97ec0bfbd93e3969a2eef21081569a72\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fcommit%2F000c68da97ec0bfbd93e3969a2eef21081569a72\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/commit/000c68da97ec0bfbd93e3969a2eef21081569a72\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://github.com/mruby/mruby/commit/26169f9e25788caf2781a92087f489e5e5fdc0c9\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fcommit%2F26169f9e25788caf2781a92087f489e5e5fdc0c9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/commit/26169f9e25788caf2781a92087f489e5e5fdc0c9\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://github.com/mruby/mruby/commit/92f5becabe9db34e51fa917f3095b1f90869a1a5\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fcommit%2F92f5becabe9db34e51fa917f3095b1f90869a1a5\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/commit/92f5becabe9db34e51fa917f3095b1f90869a1a5\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://github.com/mruby/mruby/commit/916b8ed5c8b6f7a0b6532604a42dc7c9584426f1\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fcommit%2F916b8ed5c8b6f7a0b6532604a42dc7c9584426f1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/mruby/mruby/commit/916b8ed5c8b6f7a0b6532604a42dc7c9584426f1\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eOur next round of bounty decisions will take place within two weeks, so we\u0026#39;ll be in touch with you again soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-14T14:07:12.438Z","updated_at":"2017-03-14T14:07:12.438Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"dgaletic","url":"/dgaletic"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541585,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify and the MRuby project!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify and the MRuby project!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-14T21:10:38.969Z","updated_at":"2017-03-14T21:10:38.969Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"800.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"dgaletic","url":"/dgaletic"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541586,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-14T21:10:45.020Z","updated_at":"2017-03-14T21:10:45.020Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541604,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-14T21:12:54.526Z","updated_at":"2017-03-14T21:12:54.526Z","actor":{"username":"dgaletic","cleared":true,"url":"/dgaletic","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1541605,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-14T21:12:54.576Z","updated_at":"2017-03-14T21:12:54.576Z","actor":{"username":"dgaletic","cleared":true,"url":"/dgaletic","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}