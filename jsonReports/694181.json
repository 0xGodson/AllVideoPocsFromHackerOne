{"id":694181,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82OTQxODE=","url":"https://hackerone.com/reports/694181","title":"Worker container escape lead to arbitrary file reading in host machine","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2019-09-13T02:39:39.780Z","submitted_at":"2019-09-13T02:39:39.780Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"testanull","url":"/testanull","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/SF93KjfUXeXdWWFga4q3gwCa/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":27264,"url":"https://hackerone.com/semmle","handle":"semmle","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/027/264/8af1325fdaccc38beab4451ba68ace24623b248c_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/027/264/8af1325fdaccc38beab4451ba68ace24623b248c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"disabled","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Semmle","twitter_handle":"semmle","website":"https://semmle.com","about":"Semmle's engineering analytics platform helps leading technology companies and open-source developers build secure, reliable software."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-10-16T12:34:13.387Z","bug_reporter_agreed_on_going_public_at":"2019-09-16T12:34:10.864Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\nBecause lack of security, attacker will be able to remove original log file and replace it will a symlink to other file, \nAfter finishing job, host machine copy file from docker container.\nBecause the original log file has been removed, the host machine will copy the symlink file.\nBut the problem is it doesn't copy the linked file in container, it copys the linked file in the HOST MACHINE.\n\n## Steps To Reproduce:\nThe attack is very simple, just remove the original build.log file and replace with a symlink file,\nI used this configuration to read the ``/etc/passwd``:\n```extraction:\n  cpp:\n    after_prepare:\n      - rm -rf /opt/out/snapshot/log/build.log \u0026\u0026 ln -s /etc/passwd /opt/out/snapshot/log/build.log\n```\n\n## PoC\nContent of ``/etc/passwd`` is attached below\n\n## Impact\n\nGive attacker ability to explore the host machine, expose more sensitive informations from it.","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003eBecause lack of security, attacker will be able to remove original log file and replace it will a symlink to other file, \u003cbr\u003e\nAfter finishing job, host machine copy file from docker container.\u003cbr\u003e\nBecause the original log file has been removed, the host machine will copy the symlink file.\u003cbr\u003e\nBut the problem is it doesn\u0026#39;t copy the linked file in container, it copys the linked file in the HOST MACHINE.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003cp\u003eThe attack is very simple, just remove the original build.log file and replace with a symlink file,\u003cbr\u003e\nI used this configuration to read the \u003ccode\u003e/etc/passwd\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e  cpp:\n    after_prepare:\n      - rm -rf /opt/out/snapshot/log/build.log \u0026amp;\u0026amp; ln -s /etc/passwd /opt/out/snapshot/log/build.log\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"poc\"\u003ePoC\u003c/h2\u003e\n\n\u003cp\u003eContent of \u003ccode\u003e/etc/passwd\u003c/code\u003e is attached below\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eGive attacker ability to explore the host machine, expose more sensitive informations from it.\u003c/p\u003e\n","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":581696,"file_name":"docker_escape_read_file.PNG","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/EfxGZDPwSnU2WP2e27Uec2r4?response-content-disposition=attachment%3B%20filename%3D%22docker_escape_read_file.PNG%22%3B%20filename%2A%3DUTF-8%27%27docker_escape_read_file.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T063908Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=33b87e8b746cde566819f7462eed045635833e0ead652ad89e9130fa887743cf","file_size":87863,"type":"image/png"}],"allow_singular_disclosure_at":"2019-10-16T12:34:10.928Z","allow_singular_disclosure_after":-37994697.36720285,"singular_disclosure_allowed":true,"vote_count":110,"voters":["qdoan95","kapytein","spam404","base_64","mik317","yeuchimse","sameerphad72","s_p_q_r","testanull","ahiezer","and 100 more..."],"severity":{"rating":"critical","score":9.3,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":8552,"asset_type":"URL","asset_identifier":"lgtm-com.pentesting.semmle.net","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":5796916,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Bonus private ip of host machine","markdown_message":"\u003cp\u003eBonus private ip of host machine\u003c/p\u003e\n","automated_response":false,"created_at":"2019-09-13T03:56:52.989Z","updated_at":"2019-09-13T03:56:52.989Z","actor":{"username":"testanull","cleared":false,"url":"/testanull","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/SF93KjfUXeXdWWFga4q3gwCa/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":581723,"filename":"ip_host_docker.PNG","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/rB7iqhLtnN86d6tBLznY9JnJ?response-content-disposition=attachment%3B%20filename%3D%22ip_host_docker.PNG%22%3B%20filename%2A%3DUTF-8%27%27ip_host_docker.PNG\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQWS7SVX5C%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T063908Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCICTltBX5kZS78yzw3IUUt%2Fa035OzgQ2vLu8U1ZxOKGilAiEAqT8jxmclsgLwaEL5fi7C70iqLwP7J3SWF5ypfn%2Fn%2BdUqtAMIVBABGgwwMTM2MTkyNzQ4NDkiDGRWkSc4Hmgq8mMXKCqRA0Pq%2Bzgh6dptjyRB4GzYO9sir45RVm0RyvFSB8lDBYTBiDIVL0nR3Ah5epkHqGDZZEh0G%2BfKYu%2FWpfgxJl7qllLzKg%2BOA0izVs9KPgQdxk0VWwW%2FPKL2ZT4v%2FSNRvF7rPUbZ7WhGTZqx0%2BinzKM%2BO6lDyXZKNKMzhjRnIFdI7Th01c4ma39imTXQDmxc%2FNzHFK40lrkAbTZoTlcq%2BsnIcIRSB0h4GHasXhR5OHx8rifULR7sVKHDcZMCzSYjrtagaKs9I81LEzlSbEGxIQar2MK%2BZBwmpT57aT%2F1nIOoa%2FlH5nfP4Ihcv4Mqfp19pFx8mlVoMe%2FTEx0pqNuC4lGQXowSDJKBcSjrYM6ouddZWfwY6R4O8X69XqZawGSrmBiXyAVG%2BDj895xbDJhiOXMvqkvSfsEzIfvcaHAzshzNZjFT3yiN4h81wfUF3QuLc6DHCTt1MPDYiUB8I7UCQ8wJxW4pg3xTnHqSwUeqww3YY8RFfsgvfp9PzGJ1s4vReFrzuzYVanpT22oz4w33z29yMPmMMO21qv8FOusBOsYr4rmEPt9wYTc2WNI63vM9u2VUhGNHafH2%2Fh3q6i%2BwJ0u2HLCQd44aqHfWZ%2Bc8hzInEQnRNrZf7owYuE4cHiraWaOsNJjfOEJBZu5nzzun4JSk7801NfOqa1zcgLMWOwyWJCtalb9fGn6qhwTWTBMzsOFHc661yyW%2FaqejCIRf6%2BwNOGhO8kc%2BEhEIq0iydp5k4rlMRKlFJPFlphrQYGeZgYr9TM%2FVgHlN%2Bx4Oxtcg1UwCGXMGiV%2BqXzeMEmO%2FdxKETdJJvF%2BEaJSsF0r1i7s8g61czrgyi9MKMpia%2Fg6ovVFkrvHOejV96g%3D%3D\u0026X-Amz-Signature=e96ce652c94821aeade11d5864484a728d9b3ec224aa8eab02ffa7416d65ee4d"}],"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5800557,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-09-13T14:46:40.709Z","updated_at":"2019-09-13T14:46:40.709Z","additional_data":{"old_severity":"High (8.8)","new_severity":"Critical (9.3)","old_severity_id":515543,"new_severity_id":515868},"actor":{"username":"chrisgavin","cleared":false,"url":"/chrisgavin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/259/787/73e7651e088896c2379249d5752999800fc9c2c6_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5800613,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi,\n\nThank you again for another great find. After doing a CVSS evaluation we've bumped the severity of this to critical.\n\nWe're currently in the process of deploying a remediation involving removing symlinks from data uploaded from the worker. We hope to have this rolled out shortly, but it may take a few hours as it requires restarting all our build machines.\n\nThanks,\nChris","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThank you again for another great find. After doing a CVSS evaluation we\u0026#39;ve bumped the severity of this to critical.\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;re currently in the process of deploying a remediation involving removing symlinks from data uploaded from the worker. We hope to have this rolled out shortly, but it may take a few hours as it requires restarting all our build machines.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\nChris\u003c/p\u003e\n","automated_response":false,"created_at":"2019-09-13T14:51:00.299Z","updated_at":"2019-09-13T14:51:00.299Z","actor":{"username":"chrisgavin","cleared":false,"url":"/chrisgavin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/259/787/73e7651e088896c2379249d5752999800fc9c2c6_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5800616,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-09-13T14:51:33.610Z","updated_at":"2019-09-13T14:51:33.610Z","actor":{"url":"/semmle","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/027/264/8af1325fdaccc38beab4451ba68ace24623b248c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Semmle"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"semmle","collaborator":{"username":"testanull","url":"/testanull"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5800930,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you,\n:D Your team seems to be working hard in the last few days,\nHave nice weekend!","markdown_message":"\u003cp\u003eThank you,\u003cbr\u003e\n:D Your team seems to be working hard in the last few days,\u003cbr\u003e\nHave nice weekend!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-09-13T15:42:38.149Z","updated_at":"2019-09-13T15:42:38.149Z","actor":{"username":"testanull","cleared":false,"url":"/testanull","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/SF93KjfUXeXdWWFga4q3gwCa/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5814858,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi,\n\nThanks for your kind words. I hope your weekend was also great!\n\nThe fix for this should now have reached all of our build machines. I've re-tested the exploit you provided and it no longer works.\n\nThank you again for this great report and for helping keep our platform safe.\n\nThanks,\nChris","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThanks for your kind words. I hope your weekend was also great!\u003c/p\u003e\n\n\u003cp\u003eThe fix for this should now have reached all of our build machines. I\u0026#39;ve re-tested the exploit you provided and it no longer works.\u003c/p\u003e\n\n\u003cp\u003eThank you again for this great report and for helping keep our platform safe.\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\nChris\u003c/p\u003e\n","automated_response":false,"created_at":"2019-09-16T12:19:35.310Z","updated_at":"2019-09-16T12:19:35.310Z","actor":{"username":"chrisgavin","cleared":false,"url":"/chrisgavin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/259/787/73e7651e088896c2379249d5752999800fc9c2c6_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"testanull","url":"/testanull"},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5814970,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Do you mind if i disclosure this report in next 30 day?","markdown_message":"\u003cp\u003eDo you mind if i disclosure this report in next 30 day?\u003c/p\u003e\n","automated_response":false,"created_at":"2019-09-16T12:34:10.886Z","updated_at":"2019-09-16T12:34:10.886Z","first_to_agree":true,"actor":{"username":"testanull","cleared":false,"url":"/testanull","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/SF93KjfUXeXdWWFga4q3gwCa/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5828250,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"That's fine with us. We're also happy to disclose immediately if you'd prefer.","markdown_message":"\u003cp\u003eThat\u0026#39;s fine with us. We\u0026#39;re also happy to disclose immediately if you\u0026#39;d prefer.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-09-17T17:58:44.323Z","updated_at":"2019-09-17T17:58:44.323Z","actor":{"username":"chrisgavin","cleared":false,"url":"/chrisgavin","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/259/787/73e7651e088896c2379249d5752999800fc9c2c6_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6054619,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-16T12:34:13.412Z","updated_at":"2019-10-16T12:34:13.412Z","actor":{"url":"/semmle","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/027/264/8af1325fdaccc38beab4451ba68ace24623b248c_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Semmle"}},"genius_execution_id":null,"team_handle":"semmle","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}