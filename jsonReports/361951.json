{"id":361951,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNjE5NTE=","url":"https://hackerone.com/reports/361951","title":"Exploiting JSONP callback on /username/charts.json endpoint leads to information disclosure despite user's privacy settings","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-06-05T02:23:45.221Z","submitted_at":"2018-06-05T02:23:45.221Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"kapytein","url":"/kapytein","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":28411,"url":"https://hackerone.com/liberapay","handle":"liberapay","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Liberapay","twitter_handle":"liberapay","website":"https://liberapay.com","about":"An open source platform designed to facilitate recurrent donations."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-06-05T15:46:23.714Z","bug_reporter_agreed_on_going_public_at":"2018-06-05T15:46:23.594Z","team_member_agreed_on_going_public_at":"2018-06-05T15:42:19.375Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello!\n\n## Vulnerability Details\nThe `/username/charts.json` endpoint can return a JSONP callback due to the fact that `jsonp_dump` is used in the file `charts.json.spt`. It appears that the content of the JSONP request depends on the authentication of the user. If the user enabled the privacy setting which hides the receiving donation data of the user,  a 403 error will be returned **unless**  the user is authenticated.\n\nThis happens [here](https://github.com/liberapay/liberapay.com/blob/b56172c6a6382595b8cfabccf424ba182820ea0e/www/%25username/charts.json.spt#L19):\n\n```python\nif participant.hide_receiving:\n    if user != participant and not user.is_admin:\n        raise response.error(403)\n```\n\nThe vulnerable code is [here](https://github.com/liberapay/liberapay.com/blob/b56172c6a6382595b8cfabccf424ba182820ea0e/www/%25username/charts.json.spt#L85):\n\n```python\n[---] application/json via jsonp_dump\n```\n\nBasically, a `jsonp_dump` is unnecessary in this case (I did not notice a case where cross-domain requests need to be done), and it should be replaced with `json_dump` instead.\n\n## How could this be exploited?\nThis would eventually allow any site to call the JSONP callback, and receive the receiving donation data of the user, despite it's privacy settings. This will lead to unwanted information disclosure.\n\n## Proof of Concept\n```html\n\u003cscript\u003e\nfunction rip(a) {\n\nalert(JSON.stringify(a[1]));\n\n}\n\u003c/script\u003e\n\u003cscript src=\"https://liberapay.com/~153779/charts.json?callback=rip\"\u003e\u003c/script\u003e\n```\n\nHost this file, visit the site authenticated and it will print out the first row in the JSON Array. If you have not received any donation through LIbrapay so far, an empty JSON array will be returned.\n\n## Impact\n\nThis will lead to unwanted information disclosure due to the fact that privacy settings of the user will be ignored.","vulnerability_information_html":"\u003cp\u003eHello!\u003c/p\u003e\n\n\u003ch2 id=\"vulnerability-details\"\u003eVulnerability Details\u003c/h2\u003e\n\n\u003cp\u003eThe \u003ccode\u003e/username/charts.json\u003c/code\u003e endpoint can return a JSONP callback due to the fact that \u003ccode\u003ejsonp_dump\u003c/code\u003e is used in the file \u003ccode\u003echarts.json.spt\u003c/code\u003e. It appears that the content of the JSONP request depends on the authentication of the user. If the user enabled the privacy setting which hides the receiving donation data of the user,  a 403 error will be returned \u003cstrong\u003eunless\u003c/strong\u003e  the user is authenticated.\u003c/p\u003e\n\n\u003cp\u003eThis happens \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fliberapay%2Fliberapay.com%2Fblob%2Fb56172c6a6382595b8cfabccf424ba182820ea0e%2Fwww%2F%2525username%2Fcharts.json.spt%23L19\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehere\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight python\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eparticipant\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehide_receiving\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eparticipant\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eis_admin\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e403\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe vulnerable code is \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fliberapay%2Fliberapay.com%2Fblob%2Fb56172c6a6382595b8cfabccf424ba182820ea0e%2Fwww%2F%2525username%2Fcharts.json.spt%23L85\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehere\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight python\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"o\"\u003e---\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e \u003cspan class=\"n\"\u003evia\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonp_dump\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBasically, a \u003ccode\u003ejsonp_dump\u003c/code\u003e is unnecessary in this case (I did not notice a case where cross-domain requests need to be done), and it should be replaced with \u003ccode\u003ejson_dump\u003c/code\u003e instead.\u003c/p\u003e\n\n\u003ch2 id=\"how-could-this-be-exploited\"\u003eHow could this be exploited?\u003c/h2\u003e\n\n\u003cp\u003eThis would eventually allow any site to call the JSONP callback, and receive the receiving donation data of the user, despite it\u0026#39;s privacy settings. This will lead to unwanted information disclosure.\u003c/p\u003e\n\n\u003ch2 id=\"proof-of-concept\"\u003eProof of Concept\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003erip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estringify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]));\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://liberapay.com/~153779/charts.json?callback=rip\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHost this file, visit the site authenticated and it will print out the first row in the JSON Array. If you have not received any donation through LIbrapay so far, an empty JSON array will be returned.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThis will lead to unwanted information disclosure due to the fact that privacy settings of the user will be ignored.\u003c/p\u003e\n","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":18,"name":"Information Disclosure"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-07-05T15:42:19.508Z","allow_singular_disclosure_after":-78415272.39678332,"singular_disclosure_allowed":true,"vote_count":28,"voters":["sp1d3rs","jensec","kapytein","europa","hunter","bagipro","muon4","spam404","sameerphad72","yumi","and 18 more..."],"severity":{"rating":"medium","score":4.3,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"required","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":8927,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/liberapay/liberapay.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2842537,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-05T02:24:03.864Z","updated_at":"2018-06-05T02:24:03.864Z","additional_data":{"old_title":"Exploiting JSONP on /username/charts.json leads to information disclosure despite user's privacy settings","new_title":"Exploiting JSONP on /username/charts.json endpoint leads to information disclosure despite user's privacy settings"},"actor":{"username":"kapytein","cleared":true,"url":"/kapytein","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2842543,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-05T02:26:44.850Z","updated_at":"2018-06-05T02:26:44.850Z","additional_data":{"old_title":"Exploiting JSONP on /username/charts.json endpoint leads to information disclosure despite user's privacy settings","new_title":"Exploiting JSONP callback on /username/charts.json endpoint leads to information disclosure despite user's privacy settings"},"actor":{"username":"kapytein","cleared":true,"url":"/kapytein","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2842551,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"If you do need cross-domain requests, you might want to keep the CORS header `Access-Control-Allow-Origin` at [L23](https://github.com/liberapay/liberapay.com/blob/87dacd58e9e29a9b5920cb1f2f211e105dd0ae56/www/%25username/charts.json.spt#L23), and just remove the JSONP response. This won't break the application on subdomains, as users who disabled the receiving privacy setting (thus making it public), do not require to be authenticated for the `/username/charts.json` endpoint. Loading JS files cross-origin will include cookies, so a JSONP callback response will be vulnerable. I think you should be good with the `Access-Control-Allow-Origin` header only.","markdown_message":"\u003cp\u003eIf you do need cross-domain requests, you might want to keep the CORS header \u003ccode\u003eAccess-Control-Allow-Origin\u003c/code\u003e at \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fliberapay%2Fliberapay.com%2Fblob%2F87dacd58e9e29a9b5920cb1f2f211e105dd0ae56%2Fwww%2F%2525username%2Fcharts.json.spt%23L23\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eL23\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, and just remove the JSONP response. This won\u0026#39;t break the application on subdomains, as users who disabled the receiving privacy setting (thus making it public), do not require to be authenticated for the \u003ccode\u003e/username/charts.json\u003c/code\u003e endpoint. Loading JS files cross-origin will include cookies, so a JSONP callback response will be vulnerable. I think you should be good with the \u003ccode\u003eAccess-Control-Allow-Origin\u003c/code\u003e header only.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T02:36:24.681Z","updated_at":"2018-06-05T02:44:02.505Z","actor":{"username":"kapytein","cleared":true,"url":"/kapytein","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2842568,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for your submission! We have received your report and a security analyst will respond shortly.","markdown_message":"\u003cp\u003eThank you for your submission! We have received your report and a security analyst will respond shortly.\u003c/p\u003e\n","automated_response":true,"created_at":"2018-06-05T02:53:51.446Z","updated_at":"2018-06-05T02:53:51.446Z","actor":{"url":"/liberapay","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Liberapay"}},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2844102,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-05T10:10:16.543Z","updated_at":"2018-06-05T10:10:16.543Z","additional_data":{"old_severity":null,"new_severity":"Medium (4.3)","old_severity_id":null,"new_severity_id":163876},"actor":{"username":"changaco","cleared":false,"url":"/changaco","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/057/214/a4a950c93bb68bb76a61cf02b1484a518e8c7a90_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844251,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for your submission. We are currently reviewing your report.","markdown_message":"\u003cp\u003eThank you for your submission. We are currently reviewing your report.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T11:14:24.995Z","updated_at":"2018-06-05T11:14:24.995Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844271,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank your for this excellent report. I concur that there is a possibility of cross-origin private information disclosure.\n\nAs a general browser-side solution to this kind of vulnerability we are going to restrict our cookies to same-site requests by default (see [pull request 1133](https://github.com/liberapay/liberapay.com/pull/1133)). However we also need a server-side solution, especially since many browser versions currently in use do not support the `SameSite` cookie attribute (see [caniuse.com](https://caniuse.com/#feat=same-site-cookie-attribute) for details). Checking the `Referer` header may be an effective general solution to preventing cross-origin private information disclosure, with a low percentage of false positives (the vast majority of browsers are configured to send an appropriate `Referer` for same-origin requests).","markdown_message":"\u003cp\u003eThank your for this excellent report. I concur that there is a possibility of cross-origin private information disclosure.\u003c/p\u003e\n\n\u003cp\u003eAs a general browser-side solution to this kind of vulnerability we are going to restrict our cookies to same-site requests by default (see \u003ca href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fliberapay%2Fliberapay.com%2Fpull%2F1133\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003epull request 1133\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e). However we also need a server-side solution, especially since many browser versions currently in use do not support the \u003ccode\u003eSameSite\u003c/code\u003e cookie attribute (see \u003ca href=\"/redirect?url=https%3A%2F%2Fcaniuse.com%2F%23feat%3Dsame-site-cookie-attribute\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ecaniuse.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e for details). Checking the \u003ccode\u003eReferer\u003c/code\u003e header may be an effective general solution to preventing cross-origin private information disclosure, with a low percentage of false positives (the vast majority of browsers are configured to send an appropriate \u003ccode\u003eReferer\u003c/code\u003e for same-origin requests).\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T11:23:27.639Z","updated_at":"2018-06-05T11:23:27.639Z","actor":{"username":"changaco","cleared":false,"url":"/changaco","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/057/214/a4a950c93bb68bb76a61cf02b1484a518e8c7a90_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844279,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"You have submitted a valid security vulnerability. We will now focus on resolving the reported issue as quickly as possible. Thank you so much for the beautifully-written report, @kapytein — it is always a pleasure to work with you.","markdown_message":"\u003cp\u003eYou have submitted a valid security vulnerability. We will now focus on resolving the reported issue as quickly as possible. Thank you so much for the beautifully-written report, \u003ca href=\"/kapytein\"\u003e@kapytein\u003c/a\u003e — it is always a pleasure to work with you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T11:25:59.493Z","updated_at":"2018-06-05T11:25:59.493Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844291,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e You have submitted a valid security vulnerability. We will now focus on resolving the reported issue as quickly as possible. Thank you so much for the beautifully-written report, @kapytein — it is always a pleasure to work with you.\n\nThank you! It's great to work with you guys! :)\n\n\u003e Thank your for this excellent report. I concur that there is a possibility of cross-origin private information disclosure.\n\n\u003e As a general browser-side solution to this kind of vulnerability we are going to restrict our cookies to same-site requests by default (see pull request 1133). However we also need a server-side solution, especially since many browser versions currently in use do not support the SameSite cookie attribute (see caniuse.com for details). Checking the Referer header may be an effective general solution to preventing cross-origin private information disclosure, with a low percentage of false positives (the vast majority of browsers are configured to send an appropriate Referer for same-origin requests).\n\nThanks again. That's true, but in this case,  replacing the `jsonp_dump` with `json_dump` will basically resolve the issue. You can keep the CORS header `Access-Control-Allow-Origin`, as XHR requests won't include cookies unless you respond with the `Access-Control-Allow-Credentials` as well (then again, you need to respond with a specific domain in the ACAC header in order to make it work on most browsers), which is totally not needed in this case. Unless, you of course, need the JSONP callback, however I couldn't notice where it is really required.\n","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003eYou have submitted a valid security vulnerability. We will now focus on resolving the reported issue as quickly as possible. Thank you so much for the beautifully-written report, \u003ca href=\"/kapytein\"\u003e@kapytein\u003c/a\u003e — it is always a pleasure to work with you.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThank you! It\u0026#39;s great to work with you guys! :)\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThank your for this excellent report. I concur that there is a possibility of cross-origin private information disclosure.\u003c/p\u003e\n\n\u003cp\u003eAs a general browser-side solution to this kind of vulnerability we are going to restrict our cookies to same-site requests by default (see pull request 1133). However we also need a server-side solution, especially since many browser versions currently in use do not support the SameSite cookie attribute (see caniuse.com for details). Checking the Referer header may be an effective general solution to preventing cross-origin private information disclosure, with a low percentage of false positives (the vast majority of browsers are configured to send an appropriate Referer for same-origin requests).\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThanks again. That\u0026#39;s true, but in this case,  replacing the \u003ccode\u003ejsonp_dump\u003c/code\u003e with \u003ccode\u003ejson_dump\u003c/code\u003e will basically resolve the issue. You can keep the CORS header \u003ccode\u003eAccess-Control-Allow-Origin\u003c/code\u003e, as XHR requests won\u0026#39;t include cookies unless you respond with the \u003ccode\u003eAccess-Control-Allow-Credentials\u003c/code\u003e as well (then again, you need to respond with a specific domain in the ACAC header in order to make it work on most browsers), which is totally not needed in this case. Unless, you of course, need the JSONP callback, however I couldn\u0026#39;t notice where it is really required.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T11:30:50.203Z","updated_at":"2018-06-05T11:32:04.692Z","actor":{"username":"kapytein","cleared":true,"url":"/kapytein","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2844298,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Just to add to @changaco's comment above, you cannot abuse this bug to disclose details from profiles that have their privacy settings set to remain completely private as you can see below.\n\n```\n$ curl -Is https://liberapay.com/EdOverflow/charts.json?callback=rip | head -1\nHTTP/2 403 \n$ curl -Is https://liberapay.com/Liberapay/charts.json?callback=rip | head -1\nHTTP/2 200 \n```","markdown_message":"\u003cp\u003eJust to add to \u003ca href=\"/changaco\"\u003e@changaco\u003c/a\u003e\u0026#39;s comment above, you cannot abuse this bug to disclose details from profiles that have their privacy settings set to remain completely private as you can see below.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ curl -Is https://liberapay.com/EdOverflow/charts.json?callback=rip | head -1\nHTTP/2 403 \n$ curl -Is https://liberapay.com/Liberapay/charts.json?callback=rip | head -1\nHTTP/2 200 \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2018-06-05T11:34:29.330Z","updated_at":"2018-06-05T11:34:42.111Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844302,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Unless you visit the attacker's page while being authenticated to Liberapay. @edoverflow ","markdown_message":"\u003cp\u003eUnless you visit the attacker\u0026#39;s page while being authenticated to Liberapay. \u003ca href=\"/edoverflow\"\u003e@edoverflow\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T11:36:58.278Z","updated_at":"2018-06-05T11:37:31.677Z","actor":{"username":"kapytein","cleared":true,"url":"/kapytein","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2844307,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah, good point! In that case, I need to discuss the impact again with @changaco. Thank you for pointing that out, @kapytein! XSSI bugs are really interesting. :D","markdown_message":"\u003cp\u003eAh, good point! In that case, I need to discuss the impact again with \u003ca href=\"/changaco\"\u003e@changaco\u003c/a\u003e. Thank you for pointing that out, \u003ca href=\"/kapytein\"\u003e@kapytein\u003c/a\u003e! XSSI bugs are really interesting. :D\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T11:39:42.618Z","updated_at":"2018-06-05T11:39:42.618Z","actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844312,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-05T11:42:40.510Z","updated_at":"2018-06-05T11:42:40.510Z","actor":{"url":"/liberapay","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Liberapay"}},"bounty_amount":"50.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"liberapay","collaborator":{"username":"kapytein","url":"/kapytein"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844323,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the bounty! Amazing response time!","markdown_message":"\u003cp\u003eThank you for the bounty! Amazing response time!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T11:46:42.107Z","updated_at":"2018-06-05T11:46:42.107Z","actor":{"username":"kapytein","cleared":true,"url":"/kapytein","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2844702,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"The vulnerability should be fixed now, the patch in \u003chttps://github.com/liberapay/liberapay.com/pull/1135\u003e has been deployed to production.\n\n@kapytein Thank you for the advice on how to fix the issue, I've followed your suggestion and simply dropped support for JSONP.","markdown_message":"\u003cp\u003eThe vulnerability should be fixed now, the patch in \u003ca title=\"https://github.com/liberapay/liberapay.com/pull/1135\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fliberapay%2Fliberapay.com%2Fpull%2F1135\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/liberapay/liberapay.com/pull/1135\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e has been deployed to production.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"/kapytein\"\u003e@kapytein\u003c/a\u003e Thank you for the advice on how to fix the issue, I\u0026#39;ve followed your suggestion and simply dropped support for JSONP.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T14:39:40.037Z","updated_at":"2018-06-05T14:39:40.037Z","actor":{"username":"changaco","cleared":false,"url":"/changaco","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/057/214/a4a950c93bb68bb76a61cf02b1484a518e8c7a90_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"kapytein","url":"/kapytein"},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844778,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @changaco,\n\nIssue seems to be fixed in production. Dropping JSONP support indeed fixes the problem. Glad I could help out!","markdown_message":"\u003cp\u003eHi \u003ca href=\"/changaco\"\u003e@changaco\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eIssue seems to be fixed in production. Dropping JSONP support indeed fixes the problem. Glad I could help out!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T15:16:33.048Z","updated_at":"2018-06-05T15:16:33.048Z","actor":{"username":"kapytein","cleared":true,"url":"/kapytein","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2844859,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Keep up the good work, @kapytein! :)","markdown_message":"\u003cp\u003eKeep up the good work, \u003ca href=\"/kapytein\"\u003e@kapytein\u003c/a\u003e! :)\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T15:42:19.427Z","updated_at":"2018-06-05T15:42:19.427Z","first_to_agree":true,"actor":{"username":"edoverflow","cleared":true,"url":"/edoverflow","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844876,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thank you, @edoverflow!","markdown_message":"\u003cp\u003eThank you, \u003ca href=\"/edoverflow\"\u003e@edoverflow\u003c/a\u003e!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T15:46:23.630Z","updated_at":"2018-06-05T15:46:23.630Z","actor":{"username":"kapytein","cleared":true,"url":"/kapytein","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2844877,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-05T15:46:23.792Z","updated_at":"2018-06-05T15:46:23.792Z","actor":{"username":"kapytein","cleared":true,"url":"/kapytein","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/H1zdsrnjSBH6Y8oB1YSvGJx2/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":7615,"category":"team","content":"@kapytein submitted a wonderful report describing an XSSI vulnerability in liberapay.com. During the initial review, we thought that the endpoint did not disclose data from profiles that had disabled sharing details on their profiles. However, @kapytein did provide us with additional information that demonstrated leaking private data to a third-party website.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003ca href=\"/kapytein\"\u003e@kapytein\u003c/a\u003e submitted a wonderful report describing an XSSI vulnerability in liberapay.com. During the initial review, we thought that the endpoint did not disclose data from profiles that had disabled sharing details on their profiles. However, \u003ca href=\"/kapytein\"\u003e@kapytein\u003c/a\u003e did provide us with additional information that demonstrated leaking private data to a third-party website.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}