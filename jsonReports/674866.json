{"id":674866,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NzQ4NjY=","url":"https://hackerone.com/reports/674866","title":"Conversation API Leaks Details Of UnAuthorized Conversations","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2019-08-16T06:40:48.969Z","submitted_at":"2019-08-16T06:40:48.969Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mindingdata","url":"/mindingdata","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17443,"url":"https://hackerone.com/vanilla","handle":"vanilla","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Vanilla","twitter_handle":"vanilla","website":"http://vanillaforums.com","about":"Vanilla is a powerfully simple discussion forum you can easily customize to make as unique as your community."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-03-25T19:41:33.034Z","bug_reporter_agreed_on_going_public_at":"2020-02-24T19:41:31.402Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"## Summary:\n\nIf a user creates a conversations, and then leaves, all API calls and web access to that conversation is locked down. Except for one particular API call which allows you to see details about ongoing conversations you have since left as long as you created the conversation in the first place. \n\n## Steps to reproduce:\n\n1. Ensure that the \"member\" role has API Token access. \n2. Create a new user with this role, and send a conversation to anyone. \n3. Leave said conversation. \n4. On the web/API calls to read this conversation and message should fail. However you should still be able to do the following API call : \nhttps://vanilla.com:444/api/v2/conversations/?insertuserid=yourUserId\u0026access_token=accessToken\nWhich leaks details like who has been added to the conversation after you left, extra messages etc. \n\n## Code Details\n\nI noticed that *most* calls to conversations run through the method `inConversation` which checks whether a user is *still* in the conversation, and if they have left they don't have access to it. But I assume this was too heavy to run in this particular API call because it returns a list. \n\nFor this particular API call if you don't pass in the `insertuserid` param, then it will indeed check the userconversation table and make sure you are still participating in the conversation. But if you pass in `insertuserid` it instead bypasses this check and just returns all conversations you started, irrespective if you are still in them.\n\n## Impact\n\nGain information about conversations they no longer have access to.","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary:\u003c/h2\u003e\n\n\u003cp\u003eIf a user creates a conversations, and then leaves, all API calls and web access to that conversation is locked down. Except for one particular API call which allows you to see details about ongoing conversations you have since left as long as you created the conversation in the first place. \u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps to reproduce:\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eEnsure that the \u0026quot;member\u0026quot; role has API Token access. \u003c/li\u003e\n\u003cli\u003eCreate a new user with this role, and send a conversation to anyone. \u003c/li\u003e\n\u003cli\u003eLeave said conversation. \u003c/li\u003e\n\u003cli\u003eOn the web/API calls to read this conversation and message should fail. However you should still be able to do the following API call : \n\u003ca title=\"https://vanilla.com:444/api/v2/conversations/?insertuserid=yourUserId\u0026amp;access_token=accessToken\" href=\"/redirect?url=https%3A%2F%2Fvanilla.com%3A444%2Fapi%2Fv2%2Fconversations%2F%3Finsertuserid%3DyourUserId%26access_token%3DaccessToken\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://vanilla.com:444/api/v2/conversations/?insertuserid=yourUserId\u0026amp;access_token=accessToken\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\nWhich leaks details like who has been added to the conversation after you left, extra messages etc. \u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"code-details\"\u003eCode Details\u003c/h2\u003e\n\n\u003cp\u003eI noticed that \u003cem\u003emost\u003c/em\u003e calls to conversations run through the method \u003ccode\u003einConversation\u003c/code\u003e which checks whether a user is \u003cem\u003estill\u003c/em\u003e in the conversation, and if they have left they don\u0026#39;t have access to it. But I assume this was too heavy to run in this particular API call because it returns a list. \u003c/p\u003e\n\n\u003cp\u003eFor this particular API call if you don\u0026#39;t pass in the \u003ccode\u003einsertuserid\u003c/code\u003e param, then it will indeed check the userconversation table and make sure you are still participating in the conversation. But if you pass in \u003ccode\u003einsertuserid\u003c/code\u003e it instead bypasses this check and just returns all conversations you started, irrespective if you are still in them.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eGain information about conversations they no longer have access to.\u003c/p\u003e\n","bounty_amount":"150.0","formatted_bounty":"$150","weakness":{"id":26,"name":"Improper Access Control - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2020-03-25T19:41:31.450Z","allow_singular_disclosure_after":-24058522.75201452,"singular_disclosure_allowed":true,"vote_count":4,"voters":["mygf","powerjacobb1","geozav","defectstar"],"severity":{"rating":"medium","score":4.3,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":14811,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/vanilla/community","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":5591128,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the report. We will investigate and reply to you shortly.","markdown_message":"\u003cp\u003eThank you for the report. We will investigate and reply to you shortly.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-16T13:38:56.471Z","updated_at":"2019-08-16T13:38:56.471Z","actor":{"username":"dexterr","cleared":false,"url":"/dexterr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/201/201/11a7da9d5256f50a86acdf6a8f3366252baee73e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5593283,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-16T18:39:13.413Z","updated_at":"2019-08-16T18:39:13.413Z","additional_data":{"old_severity":"Medium","new_severity":"Medium (4.3)","old_severity_id":494097,"new_severity_id":494524},"actor":{"username":"dexterr","cleared":false,"url":"/dexterr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/201/201/11a7da9d5256f50a86acdf6a8f3366252baee73e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5593324,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"I have triaged this report as valid. Thank you.","markdown_message":"\u003cp\u003eI have triaged this report as valid. Thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-16T18:45:20.580Z","updated_at":"2019-08-16T18:45:20.580Z","actor":{"username":"dexterr","cleared":false,"url":"/dexterr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/201/201/11a7da9d5256f50a86acdf6a8f3366252baee73e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6048811,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi guys, where did we get with this one? ","markdown_message":"\u003cp\u003eHi guys, where did we get with this one? \u003c/p\u003e\n","automated_response":false,"created_at":"2019-10-15T20:35:13.261Z","updated_at":"2019-10-15T20:35:13.261Z","actor":{"username":"mindingdata","cleared":false,"url":"/mindingdata","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6055695,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-16T15:00:18.964Z","updated_at":"2019-10-16T15:00:18.964Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"bounty_amount":"150.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"vanilla","collaborator":{"username":"mindingdata","url":"/mindingdata"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6373028,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-21T22:33:37.662Z","updated_at":"2019-11-21T22:33:37.662Z","actor":{"username":"initvector","cleared":false,"url":"/initvector","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"mindingdata","url":"/mindingdata"},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":7138940,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-24T19:41:31.425Z","updated_at":"2020-02-24T19:41:31.425Z","first_to_agree":true,"actor":{"username":"mindingdata","cleared":false,"url":"/mindingdata","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7441057,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-03-25T19:41:33.055Z","updated_at":"2020-03-25T19:41:33.055Z","actor":{"url":"/vanilla","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/443/2720e6aeb834de4fd40765a5cae34abb78eb66cd_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Vanilla"}},"genius_execution_id":null,"team_handle":"vanilla","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}