{"id":107960,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDc5NjA=","url":"https://hackerone.com/reports/107960","title":"Reflected File Download in community.ubnt.com/restapi/","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-01-03T17:39:43.907Z","submitted_at":"2016-01-03T17:39:43.907Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"a0xnirudh","url":"/a0xnirudh","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/035/891/b9be8d32dadcaa814c6bf85eceef7fdf9fa38f41_original.jpeg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":800,"url":"https://hackerone.com/ui","handle":"ui","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/800/449ca06f77c3e1dd1979bae1e5f16150334f7479_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/800/449ca06f77c3e1dd1979bae1e5f16150334f7479_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Ubiquiti Inc.","twitter_handle":"ubnt","website":"https://ui.com","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-05-27T08:36:53.903Z","bug_reporter_agreed_on_going_public_at":"2017-04-27T08:36:48.048Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\n\nhttps://community.ubnt.com/restapi/vc/authentication/sessions/Ubiquiti_update.cmd?restapi.response_format=json\u0026callback=\\%22||calc||\n\nThe above URL is vulnerable to RFD. Here is the proof of concept:\n\nBrowser Chrome:\n\n* Embedded the above URL in html 5 anchor tags with download attribute:\n\n```\n\u003ca href='https://community.ubnt.com/restapi/vc/authentication/sessions/Ubiquiti_update.cmd?restapi.response_format=json\u0026callback=\\%22||calc||' download='ubiquiti_update.cmd'\u003eDownload\u003c/a\u003e\n```\n\nWe can embedded this on any webpage and the moment user clicks on, it gets automatically download and when clicked can compromise the victim PC by executing any commands. (a calculator pops up in this case) \n\nBrowser **IE10/8**:\n\n* Give the URL directly in IE 10/8 and it directly download a file named `Ubiquiti_update.cmd`. The moment user clicks on the file, it executes and a calculator pops up.\n\n\nBrowser Firefox:\n\n* Embedded the download link in such a way  that user has to do save link as option in firefox and downloads the file `ubiquiti_update.cmd`.\n\n```\n\u003ca href='https://community.ubnt.com/restapi/vc/authentication/sessions/Ubiquiti_update.cmd?restapi.response_format=json\u0026callback=\\%22||calc||' download='ubiquiti_update.cmd' onclick=\"return false\"\u003eDownload\u003c/a\u003e\n```\n\nI can give any commands inside the file as I want and inturn use this for a complete victim machine compromise. If victim checks where the download occurs, it will show as `community.ubnt.com`.\n\nReferences about this attack:\n\nhttp://www.paulosyibelo.com/2015/10/coinbase-reflected-file-download.html (RFD reported in coinbase)\nhttps://www.trustwave.com/Resources/SpiderLabs-Blog/Reflected-File-Download---A-New-Web-Attack-Vector/  (original research work)\n\n**Mitigation**:\n\nCallbacks should contain only alphabets and not special characters. All special characters much be stripped of before reflecting it in the response !","vulnerability_information_html":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://community.ubnt.com/restapi/vc/authentication/sessions/Ubiquiti_update.cmd?restapi.response_format=json\u0026amp;callback=/%22%7C%7Ccalc%7C%7C\" href=\"/redirect?url=https%3A%2F%2Fcommunity.ubnt.com%2Frestapi%2Fvc%2Fauthentication%2Fsessions%2FUbiquiti_update.cmd%3Frestapi.response_format%3Djson%26callback%3D%2F%2522%257C%257Ccalc%257C%257C\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://community.ubnt.com/restapi/vc/authentication/sessions/Ubiquiti_update.cmd?restapi.response_format=json\u0026amp;callback=/%22%7C%7Ccalc%7C%7C\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe above URL is vulnerable to RFD. Here is the proof of concept:\u003c/p\u003e\n\n\u003cp\u003eBrowser Chrome:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eEmbedded the above URL in html 5 anchor tags with download attribute:\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;a href=\u0026#39;https://community.ubnt.com/restapi/vc/authentication/sessions/Ubiquiti_update.cmd?restapi.response_format=json\u0026amp;callback=\\%22||calc||\u0026#39; download=\u0026#39;ubiquiti_update.cmd\u0026#39;\u0026gt;Download\u0026lt;/a\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe can embedded this on any webpage and the moment user clicks on, it gets automatically download and when clicked can compromise the victim PC by executing any commands. (a calculator pops up in this case) \u003c/p\u003e\n\n\u003cp\u003eBrowser \u003cstrong\u003eIE10/8\u003c/strong\u003e:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGive the URL directly in IE 10/8 and it directly download a file named \u003ccode\u003eUbiquiti_update.cmd\u003c/code\u003e. The moment user clicks on the file, it executes and a calculator pops up.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eBrowser Firefox:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eEmbedded the download link in such a way  that user has to do save link as option in firefox and downloads the file \u003ccode\u003eubiquiti_update.cmd\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;a href=\u0026#39;https://community.ubnt.com/restapi/vc/authentication/sessions/Ubiquiti_update.cmd?restapi.response_format=json\u0026amp;callback=\\%22||calc||\u0026#39; download=\u0026#39;ubiquiti_update.cmd\u0026#39; onclick=\u0026quot;return false\u0026quot;\u0026gt;Download\u0026lt;/a\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI can give any commands inside the file as I want and inturn use this for a complete victim machine compromise. If victim checks where the download occurs, it will show as \u003ccode\u003ecommunity.ubnt.com\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eReferences about this attack:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"http://www.paulosyibelo.com/2015/10/coinbase-reflected-file-download.html\" href=\"/redirect?url=http%3A%2F%2Fwww.paulosyibelo.com%2F2015%2F10%2Fcoinbase-reflected-file-download.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.paulosyibelo.com/2015/10/coinbase-reflected-file-download.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e (RFD reported in coinbase)\u003cbr\u003e\n\u003ca title=\"https://www.trustwave.com/Resources/SpiderLabs-Blog/Reflected-File-Download---A-New-Web-Attack-Vector/\" href=\"/redirect?url=https%3A%2F%2Fwww.trustwave.com%2FResources%2FSpiderLabs-Blog%2FReflected-File-Download---A-New-Web-Attack-Vector%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.trustwave.com/Resources/SpiderLabs-Blog/Reflected-File-Download---A-New-Web-Attack-Vector/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e  (original research work)\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eMitigation\u003c/strong\u003e:\u003c/p\u003e\n\n\u003cp\u003eCallbacks should contain only alphabets and not special characters. All special characters much be stripped of before reflecting it in the response !\u003c/p\u003e\n","bounty_amount":"150.0","formatted_bounty":"$150","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-05-27T08:36:48.082Z","allow_singular_disclosure_after":-113341101.30853453,"singular_disclosure_allowed":true,"vote_count":11,"voters":["spam404","eveeez","r3y","peeper35","khizer47","exception","a0xnirudh","secdoor","spetr0x","mrr3boot","and 1 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":742565,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any updates on this ? Hopefully this is not duplicate and its a valid security issue !","markdown_message":"\u003cp\u003eAny updates on this ? Hopefully this is not duplicate and its a valid security issue !\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-05T16:03:10.799Z","updated_at":"2016-01-05T16:03:10.799Z","actor":{"username":"a0xnirudh","cleared":false,"url":"/a0xnirudh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/891/b9be8d32dadcaa814c6bf85eceef7fdf9fa38f41_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":759470,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can I get an update on this ? Atleast if you can verify this and let me know ?","markdown_message":"\u003cp\u003eCan I get an update on this ? Atleast if you can verify this and let me know ?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-15T15:50:26.231Z","updated_at":"2016-01-15T15:50:26.231Z","actor":{"username":"a0xnirudh","cleared":false,"url":"/a0xnirudh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/891/b9be8d32dadcaa814c6bf85eceef7fdf9fa38f41_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":865326,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi there,\n\nSorry for the delay on this one.  We were waiting for an update from Lithium.  Could you take a quick look and confirm that this is resolved?","markdown_message":"\u003cp\u003eHi there,\u003c/p\u003e\n\n\u003cp\u003eSorry for the delay on this one.  We were waiting for an update from Lithium.  Could you take a quick look and confirm that this is resolved?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-03-23T17:52:53.747Z","updated_at":"2016-03-23T17:52:53.747Z","actor":{"username":"ubnt-james","cleared":false,"url":"/ubnt-james","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":865353,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello @ubnt-james,\n\nFinally nice to see an update for the report. Yes, I just checked and I can see that the issue has been fixed correctly. I see that there is a content disposition header now with a proper file name.\n\nI guess this will be eligible for a bounty ? \n\nThank you so much !","markdown_message":"\u003cp\u003eHello \u003ca href=\"/ubnt-james\"\u003e@ubnt-james\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eFinally nice to see an update for the report. Yes, I just checked and I can see that the issue has been fixed correctly. I see that there is a content disposition header now with a proper file name.\u003c/p\u003e\n\n\u003cp\u003eI guess this will be eligible for a bounty ? \u003c/p\u003e\n\n\u003cp\u003eThank you so much !\u003c/p\u003e\n","automated_response":false,"created_at":"2016-03-23T17:59:32.999Z","updated_at":"2016-03-23T17:59:32.999Z","actor":{"username":"a0xnirudh","cleared":false,"url":"/a0xnirudh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/891/b9be8d32dadcaa814c6bf85eceef7fdf9fa38f41_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":865368,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Hi there,\n\nTechnically this probably should have gone to Lithium but we will provide a bounty for this report.\n\n\nThanks for testing!","markdown_message":"\u003cp\u003eHi there,\u003c/p\u003e\n\n\u003cp\u003eTechnically this probably should have gone to Lithium but we will provide a bounty for this report.\u003c/p\u003e\n\n\u003cp\u003eThanks for testing!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-03-23T18:05:38.629Z","updated_at":"2016-03-23T18:05:38.629Z","actor":{"url":"/ui","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/800/449ca06f77c3e1dd1979bae1e5f16150334f7479_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Ubiquiti Inc."}},"bounty_amount":"150.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"ui","collaborator":{"username":"a0xnirudh","url":"/a0xnirudh"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":865369,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-03-23T18:05:48.288Z","updated_at":"2016-03-23T18:05:48.288Z","actor":{"username":"ubnt-james","cleared":false,"url":"/ubnt-james","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"a0xnirudh","url":"/a0xnirudh"},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":865376,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nGreat and thank you so much. Really appreciate it :)","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eGreat and thank you so much. Really appreciate it :)\u003c/p\u003e\n","automated_response":false,"created_at":"2016-03-23T18:09:46.519Z","updated_at":"2016-03-23T18:09:46.519Z","actor":{"username":"a0xnirudh","cleared":false,"url":"/a0xnirudh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/891/b9be8d32dadcaa814c6bf85eceef7fdf9fa38f41_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1639392,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-04-27T08:36:48.062Z","updated_at":"2017-04-27T08:36:48.062Z","first_to_agree":true,"actor":{"username":"a0xnirudh","cleared":false,"url":"/a0xnirudh","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/035/891/b9be8d32dadcaa814c6bf85eceef7fdf9fa38f41_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1704922,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-27T08:36:53.914Z","updated_at":"2017-05-27T08:36:53.914Z","actor":{"url":"/ui","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/800/449ca06f77c3e1dd1979bae1e5f16150334f7479_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Ubiquiti Inc."}},"genius_execution_id":null,"team_handle":"ui","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}